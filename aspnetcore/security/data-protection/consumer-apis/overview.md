---
title: Vue d’ensemble des API de consommateur pour ASP.NET Core
author: rick-anderson
description: Recevoir une vue d’ensemble du consommateur diverses API disponibles dans la bibliothèque de protection de données ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/consumer-apis/overview
ms.openlocfilehash: b0d11d097ee2d448b6781f6fa84445f6400fbc76
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57024886"
---
# <a name="consumer-apis-overview-for-aspnet-core"></a><span data-ttu-id="dbfb8-103">Vue d’ensemble des API de consommateur pour ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="dbfb8-103">Consumer APIs overview for ASP.NET Core</span></span>

<span data-ttu-id="dbfb8-104">Le `IDataProtectionProvider` et `IDataProtector` interfaces sont les interfaces de base par le biais duquel les consommateurs utilisent le système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-104">The `IDataProtectionProvider` and `IDataProtector` interfaces are the basic interfaces through which consumers use the data protection system.</span></span> <span data-ttu-id="dbfb8-105">Ils se trouvent dans le [Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) package.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-105">They're located in the [Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) package.</span></span>

## <a name="idataprotectionprovider"></a><span data-ttu-id="dbfb8-106">IDataProtectionProvider</span><span class="sxs-lookup"><span data-stu-id="dbfb8-106">IDataProtectionProvider</span></span>

<span data-ttu-id="dbfb8-107">L’interface du fournisseur représente la racine du système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-107">The provider interface represents the root of the data protection system.</span></span> <span data-ttu-id="dbfb8-108">Il ne peut pas être directement utilisé pour protéger ou déprotéger les données.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-108">It cannot directly be used to protect or unprotect data.</span></span> <span data-ttu-id="dbfb8-109">Au lieu de cela, le consommateur doit obtenir une référence à un `IDataProtector` en appelant `IDataProtectionProvider.CreateProtector(purpose)`, où le but est une chaîne qui décrit le cas d’usage prévu de consommateur.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-109">Instead, the consumer must get a reference to an `IDataProtector` by calling `IDataProtectionProvider.CreateProtector(purpose)`, where purpose is a string that describes the intended consumer use case.</span></span> <span data-ttu-id="dbfb8-110">Consultez [chaînes d’objectifs](xref:security/data-protection/consumer-apis/purpose-strings) pour beaucoup plus d’informations sur l’intention de ce paramètre et comment choisir une valeur appropriée.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-110">See [Purpose Strings](xref:security/data-protection/consumer-apis/purpose-strings) for much more information on the intent of this parameter and how to choose an appropriate value.</span></span>

## <a name="idataprotector"></a><span data-ttu-id="dbfb8-111">IDataProtector</span><span class="sxs-lookup"><span data-stu-id="dbfb8-111">IDataProtector</span></span>

<span data-ttu-id="dbfb8-112">L’interface de protecteur est retournée par un appel à `CreateProtector`et il cette interface à laquelle les clients peuvent utiliser pour effectuer protéger et déprotéger les opérations.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-112">The protector interface is returned by a call to `CreateProtector`, and it's this interface which consumers can use to perform protect and unprotect operations.</span></span>

<span data-ttu-id="dbfb8-113">Pour protéger un élément de données, passer les données à le `Protect` (méthode).</span><span class="sxs-lookup"><span data-stu-id="dbfb8-113">To protect a piece of data, pass the data to the `Protect` method.</span></span> <span data-ttu-id="dbfb8-114">L’interface de base définit une méthode qui convertit byte [-] -> byte [], mais il existe également une surcharge (fournie comme méthode d’extension) qui convertit la chaîne -> chaîne.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-114">The basic interface defines a method which converts byte[] -> byte[], but there's also an overload (provided as an extension method) which converts string -> string.</span></span> <span data-ttu-id="dbfb8-115">La sécurité offerte par les deux méthodes est identique. le développeur doit choisir quelle que soit la surcharge est plus pratique pour leurs cas d’usage.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-115">The security offered by the two methods is identical; the developer should choose whichever overload is most convenient for their use case.</span></span> <span data-ttu-id="dbfb8-116">Quelle que soit la surcharge choisie, la valeur retournée par la protéger (méthode) est désormais protégée (des et répondre à tous les falsifications), et l’application peut envoyer à un client non fiable.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-116">Irrespective of the overload chosen, the value returned by the Protect method is now protected (enciphered and tamper-proofed), and the application can send it to an untrusted client.</span></span>

<span data-ttu-id="dbfb8-117">Pour ôter la protection d’une donnée précédemment protégé, passer les données protégées sur le `Unprotect` (méthode).</span><span class="sxs-lookup"><span data-stu-id="dbfb8-117">To unprotect a previously-protected piece of data, pass the protected data to the `Unprotect` method.</span></span> <span data-ttu-id="dbfb8-118">(Il existe byte []-basé sur chaîne et en fonction des surcharges pour simplifier le développement.) Si la charge utile protégée a été générée par un appel antérieur à `Protect` sur cette même `IDataProtector`, le `Unprotect` méthode retournera la charge non protégée d’origine.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-118">(There are byte[]-based and string-based overloads for developer convenience.) If the protected payload was generated by an earlier call to `Protect` on this same `IDataProtector`, the `Unprotect` method will return the original unprotected payload.</span></span> <span data-ttu-id="dbfb8-119">Si la charge utile protégée a été falsifiée ou qu’il a été générée par un autre `IDataProtector`, le `Unprotect` méthode lèvera CryptographicException.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-119">If the protected payload has been tampered with or was produced by a different `IDataProtector`, the `Unprotect` method will throw CryptographicException.</span></span>

<span data-ttu-id="dbfb8-120">Le concept de même et différents `IDataProtector` ties sauvegarder sur le concept d’objectif.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-120">The concept of same vs. different `IDataProtector` ties back to the concept of purpose.</span></span> <span data-ttu-id="dbfb8-121">Si deux `IDataProtector` instances ont été générés à partir de la même racine `IDataProtectionProvider` mais via des chaînes d’objectifs différents dans l’appel à `IDataProtectionProvider.CreateProtector`, puis être considérées comme [protecteurs différents](xref:security/data-protection/consumer-apis/purpose-strings), et un ne pourrez pas ôter la protection charges utiles générées par l’autre.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-121">If two `IDataProtector` instances were generated from the same root `IDataProtectionProvider` but via different purpose strings in the call to `IDataProtectionProvider.CreateProtector`, then they're considered [different protectors](xref:security/data-protection/consumer-apis/purpose-strings), and one won't be able to unprotect payloads generated by the other.</span></span>

## <a name="consuming-these-interfaces"></a><span data-ttu-id="dbfb8-122">Utilisation de ces interfaces.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-122">Consuming these interfaces</span></span>

<span data-ttu-id="dbfb8-123">Pour un composant prenant en charge l’injection de dépendances, l’utilisation prévue est que le composant un `IDataProtectionProvider` paramètre dans son constructeur et que le système d’injection de dépendance fournit automatiquement ce service lorsque le composant est instancié.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-123">For a DI-aware component, the intended usage is that the component take an `IDataProtectionProvider` parameter in its constructor and that the DI system automatically provides this service when the component is instantiated.</span></span>

> [!NOTE]
> <span data-ttu-id="dbfb8-124">Certaines applications (telles que les applications de console ou les applications ASP.NET 4.x) ne peuvent pas être conscients de l’injection de dépendances ne pouvez pas utiliser le mécanisme décrit ici.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-124">Some applications (such as console applications or ASP.NET 4.x applications) might not be DI-aware so cannot use the mechanism described here.</span></span> <span data-ttu-id="dbfb8-125">Pour ces scénarios, consultez le [des scénarios compatibles avec l’injection de dépendances Non](xref:security/data-protection/configuration/non-di-scenarios) document pour plus d’informations sur l’obtention d’une instance d’un `IDataProtection` fournisseur sans passer par l’injection de dépendances.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-125">For these scenarios consult the [Non DI Aware Scenarios](xref:security/data-protection/configuration/non-di-scenarios) document for more information on getting an instance of an `IDataProtection` provider without going through DI.</span></span>

<span data-ttu-id="dbfb8-126">L’exemple suivant montre trois concepts :</span><span class="sxs-lookup"><span data-stu-id="dbfb8-126">The following sample demonstrates three concepts:</span></span>

1. <span data-ttu-id="dbfb8-127">[Ajouter le système de protection des données](xref:security/data-protection/configuration/overview) au conteneur de service,</span><span class="sxs-lookup"><span data-stu-id="dbfb8-127">[Add the data protection system](xref:security/data-protection/configuration/overview) to the service container,</span></span>

2. <span data-ttu-id="dbfb8-128">À l’aide de l’injection de dépendances pour recevoir une instance d’un `IDataProtectionProvider`, et</span><span class="sxs-lookup"><span data-stu-id="dbfb8-128">Using DI to receive an instance of an `IDataProtectionProvider`, and</span></span>

3. <span data-ttu-id="dbfb8-129">Création d’un `IDataProtector` à partir d’un `IDataProtectionProvider` et son utilisation pour protéger et déprotéger les données.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-129">Creating an `IDataProtector` from an `IDataProtectionProvider` and using it to protect and unprotect data.</span></span>

[!code-csharp[](../using-data-protection/samples/protectunprotect.cs?highlight=26,34,35,36,37,38,39,40)]

<span data-ttu-id="dbfb8-130">Le package Microsoft.AspNetCore.DataProtection.Abstractions contient une méthode d’extension `IServiceProvider.GetDataProtector` en tant que développeur pour des raisons pratiques.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-130">The package Microsoft.AspNetCore.DataProtection.Abstractions contains an extension method `IServiceProvider.GetDataProtector` as a developer convenience.</span></span> <span data-ttu-id="dbfb8-131">Comme une seule opération, il encapsule à la fois récupérer un `IDataProtectionProvider` à partir du fournisseur de services et l’appel `IDataProtectionProvider.CreateProtector`.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-131">It encapsulates as a single operation both retrieving an `IDataProtectionProvider` from the service provider and calling `IDataProtectionProvider.CreateProtector`.</span></span> <span data-ttu-id="dbfb8-132">L’exemple suivant illustre son utilisation.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-132">The following sample demonstrates its usage.</span></span>

[!code-csharp[](./overview/samples/getdataprotector.cs?highlight=15)]

>[!TIP]
> <span data-ttu-id="dbfb8-133">Instances de `IDataProtectionProvider` et `IDataProtector` soient thread-safe pour les appelants plusieurs.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-133">Instances of `IDataProtectionProvider` and `IDataProtector` are thread-safe for multiple callers.</span></span> <span data-ttu-id="dbfb8-134">Elles sont censées qui une fois qu’un composant obtient une référence à un `IDataProtector` via un appel à `CreateProtector`, il utilisera cette référence pour plusieurs appels à `Protect` et `Unprotect`.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-134">It's intended that once a component gets a reference to an `IDataProtector` via a call to `CreateProtector`, it will use that reference for multiple calls to `Protect` and `Unprotect`.</span></span> <span data-ttu-id="dbfb8-135">Un appel à `Unprotect` lèvera CryptographicException si la charge utile protégée ne peut pas être vérifiée ou déchiffrée.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-135">A call to `Unprotect` will throw CryptographicException if the protected payload cannot be verified or deciphered.</span></span> <span data-ttu-id="dbfb8-136">Certains composants souhaiterez peut-être ignorer les erreurs pendant les opérations ; ôter la protection un composant qui lit des cookies d’authentification peut gérer cette erreur et traiter la demande comme s’il n’avait aucun cookie tout plutôt qu’échouer la requête directement ce dernier.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-136">Some components may wish to ignore errors during unprotect operations; a component which reads authentication cookies might handle this error and treat the request as if it had no cookie at all rather than fail the request outright.</span></span> <span data-ttu-id="dbfb8-137">Les composants que ce comportement doivent spécifiquement intercepter CryptographicException au lieu d’absorber toutes les exceptions.</span><span class="sxs-lookup"><span data-stu-id="dbfb8-137">Components which want this behavior should specifically catch CryptographicException instead of swallowing all exceptions.</span></span>
