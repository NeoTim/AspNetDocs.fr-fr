---
title: Validation de modèle dans ASP.NET Core MVC
author: tdykstra
description: Découvrez plus d’informations sur la validation de modèle dans ASP.NET Core MVC.
ms.author: riande
ms.custom: mvc
ms.date: 01/14/2019
uid: mvc/models/validation
ms.openlocfilehash: ca7ee54b8e6b6ae5091b0cb133e448ad9c04da8f
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57049066"
---
# <a name="model-validation-in-aspnet-core-mvc"></a><span data-ttu-id="e3cf1-103">Validation de modèle dans ASP.NET Core MVC</span><span class="sxs-lookup"><span data-stu-id="e3cf1-103">Model validation in ASP.NET Core MVC</span></span>

<span data-ttu-id="e3cf1-104">Par [Rachel Appel](https://github.com/rachelappel)</span><span class="sxs-lookup"><span data-stu-id="e3cf1-104">By [Rachel Appel](https://github.com/rachelappel)</span></span>

## <a name="introduction-to-model-validation"></a><span data-ttu-id="e3cf1-105">Introduction à la validation de modèle</span><span class="sxs-lookup"><span data-stu-id="e3cf1-105">Introduction to model validation</span></span>

<span data-ttu-id="e3cf1-106">Avant qu’une application stocke des données dans une base de données, l’application doit valider les données.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-106">Before an app stores data in a database, the app must validate the data.</span></span> <span data-ttu-id="e3cf1-107">L’application doit vérifier que les données ne contiennent pas de menaces de sécurité potentielles, et qu’elles sont mises en forme de façon appropriée quand au type et à la taille. Elles doivent aussi être conformes à vos règles.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-107">Data must be checked for potential security threats, verified that it's appropriately formatted by type and size, and it must conform to your rules.</span></span> <span data-ttu-id="e3cf1-108">La validation est nécessaire même si son implémentation peut être fastidieuse et redondante.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-108">Validation is necessary although it can be redundant and tedious to implement.</span></span> <span data-ttu-id="e3cf1-109">Dans MVC, la validation se produit à la fois sur le client et sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-109">In MVC, validation happens on both the client and server.</span></span>

<span data-ttu-id="e3cf1-110">Heureusement, .NET dispose d’une validation abstraite dans des attributs de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-110">Fortunately, .NET has abstracted validation into validation attributes.</span></span> <span data-ttu-id="e3cf1-111">Ces attributs contiennent un code de validation, ce qui réduit la quantité de code à écrire.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-111">These attributes contain validation code, thereby reducing the amount of code you must write.</span></span>

<span data-ttu-id="e3cf1-112">Dans ASP.NET Core 2.2 et ultérieur, le runtime ASP.NET Core court-circuite (ignore) la validation s’il détermine qu’un graphe de modèle donné n’a pas besoin de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-112">In ASP.NET Core 2.2 and later, the ASP.NET Core runtime short-circuits (skips) validation if it can determine that a given model graph doesn't require validation.</span></span> <span data-ttu-id="e3cf1-113">Cela peut déboucher sur une amélioration significative des performances lors de la validation de modèles qui ne peuvent pas avoir de validateurs associés ou qui n’en ont pas.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-113">Skipping validation can provide significant performance improvements when validating models that cannot or do not have any associated validators.</span></span> <span data-ttu-id="e3cf1-114">La validation ignorée inclut des objets comme des collections de primitifs (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.) ou des graphes d’objets complexes sans validateurs.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-114">The skipped validation includes objects such as collections of primitives (`byte[]`, `string[]`, `Dictionary<string, string>`, etc.), or complex object graphs without any validators.</span></span>

<span data-ttu-id="e3cf1-115">[Affichez ou téléchargez un exemple depuis GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-115">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/models/validation/sample).</span></span>

## <a name="validation-attributes"></a><span data-ttu-id="e3cf1-116">Attributs de validation</span><span class="sxs-lookup"><span data-stu-id="e3cf1-116">Validation Attributes</span></span>

<span data-ttu-id="e3cf1-117">Les attributs de validation sont un moyen de configurer la validation de modèle : elle est donc conceptuellement similaire à la validation des champs dans les tables de base de données.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-117">Validation attributes are a way to configure model validation so it's similar conceptually to validation on fields in database tables.</span></span> <span data-ttu-id="e3cf1-118">Ceci inclut des contraintes comme l’affectation de types de données ou des champs obligatoires.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-118">This includes constraints such as assigning data types or required fields.</span></span> <span data-ttu-id="e3cf1-119">L’application de modèles aux données pour forcer le respect des règles d’entreprise, comme une carte de crédit, un numéro de téléphone ou une adresse e-mail, est un autre type de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-119">Other types of validation include applying patterns to data to enforce business rules, such as a credit card, phone number, or email address.</span></span> <span data-ttu-id="e3cf1-120">Les attributs de validation simplifient et facilitent l’application de ces exigences.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-120">Validation attributes make enforcing these requirements much simpler and easier to use.</span></span>

<span data-ttu-id="e3cf1-121">Les attributs de validation sont spécifiés au niveau de la propriété :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-121">Validation attributes are specified at the property level:</span></span> 

```csharp
[Required]
public string MyProperty { get; set; }
```

<span data-ttu-id="e3cf1-122">Voici un modèle `Movie` annoté pour une application qui stocke des informations sur les films et les émissions de télévision.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-122">Below is an annotated `Movie` model from an app that stores information about movies and TV shows.</span></span> <span data-ttu-id="e3cf1-123">La plupart des propriétés sont obligatoires et plusieurs propriétés de type chaîne sont soumises à des exigences en matière de longueur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-123">Most of the properties are required and several string properties have length requirements.</span></span> <span data-ttu-id="e3cf1-124">En outre, une restriction de plage numérique de 0 à 999,99 $ est en place pour la propriété `Price`, ainsi qu’un attribut de validation personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-124">Additionally, there's a numeric range restriction in place for the `Price` property from 0 to $999.99, along with a custom validation attribute.</span></span>

[!code-csharp[](validation/sample/Movie.cs?range=6-29)]

<span data-ttu-id="e3cf1-125">Une simple lecture du modèle révèle les règles concernant les données de cette application, facilitant ainsi la maintenance du code.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-125">Simply reading through the model reveals the rules about data for this app, making it easier to maintain the code.</span></span> <span data-ttu-id="e3cf1-126">Voici plusieurs attributs de validation intégrés courants :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-126">Below are several popular built-in validation attributes:</span></span>

* <span data-ttu-id="e3cf1-127">`[CreditCard]`: Vérifie que la propriété a un format de carte de crédit.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-127">`[CreditCard]`: Validates the property has a credit card format.</span></span>

* <span data-ttu-id="e3cf1-128">`[Compare]`: Vérifie que deux propriétés d’un modèle sont en correspondance.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-128">`[Compare]`: Validates two properties in a model match.</span></span>

* <span data-ttu-id="e3cf1-129">`[EmailAddress]`: Vérifie que la propriété a un format d’e-mail.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-129">`[EmailAddress]`: Validates the property has an email format.</span></span>

* <span data-ttu-id="e3cf1-130">`[Phone]`: Vérifie que la propriété a un format de numéro de téléphone.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-130">`[Phone]`: Validates the property has a telephone format.</span></span>

* <span data-ttu-id="e3cf1-131">`[Range]`: Vérifie que la valeur de la propriété est dans la plage donnée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-131">`[Range]`: Validates the property value falls within the given range.</span></span>

* <span data-ttu-id="e3cf1-132">`[RegularExpression]`: Vérifie que les données correspondent à l’expression régulière spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-132">`[RegularExpression]`: Validates that the data matches the specified regular expression.</span></span>

* <span data-ttu-id="e3cf1-133">`[Required]`: Rend une propriété obligatoire.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-133">`[Required]`: Makes a property required.</span></span>

* <span data-ttu-id="e3cf1-134">`[StringLength]`: Vérifie que la longueur d’une propriété de type chaîne est au plus la longueur maximale spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-134">`[StringLength]`: Validates that a string property has at most the given maximum length.</span></span>

* <span data-ttu-id="e3cf1-135">`[Url]`: Vérifie que la propriété a un format d’URL.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-135">`[Url]`: Validates the property has a URL format.</span></span>

<span data-ttu-id="e3cf1-136">MVC prend en charge tout attribut dérivant de `ValidationAttribute` à des fins de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-136">MVC supports any attribute that derives from `ValidationAttribute` for validation purposes.</span></span> <span data-ttu-id="e3cf1-137">Vous pouvez trouver de nombreux attributs de validation utiles dans l’espace de noms [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-137">Many useful validation attributes can be found in the [System.ComponentModel.DataAnnotations](/dotnet/api/system.componentmodel.dataannotations) namespace.</span></span>

<span data-ttu-id="e3cf1-138">Pour certaines, vous pouvez avoir besoin de plus de fonctionnalités que celles fournies par les attributs prédéfinis.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-138">There may be instances where you need more features than built-in attributes provide.</span></span> <span data-ttu-id="e3cf1-139">Dans ces cas, vous pouvez créer des attributs de validation personnalisés en dérivant depuis `ValidationAttribute` ou en modifiant votre modèle pour implémenter `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-139">For those times, you can create custom validation attributes by deriving from `ValidationAttribute` or changing your model to implement `IValidatableObject`.</span></span>

## <a name="notes-on-the-use-of-the-required-attribute"></a><span data-ttu-id="e3cf1-140">Remarques sur l’utilisation de l’attribut Required</span><span class="sxs-lookup"><span data-stu-id="e3cf1-140">Notes on the use of the Required attribute</span></span>

<span data-ttu-id="e3cf1-141">Les [types valeur](/dotnet/csharp/language-reference/keywords/value-types) non Nullable (tels que `decimal`, `int`, `float` et `DateTime`) sont obligatoires par nature et n’ont pas besoin de l’attribut `Required`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-141">Non-nullable [value types](/dotnet/csharp/language-reference/keywords/value-types) (such as `decimal`, `int`, `float`, and `DateTime`) are inherently required and don't need the `Required` attribute.</span></span> <span data-ttu-id="e3cf1-142">L’application n’effectue pas de vérifications de validation côté serveur pour les types non Nullables qui sont marqués `Required`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-142">The app performs no server-side validation checks for non-nullable types that are marked `Required`.</span></span>

<span data-ttu-id="e3cf1-143">La liaison de modèle MVC, qui n’est pas concernée par la validation et les attributs de validation, rejette l’envoi d’un champ de formulaire contenant une valeur manquante ou un espace pour un type non Nullable.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-143">MVC model binding, which isn't concerned with validation and validation attributes, rejects a form field submission containing a missing value or whitespace for a non-nullable type.</span></span> <span data-ttu-id="e3cf1-144">En l’absence d’un attribut `BindRequired` sur la propriété cible, la liaison de modèle ignore les données manquantes pour les types non Nullables, où le champ de formulaire est absent dans les données du formulaire entrant.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-144">In the absence of a `BindRequired` attribute on the target property, model binding ignores missing data for non-nullable types, where the form field is absent from the incoming form data.</span></span>

<span data-ttu-id="e3cf1-145">L’[attribut BindRequired](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (consultez également <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) est pratique pour vérifier que les données d’un formulaire sont complètes.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-145">The [BindRequired attribute](/dotnet/api/microsoft.aspnetcore.mvc.modelbinding.bindrequiredattribute) (also see <xref:mvc/models/model-binding#customize-model-binding-behavior-with-attributes>) is useful to ensure form data is complete.</span></span> <span data-ttu-id="e3cf1-146">Quand il est appliqué à une propriété, le système de la liaison de modèle exige une valeur pour cette propriété.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-146">When applied to a property, the model binding system requires a value for that property.</span></span> <span data-ttu-id="e3cf1-147">Quand il est appliqué à un type, le système de la liaison de modèle exige des valeurs pour toutes les propriétés de ce type.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-147">When applied to a type, the model binding system requires values for all of the properties of that type.</span></span>

<span data-ttu-id="e3cf1-148">Quand vous utilisez un type [Nullable\<T> ](/dotnet/csharp/programming-guide/nullable-types/) (par exemple `decimal?` ou `System.Nullable<decimal>`) et que vous le marquez `Required`, une vérification de la validation côté serveur est effectuée comme si la propriété était de type nullable standard (par exemple `string`).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-148">When you use a [Nullable\<T> type](/dotnet/csharp/programming-guide/nullable-types/) (for example, `decimal?` or `System.Nullable<decimal>`) and mark it `Required`, a server-side validation check is performed as if the property were a standard nullable type (for example, a `string`).</span></span>

<span data-ttu-id="e3cf1-149">La validation côté client nécessite une valeur pour un champ de formulaire qui correspond à une propriété du modèle que vous avez marquée `Required` et pour une propriété de type non Nullable que vous n’avez pas marquée `Required`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-149">Client-side validation requires a value for a form field that corresponds to a model property that you've marked `Required` and for a non-nullable type property that you haven't marked `Required`.</span></span> <span data-ttu-id="e3cf1-150">`Required` peut être utilisé pour contrôler le message d’erreur de validation côté client.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-150">`Required` can be used to control the client-side validation error message.</span></span>

::: moniker range=">= aspnetcore-2.1"

## <a name="top-level-node-validation"></a><span data-ttu-id="e3cf1-151">Validation du nœud de niveau supérieur</span><span class="sxs-lookup"><span data-stu-id="e3cf1-151">Top-level node validation</span></span>

<span data-ttu-id="e3cf1-152">Les nœuds de niveau supérieur incluent les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-152">Top-level nodes include:</span></span>

* <span data-ttu-id="e3cf1-153">Paramètres d’action</span><span class="sxs-lookup"><span data-stu-id="e3cf1-153">Action parameters</span></span>
* <span data-ttu-id="e3cf1-154">Propriétés du contrôleur</span><span class="sxs-lookup"><span data-stu-id="e3cf1-154">Controller properties</span></span>
* <span data-ttu-id="e3cf1-155">Paramètres du gestionnaire de page</span><span class="sxs-lookup"><span data-stu-id="e3cf1-155">Page handler parameters</span></span>
* <span data-ttu-id="e3cf1-156">Propriétés du modèle de page</span><span class="sxs-lookup"><span data-stu-id="e3cf1-156">Page model properties</span></span>

<span data-ttu-id="e3cf1-157">Les nœuds de niveau supérieur liés au modèle sont validés en plus de la validation des propriétés du modèle.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-157">Model-bound top-level nodes are validated in addition to validating model properties.</span></span> <span data-ttu-id="e3cf1-158">Dans l’exemple suivant tiré de l’exemple d’application, la méthode `VerifyPhone` utilise <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> pour valider les données utilisateur dans le champ Phone (Téléphone) d’un formulaire :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-158">In the following example from the sample app, the `VerifyPhone` method uses the <xref:System.ComponentModel.DataAnnotations.RegularExpressionAttribute> to validate the user data in the Phone field of a form:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyPhone)]

<span data-ttu-id="e3cf1-159">Les nœuds de niveau supérieur peuvent utiliser <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> avec des attributs de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-159">Top-level nodes can use <xref:Microsoft.AspNetCore.Mvc.ModelBinding.BindRequiredAttribute> with validation attributes.</span></span> <span data-ttu-id="e3cf1-160">Dans l’exemple suivant de l’exemple d’application, la méthode `CheckAge` spécifie que le paramètre `age` doit être lié à partir de la chaîne de requête au moment de l’envoi du formulaire :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-160">In the following example from the sample app, the `CheckAge` method specifies that the `age` parameter must be bound from the query string when the form is submitted:</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_CheckAge)]

<span data-ttu-id="e3cf1-161">Dans la page de vérification de l’âge (*CheckAge.cshtml*), il existe deux formulaires.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-161">In the Check Age page (*CheckAge.cshtml*), there are two forms.</span></span> <span data-ttu-id="e3cf1-162">Le premier formulaire envoie une valeur `Age` égale à `99` en tant que chaîne de requête : `https://localhost:5001/Users/CheckAge?Age=99`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-162">The first form submits an `Age` value of `99` as a query string: `https://localhost:5001/Users/CheckAge?Age=99`.</span></span>

<span data-ttu-id="e3cf1-163">Quand un paramètre `age` au format approprié est envoyé à partir de la chaîne de requête, le formulaire est validé.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-163">When a properly formatted `age` parameter from the query string is submitted, the form validates.</span></span>

<span data-ttu-id="e3cf1-164">Le second formulaire de la page de vérification de l’âge envoie la valeur `Age` dans le corps de la requête, ce qui entraîne un échec de la validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-164">The second form on the Check Age page submits the `Age` value in the body of the request, and validation fails.</span></span> <span data-ttu-id="e3cf1-165">L’échec de la liaison est dû au fait que le paramètre `age` doit provenir d’une chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-165">Binding fails because the `age` parameter must come from a query string.</span></span>

<span data-ttu-id="e3cf1-166">La validation est activée par défaut et contrôlée par la propriété <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> de <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-166">Validation is enabled by default and controlled by the <xref:Microsoft.AspNetCore.Mvc.MvcOptions.AllowValidatingTopLevelNodes*> property of <xref:Microsoft.AspNetCore.Mvc.MvcOptions>.</span></span> <span data-ttu-id="e3cf1-167">Pour désactiver la validation du nœud de niveau supérieur, affectez à `AllowValidatingTopLevelNodes` la valeur `false` dans les options MVC (`Startup.ConfigureServices`) :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-167">To disable top-level node validation, set `AllowValidatingTopLevelNodes` to `false` in MVC options (`Startup.ConfigureServices`):</span></span>

[!code-csharp[](validation/sample_snapshot/Startup.cs?name=snippet_AddMvc&highlight=4)]

::: moniker-end

## <a name="model-state"></a><span data-ttu-id="e3cf1-168">État du modèle</span><span class="sxs-lookup"><span data-stu-id="e3cf1-168">Model State</span></span>

<span data-ttu-id="e3cf1-169">L’état du modèle représente les erreurs de validation dans les valeurs du formulaire HTML envoyé.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-169">Model state represents validation errors in submitted HTML form values.</span></span>

<span data-ttu-id="e3cf1-170">MVC continue la validation des champs jusqu’à ce que le nombre maximal d’erreurs soit atteint (200 par défaut).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-170">MVC will continue validating fields until it reaches the maximum number of errors (200 by default).</span></span> <span data-ttu-id="e3cf1-171">Vous pouvez configurer ce nombre avec le code suivant dans `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-171">You can configure this number with the following code in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](validation/sample/Startup.cs?name=snippet_MaxModelValidationErrors)]

## <a name="handle-model-state-errors"></a><span data-ttu-id="e3cf1-172">Gérer les erreurs d’état de modèle</span><span class="sxs-lookup"><span data-stu-id="e3cf1-172">Handle Model State errors</span></span>

<span data-ttu-id="e3cf1-173">La validation de modèle se produit avant l’exécution d’une action de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-173">Model validation occurs before the execution of a controller action.</span></span> <span data-ttu-id="e3cf1-174">Il incombe à l’action d’inspecter `ModelState.IsValid` et de réagir de façon appropriée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-174">It's the action's responsibility to inspect `ModelState.IsValid` and react appropriately.</span></span> <span data-ttu-id="e3cf1-175">Dans de nombreux cas, la réaction appropriée est de retourner une réponse d’erreur, dans l’idéal en détaillant la raison de l’échec de validation du modèle.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-175">In many cases, the appropriate reaction is to return an error response, ideally detailing the reason why model validation failed.</span></span>

::: moniker range=">= aspnetcore-2.1"

<span data-ttu-id="e3cf1-176">Quand `ModelState.IsValid` prend la valeur `false` dans les contrôleurs d’API web à l’aide de l’attribut `[ApiController]`, une réponse HTTP 400 automatique contenant les détails du problème est retournée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-176">When `ModelState.IsValid` evaluates to `false` in web API controllers using the `[ApiController]` attribute, an automatic HTTP 400 response containing issue details is returned.</span></span> <span data-ttu-id="e3cf1-177">Pour plus d’informations, consultez [Réponses HTTP 400 automatiques](xref:web-api/index#automatic-http-400-responses).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-177">For more information, see [Automatic HTTP 400 responses](xref:web-api/index#automatic-http-400-responses).</span></span>

::: moniker-end

<span data-ttu-id="e3cf1-178">Certaines applications choisissent de suivre une convention standard pour traiter les erreurs de validation de modèle ; dans ce cas, un filtre peut être un emplacement approprié pour implémenter une telle stratégie.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-178">Some apps will choose to follow a standard convention for dealing with model validation errors, in which case a filter may be an appropriate place to implement such a policy.</span></span> <span data-ttu-id="e3cf1-179">Vous devez tester le comportement de vos actions avec des états de modèle valides et non valides.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-179">You should test how your actions behave with valid and invalid model states.</span></span>

## <a name="manual-validation"></a><span data-ttu-id="e3cf1-180">Validation manuelle</span><span class="sxs-lookup"><span data-stu-id="e3cf1-180">Manual validation</span></span>

<span data-ttu-id="e3cf1-181">Une fois la liaison de modèle et la validation terminées, vous pouvez en répéter des parties.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-181">After model binding and validation are complete, you may want to repeat parts of it.</span></span> <span data-ttu-id="e3cf1-182">Par exemple, un utilisateur peut avoir entré du texte dans un champ qui attendait un entier, ou il peut être nécessaire de calculer une valeur pour une propriété du modèle.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-182">For example, a user may have entered text in a field expecting an integer, or you may need to compute a value for a model's property.</span></span>

<span data-ttu-id="e3cf1-183">Il peut être nécessaire d’effectuer la validation manuellement.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-183">You may need to run validation manually.</span></span> <span data-ttu-id="e3cf1-184">Pour cela, appelez la méthode `TryValidateModel`, comme indiqué ici :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-184">To do so, call the `TryValidateModel` method, as shown here:</span></span>

[!code-csharp[](validation/sample/MoviesController.cs?name=snippet_TryValidateModel)]

## <a name="custom-validation"></a><span data-ttu-id="e3cf1-185">Validation personnalisée</span><span class="sxs-lookup"><span data-stu-id="e3cf1-185">Custom validation</span></span>

<span data-ttu-id="e3cf1-186">Les attributs de validation fonctionnent pour la plupart des besoins de validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-186">Validation attributes work for most validation needs.</span></span> <span data-ttu-id="e3cf1-187">Certaines règles de validation sont cependant spécifiques à votre métier.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-187">However, some validation rules are specific to your business.</span></span> <span data-ttu-id="e3cf1-188">Vos règles peuvent ne pas être des techniques de validation de données courantes comme vérifier qu’un champ est obligatoire ou qu’il est conforme à une plage de valeurs.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-188">Your rules might not be common data validation techniques such as ensuring a field is required or that it conforms to a range of values.</span></span> <span data-ttu-id="e3cf1-189">Pour ces scénarios, les attributs de validation personnalisés sont une bonne solution.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-189">For these scenarios, custom validation attributes are a great solution.</span></span> <span data-ttu-id="e3cf1-190">Vous pouvez créer facilement vos propres attributs de validation personnalisée dans MVC.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-190">Creating your own custom validation attributes in MVC is easy.</span></span> <span data-ttu-id="e3cf1-191">Héritez simplement de `ValidationAttribute` et remplacez la méthode `IsValid`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-191">Just inherit from the `ValidationAttribute`, and override the `IsValid` method.</span></span> <span data-ttu-id="e3cf1-192">La méthode `IsValid` accepte deux paramètres, le premier est un objet nommé *value* et le second est un objet `ValidationContext` nommé *validationContext*.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-192">The `IsValid` method accepts two parameters, the first is an object named *value* and the second is a `ValidationContext` object named *validationContext*.</span></span> <span data-ttu-id="e3cf1-193">*value* fait référence à la valeur réelle du champ que votre validateur personnalisé doit valider.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-193">*Value* refers to the actual value from the field that your custom validator is validating.</span></span>

<span data-ttu-id="e3cf1-194">Dans l’exemple suivant, une règle métier stipule que les utilisateurs ne peuvent pas définir le genre sur *Classic* pour un film sorti après 1960.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-194">In the following sample, a business rule states that users may not set the genre to *Classic* for a movie released after 1960.</span></span> <span data-ttu-id="e3cf1-195">L’attribut `[ClassicMovie]` vérifie d’abord le genre et, s’il s’agit d’un classique, vérifie ensuite si date de sortie est postérieure à 1960.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-195">The `[ClassicMovie]` attribute checks the genre first, and if it's a classic, then it checks the release date to see that it's later than 1960.</span></span> <span data-ttu-id="e3cf1-196">Si la sortie est postérieure à 1960, la validation échoue.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-196">If it's released after 1960, validation fails.</span></span> <span data-ttu-id="e3cf1-197">L’attribut accepte un paramètre entier qui représente l’année que vous pouvez utiliser pour valider les données.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-197">The attribute accepts an integer parameter representing the year that you can use to validate data.</span></span> <span data-ttu-id="e3cf1-198">Vous pouvez capturer la valeur du paramètre dans le constructeur de l’attribut, comme illustré ici :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-198">You can capture the value of the parameter in the attribute's constructor, as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_ClassicMovieAttribute)]

<span data-ttu-id="e3cf1-199">La variable `movie` ci-dessus représente un objet `Movie` qui contient les données de l’envoi du formulaire à valider.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-199">The `movie` variable above represents a `Movie` object that contains the data from the form submission to validate.</span></span> <span data-ttu-id="e3cf1-200">Dans ce cas, le code de validation vérifie la date et le genre dans la méthode `IsValid` de la classe `ClassicMovieAttribute` selon les règles définies.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-200">In this case, the validation code checks the date and genre in the `IsValid` method of the `ClassicMovieAttribute` class as per the rules.</span></span> <span data-ttu-id="e3cf1-201">Si la validation réussit, `IsValid` retourne un code `ValidationResult.Success`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-201">Upon successful validation ,`IsValid` returns a `ValidationResult.Success` code.</span></span> <span data-ttu-id="e3cf1-202">Quand la validation échoue, un `ValidationResult` avec un message d’erreur est retourné :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-202">When validation fails, a `ValidationResult` with an error message is returned:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_GetErrorMessage)]

<span data-ttu-id="e3cf1-203">Quand un utilisateur modifie le champ `Genre` et envoie le formulaire, la méthode `IsValid` de la classe `ClassicMovieAttribute` doit vérifier si le film est un classique.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-203">When a user modifies the `Genre` field and submits the form, the `IsValid` method of the `ClassicMovieAttribute` will verify whether the movie is a classic.</span></span> <span data-ttu-id="e3cf1-204">Comme pour tout attribut prédéfini, appliquez `ClassicMovieAttribute` à une propriété comme `ReleaseDate` pour garantir que la validation se produit, comme illustré dans l’exemple de code précédent.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-204">Like any built-in attribute, apply the `ClassicMovieAttribute` to a property such as `ReleaseDate` to ensure validation happens, as shown in the previous code sample.</span></span> <span data-ttu-id="e3cf1-205">Étant donné que l’exemple fonctionne seulement avec les types `Movie`, une meilleure option consiste à utiliser `IValidatableObject` comme illustré dans le paragraphe suivant.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-205">Since the example works only with `Movie` types, a better option is to use `IValidatableObject` as shown in the following paragraph.</span></span>

<span data-ttu-id="e3cf1-206">Vous pouvez aussi placer ce même code dans le modèle en implémentant la méthode `Validate` sur l’interface `IValidatableObject`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-206">Alternatively, this same code could be placed in the model by implementing the `Validate` method on the `IValidatableObject` interface.</span></span> <span data-ttu-id="e3cf1-207">Si les attributs de validation personnalisés fonctionnent bien pour la validation de propriétés individuelles, vous pouvez aussi utiliser l’implémentation de `IValidatableObject` pour implémenter une validation au niveau de la classe :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-207">While custom validation attributes work well for validating individual properties, implementing `IValidatableObject` can be used to implement class-level validation:</span></span>

[!code-csharp[](validation/sample/MovieIValidatable.cs?name=snippet&highlight=1,26-34)]

## <a name="client-side-validation"></a><span data-ttu-id="e3cf1-208">Validation côté client</span><span class="sxs-lookup"><span data-stu-id="e3cf1-208">Client side validation</span></span>

<span data-ttu-id="e3cf1-209">La validation côté client est très pratique pour les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-209">Client side validation is a great convenience for users.</span></span> <span data-ttu-id="e3cf1-210">Elle leur épargne le temps d’attente nécessaire à un aller-retour avec le serveur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-210">It saves time they would otherwise spend waiting for a round trip to the server.</span></span> <span data-ttu-id="e3cf1-211">En termes d’activité de l’entreprise, même de quelques fractions de secondes multipliées des centaines de fois par jour finissent par représenter un temps considérable, auquel s’ajoute un coût et de la frustration.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-211">In business terms, even a few fractions of seconds multiplied hundreds of times each day adds up to be a lot of time, expense, and frustration.</span></span> <span data-ttu-id="e3cf1-212">Une validation directe et immédiate permet aux utilisateurs de travailler plus efficacement, et de produire une meilleure qualité des entrées et des sorties.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-212">Straightforward and immediate validation enables users to work more efficiently and produce better quality input and output.</span></span>

<span data-ttu-id="e3cf1-213">Vous devez disposer d’une vue avec les références de script JavaScript appropriées en place pour que la validation côté client fonctionne comme vous le voyez ici.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-213">You must have a view with the proper JavaScript script references in place for client-side validation to work as you see here.</span></span>

[!code-cshtml[](validation/sample/Views/Shared/_Layout.cshtml?name=snippet_ScriptTag)]

[!code-cshtml[](validation/sample/Views/Shared/_ValidationScriptsPartial.cshtml)]

<span data-ttu-id="e3cf1-214">Le script [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) est une bibliothèque frontale personnalisée de Microsoft qui s’appuie sur le plug-in bien connu [jQuery Validate](https://jqueryvalidation.org/).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-214">The [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive) script is a custom Microsoft front-end library that builds on the popular [jQuery Validate](https://jqueryvalidation.org/) plugin.</span></span> <span data-ttu-id="e3cf1-215">Sans jQuery Unobtrusive Validation, vous devriez coder la même logique de validation à deux endroits : une fois dans les attributs de validation côté serveur sur les propriétés du modèle, puis à nouveau dans les scripts côté client (les exemples de méthode [`validate()`](https://jqueryvalidation.org/validate/) de jQuery Validate montrent combien ceci peut devenir complexe).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-215">Without jQuery Unobtrusive Validation, you would have to code the same validation logic in two places: once in the server side validation attributes on model properties, and then again in client side scripts (the examples for jQuery Validate's [`validate()`](https://jqueryvalidation.org/validate/) method shows how complex this could become).</span></span> <span data-ttu-id="e3cf1-216">Au lieu de cela, les [Tag Helpers](xref:mvc/views/tag-helpers/intro) et les [helpers HTML](xref:mvc/views/overview) peuvent utiliser les attributs de validation et les métadonnées de type des propriétés du modèle pour rendre les [attributs data-](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) HTML 5 dans les éléments de formulaire nécessitant une validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-216">Instead, MVC's [Tag Helpers](xref:mvc/views/tag-helpers/intro) and [HTML helpers](xref:mvc/views/overview) are able to use the validation attributes and type metadata from model properties to render HTML 5 [data- attributes](http://w3c.github.io/html/dom.html#embedding-custom-non-visible-data-with-the-data-attributes) in the form elements that need validation.</span></span> <span data-ttu-id="e3cf1-217">MVC génère les attributs `data-` pour les attributs intégrés et pour les attributs personnalisés.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-217">MVC generates the `data-` attributes for both built-in and custom attributes.</span></span> <span data-ttu-id="e3cf1-218">jQuery Unobtrusive Validation analyse ensuite les attributs `data-` et passe la logique à jQuery Validate, en « copiant » la logique de validation côté serveur vers le client.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-218">jQuery Unobtrusive Validation then parses the `data-` attributes and passes the logic to jQuery Validate, effectively "copying" the server side validation logic to the client.</span></span> <span data-ttu-id="e3cf1-219">Vous pouvez afficher les erreurs de validation sur le client en utilisant les Tag Helpers appropriés, comme indiqué ici :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-219">You can display validation errors on the client using the relevant tag helpers as shown here:</span></span>

[!code-cshtml[](validation/sample/Views/Movies/Create.cshtml?name=snippet_ReleaseDate&highlight=4-5)]

<span data-ttu-id="e3cf1-220">Les Tag Helpers ci-dessus rendent le HTML ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-220">The tag helpers above render the HTML below.</span></span> <span data-ttu-id="e3cf1-221">Notez que les attributs `data-` dans la sortie HTML correspondent aux attributs de validation pour la propriété `ReleaseDate`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-221">Notice that the `data-` attributes in the HTML output correspond to the validation attributes for the `ReleaseDate` property.</span></span> <span data-ttu-id="e3cf1-222">L’attribut `data-val-required` ci-dessous contient un message d’erreur à afficher si l’utilisateur ne renseigne pas le champ correspondant à la date de sortie.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-222">The `data-val-required` attribute below contains an error message to display if the user doesn't fill in the release date field.</span></span> <span data-ttu-id="e3cf1-223">jQuery Unobtrusive Validation passe cette valeur à la méthode [`required()`](https://jqueryvalidation.org/required-method/) de jQuery Validate, qui affiche alors ce message dans l’élément **\<span>** qui l’accompagne.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-223">jQuery Unobtrusive Validation passes this value to the jQuery Validate [`required()`](https://jqueryvalidation.org/required-method/) method, which then displays that message in the accompanying **\<span>** element.</span></span>

```html
<form action="/Movies/Create" method="post">
    <div class="form-horizontal">
        <h4>Movie</h4>
        <div class="text-danger"></div>
        <div class="form-group">
            <label class="col-md-2 control-label" for="ReleaseDate">ReleaseDate</label>
            <div class="col-md-10">
                <input class="form-control" type="datetime"
                data-val="true" data-val-required="The ReleaseDate field is required."
                id="ReleaseDate" name="ReleaseDate" value="" />
                <span class="text-danger field-validation-valid"
                data-valmsg-for="ReleaseDate" data-valmsg-replace="true"></span>
            </div>
        </div>
    </div>
</form>
```

<span data-ttu-id="e3cf1-224">La validation côté client empêche l’envoi jusqu’à ce que le formulaire soit valide.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-224">Client-side validation prevents submission until the form is valid.</span></span> <span data-ttu-id="e3cf1-225">Le bouton Submit exécute le code JavaScript qui envoie le formulaire ou qui affiche des messages d’erreur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-225">The Submit button runs JavaScript that either submits the form or displays error messages.</span></span>

<span data-ttu-id="e3cf1-226">MVC détermine les valeurs d’attribut de type en fonction du type de données .NET d’une propriété, éventuellement remplacé avec des attributs `[DataType]`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-226">MVC determines type attribute values based on the .NET data type of a property, possibly overridden using `[DataType]` attributes.</span></span> <span data-ttu-id="e3cf1-227">L’attribut `[DataType]` de base ne fait pas de validation côté serveur réelle.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-227">The base `[DataType]` attribute does no real server-side validation.</span></span> <span data-ttu-id="e3cf1-228">Les navigateurs choisissent eux-mêmes leurs propres messages d’erreur et affichent ces erreurs ; le package jQuery Unobtrusive Validation peut cependant remplacer les messages et les afficher de façon cohérente avec d’autres messages.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-228">Browsers choose their own error messages and display those errors as they wish, however the jQuery Validation Unobtrusive package can override the messages and display them consistently with others.</span></span> <span data-ttu-id="e3cf1-229">Ceci se produit de façon plus évidente quand des utilisateurs appliquent des sous-classes `[DataType]` comme `[EmailAddress]`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-229">This happens most obviously when users apply `[DataType]` subclasses such as `[EmailAddress]`.</span></span>

### <a name="add-validation-to-dynamic-forms"></a><span data-ttu-id="e3cf1-230">Ajouter une validation à des formulaires dynamiques</span><span class="sxs-lookup"><span data-stu-id="e3cf1-230">Add Validation to Dynamic Forms</span></span>

<span data-ttu-id="e3cf1-231">Comme jQuery Unobtrusive Validation passe la logique et les paramètres de validation à jQuery Validate lors du premier chargement de la page, les formulaires générés dynamiquement ne se présentent pas automatiquement à la validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-231">Because jQuery Unobtrusive Validation passes validation logic and parameters to jQuery Validate when the page first loads, dynamically generated forms won't automatically exhibit validation.</span></span> <span data-ttu-id="e3cf1-232">Au lieu de cela, vous devez indiquer à jQuery Validate d’analyser le formulaire dynamique immédiatement après sa création.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-232">Instead, you must tell jQuery Unobtrusive Validation to parse the dynamic form immediately after creating it.</span></span> <span data-ttu-id="e3cf1-233">Par exemple, le code ci-dessous montre comment vous pouvez configurer la validation côté client sur un formulaire ajouté via AJAX.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-233">For example, the code below shows how you might set up client side validation on a form added via AJAX.</span></span>

```js
$.get({
    url: "https://url/that/returns/a/form",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add form. " + errorThrown);
    },
    success: function(newFormHTML) {
        var container = document.getElementById("form-container");
        container.insertAdjacentHTML("beforeend", newFormHTML);
        var forms = container.getElementsByTagName("form");
        var newForm = forms[forms.length - 1];
        $.validator.unobtrusive.parse(newForm);
    }
})
```

<span data-ttu-id="e3cf1-234">La méthode `$.validator.unobtrusive.parse()` accepte un sélecteur jQuery comme argument.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-234">The `$.validator.unobtrusive.parse()` method accepts a jQuery selector for its one argument.</span></span> <span data-ttu-id="e3cf1-235">Cette méthode indique à jQuery Unobtrusive Validation d’analyser les attributs `data-` des formulaires dans ce sélecteur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-235">This method tells jQuery Unobtrusive Validation to parse the `data-` attributes of forms within that selector.</span></span> <span data-ttu-id="e3cf1-236">Les valeurs de ces attributs sont ensuite passées au plug-in jQuery Validate pour que le formulaire présente les règles de validation souhaitées côté client.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-236">The values of those attributes are then passed to the jQuery Validate plugin so that the form exhibits the desired client side validation rules.</span></span>

### <a name="add-validation-to-dynamic-controls"></a><span data-ttu-id="e3cf1-237">Ajouter une validation à des contrôles dynamiques</span><span class="sxs-lookup"><span data-stu-id="e3cf1-237">Add Validation to Dynamic Controls</span></span>

<span data-ttu-id="e3cf1-238">Vous pouvez aussi mettre à jour les règles de validation sur un formulaire quand des contrôles individuels, comme `<input/>` et `<select/>`, sont générés dynamiquement.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-238">You can also update the validation rules on a form when individual controls, such as `<input/>`s and `<select/>`s, are dynamically generated.</span></span> <span data-ttu-id="e3cf1-239">Vous ne pouvez pas passer de sélecteurs pour ces éléments directement à la méthode `parse()`, car le formulaire entourant a déjà été analysé et ne sera pas mis à jour.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-239">You cannot pass selectors for these elements to the `parse()` method directly because the surrounding form has already been parsed and won't update.</span></span> <span data-ttu-id="e3cf1-240">Au lieu de cela, vous supprimez d’abord les données de validation existantes, puis vous réanalysez tout le formulaire, comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-240">Instead, you first remove the existing validation data, then reparse the entire form, as shown below:</span></span>

```js
$.get({
    url: "https://url/that/returns/a/control",
    dataType: "html",
    error: function(jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": Couldn't add control. " + errorThrown);
    },
    success: function(newInputHTML) {
        var form = document.getElementById("my-form");
        form.insertAdjacentHTML("beforeend", newInputHTML);
        $(form).removeData("validator")    // Added by jQuery Validate
               .removeData("unobtrusiveValidation");   // Added by jQuery Unobtrusive Validation
        $.validator.unobtrusive.parse(form);
    }
})
```

## <a name="iclientmodelvalidator"></a><span data-ttu-id="e3cf1-241">IClientModelValidator</span><span class="sxs-lookup"><span data-stu-id="e3cf1-241">IClientModelValidator</span></span>

<span data-ttu-id="e3cf1-242">Vous pouvez créer une logique côté client pour votre attribut personnalisé, et la [validation discrète](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) qui crée un adaptateur pour la [validation jquery](http://jqueryvalidation.org/documentation/) l’exécute sur le client automatiquement pour vous dans le cadre de la validation.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-242">You may create client side logic for your custom attribute, and [unobtrusive validation](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html) which creates an adapter to [jquery validation](http://jqueryvalidation.org/documentation/) will execute it on the client for you automatically as part of validation.</span></span> <span data-ttu-id="e3cf1-243">La première étape consiste à contrôler quels attributs data- sont ajoutés en implémentant l’interface `IClientModelValidator` comme indiqué ici :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-243">The first step is to control what data- attributes are added by implementing the `IClientModelValidator` interface as shown here:</span></span>

[!code-csharp[](validation/sample/ClassicMovieAttribute.cs?name=snippet_AddValidation)]

<span data-ttu-id="e3cf1-244">Les attributs qui implémentent cette interface peuvent ajouter des attributs HTML aux champs générés.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-244">Attributes that implement this interface can add HTML attributes to generated fields.</span></span> <span data-ttu-id="e3cf1-245">L’examen de la sortie pour l’élément `ReleaseDate` révèle du HTML qui est similaire à l’exemple précédent, excepté qu’il existe maintenant un attribut `data-val-classicmovie` qui a été défini dans la méthode `AddValidation` de `IClientModelValidator`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-245">Examining the output for the `ReleaseDate` element reveals HTML that's similar to the previous example, except now there's a `data-val-classicmovie` attribute that was defined in the `AddValidation` method of `IClientModelValidator`.</span></span>

```html
<input class="form-control" type="datetime"
    data-val="true"
    data-val-classicmovie="Classic movies must have a release year earlier than 1960."
    data-val-classicmovie-year="1960"
    data-val-required="The ReleaseDate field is required."
    id="ReleaseDate" name="ReleaseDate" value="" />
```

<span data-ttu-id="e3cf1-246">La validation discrète utilise les données de l’attribut `data-` pour afficher les messages d’erreur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-246">Unobtrusive validation uses the data in the `data-` attributes to display error messages.</span></span> <span data-ttu-id="e3cf1-247">Cependant, jQuery ne dispose pas des règles ou des messages tant que vous ne les avez pas ajoutés à l’objet `validator` de jQuery.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-247">However, jQuery doesn't know about rules or messages until you add them to jQuery's `validator` object.</span></span> <span data-ttu-id="e3cf1-248">Cela est illustré dans l’exemple suivant, qui ajoute une méthode de validation client `classicmovie` personnalisée pour l’objet `validator` jQuery.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-248">This is shown in the following example, which adds a custom `classicmovie` client validation method to the jQuery `validator` object.</span></span> <span data-ttu-id="e3cf1-249">Pour obtenir une explication de la méthode `unobtrusive.adapters.add`, consultez [Validation client non obstrusive dans ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span><span class="sxs-lookup"><span data-stu-id="e3cf1-249">For an explanation of the `unobtrusive.adapters.add` method, see [Unobtrusive Client Validation in ASP.NET MVC](http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html).</span></span>

[!code-javascript[](validation/sample/Views/Movies/Create.cshtml?name=snippet_UnobtrusiveValidation)]

<span data-ttu-id="e3cf1-250">Avec le code précédent, la méthode `classicmovie` effectue la validation côté client à la date de mise en production du film.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-250">With the preceding code, the `classicmovie` method performs client-side validation on the movie release date.</span></span> <span data-ttu-id="e3cf1-251">Le message d’erreur s’affiche si la méthode retourne `false`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-251">The error message displays if the method returns `false`.</span></span>

## <a name="remote-validation"></a><span data-ttu-id="e3cf1-252">Validation à distance</span><span class="sxs-lookup"><span data-stu-id="e3cf1-252">Remote validation</span></span>

<span data-ttu-id="e3cf1-253">La validation à distance est une fonctionnalité intéressante à utiliser quand vous devez valider des données sur le client relativement à des données présentes sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-253">Remote validation is a great feature to use when you need to validate data on the client against data on the server.</span></span> <span data-ttu-id="e3cf1-254">Par exemple, votre application doit vérifier si une adresse e-mail ou un nom d’utilisateur est déjà utilisé, et elle doit pour cela interroger une grande quantité de données.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-254">For example, your app may need to verify whether an email or user name is already in use, and it must query a large amount of data to do so.</span></span> <span data-ttu-id="e3cf1-255">Le téléchargement de grands jeux de données pour valider un seul champ ou même quelques-uns consomme trop de ressources.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-255">Downloading large sets of data for validating one or a few fields consumes too many resources.</span></span> <span data-ttu-id="e3cf1-256">Il peut également exposer des informations sensibles.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-256">It may also expose sensitive information.</span></span> <span data-ttu-id="e3cf1-257">Une alternative consiste à faire une demande aller-retour pour valider un champ.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-257">An alternative is to make a round-trip request to validate a field.</span></span>

<span data-ttu-id="e3cf1-258">Vous pouvez implémenter une validation à distance selon un processus en deux étapes.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-258">You can implement remote validation in a two step process.</span></span> <span data-ttu-id="e3cf1-259">Vous devez d’abord annoter votre modèle avec l’attribut `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-259">First, you must annotate your model with the `[Remote]` attribute.</span></span> <span data-ttu-id="e3cf1-260">L’attribut `[Remote]` accepte plusieurs surcharges que vous pouvez utiliser pour diriger le code JavaScript côté client vers le code approprié à appeler.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-260">The `[Remote]` attribute accepts multiple overloads you can use to direct client side JavaScript to the appropriate code to call.</span></span> <span data-ttu-id="e3cf1-261">L’exemple ci-dessous pointe vers la méthode d’action `VerifyEmail` du contrôleur `Users`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-261">The example below points to the `VerifyEmail` action method of the `Users` controller.</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserEmailProperty)]

<span data-ttu-id="e3cf1-262">La deuxième étape consiste à placer le code de validation dans la méthode d’action correspondante comme défini dans l’attribut `[Remote]`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-262">The second step is putting the validation code in the corresponding action method as defined in the `[Remote]` attribute.</span></span> <span data-ttu-id="e3cf1-263">Selon la documentation sur la méthode jQuery Validate [distante](https://jqueryvalidation.org/remote-method/), la réponse du serveur doit être une chaîne JSON qui est :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-263">According to the jQuery Validate [remote](https://jqueryvalidation.org/remote-method/) method documentation, the server response must be a JSON string that's either:</span></span>

* <span data-ttu-id="e3cf1-264">`"true"` pour les éléments valides.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-264">`"true"` for valid elements.</span></span>
* <span data-ttu-id="e3cf1-265">`"false"`, `undefined` ou `null` pour les éléments non valides, avec le message d’erreur par défaut.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-265">`"false"`, `undefined`, or `null` for invalid elements, using the default error message.</span></span>

<span data-ttu-id="e3cf1-266">Si la réponse du serveur est une chaîne (par exemple, `"That name is already taken, try peter123 instead"`), la chaîne est affichée comme un message d’erreur personnalisé à la place de la chaîne par défaut.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-266">If the server response is a string (for example, `"That name is already taken, try peter123 instead"`), the string is displayed as a custom error message in place of the default string.</span></span>

<span data-ttu-id="e3cf1-267">La définition de la méthode `VerifyEmail` suit ces règles, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-267">The definition of the `VerifyEmail` method follows these rules, as shown below.</span></span> <span data-ttu-id="e3cf1-268">Elle retourne un message d’erreur de validation si l’adresse e-mail est déjà utilisée ou `true` si l’adresse e-mail est libre, et elle encapsule le résultat dans un objet `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-268">It returns a validation error message if the email is taken, or `true` if the email is free, and wraps the result in a `JsonResult` object.</span></span> <span data-ttu-id="e3cf1-269">Le côté client peut alors utiliser la valeur retournée pour continuer ou afficher l’erreur si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-269">The client side can then use the returned value to proceed or display the error if needed.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyEmail)]

<span data-ttu-id="e3cf1-270">Maintenant, quand les utilisateurs entrent une adresse e-mail, le code JavaScript de la vue effectue un appel à distance pour vérifier si l’e-mail a déjà été utilisé et, le cas échéant, affiche le message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-270">Now when users enter an email, JavaScript in the view makes a remote call to see if that email has been taken and, if so, displays the error message.</span></span> <span data-ttu-id="e3cf1-271">Dans le cas contraire, l’utilisateur peut envoyer le formulaire comme d’habitude.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-271">Otherwise, the user can submit the form as usual.</span></span>

<span data-ttu-id="e3cf1-272">La propriété `AdditionalFields` de l’attribut `[Remote]` est pratique pour valider des combinaisons de champs relativement à des données présentes sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-272">The `AdditionalFields` property of the `[Remote]` attribute is useful for validating combinations of fields against data on the server.</span></span> <span data-ttu-id="e3cf1-273">Par exemple, si le modèle `User` ci-dessus a deux propriétés supplémentaires appelées `FirstName` et `LastName`, vous pouvez vérifier qu’aucun utilisateur existant n’a déjà cette paire de noms.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-273">For example, if the `User` model from above had two additional properties called `FirstName` and `LastName`, you might want to verify that no existing users already have that pair of names.</span></span> <span data-ttu-id="e3cf1-274">Vous définissez les nouvelles propriétés comme indiqué dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-274">You define the new properties as shown in the following code:</span></span>

[!code-csharp[](validation/sample/User.cs?name=snippet_UserNameProperties)]

<span data-ttu-id="e3cf1-275">`AdditionalFields` peut avoir été défini explicitement avec les chaînes `"FirstName"` et `"LastName"`, mais l’utilisation de l’opérateur [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) de cette façon simplifie la refactorisation ultérieure.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-275">`AdditionalFields` could've been set explicitly to the strings `"FirstName"` and `"LastName"`, but using the [`nameof`](/dotnet/csharp/language-reference/keywords/nameof) operator like this simplifies later refactoring.</span></span> <span data-ttu-id="e3cf1-276">La méthode d’action pour effectuer la validation doit alors accepter deux arguments, un pour la valeur de `FirstName` et l’autre pour la valeur de `LastName`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-276">The action method to perform the validation must then accept two arguments, one for the value of `FirstName` and one for the value of `LastName`.</span></span>

[!code-csharp[](validation/sample/UsersController.cs?name=snippet_VerifyName)]

<span data-ttu-id="e3cf1-277">Maintenant, quand des utilisateurs entrent un prénom et un nom, JavaScript :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-277">Now when users enter a first and last name, JavaScript:</span></span>

* <span data-ttu-id="e3cf1-278">Effectue un appel à distance pour vérifier si cette paire de noms est déjà utilisée.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-278">Makes a remote call to see if that pair of names has been taken.</span></span>
* <span data-ttu-id="e3cf1-279">Si la paire est déjà utilisée, un message d’erreur est affiché.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-279">If the pair has been taken, an error message is displayed.</span></span>
* <span data-ttu-id="e3cf1-280">Si elle n’est pas déjà utilisée, l’utilisateur peut envoyer le formulaire.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-280">If not taken, the user can submit the form.</span></span>

<span data-ttu-id="e3cf1-281">Si vous devez valider deux champs supplémentaires ou plus avec l’attribut `[Remote]`, vous les fournissez sous la forme d’une liste délimitée par des virgules.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-281">If you need to validate two or more additional fields with the `[Remote]` attribute, you provide them as a comma-delimited list.</span></span> <span data-ttu-id="e3cf1-282">Par exemple, pour ajouter une propriété `MiddleName` au modèle, définissez l’attribut `[Remote]` comme indiqué dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e3cf1-282">For example, to add a `MiddleName` property to the model, set the `[Remote]` attribute as shown in the following code:</span></span>

```cs
[Remote(action: "VerifyName", controller: "Users", AdditionalFields = nameof(FirstName) + "," + nameof(LastName))]
public string MiddleName { get; set; }
```

<span data-ttu-id="e3cf1-283">`AdditionalFields`, comme tous les arguments d’attribut, doit être une expression constante.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-283">`AdditionalFields`, like all attribute arguments, must be a constant expression.</span></span> <span data-ttu-id="e3cf1-284">Vous ne devez donc pas utiliser une [chaîne interpolée](/dotnet/csharp/language-reference/keywords/interpolated-strings) ou appeler <xref:System.String.Join*> pour initialiser `AdditionalFields`.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-284">Therefore, you must not use an [interpolated string](/dotnet/csharp/language-reference/keywords/interpolated-strings) or call <xref:System.String.Join*> to initialize `AdditionalFields`.</span></span> <span data-ttu-id="e3cf1-285">Pour chaque champ supplémentaire que vous ajoutez à l’attribut `[Remote]`, vous devez ajouter un autre argument à la méthode d’action de contrôleur correspondante.</span><span class="sxs-lookup"><span data-stu-id="e3cf1-285">For every additional field that you add to the `[Remote]` attribute, you must add another argument to the corresponding controller action method.</span></span>
