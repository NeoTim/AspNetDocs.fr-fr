---
title: Hébergement d’ASP.NET Core SignalR production et de mise à l’échelle
author: bradygaster
description: Découvrez comment éviter les performances et la mise à l’échelle des problèmes dans les applications qui utilisent ASP.NET Core SignalR.
monikerRange: '>= aspnetcore-2.1'
ms.author: bradyg
ms.custom: mvc
ms.date: 11/28/2018
uid: signalr/scale
ms.openlocfilehash: 4ac4509acc89d0091a3757c7cfbc9981614f29ad
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57037736"
---
# <a name="aspnet-core-signalr-hosting-and-scaling"></a><span data-ttu-id="f1200-103">Hébergement de ASP.NET Core SignalR et de mise à l’échelle</span><span class="sxs-lookup"><span data-stu-id="f1200-103">ASP.NET Core SignalR hosting and scaling</span></span>

<span data-ttu-id="f1200-104">Par [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), et [Nowak](https://github.com/tdykstra),</span><span class="sxs-lookup"><span data-stu-id="f1200-104">By [Andrew Stanton-Nurse](https://twitter.com/anurse), [Brady Gaster](https://twitter.com/bradygaster), and [Tom Dykstra](https://github.com/tdykstra),</span></span>

<span data-ttu-id="f1200-105">Cet article explique l’hébergement et de mise à l’échelle des considérations pour les applications à trafic élevé qui utilisent ASP.NET Core SignalR.</span><span class="sxs-lookup"><span data-stu-id="f1200-105">This article explains hosting and scaling considerations for high-traffic apps that use ASP.NET Core SignalR.</span></span>

## <a name="tcp-connection-resources"></a><span data-ttu-id="f1200-106">Ressources de connexion TCP</span><span class="sxs-lookup"><span data-stu-id="f1200-106">TCP connection resources</span></span>

<span data-ttu-id="f1200-107">Le nombre de connexions TCP simultanées prenant en charge un serveur web est limité.</span><span class="sxs-lookup"><span data-stu-id="f1200-107">The number of concurrent TCP connections that a web server can support is limited.</span></span> <span data-ttu-id="f1200-108">Les clients HTTP standards utilisent *éphémère* connexions.</span><span class="sxs-lookup"><span data-stu-id="f1200-108">Standard HTTP clients use *ephemeral* connections.</span></span> <span data-ttu-id="f1200-109">Ces connexions peuvent être fermées lorsque le client devient inactif et rouverts ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="f1200-109">These connections can be closed when the client goes idle and reopened later.</span></span> <span data-ttu-id="f1200-110">En revanche, une connexion SignalR est *persistant*.</span><span class="sxs-lookup"><span data-stu-id="f1200-110">On the other hand, a SignalR connection is *persistent*.</span></span> <span data-ttu-id="f1200-111">Les connexions SignalR restent ouverte, même lorsque le client est inactif.</span><span class="sxs-lookup"><span data-stu-id="f1200-111">SignalR connections stay open even when the client goes idle.</span></span> <span data-ttu-id="f1200-112">Dans une application à trafic élevé qui sert de nombreux clients, ces connexions persistantes peuvent entraîner des serveurs atteint son nombre maximal de connexions.</span><span class="sxs-lookup"><span data-stu-id="f1200-112">In a high-traffic app that serves many clients, these persistent connections can cause servers to hit their maximum number of connections.</span></span>

<span data-ttu-id="f1200-113">Connexions persistantes également consomment mémoire supplémentaire, pour effectuer le suivi de chaque connexion.</span><span class="sxs-lookup"><span data-stu-id="f1200-113">Persistent connections also consume some additional memory, to track each connection.</span></span>

<span data-ttu-id="f1200-114">Une utilisation intensive des ressources liées à la connexion par SignalR peut affecter d’autres applications web qui sont hébergées sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="f1200-114">The heavy use of connection-related resources by SignalR can affect other web apps that are hosted on the same server.</span></span> <span data-ttu-id="f1200-115">Lorsque SignalR s’ouvre et le maintient les connexions TCP disponibles dernière, autres applications web sur le même serveur n’ont également aucun davantage de connexions à leur disposition.</span><span class="sxs-lookup"><span data-stu-id="f1200-115">When SignalR opens and holds the last available TCP connections, other web apps on the same server also have no more connections available to them.</span></span>

<span data-ttu-id="f1200-116">Si un serveur manque de connexions, vous verrez les erreurs de socket aléatoire et erreurs de réinitialisation de connexion.</span><span class="sxs-lookup"><span data-stu-id="f1200-116">If a server runs out of connections, you'll see random socket errors and connection reset errors.</span></span> <span data-ttu-id="f1200-117">Exemple :</span><span class="sxs-lookup"><span data-stu-id="f1200-117">For example:</span></span>

```
An attempt was made to access a socket in a way forbidden by its access permissions...
```

<span data-ttu-id="f1200-118">Pour éviter l’utilisation des ressources SignalR et provoquent des erreurs dans d’autres applications web, exécutez SignalR sur différents serveurs à vos autres applications web.</span><span class="sxs-lookup"><span data-stu-id="f1200-118">To keep SignalR resource usage from causing errors in other web apps, run SignalR on different servers than your other web apps.</span></span>

<span data-ttu-id="f1200-119">Pour éviter l’utilisation des ressources SignalR et provoquent des erreurs dans une application de SignalR, monter en charge pour limiter le nombre de connexions à qu'un serveur doit gérer.</span><span class="sxs-lookup"><span data-stu-id="f1200-119">To keep SignalR resource usage from causing errors in a SignalR app, scale out to limit the number of connections a server has to handle.</span></span>

## <a name="scale-out"></a><span data-ttu-id="f1200-120">Monter en charge</span><span class="sxs-lookup"><span data-stu-id="f1200-120">Scale out</span></span>

<span data-ttu-id="f1200-121">Une application qui utilise SignalR doit effectuer le suivi de ses connexions, ce qui crée des problèmes pour une batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="f1200-121">An app that uses SignalR needs to keep track of all its connections, which creates problems for a server farm.</span></span> <span data-ttu-id="f1200-122">Ajouter un serveur, et il obtient de nouvelles connexions qui ne savent pas sur les autres serveurs.</span><span class="sxs-lookup"><span data-stu-id="f1200-122">Add a server, and it gets new connections that the other servers don't know about.</span></span> <span data-ttu-id="f1200-123">Par exemple, les SignalR sur chaque serveur dans le diagramme suivant n’a pas connaissance des connexions sur les autres serveurs.</span><span class="sxs-lookup"><span data-stu-id="f1200-123">For example, SignalR on each server in the following diagram is unaware of the connections on the other servers.</span></span> <span data-ttu-id="f1200-124">Lorsqu’il souhaite SignalR sur l’un des serveurs envoyer un message à tous les clients, le message passe uniquement pour les clients connectés à ce serveur.</span><span class="sxs-lookup"><span data-stu-id="f1200-124">When SignalR on one of the servers wants to send a message to all clients, the message only goes to the clients connected to that server.</span></span>

![Mise à l’échelle de SignalR sans fond de panier](scale/_static/scale-no-backplane.png)

<span data-ttu-id="f1200-126">Les options de résolution de ce problème sont les [Service Azure SignalR](#azure-signalr-service) et [Redis fond de panier](#redis-backplane).</span><span class="sxs-lookup"><span data-stu-id="f1200-126">The options for solving this problem are the [Azure SignalR Service](#azure-signalr-service) and [Redis backplane](#redis-backplane).</span></span>

## <a name="azure-signalr-service"></a><span data-ttu-id="f1200-127">Service Azure SignalR</span><span class="sxs-lookup"><span data-stu-id="f1200-127">Azure SignalR Service</span></span>

<span data-ttu-id="f1200-128">Le Service Azure SignalR est un proxy plutôt que sur un fond de panier.</span><span class="sxs-lookup"><span data-stu-id="f1200-128">The Azure SignalR Service is a proxy rather than a backplane.</span></span> <span data-ttu-id="f1200-129">Chaque fois qu’un client établit une connexion au serveur, le client est redirigé pour vous connecter au service.</span><span class="sxs-lookup"><span data-stu-id="f1200-129">Each time a client initiates a connection to the server, the client is redirected to connect to the service.</span></span> <span data-ttu-id="f1200-130">Ce processus est illustré dans le diagramme suivant :</span><span class="sxs-lookup"><span data-stu-id="f1200-130">That process is illustrated in the following diagram:</span></span>

![L’établissement d’une connexion au Service Azure SignalR](scale/_static/azure-signalr-service-one-connection.png)

<span data-ttu-id="f1200-132">Le résultat est que le service gère toutes les connexions client, tandis que chaque serveur doit uniquement un petit nombre constant de connexions au service, comme illustré dans le diagramme suivant :</span><span class="sxs-lookup"><span data-stu-id="f1200-132">The result is that the service manages all of the client connections, while each server needs only a small constant number of connections to the service, as shown in the following diagram:</span></span>

![Clients connectés au service, les serveurs connectés au service](scale/_static/azure-signalr-service-multiple-connections.png)

<span data-ttu-id="f1200-134">Cette approche de montée en puissance présente plusieurs avantages par rapport à l’alternative de fond de panier de Redis :</span><span class="sxs-lookup"><span data-stu-id="f1200-134">This approach to scale-out has several advantages over the Redis backplane alternative:</span></span>

* <span data-ttu-id="f1200-135">Sessions rémanentes, également appelées [affinité du client](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), n’est pas nécessaire, car les clients sont immédiatement redirigés vers le Service Azure SignalR lorsqu’ils se connectent.</span><span class="sxs-lookup"><span data-stu-id="f1200-135">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is not required, because clients are immediately redirected to the Azure SignalR Service when they connect.</span></span>
* <span data-ttu-id="f1200-136">Une application peut monter en charge de SignalR en fonction du nombre de messages envoyés, tandis que le Service Azure SignalR évolue automatiquement pour gérer n’importe quel nombre de connexions.</span><span class="sxs-lookup"><span data-stu-id="f1200-136">A SignalR app can scale out based on the number of messages sent, while the Azure SignalR Service automatically scales to handle any number of connections.</span></span> <span data-ttu-id="f1200-137">Par exemple, il peut y avoir des milliers de clients, mais si seules quelques messages par seconde sont envoyées, l’application SignalR ne devra pas évoluer vers plusieurs serveurs pour gérer les connexions elles-mêmes.</span><span class="sxs-lookup"><span data-stu-id="f1200-137">For example, there could be thousands of clients, but if only a few messages per second are sent, the SignalR app won't need to scale out to multiple servers just to handle the connections themselves.</span></span>
* <span data-ttu-id="f1200-138">Une application de SignalR n’utiliser beaucoup plus de ressources de connexion à une application web sans SignalR.</span><span class="sxs-lookup"><span data-stu-id="f1200-138">A SignalR app won't use significantly more connection resources than a web app without SignalR.</span></span>

<span data-ttu-id="f1200-139">Pour ces raisons, nous vous recommandons le Service Azure SignalR pour toutes les applications ASP.NET Core SignalR hébergées sur Azure, y compris App Service, les machines virtuelles et les conteneurs.</span><span class="sxs-lookup"><span data-stu-id="f1200-139">For these reasons, we recommend the Azure SignalR Service for all ASP.NET Core SignalR apps hosted on Azure, including App Service, VMs, and containers.</span></span>

<span data-ttu-id="f1200-140">Pour plus d’informations, consultez le [documentation de Service Azure SignalR](/azure/azure-signalr/signalr-overview).</span><span class="sxs-lookup"><span data-stu-id="f1200-140">For more information see the [Azure SignalR Service documentation](/azure/azure-signalr/signalr-overview).</span></span>

## <a name="redis-backplane"></a><span data-ttu-id="f1200-141">Fond de panier Redis</span><span class="sxs-lookup"><span data-stu-id="f1200-141">Redis backplane</span></span>

<span data-ttu-id="f1200-142">[Redis](https://redis.io/) est un magasin clé-valeur en mémoire qui prend en charge un système de messagerie avec un modèle de publication/abonnement.</span><span class="sxs-lookup"><span data-stu-id="f1200-142">[Redis](https://redis.io/) is an in-memory key-value store that supports a messaging system with a publish/subscribe model.</span></span> <span data-ttu-id="f1200-143">Le fond de panier SignalR Redis utilise la fonctionnalité de pub/sub pour transférer des messages vers d’autres serveurs.</span><span class="sxs-lookup"><span data-stu-id="f1200-143">The SignalR Redis backplane uses the pub/sub feature to forward messages to other servers.</span></span> <span data-ttu-id="f1200-144">Lorsqu’un client établit une connexion, les informations de connexion sont passées au fond de panier.</span><span class="sxs-lookup"><span data-stu-id="f1200-144">When a client makes a connection, the connection information is passed to the backplane.</span></span> <span data-ttu-id="f1200-145">Lorsqu’un serveur souhaite envoyer un message à tous les clients, il envoie au fond de panier.</span><span class="sxs-lookup"><span data-stu-id="f1200-145">When a server wants to send a message to all clients, it sends to the backplane.</span></span> <span data-ttu-id="f1200-146">Le fond de panier connaît tous les clients connectés et les serveurs, ils sont sur.</span><span class="sxs-lookup"><span data-stu-id="f1200-146">The backplane knows all connected clients and which servers they're on.</span></span> <span data-ttu-id="f1200-147">Il envoie le message à tous les clients par le biais de leurs serveurs respectifs.</span><span class="sxs-lookup"><span data-stu-id="f1200-147">It sends the message to all clients via their respective servers.</span></span> <span data-ttu-id="f1200-148">Ce processus est illustré dans le diagramme suivant :</span><span class="sxs-lookup"><span data-stu-id="f1200-148">This process is illustrated in the following diagram:</span></span>

![Fond de panier, message envoyé à partir d’un serveur à tous les clients de redis](scale/_static/redis-backplane.png)

<span data-ttu-id="f1200-150">Le fond de panier de Redis est l’approche de montée en puissance recommandée pour les applications hébergées sur votre propre infrastructure.</span><span class="sxs-lookup"><span data-stu-id="f1200-150">The Redis backplane is the recommended scale-out approach for apps hosted on your own infrastructure.</span></span> <span data-ttu-id="f1200-151">Service Azure SignalR n’est pas une option pratique pour la production avec les applications locales en raison de la latence de la connexion entre votre centre de données et un centre de données Azure.</span><span class="sxs-lookup"><span data-stu-id="f1200-151">Azure SignalR Service isn't a practical option for production use with on-premises apps due to connection latency between your data center and an Azure data center.</span></span>

<span data-ttu-id="f1200-152">Les avantages du Service Azure SignalR indiqués précédemment sont inconvénients pour le fond de panier de Redis :</span><span class="sxs-lookup"><span data-stu-id="f1200-152">The Azure SignalR Service advantages noted earlier are disadvantages for the Redis backplane:</span></span>

* <span data-ttu-id="f1200-153">Sessions rémanentes, également appelées [affinité du client](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), est requis.</span><span class="sxs-lookup"><span data-stu-id="f1200-153">Sticky sessions, also known as [client affinity](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing#step-3---configure-client-affinity), is required.</span></span> <span data-ttu-id="f1200-154">Une fois qu’une connexion est initiée sur un serveur, la connexion doit rester sur ce serveur.</span><span class="sxs-lookup"><span data-stu-id="f1200-154">Once a connection is initiated on a server, the connection has to stay on that server.</span></span>
* <span data-ttu-id="f1200-155">Une application de SignalR doit évoluer en fonction du nombre de clients même si certains messages sont envoyés.</span><span class="sxs-lookup"><span data-stu-id="f1200-155">A SignalR app must scale out based on number of clients even if few messages are being sent.</span></span>
* <span data-ttu-id="f1200-156">Une application de SignalR utilise beaucoup plus de ressources de connexion à une application web sans SignalR.</span><span class="sxs-lookup"><span data-stu-id="f1200-156">A SignalR app uses significantly more connection resources than a web app without SignalR.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f1200-157">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f1200-157">Next steps</span></span>

<span data-ttu-id="f1200-158">Pour plus d'informations, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="f1200-158">For more information, see the following resources:</span></span>

* [<span data-ttu-id="f1200-159">Documentation SignalR Service Azure</span><span class="sxs-lookup"><span data-stu-id="f1200-159">Azure SignalR Service documentation</span></span>](/azure/azure-signalr/signalr-overview)
* [<span data-ttu-id="f1200-160">Configurer un fond de panier de Redis</span><span class="sxs-lookup"><span data-stu-id="f1200-160">Set up a Redis backplane</span></span>](xref:signalr/redis-backplane)
