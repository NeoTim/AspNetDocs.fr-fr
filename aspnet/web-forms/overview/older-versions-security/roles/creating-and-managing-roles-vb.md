---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
title: Création et gestion de rôles (VB) | Microsoft Docs
author: rick-anderson
description: Ce didacticiel examine les étapes nécessaires à la configuration de l’infrastructure des rôles. Nous allons ensuite créer des pages Web pour créer et supprimer des rôles.
ms.author: riande
ms.date: 03/24/2008
ms.assetid: 83af9f5f-9a00-4f83-8afc-e98bdd49014e
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-vb
msc.type: authoredcontent
ms.openlocfilehash: 825e2afb750925637d308b7ceb35e1b02b708c1d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74586284"
---
# <a name="creating-and-managing-roles-vb"></a><span data-ttu-id="1fa48-104">Création et gestion de rôles (VB)</span><span class="sxs-lookup"><span data-stu-id="1fa48-104">Creating and Managing Roles (VB)</span></span>

<span data-ttu-id="1fa48-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1fa48-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1fa48-106">[Télécharger le code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) ou [Télécharger le PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="1fa48-106">[Download Code](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.09.zip) or [Download PDF](https://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_vb.pdf)</span></span>

> <span data-ttu-id="1fa48-107">Ce didacticiel examine les étapes nécessaires à la configuration de l’infrastructure des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="1fa48-108">Nous allons ensuite créer des pages Web pour créer et supprimer des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-108">Following that, we will build web pages to create and delete roles.</span></span>

## <a name="introduction"></a><span data-ttu-id="1fa48-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="1fa48-109">Introduction</span></span>

<span data-ttu-id="1fa48-110">Dans le <a id="_msoanchor_1"> </a>didacticiel [*sur l’autorisation basée sur l’utilisateur*](../membership/user-based-authorization-vb.md) , nous avons examiné l’utilisation de l’autorisation d’URL pour restreindre certains utilisateurs d’un ensemble de pages et j’ai exploré les techniques déclaratives et de programmation pour ajuster les fonctionnalités d’une page ASP.net en fonction de l’utilisateur visité.</span><span class="sxs-lookup"><span data-stu-id="1fa48-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="1fa48-111">Toutefois, l’octroi d’autorisations pour l’accès aux pages ou les fonctionnalités utilisateur par utilisateur peut devenir un cauchemar en matière de maintenance dans les scénarios où il existe de nombreux comptes d’utilisateur ou lorsque les privilèges des utilisateurs changent souvent.</span><span class="sxs-lookup"><span data-stu-id="1fa48-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="1fa48-112">À chaque fois qu’un utilisateur obtient ou perd l’autorisation d’effectuer une tâche particulière, l’administrateur doit mettre à jour les règles d’autorisation d’URL appropriées, le balisage déclaratif et le code.</span><span class="sxs-lookup"><span data-stu-id="1fa48-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="1fa48-113">Il permet généralement de classer les utilisateurs en groupes ou *rôles* , puis d’appliquer des autorisations pour chaque rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="1fa48-114">Par exemple, la plupart des applications Web ont un certain ensemble de pages ou de tâches réservées aux utilisateurs administratifs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="1fa48-115">À l’aide des techniques apprises dans le didacticiel *sur les autorisations basées sur l’utilisateur* , nous allons ajouter les règles d’autorisation d’URL appropriées, le balisage déclaratif et le code pour permettre aux comptes d’utilisateur spécifiés d’effectuer des tâches d’administration.</span><span class="sxs-lookup"><span data-stu-id="1fa48-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="1fa48-116">Toutefois, si un nouvel administrateur a été ajouté ou si un administrateur existant devait avoir ses droits d’administration révoqués, nous devrions retourner et mettre à jour les fichiers de configuration et les pages Web.</span><span class="sxs-lookup"><span data-stu-id="1fa48-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="1fa48-117">Toutefois, avec les rôles, nous pourrions créer un rôle nommé administrateurs et affecter ces utilisateurs approuvés au rôle Administrateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="1fa48-118">Ensuite, nous ajoutons les règles d’autorisation d’URL appropriées, le balisage déclaratif et le code pour permettre au rôle Administrateurs d’effectuer les différentes tâches d’administration.</span><span class="sxs-lookup"><span data-stu-id="1fa48-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="1fa48-119">Une fois cette infrastructure en place, l’ajout de nouveaux administrateurs sur le site ou la suppression des administrateurs existants est aussi simple que l’ajout ou la suppression de l’utilisateur du rôle Administrateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="1fa48-120">Aucune configuration, aucune balise déclarative ou modification du code n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="1fa48-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="1fa48-121">ASP.NET offre une infrastructure de rôles permettant de définir des rôles et de les associer à des comptes d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="1fa48-122">Avec l’infrastructure des rôles, nous pouvons créer et supprimer des rôles, ajouter des utilisateurs à un rôle ou en supprimer, déterminer l’ensemble des utilisateurs qui appartiennent à un rôle particulier et savoir si un utilisateur appartient à un rôle particulier.</span><span class="sxs-lookup"><span data-stu-id="1fa48-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="1fa48-123">Une fois l’infrastructure de rôles configurée, nous pouvons limiter l’accès aux pages rôle par rôle par le biais de règles d’autorisation d’URL et afficher ou masquer des informations ou des fonctionnalités supplémentaires sur une page en fonction des rôles de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="1fa48-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="1fa48-124">Ce didacticiel examine les étapes nécessaires à la configuration de l’infrastructure des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="1fa48-125">Nous allons ensuite créer des pages Web pour créer et supprimer des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="1fa48-126">Dans le <a id="_msoanchor_2"> </a>didacticiel [*attribution de rôles aux utilisateurs*](assigning-roles-to-users-vb.md) , nous allons examiner comment ajouter et supprimer des utilisateurs dans des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-vb.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="1fa48-127">Et dans le <a id="_msoanchor_3"> </a>didacticiel sur les [*autorisations basées*](role-based-authorization-vb.md) sur les rôles, nous verrons comment limiter l’accès aux pages rôle par rôle, ainsi que comment ajuster les fonctionnalités de page en fonction du rôle de l’utilisateur visiteur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="1fa48-128">Commençons !</span><span class="sxs-lookup"><span data-stu-id="1fa48-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="1fa48-129">Étape 1 : ajout de nouvelles pages ASP.NET</span><span class="sxs-lookup"><span data-stu-id="1fa48-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="1fa48-130">Dans ce didacticiel et les deux prochaines, nous examinerons les fonctions et fonctionnalités liées aux rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="1fa48-131">Nous aurons besoin d’une série de pages ASP.NET pour implémenter les rubriques examinées dans ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="1fa48-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="1fa48-132">Nous allons créer ces pages et mettre à jour le plan du site.</span><span class="sxs-lookup"><span data-stu-id="1fa48-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="1fa48-133">Commencez par créer un nouveau dossier dans le projet nommé `Roles`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="1fa48-134">Ensuite, ajoutez quatre nouvelles pages ASP.NET au dossier `Roles`, en liant chaque page à la page maître `Site.master`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="1fa48-135">Nommer les pages :</span><span class="sxs-lookup"><span data-stu-id="1fa48-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="1fa48-136">À ce stade, le Explorateur de solutions de votre projet doit ressembler à la capture d’écran illustrée à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="1fa48-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="1fa48-137">[![quatre nouvelles pages ont été ajoutées au dossier Roles](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image2.png)](creating-and-managing-roles-vb/_static/image1.png)</span></span>

<span data-ttu-id="1fa48-138">**Figure 1**: quatre nouvelles pages ont été ajoutées au dossier `Roles` ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image3.png))</span></span>

<span data-ttu-id="1fa48-139">À ce stade, chaque page doit avoir les deux contrôles de contenu, un pour chaque ContentPlaceHolders : `MainContent` et `LoginContent`de la page maître.</span><span class="sxs-lookup"><span data-stu-id="1fa48-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample1.aspx)]

<span data-ttu-id="1fa48-140">N’oubliez pas que le balisage par défaut de `LoginContent` ContentPlaceHolder affiche un lien permettant d’ouvrir une session ou de se déconnecter du site, selon que l’utilisateur est authentifié ou non.</span><span class="sxs-lookup"><span data-stu-id="1fa48-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="1fa48-141">La présence du contrôle de contenu `Content2` dans la page ASP.NET, cependant, remplace le balisage par défaut de la page maître.</span><span class="sxs-lookup"><span data-stu-id="1fa48-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="1fa48-142">Comme nous l’avons <a id="_msoanchor_4"> </a>vu dans [*une vue d’ensemble du didacticiel sur l’authentification par formulaire*](../introduction/an-overview-of-forms-authentication-vb.md) , le remplacement du balisage par défaut est utile dans les pages où vous ne souhaitez pas afficher les options relatives à la connexion dans la colonne de gauche.</span><span class="sxs-lookup"><span data-stu-id="1fa48-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="1fa48-143">Toutefois, pour ces quatre pages, nous souhaitons afficher le balisage par défaut de la page maître pour le `LoginContent` ContentPlaceHolder.</span><span class="sxs-lookup"><span data-stu-id="1fa48-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="1fa48-144">Par conséquent, supprimez le balisage déclaratif pour le contrôle de contenu `Content2`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="1fa48-145">Après cela, chaque balisage de la page en quatre pages ne doit contenir qu’un seul contrôle de contenu.</span><span class="sxs-lookup"><span data-stu-id="1fa48-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="1fa48-146">Enfin, nous allons mettre à jour le plan de site (`Web.sitemap`) pour inclure ces nouvelles pages Web.</span><span class="sxs-lookup"><span data-stu-id="1fa48-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="1fa48-147">Ajoutez le code XML suivant après le `<siteMapNode>` que nous avons ajouté pour les didacticiels d’adhésion.</span><span class="sxs-lookup"><span data-stu-id="1fa48-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample2.xml)]

<span data-ttu-id="1fa48-148">Une fois le plan de site mis à jour, accédez au site via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="1fa48-149">Comme le montre la figure 2, la navigation à gauche comprend désormais des éléments pour les didacticiels de rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>

<span data-ttu-id="1fa48-150">[![quatre nouvelles pages ont été ajoutées au dossier Roles](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-vb/_static/image5.png)](creating-and-managing-roles-vb/_static/image4.png)</span></span>

<span data-ttu-id="1fa48-151">**Figure 2**: quatre nouvelles pages ont été ajoutées au dossier `Roles` ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image6.png))</span></span>

## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="1fa48-152">Étape 2 : spécification et configuration du fournisseur de l’infrastructure des rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="1fa48-153">À l’instar de l’infrastructure d’appartenance, l’infrastructure de rôles est générée au-dessus du modèle de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="1fa48-154">Comme indiqué dans le <a id="_msoanchor_5"> </a>didacticiel sur la [*sécurité et la prise en charge ASP.net*](../introduction/security-basics-and-asp-net-support-vb.md) , le .NET Framework est fourni avec trois fournisseurs de rôles intégrés : [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)et [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fa48-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-vb.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="1fa48-155">Cette série de didacticiels se concentre sur le `SqlRoleProvider`, qui utilise une base de données Microsoft SQL Server comme magasin de rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="1fa48-156">Sous le couvre l’infrastructure des rôles et `SqlRoleProvider` fonctionnent comme l’infrastructure d’appartenance et les `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="1fa48-157">Le .NET Framework contient une classe `Roles` qui sert d’API à l’infrastructure des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="1fa48-158">La classe `Roles` a des méthodes partagées comme `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="1fa48-158">The `Roles` class has shared methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="1fa48-159">Quand l’une de ces méthodes est appelée, la classe `Roles` délègue l’appel au fournisseur configuré.</span><span class="sxs-lookup"><span data-stu-id="1fa48-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="1fa48-160">Le `SqlRoleProvider` fonctionne avec les tables spécifiques aux rôles (`aspnet_Roles` et `aspnet_UsersInRoles`) en réponse.</span><span class="sxs-lookup"><span data-stu-id="1fa48-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="1fa48-161">Pour pouvoir utiliser le fournisseur de `SqlRoleProvider` dans notre application, nous devons spécifier la base de données à utiliser comme magasin.</span><span class="sxs-lookup"><span data-stu-id="1fa48-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="1fa48-162">Le `SqlRoleProvider` s’attend à ce que le magasin de rôles spécifié dispose de certaines tables de base de données, vues et procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="1fa48-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="1fa48-163">Ces objets de base de données nécessaires peuvent être ajoutés à l’aide de l' [outil`aspnet_regsql.exe`](https://msdn.microsoft.com/library/ms229862.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fa48-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="1fa48-164">À ce stade, nous avons déjà une base de données avec le schéma nécessaire à la `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="1fa48-165">De retour dans <a id="_msoanchor_6"> </a>le didacticiel [*création du schéma d’appartenance dans SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) , nous avons créé une base de données nommée `SecurityTutorials.mdf` et utilisé `aspnet_regsql.exe` pour ajouter les services d’application, qui comprenaient les objets de base de données requis par le `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="1fa48-166">Par conséquent, nous devons simplement indiquer à l’infrastructure des rôles d’activer la prise en charge des rôles et d’utiliser le `SqlRoleProvider` avec la base de données `SecurityTutorials.mdf` comme magasin de rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="1fa48-167">L’infrastructure de rôles est configurée via l’élément `<roleManager>` dans le fichier `Web.config` de l’application.</span><span class="sxs-lookup"><span data-stu-id="1fa48-167">The Roles framework is configured via the `<roleManager>` element in the application's `Web.config` file.</span></span> <span data-ttu-id="1fa48-168">Par défaut, la prise en charge des rôles est désactivée.</span><span class="sxs-lookup"><span data-stu-id="1fa48-168">By default, role support is disabled.</span></span> <span data-ttu-id="1fa48-169">Pour l’activer, vous devez définir l’attribut `enabled` de l’élément [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) sur `true` comme suit :</span><span class="sxs-lookup"><span data-stu-id="1fa48-169">To enable it, you must set the [`<roleManager>`](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample3.xml)]

<span data-ttu-id="1fa48-170">Par défaut, toutes les applications Web ont un fournisseur de rôles nommé `AspNetSqlRoleProvider` de type `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="1fa48-171">Ce fournisseur par défaut est inscrit dans `machine.config` (situé dans `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`) :</span><span class="sxs-lookup"><span data-stu-id="1fa48-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample4.xml)]

<span data-ttu-id="1fa48-172">L’attribut `connectionStringName` du fournisseur spécifie le magasin de rôles utilisé.</span><span class="sxs-lookup"><span data-stu-id="1fa48-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="1fa48-173">Le fournisseur `AspNetSqlRoleProvider` définit cet attribut sur `LocalSqlServer`, qui est également défini dans `machine.config` et points, par défaut, dans une base de données SQL Server 2005 Express Edition dans le dossier `App_Data` nommé `aspnet.mdf`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="1fa48-174">Par conséquent, si nous activons simplement l’infrastructure Roles sans spécifier d’informations de fournisseur dans le fichier de `Web.config` de l’application, l’application utilise le fournisseur de rôles inscrits par défaut, `AspNetSqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="1fa48-175">Si la base de données `~/App_Data/aspnet.mdf` n’existe pas, le runtime ASP.NET le crée automatiquement et ajoute le schéma des services d’application.</span><span class="sxs-lookup"><span data-stu-id="1fa48-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="1fa48-176">Toutefois, nous ne souhaitons pas utiliser la base de données `aspnet.mdf` ; au lieu de cela, nous souhaitons utiliser la base de données `SecurityTutorials.mdf` que nous avons déjà créée et auquel vous avez ajouté le schéma des services d’application.</span><span class="sxs-lookup"><span data-stu-id="1fa48-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="1fa48-177">Cette modification peut être effectuée de deux manières :</span><span class="sxs-lookup"><span data-stu-id="1fa48-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="1fa48-178"><strong>Spécifiez une valeur pour le</strong> nom de la chaîne de connexion<strong>`LocalSqlServer`</strong> <strong>dans</strong> <strong>`Web.config`</strong> <strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="1fa48-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="1fa48-179">En remplaçant la valeur de nom de la chaîne de connexion `LocalSqlServer` dans `Web.config`, nous pouvons utiliser le fournisseur de rôles inscrits par défaut (`AspNetSqlRoleProvider`) et le faire fonctionner correctement avec la base de données `SecurityTutorials.mdf`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="1fa48-180">Pour plus d’informations sur cette technique, consultez le billet de blog de [Scott Guthrie](https://weblogs.asp.net/scottgu/), [configuring ASP.NET 2,0 Services d’application to use SQL Server 2000 ou SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fa48-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="1fa48-181"><strong>Ajoutez un nouveau fournisseur inscrit de type</strong> <strong>`SqlRoleProvider`</strong> <strong>et configurez son</strong> paramètre<strong>`connectionStringName`</strong> <strong>pour qu’il pointe vers la</strong> <strong>base de données</strong> <strong>`SecurityTutorials.mdf`</strong>.</span><span class="sxs-lookup"><span data-stu-id="1fa48-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="1fa48-182">Il s’agit de l’approche recommandée et utilisée dans <a id="_msoanchor_7"> </a>le didacticiel [*création du schéma d’appartenance dans SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) . il s’agit également de l’approche que je vais utiliser dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="1fa48-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="1fa48-183">Ajoutez la balise de configuration des rôles suivante au fichier `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="1fa48-184">Ce balisage inscrit un nouveau fournisseur nommé `SecurityTutorialsSqlRoleProvider.`</span><span class="sxs-lookup"><span data-stu-id="1fa48-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider.`</span></span>

[!code-xml[Main](creating-and-managing-roles-vb/samples/sample5.xml)]

<span data-ttu-id="1fa48-185">Le balisage ci-dessus définit le `SecurityTutorialsSqlRoleProvider` comme fournisseur par défaut (via l’attribut `defaultProvider` dans l’élément `<roleManager>`).</span><span class="sxs-lookup"><span data-stu-id="1fa48-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="1fa48-186">Il définit également le paramètre de `applicationName` de l' `SecurityTutorialsSqlRoleProvider`sur `SecurityTutorials`, qui est le même paramètre de `applicationName` utilisé par le fournisseur d’appartenances (`SecurityTutorialsSqlMembershipProvider`).</span><span class="sxs-lookup"><span data-stu-id="1fa48-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="1fa48-187">Bien que cela ne soit pas illustré ici, l' [élément`<add>`](https://msdn.microsoft.com/library/ms164662.aspx) de la `SqlRoleProvider` peut également contenir un attribut `commandTimeout` pour spécifier la durée du délai d’expiration de la base de données, en secondes.</span><span class="sxs-lookup"><span data-stu-id="1fa48-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="1fa48-188">La valeur par défaut est 30.</span><span class="sxs-lookup"><span data-stu-id="1fa48-188">The default value is 30.</span></span>

<span data-ttu-id="1fa48-189">Avec ce balisage de configuration en place, nous sommes prêts à commencer à utiliser les fonctionnalités de rôle dans notre application.</span><span class="sxs-lookup"><span data-stu-id="1fa48-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="1fa48-190">Le balisage de configuration ci-dessus illustre l’utilisation des attributs `enabled` et `defaultProvider` de l’élément `<roleManager>`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-190">The above configuration markup illustrates using the `<roleManager>` element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="1fa48-191">Il existe un certain nombre d’autres attributs qui affectent la façon dont l’infrastructure de rôles associe les informations de rôle à chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="1fa48-192">Nous examinerons ces paramètres dans le <a id="_msoanchor_8"> </a>didacticiel [*sur les autorisations basées sur les rôles*](role-based-authorization-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="1fa48-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial.</span></span>

## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="1fa48-193">Étape 3 : examen de l’API des rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="1fa48-194">La fonctionnalité de l’infrastructure Roles est exposée via la [classe`Roles`](https://msdn.microsoft.com/library/system.web.security.roles.aspx), qui contient treize méthodes partagées pour effectuer des opérations basées sur les rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen shared methods for performing role-based operations.</span></span> <span data-ttu-id="1fa48-195">Lorsque nous examinons la création et la suppression de rôles dans les étapes 4 et 6, nous allons utiliser les méthodes [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) et [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) , qui ajoutent ou suppriment un rôle du système.</span><span class="sxs-lookup"><span data-stu-id="1fa48-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="1fa48-196">Pour obtenir la liste de tous les rôles dans le système, utilisez la [méthode`GetAllRoles`](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (Voir l’étape 5).</span><span class="sxs-lookup"><span data-stu-id="1fa48-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="1fa48-197">La [méthode`RoleExists`](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) retourne une valeur booléenne indiquant si un rôle spécifié existe.</span><span class="sxs-lookup"><span data-stu-id="1fa48-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="1fa48-198">Dans le didacticiel suivant, nous allons examiner comment associer des utilisateurs à des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="1fa48-199">Les méthodes [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)et [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) de la classe `Roles` ajouter un ou plusieurs utilisateurs à un ou plusieurs rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="1fa48-200">Pour supprimer des utilisateurs des rôles, utilisez les méthodes [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)ou [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) .</span><span class="sxs-lookup"><span data-stu-id="1fa48-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="1fa48-201">Dans le <a id="_msoanchor_9"> </a>didacticiel [*sur l’autorisation basée*](role-based-authorization-vb.md) sur les rôles, nous allons examiner les différentes façons d’afficher ou de masquer des fonctionnalités en fonction du rôle de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="1fa48-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-vb.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="1fa48-202">Pour ce faire, nous pouvons utiliser les méthodes [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)ou [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) de la classe de rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-202">To accomplish this, we can use the Role class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="1fa48-203">N’oubliez pas que chaque fois que l’une de ces méthodes est appelée, la classe `Roles` délègue l’appel au fournisseur configuré.</span><span class="sxs-lookup"><span data-stu-id="1fa48-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="1fa48-204">Dans notre cas, cela signifie que l’appel est envoyé au `SqlRoleProvider`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="1fa48-205">L' `SqlRoleProvider` effectue ensuite l’opération de base de données appropriée en fonction de la méthode appelée.</span><span class="sxs-lookup"><span data-stu-id="1fa48-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="1fa48-206">Par exemple, le code `Roles.CreateRole("Administrators")` produit l' `SqlRoleProvider` exécutant la procédure stockée `aspnet_Roles_CreateRole`, qui insère un nouvel enregistrement dans la table `aspnet_Roles` nommée administrateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>

<span data-ttu-id="1fa48-207">Le reste de ce didacticiel se penche sur l’utilisation des méthodes de `CreateRole`, `GetAllRoles`et `DeleteRole` de la classe `Roles` pour gérer les rôles dans le système.</span><span class="sxs-lookup"><span data-stu-id="1fa48-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="1fa48-208">Étape 4 : création de nouveaux rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="1fa48-209">Les rôles offrent un moyen de regrouper arbitrairement les utilisateurs et, le plus souvent, ce regroupement est utilisé pour un moyen plus pratique d’appliquer des règles d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="1fa48-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="1fa48-210">Toutefois, pour pouvoir utiliser des rôles en tant que mécanisme d’autorisation, nous devons tout d’abord définir les rôles qui existent dans l’application.</span><span class="sxs-lookup"><span data-stu-id="1fa48-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="1fa48-211">Malheureusement, ASP.NET n’inclut pas de contrôle CreateRoleWizard.</span><span class="sxs-lookup"><span data-stu-id="1fa48-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="1fa48-212">Afin d’ajouter de nouveaux rôles, nous devons créer une interface utilisateur appropriée et appeler l’API Roles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="1fa48-213">La bonne nouvelle, c’est que cela est très facile à accomplir.</span><span class="sxs-lookup"><span data-stu-id="1fa48-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="1fa48-214">Bien qu’il n’existe aucun contrôle Web CreateRoleWizard, il existe l' [outil d’administration de site web ASP.net](https://msdn.microsoft.com/library/ms228053.aspx), qui est une application ASP.net locale conçue pour faciliter l’affichage et la gestion de la configuration de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="1fa48-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="1fa48-215">Toutefois, je ne suis pas un grand fan de l’outil d’administration de site Web ASP.NET pour deux raisons.</span><span class="sxs-lookup"><span data-stu-id="1fa48-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="1fa48-216">Tout d’abord, il s’agit d’un bogue de bits et l’expérience utilisateur laisse beaucoup à désirer.</span><span class="sxs-lookup"><span data-stu-id="1fa48-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="1fa48-217">Deuxièmement, l’outil Administration de site Web ASP.NET est conçu pour fonctionner uniquement localement, ce qui signifie que vous devrez créer vos propres pages Web de gestion des rôles si vous avez besoin de gérer des rôles sur un site actif à distance.</span><span class="sxs-lookup"><span data-stu-id="1fa48-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="1fa48-218">Pour ces deux raisons, ce didacticiel et la suivante s’intéressent à la création des outils de gestion des rôles nécessaires dans une page Web au lieu de s’appuyer sur l’outil d’administration de site Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="1fa48-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>

<span data-ttu-id="1fa48-219">Ouvrez la page `ManageRoles.aspx` dans le dossier `Roles` et ajoutez une zone de texte et un contrôle Web Button à la page.</span><span class="sxs-lookup"><span data-stu-id="1fa48-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="1fa48-220">Définissez la propriété `ID` du contrôle TextBox sur `RoleName` et les propriétés `ID` et `Text` du bouton sur `CreateRoleButton` et créer un rôle, respectivement.</span><span class="sxs-lookup"><span data-stu-id="1fa48-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="1fa48-221">À ce stade, le balisage déclaratif de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="1fa48-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample6.aspx)]

<span data-ttu-id="1fa48-222">Ensuite, double-cliquez sur le contrôle bouton `CreateRoleButton` dans le concepteur pour créer un gestionnaire d’événements `Click`, puis ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="1fa48-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample7.vb)]

<span data-ttu-id="1fa48-223">Le code ci-dessus commence par attribuer le nom de rôle conformé entré dans la zone de texte `RoleName` à la variable `newRoleName`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="1fa48-224">Ensuite, la méthode `RoleExists` de la classe `Roles` est appelée pour déterminer si le rôle `newRoleName` existe déjà dans le système.</span><span class="sxs-lookup"><span data-stu-id="1fa48-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="1fa48-225">Si le rôle n’existe pas, il est créé via un appel à la méthode `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="1fa48-226">Si un nom de rôle qui existe déjà dans le système est passé à la méthode `CreateRole`, une exception `ProviderException` est levée.</span><span class="sxs-lookup"><span data-stu-id="1fa48-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="1fa48-227">C’est la raison pour laquelle le code vérifie d’abord si le rôle n’existe pas déjà dans le système avant d’appeler `CreateRole`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="1fa48-228">Le gestionnaire d’événements `Click` se termine en effaçant la propriété `Text` de la zone de texte `RoleName`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="1fa48-229">Vous vous demandez peut-être ce qui se produit si l’utilisateur n’entre aucune valeur dans la zone de texte `RoleName`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="1fa48-230">Si la valeur passée dans la méthode `CreateRole` est `Nothing` ou une chaîne vide, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="1fa48-230">If the value passed into the `CreateRole` method is `Nothing` or an empty string, an exception is raised.</span></span> <span data-ttu-id="1fa48-231">De même, si le nom de rôle contient une virgule, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="1fa48-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="1fa48-232">Par conséquent, la page doit contenir des contrôles de validation pour s’assurer que l’utilisateur entre un rôle et qu’il ne contient pas de virgule.</span><span class="sxs-lookup"><span data-stu-id="1fa48-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="1fa48-233">Je laisse un exercice pour le lecteur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-233">I leave as an exercise for the reader.</span></span>

<span data-ttu-id="1fa48-234">Créons un rôle nommé administrateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="1fa48-235">Accédez à la page de `ManageRoles.aspx` via un navigateur, tapez administrateurs dans la zone de texte (voir figure 3), puis cliquez sur le bouton créer un rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>

<span data-ttu-id="1fa48-236">[![créer un rôle Administrateurs](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-236">[![Create an Administrators Role](creating-and-managing-roles-vb/_static/image8.png)](creating-and-managing-roles-vb/_static/image7.png)</span></span>

<span data-ttu-id="1fa48-237">**Figure 3**: créer un rôle Administrateurs ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image9.png))</span></span>

<span data-ttu-id="1fa48-238">Ce qui se produit</span><span class="sxs-lookup"><span data-stu-id="1fa48-238">What happens?</span></span> <span data-ttu-id="1fa48-239">Une publication (postback) se produit, mais il n’existe aucun signal visuel indiquant que le rôle a réellement été ajouté au système.</span><span class="sxs-lookup"><span data-stu-id="1fa48-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="1fa48-240">Nous mettrons à jour cette page à l’étape 5 pour inclure des commentaires visuels.</span><span class="sxs-lookup"><span data-stu-id="1fa48-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="1fa48-241">Pour l’instant, toutefois, vous pouvez vérifier que le rôle a été créé en accédant à la base de données `SecurityTutorials.mdf` et en affichant les données de la table `aspnet_Roles`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="1fa48-242">Comme le montre la figure 4, la table `aspnet_Roles` contient un enregistrement pour les rôles administrateurs juste ajoutés.</span><span class="sxs-lookup"><span data-stu-id="1fa48-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>

<span data-ttu-id="1fa48-243">[![la table aspnet_Roles contient une ligne pour les administrateurs](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-vb/_static/image11.png)](creating-and-managing-roles-vb/_static/image10.png)</span></span>

<span data-ttu-id="1fa48-244">**Figure 4**: la table `aspnet_Roles` contient une ligne pour les administrateurs ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image12.png))</span></span>

## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="1fa48-245">Étape 5 : affichage des rôles dans le système</span><span class="sxs-lookup"><span data-stu-id="1fa48-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="1fa48-246">Ajoutons la page `ManageRoles.aspx` pour inclure une liste des rôles actuels dans le système.</span><span class="sxs-lookup"><span data-stu-id="1fa48-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="1fa48-247">Pour ce faire, ajoutez un contrôle GridView à la page et affectez à sa propriété `ID` la valeur `RoleList`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="1fa48-248">Ensuite, ajoutez une méthode à la classe code-behind de la page nommée `DisplayRolesInGrid` à l’aide du code suivant :</span><span class="sxs-lookup"><span data-stu-id="1fa48-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample8.vb)]

<span data-ttu-id="1fa48-249">La méthode `GetAllRoles` de la classe `Roles` retourne tous les rôles du système sous la forme d’un tableau de chaînes.</span><span class="sxs-lookup"><span data-stu-id="1fa48-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="1fa48-250">Ce tableau de chaînes est ensuite lié au GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="1fa48-251">Pour lier la liste de rôles au contrôle GridView lorsque la page est chargée pour la première fois, vous devez appeler la méthode `DisplayRolesInGrid` à partir du gestionnaire d’événements `Page_Load` de la page.</span><span class="sxs-lookup"><span data-stu-id="1fa48-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="1fa48-252">Le code suivant appelle cette méthode lorsque la page est visitée pour la première fois, mais pas lors des publications (postbacks) suivantes.</span><span class="sxs-lookup"><span data-stu-id="1fa48-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample9.vb)]

<span data-ttu-id="1fa48-253">Une fois ce code en place, accédez à la page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="1fa48-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="1fa48-254">Comme le montre la figure 5, vous devriez voir une grille avec une seule colonne étiquetée élément.</span><span class="sxs-lookup"><span data-stu-id="1fa48-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="1fa48-255">La grille comprend une ligne pour le rôle administrateurs que nous avons ajouté à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="1fa48-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>

<span data-ttu-id="1fa48-256">[![le contrôle GridView affiche les rôles dans une seule colonne](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-vb/_static/image14.png)](creating-and-managing-roles-vb/_static/image13.png)</span></span>

<span data-ttu-id="1fa48-257">**Figure 5**: le contrôle GridView affiche les rôles dans une seule colonne ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image15.png))</span></span>

<span data-ttu-id="1fa48-258">Le contrôle GridView affiche une colonne solitaire étiquetée Item, car la propriété `AutoGenerateColumns` de GridView a la valeur true (valeur par défaut), ce qui amène le GridView à créer automatiquement une colonne pour chaque propriété de son `DataSource`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="1fa48-259">Un tableau a une propriété unique qui représente les éléments dans le tableau, donc la colonne unique dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="1fa48-260">Quand vous affichez des données avec un GridView, je préfère définir des colonnes de manière explicite au lieu de les générer implicitement par le GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="1fa48-261">En définissant explicitement les colonnes, il est beaucoup plus facile de mettre en forme les données, de réorganiser les colonnes et d’effectuer d’autres tâches courantes.</span><span class="sxs-lookup"><span data-stu-id="1fa48-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="1fa48-262">Par conséquent, nous allons mettre à jour le balisage déclaratif de GridView afin que ses colonnes soient définies explicitement.</span><span class="sxs-lookup"><span data-stu-id="1fa48-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="1fa48-263">Commencez par affecter la valeur false à la propriété `AutoGenerateColumns` de GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="1fa48-264">Ensuite, ajoutez un TemplateField à la grille, affectez à sa propriété `HeaderText` la valeur Roles, puis configurez son `ItemTemplate` afin qu’il affiche le contenu du tableau.</span><span class="sxs-lookup"><span data-stu-id="1fa48-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="1fa48-265">Pour ce faire, ajoutez un contrôle Web Label nommé `RoleNameLabel` au `ItemTemplate` et liez sa propriété `Text` à `Container.DataItem.`</span><span class="sxs-lookup"><span data-stu-id="1fa48-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem.`</span></span>

<span data-ttu-id="1fa48-266">Ces propriétés et le contenu de `ItemTemplate`peuvent être définis de façon déclarative ou par le biais de la boîte de dialogue champs de GridView et de l’interface de modification des modèles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="1fa48-267">Pour accéder à la boîte de dialogue champs, cliquez sur le lien modifier les colonnes dans la balise active de GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="1fa48-268">Ensuite, désactivez la case à cocher générer automatiquement les champs pour affecter à la propriété `AutoGenerateColumns` la valeur false et ajoutez un TemplateField au GridView, en affectant à sa propriété `HeaderText` la valeur role.</span><span class="sxs-lookup"><span data-stu-id="1fa48-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="1fa48-269">Pour définir le contenu de `ItemTemplate`, choisissez l’option modifier les modèles à partir de la balise active de GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="1fa48-270">Faites glisser un contrôle Web Label sur le `ItemTemplate`, définissez sa propriété `ID` sur `RoleNameLabel`et configurez ses paramètres DataBinding afin que sa propriété `Text` soit liée à `Container.DataItem`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="1fa48-271">Quelle que soit l’approche que vous utilisez, le balisage déclaratif résultant de GridView doit ressembler à ce qui suit lorsque vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="1fa48-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="1fa48-272">Le contenu du tableau est affiché à l’aide de la syntaxe DataBinding `<%# Container.DataItem %>`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="1fa48-273">Une description détaillée de la raison pour laquelle cette syntaxe est utilisée lors de l’affichage du contenu d’un tableau lié au GridView dépasse le cadre de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="1fa48-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="1fa48-274">Pour plus d’informations sur ce sujet, reportez-vous à la rubrique [liaison d’un tableau scalaire à un contrôle Web de données](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fa48-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="1fa48-275">Actuellement, le `RoleList` GridView est lié uniquement à la liste des rôles lorsque la page est visitée pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="1fa48-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="1fa48-276">Nous devons actualiser la grille chaque fois qu’un nouveau rôle est ajouté.</span><span class="sxs-lookup"><span data-stu-id="1fa48-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="1fa48-277">Pour ce faire, mettez à jour le gestionnaire d’événements `Click` du bouton `CreateRoleButton` afin qu’il appelle la méthode `DisplayRolesInGrid` si un nouveau rôle est créé.</span><span class="sxs-lookup"><span data-stu-id="1fa48-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample11.vb)]

<span data-ttu-id="1fa48-278">Désormais, lorsque l’utilisateur ajoute un nouveau rôle, le `RoleList` GridView affiche le rôle qui vient d’être ajouté lors de la publication, ce qui fournit des commentaires visuels indiquant que le rôle a été créé avec succès.</span><span class="sxs-lookup"><span data-stu-id="1fa48-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="1fa48-279">Pour illustrer cela, accédez à la page `ManageRoles.aspx` via un navigateur et ajoutez un rôle nommé superviseurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="1fa48-280">Quand vous cliquez sur le bouton créer un rôle, une publication s’affiche et la grille est mise à jour pour inclure les administrateurs ainsi que le nouveau rôle, les superviseurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>

<span data-ttu-id="1fa48-281">[![le rôle superviseurs a été ajouté](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-vb/_static/image17.png)](creating-and-managing-roles-vb/_static/image16.png)</span></span>

<span data-ttu-id="1fa48-282">**Figure 6**: le rôle superviseurs a été ajouté ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image18.png))</span></span>

## <a name="step-6-deleting-roles"></a><span data-ttu-id="1fa48-283">Étape 6 : suppression des rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="1fa48-284">À ce stade, un utilisateur peut créer un nouveau rôle et afficher tous les rôles existants à partir de la page `ManageRoles.aspx`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="1fa48-285">Permettez aux utilisateurs de supprimer également des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="1fa48-286">La méthode `Roles.DeleteRole` a deux surcharges :</span><span class="sxs-lookup"><span data-stu-id="1fa48-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="1fa48-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) : supprime *le rôle de*rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="1fa48-288">Une exception est levée si le rôle contient un ou plusieurs membres.</span><span class="sxs-lookup"><span data-stu-id="1fa48-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="1fa48-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) : supprime *le rôle de*rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="1fa48-290">Si *throwOnPopulateRole* est `True`, une exception est levée si le rôle contient un ou plusieurs membres.</span><span class="sxs-lookup"><span data-stu-id="1fa48-290">If *throwOnPopulateRole* is `True`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="1fa48-291">Si *throwOnPopulateRole* est `False`, le rôle est supprimé, qu’il contienne ou non des membres.</span><span class="sxs-lookup"><span data-stu-id="1fa48-291">If *throwOnPopulateRole* is `False`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="1fa48-292">En interne, la méthode `DeleteRole(roleName)` appelle `DeleteRole(roleName, True)`.</span><span class="sxs-lookup"><span data-stu-id="1fa48-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, True)`.</span></span>

<span data-ttu-id="1fa48-293">La méthode `DeleteRole` lèvera également une exception si *roleName* est `Nothing` ou une chaîne vide, ou si *roleName* contient une virgule.</span><span class="sxs-lookup"><span data-stu-id="1fa48-293">The `DeleteRole` method will also throw an exception if *roleName* is `Nothing` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="1fa48-294">Si *roleName* n’existe pas dans le système, `DeleteRole` échoue en mode silencieux, sans lever d’exception.</span><span class="sxs-lookup"><span data-stu-id="1fa48-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="1fa48-295">Ajoutons le contrôle GridView dans `ManageRoles.aspx` pour inclure un bouton supprimer qui, lorsque vous cliquez dessus, supprime le rôle sélectionné.</span><span class="sxs-lookup"><span data-stu-id="1fa48-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="1fa48-296">Commencez par ajouter un bouton Supprimer au contrôle GridView en accédant à la boîte de dialogue champs et en ajoutant un bouton supprimer, situé sous l’option CommandField.</span><span class="sxs-lookup"><span data-stu-id="1fa48-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="1fa48-297">Faites du bouton supprimer la colonne la plus à gauche et définissez sa propriété `DeleteText` sur supprimer le rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>

<span data-ttu-id="1fa48-298">[![ajouter un bouton Supprimer au GridView RoleList](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="1fa48-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-vb/_static/image20.png)](creating-and-managing-roles-vb/_static/image19.png)</span></span>

<span data-ttu-id="1fa48-299">**Figure 7**: ajouter un bouton supprimer au `RoleList` GridView ([cliquez pour afficher l’image en taille réelle](creating-and-managing-roles-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="1fa48-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-vb/_static/image21.png))</span></span>

<span data-ttu-id="1fa48-300">Après avoir ajouté le bouton supprimer, le balisage déclaratif de votre GridView doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="1fa48-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-vb/samples/sample12.aspx)]

<span data-ttu-id="1fa48-301">Ensuite, créez un gestionnaire d’événements pour l’événement `RowDeleting` de GridView.</span><span class="sxs-lookup"><span data-stu-id="1fa48-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="1fa48-302">Il s’agit de l’événement qui est déclenché lors de la publication (postback) lorsque l’utilisateur clique sur le bouton supprimer un rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="1fa48-303">Ajoutez le code suivant au gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="1fa48-303">Add the following code to the event handler.</span></span>

[!code-vb[Main](creating-and-managing-roles-vb/samples/sample13.vb)]

<span data-ttu-id="1fa48-304">Le code commence par programmer en référençant le `RoleNameLabel` contrôle Web dans la ligne où l’utilisateur a cliqué sur le bouton supprimer le rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="1fa48-305">La méthode `Roles.DeleteRole` est ensuite appelée, passant le `Text` du `RoleNameLabel` et `False`, supprimant ainsi le rôle, qu’il y ait ou non des utilisateurs associés au rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `False`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="1fa48-306">Enfin, le `RoleList` GridView est actualisé de sorte que le rôle juste à supprimer n’apparaisse plus dans la grille.</span><span class="sxs-lookup"><span data-stu-id="1fa48-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="1fa48-307">Le bouton supprimer un rôle ne nécessite pas de confirmation de la part de l’utilisateur avant de supprimer le rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="1fa48-308">L’une des méthodes les plus simples pour confirmer une action consiste à utiliser une boîte de dialogue de confirmation côté client.</span><span class="sxs-lookup"><span data-stu-id="1fa48-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="1fa48-309">Pour plus d’informations sur cette technique, consultez [Ajout d’une confirmation côté client lors de la suppression](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span><span class="sxs-lookup"><span data-stu-id="1fa48-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="1fa48-310">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="1fa48-310">Summary</span></span>

<span data-ttu-id="1fa48-311">De nombreuses applications Web possèdent certaines règles d’autorisation ou des fonctionnalités au niveau de la page qui sont uniquement disponibles pour certaines classes d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="1fa48-312">Par exemple, il peut y avoir un ensemble de pages Web auxquelles seuls les administrateurs peuvent accéder.</span><span class="sxs-lookup"><span data-stu-id="1fa48-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="1fa48-313">Plutôt que de définir ces règles d’autorisation pour chaque utilisateur, il est souvent plus utile de définir les règles en fonction d’un rôle.</span><span class="sxs-lookup"><span data-stu-id="1fa48-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="1fa48-314">Autrement dit, plutôt que d’autoriser explicitement les utilisateurs Scott et Jisun à accéder aux pages Web d’administration, une approche plus facile à gérer consiste à autoriser les membres du rôle administrateurs à accéder à ces pages, puis à indiquer Scott et Jisun en tant qu’utilisateurs appartenant au Rôle Administrateurs.</span><span class="sxs-lookup"><span data-stu-id="1fa48-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="1fa48-315">L’infrastructure Roles facilite la création et la gestion des rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="1fa48-316">Dans ce didacticiel, nous avons examiné comment configurer l’infrastructure des rôles pour utiliser le `SqlRoleProvider`, qui utilise une base de données Microsoft SQL Server comme magasin de rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="1fa48-317">Nous avons également créé une page Web qui répertorie les rôles existants dans le système et permet de créer de nouveaux rôles et de les supprimer.</span><span class="sxs-lookup"><span data-stu-id="1fa48-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="1fa48-318">Dans les didacticiels suivants, nous verrons comment affecter des utilisateurs aux rôles et comment appliquer l’autorisation basée sur les rôles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="1fa48-319">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="1fa48-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="1fa48-320">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="1fa48-320">Further Reading</span></span>

<span data-ttu-id="1fa48-321">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="1fa48-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="1fa48-322">Examen de l’appartenance, des rôles et du profil de ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="1fa48-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="1fa48-323">Procédure : utiliser le gestionnaire de rôles dans ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="1fa48-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="1fa48-324">Fournisseurs de rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="1fa48-325">Déploiement de votre propre outil d’administration de site Web</span><span class="sxs-lookup"><span data-stu-id="1fa48-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="1fa48-326">Documentation technique pour l’élément `<roleManager>`</span><span class="sxs-lookup"><span data-stu-id="1fa48-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="1fa48-327">Utilisation des API d’appartenance et de gestionnaire de rôles</span><span class="sxs-lookup"><span data-stu-id="1fa48-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="1fa48-328">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="1fa48-328">About the Author</span></span>

<span data-ttu-id="1fa48-329">Scott Mitchell, auteur de plusieurs ouvrages ASP/ASP. NET et fondateur de 4GuysFromRolla.com, travaille avec les technologies Web de Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="1fa48-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1fa48-330">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="1fa48-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1fa48-331">Son dernier livre est *[Sams vous apprend vous-même ASP.NET 2,0 en 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="1fa48-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="1fa48-332">Scott peut être contacté au [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou via son blog à l’adresse [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="1fa48-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="1fa48-333">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="1fa48-333">Special Thanks To</span></span>

<span data-ttu-id="1fa48-334">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="1fa48-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1fa48-335">Les réviseurs de leads pour ce didacticiel incluent Alicja maziarz, par exemple, Banerjee et Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="1fa48-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="1fa48-336">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="1fa48-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1fa48-337">Dans ce cas, insérez une ligne à [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1fa48-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1fa48-338">[Précédent](role-based-authorization-cs.md)
> [Suivant](assigning-roles-to-users-vb.md)</span><span class="sxs-lookup"><span data-stu-id="1fa48-338">[Previous](role-based-authorization-cs.md)
[Next](assigning-roles-to-users-vb.md)</span></span>
