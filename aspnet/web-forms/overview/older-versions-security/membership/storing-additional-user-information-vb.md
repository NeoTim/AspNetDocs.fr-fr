---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
title: Stockage des informations utilisateur supplémentaires (VB) | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel nous répondrons à cette question par la création d’une application de livre d’or très rudimentaires. Ce faisant, nous examinerons les différentes options pour modeli...
ms.author: riande
ms.date: 01/18/2008
ms.assetid: ee4b924e-8002-4dc3-819f-695fca1ff867
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
msc.type: authoredcontent
ms.openlocfilehash: 8483f6673ff64020c5eb10bd72766c6df91e0438
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65133055"
---
# <a name="storing-additional-user-information-vb"></a><span data-ttu-id="e518f-104">Stockage d’informations supplémentaires sur l’utilisateur (VB)</span><span class="sxs-lookup"><span data-stu-id="e518f-104">Storing Additional User Information (VB)</span></span>

<span data-ttu-id="e518f-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e518f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e518f-106">[Télécharger le Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) ou [télécharger le PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="e518f-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span></span>

> <span data-ttu-id="e518f-107">Dans ce didacticiel nous répondrons à cette question par la création d’une application de livre d’or très rudimentaires.</span><span class="sxs-lookup"><span data-stu-id="e518f-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="e518f-108">Ce faisant, nous examiner les différentes options pour modéliser les informations utilisateur dans une base de données et puis regardez comment associer ces données avec les comptes d’utilisateurs créés par l’infrastructure d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>

## <a name="introduction"></a><span data-ttu-id="e518f-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="e518f-109">Introduction</span></span>

<span data-ttu-id="e518f-110">ASP. Infrastructure de l’appartenance du NET offre une interface flexible pour la gestion des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e518f-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="e518f-111">L’API d’appartenance inclut des méthodes pour valider les informations d’identification, récupérer des informations sur l’utilisateur actuellement connecté, création d’un nouveau compte d’utilisateur et supprimer un compte d’utilisateur, entre autres.</span><span class="sxs-lookup"><span data-stu-id="e518f-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="e518f-112">Chaque compte d’utilisateur dans le cadre de l’appartenance contient uniquement les propriétés nécessaires pour valider les informations d’identification et l’exécution des tâches relatives aux comptes d’utilisateur essentiels.</span><span class="sxs-lookup"><span data-stu-id="e518f-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="e518f-113">Cela est démontrée par les méthodes et propriétés de la [ `MembershipUser` classe](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), qui modélise un compte d’utilisateur dans le cadre de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="e518f-114">Cette classe possède des propriétés comme [ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), et [ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), et les méthodes comme [ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) et [ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="e518f-115">Souvent, les applications doivent stocker des informations utilisateur supplémentaires non incluses dans l’infrastructure de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="e518f-116">Par exemple, un détaillant en ligne devrez permettre à chaque utilisateur de stocker ses adresses de livraison et de facturation, les informations de paiement, les préférences de livraison et numéro de téléphone du contact.</span><span class="sxs-lookup"><span data-stu-id="e518f-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="e518f-117">En outre, chaque commande dans le système est associé à un compte d’utilisateur particulier.</span><span class="sxs-lookup"><span data-stu-id="e518f-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="e518f-118">Le `MembershipUser` classe n’inclut pas de propriétés telles que `PhoneNumber` ou `DeliveryPreferences` ou `PastOrders`.</span><span class="sxs-lookup"><span data-stu-id="e518f-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="e518f-119">Par conséquent, comment nous suivre les informations utilisateur requises par l’application et l’avez intégrer à l’infrastructure de l’appartenance ?</span><span class="sxs-lookup"><span data-stu-id="e518f-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="e518f-120">Dans ce didacticiel nous répondrons à cette question par la création d’une application de livre d’or très rudimentaires.</span><span class="sxs-lookup"><span data-stu-id="e518f-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="e518f-121">Ce faisant, nous examiner les différentes options pour modéliser les informations utilisateur dans une base de données et puis regardez comment associer ces données avec les comptes d’utilisateurs créés par l’infrastructure d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="e518f-122">C’est parti !</span><span class="sxs-lookup"><span data-stu-id="e518f-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="e518f-123">Étape 1 : Création de modèle de données de l’Application de livre d’or</span><span class="sxs-lookup"><span data-stu-id="e518f-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="e518f-124">Il existe une variété de techniques qui peuvent être utilisés pour capturer les informations utilisateur dans une base de données et l’associer avec les comptes d’utilisateurs créés par l’infrastructure de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="e518f-125">Afin d’illustrer ces techniques, nous devrons permettent d’enrichir l’application web didacticiel afin qu’elles intègrent une sorte de données relatifs à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="e518f-126">(Actuellement, le modèle de données de l’application contient uniquement l’application services tables requises par le `SqlMembershipProvider`.)</span><span class="sxs-lookup"><span data-stu-id="e518f-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="e518f-127">Nous allons créer une application de livre d’or très simple où un utilisateur authentifié peut laisser un commentaire.</span><span class="sxs-lookup"><span data-stu-id="e518f-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="e518f-128">Outre le stockage des commentaires de livre d’or, nous allons autoriser chaque utilisateur stocker sa ville natale, la page d’accueil et la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="e518f-129">S’il est fourni, ville de domicile de l’utilisateur, page d’accueil et de signature seront affiche sur chaque message qu’il a laissé dans le livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="e518f-130">Ajout de la`GuestbookComments`Table</span><span class="sxs-lookup"><span data-stu-id="e518f-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="e518f-131">Pour capturer les commentaires du livre d’or, nous devons créer une table de base de données nommée `GuestbookComments` qui comporte des colonnes comme `CommentId`, `Subject`, `Body`, et `CommentDate`.</span><span class="sxs-lookup"><span data-stu-id="e518f-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="e518f-132">Nous devons également disposer de chaque enregistrement le `GuestbookComments` référence de l’utilisateur ayant laissé le commentaire à la table.</span><span class="sxs-lookup"><span data-stu-id="e518f-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="e518f-133">Pour ajouter cette table à notre base de données, accédez à l’Explorateur de base de données dans Visual Studio et explorez le `SecurityTutorials` base de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="e518f-134">Avec le bouton droit sur le dossier Tables et choisissez Ajouter une nouvelle Table.</span><span class="sxs-lookup"><span data-stu-id="e518f-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="e518f-135">Ceci fait apparaître une interface qui nous permet de définir les colonnes de la nouvelle table.</span><span class="sxs-lookup"><span data-stu-id="e518f-135">This brings up an interface that allows us to define the columns for the new table.</span></span>

<span data-ttu-id="e518f-136">[![Ajouter une nouvelle Table à la base de données SecurityTutorials](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span></span>

<span data-ttu-id="e518f-137">**Figure 1**: Ajouter une nouvelle Table à la `SecurityTutorials` base de données ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-vb/_static/image3.png))</span></span>

<span data-ttu-id="e518f-138">Ensuite, définissez le `GuestbookComments`de colonnes.</span><span class="sxs-lookup"><span data-stu-id="e518f-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="e518f-139">Commencez par ajouter une colonne nommée `CommentId` de type `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="e518f-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="e518f-140">Cette colonne s’identifier de façon unique chaque commentaire dans le livre d’or, donc interdire `NULL` s et marquez-la en tant que clé primaire de la table.</span><span class="sxs-lookup"><span data-stu-id="e518f-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="e518f-141">Au lieu de fournir une valeur pour le `CommentId` chaque champ `INSERT`, nous pouvons indiquer qu’un nouveau `uniqueidentifier` valeur doit être générée automatiquement pour ce champ sur `INSERT` en définissant la valeur par défaut de la colonne `NEWID()`.</span><span class="sxs-lookup"><span data-stu-id="e518f-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="e518f-142">Après avoir ajouté ce premier champ, en marquant comme clé primaire, les paramètres de sa valeur par défaut, votre écran doit ressembler à l’écran présenté en Figure 2.</span><span class="sxs-lookup"><span data-stu-id="e518f-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>

<span data-ttu-id="e518f-143">[![Ajouter une colonne principale nommée CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span></span>

<span data-ttu-id="e518f-144">**Figure 2**: Ajouter une colonne nommée principal `CommentId` ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-vb/_static/image6.png))</span></span>

<span data-ttu-id="e518f-145">Ensuite, ajoutez une colonne nommée `Subject` de type `nvarchar(50)` et une colonne nommée `Body` de type `nvarchar(MAX)`, interdire `NULL` s dans les deux colonnes.</span><span class="sxs-lookup"><span data-stu-id="e518f-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="e518f-146">Ensuite, ajoutez une colonne nommée `CommentDate` de type `datetime`.</span><span class="sxs-lookup"><span data-stu-id="e518f-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="e518f-147">Interdire `NULL` s et définissez le `CommentDate` valeur par défaut de la colonne à `getdate()`.</span><span class="sxs-lookup"><span data-stu-id="e518f-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="e518f-148">Ne reste qu’à ajouter une colonne qui associe un compte d’utilisateur à chaque commentaire de livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="e518f-149">Une option consisterait à ajouter une colonne nommée `UserName` de type `nvarchar(256)`.</span><span class="sxs-lookup"><span data-stu-id="e518f-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="e518f-150">Il s’agit d’un choix approprié lors de l’utilisation d’un fournisseur d’appartenances autre que le `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="e518f-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="e518f-151">Mais lorsque vous utilisez le `SqlMembershipProvider`, comme nous sommes dans cette série de didacticiels, le `UserName` colonne dans la `aspnet_Users` table n’est pas garantie pour être unique.</span><span class="sxs-lookup"><span data-stu-id="e518f-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="e518f-152">Le `aspnet_Users` clé primaire de la table est `UserId` et est de type `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="e518f-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="e518f-153">Par conséquent, le `GuestbookComments` table doit être une colonne nommée `UserId` de type `uniqueidentifier` (interdiction `NULL` valeurs).</span><span class="sxs-lookup"><span data-stu-id="e518f-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="e518f-154">Continuez et ajoutez cette colonne.</span><span class="sxs-lookup"><span data-stu-id="e518f-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-155">Comme expliqué dans la [ *création du schéma d’appartenance dans SQL Server* ](creating-the-membership-schema-in-sql-server-vb.md) didacticiel, l’infrastructure de l’appartenance est conçu pour permettre plusieurs applications web avec des comptes d’utilisateurs différents partagent le même magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e518f-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="e518f-156">Il effectue cela en partitionnant les comptes d’utilisateur dans différentes applications.</span><span class="sxs-lookup"><span data-stu-id="e518f-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="e518f-157">Et tandis que chaque nom d’utilisateur est garanti être unique au sein d’une application, le même nom d’utilisateur peut être utilisé dans différentes applications à l’aide de la même banque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="e518f-158">Il existe un composite `UNIQUE` contrainte dans le `aspnet_Users` table sur le `UserName` et `ApplicationId` champs, mais pas sur uniquement le `UserName` champ.</span><span class="sxs-lookup"><span data-stu-id="e518f-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="e518f-159">Par conséquent, il est possible pour le compte aspnet\_table aux utilisateurs d’avoir deux (ou plusieurs) des enregistrements avec le même `UserName` valeur.</span><span class="sxs-lookup"><span data-stu-id="e518f-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="e518f-160">Cependant, il existe un `UNIQUE` contrainte sur la `aspnet_Users` la table `UserId` champ (dans la mesure où il s’agit de la clé primaire).</span><span class="sxs-lookup"><span data-stu-id="e518f-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="e518f-161">Un `UNIQUE` contrainte est importante, car sans cela, nous ne pouvons pas établir une contrainte de clé étrangère entre la `GuestbookComments` et `aspnet_Users` tables.</span><span class="sxs-lookup"><span data-stu-id="e518f-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>

<span data-ttu-id="e518f-162">Après avoir ajouté le `UserId` colonne, enregistrer la table en cliquant sur l’icône Enregistrer dans la barre d’outils.</span><span class="sxs-lookup"><span data-stu-id="e518f-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="e518f-163">Nommez la nouvelle table `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="e518f-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="e518f-164">Nous avons un dernier problème assister à avec le `GuestbookComments` table : nous devons créer un [contrainte de clé étrangère](https://msdn.microsoft.com/library/ms175464.aspx) entre le `GuestbookComments.UserId` colonne et le `aspnet_Users.UserId` colonne.</span><span class="sxs-lookup"><span data-stu-id="e518f-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="e518f-165">Pour ce faire, cliquez sur l’icône de relation dans la barre d’outils pour lancer la boîte de dialogue relations de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="e518f-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="e518f-166">(Vous pouvez également lancer cette boîte de dialogue en sélectionnant le menu Concepteur de tables et en choisissant de relations.)</span><span class="sxs-lookup"><span data-stu-id="e518f-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="e518f-167">Cliquez sur le bouton Ajouter dans le coin inférieur gauche de la boîte de dialogue relations de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="e518f-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="e518f-168">Cette opération ajoute une nouvelle contrainte de clé étrangère, bien que nous devons encore définir les tables impliquées dans la relation.</span><span class="sxs-lookup"><span data-stu-id="e518f-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>

<span data-ttu-id="e518f-169">[![Utilisez la boîte de dialogue relations de clé étrangère pour gérer les contraintes de clé étrangère d’une Table](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span></span>

<span data-ttu-id="e518f-170">**Figure 3**: Utilisez la boîte de dialogue relations de clé étrangère pour gérer les contraintes de clé étrangère d’une Table ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-vb/_static/image9.png))</span></span>

<span data-ttu-id="e518f-171">Ensuite, cliquez sur l’icône de points de suspension dans la ligne « Table et colonnes Specifications » sur la droite.</span><span class="sxs-lookup"><span data-stu-id="e518f-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="e518f-172">Cette action lance la boîte de dialogue Tables et colonnes à partir de laquelle nous pouvons spécifier la table de clé primaire et de colonne et de la colonne de clé étrangère à partir de la `GuestbookComments` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="e518f-173">En particulier, sélectionnez `aspnet_Users` et `UserId` en tant que la table de clé primaire et la colonne, et `UserId` à partir de la `GuestbookComments` table en tant que la colonne clé étrangère (voir Figure 4).</span><span class="sxs-lookup"><span data-stu-id="e518f-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="e518f-174">Après avoir défini les tables de clés primaires et étrangères et les colonnes, cliquez sur OK pour revenir à la boîte de dialogue relations de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="e518f-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>

<span data-ttu-id="e518f-175">[![Établir un étrangère clé contrainte entre l’aspnet_Users et GuesbookComments Tables](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span></span>

<span data-ttu-id="e518f-176">**Figure 4**: Établir une Foreign Key contrainte entre le `aspnet_Users` et `GuesbookComments` Tables ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image12.png))</span></span>

<span data-ttu-id="e518f-177">À ce stade, la contrainte de clé étrangère a été établie.</span><span class="sxs-lookup"><span data-stu-id="e518f-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="e518f-178">Garantit la présence de cette contrainte [l’intégrité relationnelle](http://en.wikipedia.org/wiki/Referential_integrity) entre les deux tables en garantissant que ne peut pas contenir une entrée de livre d’or faisant référence à un compte d’utilisateur inexistante.</span><span class="sxs-lookup"><span data-stu-id="e518f-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="e518f-179">Par défaut, une contrainte de clé étrangère empêche un enregistrement parent est supprimé s’il existe correspondants des enregistrements enfants.</span><span class="sxs-lookup"><span data-stu-id="e518f-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="e518f-180">Autrement dit, si un utilisateur effectue une ou plusieurs remarques de livre d’or, et puis nous tentons de supprimer ce compte d’utilisateur, la suppression échoue, sauf si ses commentaires du livre d’or sont supprimés en premier.</span><span class="sxs-lookup"><span data-stu-id="e518f-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="e518f-181">Contraintes de clé étrangère peuvent être configurées pour supprimer automatiquement les enregistrements enfants associées lorsqu’un enregistrement parent est supprimé.</span><span class="sxs-lookup"><span data-stu-id="e518f-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="e518f-182">En d’autres termes, nous pouvons configurer cette contrainte de clé étrangère afin que les entrées du livre d’or d’un utilisateur sont automatiquement supprimées lorsque son compte d’utilisateur est supprimé.</span><span class="sxs-lookup"><span data-stu-id="e518f-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="e518f-183">Pour ce faire, développez la section « Spécification d’insérer et de mise à jour » et la valeur de la propriété « Supprimer la règle » Cascade.</span><span class="sxs-lookup"><span data-stu-id="e518f-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>

<span data-ttu-id="e518f-184">[![Configurer la contrainte de clé étrangère à des suppressions en Cascade](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span></span>

<span data-ttu-id="e518f-185">**Figure 5**: Configurer la contrainte de clé étrangère pour la suppression en Cascade ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-vb/_static/image15.png))</span></span>

<span data-ttu-id="e518f-186">Pour enregistrer la contrainte de clé étrangère, cliquez sur le bouton Fermer pour quitter les relations de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="e518f-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="e518f-187">Puis cliquez sur l’icône Enregistrer dans la barre d’outils pour enregistrer la table et cette relation.</span><span class="sxs-lookup"><span data-stu-id="e518f-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="e518f-188">Stockage Home Town, page d’accueil et Signature de l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="e518f-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="e518f-189">Le `GuestbookComments` tableau illustre comment stocker des informations qui partage une relation un-à-plusieurs comptes d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="e518f-190">Étant donné que chaque compte d’utilisateur peut avoir un nombre arbitraire de commentaires associés, cette relation est modélisée en créant une table pour stocker l’ensemble de commentaires qui inclut une colonne que revient chaque commentaire à un utilisateur particulier.</span><span class="sxs-lookup"><span data-stu-id="e518f-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="e518f-191">Lorsque vous utilisez le `SqlMembershipProvider`, ce lien est établi au mieux en créant une colonne nommée `UserId` de type `uniqueidentifier` et une contrainte de clé étrangère entre cette colonne et `aspnet_Users.UserId`.</span><span class="sxs-lookup"><span data-stu-id="e518f-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="e518f-192">Nous devons maintenant associer trois colonnes de chaque compte d’utilisateur pour stocker l’utilisateur ville natale, page d’accueil et la signature, qui apparaîtra dans ses commentaires du livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="e518f-193">Il existe plusieurs moyens différents pour effectuer cette opération :</span><span class="sxs-lookup"><span data-stu-id="e518f-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="e518f-194"><strong>Ajouter de nouvelles colonnes à la</strong><strong>`aspnet_Users`</strong><strong>ou</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span><span class="sxs-lookup"><span data-stu-id="e518f-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="e518f-195">Je ne recommande pas cette approche, car il modifie le schéma utilisé par le `SqlMembershipProvider`.</span><span class="sxs-lookup"><span data-stu-id="e518f-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="e518f-196">Cette décision peut se retourner contre vous deVisual.</span><span class="sxs-lookup"><span data-stu-id="e518f-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="e518f-197">Par exemple, que se passe-t-il si une future version de ASP.NET utilise un autre `SqlMembershipProvider` schéma.</span><span class="sxs-lookup"><span data-stu-id="e518f-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="e518f-198">Microsoft peut inclure un outil pour migrer d’ASP.NET 2.0 `SqlMembershipProvider` données vers le nouveau schéma, mais si vous avez modifié l’ASP.NET 2.0 `SqlMembershipProvider` schéma, une telle conversion ne peut pas être possible.</span><span class="sxs-lookup"><span data-stu-id="e518f-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="e518f-199">**Utilisez ASP. Framework de profil du .NET, définition d’une propriété de profil pour la ville natale, la page d’accueil et la signature.**</span><span class="sxs-lookup"><span data-stu-id="e518f-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="e518f-200">ASP.NET propose une infrastructure de profil qui est conçue pour stocker des données supplémentaires spécifiques à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="e518f-201">Comme l’infrastructure de l’appartenance, l’infrastructure de profil est construit sur le modèle de fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e518f-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="e518f-202">Le .NET Framework est livré avec un `SqlProfileProvider` que stocke les données dans une base de données SQL Server de profil.</span><span class="sxs-lookup"><span data-stu-id="e518f-202">The .NET Framework ships with a `SqlProfileProvider` that stores profile data in a SQL Server database.</span></span> <span data-ttu-id="e518f-203">En fait, notre base de données a déjà la table utilisée par le `SqlProfileProvider` (`aspnet_Profile`), comme il a été ajouté quand nous avons ajouté les services d’application de nouveau la [ *création du schéma d’appartenance dans SQL Server* ](creating-the-membership-schema-in-sql-server-vb.md)didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e518f-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial.</span></span>   
  <span data-ttu-id="e518f-204">Le principal avantage de l’infrastructure de profil est de permettre aux développeurs de définir les propriétés de profil dans `Web.config` – aucun code ne doit être écrit pour sérialiser les données de profil vers et depuis le magasin de données sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="e518f-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="e518f-205">En bref, il est incroyablement facile pour définir un ensemble de propriétés de profil et à les utiliser dans le code.</span><span class="sxs-lookup"><span data-stu-id="e518f-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="e518f-206">Toutefois, le système de profil laisse beaucoup à désirer lorsqu’il s’agit du contrôle de version, si vous avez une application où vous attendez des nouvelles propriétés spécifiques à l’utilisateur à ajouter à un moment ultérieur, existants ou nouveaux à être supprimées ou modifiées, puis l’infrastructure de profil ne peut pas être le  meilleure option.</span><span class="sxs-lookup"><span data-stu-id="e518f-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="e518f-207">En outre, le `SqlProfileProvider` stocke les propriétés de profil de manière extrêmement dénormalisée, rendant pratiquement à exécuter des requêtes directement sur les données de profil (par exemple, combien d’utilisateurs ont un accueil ville de New York).</span><span class="sxs-lookup"><span data-stu-id="e518f-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="e518f-208">Pour plus d’informations sur l’infrastructure de profil, consultez la section « Autres lectures » à la fin de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e518f-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="e518f-209"><strong>Ajoutez ces trois colonnes dans une nouvelle table dans la base de données et établir une relation un à un entre cette table et</strong><strong>`aspnet_Users`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="e518f-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="e518f-210">Cette approche implique un peu plus de travail qu’avec l’infrastructure de profil, mais offre une flexibilité maximale dans la façon dont les propriétés de l’utilisateur supplémentaires sont modélisées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="e518f-211">Il s’agit de l’option que nous allons utiliser dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e518f-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="e518f-212">Nous allons créer une nouvelle table appelée `UserProfiles` pour enregistrer la ville natale, la page d’accueil et la signature pour chaque utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="e518f-213">Avec le bouton droit sur le dossier Tables dans la fenêtre Explorateur de base de données et choisir de créer une nouvelle table.</span><span class="sxs-lookup"><span data-stu-id="e518f-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="e518f-214">Nom de la première colonne `UserId` et définissez son type sur `uniqueidentifier`.</span><span class="sxs-lookup"><span data-stu-id="e518f-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="e518f-215">Interdire `NULL` valeurs et marquer la colonne comme clé primaire.</span><span class="sxs-lookup"><span data-stu-id="e518f-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="e518f-216">Ensuite, ajoutez les colonnes nommées : `HomeTown` de type `nvarchar(50)`; `HomepageUrl` de type `nvarchar(100)`; et la Signature de type `nvarchar(500)`.</span><span class="sxs-lookup"><span data-stu-id="e518f-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="e518f-217">Chacune de ces trois colonnes peut accepter un `NULL` valeur.</span><span class="sxs-lookup"><span data-stu-id="e518f-217">Each of these three columns can accept a `NULL` value.</span></span>

<span data-ttu-id="e518f-218">[![Créer la Table UserProfiles](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-218">[![Create the UserProfiles Table](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span></span>

<span data-ttu-id="e518f-219">**Figure 6**: Créer le `UserProfiles` Table ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image18.png))</span></span>

<span data-ttu-id="e518f-220">Enregistrez la table et nommez-le `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="e518f-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="e518f-221">Enfin, établir une contrainte de clé étrangère entre la `UserProfiles` la table `UserId` champ et le `aspnet_Users.UserId` champ.</span><span class="sxs-lookup"><span data-stu-id="e518f-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="e518f-222">Comme nous l’avons fait avec la contrainte de clé étrangère entre la `GuestbookComments` et `aspnet_Users` tables, avoir cette contrainte suppressions en cascade.</span><span class="sxs-lookup"><span data-stu-id="e518f-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="e518f-223">Dans la mesure où le `UserId` champ `UserProfiles` est le principal clé, cela permet de s’assurer qu’il y aura pas plus de plusieurs enregistrements dans la `UserProfiles` table pour chaque compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="e518f-224">Ce type de relation est appelé par un à un.</span><span class="sxs-lookup"><span data-stu-id="e518f-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="e518f-225">Maintenant que nous avons créé le modèle de données, nous sommes prêts à l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="e518f-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="e518f-226">Dans les étapes 2 et 3, nous allons examiner la façon dont l’utilisateur actuellement connecté peut afficher et modifier leurs informations town, page d’accueil et la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="e518f-227">À l’étape 4, nous créerons l’interface pour les utilisateurs authentifiés à soumettre les nouveaux commentaires sur le livre d’or et afficher les serveurs existants.</span><span class="sxs-lookup"><span data-stu-id="e518f-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="e518f-228">Étape 2 : Affichage de l’utilisateur Home Town, page d’accueil et Signature</span><span class="sxs-lookup"><span data-stu-id="e518f-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="e518f-229">Il existe de différentes façons pour autoriser l’utilisateur actuellement connecté afficher et modifier ses informations town, page d’accueil et la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="e518f-230">Nous pourrions créer manuellement l’interface utilisateur avec la zone de texte et les contrôles Label ou nous pourrions utiliser une des données des contrôles Web, tels que le contrôle DetailsView.</span><span class="sxs-lookup"><span data-stu-id="e518f-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="e518f-231">Pour effectuer la base de données `SELECT` et `UPDATE` instructions nous pourrions écrire ADO.NET dans la classe de code-behind de notre page de code ou, vous pouvez également employer une approche déclarative avec SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="e518f-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="e518f-232">Dans l’idéal, notre application contiendrait une architecture à plusieurs niveaux, nous pouvons appeler par programmation à partir de la classe code-behind de la page ou de façon déclarative via le contrôle ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e518f-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="e518f-233">Étant donné que cette série de didacticiels se concentre sur l’authentification par formulaire, l’autorisation, comptes d’utilisateurs et rôles, il ne sera pas une discussion détaillée de ces options d’accès des données différentes ou pourquoi une architecture à plusieurs niveaux est préférable à l’exécution des instructions SQL directement à partir de la page ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e518f-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="e518f-234">Je vais vous guider en utilisant un contrôle DetailsView et le SqlDataSource-option plus rapide et plus simple- mais les concepts étudiés peuvent certainement être appliqués à autre logique d’accès aux données et les contrôles Web.</span><span class="sxs-lookup"><span data-stu-id="e518f-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="e518f-235">Pour plus d’informations sur l’utilisation des données dans ASP.NET, reportez-vous à mon *[utilisation des données dans ASP.NET 2.0](../../data-access/index.md)* série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="e518f-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="e518f-236">Ouvrez le `AdditionalUserInfo.aspx` page dans le `Membership` dossier et ajouter un contrôle DetailsView à la page, en affectant à sa propriété ID `UserProfile` et éliminant son `Width` et `Height` propriétés.</span><span class="sxs-lookup"><span data-stu-id="e518f-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its ID property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="e518f-237">Développez la balise active de DetailsView et choisissez de le lier à un nouveau contrôle de source de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="e518f-238">Cette action lance l’Assistant Configuration de source de données (voir la Figure 7).</span><span class="sxs-lookup"><span data-stu-id="e518f-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="e518f-239">La première étape vous invite à spécifier le type de source de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="e518f-240">Étant donné que nous allons connecter directement à la `SecurityTutorials` de base de données, cliquez sur l’icône de la base de données, en spécifiant le `ID` comme `UserProfileDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e518f-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>

<span data-ttu-id="e518f-241">[![Ajouter un nouveau contrôle SqlDataSource nommé UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span></span>

<span data-ttu-id="e518f-242">**Figure 7**: Ajouter un nouveau contrôle SqlDataSource nommé `UserProfileDataSource` ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-vb/_static/image21.png))</span></span>

<span data-ttu-id="e518f-243">L’écran suivant vous invite à entrer pour la base de données à utiliser.</span><span class="sxs-lookup"><span data-stu-id="e518f-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="e518f-244">Nous avons déjà défini une chaîne de connexion dans `Web.config` pour le `SecurityTutorials` base de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="e518f-245">Ce nom de chaîne de connexion – `SecurityTutorialsConnectionString` – doit se trouver dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="e518f-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="e518f-246">Sélectionnez cette option et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="e518f-246">Select this option and click Next.</span></span>

<span data-ttu-id="e518f-247">[![Choisissez SecurityTutorialsConnectionString dans la liste déroulante](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span></span>

<span data-ttu-id="e518f-248">**Figure 8**: Choisissez `SecurityTutorialsConnectionString` dans la liste déroulante ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-vb/_static/image24.png))</span></span>

<span data-ttu-id="e518f-249">L’écran suivant nous demande de spécifier la table et les colonnes à la requête.</span><span class="sxs-lookup"><span data-stu-id="e518f-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="e518f-250">Choisissez le `UserProfiles` de table dans la liste déroulante et vérifiez toutes les colonnes.</span><span class="sxs-lookup"><span data-stu-id="e518f-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>

<span data-ttu-id="e518f-251">[![Afficher toutes les colonnes automatiquement à partir de la Table UserProfiles](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span></span>

<span data-ttu-id="e518f-252">**Figure 9**: Mettre à nouveau toutes les colonnes de la `UserProfiles` Table ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image27.png))</span></span>

<span data-ttu-id="e518f-253">La requête actuelle dans la Figure 9 retourne *tous les* des enregistrements de `UserProfiles`, mais nous nous intéressons uniquement dans l’enregistrement de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="e518f-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="e518f-254">Pour ajouter un `WHERE` clause, cliquez sur le `WHERE` bouton pour afficher l’ajouter `WHERE` boîte de dialogue de la Clause (voir Figure 10).</span><span class="sxs-lookup"><span data-stu-id="e518f-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="e518f-255">Ici, vous pouvez sélectionner la colonne à filtrer, l’opérateur et la source du paramètre de filtre.</span><span class="sxs-lookup"><span data-stu-id="e518f-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="e518f-256">Sélectionnez `UserId` en tant que la colonne et l’opérateur « = ».</span><span class="sxs-lookup"><span data-stu-id="e518f-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="e518f-257">Malheureusement, il n’a aucune source de paramètres intégré pour renvoyer l’utilisateur actuellement connecté `UserId` valeur.</span><span class="sxs-lookup"><span data-stu-id="e518f-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="e518f-258">Nous devons récupérer cette valeur par programmation.</span><span class="sxs-lookup"><span data-stu-id="e518f-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="e518f-259">Par conséquent, définissez la liste déroulante Source « None, « cliquez sur Ajouter bouton pour ajouter le paramètre, puis cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="e518f-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>

<span data-ttu-id="e518f-260">[![Ajouter un paramètre de filtre sur la colonne UserId](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span></span>

<span data-ttu-id="e518f-261">**Figure 10**: Ajouter un paramètre de filtre sur le `UserId` colonne ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-vb/_static/image30.png))</span></span>

<span data-ttu-id="e518f-262">Après avoir cliqué sur OK, vous serez redirigé vers l’écran illustré à la Figure 9.</span><span class="sxs-lookup"><span data-stu-id="e518f-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="e518f-263">Cette fois, cependant, la requête SQL en bas de l’écran doit inclure un `WHERE` clause.</span><span class="sxs-lookup"><span data-stu-id="e518f-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="e518f-264">Cliquez sur Suivant pour passer à l’écran « Requête de Test ».</span><span class="sxs-lookup"><span data-stu-id="e518f-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="e518f-265">Ici, vous pouvez exécuter la requête et afficher les résultats.</span><span class="sxs-lookup"><span data-stu-id="e518f-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="e518f-266">Cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="e518f-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e518f-267">À la fin de l’Assistant Configuration de source de données, Visual Studio crée le contrôle SqlDataSource selon les paramètres spécifiés dans l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="e518f-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="e518f-268">En outre, il ajoute manuellement BoundFields pour le contrôle DetailsView pour chaque colonne renvoyée par le SqlDataSource `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="e518f-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="e518f-269">Il n’est pas nécessaire pour afficher le `UserId` champ dans le contrôle DetailsView, étant donné que l’utilisateur n’a pas besoin de connaître cette valeur.</span><span class="sxs-lookup"><span data-stu-id="e518f-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="e518f-270">Vous pouvez supprimer ce champ directement à partir de balisage déclaratif du contrôle DetailsView ou en cliquant sur le « modifier les champs » lien à partir de sa balise active.</span><span class="sxs-lookup"><span data-stu-id="e518f-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="e518f-271">À ce stade balisage déclaratif de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e518f-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample1.aspx)]

<span data-ttu-id="e518f-272">Nous devons définir par programmation le contrôle SqlDataSource `UserId` paramètre à l’utilisateur actuellement connecté `UserId` avant que les données sont sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="e518f-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="e518f-273">Cela est possible en créant un gestionnaire d’événements pour le SqlDataSource `Selecting` code il des événements et ajoutant le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e518f-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample2.vb)]

<span data-ttu-id="e518f-274">Le code ci-dessus démarre en obtenant une référence à l’utilisateur actuellement connecté en appelant le `Membership` la classe `GetUser` (méthode).</span><span class="sxs-lookup"><span data-stu-id="e518f-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="e518f-275">Cette commande renvoie un `MembershipUser` de l’objet, dont la propriété `ProviderUserKey` propriété contient le `UserId`.</span><span class="sxs-lookup"><span data-stu-id="e518f-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="e518f-276">Le `UserId` valeur est ensuite assignée à la SqlDataSource `@UserId` paramètre.</span><span class="sxs-lookup"><span data-stu-id="e518f-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-277">Le `Membership.GetUser()` méthode retourne des informations sur l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="e518f-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="e518f-278">Si un utilisateur anonyme se trouve dans la page, elle retournera la valeur `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="e518f-278">If an anonymous user is visiting the page, it will return a value of `Nothing`.</span></span> <span data-ttu-id="e518f-279">Dans ce cas, cela entraîne un `NullReferenceException` sur la ligne suivante de code lorsque vous tentez de lire le `ProviderUserKey` propriété.</span><span class="sxs-lookup"><span data-stu-id="e518f-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="e518f-280">Bien sûr, nous n’avons pas à vous soucier `Membership.GetUser()` Nothing en retournant le `AdditionalUserInfo.aspx` page car nous avons configuré une autorisation d’URL dans le didacticiel précédent, afin que seuls les utilisateurs authentifiés peuvent accéder aux ressources ASP.NET dans ce dossier.</span><span class="sxs-lookup"><span data-stu-id="e518f-280">Of course, we don't have to worry about `Membership.GetUser()` returning Nothing in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="e518f-281">Si vous avez besoin d’accéder aux informations relatives à l’utilisateur actuellement connecté dans une page où l’accès anonyme est autorisé, veillez à vérifier que le `MembershipUser` objet retourné à partir de la `GetUser()` méthode n’est pas Nothing avant de le référencer ses propriétés.</span><span class="sxs-lookup"><span data-stu-id="e518f-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that the `MembershipUser` object returned from the `GetUser()` method is not Nothing before referencing its properties.</span></span>

<span data-ttu-id="e518f-282">Si vous visitez le `AdditionalUserInfo.aspx` page via un navigateur s’affiche une page vierge parce que nous devons encore ajouter des lignes à la `UserProfiles` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="e518f-283">À l’étape 6, nous allons examiner comment personnaliser le contrôle CreateUserWizard pour ajouter automatiquement une nouvelle ligne à la `UserProfiles` table lorsqu’un nouveau compte d’utilisateur est créé.</span><span class="sxs-lookup"><span data-stu-id="e518f-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="e518f-284">Pour l’instant, toutefois, nous devrons créer manuellement un enregistrement dans la table.</span><span class="sxs-lookup"><span data-stu-id="e518f-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="e518f-285">Accédez à l’Explorateur de base de données dans Visual Studio et développez le dossier Tables.</span><span class="sxs-lookup"><span data-stu-id="e518f-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="e518f-286">Avec le bouton droit sur le `aspnet_Users` table et choisissez « Afficher les données de Table » pour afficher les enregistrements dans la table ; faire la même chose le `UserProfiles` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="e518f-287">Figure 11 illustre ces résultats lorsque disposées en mosaïque verticalement.</span><span class="sxs-lookup"><span data-stu-id="e518f-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="e518f-288">Dans ma base de données est actuellement `aspnet_Users` enregistrements Bruce Fred et Tito, mais aucun enregistrement dans le `UserProfiles` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>

<span data-ttu-id="e518f-289">[![Le contenu de l’aspnet_Users et UserProfiles Tables sont affichées.](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span></span>

<span data-ttu-id="e518f-290">**Figure 11**: Le contenu de la `aspnet_Users` et `UserProfiles` Tables sont affichées ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-vb/_static/image33.png))</span></span>

<span data-ttu-id="e518f-291">Ajouter un nouvel enregistrement à la `UserProfiles` table en tapant manuellement des valeurs pour le `HomeTown`, `HomepageUrl`, et `Signature` champs.</span><span class="sxs-lookup"><span data-stu-id="e518f-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="e518f-292">Le moyen le plus simple pour obtenir une liste valide `UserId` valeur dans le nouveau `UserProfiles` enregistrement consiste à sélectionner le `UserId` champ à partir d’un compte d’utilisateur particulier dans le `aspnet_Users` table et copier et coller dans le `UserId` champ `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="e518f-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="e518f-293">La figure 12 illustre le `UserProfiles` après l’ajout d’un nouvel enregistrement de Bruce de table.</span><span class="sxs-lookup"><span data-stu-id="e518f-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>

<span data-ttu-id="e518f-294">[![Un enregistrement a été ajouté à UserProfiles pour Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span></span>

<span data-ttu-id="e518f-295">**Figure 12**: Un enregistrement a été ajouté à `UserProfiles` de Bruce ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-vb/_static/image36.png))</span></span>

<span data-ttu-id="e518f-296">Retour à la `AdditionalUserInfo.aspx page`, connecté en tant que Bruce.</span><span class="sxs-lookup"><span data-stu-id="e518f-296">Return to the `AdditionalUserInfo.aspx page`, logged in as Bruce.</span></span> <span data-ttu-id="e518f-297">Comme le montre la Figure 13, les paramètres de Bruce sont affichés.</span><span class="sxs-lookup"><span data-stu-id="e518f-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>

<span data-ttu-id="e518f-298">[![L’utilisateur visite actuellement est indiqué les paramètres de His](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span></span>

<span data-ttu-id="e518f-299">**Figure 13**: L’utilisateur visite actuellement est indiqué les paramètres de His ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-vb/_static/image39.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-300">Accédez à l’avance et manuellement ajouter des enregistrements dans la `UserProfiles` table pour chaque utilisateur d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="e518f-301">À l’étape 6, nous allons examiner comment personnaliser le contrôle CreateUserWizard pour ajouter automatiquement une nouvelle ligne à la `UserProfiles` table lorsqu’un nouveau compte d’utilisateur est créé.</span><span class="sxs-lookup"><span data-stu-id="e518f-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>

## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="e518f-302">Étape 3 : Autoriser l’utilisateur à modifier son Home Town, la page d’accueil et la Signature</span><span class="sxs-lookup"><span data-stu-id="e518f-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="e518f-303">À ce stade l’utilisateur actuellement connecté peut afficher leur ville natale, la page d’accueil et le paramètre de la signature, mais ils ne peuvent pas encore les modifier.</span><span class="sxs-lookup"><span data-stu-id="e518f-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="e518f-304">Nous allons mettre à jour le contrôle DetailsView afin que les données peuvent être modifiées.</span><span class="sxs-lookup"><span data-stu-id="e518f-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="e518f-305">La première chose que nous devons faire est ajouter un `UpdateCommand` pour SqlDataSource, en spécifiant la `UPDATE` instruction à exécuter et ses paramètres correspondants.</span><span class="sxs-lookup"><span data-stu-id="e518f-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="e518f-306">Sélectionnez SqlDataSource et, dans la fenêtre Propriétés, cliquez sur les points de suspension en regard de la propriété UpdateQuery pour afficher la boîte de dialogue Éditeur de commandes et paramètres.</span><span class="sxs-lookup"><span data-stu-id="e518f-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="e518f-307">Entrez les informations suivantes `UPDATE` instruction dans la zone de texte :</span><span class="sxs-lookup"><span data-stu-id="e518f-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-vb/samples/sample3.sql)]

<span data-ttu-id="e518f-308">Ensuite, cliquez sur le bouton « Actualiser les paramètres », qui crée un paramètre dans le contrôle SqlDataSource `UpdateParameters` collection pour chacun des paramètres dans le `UPDATE` instruction.</span><span class="sxs-lookup"><span data-stu-id="e518f-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="e518f-309">Conserver la source pour l’ensemble de l’ensemble de paramètres none et cliquez sur le bouton OK pour fermer la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="e518f-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>

<span data-ttu-id="e518f-310">[![Spécifiez le SqlDataSource UpdateCommand et UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span></span>

<span data-ttu-id="e518f-311">**Figure 14**: Spécifiez le SqlDataSource `UpdateCommand` et `UpdateParameters` ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-vb/_static/image42.png))</span></span>

<span data-ttu-id="e518f-312">En raison des ajouts, nous avons apporté au contrôle SqlDataSource, le contrôle DetailsView contrôle pouvez prennent désormais en charge la modification.</span><span class="sxs-lookup"><span data-stu-id="e518f-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="e518f-313">À partir de la balise active de DetailsView, cochez la case « Activer la modification ».</span><span class="sxs-lookup"><span data-stu-id="e518f-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="e518f-314">Cette opération ajoute une CommandField du contrôle `Fields` collection avec son `ShowEditButton` propriété définie sur True.</span><span class="sxs-lookup"><span data-stu-id="e518f-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="e518f-315">Cela restitue un bouton modifier lorsque le contrôle DetailsView s’affiche dans le mode lecture seule et de mise à jour et les boutons Annuler lorsque affichés dans le mode édition.</span><span class="sxs-lookup"><span data-stu-id="e518f-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="e518f-316">Au lieu d’obliger l’utilisateur à cliquer sur Modifier, cependant, nous pouvons avoir le rendu de DetailsView dans un état « toujours modifiable » en définissant le contrôle DetailsView [ `DefaultMode` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) à `Edit`.</span><span class="sxs-lookup"><span data-stu-id="e518f-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="e518f-317">Avec ces modifications, balisage déclaratif de votre contrôle DetailsView doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e518f-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample4.aspx)]

<span data-ttu-id="e518f-318">Notez l’ajout de la CommandField et `DefaultMode` propriété.</span><span class="sxs-lookup"><span data-stu-id="e518f-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="e518f-319">Continuons et tester cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="e518f-320">Lors de la visite avec un utilisateur qui dispose d’un enregistrement correspondant dans `UserProfiles`, les paramètres de l’utilisateur sont affichés dans une interface modifiable.</span><span class="sxs-lookup"><span data-stu-id="e518f-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>

<span data-ttu-id="e518f-321">[![Le contrôle DetailsView restitue une Interface modifiable](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span></span>

<span data-ttu-id="e518f-322">**Figure 15**: Le contrôle DetailsView restitue une Interface modifiable ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-vb/_static/image45.png))</span></span>

<span data-ttu-id="e518f-323">Essayez de modifier les valeurs et en cliquant sur le bouton de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="e518f-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="e518f-324">Il s’affiche comme si rien ne se produit.</span><span class="sxs-lookup"><span data-stu-id="e518f-324">It appears as if nothing happens.</span></span> <span data-ttu-id="e518f-325">Il existe une publication (postback) et les valeurs sont enregistrées dans la base de données, mais il n’existe aucun retour visuel qui s’est produite lors de l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="e518f-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="e518f-326">Pour résoudre ce problème, revenez à Visual Studio et ajouter un contrôle étiquette ci-dessus le contrôle DetailsView.</span><span class="sxs-lookup"><span data-stu-id="e518f-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="e518f-327">Définir son `ID` à `SettingsUpdatedMessage`, ses `Text` propriété « vos paramètres ont été mis à jour, » et ses `Visible` et `EnableViewState` propriétés à `False`.</span><span class="sxs-lookup"><span data-stu-id="e518f-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `False`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample5.aspx)]

<span data-ttu-id="e518f-328">Nous avons besoin afficher le `SettingsUpdatedMessage` étiqueter chaque fois que le contrôle DetailsView est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="e518f-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="e518f-329">Pour ce faire, créez un gestionnaire d’événements pour le DetailsView `ItemUpdated` événement et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e518f-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample6.vb)]

<span data-ttu-id="e518f-330">Retour à la `AdditionalUserInfo.aspx` page via un navigateur et de mettre à jour les données.</span><span class="sxs-lookup"><span data-stu-id="e518f-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="e518f-331">Cette fois, un message d’état utiles s’affiche.</span><span class="sxs-lookup"><span data-stu-id="e518f-331">This time, a helpful status message is displayed.</span></span>

<span data-ttu-id="e518f-332">[![Un bref Message est affiché lorsque les paramètres sont mis à jour](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span></span>

<span data-ttu-id="e518f-333">**Figure 16**: Un bref Message s’affiche lorsque les paramètres sont mis à jour ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-vb/_static/image48.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-334">Le contrôle DetailsView d’édition du interface laisse beaucoup à désirer.</span><span class="sxs-lookup"><span data-stu-id="e518f-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="e518f-335">Il utilise le format standard les zones de texte, mais le champ de Signature doit être probablement d’une zone de texte multiligne.</span><span class="sxs-lookup"><span data-stu-id="e518f-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="e518f-336">RegularExpressionValidator doit être utilisé pour vous assurer que l’URL de la page d’accueil, si vous avez entré, commence par « http:// » ou « https:// ».</span><span class="sxs-lookup"><span data-stu-id="e518f-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="e518f-337">En outre, depuis le contrôle DetailsView a contrôle ses `DefaultMode` propriété définie sur `Edit`, le bouton Annuler ne fait rien.</span><span class="sxs-lookup"><span data-stu-id="e518f-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="e518f-338">Il doit soit être supprimé ou, lorsque vous cliquez dessus, rediriger l’utilisateur vers une autre page (tel que `~/Default.aspx`).</span><span class="sxs-lookup"><span data-stu-id="e518f-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="e518f-339">Je laisse ces améliorations en guise d’exercice pour le lecteur.</span><span class="sxs-lookup"><span data-stu-id="e518f-339">I leave these enhancements as an exercise for the reader.</span></span>

### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="e518f-340">Ajout d’un lien vers le`AdditionalUserInfo.aspx`Page dans la Page maître</span><span class="sxs-lookup"><span data-stu-id="e518f-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="e518f-341">Actuellement, le site Web ne fournit pas tous les liens vers les `AdditionalUserInfo.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="e518f-342">La seule façon d’y accéder consiste à entrer les URL de la page directement dans la barre d’adresses du navigateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="e518f-343">Nous allons ajouter un lien vers cette page dans le `Site.master` page maître.</span><span class="sxs-lookup"><span data-stu-id="e518f-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="e518f-344">Rappelez-vous que la page maître contienne un contrôle LoginView Web dans son `LoginContent` ContentPlaceHolder qui affiche les différents balisages pour les visiteurs authentifiées et anonymes.</span><span class="sxs-lookup"><span data-stu-id="e518f-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="e518f-345">Mettre à jour le contrôle LoginView `LoggedInTemplate` pour inclure un lien vers le `AdditionalUserInfo.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="e518f-346">Après avoir apporté ces modifications le LoginView balisage déclaratif du contrôle doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e518f-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample7.aspx)]

<span data-ttu-id="e518f-347">Notez l’ajout de la `lnkUpdateSettings` contrôle de lien hypertexte pour le `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e518f-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="e518f-348">Avec ce lien en place, les utilisateurs authentifiés peuvent accéder rapidement à la page pour afficher et modifier leurs paramètres town, page d’accueil et signature domestiques.</span><span class="sxs-lookup"><span data-stu-id="e518f-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="e518f-349">Étape 4 : Ajout de nouveaux commentaires du livre d’or</span><span class="sxs-lookup"><span data-stu-id="e518f-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="e518f-350">Le `Guestbook.aspx` page est où les utilisateurs authentifiés peuvent consulter le livre d’or et laisser un commentaire.</span><span class="sxs-lookup"><span data-stu-id="e518f-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="e518f-351">Commençons par la création de l’interface pour ajouter de nouveaux commentaires du livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="e518f-352">Ouvrez le `Guestbook.aspx` page dans Visual Studio et construire une interface utilisateur composée de deux contrôles de zone de texte, un pour l’objet du nouveau commentaire et un pour son corps.</span><span class="sxs-lookup"><span data-stu-id="e518f-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="e518f-353">Définir le premier contrôle de zone de texte `ID` propriété `Subject` et son `Columns` propriété à 40 ; la valeur du second défini `ID` à `Body`, ses `TextMode` à `MultiLine`et son `Width` et `Rows` propriétés de « 95 % » et 8, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e518f-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="e518f-354">Pour exécuter l’interface utilisateur, ajoutez un contrôle bouton Web nommé `PostCommentButton` et définissez son `Text` propriété à « Post votre commentaire ».</span><span class="sxs-lookup"><span data-stu-id="e518f-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="e518f-355">Dans la mesure où chaque commentaire de livre d’or nécessite un objet et le corps, ajoutez un contrôle RequiredFieldValidator pour chacune des zones de texte.</span><span class="sxs-lookup"><span data-stu-id="e518f-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="e518f-356">Définir le `ValidationGroup` propriété de ces contrôles pour « EnterComment » ; de même, définissez le `PostCommentButton` du contrôle `ValidationGroup` propriété à « EnterComment ».</span><span class="sxs-lookup"><span data-stu-id="e518f-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="e518f-357">Pour plus d’informations sur ASP. Contrôles de validation de NET, consultez [Validation de formulaire dans ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [dissection les contrôles de Validation dans ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)et le [didacticiel de contrôles de Validation serveur](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) sur [W3Schools](http://www.w3schools.com/).</span><span class="sxs-lookup"><span data-stu-id="e518f-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="e518f-358">Après la création de l’interface utilisateur de balisage déclaratif de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e518f-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample8.aspx)]

<span data-ttu-id="e518f-359">Avec l’interface utilisateur complète, la tâche suivante consiste à insérer un nouvel enregistrement dans le `GuestbookComments` table lorsque le `PostCommentButton` est cliqué.</span><span class="sxs-lookup"><span data-stu-id="e518f-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="e518f-360">Cela peut être accompli de plusieurs façons : nous pouvons écrire du code ADO.NET dans le bouton `Click` Gestionnaire d’événements ; nous peut ajouter un contrôle SqlDataSource à la page, configurez sa `InsertCommand`, puis appelez ses `Insert` méthode à partir de la `Click` événement Gestionnaire ; ou nous pouvons créer un niveau intermédiaire qui a été chargé pour l’insertion de nouveaux commentaires du livre d’or et appeler cette fonctionnalité à partir du `Click` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="e518f-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="e518f-361">Étant donné que nous avons vu à l’aide d’un SqlDataSource à l’étape 3, utilisons ici le code ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="e518f-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-362">Les classes ADO.NET permet d’accéder par programmation aux données à partir d’une base de données Microsoft SQL Server se trouvent dans le `System.Data.SqlClient` espace de noms.</span><span class="sxs-lookup"><span data-stu-id="e518f-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="e518f-363">Vous devrez peut-être importer cet espace de noms de classe de code-behind de votre page (par exemple, `Imports System.Data.SqlClient`).</span><span class="sxs-lookup"><span data-stu-id="e518f-363">You may need to import this namespace into your page's code-behind class (i.e., `Imports System.Data.SqlClient`).</span></span>

<span data-ttu-id="e518f-364">Créer un gestionnaire d’événements pour le `PostCommentButton`de `Click` événement et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e518f-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample9.vb)]

<span data-ttu-id="e518f-365">Le `Click` Gestionnaire d’événements démarre en vérifiant que les données fournies par l’utilisateur soient valides.</span><span class="sxs-lookup"><span data-stu-id="e518f-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="e518f-366">Si elle n’est pas le cas, le Gestionnaire d’événements s’arrête avant d’insérer un enregistrement.</span><span class="sxs-lookup"><span data-stu-id="e518f-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="e518f-367">En supposant que les données fournies sont valides, l’utilisateur actuellement connecté `UserId` valeur est récupérée et stockée dans le `currentUserId` variable locale.</span><span class="sxs-lookup"><span data-stu-id="e518f-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="e518f-368">Cette valeur est nécessaire, car nous devons fournir un `UserId` valeur lors de l’insertion d’un enregistrement dans `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="e518f-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="e518f-369">Ensuite, la chaîne de connexion pour le `SecurityTutorials` base de données est récupérée à partir de `Web.config` et le `INSERT` instruction SQL est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e518f-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="e518f-370">Un `SqlConnection` objet est ensuite créé et ouvert.</span><span class="sxs-lookup"><span data-stu-id="e518f-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="e518f-371">Ensuite, un `SqlCommand` objet est construit et les valeurs pour les paramètres utilisés dans le `INSERT` requête sont affectés.</span><span class="sxs-lookup"><span data-stu-id="e518f-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="e518f-372">La `INSERT` instruction est exécutée et la connexion fermée.</span><span class="sxs-lookup"><span data-stu-id="e518f-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="e518f-373">À la fin du Gestionnaire d’événements, le `Subject` et `Body` zones de texte `Text` propriétés sont effacées afin que les valeurs de l’utilisateur ne sont pas persistants sur la publication (postback).</span><span class="sxs-lookup"><span data-stu-id="e518f-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="e518f-374">Continuons et tester cette page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="e518f-375">Étant donné que cette page est dans le `Membership` dossier n’est pas accessible pour les visiteurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e518f-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="e518f-376">Par conséquent, vous devez tout d’abord ouvrir une session (si vous n’avez pas déjà le cas).</span><span class="sxs-lookup"><span data-stu-id="e518f-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="e518f-377">Entrez une valeur dans le `Subject` et `Body` zones de texte et cliquez sur le `PostCommentButton` bouton.</span><span class="sxs-lookup"><span data-stu-id="e518f-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="e518f-378">Cela entraîne un nouvel enregistrement à ajouter à `GuestbookComments`.</span><span class="sxs-lookup"><span data-stu-id="e518f-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="e518f-379">Lors de la publication, l’objet et le corps que vous avez fourni sont réinitialisés à partir de zones de texte.</span><span class="sxs-lookup"><span data-stu-id="e518f-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="e518f-380">Après avoir cliqué sur le `PostCommentButton` bouton il n’est pas de signal visuel qui le commentaire a été ajouté pour le livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="e518f-381">Nous devons encore mettre à jour de cette page pour afficher les commentaires de livre d’or existants, que nous allons effectuer à l’étape 5.</span><span class="sxs-lookup"><span data-stu-id="e518f-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="e518f-382">Une fois que nous cela, le commentaire ajouté juste apparaîtra dans la liste des commentaires, la fourniture de commentaires visuels adéquates.</span><span class="sxs-lookup"><span data-stu-id="e518f-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="e518f-383">Pour l’instant, vérifiez que votre commentaire de livre d’or a été enregistré en examinant le contenu de la `GuestbookComments` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="e518f-384">Figure 17 illustre le contenu de la `GuestbookComments` après deux commentaires ont été laissés de table.</span><span class="sxs-lookup"><span data-stu-id="e518f-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>

<span data-ttu-id="e518f-385">[![Vous pouvez voir les commentaires du livre d’or dans la Table GuestbookComments](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span></span>

<span data-ttu-id="e518f-386">**Figure 17**: Vous pouvez voir les commentaires du livre d’or dans le `GuestbookComments` Table ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image51.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-387">Si un utilisateur tente d’insérer un commentaire de livre d’or contient potentiellement dangereuse balisage – tels que HTML, ASP.NET lève une `HttpRequestValidationException`.</span><span class="sxs-lookup"><span data-stu-id="e518f-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="e518f-388">Pour en savoir plus sur cette exception, pourquoi l’exception est levée, et comment permettre aux utilisateurs d’envoyer des valeurs potentiellement dangereuses, consultez le [livre blanc sur la Validation de demande](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="e518f-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>

## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="e518f-389">Étape 5 : Répertorier les commentaires du livre d’or existants</span><span class="sxs-lookup"><span data-stu-id="e518f-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="e518f-390">En plus de laisser des commentaires, un utilisateur visitant le `Guestbook.aspx` page doit également être en mesure d’afficher les commentaires existants du livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="e518f-391">Pour ce faire, ajoutez un contrôle ListView nommé `CommentList` vers le bas de la page.</span><span class="sxs-lookup"><span data-stu-id="e518f-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-392">Le contrôle ListView est une nouveauté pour ASP.NET version 3.5.</span><span class="sxs-lookup"><span data-stu-id="e518f-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="e518f-393">Il est conçu pour afficher une liste d’éléments dans une mise en page très personnalisable et flexible, mais offrent intégrés modification, insertion, suppression, la pagination et tri des fonctionnalités telles que le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e518f-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="e518f-394">Si vous utilisez ASP.NET 2.0, vous devez utiliser le contrôle DataList ou Repeater à la place.</span><span class="sxs-lookup"><span data-stu-id="e518f-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="e518f-395">Pour plus d’informations sur l’utilisation de la ListView, consultez [Scott Guthrie](https://weblogs.asp.net/scottgu/)d’entrée de blog, [le contrôle asp : ListView](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)et mon article, [affichage des données avec le contrôle ListView](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>

<span data-ttu-id="e518f-396">Ouvrez la balise active de la ListView et, dans la liste déroulante Choisir la Source de données, lier le contrôle à une source de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="e518f-397">Comme nous l’avons vu à l’étape 2, cette action lance l’Assistant de Configuration de Source de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="e518f-398">Sélectionnez l’icône de la base de données, le nom résultant SqlDataSource `CommentsDataSource`, puis cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="e518f-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="e518f-399">Ensuite, sélectionnez le `SecurityTutorialsConnectionString` connexion chaîne obtenue à partir de la liste déroulante et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="e518f-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="e518f-400">À ce stade à l’étape 2 nous avons spécifié les données à la requête par prélèvement le `UserProfiles` de table dans la liste déroulante et en sélectionnant les colonnes à retourner (voir la Figure 9).</span><span class="sxs-lookup"><span data-stu-id="e518f-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="e518f-401">Cette fois, cependant, nous souhaitons créer une instruction SQL qui extrait précédent non seulement les enregistrements à partir de `GuestbookComments`, mais également de commentateur ville natale, page d’accueil, la signature et nom d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="e518f-402">Par conséquent, sélectionnez la case d’option « Spécifier une instruction SQL personnalisée ou une procédure stockée » et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="e518f-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="e518f-403">Cela fera apparaître l’écran « Définir des instructions ou procédures stockées ».</span><span class="sxs-lookup"><span data-stu-id="e518f-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="e518f-404">Cliquez sur le bouton Générateur de requêtes pour créer graphiquement la requête.</span><span class="sxs-lookup"><span data-stu-id="e518f-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="e518f-405">Le Générateur de requêtes commence par celle-ci vous invite à spécifier les tables de que nous souhaitons interroger à partir.</span><span class="sxs-lookup"><span data-stu-id="e518f-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="e518f-406">Sélectionnez le `GuestbookComments`, `UserProfiles`, et `aspnet_Users` tables et cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="e518f-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="e518f-407">Cette opération ajoute les trois tables à l’aire de conception.</span><span class="sxs-lookup"><span data-stu-id="e518f-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="e518f-408">Dans la mesure où il existe des contraintes de clé étrangère entre la `GuestbookComments`, `UserProfiles`, et `aspnet_Users` des tables, le Générateur de requêtes automatiquement `JOIN` s ces tables.</span><span class="sxs-lookup"><span data-stu-id="e518f-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="e518f-409">Tout ce qui reste consiste à spécifier les colonnes à retourner.</span><span class="sxs-lookup"><span data-stu-id="e518f-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="e518f-410">À partir de la `GuestbookComments` select de la table le `Subject`, `Body`, et `CommentDate` colonnes ; retour le `HomeTown`, `HomepageUrl`, et `Signature` colonnes à partir de la `UserProfiles` table ; et retourner `UserName` à partir de `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="e518f-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="e518f-411">En outre, ajoutez «`ORDER BY CommentDate DESC`» à la fin de la `SELECT` interroger afin que les articles les plus récents sont retournées en premier.</span><span class="sxs-lookup"><span data-stu-id="e518f-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="e518f-412">Une fois ces sélections effectuées, votre interface de générateur de requêtes doit ressembler à la capture d’écran de la Figure 18.</span><span class="sxs-lookup"><span data-stu-id="e518f-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>

<span data-ttu-id="e518f-413">[![La requête construits joint le GuestbookComments, UserProfiles et aspnet_Users Tables](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span></span>

<span data-ttu-id="e518f-414">**Figure 18**: La requête construit `JOIN` s le `GuestbookComments`, `UserProfiles`, et `aspnet_Users` Tables ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image54.png))</span></span>

<span data-ttu-id="e518f-415">Cliquez sur OK pour fermer la fenêtre du Générateur de requêtes et de revenir à l’écran « Définir des instructions ou procédures stockées ».</span><span class="sxs-lookup"><span data-stu-id="e518f-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="e518f-416">Cliquez sur Suivant pour passer à l’écran « Requête de Test », où vous pouvez consulter les résultats de requête en cliquant sur le bouton Tester la requête.</span><span class="sxs-lookup"><span data-stu-id="e518f-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="e518f-417">Lorsque vous êtes prêt, cliquez sur Terminer pour terminer l’Assistant Configurer la Source de données.</span><span class="sxs-lookup"><span data-stu-id="e518f-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="e518f-418">Lorsque nous avons terminé l’Assistant Configurer la Source de données à le du étape 2, le contrôle DetailsView associé `Fields` regroupement a été mis à jour pour inclure un BoundField pour chaque colonne renvoyée par le `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="e518f-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="e518f-419">Toutefois, le ListView, demeure inchangé. Nous devons encore définir sa disposition.</span><span class="sxs-lookup"><span data-stu-id="e518f-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="e518f-420">Mise en page de la ListView peut être construite manuellement à partir de son balisage déclaratif ou de l’option « Configurer ListView » dans sa balise active.</span><span class="sxs-lookup"><span data-stu-id="e518f-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="e518f-421">J’ai généralement préférez définissant le balisage à la main, mais utiliser toute autre méthode qui est le plus naturel.</span><span class="sxs-lookup"><span data-stu-id="e518f-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="e518f-422">J’ai fini par à l’aide de ce qui suit `LayoutTemplate`, `ItemTemplate`, et `ItemSeparatorTemplate` pour mon contrôle ListView :</span><span class="sxs-lookup"><span data-stu-id="e518f-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample10.aspx)]

<span data-ttu-id="e518f-423">Le `LayoutTemplate` définit le balisage émis par le contrôle, tandis que le `ItemTemplate` restitue chaque élément retourné par SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="e518f-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="e518f-424">Le `ItemTemplate`de balisage qui en résulte est placé dans le `LayoutTemplate`de `itemPlaceholder` contrôle.</span><span class="sxs-lookup"><span data-stu-id="e518f-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="e518f-425">Outre le `itemPlaceholder`, le `LayoutTemplate` inclut un contrôle DataPager, ce qui limite le ListView à l’affichage des commentaires de livre d’or que 10 par page (il s’agit de la valeur par défaut) et affiche une interface de pagination.</span><span class="sxs-lookup"><span data-stu-id="e518f-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="e518f-426">Mon `ItemTemplate` affiche le sujet du commentaire de chaque livre d’or dans une `<h4>` élément avec le corps situé au-dessous de l’objet.</span><span class="sxs-lookup"><span data-stu-id="e518f-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="e518f-427">Notez que syntaxe permettant d’afficher le corps prend les données retournées par le `Eval("Body")` instruction de liaison de données, il convertit en une chaîne et les sauts de ligne de la remplace par le `<br />` élément.</span><span class="sxs-lookup"><span data-stu-id="e518f-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="e518f-428">Cette conversion est nécessaire pour afficher les sauts de ligne entrés lors de la soumission du commentaire dans la mesure où un espace blanc est ignoré par HTML.</span><span class="sxs-lookup"><span data-stu-id="e518f-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="e518f-429">Signature de l’utilisateur est affiché sous le corps en italique, suivi par ville accueil de l’utilisateur, un lien vers sa page d’accueil, la date et heure que le commentaire a été effectué et le nom d’utilisateur de la personne ayant laissé le commentaire.</span><span class="sxs-lookup"><span data-stu-id="e518f-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="e518f-430">Prenez un moment pour afficher la page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="e518f-431">Vous devez voir les commentaires que vous avez ajouté pour le livre d’or à l’étape 5 affichés ici.</span><span class="sxs-lookup"><span data-stu-id="e518f-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>

<span data-ttu-id="e518f-432">[![Les commentaires du livre d’or affiche à présent de GuestBook.aspx](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span></span>

<span data-ttu-id="e518f-433">**Figure 19**: `Guestbook.aspx` Affiche maintenant les commentaires du livre d’or ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-vb/_static/image57.png))</span></span>

<span data-ttu-id="e518f-434">Essayez d’ajouter un nouveau commentaire à du livre d’or.</span><span class="sxs-lookup"><span data-stu-id="e518f-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="e518f-435">Lorsque vous cliquez sur le `PostCommentButton` bouton la page effectue une publication automatique et le commentaire est ajouté à la base de données, mais le contrôle ListView n’est pas mis à jour pour afficher le nouveau commentaire.</span><span class="sxs-lookup"><span data-stu-id="e518f-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="e518f-436">Cela peut être résolu à l’aide :</span><span class="sxs-lookup"><span data-stu-id="e518f-436">This can be fixed by either:</span></span>

- <span data-ttu-id="e518f-437">La mise à jour le `PostCommentButton` du bouton `Click` Gestionnaire d’événements afin qu’elle appelle le contrôle ListView `DataBind()` méthode après avoir inséré le nouveau commentaire dans la base de données, ou</span><span class="sxs-lookup"><span data-stu-id="e518f-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="e518f-438">Définition du contrôle ListView `EnableViewState` propriété `False`.</span><span class="sxs-lookup"><span data-stu-id="e518f-438">Setting the ListView control's `EnableViewState` property to `False`.</span></span> <span data-ttu-id="e518f-439">Cette approche fonctionne, car en désactivant l’état d’affichage du contrôle, il doit relier aux données sous-jacentes à chaque publication.</span><span class="sxs-lookup"><span data-stu-id="e518f-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="e518f-440">Le site Web du didacticiel téléchargeable à partir de ce didacticiel illustre ces deux techniques.</span><span class="sxs-lookup"><span data-stu-id="e518f-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="e518f-441">Le contrôle ListView `EnableViewState` propriété `False` et le code nécessaire pour relier par programmation les données pour le ListView est présent dans le `Click` Gestionnaire d’événements, mais il est commenté.</span><span class="sxs-lookup"><span data-stu-id="e518f-441">The ListView control's `EnableViewState` property to `False` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-442">Actuellement le `AdditionalUserInfo.aspx` page permet à l’utilisateur afficher et modifier leurs paramètres town, page d’accueil et signature domestiques.</span><span class="sxs-lookup"><span data-stu-id="e518f-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="e518f-443">Il peut être utile mettre à jour `AdditionalUserInfo.aspx` à afficher connecté dans les commentaires de livre d’or de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="e518f-444">Autrement dit, en plus d’examiner et de modifier ses informations, un utilisateur peut visiter le `AdditionalUserInfo.aspx` page pour consulter le livre d’or commentaires qu’elle est effectuée dans le passé.</span><span class="sxs-lookup"><span data-stu-id="e518f-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="e518f-445">Je laisse cela en guise d’exercice pour les lecteurs que cela intéresse.</span><span class="sxs-lookup"><span data-stu-id="e518f-445">I leave this as an exercise for the interested reader.</span></span>

## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="e518f-446">Étape 6 : Personnalisation du contrôle CreateUserWizard pour inclure une Interface pour le Home Town, la page d’accueil et la Signature</span><span class="sxs-lookup"><span data-stu-id="e518f-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="e518f-447">Le `SELECT` requête utilisée par le `Guestbook.aspx` page utilise un `INNER JOIN` pour combiner les enregistrements associés entre les `GuestbookComments`, `UserProfiles`, et `aspnet_Users` tables.</span><span class="sxs-lookup"><span data-stu-id="e518f-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="e518f-448">Si un utilisateur qui n’a aucun enregistrement dans `UserProfiles` effectue un livre d’or de commentaire, le commentaire ne s’afficheront dans le ListView, car le `INNER JOIN` retourne uniquement `GuestbookComments` enregistrements lorsqu’il existe des enregistrements correspondants dans `UserProfiles` et `aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="e518f-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="e518f-449">Et comme nous l’avons vu à l’étape 3, si un utilisateur ne dispose pas d’un enregistrement dans `UserProfiles` elle ne peut pas afficher ou modifier ses paramètres dans le `AdditionalUserInfo.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="e518f-450">Inutile de dire que, en raison de notre conception décisions, il est important que chaque compte d’utilisateur dans le système d’appartenance qui ont une correspondance enregistrent dans le `UserProfiles` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="e518f-451">Ce que nous voulons concerne un enregistrement correspondant à ajouter à `UserProfiles` chaque fois qu’un nouveau compte d’utilisateur d’appartenance est créé via le contrôle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="e518f-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="e518f-452">Comme indiqué dans le [ *création de comptes utilisateur* ](creating-user-accounts-vb.md) (didacticiel), une fois le nouveau compte d’utilisateur d’appartenance est créé le contrôle CreateUserWizard déclenche son [ `CreatedUser` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="e518f-453">Nous pouvons créer un gestionnaire d’événements pour cet événement, obtenir l’ID d’utilisateur pour l’utilisateur nouvellement créé, puis insérer un enregistrement dans le `UserProfiles` table avec les valeurs par défaut pour le `HomeTown`, `HomepageUrl`, et `Signature` colonnes.</span><span class="sxs-lookup"><span data-stu-id="e518f-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="e518f-454">De plus, il est possible pour inviter l’utilisateur à ces valeurs en personnalisant l’interface du contrôle CreateUserWizard pour inclure des zones de texte supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="e518f-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="e518f-455">Commençons par examiner comment ajouter une nouvelle ligne à la `UserProfiles` table dans le `CreatedUser` Gestionnaire d’événements avec les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="e518f-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="e518f-456">Ensuite, nous verrons comment personnaliser l’interface utilisateur du contrôle CreateUserWizard pour inclure des champs de formulaire supplémentaires pour collecter la ville natale, page d’accueil et signature du nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="e518f-457">Ajout d’une ligne par défaut pour`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="e518f-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="e518f-458">Dans le [ *création de comptes utilisateur* ](creating-user-accounts-vb.md) didacticiel, nous avons ajouté un contrôle CreateUserWizard pour le `CreatingUserAccounts.aspx` page dans le `Membership` dossier.</span><span class="sxs-lookup"><span data-stu-id="e518f-458">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="e518f-459">Pour disposer le contrôle CreateUserWizard contrôle ajouter un enregistrement à `UserProfiles` table lors de la création de compte utilisateur, nous devons mettre à jour les fonctionnalités du contrôle CreateUserWizard.</span><span class="sxs-lookup"><span data-stu-id="e518f-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="e518f-460">Plutôt que d’effectuer ces modifications sur le `CreatingUserAccounts.aspx` page, nous allons ajouter à la place un nouveau contrôle CreateUserWizard à `EnhancedCreateUserWizard.aspx` page et apportez les modifications pour ce didacticiel il.</span><span class="sxs-lookup"><span data-stu-id="e518f-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="e518f-461">Ouvrez le `EnhancedCreateUserWizard.aspx` page dans Visual Studio et faites glisser un contrôle CreateUserWizard à partir de la boîte à outils vers la page.</span><span class="sxs-lookup"><span data-stu-id="e518f-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="e518f-462">Définir le contrôle CreateUserWizard `ID` propriété `NewUserWizard`.</span><span class="sxs-lookup"><span data-stu-id="e518f-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="e518f-463">Comme expliqué dans la [ *création de comptes utilisateur* ](creating-user-accounts-vb.md) didacticiel, l’interface utilisateur de CreateUserWizard par défaut vous invite à entrer le visiteur pour les informations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="e518f-463">As we discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="e518f-464">Une fois que ces informations ont été fournies, le contrôle crée en interne un nouveau compte d’utilisateur dans le cadre de l’appartenance, tout cela sans nous avoir à écrire une seule ligne de code.</span><span class="sxs-lookup"><span data-stu-id="e518f-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="e518f-465">Le contrôle CreateUserWizard élève un nombre d’événements au cours de son flux de travail.</span><span class="sxs-lookup"><span data-stu-id="e518f-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="e518f-466">Une fois un visiteur fournit des informations de la demande et envoie le formulaire, le contrôle CreateUserWizard initialement déclenche son [ `CreatingUser` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="e518f-467">S’il existe un problème pendant le processus de création, le [ `CreateUserError` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) est déclenché ; Toutefois, si l’utilisateur est créé avec succès, puis le [ `CreatedUser` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) est déclenché.</span><span class="sxs-lookup"><span data-stu-id="e518f-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="e518f-468">Dans le [ *création de comptes utilisateur* ](creating-user-accounts-vb.md) didacticiel, nous avons créé un gestionnaire d’événements pour le `CreatingUser` événements pour vous assurer que le nom d’utilisateur fourni ne contenait pas un leader ou espaces et fin qui le nom d’utilisateur n’apparaît pas n’importe où dans le mot de passe.</span><span class="sxs-lookup"><span data-stu-id="e518f-468">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="e518f-469">Pour ajouter une ligne dans le `UserProfiles` table pour l’utilisateur récemment créée, nous devons créer un gestionnaire d’événements pour le `CreatedUser` événement.</span><span class="sxs-lookup"><span data-stu-id="e518f-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="e518f-470">Au moment où le `CreatedUser` événement a été déclenché, le compte d’utilisateur a déjà été créé dans le cadre de l’appartenance, nous permet de récupérer la valeur d’ID d’utilisateur du compte.</span><span class="sxs-lookup"><span data-stu-id="e518f-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="e518f-471">Créer un gestionnaire d’événements pour le `NewUserWizard`de `CreatedUser` événement et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e518f-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample11.vb)]

<span data-ttu-id="e518f-472">Êtres de code ci-dessus en récupérant l’ID d’utilisateur du compte d’utilisateur juste-ajouté.</span><span class="sxs-lookup"><span data-stu-id="e518f-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="e518f-473">Cela est accompli en utilisant le `Membership.GetUser(username)` méthode pour retourner des informations concernant un utilisateur particulier, puis en utilisant le `ProviderUserKey` propriété à récupérer leur ID d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="e518f-474">Le nom d’utilisateur entré par l’utilisateur dans le contrôle CreateUserWizard est disponible via son [ `UserName` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="e518f-475">Ensuite, la chaîne de connexion est récupérée à partir de `Web.config` et `INSERT` instruction est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e518f-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="e518f-476">Les objets ADO.NET sont instanciés et la commande exécutée.</span><span class="sxs-lookup"><span data-stu-id="e518f-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="e518f-477">Le code assigne un [ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx) l’instance à la `@HomeTown`, `@HomepageUrl`, et `@Signature` paramètres, ce qui a pour effet de l’insertion de base de données `NULL` valeurs pour le `HomeTown`, `HomepageUrl`, et `Signature` champs.</span><span class="sxs-lookup"><span data-stu-id="e518f-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="e518f-478">Visitez le `EnhancedCreateUserWizard.aspx` page via un navigateur et créer un nouveau compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="e518f-479">Après cela, retournez dans Visual Studio et examinez le contenu de la `aspnet_Users` et `UserProfiles` tables (par exemple, nous l’avons fait dans la Figure 12).</span><span class="sxs-lookup"><span data-stu-id="e518f-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="e518f-480">Vous devez voir le nouveau compte d’utilisateur dans `aspnet_Users` et correspondante `UserProfiles` ligne (avec `NULL` valeurs pour `HomeTown`, `HomepageUrl`, et `Signature`).</span><span class="sxs-lookup"><span data-stu-id="e518f-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>

<span data-ttu-id="e518f-481">[![Un nouveau compte d’utilisateur et un enregistrement de UserProfiles ont été ajoutés.](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span></span>

<span data-ttu-id="e518f-482">**Figure 20**: Un nouveau compte d’utilisateur et `UserProfiles` enregistrement ont été ajoutés ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-vb/_static/image60.png))</span></span>

<span data-ttu-id="e518f-483">Une fois que le visiteur a fourni des informations sur son nouveau compte et cliqué sur le bouton « Create User », le compte d’utilisateur est créé et une ligne ajoutée à la `UserProfiles` table.</span><span class="sxs-lookup"><span data-stu-id="e518f-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="e518f-484">CreateUserWizard puis affiche son `CompleteWizardStep`, ce qui affiche un message de réussite et un bouton Continuer.</span><span class="sxs-lookup"><span data-stu-id="e518f-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="e518f-485">En cliquant sur le bouton Continuer entraîne une publication, mais aucune action n’est effectuée, en laissant de l’utilisateur bloqué sur le `EnhancedCreateUserWizard.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="e518f-486">Nous pouvons spécifier une URL pour envoyer l’utilisateur lorsque vous cliquez sur le bouton Continuer via le contrôle CreateUserWizard [ `ContinueDestinationPageUrl` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="e518f-487">Définir le `ContinueDestinationPageUrl` propriété à « ~ / Membership/AdditionalUserInfo.aspx ».</span><span class="sxs-lookup"><span data-stu-id="e518f-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="e518f-488">Accédez au nouvel utilisateur `AdditionalUserInfo.aspx`, où ils peuvent afficher et mettre à jour leurs paramètres.</span><span class="sxs-lookup"><span data-stu-id="e518f-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="e518f-489">Personnalisation d’Interface de CreateUserWizard à l’invite pour le nouvel utilisateur Home Town, page d’accueil et Signature</span><span class="sxs-lookup"><span data-stu-id="e518f-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="e518f-490">L’interface par défaut du contrôle CreateUserWizard est suffisant pour les scénarios de création de compte simple où seules informations de compte d’utilisateur core comme nom d’utilisateur, mot de passe et e-mail doivent être collectées.</span><span class="sxs-lookup"><span data-stu-id="e518f-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="e518f-491">Mais que se passe-t-il si nous souhaitons inviter le visiteur à entrer son ville natale, la page d’accueil et la signature lors de la création de son compte ?</span><span class="sxs-lookup"><span data-stu-id="e518f-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="e518f-492">Il est possible de personnaliser l’interface du contrôle CreateUserWizard pour collecter des informations supplémentaires à l’inscription, et ces informations peuvent être utilisées dans le `CreatedUser` Gestionnaire d’événements pour insérer des enregistrements supplémentaires dans la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="e518f-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="e518f-493">Le contrôle CreateUserWizard étend le contrôle de l’Assistant ASP.NET, qui est un contrôle qui permet à un développeur de page définir une série d’ordonnée `WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="e518f-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="e518f-494">Le contrôle de l’Assistant affiche l’étape active et fournit une interface de navigation qui permet le visiteur pour vous déplacer dans ces étapes.</span><span class="sxs-lookup"><span data-stu-id="e518f-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="e518f-495">Le contrôle de l’Assistant est idéal pour décomposer une tâche long en plusieurs étapes.</span><span class="sxs-lookup"><span data-stu-id="e518f-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="e518f-496">Pour plus d’informations sur le contrôle de l’Assistant, consultez [création d’une Interface utilisateur de pas à pas avec le contrôle de l’Assistant ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="e518f-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="e518f-497">Balisage de par défaut du contrôle CreateUserWizard définit deux `WizardSteps`: `CreateUserWizardStep` et `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample12.aspx)]

<span data-ttu-id="e518f-498">La première `WizardStep`, `CreateUserWizardStep`, restitue l’interface qui vous invite à entrer le nom d’utilisateur, mot de passe, e-mail, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e518f-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="e518f-499">Une fois le visiteur fournit ces informations et clique sur « Créer un utilisateur », elle s’affiche le `CompleteWizardStep`, qui affiche le message de réussite et un bouton Continuer.</span><span class="sxs-lookup"><span data-stu-id="e518f-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="e518f-500">Pour personnaliser l’interface du contrôle CreateUserWizard pour inclure d’autres champs du formulaire, nous pouvons :</span><span class="sxs-lookup"><span data-stu-id="e518f-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="e518f-501"><strong>Créer un ou plusieurs nouveaux</strong><strong>`WizardStep`</strong><strong>s pour contenir les éléments d’interface utilisateur</strong>.</span><span class="sxs-lookup"><span data-stu-id="e518f-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="e518f-502">Pour ajouter un nouveau `WizardStep` pour le contrôle CreateUserWizard, cliquez sur le « Ajout/suppression `WizardStep` s « lien à partir de sa balise active pour lancer le `WizardStep` éditeur de collections.</span><span class="sxs-lookup"><span data-stu-id="e518f-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardStep` s" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="e518f-503">À partir de là, vous pouvez ajouter, supprimer ou réorganiser les étapes dans l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="e518f-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="e518f-504">Il s’agit de l’approche que nous utiliserons pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e518f-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="e518f-505"><strong>Convertir le</strong><strong>`CreateUserWizardStep`</strong><strong>dans une liste modifiable</strong><strong>`WizardStep`</strong><strong>.</strong></span><span class="sxs-lookup"><span data-stu-id="e518f-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="e518f-506">Cela remplace le `CreateUserWizardStep` avec un équivalent `WizardStep` dont balisage définit une interface utilisateur qui correspond à la `CreateUserWizardStep`' s.</span><span class="sxs-lookup"><span data-stu-id="e518f-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="e518f-507">En convertissant le `CreateUserWizardStep` dans un `WizardStep` nous pouvons repositionner les contrôles ou ajouter des éléments d’interface utilisateur supplémentaires à cette étape.</span><span class="sxs-lookup"><span data-stu-id="e518f-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="e518f-508">Pour convertir le `CreateUserWizardStep` ou `CompleteWizardStep` dans une liste modifiable `WizardStep`, cliquez sur « Créer un utilisateur personnaliser Step » ou « Personnaliser l’étape » lien à partir de la balise active du contrôle.</span><span class="sxs-lookup"><span data-stu-id="e518f-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="e518f-509">**Utiliser une combinaison des deux options ci-dessus.**</span><span class="sxs-lookup"><span data-stu-id="e518f-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="e518f-510">Une chose importante à garder à l’esprit est que le contrôle CreateUserWizard exécute son processus de création de compte utilisateur lorsque le bouton « Create User » est activé depuis son `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="e518f-511">Peu importe si d’autres `WizardStep` s après le `CreateUserWizardStep` ou non.</span><span class="sxs-lookup"><span data-stu-id="e518f-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="e518f-512">Lorsque vous ajoutez un personnalisé `WizardStep` au contrôle CreateUserWizard pour recueillir les entrées d’utilisateur supplémentaires, personnalisé `WizardStep` peut être placé avant ou après le `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="e518f-513">Si elle vient avant le `CreateUserWizardStep` puis l’entrée d’utilisateur supplémentaires collectées à partir de personnalisé `WizardStep` est disponible pour le `CreatedUser` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="e518f-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="e518f-514">Toutefois, si personnalisé `WizardStep` vient après `CreateUserWizardStep` puis par l’heure personnalisé `WizardStep` s’affiche le nouveau compte d’utilisateur a déjà été créé et le `CreatedUser` événement a déjà été déclenché.</span><span class="sxs-lookup"><span data-stu-id="e518f-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="e518f-515">La figure 21 illustre le flux de travail lors de l’ajout `WizardStep` précède le `CreateUserWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="e518f-516">Étant donné que les informations utilisateur supplémentaires ont été collectées par le temps le `CreatedUser` événement est déclenché, il nous suffit est mise à jour le `CreatedUser` Gestionnaire d’événements à récupérer ces entrées et utilisez-les pour le `INSERT` les valeurs de paramètre de l’instruction (au lieu de `DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="e518f-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>

<span data-ttu-id="e518f-517">[![Le flux de travail CreateUserWizard quand un WizardStep supplémentaire précède le CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span></span>

<span data-ttu-id="e518f-518">**Figure 21**: CreateUserWizard Workflow lorsqu’un supplémentaires `WizardStep` Precedes le `CreateUserWizardStep` ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image63.png))</span></span>

<span data-ttu-id="e518f-519">Si personnalisé `WizardStep` est placé *après* le `CreateUserWizardStep`, toutefois, le processus de compte d’utilisateur créer se produit avant que l’utilisateur a eu l’occasion d’entrer son ville natale, la page d’accueil ou la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="e518f-520">Dans ce cas, ces informations supplémentaires doivent être insérées dans la base de données une fois que le compte d’utilisateur a été créé, comme l’illustre la Figure 22.</span><span class="sxs-lookup"><span data-stu-id="e518f-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>

<span data-ttu-id="e518f-521">[![Le flux de travail CreateUserWizard quand un WizardStep supplémentaire vient après le CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span></span>

<span data-ttu-id="e518f-522">**Figure 22**: CreateUserWizard Workflow lorsqu’un supplémentaires `WizardStep` est fourni après le `CreateUserWizardStep` ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image66.png))</span></span>

<span data-ttu-id="e518f-523">Le workflow illustré à la Figure 22 attend pour insérer un enregistrement dans le `UserProfiles` jusqu'à ce que la table issue de l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="e518f-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="e518f-524">Si le visiteur ferme son navigateur après l’étape 1, toutefois, nous sera ont atteint un état où un compte d’utilisateur a été créé, mais aucun enregistrement a été ajouté à `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="e518f-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="e518f-525">Une solution de contournement consiste à disposer d’un enregistrement avec `NULL` ou par défaut les valeurs insérées dans `UserProfiles` dans le `CreatedUser` Gestionnaire d’événements (qui se déclenche après l’étape 1), puis mettez à jour ce enregistrer une fois que l’étape 2 est terminée.</span><span class="sxs-lookup"><span data-stu-id="e518f-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="e518f-526">Cela garantit qu’un `UserProfiles` enregistrement est ajouté pour le compte d’utilisateur, même si l’utilisateur quitte l’inscription processus au milieu.</span><span class="sxs-lookup"><span data-stu-id="e518f-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="e518f-527">Pour ce didacticiel nous allons créer un `WizardStep` qui se produit après la `CreateUserWizardStep` , mais avant le `CompleteWizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="e518f-528">Commencez par en obtenir la WizardStep dans placer et configuré, puis nous allons nous allons examiner le code.</span><span class="sxs-lookup"><span data-stu-id="e518f-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="e518f-529">À partir de la balise active du contrôle CreateUserWizard, sélectionnez le « Ajout/suppression `WizardStep` s », qui fait apparaître le `WizardStep` boîte de dialogue Éditeur de Collection.</span><span class="sxs-lookup"><span data-stu-id="e518f-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="e518f-530">Ajouter un nouveau `WizardStep`, ce qui affecte ses `ID` à `UserSettings`, ses `Title` à « Paramètres de votre » et ses `StepType` à `Step`.</span><span class="sxs-lookup"><span data-stu-id="e518f-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="e518f-531">Puis de les positionner afin qu’il vient après le `CreateUserWizardStep` (« s’abonner pour votre nouveau compte ») et avant le `CompleteWizardStep` (« Complete »), comme illustré dans la Figure 23.</span><span class="sxs-lookup"><span data-stu-id="e518f-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>

<span data-ttu-id="e518f-532">[![Ajouter un nouveau WizardStep au contrôle CreateUserWizard](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="e518f-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span></span>

<span data-ttu-id="e518f-533">**Figure 23**: Ajout d’un nouveau `WizardStep` au contrôle CreateUserWizard ([cliquez pour afficher l’image en taille réelle](storing-additional-user-information-vb/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="e518f-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-vb/_static/image69.png))</span></span>

<span data-ttu-id="e518f-534">Cliquez sur OK pour fermer la `WizardStep` boîte de dialogue Éditeur de Collection.</span><span class="sxs-lookup"><span data-stu-id="e518f-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="e518f-535">La nouvelle `WizardStep` atteste de balisage déclaratif mis à jour du contrôle CreateUserWizard :</span><span class="sxs-lookup"><span data-stu-id="e518f-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample13.aspx)]

<span data-ttu-id="e518f-536">Notez la nouvelle `<asp:WizardStep>` élément.</span><span class="sxs-lookup"><span data-stu-id="e518f-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="e518f-537">Nous devons ajouter l’interface utilisateur pour collecter le nouvel utilisateur ville natale, page d’accueil et signature ici.</span><span class="sxs-lookup"><span data-stu-id="e518f-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="e518f-538">Vous pouvez entrer ce contenu dans la syntaxe déclarative ou par le biais du concepteur.</span><span class="sxs-lookup"><span data-stu-id="e518f-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="e518f-539">Pour utiliser le concepteur, sélectionnez l’étape « Vos paramètres » dans la liste déroulante dans la balise active pour voir l’étape dans le concepteur.</span><span class="sxs-lookup"><span data-stu-id="e518f-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-540">Sélection d’une étape de la liste déroulante de la balise active par le biais des mises à jour le contrôle CreateUserWizard [ `ActiveStepIndex` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), qui spécifie l’index de l’étape de départ.</span><span class="sxs-lookup"><span data-stu-id="e518f-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="e518f-541">Par conséquent, si vous utilisez cette liste déroulante pour modifier l’étape « Vos paramètres » dans le concepteur, veillez à définir sur « Sign Up for votre nouveau compte » afin que cette étape s’affiche lorsque les utilisateurs visitent tout d’abord le `EnhancedCreateUserWizard.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="e518f-542">Créer une interface utilisateur dans l’étape « Vos paramètres » qui contient trois contrôles TextBox nommés `HomeTown`, `HomepageUrl`, et `Signature`.</span><span class="sxs-lookup"><span data-stu-id="e518f-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="e518f-543">Après la construction de cette interface, balisage déclaratif de CreateUserWizard doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e518f-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample14.aspx)]

<span data-ttu-id="e518f-544">Continuez et visitez cette page via un navigateur et créer un nouveau compte utilisateur, en spécifiant des valeurs pour la ville natale, la page d’accueil et la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="e518f-545">Après avoir effectué la `CreateUserWizardStep` le compte d’utilisateur est créé dans le cadre de l’appartenance et la `CreatedUser` événement gestionnaire s’exécute, ce qui ajoute une nouvelle ligne à `UserProfiles`, mais avec une base de données `NULL` valeur pour `HomeTown`, `HomepageUrl`, et `Signature`.</span><span class="sxs-lookup"><span data-stu-id="e518f-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="e518f-546">Les valeurs entrées pour la ville natale, la page d’accueil et la signature ne sont jamais utilisés.</span><span class="sxs-lookup"><span data-stu-id="e518f-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="e518f-547">Le résultat net est un nouveau compte d’utilisateur avec un `UserProfiles` enregistrer dont `HomeTown`, `HomepageUrl`, et `Signature` champs qui doivent être spécifiés.</span><span class="sxs-lookup"><span data-stu-id="e518f-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="e518f-548">Nous avons besoin d’exécuter du code après l’étape « Vos paramètres » qui prend les valeurs de ville, honepage et signature accueil entrés par l’utilisateur et met à jour approprié `UserProfiles` enregistrement.</span><span class="sxs-lookup"><span data-stu-id="e518f-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="e518f-549">Chaque fois que l’utilisateur se déplace entre les étapes de l’Assistant contrôle, l’Assistant [ `ActiveStepChanged` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) se déclenche.</span><span class="sxs-lookup"><span data-stu-id="e518f-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="e518f-550">Nous pouvons créer un gestionnaire d’événements pour cet événement et la mise à jour le `UserProfiles` table lors de l’étape « Vos paramètres » est terminée.</span><span class="sxs-lookup"><span data-stu-id="e518f-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="e518f-551">Ajouter un gestionnaire d’événements pour le CreateUserWizard `ActiveStepChanged` événement et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e518f-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample15.vb)]

<span data-ttu-id="e518f-552">Le code ci-dessus commence par déterminer si nous avons atteint l’étape « Terminé ».</span><span class="sxs-lookup"><span data-stu-id="e518f-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="e518f-553">Étant donné que l’étape « Terminé » se produit immédiatement après l’étape « Vos paramètres », puis lorsque le visiteur atteint « Complete » détaillé qui signifie qu’elle vient de terminer à l’étape « Vos paramètres ».</span><span class="sxs-lookup"><span data-stu-id="e518f-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="e518f-554">Dans ce cas, nous devons référencer par programme les contrôles de zone de texte dans le `UserSettings WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="e518f-555">Pour cela utiliser d’abord le `FindControl` méthode à référencer par programme le `UserSettings WizardStep`, puis à nouveau pour référencer les zones de texte à partir la `WizardStep`.</span><span class="sxs-lookup"><span data-stu-id="e518f-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="e518f-556">Une fois que les zones de texte ont été référencés, nous sommes prêts à exécuter le `UPDATE` instruction.</span><span class="sxs-lookup"><span data-stu-id="e518f-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="e518f-557">Le `UPDATE` instruction a le même nombre de paramètres que ceux du `INSERT` instruction dans le `CreatedUser` Gestionnaire d’événements, mais ici, nous utilisons les valeurs de ville, page d’accueil et signature accueil fournies par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="e518f-558">Avec ce gestionnaire d’événements en place, visitez le `EnhancedCreateUserWizard.aspx` page via un navigateur et créer un nouveau compte d’utilisateur spécifiant des valeurs pour la ville natale, la page d’accueil et la signature.</span><span class="sxs-lookup"><span data-stu-id="e518f-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="e518f-559">Après avoir créé le nouveau compte, vous devez être redirigé vers le `AdditionalUserInfo.aspx` page, où les entrées juste accueil town, page d’accueil et signature informations s’affichent.</span><span class="sxs-lookup"><span data-stu-id="e518f-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="e518f-560">Notre site Web a actuellement deux pages à partir de laquelle un visiteur peut créer un nouveau compte : `CreatingUserAccounts.aspx` et `EnhancedCreateUserWizard.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e518f-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="e518f-561">Page de connexion et le plan de site du site Web pointent vers le `CreatingUserAccounts.aspx` page, mais la `CreatingUserAccounts.aspx` page n’invite pas l’utilisateur pour obtenir ses informations de ville, page d’accueil et signature domestiques et n’ajoute pas d’une ligne correspondante à `UserProfiles`.</span><span class="sxs-lookup"><span data-stu-id="e518f-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="e518f-562">Par conséquent, mettre à jour le `CreatingUserAccounts.aspx` page afin qu’il offre cette fonctionnalité ou de mettre à jour de la page plan de site et de connexion pour faire référence à `EnhancedCreateUserWizard.aspx` au lieu de `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e518f-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="e518f-563">Si vous choisissez cette dernière option, veillez à mettre à jour le `Membership` du dossier `Web.config` fichier afin d’autoriser l’accès aux utilisateurs anonymes le `EnhancedCreateUserWizard.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e518f-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>

## <a name="summary"></a><span data-ttu-id="e518f-564">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="e518f-564">Summary</span></span>

<span data-ttu-id="e518f-565">Dans ce didacticiel, nous avons vu les techniques de modélisation des données relatives aux comptes d’utilisateurs dans le cadre de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e518f-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="e518f-566">En particulier, nous avons vu de modélisation des entités qui partagent une relation un-à-plusieurs avec des comptes d’utilisateur, ainsi que des données qui partagent une relation un à un.</span><span class="sxs-lookup"><span data-stu-id="e518f-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="e518f-567">En outre, nous avons vu comment cela lié informations peuvent être affichées, insérées et mis à jour, avec quelques exemples utilisant le contrôle SqlDataSource et autres à l’aide de code ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="e518f-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="e518f-568">Ce didacticiel termine la présentation des comptes d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e518f-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="e518f-569">En commençant par le didacticiel suivant, nous sera porter notre attention aux rôles.</span><span class="sxs-lookup"><span data-stu-id="e518f-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="e518f-570">Le prochain plusieurs didacticiels, nous allons examiner le framework de rôles, consultez Comment créer de nouveaux rôles, comment attribuer des rôles aux utilisateurs, comment pour déterminer quels rôles un utilisateur appartient à et pour appliquer l’autorisation par rôle.</span><span class="sxs-lookup"><span data-stu-id="e518f-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="e518f-571">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="e518f-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e518f-572">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="e518f-572">Further Reading</span></span>

<span data-ttu-id="e518f-573">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="e518f-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e518f-574">L’accès et la mise à jour des données dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e518f-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="e518f-575">Contrôle de l’Assistant 2.0 ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e518f-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="e518f-576">Création d’une Interface utilisateur pas à pas avec le contrôle de l’Assistant 2.0 ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e518f-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="e518f-577">Création de paramètres de contrôle de source de données personnalisé</span><span class="sxs-lookup"><span data-stu-id="e518f-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="e518f-578">Personnalisation du contrôle CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="e518f-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="e518f-579">Démarrages rapides de contrôle DetailsView</span><span class="sxs-lookup"><span data-stu-id="e518f-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="e518f-580">Affichage des données avec le contrôle ListView</span><span class="sxs-lookup"><span data-stu-id="e518f-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="e518f-581">DISSECTION les contrôles de Validation dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e518f-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="e518f-582">Insertion de modification et suppression de données</span><span class="sxs-lookup"><span data-stu-id="e518f-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="e518f-583">Validation de formulaire dans ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e518f-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="e518f-584">Collecte des informations de l’enregistrement d’utilisateur personnalisées</span><span class="sxs-lookup"><span data-stu-id="e518f-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="e518f-585">Profils dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e518f-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="e518f-586">Le contrôle asp : ListView</span><span class="sxs-lookup"><span data-stu-id="e518f-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="e518f-587">Démarrage rapide de profils utilisateur</span><span class="sxs-lookup"><span data-stu-id="e518f-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="e518f-588">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="e518f-588">About the Author</span></span>

<span data-ttu-id="e518f-589">Scott Mitchell, auteur de plusieurs livres sur ASP/ASP.NET et fondateur de 4GuysFromRolla.com, travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="e518f-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e518f-590">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="e518f-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e518f-591">Son dernier ouvrage est *[SAM animer vous-même ASP.NET 2.0 des dernières 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="e518f-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="e518f-592">Scott peut être atteint à [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou via son blog à [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="e518f-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="e518f-593">Remerciements particuliers à...</span><span class="sxs-lookup"><span data-stu-id="e518f-593">Special Thanks To…</span></span>

<span data-ttu-id="e518f-594">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="e518f-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e518f-595">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="e518f-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e518f-596">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="e518f-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e518f-597">Précédent</span><span class="sxs-lookup"><span data-stu-id="e518f-597">Previous</span></span>](user-based-authorization-vb.md)
