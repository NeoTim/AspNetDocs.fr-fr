---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
title: Rubriques avancées (VB) et Configuration de l’authentification de formulaires | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous examiner les différents paramètres d’authentification de formulaires et voir comment les modifier dans l’élément de formulaires. Cette suppression entraîne une détaillées...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: 829d2f56-5c48-445b-b826-3418a450c788
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-vb
msc.type: authoredcontent
ms.openlocfilehash: 45e924559a88317950ae9fb8a596d3ee373dd661
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65127841"
---
# <a name="forms-authentication-configuration-and-advanced-topics-vb"></a><span data-ttu-id="e79e5-104">Configuration et questions avancées de l’authentification par formulaire (VB)</span><span class="sxs-lookup"><span data-stu-id="e79e5-104">Forms Authentication Configuration and Advanced Topics (VB)</span></span>

<span data-ttu-id="e79e5-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e79e5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e79e5-106">[Télécharger le Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) ou [télécharger le PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="e79e5-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_VB.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_vb.pdf)</span></span>

> <span data-ttu-id="e79e5-107">Dans ce didacticiel, nous examiner les différents paramètres d’authentification de formulaires et voir comment les modifier dans l’élément de formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="e79e5-108">Cette suppression entraîne un examen détaillé de la personnalisation de valeur de délai d’expiration du ticket d’authentification par formulaires, à l’aide d’une page de connexion avec une URL personnalisée (par exemple, SignIn.aspx au lieu de Login.aspx) et les tickets de l’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="e79e5-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="e79e5-109">Introduction</span></span>

<span data-ttu-id="e79e5-110">Dans le [didacticiel précédent](an-overview-of-forms-authentication-vb.md) , nous avons étudié les étapes nécessaires pour implémenter l’authentification par formulaire dans une application ASP.NET, à partir de la spécification des paramètres de configuration dans le fichier Web.config à la création d’un journal dans la page à l’affichage de différente contenu pour les utilisateurs authentifiés et anonymes.</span><span class="sxs-lookup"><span data-stu-id="e79e5-110">In the [previous tutorial](an-overview-of-forms-authentication-vb.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="e79e5-111">Rappelez-vous que nous avons configuré le site Web pour utiliser l’authentification par formulaire en définissant l’attribut mode de le &lt;authentification&gt; élément aux formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="e79e5-112">Le &lt;authentification&gt; élément peut éventuellement inclure un &lt;forms&gt; élément enfant, par le biais duquel un large éventail de paramètres d’authentification de formulaires peut être spécifié.</span><span class="sxs-lookup"><span data-stu-id="e79e5-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="e79e5-113">Dans ce didacticiel nous examiner les différents paramètres d’authentification de formulaires et voir comment les modifier via le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="e79e5-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="e79e5-114">Cette suppression entraîne un examen détaillé de la personnalisation de valeur de délai d’expiration du ticket d’authentification par formulaires, à l’aide d’une page de connexion avec une URL personnalisée (par exemple, SignIn.aspx au lieu de Login.aspx) et les tickets de l’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="e79e5-115">Nous sera également examiner plus en détail de la composition du ticket d’authentification forms et consultez les précautions QU'ASP.NET prend pour vous assurer que les données du ticket sont sécurisées à partir d’inspection et la falsification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="e79e5-116">Enfin, nous allons examiner comment stocker les données utilisateur supplémentaire dans le ticket d’authentification de formulaires et de modéliser ces données via un objet principal personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="e79e5-117">Étape 1 : Examiner le &lt;forms&gt; paramètres de Configuration</span><span class="sxs-lookup"><span data-stu-id="e79e5-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="e79e5-118">Le système d’authentification de formulaires dans ASP.NET offre un nombre de paramètres de configuration qui peut être personnalisée sur une base de l’application par application.</span><span class="sxs-lookup"><span data-stu-id="e79e5-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="e79e5-119">Cela inclut des paramètres tels que : la durée de vie de l’authentification de formulaires de ticket ; quel type de protection est appliquée au ticket ; sous l’authentification sans cookies conditions tickets sont utilisés ; le chemin d’accès à la page de connexion ; et d’autres informations.</span><span class="sxs-lookup"><span data-stu-id="e79e5-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="e79e5-120">Pour modifier les valeurs par défaut, ajoutez un [ &lt;forms&gt; élément](https://msdn.microsoft.com/library/1d3t3c61.aspx) en tant qu’enfant de le [ &lt;authentification&gt; élément](https://msdn.microsoft.com/library/532aee0e.aspx), en spécifiant ces propriété valeurs que vous souhaitez personnaliser comme des attributs XML comme suit :</span><span class="sxs-lookup"><span data-stu-id="e79e5-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample1.xml)]

<span data-ttu-id="e79e5-121">Le tableau 1 résume les propriétés pouvant être personnalisé via le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="e79e5-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="e79e5-122">Étant donné que le fichier Web.config est un fichier XML, les noms d’attribut dans la colonne gauche respectent la casse.</span><span class="sxs-lookup"><span data-stu-id="e79e5-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="e79e5-123"><strong>Attribut</strong></span><span class="sxs-lookup"><span data-stu-id="e79e5-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="e79e5-124"><strong>Description</strong></span><span class="sxs-lookup"><span data-stu-id="e79e5-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="e79e5-125">sans cookie</span><span class="sxs-lookup"><span data-stu-id="e79e5-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="e79e5-126">Cet attribut spécifie dans quelles conditions le ticket d’authentification est stocké dans un cookie et qui est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="e79e5-127">Valeurs autorisées sont : UseCookies ; UseUri ; Détection automatique ; et UseDeviceProfile (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="e79e5-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="e79e5-128">Étape 2 examine ce paramètre plus en détail.</span><span class="sxs-lookup"><span data-stu-id="e79e5-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="e79e5-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="e79e5-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="e79e5-130">Indique l’URL que les utilisateurs sont redirigés vers après vous être connecté à partir de la page de connexion s’il n’existe aucune valeur de l’URL de redirection spécifié dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="e79e5-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="e79e5-131">La valeur par défaut est default.aspx.</span><span class="sxs-lookup"><span data-stu-id="e79e5-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="e79e5-132">de domaine</span><span class="sxs-lookup"><span data-stu-id="e79e5-132">domain</span></span>           | <span data-ttu-id="e79e5-133">Lorsque vous utilisez des tickets d’authentification basée sur les cookies, ce paramètre spécifie la valeur de domaine du cookie s.</span><span class="sxs-lookup"><span data-stu-id="e79e5-133">When using cookie-based authentication tickets, this setting specifies the cookie s domain value.</span></span> <span data-ttu-id="e79e5-134">La valeur par défaut est une chaîne vide, ce qui entraîne le navigateur à utiliser le domaine à partir duquel il a été émis (par exemple, www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="e79e5-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="e79e5-135">Dans ce cas, le cookie sera <strong>pas</strong> envoyer lors de la fabrication des demandes à sous-domaines, tels que admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="e79e5-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="e79e5-136">Si vous souhaitez que le cookie à passer à tous les sous-domaines, que vous devez personnaliser l’attribut de domaine lui affectant votredomaine.com.</span><span class="sxs-lookup"><span data-stu-id="e79e5-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="e79e5-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="e79e5-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="e79e5-138">Valeur booléenne indiquant si les utilisateurs authentifiés sont mémorisés lorsque redirigés vers des URL dans d’autres applications web sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="e79e5-139">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="e79e5-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="e79e5-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="e79e5-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="e79e5-141">L’URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e79e5-141">The URL of the login page.</span></span> <span data-ttu-id="e79e5-142">La valeur par défaut est login.aspx.</span><span class="sxs-lookup"><span data-stu-id="e79e5-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="e79e5-143">name</span><span class="sxs-lookup"><span data-stu-id="e79e5-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="e79e5-144">Lors de l’utilisation des tickets d’authentification basée sur les cookies, le nom du cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="e79e5-145">La valeur par défaut est. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="e79e5-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="e79e5-146">path</span><span class="sxs-lookup"><span data-stu-id="e79e5-146">path</span></span>            |                                                                             <span data-ttu-id="e79e5-147">Lorsque vous utilisez des tickets d’authentification basée sur les cookies, ce paramètre spécifie l’attribut de chemin d’accès du cookie s.</span><span class="sxs-lookup"><span data-stu-id="e79e5-147">When using cookie-based authentication tickets, this setting specifies the cookie s path attribute.</span></span> <span data-ttu-id="e79e5-148">L’attribut de chemin d’accès permet à un développeur limiter l’étendue d’un cookie pour une hiérarchie de répertoires particulière.</span><span class="sxs-lookup"><span data-stu-id="e79e5-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="e79e5-149">La valeur par défaut est /, qui informe le navigateur pour envoyer le cookie du ticket d’authentification à toute demande adressée au domaine.</span><span class="sxs-lookup"><span data-stu-id="e79e5-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="e79e5-150">protection</span><span class="sxs-lookup"><span data-stu-id="e79e5-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="e79e5-151">Indique quelles techniques sont utilisées pour protéger le ticket d’authentification par formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="e79e5-152">Les valeurs autorisées sont : Toutes les (la valeur par défaut) ; Chiffrement ; None ; et la Validation.</span><span class="sxs-lookup"><span data-stu-id="e79e5-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="e79e5-153">Ces paramètres sont décrits en détail à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="e79e5-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="e79e5-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="e79e5-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="e79e5-155">Une valeur booléenne qui indique si une connexion SSL est requise pour transmettre le cookie d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="e79e5-156">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="e79e5-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="e79e5-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="e79e5-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="e79e5-158">Valeur booléenne qui indique si le délai d’expiration du cookie s de l’authentification est réinitialisé chaque fois que l’utilisateur visite le site pendant une session unique.</span><span class="sxs-lookup"><span data-stu-id="e79e5-158">A Boolean value that indicates whether the authentication cookie s timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="e79e5-159">La valeur par défaut est true.</span><span class="sxs-lookup"><span data-stu-id="e79e5-159">The default value is true.</span></span> <span data-ttu-id="e79e5-160">La stratégie de délai d’expiration du ticket d’authentification est abordée plus en détail dans la spécification de la clause le s section de la valeur de délai d’expiration du Ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="e79e5-161">délai d'expiration</span><span class="sxs-lookup"><span data-stu-id="e79e5-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="e79e5-162">Spécifie la durée, en minutes, après laquelle le cookie du ticket d’authentification expire.</span><span class="sxs-lookup"><span data-stu-id="e79e5-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="e79e5-163">La valeur par défaut est 30.</span><span class="sxs-lookup"><span data-stu-id="e79e5-163">The default value is 30.</span></span> <span data-ttu-id="e79e5-164">La stratégie de délai d’expiration du ticket d’authentification est abordée plus en détail dans la spécification de la clause le s section de la valeur de délai d’expiration du Ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket s Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="e79e5-165">**Tableau 1**: Un résumé de la &lt;forms&gt; attributs de cet élément</span><span class="sxs-lookup"><span data-stu-id="e79e5-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="e79e5-166">Dans ASP.NET 2.0 et au-delà, la valeur par défaut les valeurs d’authentification de formulaires sont codées en dur dans la classe FormsAuthenticationConfiguration dans le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e79e5-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="e79e5-167">Toutes les modifications doivent être appliquées sur une base de l’application par application dans le fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="e79e5-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="e79e5-168">Cela diffère d’ASP.NET 1.x, où les valeurs de l’authentification de formulaires par défaut ont été stockées dans le fichier machine.config (et par conséquent peut être modifiées via la modification du fichier machine.config).</span><span class="sxs-lookup"><span data-stu-id="e79e5-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="e79e5-169">Quand vous êtes dans la rubrique d’ASP.NET 1.x, il est utile de mentionner que les paramètres de système d’authentification forms différents ont différentes valeurs par défaut dans ASP.NET 2.0 et autres fonctionnalités que dans ASP.NET 1.x.</span><span class="sxs-lookup"><span data-stu-id="e79e5-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="e79e5-170">Si vous migrez votre application à partir d’un environnement d’ASP.NET 1.x, il est important d’être conscient de ces différences.</span><span class="sxs-lookup"><span data-stu-id="e79e5-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="e79e5-171">Consultez [le &lt;forms&gt; documentation technique élément](https://msdn.microsoft.com/library/1d3t3c61.aspx) pour obtenir la liste des différences.</span><span class="sxs-lookup"><span data-stu-id="e79e5-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-172">Plusieurs paramètres d’authentification de formulaires, tels que le délai d’attente, le domaine et le chemin d’accès, spécifient les détails pour le cookie de ticket d’authentification forms qui en résulte.</span><span class="sxs-lookup"><span data-stu-id="e79e5-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="e79e5-173">Pour plus d’informations sur les cookies, leur fonctionnement et leurs différentes propriétés, consultez [ce didacticiel de Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="e79e5-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="e79e5-174">Spécifiant la valeur de délai d’expiration du Ticket</span><span class="sxs-lookup"><span data-stu-id="e79e5-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="e79e5-175">Le ticket d’authentification par formulaires est un jeton qui représente une identité.</span><span class="sxs-lookup"><span data-stu-id="e79e5-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="e79e5-176">Avec les tickets d’authentification basée sur les cookies, ce jeton est conservé sous la forme d’un cookie et envoyé au serveur web à chaque demande.</span><span class="sxs-lookup"><span data-stu-id="e79e5-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="e79e5-177">Possession du jeton, par essence, déclare, je suis *nom d’utilisateur*, j’ai se sont déjà connectés et est utilisé afin que l’identité d’un utilisateur peut être mémorisée une visite de page.</span><span class="sxs-lookup"><span data-stu-id="e79e5-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="e79e5-178">Le ticket d’authentification de formulaires inclut l’identité de l’utilisateur mais contient également des informations pour aider à garantir l’intégrité et la sécurité du jeton.</span><span class="sxs-lookup"><span data-stu-id="e79e5-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="e79e5-179">Après tout, nous ne voulons pas un utilisateur mal intentionné désactiverait pour pouvoir créer un jeton de contrefaçon, ou pour modifier un jeton legit d’une certaine façon underhanded.</span><span class="sxs-lookup"><span data-stu-id="e79e5-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="e79e5-180">Un bit de ce type d’informations contenues dans le ticket est une *expiration*, qui est la date et l’heure que le ticket n’est plus valide.</span><span class="sxs-lookup"><span data-stu-id="e79e5-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="e79e5-181">Chaque fois que FormsAuthenticationModule inspecte un ticket d’authentification, il permet de s’assurer que les expiration du ticket n’a pas encore passé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="e79e5-182">S’il possède, il ignore le ticket et identifie l’utilisateur comme étant anonyme.</span><span class="sxs-lookup"><span data-stu-id="e79e5-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="e79e5-183">Cette précaution permet de protéger contre les attaques par relecture.</span><span class="sxs-lookup"><span data-stu-id="e79e5-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="e79e5-184">Sans une échéance, si un pirate a été en mesure d’obtenir ses mains sur le ticket d’authentification valide d’un utilisateur - peut-être par l’accès physique à leur ordinateur et l’enracinement via leurs cookies : elles peuvent envoyer une demande au serveur avec ce ticket d’authentification volé et peut accéder.</span><span class="sxs-lookup"><span data-stu-id="e79e5-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="e79e5-185">L’expiration n’empêche pas ce scénario, mais limite la fenêtre pendant laquelle une telle attaque peut réussir.</span><span class="sxs-lookup"><span data-stu-id="e79e5-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-186">Étape 3 détails techniques supplémentaires utilisées par le système d’authentification de formulaires pour protéger le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="e79e5-187">Lorsque vous créez le ticket d’authentification, le système d’authentification forms détermine son expiration en consultant le paramètre de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="e79e5-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="e79e5-188">Comme indiqué dans le tableau 1, le délai d’attente définissant les valeurs par défaut à 30 minutes, cela signifie que lors de la création du ticket d’authentification par formulaires son expiration est définie sur une date et heure, 30 minutes à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="e79e5-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="e79e5-189">L’expiration définit une heure absolue à l’avenir que lorsque le ticket d’authentification forms expire.</span><span class="sxs-lookup"><span data-stu-id="e79e5-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="e79e5-190">Mais généralement les développeurs souhaitent implémenter une expiration décalée, qui est réinitialisé chaque fois que l’utilisateur visite le site.</span><span class="sxs-lookup"><span data-stu-id="e79e5-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="e79e5-191">Ce comportement est déterminé par les paramètres de slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="e79e5-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="e79e5-192">Si la valeur est true (valeur par défaut), chaque fois FormsAuthenticationModule authentifie un utilisateur, il met à jour d’expiration du ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="e79e5-193">Si définie sur false, l’expiration n’est pas mis à jour à chaque demande, ce qui provoque l’expiration du délai d’attente exactement les nombre de minutes après le ticket lors de la première du ticket créé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-194">L’expiration stockée dans le ticket d’authentification est une date absolue et la valeur de temps, telle que 2 août 2008 11:34:00.</span><span class="sxs-lookup"><span data-stu-id="e79e5-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="e79e5-195">En outre, la date et l’heure sont par rapport à l’heure locale du serveur web.</span><span class="sxs-lookup"><span data-stu-id="e79e5-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="e79e5-196">Cette décision peut avoir des effets intéressants autour de l’heure d’été (DST), c'est-à-dire lorsque les horloges aux États-Unis sont déplacés à l’avance une heure (en supposant que le serveur web est hébergé dans des paramètres régionaux où l’heure d’été est observée).</span><span class="sxs-lookup"><span data-stu-id="e79e5-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="e79e5-197">Envisagez ce qui se passerait pour un site Web ASP.NET avec une expiration de 30 minutes près de l’heure de début de l’heure d’été (qui est à 2 h 00).</span><span class="sxs-lookup"><span data-stu-id="e79e5-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="e79e5-198">Imaginez qu'un visiteur se connecte sur le site sur le 11 mars 2008 à 1 h 55.</span><span class="sxs-lookup"><span data-stu-id="e79e5-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="e79e5-199">Cela génère un ticket d’authentification de formulaires qui expire à 11 mars 2008 à 2 h 25 (30 minutes à l’avenir).</span><span class="sxs-lookup"><span data-stu-id="e79e5-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="e79e5-200">Toutefois, une fois que 2:00 AM sortira, l’horloge passe à 3 h 00 en raison de l’heure d’été.</span><span class="sxs-lookup"><span data-stu-id="e79e5-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="e79e5-201">Lorsque l’utilisateur charge une nouvelle page six minutes après la connexion (à 3 h 01), FormsAuthenticationModule note que le ticket a expiré et qu’il redirige l’utilisateur vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e79e5-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="e79e5-202">Pour une discussion plus détaillée sur cela et autres singularités de délai d’expiration de ticket d’authentification, ainsi que les solutions de contournement, procurez-vous une copie de Stefan Schackow *Professional ASP.NET 2.0 Security, l’appartenance et la gestion de rôle* (ISBN : 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="e79e5-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="e79e5-203">La figure 1 illustre le flux de travail lorsque slidingExpiration est définie sur false et le délai d’expiration est défini sur 30.</span><span class="sxs-lookup"><span data-stu-id="e79e5-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="e79e5-204">Notez que le ticket d’authentification généré lors de la connexion contient la date d’expiration, et cette valeur n’est pas mis à jour sur les demandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="e79e5-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="e79e5-205">Si le FormsAuthenticationModule détecte que le ticket a expiré, il ignore et traite la demande comme anonyme.</span><span class="sxs-lookup"><span data-stu-id="e79e5-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="e79e5-206">[![Une représentation graphique de slidingExpiration d’expiration lors du Ticket d’authentification par formulaires a la valeur false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-vb/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image1.png)</span></span>

<span data-ttu-id="e79e5-207">**Figure 01**: Une représentation graphique de slidingExpiration d’expiration lors du Ticket d’authentification par formulaires est false ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image3.png))</span></span>

<span data-ttu-id="e79e5-208">La figure 2 illustre le flux de travail lorsque slidingExpiration est définie sur true et le délai d’expiration est définie sur 30.</span><span class="sxs-lookup"><span data-stu-id="e79e5-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="e79e5-209">Lorsqu’une demande authentifiée est reçue (avec un ticket non expirés) son expiration est mis à jour au nombre de délai d’attente de minutes à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="e79e5-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="e79e5-210">[![Une représentation graphique du Ticket d’authentification par formulaires lorsque slidingExpiration est true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-vb/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image4.png)</span></span>

<span data-ttu-id="e79e5-211">**Figure 02**: Une représentation graphique du Ticket d’authentification par formulaires lorsque slidingExpiration est true ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image6.png))</span></span>

<span data-ttu-id="e79e5-212">Lorsque vous utilisez des tickets d’authentification basée sur les cookies (la valeur par défaut), cette discussion devient un peu plus compliquée, car les cookies peuvent également avoir leurs propres expirations dans le spécifié.</span><span class="sxs-lookup"><span data-stu-id="e79e5-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="e79e5-213">Expiration d’un cookie (ou de son manque) indique au navigateur lorsque le cookie doit être détruit.</span><span class="sxs-lookup"><span data-stu-id="e79e5-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="e79e5-214">Si le cookie n’a pas d’expiration, il est détruit lorsque le navigateur s’arrête.</span><span class="sxs-lookup"><span data-stu-id="e79e5-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="e79e5-215">Si une échéance est présente, toutefois, le cookie reste stocké sur l’ordinateur de l’utilisateur jusqu'à la date et heure spécifiée dans l’expiration est passée.</span><span class="sxs-lookup"><span data-stu-id="e79e5-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="e79e5-216">Lorsqu’un cookie est détruit par le navigateur, il n’est plus envoyé au serveur web.</span><span class="sxs-lookup"><span data-stu-id="e79e5-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="e79e5-217">Par conséquent, la destruction d’un cookie est analogue à l’utilisateur de fermer la session sur le site.</span><span class="sxs-lookup"><span data-stu-id="e79e5-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-218">Bien sûr, un utilisateur peut supprimer de manière proactive les cookies stockés sur leur ordinateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="e79e5-219">Dans Internet Explorer 7, vous accédez à outils, Options et cliquez sur le bouton Supprimer dans la section de l’historique de navigation.</span><span class="sxs-lookup"><span data-stu-id="e79e5-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="e79e5-220">À partir de là, cliquez sur Supprimer les cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="e79e5-221">Le système d’authentification forms crée des cookies basée sur l’expiration ou session selon la valeur transmise à la *persistCookie* paramètre.</span><span class="sxs-lookup"><span data-stu-id="e79e5-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="e79e5-222">Rappel GetAuthCookie SetAuthCookie, méthodes et RedirectFromLoginPage de la classe FormsAuthentication prennent deux paramètres d’entrée : *nom d’utilisateur* et *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="e79e5-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="e79e5-223">La page de connexion que nous avons créé dans le didacticiel précédent inclus un Mémoriser mes informations CheckBox, déterminé si un cookie persistant a été créé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="e79e5-224">Les cookies persistants sont basés sur les d’expiration ; cookies non persistants sont basés sur des sessions.</span><span class="sxs-lookup"><span data-stu-id="e79e5-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="e79e5-225">Les concepts de délai d’expiration et slidingExpiration vu appliquent la même pour les deux basés sur session et d’expiration des cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="e79e5-226">Il est seulement une légère différence dans l’exécution : lorsque vous utilisez des cookies basée sur une expiration dont slidingTimeout est définie sur true, les expiration du cookie sont uniquement mis à jour lorsque plus de la moitié du temps spécifié écoulé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="e79e5-227">Nous allons mettre à jour les stratégies de délai d’expiration de ticket d’authentification de notre site Web afin que des tickets de délai d’expiration après une heure (60 minutes), à l’aide d’une expiration décalée.</span><span class="sxs-lookup"><span data-stu-id="e79e5-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="e79e5-228">Pour cette modification soit appliquée, mettre à jour le fichier Web.config, ajout d’un &lt;forms&gt; élément à la &lt;authentification&gt; élément avec le balisage suivant :</span><span class="sxs-lookup"><span data-stu-id="e79e5-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="e79e5-229">À l’aide d’une URL de Page de connexion autres que Login.aspx</span><span class="sxs-lookup"><span data-stu-id="e79e5-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="e79e5-230">Dans la mesure où FormsAuthenticationModule redirige automatiquement les utilisateurs non autorisés vers la page de connexion, il doit connaître l’URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e79e5-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="e79e5-231">Cette URL est spécifiée par l’attribut loginUrl dans le &lt;forms&gt; élément et la valeur par défaut est login.aspx.</span><span class="sxs-lookup"><span data-stu-id="e79e5-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="e79e5-232">Si vous portez sur un site Web existant, vous disposez peut-être déjà une page de connexion avec une URL différente, ce qui a été déjà créé un signet et indexées par les moteurs de recherche.</span><span class="sxs-lookup"><span data-stu-id="e79e5-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="e79e5-233">Au lieu de renommer votre page de connexion existante vers login.aspx et rompre les liens et les signets d’utilisateurs, vous pouvez à la place modifier l’attribut loginUrl pour pointer vers votre page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e79e5-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="e79e5-234">Par exemple, si votre page de connexion s’appelait SignIn.aspx et était située dans le répertoire d’utilisateurs, vous pouvez pointer le paramètre de configuration loginUrl à ~/Users/SignIn.aspx comme suit :</span><span class="sxs-lookup"><span data-stu-id="e79e5-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample3.xml)]

<span data-ttu-id="e79e5-235">Étant donné que notre application a déjà en cours a une page de connexion nommée Login.aspx, il est inutile de spécifier une valeur personnalisée dans le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="e79e5-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="e79e5-236">Étape 2 : Utilisation sans cookie Forms des Tickets d’authentification</span><span class="sxs-lookup"><span data-stu-id="e79e5-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="e79e5-237">Par défaut, le système d’authentification forms détermine s’il faut stocker ses tickets d’authentification dans la collection de cookies ou les incorporer dans l’URL en fonction de l’agent utilisateur visitant le site.</span><span class="sxs-lookup"><span data-stu-id="e79e5-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="e79e5-238">Tous les navigateurs de bureau standard telles que Internet Explorer, Firefox, Opera et Safari, les cookies de prise en charge, mais ne pas tous les appareils mobiles.</span><span class="sxs-lookup"><span data-stu-id="e79e5-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="e79e5-239">La stratégie de cookie utilisée par le système d’authentification forms varie selon le paramètre sans cookie dans le &lt;forms&gt; élément, qui peut être assigné à une des quatre valeurs :</span><span class="sxs-lookup"><span data-stu-id="e79e5-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="e79e5-240">UseCookies - Spécifie que les tickets de l’authentification basée sur le cookie seront toujours utilisés.</span><span class="sxs-lookup"><span data-stu-id="e79e5-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="e79e5-241">UseUri - indique que les tickets d’authentification basée sur les cookies ne seront jamais utilisés.</span><span class="sxs-lookup"><span data-stu-id="e79e5-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="e79e5-242">Détection automatique - si le profil d’appareil ne prend pas en charge les cookies, les tickets d’authentification basée sur les cookies ne sont pas utilisés ; Si le profil d’appareil prend en charge les cookies, un mécanisme de détection est utilisé pour déterminer si les cookies sont activés.</span><span class="sxs-lookup"><span data-stu-id="e79e5-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="e79e5-243">UseDeviceProfile - la valeur par défaut ; utilise des tickets d’authentification basée sur les cookies uniquement si le profil d’appareil prend en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="e79e5-244">Aucun mécanisme de détection n’est utilisé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-244">No probing mechanism is used.</span></span>

<span data-ttu-id="e79e5-245">Les paramètres de détection automatique et UseDeviceProfile s’appuient sur une *profil d’appareil* dans permettant de vérifier s’il faut utiliser des tickets d’authentification basée sur les cookies ou sans cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="e79e5-246">ASP.NET gère une base de données de différents appareils et leurs fonctionnalités, telles que si elles prennent en charge les cookies, quelle version de JavaScript prises en charge et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e79e5-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="e79e5-247">Chaque fois qu’un appareil demande une page web à partir d’un serveur web envoie le long d’un *agent utilisateur* en-tête HTTP qui identifie le type d’appareil.</span><span class="sxs-lookup"><span data-stu-id="e79e5-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="e79e5-248">ASP.NET met automatiquement en correspondance la chaîne user-agent fourni avec le profil de correspondant spécifié dans sa base de données.</span><span class="sxs-lookup"><span data-stu-id="e79e5-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-249">Cette base de données des fonctionnalités de l’appareil est stocké dans un nombre de fichiers XML qui respectent le [schéma de fichier de définition de navigateur](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="e79e5-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="e79e5-250">Les fichiers de profil de périphérique par défaut se trouvent dans % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="e79e5-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="e79e5-251">Vous pouvez également ajouter des fichiers personnalisés à application votre application\_dossier de navigateurs.</span><span class="sxs-lookup"><span data-stu-id="e79e5-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="e79e5-252">Pour plus d’informations, consultez [How To : Détecter les Types de navigateurs dans les Pages Web ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="e79e5-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="e79e5-253">Étant donné que le paramètre par défaut est UseDeviceProfile, tickets de l’authentification par formulaire sans cookie seront utilisés lorsque le site est visité par un appareil dont le profil signale qu’il ne prend pas en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="e79e5-254">Le Ticket d’authentification dans l’URL d’encodage</span><span class="sxs-lookup"><span data-stu-id="e79e5-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="e79e5-255">Les cookies sont un moyen naturels pour inclure des informations à partir du navigateur dans chaque demande d’un site Web particulier, c’est pourquoi les paramètres d’authentification de formulaires par défaut utilisent des cookies si l’appareil visite les prend en charge.</span><span class="sxs-lookup"><span data-stu-id="e79e5-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="e79e5-256">Si les cookies ne sont pas pris en charge, un autre moyen pour transmettre le ticket d’authentification du client au serveur doit être employé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="e79e5-257">Une solution courante utilisée dans les environnements sans cookie consiste à coder les données de cookie dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="e79e5-258">La meilleure façon de voir comment ces informations peuvent être incorporées dans l’URL consiste à forcer le site utilise des tickets d’authentification sans cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="e79e5-259">Cela est possible en définissant le paramètre de configuration sans cookie sur UseUri :</span><span class="sxs-lookup"><span data-stu-id="e79e5-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample4.xml)]

<span data-ttu-id="e79e5-260">Une fois que vous avez apporté cette modification, visitez le site via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="e79e5-261">Lors de la visite en tant qu’utilisateur anonyme, les URL ressembleront exactement comme auparavant.</span><span class="sxs-lookup"><span data-stu-id="e79e5-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="e79e5-262">Par exemple, lorsque vous visitez la page Default.aspx barre d’adresses de mon navigateur affiche l’URL suivante :</span><span class="sxs-lookup"><span data-stu-id="e79e5-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="e79e5-263">Toutefois, lors de la connexion, le ticket d’authentification par formulaires est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="e79e5-264">Par exemple, après la visite de la page de connexion et m’être connecté en tant que Sam, je reviens à la page Default.aspx, mais cette fois de l’URL est :</span><span class="sxs-lookup"><span data-stu-id="e79e5-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="e79e5-265">Le ticket d’authentification par formulaires a été intégré dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="e79e5-266">La chaîne (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) représente les informations de ticket d’authentification codé en hexadécimal, et sont les mêmes données sont généralement stockées dans un cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="e79e5-267">Dans l’ordre pour les tickets d’authentification sans cookies fonctionne, le système doit coder toutes les URL dans la page pour inclure les données de ticket d’authentification, sinon le ticket d’authentification seront perdu lorsque l’utilisateur clique sur un lien.</span><span class="sxs-lookup"><span data-stu-id="e79e5-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="e79e5-268">Heureusement, cette logique d’incorporation est effectuée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="e79e5-269">Pour illustrer cette fonctionnalité, ouvrez la page Default.aspx et ajouter un contrôle de lien hypertexte, en définissant ses propriétés Text et NavigateUrl pour tester le lien et SomePage.aspx, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="e79e5-270">Peu importe qu’il n’est pas vraiment une page dans notre projet nommé SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="e79e5-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="e79e5-271">Enregistrer les modifications apportées à Default.aspx, puis vous accédez il via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="e79e5-272">Ouvrez une session le site afin que le ticket d’authentification par formulaires est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="e79e5-273">Ensuite, à partir de Default.aspx, cliquez sur le lien de lien de Test.</span><span class="sxs-lookup"><span data-stu-id="e79e5-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="e79e5-274">Que s'est-il passé ?</span><span class="sxs-lookup"><span data-stu-id="e79e5-274">What happened?</span></span> <span data-ttu-id="e79e5-275">Si aucune page nommée SomePage.aspx n’existe, puis une erreur 404 s’est produite, mais qui n’est pas ce qui est important ici.</span><span class="sxs-lookup"><span data-stu-id="e79e5-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="e79e5-276">Concentrez-vous plutôt sur la barre d’adresses dans votre navigateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="e79e5-277">Notez qu’il inclut le ticket d’authentification de formulaires dans l’URL !</span><span class="sxs-lookup"><span data-stu-id="e79e5-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="e79e5-278">L’URL SomePage.aspx dans le lien a été automatiquement convertie en une URL incluant le ticket d’authentification - nous n’avions pas à écrire la moindre ligne de code !</span><span class="sxs-lookup"><span data-stu-id="e79e5-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="e79e5-279">Le ticket d’authentification par formulaire est incorporé automatiquement dans l’URL pour tous les liens hypertexte qui ne commencent pas par http:// ou /.</span><span class="sxs-lookup"><span data-stu-id="e79e5-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="e79e5-280">Peu importe si le lien hypertexte s’affiche dans un appel de Response.Redirect, dans un contrôle de lien hypertexte ou dans un élément d’ancrage HTML (par exemple, &lt;un href = «... »&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="e79e5-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="e79e5-281">Tant que l’URL n’est pas quelque chose comme http://www.someserver.com/SomePage.aspx ou /SomePage.aspx, les formulaires de ticket d’authentification sera incorporé pour nous.</span><span class="sxs-lookup"><span data-stu-id="e79e5-281">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-282">Tickets de l’authentification par formulaire sans cookie respectent les mêmes stratégies de délai d’attente que les tickets d’authentification basée sur les cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="e79e5-283">Toutefois, les tickets d’authentification sans cookies sont davantage sujets aux attaques par relecture, étant donné que le ticket d’authentification est directement incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="e79e5-284">Imaginez un utilisateur qui visite un site Web, se connecte et colle l’URL dans un message électronique à un collègue.</span><span class="sxs-lookup"><span data-stu-id="e79e5-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="e79e5-285">Si le collègue clique sur ce lien avant l’expiration est atteint, elles seront enregistrées en tant que l’utilisateur qui a envoyé le courrier !</span><span class="sxs-lookup"><span data-stu-id="e79e5-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="e79e5-286">Étape 3 : Sécuriser le Ticket d’authentification</span><span class="sxs-lookup"><span data-stu-id="e79e5-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="e79e5-287">Le ticket d’authentification par formulaires est transmis via le réseau soit dans un cookie ou incorporé directement dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e79e5-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="e79e5-288">En plus des informations d’identité, le ticket d’authentification peut également inclure des données de l’utilisateur (comme nous le verrons à l’étape 4).</span><span class="sxs-lookup"><span data-stu-id="e79e5-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="e79e5-289">Par conséquent, il est important que les données du ticket sont chiffrées des regards indiscrets et (surtout) que le système d’authentification de formulaires peut garantir que le ticket n’était pas falsifié.</span><span class="sxs-lookup"><span data-stu-id="e79e5-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="e79e5-290">Pour garantir la confidentialité des données du ticket, le système d’authentification de formulaires peut chiffrer les données de ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="e79e5-291">Échec pour chiffrer les données de ticket envoie des informations potentiellement sensibles sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="e79e5-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="e79e5-292">Pour garantir l’authenticité d’un ticket, le système d’authentification de formulaires doit *valider* le ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="e79e5-293">Validation consiste à s’assurer qu’un élément particulier de données n’a pas été modifié et s’effectue un  *[code d’authentification (MAC) du message](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="e79e5-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="e79e5-294">En bref, le MAC est une petite partie des informations qui identifient les données qui devant être validée (dans ce cas, le ticket).</span><span class="sxs-lookup"><span data-stu-id="e79e5-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="e79e5-295">Si les données représentées par le MAC sont modifiées, puis le MAC et les données ne correspondront pas.</span><span class="sxs-lookup"><span data-stu-id="e79e5-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="e79e5-296">En outre, il est en calcul difficile pour un pirate à modifier les données et générer son propre MAC pour correspondre avec les données modifiées.</span><span class="sxs-lookup"><span data-stu-id="e79e5-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="e79e5-297">Lors de la création (ou modifier) un ticket, le système d’authentification forms crée un MAC et l’attache aux données du ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="e79e5-298">Lorsqu’une demande ultérieure arrive, le système d’authentification forms compare les données MAC et ticket pour valider l’authenticité des données de ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="e79e5-299">La figure 3 illustre ce flux de travail sous forme graphique.</span><span class="sxs-lookup"><span data-stu-id="e79e5-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="e79e5-300">[![L’authenticité du Ticket est assurée via un MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-vb/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image7.png)</span></span>

<span data-ttu-id="e79e5-301">**Figure 03**: L’authenticité du Ticket est assurée via un MAC ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image9.png))</span></span>

<span data-ttu-id="e79e5-302">Les mesures de sécurité sont appliquées pour le ticket d’authentification varie selon le paramètre de protection dans le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="e79e5-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="e79e5-303">Le paramètre de protection peut-être être affecté à une des trois valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="e79e5-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="e79e5-304">All - le ticket est chiffré et signé numériquement (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="e79e5-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="e79e5-305">Le chiffrement - uniquement le chiffrement est appliqué : aucun MAC n’est généré.</span><span class="sxs-lookup"><span data-stu-id="e79e5-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="e79e5-306">None : le ticket n’est ni chiffré ni signé numériquement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="e79e5-307">Validation : un MAC est générée, mais les données de ticket sont envoyées sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="e79e5-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="e79e5-308">Microsoft vous recommande fortement de l’aide du paramètre tous.</span><span class="sxs-lookup"><span data-stu-id="e79e5-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="e79e5-309">Définition de la Validation et les clés de déchiffrement</span><span class="sxs-lookup"><span data-stu-id="e79e5-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="e79e5-310">Le chiffrement et algorithmes de hachage utilisés par le système d’authentification de formulaires pour chiffrer et valider le ticket d’authentification sont personnalisables par le biais du [ &lt;machineKey&gt; élément](https://msdn.microsoft.com/library/w8h3skw9.aspx) dans le fichier Web.config. Tableau 2 décrit les &lt;machineKey&gt; attributs de cet élément et leurs valeurs possibles.</span><span class="sxs-lookup"><span data-stu-id="e79e5-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="e79e5-311">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="e79e5-311">**Attribute**</span></span> | <span data-ttu-id="e79e5-312">**Description**</span><span class="sxs-lookup"><span data-stu-id="e79e5-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="e79e5-313">déchiffrement</span><span class="sxs-lookup"><span data-stu-id="e79e5-313">decryption</span></span> | <span data-ttu-id="e79e5-314">Indique l’algorithme utilisé pour le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="e79e5-315">Cet attribut peut avoir une des quatre valeurs suivantes : - Auto - la valeur par défaut ; Détermine l’algorithme selon la longueur de l’attribut validationKey.</span><span class="sxs-lookup"><span data-stu-id="e79e5-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="e79e5-316">-AES - utilise le [Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithme.</span><span class="sxs-lookup"><span data-stu-id="e79e5-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="e79e5-317">-DES - utilise le [Standard DES (Data Encryption)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) cet algorithme est considéré comme faible ressources de calcul et ne doit pas être utilisé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="e79e5-318">-3DES - utilise le [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithme, qui fonctionne en appliquant l’algorithme DES trois fois.</span><span class="sxs-lookup"><span data-stu-id="e79e5-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="e79e5-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="e79e5-319">decryptionKey</span></span> | <span data-ttu-id="e79e5-320">La clé secrète utilisée par l’algorithme de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="e79e5-321">Cette valeur doit être une chaîne hexadécimale de la longueur appropriée (selon la valeur de déchiffrement), générer automatiquement ou des valeurs ajoutées, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="e79e5-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="e79e5-322">Ajout de IsolateApps indique à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="e79e5-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="e79e5-323">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="e79e5-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="e79e5-324">validation</span><span class="sxs-lookup"><span data-stu-id="e79e5-324">validation</span></span> | <span data-ttu-id="e79e5-325">Indique l’algorithme utilisé pour la validation.</span><span class="sxs-lookup"><span data-stu-id="e79e5-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="e79e5-326">Cet attribut peut avoir une des quatre valeurs suivantes : - AES - utilise l’algorithme Advanced Encryption Standard (AES).</span><span class="sxs-lookup"><span data-stu-id="e79e5-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="e79e5-327">-MD5 - utilise le [Message Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithme.</span><span class="sxs-lookup"><span data-stu-id="e79e5-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="e79e5-328">-SHA1 - utilise le [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithme (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="e79e5-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="e79e5-329">-3DES - utilise l’algorithme Triple DES.</span><span class="sxs-lookup"><span data-stu-id="e79e5-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="e79e5-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="e79e5-330">validationKey</span></span> | <span data-ttu-id="e79e5-331">La clé secrète utilisée par l’algorithme de validation.</span><span class="sxs-lookup"><span data-stu-id="e79e5-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="e79e5-332">Cette valeur doit être une chaîne hexadécimale de la longueur appropriée (selon la valeur de validation), générer automatiquement ou des valeurs ajoutées, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="e79e5-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="e79e5-333">Ajout de IsolateApps indique à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="e79e5-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="e79e5-334">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="e79e5-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="e79e5-335">**Tableau 2**: Le &lt;machineKey&gt; attributs de l’élément</span><span class="sxs-lookup"><span data-stu-id="e79e5-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="e79e5-336">Une discussion détaillée de ces options de chiffrement et la validation, ainsi que les avantages et inconvénients des algorithmes différents, n’entre pas dans le cadre de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e79e5-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="e79e5-337">Pour vous explique en détail examiner ces problèmes, notamment des conseils sur les algorithmes de chiffrement et de validation à utiliser, les longueurs de clé à utiliser et la meilleure façon de générer ces clés, reportez-vous à *Professional ASP.NET 2.0 Security, l’appartenance et la gestion de rôle* .</span><span class="sxs-lookup"><span data-stu-id="e79e5-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="e79e5-338">Par défaut, les clés utilisées pour le chiffrement et de validation sont générés automatiquement pour chaque application, et ces clés sont stockées dans l’autorité de sécurité locale (LSA).</span><span class="sxs-lookup"><span data-stu-id="e79e5-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="e79e5-339">En bref, les paramètres par défaut garantissent des clés uniques sur un web serveur-par le serveur web et l’application par application.</span><span class="sxs-lookup"><span data-stu-id="e79e5-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="e79e5-340">Par conséquent, ce comportement par défaut ne fonctionne pas pour les deux scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="e79e5-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="e79e5-341">**Batteries de serveurs Web** : dans un [batterie de serveurs web](http://en.wikipedia.org/wiki/Web_farm) scénario, une seule application web est hébergée sur plusieurs serveurs web à des fins d’évolutivité et de redondance.</span><span class="sxs-lookup"><span data-stu-id="e79e5-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="e79e5-342">Chaque requête entrante est distribué à un serveur dans la batterie de serveurs, ce qui signifie que la durée de vie d’une session utilisateur, des serveurs différents peuvent servir à gérer ses différentes requêtes.</span><span class="sxs-lookup"><span data-stu-id="e79e5-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="e79e5-343">Par conséquent, chaque serveur doit utiliser les mêmes clés de chiffrement et de validation afin que le ticket d’authentification de formulaires créés, chiffré et validé sur un serveur peut être déchiffré et validé sur un autre serveur dans la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="e79e5-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="e79e5-344">**Cross-partage d’applications Ticket** -un seul serveur web peut héberger plusieurs applications ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e79e5-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="e79e5-345">Si vous avez besoin pour ces applications différentes de partager un ticket d’authentification par formulaires unique, il est impératif que leurs clés de chiffrement et validation concordent.</span><span class="sxs-lookup"><span data-stu-id="e79e5-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="e79e5-346">Lorsque vous travaillez dans une batterie de serveurs web, paramètre ou le partage des tickets d’authentification entre les applications sur le même serveur, vous devez configurer le &lt;machineKey&gt; élément dans les applications affectées afin que leur validationKey et les valeurs validationKey concordent.</span><span class="sxs-lookup"><span data-stu-id="e79e5-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="e79e5-347">Aucun des scénarios ci-dessus s’appliqu’à notre exemple d’application, nous pouvons toujours spécifier validationKey explicite et les valeurs de validationKey et définissez les algorithmes à utiliser.</span><span class="sxs-lookup"><span data-stu-id="e79e5-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="e79e5-348">Ajouter un &lt;machineKey&gt; paramètre au fichier Web.config :</span><span class="sxs-lookup"><span data-stu-id="e79e5-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample5.xml)]

<span data-ttu-id="e79e5-349">Pour plus d’informations consultez [How To : Configurer MachineKey dans ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="e79e5-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-350">Les valeurs ValidationKey et validationKey ont été effectuées à partir de [Steve Gibson](http://www.grc.com/stevegibson.htm)de [parfait des mots de passe web page](https://www.grc.com/passwords.htm), qui génère de 64 caractères hexadécimaux aléatoire sur chaque visite de page.</span><span class="sxs-lookup"><span data-stu-id="e79e5-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="e79e5-351">Pour réduire la probabilité de ces clés effectuer leur façon dans vos applications de production, vous êtes invité à remplacer les clés ci-dessus par celles générés de manière aléatoire à partir de la page des mots de passe parfait.</span><span class="sxs-lookup"><span data-stu-id="e79e5-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="e79e5-352">Étape 4 : Stockage des données utilisateur supplémentaires dans le Ticket</span><span class="sxs-lookup"><span data-stu-id="e79e5-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="e79e5-353">De nombreuses applications web, affichent des informations sur ou affichage de la page de base sur l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="e79e5-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="e79e5-354">Par exemple, une page web peut afficher le nom d’utilisateur et la date, qu'elle a ouvert sa dernière session le coin supérieur de chaque page.</span><span class="sxs-lookup"><span data-stu-id="e79e5-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="e79e5-355">Le ticket d’authentification forms stocke le nom d’utilisateur de l’utilisateur actuellement connecté, mais toute autre information est nécessaire, la page doit passer dans le magasin de l’utilisateur - en général, une base de données - pour rechercher les informations non stockées dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="e79e5-356">Avec un peu de code, nous pouvons stocker des informations utilisateur supplémentaires dans le ticket d’authentification par formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="e79e5-357">Ces données peuvent être exprimées par le biais du [classe FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)de [propriété UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="e79e5-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="e79e5-358">Il s’agit d’un emplacement utile pour placer de petites quantités d’informations sur l’utilisateur qui est généralement nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e79e5-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="e79e5-359">La valeur spécifiée dans le UserData est inclus dans le cadre du cookie de ticket d’authentification et, comme les autres champs de ticket de propriété, est chiffrée et validée basée sur la configuration du système d’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="e79e5-360">Par défaut, UserData est une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="e79e5-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="e79e5-361">Pour stocker des données utilisateur dans le ticket d’authentification, nous devons écrire un peu de code dans la page de connexion qui Récupère les informations spécifiques à l’utilisateur et le stocke dans le ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="e79e5-362">Dans la mesure où UserData est une propriété de type chaîne, les données stockées dans celui-ci doivent être correctement sérialisées sous forme de chaîne.</span><span class="sxs-lookup"><span data-stu-id="e79e5-362">Since UserData is a property of type String, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="e79e5-363">Par exemple, imaginez que notre magasin utilisateur incluses date de naissance de chaque utilisateur et le nom de leur employeur, et nous voulions stocker les valeurs de ces deux propriétés dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="e79e5-364">Nous pourrions sérialiser ces valeurs dans une chaîne en concaténant date de l’utilisateur de la chaîne de naissance avec une barre verticale (|), suivie du nom de l’employeur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="e79e5-365">Pour un utilisateur né le 15 août 1974 qui fonctionne pour Northwind Traders, nous allons affecter à la propriété UserData la chaîne : 1974-08-15|Northwind Traders .</span><span class="sxs-lookup"><span data-stu-id="e79e5-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="e79e5-366">Chaque fois que nous avons besoin d’accéder aux données stockées dans le ticket, nous pouvons faire, en saisissant le FormsAuthenticationTicket de la demande actuelle et la désérialisation de la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="e79e5-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="e79e5-367">Dans le cas de la date de naissance et employeur exemple de nom, nous fractionnerait la chaîne UserData en deux sous-chaînes en fonction du délimiteur (|).</span><span class="sxs-lookup"><span data-stu-id="e79e5-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="e79e5-368">[![Informations utilisateur supplémentaires peuvent être stockées dans le Ticket d’authentification](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-vb/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image10.png)</span></span>

<span data-ttu-id="e79e5-369">**Figure 04**: Supplémentaires utilisateur informations peuvent être stockées dans le Ticket d’authentification ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="e79e5-370">Écriture d’informations dans UserData</span><span class="sxs-lookup"><span data-stu-id="e79e5-370">Writing Information to UserData</span></span>

<span data-ttu-id="e79e5-371">Malheureusement, l’ajout d’informations spécifiques à l’utilisateur un ticket d’authentification par formulaires n’est pas aussi simple que celle attendue.</span><span class="sxs-lookup"><span data-stu-id="e79e5-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="e79e5-372">La propriété UserData de la classe FormsAuthenticationTicket est en lecture seule et peut uniquement être spécifiée via le constructeur de classe FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="e79e5-373">Lorsque vous spécifiez la propriété UserData dans le constructeur, nous devons également fournir le ticket d’autres valeurs : le nom d’utilisateur, la date d’émission, d’expiration et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e79e5-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="e79e5-374">Lorsque nous avons créé la page de connexion dans le didacticiel précédent, cela a été toutes prises en charge par la classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="e79e5-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="e79e5-375">Lorsque vous ajoutez UserData à FormsAuthenticationTicket, nous devrons écrire du code pour répliquer une grande partie de la fonctionnalité déjà fournie par la classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="e79e5-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="e79e5-376">Examinons le code nécessaire pour travailler avec UserData en mettant à jour de la page Login.aspx pour enregistrer des informations supplémentaires sur l’utilisateur pour le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="e79e5-377">Supposons que notre magasin utilisateur contient des informations sur la société que l’utilisateur travaille pour et leur titre, et que vous souhaitez capturer ces informations dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="e79e5-378">Mettre à jour LoginButton l’événement Click de la page Login.aspx afin que le code ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="e79e5-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample6.vb)]

<span data-ttu-id="e79e5-379">Examinons ce code ligne par ligne à la fois.</span><span class="sxs-lookup"><span data-stu-id="e79e5-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="e79e5-380">La méthode commence par définir quatre tableaux de chaînes : les utilisateurs, les mots de passe, companyName et titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="e79e5-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="e79e5-381">Ces tableaux contiennent des noms d’utilisateur, les mots de passe, les noms de société et les titres pour les comptes d’utilisateur dans le système, de laquelle il existe trois : Scott, Jisun et Sam.</span><span class="sxs-lookup"><span data-stu-id="e79e5-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="e79e5-382">Dans une application réelle, ces valeurs on faisait du magasin d’utilisateurs, ne pas codé en dur dans le code source de la page.</span><span class="sxs-lookup"><span data-stu-id="e79e5-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="e79e5-383">Dans le didacticiel précédent, si les informations d’identification fournies sont valides nous avons appelé simplement FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), qui a effectué les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="e79e5-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="e79e5-384">Créé les formulaires ticket d’authentification</span><span class="sxs-lookup"><span data-stu-id="e79e5-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="e79e5-385">Écrit le ticket pour le magasin approprié.</span><span class="sxs-lookup"><span data-stu-id="e79e5-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="e79e5-386">Pour les tickets d’authentification basée sur les cookies, la collection de cookies du navigateur est utilisée ; pour les tickets d’authentification sans cookies, les données de ticket sont sérialisées dans l’URL</span><span class="sxs-lookup"><span data-stu-id="e79e5-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="e79e5-387">Redirection de l’utilisateur à la page appropriée</span><span class="sxs-lookup"><span data-stu-id="e79e5-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="e79e5-388">Ces étapes sont répliqués dans le code ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="e79e5-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="e79e5-389">Tout d’abord, la chaîne que nous stockons par la suite dans la propriété UserData est formée en combinant le nom de société et le titre, en délimitant les deux valeurs avec une barre verticale (|).</span><span class="sxs-lookup"><span data-stu-id="e79e5-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="e79e5-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span><span class="sxs-lookup"><span data-stu-id="e79e5-390">Dim userDataString As String = String.Concat(companyName(i), "|", titleAtCompany(i))</span></span>

<span data-ttu-id="e79e5-391">Ensuite, le FormsAuthentication.GetAuthCookie méthode est appelée, ce qui crée le ticket d’authentification, chiffre et valide le fait en fonction des paramètres de configuration et le place dans un objet HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="e79e5-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span><span class="sxs-lookup"><span data-stu-id="e79e5-392">Dim authCookie As HttpCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked)</span></span>

<span data-ttu-id="e79e5-393">Pour utiliser le FormAuthenticationTicket incorporé dans le cookie, nous devons appeler la classe FormAuthentication [déchiffrer méthode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), en passant la valeur du cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="e79e5-394">Dim ticket FormsAuthenticationTicket comme = FormsAuthentication.Decrypt(authCookie.Value)</span><span class="sxs-lookup"><span data-stu-id="e79e5-394">Dim ticket As FormsAuthenticationTicket = FormsAuthentication.Decrypt(authCookie.Value)</span></span>

<span data-ttu-id="e79e5-395">Ensuite, nous créons un *nouveau* FormsAuthenticationTicket instance selon les valeurs de FormsAuthenticationTicket existant.</span><span class="sxs-lookup"><span data-stu-id="e79e5-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="e79e5-396">Toutefois, ce nouveau ticket inclut les informations spécifiques à l’utilisateur (userDataString).</span><span class="sxs-lookup"><span data-stu-id="e79e5-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="e79e5-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span><span class="sxs-lookup"><span data-stu-id="e79e5-397">Dim newTicket As FormsAuthenticationTicket = New FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString)</span></span>

<span data-ttu-id="e79e5-398">Nous avons ensuite chiffrer (et valider) la nouvelle instance de FormsAuthenticationTicket en appelant le [chiffrer la méthode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)et remettre ces données chiffrées (et validées) dans authCookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="e79e5-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span><span class="sxs-lookup"><span data-stu-id="e79e5-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket)</span></span>

<span data-ttu-id="e79e5-400">Enfin, authCookie est ajouté à la collection Response.Cookies et la méthode GetRedirectUrl est appelée pour déterminer la page appropriée à envoyer à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample7.vb)]

<span data-ttu-id="e79e5-401">Tout ce code est nécessaire, car la propriété UserData est en lecture seule et de la classe FormsAuthentication ne fournit pas de méthodes pour spécifier des informations UserData dans ses méthodes GetAuthCookie, SetAuthCookie ou RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="e79e5-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-402">Le code que nous avons examiné simplement stocke les informations spécifiques à l’utilisateur dans un ticket d’authentification basée sur les cookies.</span><span class="sxs-lookup"><span data-stu-id="e79e5-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="e79e5-403">Les classes doit sérialiser le ticket d’authentification de formulaires à l’URL sont internes au .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="e79e5-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="e79e5-404">Résumer, vous ne pouvez pas stocker les données utilisateur dans un ticket d’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="e79e5-405">Accéder aux informations UserData</span><span class="sxs-lookup"><span data-stu-id="e79e5-405">Accessing the UserData Information</span></span>

<span data-ttu-id="e79e5-406">À ce stade nom de la société et le titre de chaque utilisateur sont stockées dans la propriété UserData du ticket d’authentification par formulaires lorsqu’ils se connectent.</span><span class="sxs-lookup"><span data-stu-id="e79e5-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="e79e5-407">Ces informations sont accessibles à partir du ticket d’authentification sur n’importe quelle page sans nécessiter un aller-retour vers le magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e79e5-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="e79e5-408">Pour illustrer la façon dont ces informations peuvent être récupérées à partir de la propriété UserData, nous allons mettre à jour Default.aspx afin que son message d’accueil inclut non seulement le nom d’utilisateur, mais également la société pour qu'elles travaillent et leur titre.</span><span class="sxs-lookup"><span data-stu-id="e79e5-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="e79e5-409">Actuellement, Default.aspx contient un panneau AuthenticatedMessagePanel avec un contrôle Label nommé WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="e79e5-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="e79e5-410">Ce panneau est uniquement affiché aux utilisateurs authentifiés.</span><span class="sxs-lookup"><span data-stu-id="e79e5-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="e79e5-411">Mettre à jour le code dans la Page de Default.aspx\_charger le Gestionnaire d’événements afin qu’il ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="e79e5-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample8.vb)]

<span data-ttu-id="e79e5-412">Si Request.IsAuthenticated est True, propriété de texte de la WelcomeBackMessage a tout d’abord Bienvenue, *nom d’utilisateur*.</span><span class="sxs-lookup"><span data-stu-id="e79e5-412">If Request.IsAuthenticated is True, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="e79e5-413">Ensuite, la propriété User.Identity est castée à un objet FormsIdentity afin que nous pouvons accéder à FormsAuthenticationTicket sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="e79e5-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="e79e5-414">Une fois que nous avons FormsAuthenticationTicket, nous désérialiser la propriété UserData dans le nom de la société et le titre.</span><span class="sxs-lookup"><span data-stu-id="e79e5-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="e79e5-415">Pour cela, vous devez fractionner la chaîne sur la barre verticale.</span><span class="sxs-lookup"><span data-stu-id="e79e5-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="e79e5-416">Le nom de la société et le titre sont ensuite affichés dans l’étiquette WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="e79e5-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="e79e5-417">La figure 5 illustre une capture d’écran de cet affichage en action.</span><span class="sxs-lookup"><span data-stu-id="e79e5-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="e79e5-418">Connectez-vous en tant que Scott affiche un message d’accueil précédent qui inclut la société et le titre de Scott.</span><span class="sxs-lookup"><span data-stu-id="e79e5-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="e79e5-419">[![Société et le titre actuellement connecté sur l’utilisateur sont affichés.](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-vb/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image13.png)</span></span>

<span data-ttu-id="e79e5-420">**Figure 05**: Société actuellement connecté sur l’utilisateur et le titre sont affichés ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-421">Propriété UserData du ticket d’authentification sert un cache pour le magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e79e5-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="e79e5-422">Comme n’importe quel cache, il doit être mis à jour lorsque les données sous-jacentes sont modifiées.</span><span class="sxs-lookup"><span data-stu-id="e79e5-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="e79e5-423">Par exemple, s’il existe une page web à partir de laquelle les utilisateurs peuvent mettre à jour leur profil, les champs mis en cache dans la propriété UserData doivent être actualisés pour refléter les modifications apportées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="e79e5-424">Étape 5 : À l’aide d’un objet Principal personnalisé</span><span class="sxs-lookup"><span data-stu-id="e79e5-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="e79e5-425">Sur chaque demande entrante FormsAuthenticationModule tente d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="e79e5-426">Si un ticket d’authentification non expiré est présent, FormsAuthenticationModule assigne la propriété HttpContext.User vers un nouvel objet GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="e79e5-427">Cet objet GenericPrincipal a une identité de type FormsIdentity, qui inclut une référence pour le ticket d’authentification par formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="e79e5-428">La classe GenericPrincipal contient les fonctionnalités minimales strict nécessaire par une classe qui implémente IPrincipal : elle doit simplement une propriété d’identité et d’une méthode IsInRole.</span><span class="sxs-lookup"><span data-stu-id="e79e5-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="e79e5-429">L’objet principal a deux responsabilités : pour indiquer quels rôles appartient l’utilisateur et pour fournir des informations d’identité.</span><span class="sxs-lookup"><span data-stu-id="e79e5-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="e79e5-430">Cela est réalisé via IsInRole l’interface IPrincipal (*roleName*) méthode et la propriété Identity, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e79e5-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="e79e5-431">La classe GenericPrincipal permet pour un tableau de chaînes des noms de rôles à être spécifié via son constructeur. son IsInRole (*roleName*) vérifie simplement pour voir si passé dans *roleName* existe dans le tableau de chaînes.</span><span class="sxs-lookup"><span data-stu-id="e79e5-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="e79e5-432">Lorsque FormsAuthenticationModule crée l’objet GenericPrincipal, il passe au constructeur de l’objet de GenericPrincipal dans un tableau de chaînes vide.</span><span class="sxs-lookup"><span data-stu-id="e79e5-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="e79e5-433">Par conséquent, n’importe quel appel vers IsInRole renvoie toujours False.</span><span class="sxs-lookup"><span data-stu-id="e79e5-433">Consequently, any call to IsInRole will always return False.</span></span>

<span data-ttu-id="e79e5-434">La classe GenericPrincipal répond aux besoins de la plupart des scénarios de l’authentification basée sur des formulaires où les rôles ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="e79e5-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="e79e5-435">Dans les cas où la gestion de rôle par défaut est insuffisante ou lorsque vous devez associer un objet IIdentity personnalisé à l’utilisateur, vous pouvez créer un objet IPrincipal personnalisé pendant le flux de travail de l’authentification et affectez-le à la propriété HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="e79e5-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-436">Comme nous allons le voir dans les futures didacticiels, lorsque ASP. Infrastructure de rôles du NET est activée qu’il crée un objet principal personnalisé de type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) et remplace l’objet GenericPrincipal créé à l’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="e79e5-437">Il procède ainsi afin de personnaliser la méthode de IsInRole du principal pour interagir avec les API du framework de rôles.</span><span class="sxs-lookup"><span data-stu-id="e79e5-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="e79e5-438">Étant donné que nous n'avons pas ce qui concerne les nous-mêmes avec des rôles encore, la seule raison pour laquelle que nous devrions pour la création d’une entité personnalisée à partir de là consisterait à associer un objet IIdentity personnalisé au principal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="e79e5-439">À l’étape 4, nous avons le stockage des informations utilisateur supplémentaires dans la propriété UserData du ticket d’authentification, notamment le nom d’utilisateur entreprise et leur titre.</span><span class="sxs-lookup"><span data-stu-id="e79e5-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="e79e5-440">Toutefois, les informations UserData sont uniquement accessible via le ticket d’authentification et puis uniquement sous forme de chaîne sérialisée, ce qui signifie que chaque fois que nous souhaitons afficher les informations utilisateur stockées dans le ticket nous avons besoin analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="e79e5-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="e79e5-441">Nous pouvons améliorer l’expérience de développement en créant une classe qui implémente IIdentity et inclut des propriétés CompanyName et Title.</span><span class="sxs-lookup"><span data-stu-id="e79e5-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="e79e5-442">De cette façon, un développeur peut accéder à nom de la société de l’utilisateur actuellement connecté et titre directement via les propriétés CompanyName et titre sans besoin de savoir comment analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="e79e5-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="e79e5-443">Création de l’identité personnalisée et les Classes d’entité</span><span class="sxs-lookup"><span data-stu-id="e79e5-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="e79e5-444">Pour ce didacticiel, nous allons créer les objets principal et identity personnalisés dans l’application\_dossier de Code.</span><span class="sxs-lookup"><span data-stu-id="e79e5-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="e79e5-445">Commencez par ajouter une application\_dossier à votre projet de Code - avec le bouton droit sur le nom du projet dans l’Explorateur de solutions, sélectionnez l’option Ajouter le dossier ASP.NET et choisissez application\_Code.</span><span class="sxs-lookup"><span data-stu-id="e79e5-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="e79e5-446">L’application\_dossier de Code est un dossier spécial ASP.NET qui contient les fichiers de classe spécifique au site Web.</span><span class="sxs-lookup"><span data-stu-id="e79e5-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="e79e5-447">L’application\_dossier de Code ne doit être utilisée que lors de la gestion de votre projet via le modèle de projet de site Web.</span><span class="sxs-lookup"><span data-stu-id="e79e5-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="e79e5-448">Si vous utilisez le [le modèle de projet d’Application Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), créez un dossier standard et ajoutez les classes à cela.</span><span class="sxs-lookup"><span data-stu-id="e79e5-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="e79e5-449">Par exemple, vous pouvez ajouter un nouveau dossier nommé Classes et placer votre code il.</span><span class="sxs-lookup"><span data-stu-id="e79e5-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="e79e5-450">Ensuite, ajoutez deux nouveaux fichiers de classe à l’application\_dossier de Code, un seul CustomIdentity.vb nommée et l’autre nommé CustomPrincipal.vb.</span><span class="sxs-lookup"><span data-stu-id="e79e5-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.vb and one named CustomPrincipal.vb.</span></span>

<span data-ttu-id="e79e5-451">[![Ajoutez les CustomIdentity et les Classes de CustomPrincipal à votre projet](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-vb/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image16.png)</span></span>

<span data-ttu-id="e79e5-452">**Figure 06**: Ajouter les CustomIdentity et les Classes de CustomPrincipal à votre projet ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image18.png))</span></span>

<span data-ttu-id="e79e5-453">La classe CustomIdentity est chargée d’implémenter l’interface IIdentity, qui définit les propriétés AuthenticationType IsAuthenticated et nom.</span><span class="sxs-lookup"><span data-stu-id="e79e5-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="e79e5-454">En plus de ces propriétés requises, nous nous intéressons à suivre pour exposer le sous-jacent ticket d’authentification par formulaires ainsi que les propriétés pour le nom de la société et le titre de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="e79e5-455">Entrez le code suivant dans la classe CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="e79e5-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample9.vb)]

<span data-ttu-id="e79e5-456">Notez que la classe inclut une variable de membre FormsAuthenticationTicket (\_ticket) et que ces informations de ticket doivent être fournies via le constructeur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="e79e5-457">Ces données de ticket sont utilisées pour renvoyer le nom de l’identité ; sa propriété UserData est analysée pour retourner les valeurs des propriétés CompanyName et Title.</span><span class="sxs-lookup"><span data-stu-id="e79e5-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="e79e5-458">Ensuite, créez la classe CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="e79e5-459">Étant donné que nous ne sont pas concernés par les rôles à partir de là, le constructeur de la classe CustomPrincipal accepte uniquement un objet CustomIdentity ; sa méthode IsInRole renvoie toujours False.</span><span class="sxs-lookup"><span data-stu-id="e79e5-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns False.</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample10.vb)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="e79e5-460">Affectation d’un objet CustomPrincipal au contexte de sécurité de la demande entrante</span><span class="sxs-lookup"><span data-stu-id="e79e5-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="e79e5-461">Nous disposons d’une classe qui étend la spécification de IIdentity par défaut pour les propriétés CompanyName et titre, ainsi que d’une classe principal personnalisée qui utilise l’identité personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e79e5-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="e79e5-462">Nous sommes prêts à l’étape dans le pipeline ASP.NET et que vous affecter notre objet principal personnalisé au contexte de sécurité de la demande entrante.</span><span class="sxs-lookup"><span data-stu-id="e79e5-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="e79e5-463">Le pipeline ASP.NET prend une demande entrante et la traite via un nombre d’étapes.</span><span class="sxs-lookup"><span data-stu-id="e79e5-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="e79e5-464">À chaque étape, un événement particulier soit déclenché, ce qui permet aux développeurs d’exploiter le pipeline ASP.NET et modifiez la requête à certains points dans son cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="e79e5-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="e79e5-465">FormsAuthenticationModule, par exemple, attend que ASP.NET déclencher le [événement AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), à quel point il inspecte la demande entrante pour un ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="e79e5-466">Si un ticket d’authentification est trouvé, un objet GenericPrincipal est créé et assigné à la propriété HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="e79e5-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="e79e5-467">Après l’événement AuthenticateRequest, le pipeline ASP.NET déclenche le [PostAuthenticateRequest événement](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), qui est l’endroit où nous pouvons remplacer l’objet GenericPrincipal créé par FormsAuthenticationModule avec une instance de notre Objet CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="e79e5-468">La figure 7 illustre ce flux de travail.</span><span class="sxs-lookup"><span data-stu-id="e79e5-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="e79e5-469">[![L’objet GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-vb/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image19.png)</span></span>

<span data-ttu-id="e79e5-470">**Figure 07**: L’objet GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image21.png))</span></span>

<span data-ttu-id="e79e5-471">Pour exécuter le code en réponse à un événement de pipeline ASP.NET, nous pouvons créer le Gestionnaire d’événements appropriée dans Global.asax ou créer notre propre HTTP Module.</span><span class="sxs-lookup"><span data-stu-id="e79e5-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="e79e5-472">Pour ce didacticiel nous allons créer le Gestionnaire d’événements dans Global.asax.</span><span class="sxs-lookup"><span data-stu-id="e79e5-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="e79e5-473">Commencez par ajouter Global.asax à votre site Web.</span><span class="sxs-lookup"><span data-stu-id="e79e5-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="e79e5-474">Avec le bouton droit sur le nom du projet dans l’Explorateur de solutions et ajouter un élément de type classe d’Application globale nommée Global.asax.</span><span class="sxs-lookup"><span data-stu-id="e79e5-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="e79e5-475">[![Ajouter un fichier Global.asax à votre site Web](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e79e5-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-vb/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-vb/_static/image22.png)</span></span>

<span data-ttu-id="e79e5-476">**Figure 08**: Ajouter un fichier Global.asax à votre site Web ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="e79e5-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-vb/_static/image24.png))</span></span>

<span data-ttu-id="e79e5-477">Le modèle de Global.asax par défaut inclut des gestionnaires d’événements pour un nombre d’événements de pipeline ASP.NET, y compris le début, fin et [événement d’erreur](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), entre autres.</span><span class="sxs-lookup"><span data-stu-id="e79e5-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="e79e5-478">N’hésitez pas à supprimer ces gestionnaires d’événements, comme nous ne les requièrent pas pour cette application.</span><span class="sxs-lookup"><span data-stu-id="e79e5-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="e79e5-479">L’événement que nous sommes intéressés est PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="e79e5-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="e79e5-480">Mettez à jour votre fichier Global.asax pour son balisage ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e79e5-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample11.aspx)]

<span data-ttu-id="e79e5-481">L’Application\_OnPostAuthenticateRequest méthode s’exécute chaque fois que le runtime ASP.NET déclenche l’événement PostAuthenticateRequest, ce qui se produit une seule fois sur chaque demande entrante de la page.</span><span class="sxs-lookup"><span data-stu-id="e79e5-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="e79e5-482">Le Gestionnaire d’événements démarre en vérifiant si l’utilisateur est authentifié et a été authentifié via l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="e79e5-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="e79e5-483">Dans ce cas, un nouvel objet CustomIdentity est créé et transmis le ticket d’authentification de la demande actuelle dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="e79e5-484">Ensuite, un objet CustomPrincipal est créé et transmis l’objet CustomIdentity récemment créée dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="e79e5-485">Enfin, le contexte de sécurité de la demande en cours est affecté à l’objet CustomPrincipal nouvellement créé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="e79e5-486">Notez que la dernière étape - associer l’objet CustomPrincipal du contexte de sécurité de la demande - affecte l’entité de sécurité à deux propriétés : HttpContext.User et Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="e79e5-487">Ces deux affectations sont nécessaires en raison du traitement des contextes de sécurité dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e79e5-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="e79e5-488">Le .NET Framework associe un contexte de sécurité à chaque thread en cours d’exécution ; Ces informations sont disponibles en tant qu’objet IPrincipal via le [objet Thread](https://msdn.microsoft.com/library/system.threading.thread.aspx)de [propriété CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="e79e5-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="e79e5-489">Une confusion est que ASP.NET a ses propres informations de contexte de sécurité (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="e79e5-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="e79e5-490">Dans certains scénarios, la propriété Thread.CurrentPrincipal est examinée pour déterminer le contexte de sécurité ; dans d’autres scénarios, HttpContext.User est utilisé.</span><span class="sxs-lookup"><span data-stu-id="e79e5-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="e79e5-491">Par exemple, il existe des fonctionnalités de sécurité dans .NET qui permettent aux développeurs de façon déclarative état quels utilisateurs ou rôles peuvent instancier une classe ou appeler des méthodes spécifiques (voir [Ajout de règles d’autorisation pour l’entreprise et les couches de données à l’aide PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="e79e5-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="e79e5-492">Dans les coulisses, ces techniques déclaratives déterminent le contexte de sécurité via la propriété Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="e79e5-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="e79e5-493">Dans d’autres scénarios, la propriété HttpContext.User est utilisée.</span><span class="sxs-lookup"><span data-stu-id="e79e5-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="e79e5-494">Par exemple, dans le didacticiel précédent, nous avons utilisé cette propriété pour afficher le nom d’utilisateur de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="e79e5-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="e79e5-495">Clairement, puis, il est impératif que les informations de contexte de sécurité dans les propriétés Thread.CurrentPrincipal et HttpContext.User concordent.</span><span class="sxs-lookup"><span data-stu-id="e79e5-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="e79e5-496">Le runtime ASP.NET synchronise automatiquement ces valeurs de propriété pour nous.</span><span class="sxs-lookup"><span data-stu-id="e79e5-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="e79e5-497">Toutefois, cette synchronisation se produit après l’événement AuthenticateRequest, mais *avant* l’événement PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="e79e5-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="e79e5-498">Par conséquent, lors de l’ajout d’une entité personnalisée dans l’événement PostAuthenticateRequest nous devons être certain attribuer manuellement le Thread.CurrentPrincipal sinon Thread.CurrentPrincipal et HttpContext.User seront désynchronisés. Consultez [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) pour une étude plus détaillée de ce problème.</span><span class="sxs-lookup"><span data-stu-id="e79e5-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="e79e5-499">L’accès aux valeurs CompanyName et propriétés du titre</span><span class="sxs-lookup"><span data-stu-id="e79e5-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="e79e5-500">Chaque fois qu’une demande arrive et est distribuée au moteur ASP.NET, l’Application\_activer de gestionnaire d’événements OnPostAuthenticateRequest dans Global.asax.</span><span class="sxs-lookup"><span data-stu-id="e79e5-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="e79e5-501">Si la demande a été correctement authentifiée par FormsAuthenticationModule, le Gestionnaire d’événements crée un nouvel objet CustomPrincipal avec un objet CustomIdentity selon le ticket d’authentification par formulaires.</span><span class="sxs-lookup"><span data-stu-id="e79e5-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="e79e5-502">Avec cette logique en place, l’accès aux informations sur le nom de la société et le titre de l’utilisateur actuellement connecté est incroyablement simple.</span><span class="sxs-lookup"><span data-stu-id="e79e5-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="e79e5-503">Revenir à la Page\_Gestionnaire d’événements Load dans Default.aspx, où à l’étape 4, nous avons écrit le code pour récupérer le ticket d’authentification par formulaire et d’analyser la propriété UserData afin d’afficher le nom de la société et le titre de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e79e5-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="e79e5-504">Avec les objets CustomPrincipal et CustomIdentity en cours d’utilisation maintenant, il est inutile pour analyser les valeurs de propriété de UserData du ticket.</span><span class="sxs-lookup"><span data-stu-id="e79e5-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="e79e5-505">Au lieu de cela, simplement obtenir une référence à l’objet CustomIdentity et utiliser ses propriétés CompanyName et titre :</span><span class="sxs-lookup"><span data-stu-id="e79e5-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-vb[Main](forms-authentication-configuration-and-advanced-topics-vb/samples/sample12.vb)]

## <a name="summary"></a><span data-ttu-id="e79e5-506">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="e79e5-506">Summary</span></span>

<span data-ttu-id="e79e5-507">Dans ce didacticiel, nous avons examiné comment personnaliser les paramètres du système d’authentification forms via le fichier Web.config. Nous avons vu comment les expiration du ticket d’authentification est gérée et comment les dispositifs de protection de chiffrement et validation servent à protéger le ticket d’inspection et de modification.</span><span class="sxs-lookup"><span data-stu-id="e79e5-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="e79e5-508">Enfin, nous avons abordé à l’aide de la propriété UserData du ticket d’authentification pour stocker des informations utilisateur supplémentaires dans le ticket lui-même et comment utiliser des objets principal et identity personnalisés pour exposer ces informations de façon plus conviviales et.</span><span class="sxs-lookup"><span data-stu-id="e79e5-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="e79e5-509">Ce didacticiel conclut notre examen de l’authentification par formulaire dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e79e5-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="e79e5-510">Le didacticiel suivant démarre notre parcours dans le cadre de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="e79e5-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="e79e5-511">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="e79e5-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e79e5-512">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="e79e5-512">Further Reading</span></span>

<span data-ttu-id="e79e5-513">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="e79e5-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e79e5-514">DISSECTION l’authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="e79e5-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="e79e5-515">Explication : Authentification par formulaire dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e79e5-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="e79e5-516">Guide pratique pour Protéger l’authentification par formulaire dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e79e5-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="e79e5-517">[Professional ASP.NET 2.0 Security, l’appartenance et la gestion de rôle](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN : 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="e79e5-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="e79e5-518">Sécurisation des contrôles de connexion</span><span class="sxs-lookup"><span data-stu-id="e79e5-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="e79e5-519">Le &lt;authentification&gt; élément</span><span class="sxs-lookup"><span data-stu-id="e79e5-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="e79e5-520">Le &lt;forms&gt; élément pour &lt;l’authentification&gt;</span><span class="sxs-lookup"><span data-stu-id="e79e5-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="e79e5-521">Le &lt;machineKey&gt; élément</span><span class="sxs-lookup"><span data-stu-id="e79e5-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="e79e5-522">Comprendre le Ticket d’authentification par formulaires et le Cookie</span><span class="sxs-lookup"><span data-stu-id="e79e5-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="e79e5-523">Vidéos de formation sur les rubriques contenues dans ce didacticiel</span><span class="sxs-lookup"><span data-stu-id="e79e5-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="e79e5-524">Comment modifier les propriétés d’authentification Forms</span><span class="sxs-lookup"><span data-stu-id="e79e5-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="e79e5-525">Comment le programme d’installation et utilisez l’authentification sans Cookie dans une Application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e79e5-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="e79e5-526">Réadressage de connexion par formulaires ASP</span><span class="sxs-lookup"><span data-stu-id="e79e5-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="e79e5-527">Configuration de clé personnalisée de la connexion par formulaires</span><span class="sxs-lookup"><span data-stu-id="e79e5-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="e79e5-528">Ajouter des données personnalisées à la méthode d’authentification</span><span class="sxs-lookup"><span data-stu-id="e79e5-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="e79e5-529">Utiliser des objets de principal personnalisés</span><span class="sxs-lookup"><span data-stu-id="e79e5-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="e79e5-530">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="e79e5-530">About the Author</span></span>

<span data-ttu-id="e79e5-531">Scott Mitchell, auteur de plusieurs livres sur ASP/ASP.NET et fondateur de 4GuysFromRolla.com, travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="e79e5-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e79e5-532">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="e79e5-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e79e5-533">Son dernier ouvrage est *[SAM animer vous-même ASP.NET 2.0 des dernières 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="e79e5-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="e79e5-534">Scott peut être atteint à [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou via son blog à [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="e79e5-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="e79e5-535">Remerciements</span><span class="sxs-lookup"><span data-stu-id="e79e5-535">Special Thanks To</span></span>

<span data-ttu-id="e79e5-536">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="e79e5-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e79e5-537">Entraîner un réviseur pour ce didacticiel a été Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="e79e5-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="e79e5-538">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="e79e5-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e79e5-539">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="e79e5-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e79e5-540">Précédent</span><span class="sxs-lookup"><span data-stu-id="e79e5-540">Previous</span></span>](an-overview-of-forms-authentication-vb.md)
