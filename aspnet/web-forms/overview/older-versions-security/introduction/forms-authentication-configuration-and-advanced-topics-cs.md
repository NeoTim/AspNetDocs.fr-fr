---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Configuration de l’authentification par formulaire etC#rubriques avancées () | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous allons examiner les différents paramètres d’authentification par formulaire et voir comment les modifier par le biais de l’élément Forms. Cela entraînera une description détaillée...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: b296f31da1c73df97175d94402b4d618df425d8d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78641770"
---
# <a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="a489c-104">Configuration et questions avancées de l’authentification par formulaire (C#)</span><span class="sxs-lookup"><span data-stu-id="a489c-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>

<span data-ttu-id="a489c-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a489c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a489c-106">[Télécharger le code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) ou [Télécharger le PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="a489c-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="a489c-107">Dans ce didacticiel, nous allons examiner les différents paramètres d’authentification par formulaire et voir comment les modifier par le biais de l’élément Forms.</span><span class="sxs-lookup"><span data-stu-id="a489c-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="a489c-108">Cela entraînera un examen détaillé de la personnalisation de la valeur du délai d’attente du ticket d’authentification par formulaire à l’aide d’une page de connexion avec une URL personnalisée (comme Sign. aspx au lieu de login. aspx) et des tickets d’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="a489c-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="a489c-109">Introduction</span></span>

<span data-ttu-id="a489c-110">Dans le [didacticiel précédent](an-overview-of-forms-authentication-cs.md) , nous avons examiné les étapes nécessaires à l’implémentation de l’authentification par formulaire dans une application ASP.net, de la spécification des paramètres de configuration dans Web. config à la création d’une page de connexion pour afficher un contenu différent pour les utilisateurs authentifiés et anonymes.</span><span class="sxs-lookup"><span data-stu-id="a489c-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="a489c-111">Rappelez-vous que nous avons configuré le site Web pour utiliser l’authentification par formulaire en affectant à l’attribut mode de l’élément&gt; de l’authentification &lt;la valeur Forms.</span><span class="sxs-lookup"><span data-stu-id="a489c-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="a489c-112">L’élément &lt;&gt; d’authentification peut éventuellement inclure un élément enfant &lt;Forms&gt;, par l’intermédiaire duquel un assortiment de paramètres d’authentification par formulaire peut être spécifié.</span><span class="sxs-lookup"><span data-stu-id="a489c-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="a489c-113">Dans ce didacticiel, nous allons examiner les différents paramètres d’authentification par formulaire et voir comment les modifier par le biais de l’élément &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="a489c-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="a489c-114">Cela entraînera un examen détaillé de la personnalisation de la valeur du délai d’attente du ticket d’authentification par formulaire à l’aide d’une page de connexion avec une URL personnalisée (comme Sign. aspx au lieu de login. aspx) et des tickets d’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="a489c-115">Nous examinerons également plus en détail la composition du ticket d’authentification par formulaire et voyons les précautions que ASP.NET prend pour s’assurer que les données du ticket sont protégées contre l’inspection et la falsification.</span><span class="sxs-lookup"><span data-stu-id="a489c-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="a489c-116">Enfin, nous verrons comment stocker des données utilisateur supplémentaires dans le ticket d’authentification par formulaire et comment modéliser ces données par le biais d’un objet principal personnalisé.</span><span class="sxs-lookup"><span data-stu-id="a489c-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="a489c-117">Étape 1 : examen des paramètres de configuration de &lt;Forms&gt;</span><span class="sxs-lookup"><span data-stu-id="a489c-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="a489c-118">Le système d’authentification par formulaire dans ASP.NET offre un certain nombre de paramètres de configuration qui peuvent être personnalisés au niveau de l’application.</span><span class="sxs-lookup"><span data-stu-id="a489c-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="a489c-119">Cela comprend des paramètres tels que : la durée de vie du ticket d’authentification par formulaire ; le type de protection appliqué au ticket ; dans quelles conditions les tickets d’authentification sans cookies sont utilisés ; chemin d’accès à la page de connexion ; et d’autres informations.</span><span class="sxs-lookup"><span data-stu-id="a489c-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="a489c-120">Pour modifier les valeurs par défaut, ajoutez un [élément&lt;forms&gt;](https://msdn.microsoft.com/library/1d3t3c61.aspx) en tant qu’enfant de l' [élément&lt;&gt;](https://msdn.microsoft.com/library/532aee0e.aspx)de l’authentification, en spécifiant les valeurs de propriété que vous souhaitez personnaliser comme attributs XML comme suit :</span><span class="sxs-lookup"><span data-stu-id="a489c-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="a489c-121">Le tableau 1 résume les propriétés qui peuvent être personnalisées par le biais de l’élément &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="a489c-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="a489c-122">Comme Web. config est un fichier XML, les noms d’attributs dans la colonne de gauche sont sensibles à la casse.</span><span class="sxs-lookup"><span data-stu-id="a489c-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="a489c-123"><strong>Attribut</strong></span><span class="sxs-lookup"><span data-stu-id="a489c-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="a489c-124"><strong>Description</strong></span><span class="sxs-lookup"><span data-stu-id="a489c-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="a489c-125">sans cookies</span><span class="sxs-lookup"><span data-stu-id="a489c-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="a489c-126">Cet attribut spécifie dans quelles conditions le ticket d’authentification est stocké dans un cookie et est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="a489c-127">Les valeurs autorisées sont : UseCookies ; UseUri; Détection automatique et UseDeviceProfile (valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="a489c-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="a489c-128">L’étape 2 examine ce paramètre plus en détail.</span><span class="sxs-lookup"><span data-stu-id="a489c-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="a489c-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="a489c-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="a489c-130">Indique l’URL vers laquelle les utilisateurs sont redirigés après s’être connecté à partir de la page de connexion si aucune valeur RedirectUrl n’est spécifiée dans la chaîne de chaîne.</span><span class="sxs-lookup"><span data-stu-id="a489c-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="a489c-131">La valeur par défaut est default.aspx.</span><span class="sxs-lookup"><span data-stu-id="a489c-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="a489c-132">de domaine</span><span class="sxs-lookup"><span data-stu-id="a489c-132">domain</span></span>           | <span data-ttu-id="a489c-133">Lorsque vous utilisez des tickets d’authentification par cookie, ce paramètre spécifie la valeur de domaine du cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="a489c-134">La valeur par défaut est une chaîne vide, ce qui amène le navigateur à utiliser le domaine à partir duquel il a été émis (par exemple, www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="a489c-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="a489c-135">Dans ce cas, le cookie n’est <strong>pas</strong> envoyé lors de la demande de sous-domaines, tels que admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="a489c-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="a489c-136">Si vous souhaitez que le cookie soit passé à tous les sous-domaines, vous devez personnaliser l’attribut de domaine en lui affectant la valeur yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="a489c-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="a489c-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="a489c-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="a489c-138">Valeur booléenne indiquant si les utilisateurs authentifiés sont mémorisés lorsqu’ils sont redirigés vers des URL dans d’autres applications Web sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="a489c-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="a489c-139">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="a489c-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="a489c-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="a489c-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="a489c-141">URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="a489c-141">The URL of the login page.</span></span> <span data-ttu-id="a489c-142">La valeur par défaut est login.aspx.</span><span class="sxs-lookup"><span data-stu-id="a489c-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="a489c-143">name</span><span class="sxs-lookup"><span data-stu-id="a489c-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="a489c-144">Lorsque vous utilisez des tickets d’authentification par cookie, le nom du cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="a489c-145">La valeur par défaut est. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="a489c-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="a489c-146">path</span><span class="sxs-lookup"><span data-stu-id="a489c-146">path</span></span>            |                                                                             <span data-ttu-id="a489c-147">Lorsque vous utilisez des tickets d’authentification par cookie, ce paramètre spécifie l’attribut de chemin d’accès du cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="a489c-148">L’attribut path permet à un développeur de limiter l’étendue d’un cookie à une hiérarchie de répertoires particulière.</span><span class="sxs-lookup"><span data-stu-id="a489c-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="a489c-149">La valeur par défaut est/, qui indique au navigateur d’envoyer le cookie de ticket d’authentification à toute demande adressée au domaine.</span><span class="sxs-lookup"><span data-stu-id="a489c-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="a489c-150">protection</span><span class="sxs-lookup"><span data-stu-id="a489c-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="a489c-151">Indique les techniques utilisées pour protéger le ticket d’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="a489c-152">Les valeurs autorisées sont : All (valeur par défaut); Chiffre None et la validation.</span><span class="sxs-lookup"><span data-stu-id="a489c-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="a489c-153">Ces paramètres sont décrits en détail à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="a489c-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="a489c-154">requireSSL</span><span class="sxs-lookup"><span data-stu-id="a489c-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="a489c-155">Valeur booléenne qui indique si une connexion SSL est requise pour transmettre le cookie d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="a489c-156">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="a489c-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="a489c-157">slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="a489c-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="a489c-158">Valeur booléenne qui indique si le délai d’expiration du cookie d’authentification est réinitialisé chaque fois que l’utilisateur visite le site au cours d’une seule session.</span><span class="sxs-lookup"><span data-stu-id="a489c-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="a489c-159">La valeur par défaut est true.</span><span class="sxs-lookup"><span data-stu-id="a489c-159">The default value is true.</span></span> <span data-ttu-id="a489c-160">La stratégie d’expiration du ticket d’authentification est décrite plus en détail dans la section Spécification de la valeur du délai d’attente du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="a489c-161">délai d'expiration</span><span class="sxs-lookup"><span data-stu-id="a489c-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="a489c-162">Spécifie la durée, en minutes, au terme de laquelle le cookie de ticket d’authentification expire.</span><span class="sxs-lookup"><span data-stu-id="a489c-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="a489c-163">La valeur par défaut est 30.</span><span class="sxs-lookup"><span data-stu-id="a489c-163">The default value is 30.</span></span> <span data-ttu-id="a489c-164">La stratégie d’expiration du ticket d’authentification est décrite plus en détail dans la section Spécification de la valeur du délai d’attente du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="a489c-165">**Tableau 1**: Résumé des attributs de l’élément de &lt;forms&gt;</span><span class="sxs-lookup"><span data-stu-id="a489c-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="a489c-166">Dans ASP.NET 2,0 et au-delà, les valeurs d’authentification par défaut des formulaires sont codées en dur dans la classe FormsAuthenticationConfiguration du .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a489c-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="a489c-167">Toutes les modifications doivent être appliquées au niveau application par application dans le fichier Web. config.</span><span class="sxs-lookup"><span data-stu-id="a489c-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="a489c-168">Cela diffère de ASP.NET 1. x, où les valeurs d’authentification par défaut des formulaires étaient stockées dans le fichier machine. config (et peuvent donc être modifiées via la modification de machine. config).</span><span class="sxs-lookup"><span data-stu-id="a489c-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="a489c-169">Dans le sujet de ASP.NET 1. x, il est utile de mentionner qu’un certain nombre de paramètres système d’authentification par formulaire ont des valeurs par défaut différentes dans le ASP.NET 2,0 et au-delà de ASP.NET 1. x.</span><span class="sxs-lookup"><span data-stu-id="a489c-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="a489c-170">Si vous migrez votre application à partir d’un environnement ASP.NET 1. x, il est important de connaître ces différences.</span><span class="sxs-lookup"><span data-stu-id="a489c-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="a489c-171">Pour obtenir la liste des différences, consultez [la documentation technique de l’élément &lt;forms&gt;](https://msdn.microsoft.com/library/1d3t3c61.aspx) .</span><span class="sxs-lookup"><span data-stu-id="a489c-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-172">Plusieurs paramètres d’authentification par formulaire, tels que le délai d’attente, le domaine et le chemin d’accès, spécifient des détails pour le cookie de ticket d’authentification par formulaire résultant.</span><span class="sxs-lookup"><span data-stu-id="a489c-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="a489c-173">Pour plus d’informations sur les cookies, leur fonctionnement et leurs différentes propriétés, lisez [ce didacticiel sur les cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="a489c-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="a489c-174">Spécification de la valeur du délai d’attente du ticket</span><span class="sxs-lookup"><span data-stu-id="a489c-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="a489c-175">Le ticket d’authentification par formulaire est un jeton qui représente une identité.</span><span class="sxs-lookup"><span data-stu-id="a489c-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="a489c-176">Avec les tickets d’authentification basés sur les cookies, ce jeton est conservé sous la forme d’un cookie et est envoyé au serveur Web à chaque demande.</span><span class="sxs-lookup"><span data-stu-id="a489c-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="a489c-177">La possession du jeton, en résumé, déclare, je suis le *nom d’utilisateur*, j’ai déjà ouvert une session et est utilisé pour que l’identité d’un utilisateur puisse être mémorisée au fil des visites de page.</span><span class="sxs-lookup"><span data-stu-id="a489c-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="a489c-178">Le ticket d’authentification par formulaire inclut non seulement l’identité de l’utilisateur, mais contient également des informations pour garantir l’intégrité et la sécurité du jeton.</span><span class="sxs-lookup"><span data-stu-id="a489c-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="a489c-179">Après tout, nous ne souhaitons pas qu’un utilisateur être mal intentionné soit en mesure de créer un jeton contrefait ou de modifier un jeton de manière légitime.</span><span class="sxs-lookup"><span data-stu-id="a489c-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="a489c-180">L’une des informations incluses dans le ticket est l' *expiration*, c’est-à-dire la date et l’heure auxquelles le ticket n’est plus valide.</span><span class="sxs-lookup"><span data-stu-id="a489c-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="a489c-181">Chaque fois que le FormsAuthenticationModule inspecte un ticket d’authentification, il s’assure que l’expiration du ticket n’est pas encore passée.</span><span class="sxs-lookup"><span data-stu-id="a489c-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="a489c-182">Si c’est le cas, il ignore le ticket et identifie l’utilisateur comme étant anonyme.</span><span class="sxs-lookup"><span data-stu-id="a489c-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="a489c-183">Cette protection permet de se protéger contre les attaques par relecture.</span><span class="sxs-lookup"><span data-stu-id="a489c-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="a489c-184">Sans expiration, si un pirate était en mesure d’obtenir ses mains sur le ticket d’authentification valide d’un utilisateur (peut-être en obtenant un accès physique à son ordinateur et en utilisant ses cookies), il pourrait envoyer une requête au serveur avec ce ticket d’authentification volé et entrée gain.</span><span class="sxs-lookup"><span data-stu-id="a489c-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="a489c-185">Bien que l’expiration n’empêche pas ce scénario, elle limite la fenêtre pendant laquelle une telle attaque peut être menée à bien.</span><span class="sxs-lookup"><span data-stu-id="a489c-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-186">L’étape 3 détaille les techniques supplémentaires utilisées par le système d’authentification par formulaire pour protéger le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="a489c-187">Lors de la création du ticket d’authentification, le système d’authentification par formulaire détermine son expiration en consultant le paramètre de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="a489c-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="a489c-188">Comme indiqué dans le tableau 1, la valeur par défaut du délai d’expiration est de 30 minutes, ce qui signifie que lorsque le ticket d’authentification par formulaire est créé, son expiration est définie sur une date et une heure 30 minutes à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="a489c-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="a489c-189">L’expiration définit une heure absolue à l’avenir lorsque le ticket d’authentification par formulaire expire.</span><span class="sxs-lookup"><span data-stu-id="a489c-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="a489c-190">Mais généralement, les développeurs veulent implémenter une expiration glissante, qui est réinitialisée chaque fois que l’utilisateur revisite le site.</span><span class="sxs-lookup"><span data-stu-id="a489c-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="a489c-191">Ce comportement est déterminé par les paramètres slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="a489c-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="a489c-192">Si la valeur est true (valeur par défaut), chaque fois que FormsAuthenticationModule authentifie un utilisateur, il met à jour l’expiration du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="a489c-193">Si la valeur est false, l’expiration n’est pas mise à jour à chaque demande, provoquant ainsi l’expiration exacte du ticket en fonction du délai d’expiration du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-194">L’expiration stockée dans le ticket d’authentification est une valeur de date et d’heure absolue, comme le 2 août 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="a489c-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="a489c-195">En outre, la date et l’heure sont relatives à l’heure locale du serveur Web.</span><span class="sxs-lookup"><span data-stu-id="a489c-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="a489c-196">Cette décision de conception peut avoir des effets secondaires intéressants sur l’heure d’été (DST), c’est-à-dire lorsque les horloges du États-Unis sont déplacées avant une heure (en supposant que le serveur Web est hébergé dans des paramètres régionaux dans lesquels l’heure d’été est observée).</span><span class="sxs-lookup"><span data-stu-id="a489c-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="a489c-197">Envisagez ce qui se passerait pour un site Web ASP.NET avec une expiration de 30 minutes près de la date de début de l’heure d’été (à 2:00 AM).</span><span class="sxs-lookup"><span data-stu-id="a489c-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="a489c-198">Imaginez qu’un visiteur se connecte au site le 11 mars à 2008 à 1:55 AM.</span><span class="sxs-lookup"><span data-stu-id="a489c-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="a489c-199">Cela génère un ticket d’authentification par formulaire qui expire à partir du 11 mars à 2008 à 2:25 AM (30 minutes dans le futur).</span><span class="sxs-lookup"><span data-stu-id="a489c-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="a489c-200">Toutefois, une fois que 2:00 passe, l’horloge passe à 3:00 AM en raison de l’heure d’été.</span><span class="sxs-lookup"><span data-stu-id="a489c-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="a489c-201">Lorsque l’utilisateur charge une nouvelle page six minutes après la connexion (à 3:01 AM), FormsAuthenticationModule note que le ticket a expiré et redirige l’utilisateur vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="a489c-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="a489c-202">Pour une discussion plus approfondie sur ce singularités et les autres délais d’expiration du ticket d’authentification, ainsi que des solutions de contournement, prenez une copie de la gestion de la *sécurité, de l’appartenance et de la gestion des rôles ASP.NET 2,0* de Stefan Schackow (ISBN : 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="a489c-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="a489c-203">La figure 1 illustre le flux de travail lorsque slidingExpiration a la valeur false et que timeout a la valeur 30.</span><span class="sxs-lookup"><span data-stu-id="a489c-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="a489c-204">Notez que le ticket d’authentification généré à la connexion contient la date d’expiration et que cette valeur n’est pas mise à jour lors des requêtes suivantes.</span><span class="sxs-lookup"><span data-stu-id="a489c-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="a489c-205">Si FormsAuthenticationModule constate que le ticket a expiré, il le supprime et traite la demande comme anonyme.</span><span class="sxs-lookup"><span data-stu-id="a489c-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="a489c-206">[![une représentation graphique de l’expiration du ticket d’authentification par formulaire lorsque slidingExpiration a la valeur false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="a489c-207">**Figure 01**: représentation graphique de l’expiration du ticket d’authentification par formulaire lorsque SlidingExpiration a la valeur false ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>

<span data-ttu-id="a489c-208">La figure 2 illustre le flux de travail lorsque slidingExpiration a la valeur true et que timeout a la valeur 30.</span><span class="sxs-lookup"><span data-stu-id="a489c-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="a489c-209">Lorsqu’une demande authentifiée est reçue (avec un ticket non expiré), son expiration est mise à jour en fonction du délai d’attente en minutes à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="a489c-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="a489c-210">[![une représentation graphique du ticket d’authentification par formulaire lorsque slidingExpiration a la valeur true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="a489c-211">**Figure 02**: représentation graphique du ticket d’authentification par formulaire lorsque SlidingExpiration a la valeur true ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>

<span data-ttu-id="a489c-212">Lors de l’utilisation de tickets d’authentification basés sur les cookies (valeur par défaut), cette discussion devient un peu plus confuse, car les cookies peuvent également avoir leur propre expiration spécifiée.</span><span class="sxs-lookup"><span data-stu-id="a489c-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="a489c-213">L’expiration (ou l’absence d’un cookie) indique au navigateur si le cookie doit être détruit.</span><span class="sxs-lookup"><span data-stu-id="a489c-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="a489c-214">Si le cookie n’a pas expiré, il est détruit lorsque le navigateur s’arrête.</span><span class="sxs-lookup"><span data-stu-id="a489c-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="a489c-215">Toutefois, si un délai d’expiration est présent, le cookie reste stocké sur l’ordinateur de l’utilisateur jusqu’à ce que la date et l’heure spécifiées dans l’expiration se soient écoulées.</span><span class="sxs-lookup"><span data-stu-id="a489c-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="a489c-216">Lorsqu’un cookie est détruit par le navigateur, il n’est plus envoyé au serveur Web.</span><span class="sxs-lookup"><span data-stu-id="a489c-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="a489c-217">Par conséquent, la destruction d’un cookie est analogue à celle de l’utilisateur qui se déconnecte du site.</span><span class="sxs-lookup"><span data-stu-id="a489c-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-218">Bien entendu, un utilisateur peut supprimer de manière proactive les cookies stockés sur son ordinateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="a489c-219">Dans Internet Explorer 7, accédez à outils, options, puis cliquez sur le bouton supprimer dans la section historique de navigation.</span><span class="sxs-lookup"><span data-stu-id="a489c-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="a489c-220">À partir de là, cliquez sur le bouton supprimer les cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="a489c-221">Le système d’authentification par formulaire crée des cookies basés sur une session ou une expiration en fonction de la valeur transmise au paramètre *persistCookie* .</span><span class="sxs-lookup"><span data-stu-id="a489c-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="a489c-222">N’oubliez pas que les méthodes GetAuthCookie, SetAuthCookie et RedirectFromLoginPage de la classe FormsAuthentication acceptent deux paramètres d’entrée : *username* et *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="a489c-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="a489c-223">La page de connexion que nous avons créée dans le didacticiel précédent comprenait une case à cocher mémoriser, qui déterminait si un cookie persistant a été créé.</span><span class="sxs-lookup"><span data-stu-id="a489c-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="a489c-224">Les cookies persistants sont basés sur l’expiration ; les cookies non persistants sont basés sur une session.</span><span class="sxs-lookup"><span data-stu-id="a489c-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="a489c-225">Les concepts du délai d’expiration et de l’slidingExpiration déjà abordés s’appliquent de la même façon aux cookies de session et d’expiration.</span><span class="sxs-lookup"><span data-stu-id="a489c-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="a489c-226">Il n’y a qu’une seule différence mineure d’exécution : lorsque vous utilisez des cookies d’expiration avec slidingTimeout défini sur true, l’expiration du cookie n’est mise à jour que lorsque plus de la moitié du temps spécifié s’est écoulée.</span><span class="sxs-lookup"><span data-stu-id="a489c-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="a489c-227">Nous allons mettre à jour les stratégies de délai d’expiration du ticket d’authentification du site Web afin que les tickets expirent après une heure (60 minutes), à l’aide d’une expiration décalée.</span><span class="sxs-lookup"><span data-stu-id="a489c-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="a489c-228">Pour appliquer cette modification, mettez à jour le fichier Web. config, en ajoutant un élément &lt;Forms&gt; à la &lt;élément&gt; de l’authentification avec le balisage suivant :</span><span class="sxs-lookup"><span data-stu-id="a489c-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="a489c-229">Utilisation d’une URL de page de connexion différente de login. aspx</span><span class="sxs-lookup"><span data-stu-id="a489c-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="a489c-230">Étant donné que FormsAuthenticationModule redirige automatiquement les utilisateurs non autorisés vers la page de connexion, il doit connaître l’URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="a489c-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="a489c-231">Cette URL est spécifiée par l’attribut loginUrl dans l’élément &lt;Forms&gt; et par défaut, login. aspx.</span><span class="sxs-lookup"><span data-stu-id="a489c-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="a489c-232">Si vous effectuez un portage sur un site Web existant, vous disposez peut-être déjà d’une page de connexion avec une autre URL, qui a déjà été marquée d’un signet et indexé par les moteurs de recherche.</span><span class="sxs-lookup"><span data-stu-id="a489c-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="a489c-233">Au lieu de renommer votre page de connexion existante en login. aspx et de rompre les liens et les signets des utilisateurs, vous pouvez modifier l’attribut loginUrl pour qu’il pointe vers votre page de connexion.</span><span class="sxs-lookup"><span data-stu-id="a489c-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="a489c-234">Par exemple, si votre page de connexion s’appelait Sign. aspx et se trouvait dans le répertoire Users, vous pouviez faire pointer le paramètre de configuration loginUrl sur ~/Users/SignIn.aspx comme suit :</span><span class="sxs-lookup"><span data-stu-id="a489c-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="a489c-235">Étant donné que notre application actuelle a déjà une page de connexion nommée Login. aspx, il n’est pas nécessaire de spécifier une valeur personnalisée dans l’élément &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="a489c-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="a489c-236">Étape 2 : utilisation de tickets d’authentification par formulaire sans cookie</span><span class="sxs-lookup"><span data-stu-id="a489c-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="a489c-237">Par défaut, le système d’authentification par formulaire détermine s’il faut stocker ses tickets d’authentification dans la collection de cookies ou les incorporer dans l’URL en fonction de l’agent utilisateur visitant le site.</span><span class="sxs-lookup"><span data-stu-id="a489c-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="a489c-238">Tous les navigateurs de bureau standard comme Internet Explorer, Firefox, Opera et Safari prennent en charge les cookies, mais pas tous les périphériques mobiles.</span><span class="sxs-lookup"><span data-stu-id="a489c-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="a489c-239">La stratégie de cookie utilisée par le système d’authentification par formulaire dépend du paramètre sans cookies dans l’élément &lt;Forms&gt;, qui peut être affecté à l’une des quatre valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="a489c-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="a489c-240">UseCookies : spécifie que les tickets d’authentification basés sur les cookies sont toujours utilisés.</span><span class="sxs-lookup"><span data-stu-id="a489c-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="a489c-241">UseUri : indique que les tickets d’authentification basés sur les cookies ne seront jamais utilisés.</span><span class="sxs-lookup"><span data-stu-id="a489c-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="a489c-242">Détection automatique : si le profil de l’appareil ne prend pas en charge les cookies, les tickets d’authentification basés sur les cookies ne sont pas utilisés. Si le profil de périphérique prend en charge les cookies, un mécanisme de détection est utilisé pour déterminer si les cookies sont activés.</span><span class="sxs-lookup"><span data-stu-id="a489c-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="a489c-243">UseDeviceProfile-la valeur par défaut ; utilise les tickets d’authentification par cookie uniquement si le profil de périphérique prend en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="a489c-244">Aucun mécanisme de détection n’est utilisé.</span><span class="sxs-lookup"><span data-stu-id="a489c-244">No probing mechanism is used.</span></span>

<span data-ttu-id="a489c-245">Les paramètres AutoDetect et UseDeviceProfile s’appuient sur un *profil d’appareil* pour déterminer s’il faut utiliser des tickets d’authentification par cookie ou sans cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="a489c-246">ASP.NET gère une base de données de divers appareils et leurs fonctionnalités, par exemple s’ils prennent en charge les cookies, la version de JavaScript qu’ils prennent en charge, etc.</span><span class="sxs-lookup"><span data-stu-id="a489c-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="a489c-247">Chaque fois qu’un appareil demande une page Web à partir d’un serveur Web, il l’envoie le long d’un en-tête http de *l’agent utilisateur* qui identifie le type d’appareil.</span><span class="sxs-lookup"><span data-stu-id="a489c-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="a489c-248">ASP.NET correspond automatiquement à la chaîne User-agent fournie avec le profil correspondant spécifié dans sa base de données.</span><span class="sxs-lookup"><span data-stu-id="a489c-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-249">Cette base de données de fonctionnalités d’appareil est stockée dans un certain nombre de fichiers XML qui adhèrent au [schéma du fichier de définition de navigateur](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="a489c-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="a489c-250">Les fichiers de profil d’appareil par défaut se trouvent dans%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="a489c-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="a489c-251">Vous pouvez également ajouter des fichiers personnalisés au dossier des navigateurs de\_d’applications de votre application.</span><span class="sxs-lookup"><span data-stu-id="a489c-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="a489c-252">Pour plus d’informations, consultez [Comment : détecter des types de navigateurs dans pages Web ASP.net](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="a489c-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="a489c-253">Étant donné que le paramètre par défaut est UseDeviceProfile, les tickets d’authentification par formulaire sans cookie sont utilisés lorsque le site est visité par un périphérique dont le profil signale qu’il ne prend pas en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="a489c-254">Encodage du ticket d’authentification dans l’URL</span><span class="sxs-lookup"><span data-stu-id="a489c-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="a489c-255">Les cookies sont un moyen naturel d’inclure des informations du navigateur dans chaque requête adressée à un site Web particulier, ce qui explique pourquoi les paramètres d’authentification par défaut des formulaires utilisent des cookies si l’appareil visité les prend en charge.</span><span class="sxs-lookup"><span data-stu-id="a489c-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="a489c-256">Si les cookies ne sont pas pris en charge, un autre moyen de transmettre le ticket d’authentification du client au serveur doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="a489c-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="a489c-257">Une solution de contournement courante utilisée dans les environnements sans cookies consiste à encoder les données de cookie dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="a489c-258">La meilleure façon de voir comment ces informations peuvent être incorporées dans l’URL est de forcer le site à utiliser des tickets d’authentification sans cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="a489c-259">Pour ce faire, définissez le paramètre de configuration cookieless sur UseUri :</span><span class="sxs-lookup"><span data-stu-id="a489c-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="a489c-260">Une fois que vous avez apporté cette modification, visitez le site via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="a489c-261">Lorsque vous vous rendez en tant qu’utilisateur anonyme, les URL se présentent exactement comme avant.</span><span class="sxs-lookup"><span data-stu-id="a489c-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="a489c-262">Par exemple, lors de la visite de la page default. aspx, la barre d’adresse de mon navigateur affiche l’URL suivante :</span><span class="sxs-lookup"><span data-stu-id="a489c-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="a489c-263">Toutefois, lors de la connexion, le ticket d’authentification par formulaire est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="a489c-264">Par exemple, après avoir visité la page de connexion et vous être connecté en tant que Sam, je suis renvoyé à la page default. aspx, mais l’URL est la suivante :</span><span class="sxs-lookup"><span data-stu-id="a489c-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="a489c-265">Le ticket d’authentification par formulaire a été incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="a489c-266">La chaîne (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) représente les informations de ticket d’authentification avec codage hexadécimal, et les mêmes données sont généralement stockées dans un cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="a489c-267">Pour que les tickets d’authentification sans cookie fonctionnent, le système doit encoder toutes les URL sur la page pour inclure les données du ticket d’authentification. dans le cas contraire, le ticket d’authentification sera perdu lorsque l’utilisateur cliquera sur un lien.</span><span class="sxs-lookup"><span data-stu-id="a489c-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="a489c-268">Heureusement, cette logique d’incorporation est exécutée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="a489c-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="a489c-269">Pour illustrer cette fonctionnalité, ouvrez la page default. aspx et ajoutez un contrôle de lien hypertexte, en affectant respectivement à ses propriétés Text et NavigateUrl la valeur Test Link et SomePage. aspx.</span><span class="sxs-lookup"><span data-stu-id="a489c-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="a489c-270">Peu importe qu’il ne s’agit pas d’une page de notre projet nommée SomePage. aspx.</span><span class="sxs-lookup"><span data-stu-id="a489c-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="a489c-271">Enregistrez les modifications apportées à default. aspx, puis accédez-y dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="a489c-272">Connectez-vous au site afin que le ticket d’authentification par formulaire soit incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="a489c-273">Ensuite, à partir de default. aspx, cliquez sur le lien du lien de test.</span><span class="sxs-lookup"><span data-stu-id="a489c-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="a489c-274">Que s'est-il passé ?</span><span class="sxs-lookup"><span data-stu-id="a489c-274">What happened?</span></span> <span data-ttu-id="a489c-275">Si aucune page nommée SomePage. aspx n’existe, une erreur 404 s’est produite, mais ce n’est pas ce qui est important ici.</span><span class="sxs-lookup"><span data-stu-id="a489c-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="a489c-276">Au lieu de cela, vous devez vous concentrer sur la barre d’adresses de votre navigateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="a489c-277">Notez qu’il comprend le ticket d’authentification par formulaire dans l’URL !</span><span class="sxs-lookup"><span data-stu-id="a489c-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="a489c-278">L’URL SomePage. aspx dans le lien a été automatiquement convertie en URL incluant le ticket d’authentification, nous n’avons pas eu à écrire de code.</span><span class="sxs-lookup"><span data-stu-id="a489c-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="a489c-279">Le ticket d’authentification par formulaire sera automatiquement incorporé dans l’URL pour tous les liens hypertexte qui ne commencent pas par `http://` ou `/`.</span><span class="sxs-lookup"><span data-stu-id="a489c-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="a489c-280">Peu importe si le lien hypertexte s’affiche dans un appel à Response. Redirect, dans un contrôle de lien hypertexte ou dans un élément HTML d’ancrage (c’est-à-dire `<a href="...">...</a>`).</span><span class="sxs-lookup"><span data-stu-id="a489c-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="a489c-281">Tant que l’URL n’est pas semblable à `http://www.someserver.com/SomePage.aspx` ou `/SomePage.aspx`, le ticket d’authentification par formulaire sera incorporé pour nous.</span><span class="sxs-lookup"><span data-stu-id="a489c-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-282">Les tickets d’authentification par formulaire sans cookie adhèrent aux mêmes stratégies de délai d’attente que les tickets d’authentification basés sur les cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="a489c-283">Toutefois, les tickets d’authentification sans cookies sont plus sujets aux attaques par relecture puisque le ticket d’authentification est incorporé directement dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="a489c-284">Imaginez un utilisateur qui visite un site Web, se connecte, puis colle l’URL d’un courrier électronique à un collègue.</span><span class="sxs-lookup"><span data-stu-id="a489c-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="a489c-285">Si le collègue clique sur ce lien avant que la date d’expiration soit atteinte, il est connecté en tant qu’utilisateur qui a envoyé l’e-mail.</span><span class="sxs-lookup"><span data-stu-id="a489c-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="a489c-286">Étape 3 : sécurisation du ticket d’authentification</span><span class="sxs-lookup"><span data-stu-id="a489c-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="a489c-287">Le ticket d’authentification par formulaire est transmis sur le réseau dans un cookie ou incorporé directement dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="a489c-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="a489c-288">En plus des informations d’identité, le ticket d’authentification peut également inclure des données utilisateur (comme nous le verrons à l’étape 4).</span><span class="sxs-lookup"><span data-stu-id="a489c-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="a489c-289">Par conséquent, il est important que les données du ticket soient chiffrées à partir d’yeux indiscrets et (encore plus important encore) que le système d’authentification par formulaire puisse garantir que le ticket n’a pas été falsifié.</span><span class="sxs-lookup"><span data-stu-id="a489c-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="a489c-290">Pour garantir la confidentialité des données du ticket, le système d’authentification par formulaire peut chiffrer les données du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="a489c-291">L’impossibilité de chiffrer les données de tickets envoie des informations potentiellement sensibles sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="a489c-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="a489c-292">Pour garantir l’authenticité d’un ticket, le système d’authentification par formulaire doit *valider* le ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="a489c-293">La validation consiste à s’assurer qu’un élément de données particulier n’a pas été modifié et est accompli par le biais d’un *[code d’authentification de message (Mac)](http://en.wikipedia.org/wiki/Message_authentication_code)* .</span><span class="sxs-lookup"><span data-stu-id="a489c-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="a489c-294">En résumé, le MAC est un petit élément d’information qui identifie les données qui doivent être validées (dans ce cas, le ticket).</span><span class="sxs-lookup"><span data-stu-id="a489c-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="a489c-295">Si les données représentées par le MAC sont modifiées, le MAC et les données ne correspondent pas.</span><span class="sxs-lookup"><span data-stu-id="a489c-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="a489c-296">En outre, il est difficile pour un pirate informatique de modifier les données et de générer son propre MAC pour correspondre aux données modifiées.</span><span class="sxs-lookup"><span data-stu-id="a489c-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="a489c-297">Lors de la création (ou de la modification) d’un ticket, le système d’authentification par formulaire crée un MAC et l’attache aux données du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="a489c-298">Lorsqu’une requête suivante arrive, le système d’authentification par formulaire compare les données de ticket et MAC pour valider l’authenticité des données de ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="a489c-299">La figure 3 illustre ce flux de travail graphiquement.</span><span class="sxs-lookup"><span data-stu-id="a489c-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="a489c-300">[![l’authenticité du ticket est garantie via un MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="a489c-301">**Figure 03**: l’authenticité du ticket est garantie via un Mac ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>

<span data-ttu-id="a489c-302">Les mesures de sécurité appliquées au ticket d’authentification dépendent du paramètre de protection de l’élément &lt;Forms&gt;.</span><span class="sxs-lookup"><span data-stu-id="a489c-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="a489c-303">Le paramètre de protection peut être affecté à l’une des trois valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="a489c-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="a489c-304">Tout : le ticket est à la fois chiffré et signé numériquement (valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="a489c-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="a489c-305">Le chiffrement avec chiffrement uniquement est appliqué-aucun MAC n’est généré.</span><span class="sxs-lookup"><span data-stu-id="a489c-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="a489c-306">Aucun : le ticket n’est ni chiffré ni signé numériquement.</span><span class="sxs-lookup"><span data-stu-id="a489c-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="a489c-307">Validation : un MAC est généré, mais les données de ticket sont envoyées sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="a489c-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="a489c-308">Microsoft recommande vivement d’utiliser le paramètre All.</span><span class="sxs-lookup"><span data-stu-id="a489c-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="a489c-309">Définition des clés de validation et de déchiffrement</span><span class="sxs-lookup"><span data-stu-id="a489c-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="a489c-310">Les algorithmes de chiffrement et de hachage utilisés par le système d’authentification par formulaire pour chiffrer et valider le ticket d’authentification sont personnalisables via l' [&lt;machineKey&gt; élément](https://msdn.microsoft.com/library/w8h3skw9.aspx) dans Web. config. Le tableau 2 présente les attributs de l’élément &lt;machineKey&gt; et leurs valeurs possibles.</span><span class="sxs-lookup"><span data-stu-id="a489c-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="a489c-311">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="a489c-311">**Attribute**</span></span> | <span data-ttu-id="a489c-312">**Description**</span><span class="sxs-lookup"><span data-stu-id="a489c-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="a489c-313">déchiffrement</span><span class="sxs-lookup"><span data-stu-id="a489c-313">decryption</span></span> | <span data-ttu-id="a489c-314">Indique l’algorithme utilisé pour le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="a489c-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="a489c-315">Cet attribut peut avoir l’une des quatre valeurs suivantes :-auto-la valeur par défaut ; détermine l’algorithme en fonction de la longueur de l’attribut decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="a489c-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="a489c-316">-AES-utilise l’algorithme [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) .</span><span class="sxs-lookup"><span data-stu-id="a489c-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="a489c-317">-DES-utilise [Data Encryption Standard (des)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) . cet algorithme est considéré comme faible en termes de calcul et ne doit pas être utilisé.</span><span class="sxs-lookup"><span data-stu-id="a489c-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="a489c-318">-3DES-utilise l’algorithme [triple des](http://en.wikipedia.org/wiki/Triple_DES) , qui fonctionne en appliquant l’algorithme des trois fois.</span><span class="sxs-lookup"><span data-stu-id="a489c-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="a489c-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="a489c-319">decryptionKey</span></span> | <span data-ttu-id="a489c-320">Clé secrète utilisée par l’algorithme de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="a489c-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="a489c-321">Cette valeur doit être une chaîne hexadécimale de la longueur appropriée (basée sur la valeur dans le déchiffrement), une valeur AutoGenerate ou une valeur ajoutée à, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="a489c-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="a489c-322">L’ajout de IsolateApps demande à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="a489c-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="a489c-323">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="a489c-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="a489c-324">validation</span><span class="sxs-lookup"><span data-stu-id="a489c-324">validation</span></span> | <span data-ttu-id="a489c-325">Indique l’algorithme utilisé pour la validation.</span><span class="sxs-lookup"><span data-stu-id="a489c-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="a489c-326">Cet attribut peut avoir l’une des quatre valeurs suivantes :-AES-utilise l’algorithme Advanced Encryption Standard (AES).</span><span class="sxs-lookup"><span data-stu-id="a489c-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="a489c-327">-MD5-utilise l’algorithme [MD5 (Message-Digest 5)](http://en.wikipedia.org/wiki/MD5) .</span><span class="sxs-lookup"><span data-stu-id="a489c-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="a489c-328">-SHA1-utilise l’algorithme [SHA1](http://en.wikipedia.org/wiki/Sha1) (valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="a489c-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="a489c-329">-3DES-utilise l’algorithme Triple DES.</span><span class="sxs-lookup"><span data-stu-id="a489c-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="a489c-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="a489c-330">validationKey</span></span> | <span data-ttu-id="a489c-331">Clé secrète utilisée par l’algorithme de validation.</span><span class="sxs-lookup"><span data-stu-id="a489c-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="a489c-332">Cette valeur doit être une chaîne hexadécimale de la longueur appropriée (en fonction de la valeur de la validation), Generate ou une valeur ajoutée avec, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="a489c-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="a489c-333">L’ajout de IsolateApps demande à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="a489c-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="a489c-334">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="a489c-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="a489c-335">**Tableau 2**: attributs de l’élément &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="a489c-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="a489c-336">Une présentation détaillée de ces options de chiffrement et de validation, ainsi que des avantages et des inconvénients des différents algorithmes, dépasse le cadre de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="a489c-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="a489c-337">Pour une analyse approfondie de ces problèmes, notamment des conseils sur les algorithmes de chiffrement et de validation à utiliser, les longueurs de clé à utiliser et la meilleure façon de générer ces clés, reportez-vous à la rubrique *Professional ASP.NET 2,0 Security, Membership and Role Management*.</span><span class="sxs-lookup"><span data-stu-id="a489c-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="a489c-338">Par défaut, les clés utilisées pour le chiffrement et la validation sont générées automatiquement pour chaque application, et ces clés sont stockées dans l’autorité de sécurité locale (LSA).</span><span class="sxs-lookup"><span data-stu-id="a489c-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="a489c-339">En résumé, les paramètres par défaut garantissent des clés uniques sur un serveur Web par serveur Web et application par application.</span><span class="sxs-lookup"><span data-stu-id="a489c-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="a489c-340">Par conséquent, ce comportement par défaut ne fonctionne pas pour les deux scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="a489c-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="a489c-341">**Batteries** de serveurs Web : dans un scénario de batterie de serveurs [Web](http://en.wikipedia.org/wiki/Web_farm) , une application Web unique est hébergée sur plusieurs serveurs Web à des fins d’extensibilité et de redondance.</span><span class="sxs-lookup"><span data-stu-id="a489c-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="a489c-342">Chaque demande entrante est distribuée à un serveur de la batterie, ce qui signifie que, pendant la durée de vie de la session d’un utilisateur, des serveurs différents peuvent être utilisés pour gérer ses diverses demandes.</span><span class="sxs-lookup"><span data-stu-id="a489c-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="a489c-343">Par conséquent, chaque serveur doit utiliser les mêmes clés de chiffrement et de validation afin que le ticket d’authentification par formulaire créé, chiffré et validé sur un serveur puisse être déchiffré et validé sur un autre serveur de la batterie.</span><span class="sxs-lookup"><span data-stu-id="a489c-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="a489c-344">**Cross application ticket Sharing** : un serveur Web unique peut héberger plusieurs applications ASP.net.</span><span class="sxs-lookup"><span data-stu-id="a489c-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="a489c-345">Si vous avez besoin que ces différentes applications partagent un ticket d’authentification par formulaire unique, il est impératif que leurs clés de chiffrement et de validation correspondent.</span><span class="sxs-lookup"><span data-stu-id="a489c-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="a489c-346">Lorsque vous travaillez dans un paramètre de batterie de serveurs Web ou que vous partagez des tickets d’authentification entre des applications sur le même serveur, vous devez configurer l’élément &lt;machineKey&gt; dans les applications affectées afin que leurs valeurs decryptionKey et validationKey correspondent.</span><span class="sxs-lookup"><span data-stu-id="a489c-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="a489c-347">Si aucun des scénarios ci-dessus ne s’applique à notre exemple d’application, nous pouvons toujours spécifier des valeurs decryptionKey et validationKey explicites et définir les algorithmes à utiliser.</span><span class="sxs-lookup"><span data-stu-id="a489c-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="a489c-348">Ajoutez un paramètre &lt;machineKey&gt; au fichier Web. config :</span><span class="sxs-lookup"><span data-stu-id="a489c-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="a489c-349">Pour plus d’informations [, consultez Comment : configurer machineKey dans ASP.NET 2,0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="a489c-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-350">Les valeurs decryptionKey et validationKey proviennent de la [page Web des mots de passe parfait](https://www.grc.com/passwords.htm)de [Steve Gibson](http://www.grc.com/stevegibson.htm), qui génère 64 caractères hexadécimaux aléatoires à chaque visite de page.</span><span class="sxs-lookup"><span data-stu-id="a489c-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="a489c-351">Pour réduire la probabilité que ces clés se trouvent dans vos applications de production, il est recommandé de remplacer les clés ci-dessus par des clés générées de manière aléatoire à partir de la page des mots de passe idéaux.</span><span class="sxs-lookup"><span data-stu-id="a489c-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="a489c-352">Étape 4 : stockage des données utilisateur supplémentaires dans le ticket</span><span class="sxs-lookup"><span data-stu-id="a489c-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="a489c-353">De nombreuses applications Web affichent des informations sur l’utilisateur actuellement connecté ou sur la base de l’affichage de la page.</span><span class="sxs-lookup"><span data-stu-id="a489c-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="a489c-354">Par exemple, une page Web peut afficher le nom de l’utilisateur et la date de sa dernière connexion dans le coin supérieur de chaque page.</span><span class="sxs-lookup"><span data-stu-id="a489c-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="a489c-355">Le ticket d’authentification par formulaire stocke le nom d’utilisateur de l’utilisateur actuellement connecté, mais lorsqu’une autre information est nécessaire, la page doit accéder au magasin de l’utilisateur (généralement une base de données) pour rechercher les informations non stockées dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="a489c-356">Avec un peu de code, nous pouvons stocker des informations utilisateur supplémentaires dans le ticket d’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="a489c-357">Ces données peuvent être exprimées par le biais de la [propriété UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)de la [classe FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx).</span><span class="sxs-lookup"><span data-stu-id="a489c-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="a489c-358">Il s’agit d’un emplacement utile pour mettre de petites quantités d’informations sur l’utilisateur qui sont généralement nécessaires.</span><span class="sxs-lookup"><span data-stu-id="a489c-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="a489c-359">La valeur spécifiée dans la propriété UserData est incluse dans le cookie de ticket d’authentification et, comme les autres champs de ticket, est chiffrée et validée en fonction de la configuration du système d’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="a489c-360">Par défaut, UserData est une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="a489c-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="a489c-361">Pour stocker les données utilisateur dans le ticket d’authentification, nous devons écrire un peu de code dans la page de connexion qui récupère les informations spécifiques à l’utilisateur et les stocke dans le ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="a489c-362">Dans la mesure où UserData est une propriété de type chaîne, les données stockées dans celui-ci doivent être correctement sérialisées comme une chaîne.</span><span class="sxs-lookup"><span data-stu-id="a489c-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="a489c-363">Par exemple, imaginez que notre magasin d’utilisateurs incluait la date de naissance de chaque utilisateur et le nom de son employeur. nous voulons stocker ces deux valeurs de propriété dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="a489c-364">Nous pourrions sérialiser ces valeurs dans une chaîne en concaténant la date de la chaîne de naissance de l’utilisateur avec un canal (|), suivi du nom de l’employeur.</span><span class="sxs-lookup"><span data-stu-id="a489c-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="a489c-365">Pour un utilisateur né le 15 août 1974 qui travaille pour Northwind Traders, nous attribuons à la propriété UserData la valeur String : 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="a489c-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="a489c-366">Chaque fois que nous avons besoin d’accéder aux données stockées dans le ticket, nous pouvons le faire en saisissant le FormsAuthenticationTicket de la requête actuelle et en désérialisant la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="a489c-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="a489c-367">Dans le cas de la date de naissance et de l’exemple de nom de l’employeur, nous fractionnerons la chaîne UserData en deux sous-chaînes en fonction du délimiteur (|).</span><span class="sxs-lookup"><span data-stu-id="a489c-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="a489c-368">[![informations supplémentaires sur l’utilisateur peuvent être stockées dans le ticket d’authentification](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="a489c-369">**Figure 04**: les informations utilisateur supplémentaires peuvent être stockées dans le ticket d’authentification ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="a489c-370">Écriture d’informations dans UserData</span><span class="sxs-lookup"><span data-stu-id="a489c-370">Writing Information to UserData</span></span>

<span data-ttu-id="a489c-371">Malheureusement, l’ajout d’informations spécifiques à l’utilisateur dans un ticket d’authentification par formulaire n’est pas aussi simple que possible.</span><span class="sxs-lookup"><span data-stu-id="a489c-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="a489c-372">La propriété UserData de la classe FormsAuthenticationTicket est en lecture seule et ne peut être spécifiée que par le biais du constructeur de classe FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="a489c-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="a489c-373">Lorsque vous spécifiez la propriété UserData dans le constructeur, nous devons également fournir les autres valeurs du ticket : le nom d’utilisateur, la date d’émission, l’expiration, etc.</span><span class="sxs-lookup"><span data-stu-id="a489c-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="a489c-374">Lors de la création de la page de connexion dans le didacticiel précédent, cette dernière était gérée pour nous par la classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="a489c-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="a489c-375">Lorsque vous ajoutez des UserData à FormsAuthenticationTicket, nous devons écrire du code pour répliquer la plupart des fonctionnalités déjà fournies par la classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="a489c-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="a489c-376">Nous allons explorer le code nécessaire à l’utilisation de UserData en mettant à jour la page Login. aspx pour enregistrer des informations supplémentaires sur l’utilisateur dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="a489c-377">Supposons que notre magasin d’utilisateurs contient des informations sur la société pour laquelle l’utilisateur travaille et sur son titre, et que nous souhaitons capturer ces informations dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="a489c-378">Mettez à jour le gestionnaire d’événements LoginButton Click de la page Login. aspx afin que le code ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="a489c-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="a489c-379">Commençons par parcourir ce code une ligne à la fois.</span><span class="sxs-lookup"><span data-stu-id="a489c-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="a489c-380">La méthode commence par définir quatre tableaux de chaînes : utilisateurs, mots de passe, companyName et titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="a489c-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="a489c-381">Ces tableaux contiennent les noms d’utilisateur, mots de passe, noms de société et titres pour les comptes d’utilisateur du système, dont trois : Scott, Jisun et Sam.</span><span class="sxs-lookup"><span data-stu-id="a489c-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="a489c-382">Dans une application réelle, ces valeurs sont interrogées à partir du magasin de l’utilisateur, et ne sont pas codées en dur dans le code source de la page.</span><span class="sxs-lookup"><span data-stu-id="a489c-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="a489c-383">Dans le didacticiel précédent, si les informations d’identification fournies étaient valides, nous avons simplement appelé FormsAuthentication. RedirectFromLoginPage (UserName. Text, RememberMe. Checked), qui effectuait les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="a489c-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="a489c-384">Création du ticket d’authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="a489c-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="a489c-385">Écriture du ticket dans le magasin approprié.</span><span class="sxs-lookup"><span data-stu-id="a489c-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="a489c-386">Pour les tickets d’authentification basés sur les cookies, le regroupement cookies du navigateur est utilisé ; pour les tickets d’authentification sans cookies, les données de ticket sont sérialisées dans l’URL</span><span class="sxs-lookup"><span data-stu-id="a489c-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="a489c-387">Redirection de l’utilisateur vers la page appropriée</span><span class="sxs-lookup"><span data-stu-id="a489c-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="a489c-388">Ces étapes sont répliquées dans le code ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="a489c-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="a489c-389">Tout d’abord, la chaîne que nous allons finalement stocker dans la propriété UserData est formée en combinant le nom de la société et le titre, en séparant les deux valeurs par un caractère de barre verticale (|).</span><span class="sxs-lookup"><span data-stu-id="a489c-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="a489c-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="a489c-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="a489c-391">Ensuite, la méthode FormsAuthentication. GetAuthCookie est appelée, ce qui crée le ticket d’authentification, le chiffre et le valide en fonction des paramètres de configuration, puis le place dans un objet HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="a489c-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span><span class="sxs-lookup"><span data-stu-id="a489c-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="a489c-393">Pour pouvoir utiliser le FormAuthenticationTicket incorporé dans le cookie, nous devons appeler la [méthode Decrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)de la classe FormAuthentication, en passant la valeur de cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="a489c-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="a489c-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="a489c-395">Nous créons ensuite une *nouvelle* instance FormsAuthenticationTicket basée sur les valeurs de FormsAuthenticationTicket existantes.</span><span class="sxs-lookup"><span data-stu-id="a489c-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="a489c-396">Toutefois, ce nouveau ticket contient les informations spécifiques à l’utilisateur (userDataString).</span><span class="sxs-lookup"><span data-stu-id="a489c-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="a489c-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="a489c-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="a489c-398">Nous chiffreons ensuite (et validons) la nouvelle instance FormsAuthenticationTicket en appelant la [méthode Encrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)et replaçons ces données chiffrées (et validées) dans authCookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="a489c-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="a489c-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="a489c-400">Enfin, authCookie est ajouté à la collection Response. cookies et la méthode GetRedirectUrl est appelée pour déterminer la page appropriée à envoyer à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="a489c-401">Tout ce code est nécessaire, car la propriété UserData est en lecture seule et la classe FormsAuthentication ne fournit aucune méthode pour spécifier les informations UserData dans ses méthodes GetAuthCookie, SetAuthCookie ou RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="a489c-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-402">Le code que nous venons d’examiner stocke des informations spécifiques à l’utilisateur dans un ticket d’authentification basé sur des cookies.</span><span class="sxs-lookup"><span data-stu-id="a489c-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="a489c-403">Les classes chargées de sérialiser le ticket d’authentification par formulaire vers l’URL sont internes au .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a489c-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="a489c-404">Long Story Short, vous ne pouvez pas stocker de données utilisateur dans un ticket d’authentification par formulaire sans cookie.</span><span class="sxs-lookup"><span data-stu-id="a489c-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="a489c-405">Accès aux informations UserData</span><span class="sxs-lookup"><span data-stu-id="a489c-405">Accessing the UserData Information</span></span>

<span data-ttu-id="a489c-406">À ce stade, le nom et le titre de la société de chaque utilisateur sont stockés dans la propriété UserData du ticket d’authentification par formulaire lorsqu’ils se connectent.</span><span class="sxs-lookup"><span data-stu-id="a489c-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="a489c-407">Ces informations sont accessibles à partir du ticket d’authentification sur n’importe quelle page sans nécessiter de trajet vers le magasin de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="a489c-408">Pour illustrer la façon dont ces informations peuvent être récupérées à partir de la propriété UserData, nous allons mettre à jour default. aspx afin que son message d’accueil inclue non seulement le nom de l’utilisateur, mais également la société pour laquelle il travaille et son titre.</span><span class="sxs-lookup"><span data-stu-id="a489c-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="a489c-409">Actuellement, default. aspx contient un panneau AuthenticatedMessagePanel avec un contrôle Label nommé WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="a489c-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="a489c-410">Ce panneau s’affiche uniquement pour les utilisateurs authentifiés.</span><span class="sxs-lookup"><span data-stu-id="a489c-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="a489c-411">Mettez à jour le code dans la page default. aspx\_le gestionnaire d’événements Load afin qu’il se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="a489c-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="a489c-412">Si Request. IsAuthenticated a la valeur true, la propriété Text de WelcomeBackMessage est d’abord définie sur Welcome, *nom d’utilisateur*.</span><span class="sxs-lookup"><span data-stu-id="a489c-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="a489c-413">Ensuite, la propriété User. Identity est convertie en objet FormsIdentity afin que nous puissions accéder au FormsAuthenticationTicket sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="a489c-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="a489c-414">Une fois le FormsAuthenticationTicket, nous désérialiserons la propriété UserData dans le nom et le titre de la société.</span><span class="sxs-lookup"><span data-stu-id="a489c-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="a489c-415">Pour ce faire, fractionnez la chaîne sur le caractère de barre verticale.</span><span class="sxs-lookup"><span data-stu-id="a489c-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="a489c-416">Le nom et le titre de la société sont ensuite affichés dans l’étiquette WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="a489c-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="a489c-417">La figure 5 illustre une capture d’écran de cet affichage en action.</span><span class="sxs-lookup"><span data-stu-id="a489c-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="a489c-418">La connexion en tant que Scott affiche un message de bienvenue qui comprend la société et le titre de Scott.</span><span class="sxs-lookup"><span data-stu-id="a489c-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="a489c-419">[![la société et le titre de l’utilisateur actuellement connecté sont affichés](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="a489c-420">**Figure 05**: la société et le titre de l’utilisateur actuellement connecté sont affichés ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-421">La propriété UserData du ticket d’authentification sert de cache pour le magasin de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="a489c-422">Comme n’importe quel cache, il doit être mis à jour lors de la modification des données sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="a489c-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="a489c-423">Par exemple, s’il existe une page Web à partir de laquelle les utilisateurs peuvent mettre à jour leur profil, les champs mis en cache dans la propriété UserData doivent être actualisés pour refléter les modifications apportées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="a489c-424">Étape 5 : utilisation d’un principal personnalisé</span><span class="sxs-lookup"><span data-stu-id="a489c-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="a489c-425">À chaque demande entrante, FormsAuthenticationModule tente d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="a489c-426">Si un ticket d’authentification non expiré est présent, FormsAuthenticationModule affecte la propriété HttpContext. User à un nouvel objet GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="a489c-427">Cet objet GenericPrincipal a une identité de type FormsIdentity, qui inclut une référence au ticket d’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="a489c-428">La classe GenericPrincipal contient les fonctionnalités minimales requises par une classe qui implémente IPrincipal. elle a simplement une propriété Identity et une méthode IsInRole.</span><span class="sxs-lookup"><span data-stu-id="a489c-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="a489c-429">L’objet principal a deux responsabilités : pour indiquer les rôles auxquels l’utilisateur appartient et pour fournir des informations d’identité.</span><span class="sxs-lookup"><span data-stu-id="a489c-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="a489c-430">Cela s’effectue à l’aide de la méthode IsInRole (*roleName*) et de la propriété Identity de l’interface IPrincipal, respectivement.</span><span class="sxs-lookup"><span data-stu-id="a489c-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="a489c-431">La classe GenericPrincipal permet de spécifier un tableau de chaînes de noms de rôles à l’aide de son constructeur. sa méthode IsInRole (*roleName*) vérifie simplement si le *roleName* passé existe dans le tableau de chaînes.</span><span class="sxs-lookup"><span data-stu-id="a489c-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="a489c-432">Lorsque FormsAuthenticationModule crée le GenericPrincipal, il passe un tableau de chaînes vide au constructeur de GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="a489c-433">Par conséquent, tout appel à IsInRole retourne toujours la valeur false.</span><span class="sxs-lookup"><span data-stu-id="a489c-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="a489c-434">La classe GenericPrincipal répond aux besoins de la plupart des scénarios d’authentification basée sur les formulaires, où les rôles ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="a489c-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="a489c-435">Dans les cas où la gestion du rôle par défaut est insuffisante ou si vous devez associer un objet IIdentity personnalisé à l’utilisateur, vous pouvez créer un objet IPrincipal personnalisé pendant le flux de travail d’authentification et l’assigner à la propriété HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="a489c-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-436">Comme nous le verrons dans les prochains didacticiels, quand ASP. L’infrastructure des rôles du réseau est activée. elle crée un objet principal personnalisé de type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) et remplace l’objet GenericPrincipal créé par l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="a489c-437">Cela permet de personnaliser la méthode IsInRole du principal pour l’interface avec l’API Roles Framework.</span><span class="sxs-lookup"><span data-stu-id="a489c-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="a489c-438">Étant donné que nous ne nous sommes pas encore associés à des rôles, la seule raison pour laquelle nous aurions dû créer un principal personnalisé à ce moment serait d’associer un objet IIdentity personnalisé au principal.</span><span class="sxs-lookup"><span data-stu-id="a489c-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="a489c-439">À l’étape 4, nous avons examiné le stockage d’informations utilisateur supplémentaires dans la propriété UserData du ticket d’authentification, en particulier le nom de la société de l’utilisateur et son titre.</span><span class="sxs-lookup"><span data-stu-id="a489c-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="a489c-440">Toutefois, les informations UserData sont accessibles uniquement via le ticket d’authentification, puis comme chaîne sérialisée, ce qui signifie que chaque fois que nous souhaitons afficher les informations utilisateur stockées dans le ticket, nous devons analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="a489c-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="a489c-441">Nous pouvons améliorer l’expérience du développeur en créant une classe qui implémente IIdentity et qui comprend les propriétés CompanyName et title.</span><span class="sxs-lookup"><span data-stu-id="a489c-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="a489c-442">De cette façon, un développeur peut accéder au nom de société et au titre de l’utilisateur actuellement connecté directement par le biais des propriétés CompanyName et title, sans qu’il soit nécessaire de savoir comment analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="a489c-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="a489c-443">Création des classes d’identité et de principal personnalisées</span><span class="sxs-lookup"><span data-stu-id="a489c-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="a489c-444">Pour ce didacticiel, nous allons créer les objets principal et Identity personnalisés dans le dossier de code App\_.</span><span class="sxs-lookup"><span data-stu-id="a489c-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="a489c-445">Commencez par ajouter une application\_dossier de code à votre projet : cliquez avec le bouton droit sur le nom du projet dans Explorateur de solutions, sélectionnez l’option Ajouter le dossier ASP.NET, puis choisissez application\_code.</span><span class="sxs-lookup"><span data-stu-id="a489c-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="a489c-446">Le dossier App\_code est un dossier ASP.NET spécial qui contient des fichiers de classe spécifiques au site Web.</span><span class="sxs-lookup"><span data-stu-id="a489c-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="a489c-447">L’application\_dossier de code doit être utilisé uniquement lors de la gestion de votre projet via le modèle de projet de site Web.</span><span class="sxs-lookup"><span data-stu-id="a489c-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="a489c-448">Si vous utilisez le [modèle de projet d’application Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), créez un dossier standard et ajoutez-y les classes.</span><span class="sxs-lookup"><span data-stu-id="a489c-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="a489c-449">Par exemple, vous pouvez ajouter un nouveau dossier nommé classes et y placer votre code.</span><span class="sxs-lookup"><span data-stu-id="a489c-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="a489c-450">Ensuite, ajoutez deux nouveaux fichiers de classe au dossier App\_code, l’un nommé CustomIdentity.cs et l’autre nommé CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="a489c-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>

<span data-ttu-id="a489c-451">[![ajouter les classes CustomIdentity et CustomPrincipal à votre projet](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="a489c-452">**Figure 06**: ajouter les classes CustomIdentity et CustomPrincipal à votre projet ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>

<span data-ttu-id="a489c-453">La classe CustomIdentity est chargée d’implémenter l’interface IIdentity, qui définit les propriétés AuthenticationType, IsAuthenticated et Name.</span><span class="sxs-lookup"><span data-stu-id="a489c-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="a489c-454">En plus de ces propriétés requises, nous nous intéressons à exposer le ticket d’authentification des formulaires sous-jacent ainsi que les propriétés du nom et du titre de la société de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="a489c-455">Entrez le code suivant dans la classe CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="a489c-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="a489c-456">Notez que la classe comprend une variable membre FormsAuthenticationTicket (ticket\_) et que ces informations de ticket doivent être fournies par le biais du constructeur.</span><span class="sxs-lookup"><span data-stu-id="a489c-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="a489c-457">Ces données de ticket sont utilisées pour retourner le nom de l’identité ; sa propriété UserData est analysée pour retourner les valeurs des propriétés CompanyName et title.</span><span class="sxs-lookup"><span data-stu-id="a489c-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="a489c-458">Ensuite, créez la classe CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="a489c-459">Étant donné que nous n’avons pas besoin des rôles à ce moment, le constructeur de la classe CustomPrincipal accepte uniquement un objet CustomIdentity ; sa méthode IsInRole retourne toujours false.</span><span class="sxs-lookup"><span data-stu-id="a489c-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="a489c-460">Assignation d’un objet CustomPrincipal au contexte de sécurité de la requête entrante</span><span class="sxs-lookup"><span data-stu-id="a489c-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="a489c-461">Nous avons maintenant une classe qui étend la spécification IIdentity par défaut pour inclure les propriétés CompanyName et title, ainsi qu’une classe principal personnalisée qui utilise l’identité personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a489c-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="a489c-462">Nous sommes prêts à effectuer un pas à pas détaillé dans le pipeline ASP.NET et à affecter notre objet principal personnalisé au contexte de sécurité de la requête entrante.</span><span class="sxs-lookup"><span data-stu-id="a489c-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="a489c-463">Le pipeline ASP.NET prend une demande entrante et le traite à travers un certain nombre d’étapes.</span><span class="sxs-lookup"><span data-stu-id="a489c-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="a489c-464">À chaque étape, un événement particulier est déclenché, ce qui permet aux développeurs d’exploiter le pipeline ASP.NET et de modifier la demande à certains points de son cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="a489c-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="a489c-465">Le FormsAuthenticationModule, par exemple, attend que ASP.NET déclenche l' [événement AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx). à ce moment-là, il inspecte la demande entrante pour obtenir un ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a489c-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="a489c-466">Si un ticket d’authentification est trouvé, un objet GenericPrincipal est créé et affecté à la propriété HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="a489c-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="a489c-467">Après l’événement AuthenticateRequest, le pipeline ASP.NET déclenche l' [événement PostAuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), ce qui nous permet de remplacer l’objet GenericPrincipal créé par FormsAuthenticationModule par une instance de notre objet CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="a489c-468">La figure 7 illustre ce flux de travail.</span><span class="sxs-lookup"><span data-stu-id="a489c-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="a489c-469">[![le GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="a489c-470">**Figure 07**: le GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>

<span data-ttu-id="a489c-471">Pour exécuter du code en réponse à un événement de pipeline ASP.NET, nous pouvons soit créer le gestionnaire d’événements approprié dans global. asax, soit créer notre propre module HTTP.</span><span class="sxs-lookup"><span data-stu-id="a489c-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="a489c-472">Pour ce didacticiel, nous allons créer le gestionnaire d’événements dans global. asax.</span><span class="sxs-lookup"><span data-stu-id="a489c-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="a489c-473">Commencez par ajouter global. asax à votre site Web.</span><span class="sxs-lookup"><span data-stu-id="a489c-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="a489c-474">Dans Explorateur de solutions, cliquez avec le bouton droit sur le nom du projet, puis ajoutez un élément de type classe d’application globale nommé global. asax.</span><span class="sxs-lookup"><span data-stu-id="a489c-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="a489c-475">[![ajouter un fichier global. asax à votre site Web](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="a489c-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="a489c-476">**Figure 08**: ajouter un fichier global. asax à votre site Web ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="a489c-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>

<span data-ttu-id="a489c-477">Le modèle global. asax par défaut inclut des gestionnaires d’événements pour un certain nombre d’événements de pipeline ASP.NET, y compris l’événement de début, de fin et d' [erreur](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), entre autres.</span><span class="sxs-lookup"><span data-stu-id="a489c-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="a489c-478">N’hésitez pas à supprimer ces gestionnaires d’événements, car nous n’en avons pas besoin pour cette application.</span><span class="sxs-lookup"><span data-stu-id="a489c-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="a489c-479">L’événement qui nous intéresse est PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="a489c-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="a489c-480">Mettez à jour votre fichier global. asax afin que son balisage ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="a489c-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="a489c-481">L’application\_méthode OnPostAuthenticateRequest s’exécute chaque fois que le runtime ASP.NET déclenche l’événement PostAuthenticateRequest, qui se produit une fois sur chaque demande de page entrante.</span><span class="sxs-lookup"><span data-stu-id="a489c-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="a489c-482">Le gestionnaire d’événements commence par vérifier si l’utilisateur est authentifié et a été authentifié par le biais de l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="a489c-483">Dans ce cas, un nouvel objet CustomIdentity est créé et reçoit le ticket d’authentification de la requête actuelle dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="a489c-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="a489c-484">À la suite de cela, un objet CustomPrincipal est créé et passé l’objet CustomIdentity juste créé dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="a489c-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="a489c-485">Enfin, le contexte de sécurité de la requête actuelle est assigné à l’objet CustomPrincipal nouvellement créé.</span><span class="sxs-lookup"><span data-stu-id="a489c-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="a489c-486">Notez que la dernière étape associant l’objet CustomPrincipal au contexte de sécurité de la requête affecte le principal à deux propriétés : HttpContext. User et thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="a489c-487">Ces deux attributions sont nécessaires en raison de la façon dont les contextes de sécurité sont gérés dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a489c-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="a489c-488">Le .NET Framework associe un contexte de sécurité à chaque thread en cours d’exécution. ces informations sont disponibles sous la forme d’un objet IPrincipal via la [propriété CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx)de l' [objet thread](https://msdn.microsoft.com/library/system.threading.thread.aspx).</span><span class="sxs-lookup"><span data-stu-id="a489c-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="a489c-489">Ce qui est confus, c’est que ASP.NET possède ses propres informations de contexte de sécurité (HttpContext. User).</span><span class="sxs-lookup"><span data-stu-id="a489c-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="a489c-490">Dans certains scénarios, la propriété Thread. CurrentPrincipal est examinée lors de la détermination du contexte de sécurité. dans d’autres scénarios, HttpContext. User est utilisé.</span><span class="sxs-lookup"><span data-stu-id="a489c-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="a489c-491">Par exemple, il existe des fonctionnalités de sécurité dans .NET qui permettent aux développeurs de déterminer de façon déclarative les utilisateurs ou les rôles qui peuvent instancier une classe ou appeler des méthodes spécifiques (consultez [Ajout de règles d’autorisation à des couches de données et métier à l’aide de PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="a489c-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="a489c-492">En coulisses, ces techniques déclaratives déterminent le contexte de sécurité via la propriété Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="a489c-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="a489c-493">Dans d’autres scénarios, la propriété HttpContext. User est utilisée.</span><span class="sxs-lookup"><span data-stu-id="a489c-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="a489c-494">Par exemple, dans le didacticiel précédent, nous avons utilisé cette propriété pour afficher le nom d’utilisateur de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="a489c-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="a489c-495">En clair, il est impératif que les informations de contexte de sécurité dans les propriétés thread. CurrentPrincipal et HttpContext. User correspondent.</span><span class="sxs-lookup"><span data-stu-id="a489c-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="a489c-496">Le runtime ASP.NET synchronise automatiquement ces valeurs de propriétés pour nous.</span><span class="sxs-lookup"><span data-stu-id="a489c-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="a489c-497">Toutefois, cette synchronisation se produit après l’événement AuthenticateRequest, mais *avant* l’événement PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="a489c-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="a489c-498">Par conséquent, lors de l’ajout d’un principal personnalisé dans l’événement PostAuthenticateRequest, nous devons être certain d’assigner manuellement le thread. CurrentPrincipal ou Else. CurrentPrincipal et HttpContext. User ne seront pas synchronisés. Pour une discussion plus détaillée sur ce problème, consultez [Context. User et thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) .</span><span class="sxs-lookup"><span data-stu-id="a489c-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="a489c-499">Accès aux propriétés CompanyName et title</span><span class="sxs-lookup"><span data-stu-id="a489c-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="a489c-500">Chaque fois qu’une demande arrive et est distribuée au moteur ASP.NET, l’application\_gestionnaire d’événements OnPostAuthenticateRequest dans global. asax se déclenche.</span><span class="sxs-lookup"><span data-stu-id="a489c-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="a489c-501">Si la demande a été correctement authentifiée par FormsAuthenticationModule, le gestionnaire d’événements crée un nouvel objet CustomPrincipal avec un objet CustomIdentity basé sur le ticket d’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="a489c-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="a489c-502">Avec cette logique en place, l’accès aux informations sur le nom et le titre de la société de l’utilisateur actuellement connecté est incroyablement simple.</span><span class="sxs-lookup"><span data-stu-id="a489c-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="a489c-503">Revenez à la page\_chargement du gestionnaire d’événements dans default. aspx, où, à l’étape 4, nous avons écrit du code pour récupérer le ticket d’authentification par formulaire et analysé la propriété UserData afin d’afficher le nom et le titre de la société de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a489c-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="a489c-504">Avec les objets CustomPrincipal et CustomIdentity en cours d’utilisation, il n’est pas nécessaire d’analyser les valeurs en dehors de la propriété UserData du ticket.</span><span class="sxs-lookup"><span data-stu-id="a489c-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="a489c-505">Au lieu de cela, il vous suffit d’obtenir une référence à l’objet CustomIdentity et d’utiliser ses propriétés CompanyName et title :</span><span class="sxs-lookup"><span data-stu-id="a489c-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="a489c-506">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="a489c-506">Summary</span></span>

<span data-ttu-id="a489c-507">Dans ce didacticiel, nous avons examiné comment personnaliser les paramètres du système d’authentification par formulaire par le biais de Web. config. Nous avons examiné comment l’expiration du ticket d’authentification est gérée et comment les protections de chiffrement et de validation sont utilisées pour protéger le ticket de l’inspection et de la modification.</span><span class="sxs-lookup"><span data-stu-id="a489c-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="a489c-508">Enfin, nous avons abordé l’utilisation de la propriété UserData du ticket d’authentification pour stocker des informations utilisateur supplémentaires dans le ticket proprement dit, et comment utiliser des objets principal et Identity personnalisés pour exposer ces informations de manière plus conviviale pour les développeurs.</span><span class="sxs-lookup"><span data-stu-id="a489c-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="a489c-509">Ce didacticiel conclut notre examen de l’authentification par formulaire dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a489c-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="a489c-510">Le didacticiel suivant commence notre parcours de l’infrastructure d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="a489c-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="a489c-511">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="a489c-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="a489c-512">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="a489c-512">Further Reading</span></span>

<span data-ttu-id="a489c-513">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="a489c-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a489c-514">Discroisement de l’authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="a489c-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="a489c-515">Explication : authentification par formulaire dans ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="a489c-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="a489c-516">Comment : protéger l’authentification par formulaire dans ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="a489c-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="a489c-517">[Gestion de la sécurité, de l’appartenance et des rôles de ASP.net Professional 2,0](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN : 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="a489c-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="a489c-518">Sécurisation des contrôles de connexion</span><span class="sxs-lookup"><span data-stu-id="a489c-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="a489c-519">Élément&gt; de l’authentification &lt;</span><span class="sxs-lookup"><span data-stu-id="a489c-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="a489c-520">L’élément &lt;Forms&gt; pour l’authentification &lt;&gt;</span><span class="sxs-lookup"><span data-stu-id="a489c-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="a489c-521">Élément &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="a489c-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="a489c-522">Comprendre le ticket d’authentification par formulaire et le cookie</span><span class="sxs-lookup"><span data-stu-id="a489c-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="a489c-523">Formation vidéo sur les rubriques contenues dans ce didacticiel</span><span class="sxs-lookup"><span data-stu-id="a489c-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="a489c-524">Comment modifier les propriétés d’authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="a489c-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="a489c-525">Comment configurer et utiliser l’authentification sans cookie dans une application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="a489c-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="a489c-526">Réadressage de connexion par formulaires ASP</span><span class="sxs-lookup"><span data-stu-id="a489c-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="a489c-527">Configuration de clé personnalisée de la connexion par formulaires</span><span class="sxs-lookup"><span data-stu-id="a489c-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="a489c-528">Ajouter des données personnalisées à la méthode d’authentification</span><span class="sxs-lookup"><span data-stu-id="a489c-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="a489c-529">Utiliser des objets de principal personnalisés</span><span class="sxs-lookup"><span data-stu-id="a489c-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="a489c-530">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="a489c-530">About the Author</span></span>

<span data-ttu-id="a489c-531">Scott Mitchell, auteur de plusieurs ouvrages ASP/ASP. NET et fondateur de 4GuysFromRolla.com, travaille avec les technologies Web de Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="a489c-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a489c-532">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="a489c-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a489c-533">Son dernier livre est *[Sams vous apprend vous-même ASP.NET 2,0 en 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="a489c-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="a489c-534">Scott peut être contacté au [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) ou via son blog à l’adresse [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="a489c-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="a489c-535">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="a489c-535">Special Thanks To</span></span>

<span data-ttu-id="a489c-536">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="a489c-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a489c-537">Le réviseur de leads pour ce didacticiel était Alicja maziarz.</span><span class="sxs-lookup"><span data-stu-id="a489c-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="a489c-538">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="a489c-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a489c-539">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="a489c-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a489c-540">[Précédent](an-overview-of-forms-authentication-cs.md)
> [Suivant](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a489c-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
