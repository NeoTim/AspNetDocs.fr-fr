---
uid: web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-vb
title: Utilisation de CascadingDropDown avec une base de données (VB) | Microsoft Docs
author: wenz
description: Le contrôle CascadingDropDown dans AJAX Control Toolkit étend un contrôle DropDownList afin que les modifications dans un DropDownList charges associés à des valeurs dans anoth...
ms.author: riande
ms.date: 06/02/2008
ms.assetid: 97a3d33c-c856-43f3-8acb-f1ccbc48221a
msc.legacyurl: /web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-vb
msc.type: authoredcontent
ms.openlocfilehash: 98e07764a3bd6afc8045221e9c016e57be44f5f7
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57041876"
---
<a name="using-cascadingdropdown-with-a-database-vb"></a><span data-ttu-id="6a1f9-103">Utilisation de CascadingDropDown avec une base de données (VB)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-103">Using CascadingDropDown with a Database (VB)</span></span>
====================
<span data-ttu-id="6a1f9-104">par [Christian Wenz](https://github.com/wenz)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-104">by [Christian Wenz](https://github.com/wenz)</span></span>

<span data-ttu-id="6a1f9-105">[Télécharger le Code](http://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.vb.zip) ou [télécharger le PDF](http://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1VB.pdf)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-105">[Download Code](http://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.vb.zip) or [Download PDF](http://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1VB.pdf)</span></span>

> <span data-ttu-id="6a1f9-106">Le contrôle CascadingDropDown dans AJAX Control Toolkit étend un contrôle DropDownList afin que les modifications dans un DropDownList charges associés à des valeurs dans un autre objet DropDownList.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-106">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="6a1f9-107">Pour que cela fonctionne, un service web spéciale doit être créé.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-107">In order for this to work, a special web service must be created.</span></span>


## <a name="overview"></a><span data-ttu-id="6a1f9-108">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="6a1f9-108">Overview</span></span>

<span data-ttu-id="6a1f9-109">Le contrôle CascadingDropDown dans AJAX Control Toolkit étend un contrôle DropDownList afin que les modifications dans un DropDownList charges associés à des valeurs dans un autre objet DropDownList.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-109">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="6a1f9-110">(Par exemple, une liste fournit une liste des États, et la liste suivante est ensuite remplie de grandes villes dans cet état.) Pour que cela fonctionne, un service web spéciale doit être créé.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-110">(For instance, one list provides a list of US states, and the next list is then filled with major cities in that state.) In order for this to work, a special web service must be created.</span></span>

## <a name="steps"></a><span data-ttu-id="6a1f9-111">Étapes</span><span class="sxs-lookup"><span data-stu-id="6a1f9-111">Steps</span></span>

<span data-ttu-id="6a1f9-112">Tout d’abord une source de données est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-112">First of all, a data source is required.</span></span> <span data-ttu-id="6a1f9-113">Cet exemple utilise la base de données AdventureWorks et Microsoft SQL Server 2005 Express Edition.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-113">This sample uses the AdventureWorks database and the Microsoft SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="6a1f9-114">La base de données est une partie facultative d’une installation de Visual Studio (y compris l’édition expresse) et est également disponible en téléchargement séparé sous [ https://go.microsoft.com/fwlink/?LinkId=64064 ](https://go.microsoft.com/fwlink/?LinkId=64064).</span><span class="sxs-lookup"><span data-stu-id="6a1f9-114">The database is an optional part of a Visual Studio installation (including express edition) and is also available as a separate download under [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span></span> <span data-ttu-id="6a1f9-115">La base de données AdventureWorks fait partie des exemples SQL Server 2005 et exemples de bases de données (téléchargement à l’adresse [ https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp; DisplayLang = fr](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span><span class="sxs-lookup"><span data-stu-id="6a1f9-115">The AdventureWorks database is part of the SQL Server 2005 Samples and Sample Databases (download at [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span></span> <span data-ttu-id="6a1f9-116">Pour configurer la base de données le plus simple consiste à utiliser le Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp; DisplayLang = fr](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) et attacher le `AdventureWorks.mdf` fichier de base de données.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-116">The easiest way to set the database up is to use the Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) and attach the `AdventureWorks.mdf` database file.</span></span>

<span data-ttu-id="6a1f9-117">Pour cet exemple, nous partons du principe que l’instance de SQL Server 2005 Express Edition est appelée `SQLEXPRESS` et se trouve sur le même ordinateur que le serveur web ; il s’agit également de la configuration par défaut.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-117">For this sample, we assume that the instance of the SQL Server 2005 Express Edition is called `SQLEXPRESS` and resides on the same machine as the web server; this is also the default setup.</span></span> <span data-ttu-id="6a1f9-118">Si votre programme d’installation est différente, vous devez adapter les informations de connexion pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-118">If your setup differs, you have to adapt the connection information for the database.</span></span>

<span data-ttu-id="6a1f9-119">Pour activer la fonctionnalité d’ASP.NET AJAX et les outils de contrôle, le `ScriptManager` contrôle doit être placé n’importe où sur la page (mais dans le &lt; `form` &gt; élément) :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-119">In order to activate the functionality of ASP.NET AJAX and the Control Toolkit, the `ScriptManager` control must be put anywhere on the page (but within the &lt;`form`&gt; element):</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-vb/samples/sample1.aspx)]

<span data-ttu-id="6a1f9-120">Dans l’étape suivante, deux contrôles DropDownList sont nécessaires.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-120">In the next step, two DropDownList controls are required.</span></span> <span data-ttu-id="6a1f9-121">Dans cet exemple, nous utilisons les informations de contact et le fournisseur d’AdventureWorks, par conséquent, nous créons une liste pour les fournisseurs disponibles et l’autre pour les contacts disponibles :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-121">In this sample, we use the vendor and contact information from AdventureWorks, thus we create one list for the available vendors and one for the available contacts:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-vb/samples/sample2.aspx)]

<span data-ttu-id="6a1f9-122">Ensuite, deux CascadingDropDown extendeurs doivent être ajoutés à la page.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-122">Then, two CascadingDropDown extenders must be added to the page.</span></span> <span data-ttu-id="6a1f9-123">Un remplit la première liste (fournisseurs), et le remplit la deuxième liste (contacts).</span><span class="sxs-lookup"><span data-stu-id="6a1f9-123">One fills the first (vendors) list, and the other one fills the second (contacts) list.</span></span> <span data-ttu-id="6a1f9-124">Les attributs suivants doivent être définis :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-124">The following attributes must be set:</span></span>

- <span data-ttu-id="6a1f9-125">`ServicePath`: URL d’un service web fournissant les entrées de liste</span><span class="sxs-lookup"><span data-stu-id="6a1f9-125">`ServicePath`: URL of a web service delivering the list entries</span></span>
- <span data-ttu-id="6a1f9-126">`ServiceMethod`: Méthode Web fournir les entrées de liste</span><span class="sxs-lookup"><span data-stu-id="6a1f9-126">`ServiceMethod`: Web method delivering the list entries</span></span>
- <span data-ttu-id="6a1f9-127">`TargetControlID`: ID de la liste déroulante</span><span class="sxs-lookup"><span data-stu-id="6a1f9-127">`TargetControlID`: ID of the dropdown list</span></span>
- <span data-ttu-id="6a1f9-128">`Category`: Informations de catégorie sont soumises à la méthode web lorsqu’elle est appelée</span><span class="sxs-lookup"><span data-stu-id="6a1f9-128">`Category`: Category information that is submitted to the web method when called</span></span>
- <span data-ttu-id="6a1f9-129">`PromptText`: Texte affiché lorsque le chargement asynchrone des données de liste à partir du serveur</span><span class="sxs-lookup"><span data-stu-id="6a1f9-129">`PromptText`: Text displayed when asynchronously loading list data from the server</span></span>
- <span data-ttu-id="6a1f9-130">`ParentControlID`: (facultatif) parent liste déroulante que le chargement de déclencheurs de la liste actuelle</span><span class="sxs-lookup"><span data-stu-id="6a1f9-130">`ParentControlID`: (optional) parent dropdown list that triggers loading of the current list</span></span>

<span data-ttu-id="6a1f9-131">Selon le langage de programmation utilisé, le nom du service web en question change, mais toutes les autres valeurs d’attribut sont les mêmes.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-131">Depending on the programming language used, the name of the web service in question changes, but all other attribute values are the same.</span></span> <span data-ttu-id="6a1f9-132">Voici l’élément CascadingDropDown pour la première liste déroulante :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-132">Here is the CascadingDropDown element for the first dropdown list:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-vb/samples/sample3.aspx)]

<span data-ttu-id="6a1f9-133">Les extendeurs de contrôle pour la deuxième liste doivent définir le `ParentControlID` attribut afin que la sélection d’une entrée dans les déclencheurs de liste de fournisseurs du chargement des éléments dans la liste de contacts associés.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-133">The control extenders for the second list need to set the `ParentControlID` attribute so that selecting an entry in the vendors list triggers loading associated elements in the contacts list.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-vb/samples/sample4.aspx)]

<span data-ttu-id="6a1f9-134">Le travail proprement dit est ensuite établie dans le service web, qui est configuré comme suit.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-134">The actual work is then done in the web service, which is set up as follows.</span></span> <span data-ttu-id="6a1f9-135">Notez que le `[ScriptService]` attribut est utilisé, sinon ASP.NET AJAX ne peut pas créer le proxy JavaScript pour accéder aux méthodes web à partir du code de script côté client.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-135">Note that the `[ScriptService]` attribute is used, otherwise ASP.NET AJAX cannot create the JavaScript proxy to access the web methods from client-side script code.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-vb/samples/sample5.aspx)]

<span data-ttu-id="6a1f9-136">La signature des méthodes web appelées par CascadingDropDown est comme suit :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-136">The signature of the web methods called by CascadingDropDown is as follows:</span></span>

[!code-vb[Main](using-cascadingdropdown-with-a-database-vb/samples/sample6.vb)]

<span data-ttu-id="6a1f9-137">La valeur de retour doit donc être un tableau de type `CascadingDropDownNameValue` qui est défini par les outils de contrôle.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-137">So the return value must be an array of type `CascadingDropDownNameValue` which is defined by the Control Toolkit.</span></span> <span data-ttu-id="6a1f9-138">Le `GetVendors()` méthode est très facile à implémenter : Le code se connecte à la base de données AdventureWorks et interroge les 25 premiers fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-138">The `GetVendors()` method is quite easy to implement: The code connects to the AdventureWorks database and queries the first 25 vendors.</span></span> <span data-ttu-id="6a1f9-139">Le premier paramètre dans le `CascadingDropDownNameValue` constructeur est la légende de l’entrée de liste, la deuxième identité sa valeur (attribut de valeur dans du HTML &lt; `option` &gt; élément).</span><span class="sxs-lookup"><span data-stu-id="6a1f9-139">The first parameter in the `CascadingDropDownNameValue` constructor is the caption of the list entry, the second one its value (value attribute in HTML's &lt;`option`&gt; element).</span></span> <span data-ttu-id="6a1f9-140">Voici le code :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-140">Here is the code:</span></span>

[!code-vb[Main](using-cascadingdropdown-with-a-database-vb/samples/sample7.vb)]

<span data-ttu-id="6a1f9-141">Obtenir les contacts associés pour un fournisseur (nom de la méthode : `GetContactsForVendor()`) est un peu plus compliqué.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-141">Getting the associated contacts for a vendor (method name: `GetContactsForVendor()`) is a bit trickier.</span></span> <span data-ttu-id="6a1f9-142">Tout d’abord le fournisseur qui a été sélectionné dans la première liste déroulante doit être déterminé.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-142">First of all, the vendor which has been selected in the first dropdown list must be determined.</span></span> <span data-ttu-id="6a1f9-143">Les outils de contrôle définit une méthode d’assistance pour cette tâche : Le `ParseKnownCategoryValuesString()` méthode retourne un `StringDictionary` élément avec les données de liste déroulante :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-143">The Control Toolkit defines a helper method for that task: The `ParseKnownCategoryValuesString()` method returns a `StringDictionary` element with the dropdown data:</span></span>

[!code-vb[Main](using-cascadingdropdown-with-a-database-vb/samples/sample8.vb)]

<span data-ttu-id="6a1f9-144">Pour des raisons de sécurité, ces données doivent être validées tout d’abord.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-144">For security reasons, this data must be validated first.</span></span> <span data-ttu-id="6a1f9-145">Par conséquent, si une entrée de fournisseur (étant donné que le `Category` a la valeur de propriété du premier élément CascadingDropDown `"Vendor"`), l’ID du fournisseur sélectionné peut être récupéré :</span><span class="sxs-lookup"><span data-stu-id="6a1f9-145">So if there is a Vendor entry (because the `Category` property of the first CascadingDropDown element is set to `"Vendor"`), the ID of the selected vendor may be retrieved:</span></span>

[!code-vb[Main](using-cascadingdropdown-with-a-database-vb/samples/sample9.vb)]

<span data-ttu-id="6a1f9-146">Le reste de la méthode est relativement simple, puis.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-146">The rest of the method is fairly straight-forward, then.</span></span> <span data-ttu-id="6a1f9-147">CODE du fournisseur est utilisé en tant que paramètre pour une requête SQL qui Récupère tous les contacts associés pour ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-147">The vendor's ID is used as a parameter for an SQL query that retrieves all associated contacts for that vendor.</span></span> <span data-ttu-id="6a1f9-148">Une fois encore, la méthode retourne un tableau de type `CascadingDropDownNameValue`.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-148">Once again, the method returns an array of type `CascadingDropDownNameValue`.</span></span>

[!code-vb[Main](using-cascadingdropdown-with-a-database-vb/samples/sample10.vb)]

<span data-ttu-id="6a1f9-149">Chargement de la page ASP.NET, et après quelques instants, la liste des fournisseurs est remplie avec les entrées de 25.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-149">Load the ASP.NET page, and after a short while the vendor list is filled with 25 entries.</span></span> <span data-ttu-id="6a1f9-150">Choisir une seule entrée et notez la façon dont la deuxième liste déroulante est remplie avec des données.</span><span class="sxs-lookup"><span data-stu-id="6a1f9-150">Pick one entry and notice how the second dropdown list is filled with data.</span></span>


<span data-ttu-id="6a1f9-151">[![La première liste est automatiquement](using-cascadingdropdown-with-a-database-vb/_static/image2.png)](using-cascadingdropdown-with-a-database-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-151">[![The first list is filled automatically](using-cascadingdropdown-with-a-database-vb/_static/image2.png)](using-cascadingdropdown-with-a-database-vb/_static/image1.png)</span></span>

<span data-ttu-id="6a1f9-152">La première liste est automatiquement ([cliquez pour afficher l’image en taille réelle](using-cascadingdropdown-with-a-database-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="6a1f9-152">The first list is filled automatically ([Click to view full-size image](using-cascadingdropdown-with-a-database-vb/_static/image3.png))</span></span>


<span data-ttu-id="6a1f9-153">[![La deuxième liste est remplie selon votre sélection dans la première liste](using-cascadingdropdown-with-a-database-vb/_static/image5.png)](using-cascadingdropdown-with-a-database-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-153">[![The second list is filled according to the selection in the first list](using-cascadingdropdown-with-a-database-vb/_static/image5.png)](using-cascadingdropdown-with-a-database-vb/_static/image4.png)</span></span>

<span data-ttu-id="6a1f9-154">La deuxième liste est remplie selon votre sélection dans la première liste ([cliquez pour afficher l’image en taille réelle](using-cascadingdropdown-with-a-database-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6a1f9-154">The second list is filled according to the selection in the first list ([Click to view full-size image](using-cascadingdropdown-with-a-database-vb/_static/image6.png))</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6a1f9-155">[Précédent](filling-a-list-using-cascadingdropdown-vb.md)
> [Suivant](presetting-list-entries-with-cascadingdropdown-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6a1f9-155">[Previous](filling-a-list-using-cascadingdropdown-vb.md)
[Next](presetting-list-entries-with-cascadingdropdown-vb.md)</span></span>
