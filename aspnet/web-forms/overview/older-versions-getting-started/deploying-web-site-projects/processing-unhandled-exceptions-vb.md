---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
title: Traitement des Exceptions non gérées (VB) | Microsoft Docs
author: rick-anderson
description: Lorsqu’une erreur d’exécution se produit sur une application web en production, il est important pour avertir un développeur et d’enregistrer l’erreur afin qu’il peut être diagnostiqué en a la...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 051296f0-9519-4e78-835c-d868da13b0a0
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 1c28f520f710f77689548158e88d87d1051235d8
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65124235"
---
# <a name="processing-unhandled-exceptions-vb"></a><span data-ttu-id="7e2a8-103">Traitement des exceptions non gérées (VB)</span><span class="sxs-lookup"><span data-stu-id="7e2a8-103">Processing Unhandled Exceptions (VB)</span></span>

<span data-ttu-id="7e2a8-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7e2a8-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7e2a8-105">[Affichez ou téléchargez l’exemple de code](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([procédure de téléchargement](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="7e2a8-105">[View or download sample code](https://github.com/aspnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="7e2a8-106">Lorsqu’une erreur d’exécution se produit sur une application web en production, il est important pour avertir un développeur et d’enregistrer l’erreur afin qu’il peut être diagnostiqué à un moment ultérieur dans le temps.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="7e2a8-107">Ce didacticiel fournit une présentation de la façon dont ASP.NET traite les erreurs d’exécution et examine une façon d’exécuter un code personnalisé chaque fois qu’un bulles d’exception non gérée à l’exécution d’ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>

## <a name="introduction"></a><span data-ttu-id="7e2a8-108">Introduction</span><span class="sxs-lookup"><span data-stu-id="7e2a8-108">Introduction</span></span>

<span data-ttu-id="7e2a8-109">Lorsqu’une exception non gérée se produit dans une application ASP.NET, il se propage jusqu'à l’exécution d’ASP.NET, ce qui déclenche le `Error` événement et affiche la page d’erreur approprié.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="7e2a8-110">Il existe trois types de pages d’erreur : le Runtime erreur jaune écran de décès (YSOD) ; les détails d’Exception YSOD ; et les pages d’erreurs personnalisées.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="7e2a8-111">Dans le [didacticiel précédent](displaying-a-custom-error-page-vb.md) nous avons configuré l’application pour utiliser une page d’erreur personnalisée pour les utilisateurs distants et le YSOD de détails d’Exception pour les utilisateurs qui accèdent localement.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-111">In the [preceding tutorial](displaying-a-custom-error-page-vb.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="7e2a8-112">À l’aide d’une page d’erreur personnalisée conviviale qui correspond à l’apparence du site est préférée à la valeur par défaut YSOD d’erreur de Runtime, mais afficher une page d’erreur personnalisée n'est qu’une partie d’une solution de gestion d’erreur complexe.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="7e2a8-113">Lorsqu’une erreur se produit dans une application en production, il est important que les développeurs sont informés de l’erreur afin qu’ils peuvent pointe la cause de l’exception et les résoudre.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="7e2a8-114">En outre, les détails de l’erreur doivent être consignés afin que l’erreur peut être examinée et de diagnostiquer les problèmes plus tard dans le temps.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="7e2a8-115">Ce didacticiel montre comment accéder aux détails d’une exception non gérée afin qu’ils peuvent être enregistrés et un développeur averti.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="7e2a8-116">Les didacticiels de deux suivent explorent les bibliothèques de journalisation erreur qui, après un peu de configuration, avertir les développeurs d’erreurs d’exécution et consigner les détails de leurs automatiquement.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="7e2a8-117">Les informations examinées dans ce didacticiel sont particulièrement utiles si vous avez besoin traiter les exceptions non gérées d’une manière unique ou personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="7e2a8-118">Dans les cas où vous devez uniquement consigner l’exception et de notifier un développeur, à l’aide d’une bibliothèque de journalisation d’erreur est la meilleure option.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="7e2a8-119">Les deux didacticiels fournissent une vue d’ensemble de deux de ces bibliothèques.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-119">The next two tutorials provide an overview of two such libraries.</span></span>

## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="7e2a8-120">L’exécution de Code lorsque le`Error`événement est déclenché.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="7e2a8-121">Événements fournissent un mécanisme permettant de signaler que quelque chose d’intéressant s’est produite et pour un autre objet exécuter du code en réponse à un objet.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="7e2a8-122">En tant que développeur d’ASP.NET, vous êtes habitué à penser en termes d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="7e2a8-123">Si vous souhaitez exécuter du code lorsque le visiteur clique sur un bouton particulier, vous créez un gestionnaire d’événements de ce bouton `Click` événements et votre code il.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="7e2a8-124">Étant donné que le runtime ASP.NET déclenche son [ `Error` événement](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) chaque fois qu’une exception non gérée se produit, il s’ensuit que le code permettant d’enregistrer les détails de l’erreur se trouve dans un gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="7e2a8-125">Mais comment créer un gestionnaire d’événements pour le `Error` événement ?</span><span class="sxs-lookup"><span data-stu-id="7e2a8-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="7e2a8-126">Le `Error` événement est un des nombreux événements dans le [ `HttpApplication` classe](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) qui sont déclenchés à certaines étapes dans le pipeline HTTP pendant la durée de vie d’une demande.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="7e2a8-127">Par exemple, le `HttpApplication` la classe [ `BeginRequest` événement](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) est déclenché au début de chaque demande ; son [ `AuthenticateRequest` événement](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) est déclenché lorsqu’un module de sécurité a identifié le demandeur.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="7e2a8-128">Ces `HttpApplication` événements donnent le développeur de pages un moyen d’exécuter une logique personnalisée aux divers points dans la durée de vie d’une demande.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="7e2a8-129">Gestionnaires d’événements pour le `HttpApplication` événements peuvent être placés dans un fichier spécial nommé `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="7e2a8-130">Pour créer ce fichier dans votre site Web, ajoutez un nouvel élément à la racine de votre site Web à l’aide du modèle de classe d’Application globale portant le nom `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-vb/_static/image2.png)](processing-unhandled-exceptions-vb/_static/image1.png)

<span data-ttu-id="7e2a8-131">**Figure 1**: Ajouter `Global.asax` à votre Application Web</span><span class="sxs-lookup"><span data-stu-id="7e2a8-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
 <span data-ttu-id="7e2a8-132">([Cliquez pour afficher l’image en taille réelle](processing-unhandled-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7e2a8-132">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="7e2a8-133">Le contenu et la structure de la `Global.asax` fichier créé par Visual Studio varier légèrement en fonction de si vous utilisez un projet d’Application Web (WAP) ou d’un projet de Site Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="7e2a8-134">Avec un proxy d’application Web, le `Global.asax` est implémenté en tant que deux fichiers distincts - `Global.asax` et `Global.asax.vb`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.vb`.</span></span> <span data-ttu-id="7e2a8-135">Le `Global.asax` fichier ne contient rien mais un `@Application` directive qui référence le `.vb` fichier ; l’événement gestionnaires d’intérêt sont définis dans le `Global.asax.vb` fichier.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.vb` file; the event handlers of interest are defined in the `Global.asax.vb` file.</span></span> <span data-ttu-id="7e2a8-136">Pour wsp, qu’un seul fichier est créé, `Global.asax`, et les gestionnaires d’événements sont définis dans un `<script runat="server">` bloc.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="7e2a8-137">Le `Global.asax` fichier créé dans un proxy d’application Web par le modèle de classe d’Application globale de Visual Studio inclut des gestionnaires d’événements nommés `Application_BeginRequest`, `Application_AuthenticateRequest`, et `Application_Error`, qui sont des gestionnaires d’événements pour le `HttpApplication` événements `BeginRequest`, `AuthenticateRequest`, et `Error`, respectivement.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="7e2a8-138">Il existe également des gestionnaires d’événements nommés `Application_Start`, `Session_Start`, `Application_End`, et `Session_End`, qui sont des gestionnaires d’événements qui se déclenchent lorsque l’application web démarre, lorsque le démarrage d’une nouvelle session, lorsque l’application se termine, et quand une session se termine, respectivement.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="7e2a8-139">Le `Global.asax` fichier créé dans un fichier WSP par Visual Studio contient simplement le `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, et `Session_End` gestionnaires d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="7e2a8-140">Lors du déploiement de l’application ASP.NET vous devez copier le `Global.asax` fichier à l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="7e2a8-141">Le `Global.asax.vb` fichier, qui est créé dans le proxy d’application Web, n’a pas besoin être copiés vers la production, car ce code est compilé dans l’assembly du projet.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-141">The `Global.asax.vb` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>

<span data-ttu-id="7e2a8-142">Les gestionnaires d’événements créés par le modèle de classe d’Application globale de Visual Studio ne sont pas exhaustifs.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="7e2a8-143">Vous pouvez ajouter un gestionnaire d’événements pour les `HttpApplication` événement en nommant le Gestionnaire d’événements `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="7e2a8-144">Par exemple, vous pouvez ajouter le code suivant à la `Global.asax` fichier pour créer un gestionnaire d’événements pour le [ `AuthorizeRequest` événement](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="7e2a8-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample1.vb)]

<span data-ttu-id="7e2a8-145">De même, vous pouvez supprimer les gestionnaires d’événements créés par le modèle de classe d’Application globale qui ne sont pas nécessaires.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="7e2a8-146">Pour ce didacticiel, nous avons besoin uniquement un gestionnaire d’événements pour le `Error` événement ; vous pouvez supprimer les autres gestionnaires d’événements à partir de la `Global.asax` fichier.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="7e2a8-147">*Les Modules HTTP* offrent une autre manière de définir des gestionnaires d’événements pour `HttpApplication` événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="7e2a8-148">Les Modules HTTP sont créés en tant qu’un fichier de classe qui peut être placé directement dans le projet d’application web ou séparé et répartis dans une bibliothèque de classes distincte.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="7e2a8-149">Car ils peuvent être séparées dans une bibliothèque de classes, des Modules HTTP offrent un modèle plus flexible et réutilisable pour la création de `HttpApplication` gestionnaires d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="7e2a8-150">Tandis que le `Global.asax` fichier est spécifique à l’application web dans lequel il réside, les Modules HTTP peut être compilés dans des assemblys, à quel point l’ajout du HTTP Module à un site Web est aussi simple que la suppression de l’assembly le `Bin` dossier et l’enregistrement le Module dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="7e2a8-151">Ce didacticiel ne recherche pas dans la création et l’utilisation des Modules HTTP, mais les bibliothèques de journalisation des erreurs deux utilisées dans les deux didacticiels suivants sont implémentées sous forme de Modules HTTP.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="7e2a8-152">Pour plus d’informations sur les avantages de Modules HTTP, reportez-vous à [à l’aide des Modules HTTP et des gestionnaires pour créer des composants enfichables ASP.NET](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>

## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="7e2a8-153">Récupérer des informations sur l’Exception non gérée</span><span class="sxs-lookup"><span data-stu-id="7e2a8-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="7e2a8-154">À ce stade, nous avons un fichier Global.asax avec une `Application_Error` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="7e2a8-155">Lorsque ce gestionnaire d’événements s’exécute que nous devons informer un développeur de l’erreur et de consigner ses détails.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="7e2a8-156">Pour accomplir ces tâches, nous devons tout d’abord déterminer les détails de l’exception qui a été déclenché.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="7e2a8-157">Utilisez l’objet serveur [ `GetLastError` méthode](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) pour récupérer les détails de l’exception non gérée qui a provoqué le `Error` l’événement.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="7e2a8-158">Le `GetLastError` méthode retourne un objet de type `Exception`, qui est le type de base pour toutes les exceptions dans le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="7e2a8-159">Toutefois, dans le code ci-dessus je suis cast de l’objet Exception renvoyée par `GetLastError` dans un `HttpException` objet.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="7e2a8-160">Si le `Error` événement est déclenché, car une exception a été levée pendant le traitement d’une ressource ASP.NET, puis l’exception qui a été levée est encapsulée dans un `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="7e2a8-161">Pour obtenir l’exception réelle qui a activé l’utilisation d’événements erreur le `InnerException` propriété.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="7e2a8-162">Si le `Error` événement a été déclenché suite à une exception basée sur HTTP, telle qu’une demande pour une page inexistante, un `HttpException` est levée, mais il ne dispose pas d’une exception interne.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="7e2a8-163">Le code suivant utilise la `GetLastErrormessage` pour récupérer les informations relatives à l’exception qui a déclenché le `Error` événement, stocker le `HttpException` dans une variable nommée `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="7e2a8-164">Il stocke ensuite le type, le message et la trace de la pile de l’exception d’origine dans trois variables de chaîne, de vérifier si le `lastErrorWrapper` est l’exception réelle qui a déclenché le `Error` événement (dans le cas d’exceptions basé sur HTTP) ou si elle est simplement un wrapper pour une exception a été levée lors du traitement de la demande.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="7e2a8-165">À ce stade, vous avez toutes les informations que vous avez besoin d’écrire du code qui enregistre les détails de l’exception dans une table de base de données.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="7e2a8-166">Vous pouvez créer une table de base de données avec des colonnes pour chacune des détails de l’erreur d’intérêt - le type, le message, la trace de la pile et ainsi de suite - ainsi que d’autres informations utiles, telles que l’URL de la page demandée et le nom de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="7e2a8-167">Dans le `Application_Error` Gestionnaire d’événements vous ensuite se connecter à la base de données et insérer un enregistrement dans la table.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="7e2a8-168">De même, vous pouvez ajouter le code pour un développeur de l’erreur par courrier électronique d’alerte.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="7e2a8-169">Les bibliothèques de journalisation erreur examinés dans les deux didacticiels fournissent cette fonctionnalité dès le départ, il est donc pas nécessaire pour générer cette journalisation des erreurs et la notification vous-même.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="7e2a8-170">Toutefois, pour montrer que le `Error` événement est déclenché et que le `Application_Error` Gestionnaire d’événements peut être utilisé pour consigner les détails de l’erreur et notifier un développeur, nous allons ajouter du code qui notifie un développeur lorsqu’une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="7e2a8-171">Notifier un développeur lorsqu’une Exception non gérée se produit</span><span class="sxs-lookup"><span data-stu-id="7e2a8-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="7e2a8-172">Lorsqu’une exception non gérée se produit dans l’environnement de production, il est important alerter l’équipe de développement afin qu’ils peuvent évaluer l’erreur et déterminer les actions à entreprendre.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="7e2a8-173">Par exemple, s’il existe une erreur dans la connexion à la base de données, vous devez double Vérifiez votre chaîne de connexion et, par exemple, ouvrez un ticket de support avec votre entreprise d’hébergement web.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="7e2a8-174">Si l’exception s’est produite en raison d’une erreur de programmation, la logique de validation ou de code supplémentaire peut-être à ajouter à éviter ces erreurs à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="7e2a8-175">Les classes .NET Framework dans le [ `System.Net.Mail` espace de noms](https://msdn.microsoft.com/library/system.net.mail.aspx) rendent simple pour envoyer un courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="7e2a8-176">Le [ `MailMessage` classe](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) représente un message électronique et possède des propriétés comme `To`, `From`, `Subject`, `Body`, et `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="7e2a8-177">Le `SmtpClass` est utilisé pour envoyer un `MailMessage` à l’aide d’un serveur SMTP spécifié de l’objet ; les paramètres du serveur SMTP peuvent être spécifiées par programmation ou de façon déclarative dans le [ `<system.net>` élément](https://msdn.microsoft.com/library/6484zdc1.aspx) dans le `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="7e2a8-178">Pour plus d’informations sur l’envoi de courrier électronique des messages dans une application ASP.NET consultez mon article, [envoi de courrier électronique dans ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)et le [System.Net.Mail FAQ](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="7e2a8-179">Le `<system.net>` élément contient les paramètres du serveur SMTP utilisés par le `SmtpClient` classe lors de l’envoi d’un message électronique.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="7e2a8-180">Votre entreprise d’hébergement web a un serveur SMTP que vous pouvez utiliser pour envoyer un e-mail à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="7e2a8-181">Pour plus d’informations sur les paramètres du serveur SMTP que vous devez utiliser dans votre application web, consultez la section de prise en charge de votre hôte web.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>

<span data-ttu-id="7e2a8-182">Ajoutez le code suivant à la `Application_Error` Gestionnaire d’événements à envoyer un e-mail d’un développeur lorsqu’une erreur se produit :</span><span class="sxs-lookup"><span data-stu-id="7e2a8-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample4.vb)]

<span data-ttu-id="7e2a8-183">Alors que le code ci-dessus est assez long, la majeure partie de celui-ci crée le HTML qui s’affiche dans l’e-mail envoyé au développeur.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="7e2a8-184">Le code commence par référencer le `HttpException` retourné par la `GetLastError` (méthode) (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="7e2a8-185">L’exception réelle qui a été déclenchée par la demande est récupérée `lastErrorWrapper.InnerException` et est affectée à la variable `lastError`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="7e2a8-186">Le type, le message et la pile des informations de trace sont extraites de `lastError` et stockées dans trois variables de chaîne.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="7e2a8-187">Ensuite, un `MailMessage` objet nommé `mm` est créé.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="7e2a8-188">Le corps du message est au format HTML et affiche l’URL de la page demandée, le nom de l’utilisateur actuellement connecté et des informations sur l’exception (le type de message et trace de pile).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="7e2a8-189">Un des aspects plus intéressants du `HttpException` classe est que vous pouvez générer le code HTML utilisé pour créer l’Exception détails jaune écran de décès (YSOD) en appelant le [GetHtmlErrorMessage méthode](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="7e2a8-190">Cette méthode est utilisée ici pour récupérer le balisage YSOD de détails d’Exception et l’ajouter à l’adresse e-mail en pièce jointe.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="7e2a8-191">Un mot de prudence : si l’exception qui a déclenché le `Error` événement a été une exception basée sur HTTP (par exemple, une demande pour une page inexistante) puis le `GetHtmlErrorMessage` méthode retournera `null`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="7e2a8-192">L’étape finale consiste à envoyer le `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="7e2a8-193">Cela s’effectue en créant un nouveau `SmtpClient` (méthode) et en appelant son `Send` (méthode).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="7e2a8-194">Avant d’utiliser ce code dans votre application web, vous souhaiterez modifier les valeurs dans le `ToAddress` et `FromAddress` constantes de support@example.com à toute adresse e-mail adresse l’e-mail de notification d’erreur doivent être envoyées à et provenir.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="7e2a8-195">Vous devez également spécifier les paramètres du serveur SMTP dans le `<system.net>` section `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="7e2a8-196">Consultez votre fournisseur d’hébergement web pour déterminer les paramètres du serveur SMTP à utiliser.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>

<span data-ttu-id="7e2a8-197">Chaque fois qu’une erreur s’est le développeur est envoyé avec ce code en place un message électronique qui résume l’erreur et inclut le YSOD.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="7e2a8-198">Dans le didacticiel précédent, nous avons présenté une erreur d’exécution en visitant Genre.aspx et en transmettant un non valide `ID` valeur via la chaîne de requête, comme `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="7e2a8-199">Visiter la page avec le `Global.asax` fichier sur place génère la même expérience utilisateur, comme dans le didacticiel précédent - dans l’environnement de développement vous continuerez à voir l’Exception détails jaune écran de mort, tandis que dans l’environnement de production, vous allez consultez la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="7e2a8-200">En plus de ce comportement existant, le développeur reçoit un e-mail.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="7e2a8-201">**Figure 2** montrant l’e-mail reçu lors de la visite `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="7e2a8-202">Le corps du message résume les informations sur l’exception, tandis que le `YSOD.htm` pièce jointe affiche le contenu qui est indiqué dans le YSOD de détails d’Exception (consultez **Figure 3**).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image5.png)](processing-unhandled-exceptions-vb/_static/image4.png)

<span data-ttu-id="7e2a8-203">**Figure 2**: Le développeur est envoyé une Notification par E-mail chaque fois qu’une Exception non gérée</span><span class="sxs-lookup"><span data-stu-id="7e2a8-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
 <span data-ttu-id="7e2a8-204">([Cliquez pour afficher l’image en taille réelle](processing-unhandled-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7e2a8-204">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-vb/_static/image8.png)](processing-unhandled-exceptions-vb/_static/image7.png)

<span data-ttu-id="7e2a8-205">**Figure 3**: La Notification par courrier électronique inclut les détails d’Exception YSOD comme pièce jointe</span><span class="sxs-lookup"><span data-stu-id="7e2a8-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
 <span data-ttu-id="7e2a8-206">([Cliquez pour afficher l’image en taille réelle](processing-unhandled-exceptions-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7e2a8-206">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="7e2a8-207">Que se passe-t-il si nous utilisions la Page d’erreur personnalisée ?</span><span class="sxs-lookup"><span data-stu-id="7e2a8-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="7e2a8-208">Ce didacticiel vous a montré comment utiliser `Global.asax` et `Application_Error` Gestionnaire d’événements pour exécuter du code lorsqu’une exception non gérée se produit.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="7e2a8-209">Plus précisément, nous avons utilisé ce gestionnaire d’événements pour avertir un développeur d’une erreur ; Nous pourrions l’étendre pour également consigner les détails de l’erreur dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="7e2a8-210">La présence de la `Application_Error` Gestionnaire d’événements n’affecte pas l’expérience de l’utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="7e2a8-211">Ils voient toujours la page d’erreurs configuré, qu’il s’agisse de la YSOD détails de l’erreur, le YSOD d’erreur de Runtime ou la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="7e2a8-212">Il est normal de vous demander si le `Global.asax` fichier et `Application_Error` événement n’est nécessaire lors de l’utilisation d’une page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="7e2a8-213">Lorsqu’une erreur se produit à l’utilisateur voit la page d’erreur personnalisée, pourquoi ne pouvons pas nous en mettre le code pour informer le développeur et de consigner des détails de l’erreur dans la classe code-behind de la page d’erreur personnalisée ?</span><span class="sxs-lookup"><span data-stu-id="7e2a8-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="7e2a8-214">Bien que vous pouvez certainement ajouter du code à la classe de code-behind de la page d’erreur personnalisés vous n’avez pas d’accès aux détails de l’exception qui a déclenché le `Error` événement lors de l’utilisation de la technique que nous avons exploré dans le didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="7e2a8-215">Appel de la `GetLastError` méthode à partir de la page d’erreur personnalisée retourne `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="7e2a8-216">La raison de ce comportement est, car la page d’erreur personnalisée est atteinte via une redirection.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="7e2a8-217">Lorsqu’une exception non gérée atteint le runtime ASP.NET, le moteur ASP.NET déclenche son `Error` événement (qui exécute le `Application_Error` Gestionnaire d’événements), puis *redirige* l’utilisateur à la page d’erreur personnalisée en émettant un `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="7e2a8-218">Le `Response.Redirect` méthode envoie une réponse au client avec un code d’état HTTP 302 demandant le navigateur pour demander une nouvelle URL, à savoir la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="7e2a8-219">Le navigateur demande ensuite automatiquement cette nouvelle page.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="7e2a8-220">Vous pouvez indiquer que la page d’erreur personnalisée a été demandée séparément à partir de la page d’origine de l’erreur car les changements de la barre d’adresses du navigateur à l’URL de page d’erreur personnalisée (consultez **Figure 4**).</span><span class="sxs-lookup"><span data-stu-id="7e2a8-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image11.png)](processing-unhandled-exceptions-vb/_static/image10.png)

<span data-ttu-id="7e2a8-221">**Figure 4**: Lorsqu’une erreur se produit le navigateur est redirigé vers l’URL de Page d’erreur personnalisés</span><span class="sxs-lookup"><span data-stu-id="7e2a8-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
 <span data-ttu-id="7e2a8-222">([Cliquez pour afficher l’image en taille réelle](processing-unhandled-exceptions-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7e2a8-222">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image12.png))</span></span>

<span data-ttu-id="7e2a8-223">L’effet net est que la demande où l’exception non gérée s’est produite se termine lorsque le serveur répond avec la redirection HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="7e2a8-224">La demande suivante à la page d’erreur personnalisée est une toute nouvelle demande ; à ce stade ASP.NET moteur a rejeté les informations d’erreur et, en outre, n’a aucun moyen pour associer l’exception non gérée dans la demande précédente à la nouvelle demande de la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="7e2a8-225">C’est pourquoi `GetLastError` retourne `null` lorsqu’elle est appelée à partir de la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="7e2a8-226">Toutefois, il est possible que la page d’erreur personnalisée exécutée pendant la même requête qui a provoqué l’erreur.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="7e2a8-227">Le [ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) méthode transfère l’exécution à l’URL spécifiée et les traite dans la même demande.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="7e2a8-228">Vous pouvez déplacer le code le `Application_Error` Gestionnaire d’événements à la classe de code-behind de la page d’erreur personnalisée, en remplaçant dans `Global.asax` par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7e2a8-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="7e2a8-229">Quand une exception non gérée se produit désormais le `Application_Error` Gestionnaire d’événements transfère le contrôle à la page d’erreur personnalisée appropriée selon le code d’état HTTP.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="7e2a8-230">Étant donné que le contrôle a été transféré, la page d’erreur personnalisée a accès aux informations d’exception non gérée par le biais de `Server.GetLastError` peut notifier un développeur de l’erreur et consigner ses détails.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="7e2a8-231">Le `Server.Transfer` appel arrête le moteur ASP.NET à partir de la redirection de l’utilisateur vers la page d’erreur personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="7e2a8-232">Au lieu de cela, le contenu de la page d’erreur personnalisée est retourné en réponse à la page qui a généré l’erreur.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="7e2a8-233">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="7e2a8-233">Summary</span></span>

<span data-ttu-id="7e2a8-234">Lorsqu’une exception non gérée se produit dans une application web ASP.NET le runtime ASP.NET déclenche le `Error` événement et affiche la page d’erreurs configuré.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="7e2a8-235">Nous pouvons le développeur de l’erreur, consigner ses détails ou traiter dans une autre façon, en créant un gestionnaire d’événements pour l’événement d’erreur.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="7e2a8-236">Il existe deux façons de créer un gestionnaire d’événements `HttpApplication` événements, tels que `Error`: dans le `Global.asax` fichier ou à partir d’un HTTP Module.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="7e2a8-237">Ce didacticiel vous a montré comment créer un `Error` Gestionnaire d’événements dans le `Global.asax` fichier qui avertit les développeurs d’une erreur au moyen d’un message électronique.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="7e2a8-238">Création d’un `Error` Gestionnaire d’événements est utile si vous avez besoin traiter les exceptions non gérées d’une manière unique ou personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="7e2a8-239">Toutefois, créer votre propre `Error` Gestionnaire d’événements à consigner l’exception ou pour avertir un développeur n’est pas l’utilisation la plus efficace de votre temps, car il existe déjà des bibliothèques de journalisation erreur gratuit et facile à utiliser qui peuvent être configurées dans quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="7e2a8-240">Les deux didacticiels examiner deux de ces bibliothèques.</span><span class="sxs-lookup"><span data-stu-id="7e2a8-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="7e2a8-241">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="7e2a8-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="7e2a8-242">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="7e2a8-242">Further Reading</span></span>

<span data-ttu-id="7e2a8-243">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="7e2a8-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7e2a8-244">Vue d’ensemble des gestionnaires HTTP et de Modules HTTP ASP.NET</span><span class="sxs-lookup"><span data-stu-id="7e2a8-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="7e2a8-245">Répondre correctement aux Exceptions non gérées - traitement des Exceptions non gérées</span><span class="sxs-lookup"><span data-stu-id="7e2a8-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="7e2a8-246">`HttpApplication` Classe et l’objet d’Application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="7e2a8-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="7e2a8-247">Les gestionnaires HTTP et des Modules HTTP dans ASP.NET</span><span class="sxs-lookup"><span data-stu-id="7e2a8-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="7e2a8-248">Envoi d’E-mails dans ASP.NET</span><span class="sxs-lookup"><span data-stu-id="7e2a8-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="7e2a8-249">Comprendre les `Global.asax` fichier</span><span class="sxs-lookup"><span data-stu-id="7e2a8-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="7e2a8-250">À l’aide des Modules HTTP et des gestionnaires pour créer des composants enfichables ASP.NET</span><span class="sxs-lookup"><span data-stu-id="7e2a8-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="7e2a8-251">Utilisation de l’ASP.NET `Global.asax` fichier</span><span class="sxs-lookup"><span data-stu-id="7e2a8-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="7e2a8-252">Utilisation de `HttpApplication` Instances</span><span class="sxs-lookup"><span data-stu-id="7e2a8-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="7e2a8-253">[Précédent](displaying-a-custom-error-page-vb.md)
> [Suivant](logging-error-details-with-asp-net-health-monitoring-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7e2a8-253">[Previous](displaying-a-custom-error-page-vb.md)
[Next](logging-error-details-with-asp-net-health-monitoring-vb.md)</span></span>
