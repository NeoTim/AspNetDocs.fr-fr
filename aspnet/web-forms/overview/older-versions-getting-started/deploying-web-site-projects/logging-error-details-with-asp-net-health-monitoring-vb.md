---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
title: Journalisation des détails des erreurs avec ASP.NET Health Monitoring (VB) | Microsoft Docs
author: rick-anderson
description: Le système de contrôle d’intégrité de Microsoft offre un moyen facile et personnalisable d’enregistrer différents événements Web, y compris les exceptions non gérées. Ce didacticiel vous guide dans transmet...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 09a6c74e-936a-4c04-8547-5bb313a4e4a3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-vb
msc.type: authoredcontent
ms.openlocfilehash: f57aca41771adfd9a7c7f38da1916db9197262da
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74587829"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-vb"></a><span data-ttu-id="80e02-104">Journalisation des détails des erreurs avec la supervision de l’intégrité ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="80e02-104">Logging Error Details with ASP.NET Health Monitoring (VB)</span></span>

<span data-ttu-id="80e02-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="80e02-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="80e02-106">[Télécharger le code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip) ou [Télécharger le PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="80e02-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_VB.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_vb.pdf)</span></span>

> <span data-ttu-id="80e02-107">Le système de contrôle d’intégrité de Microsoft offre un moyen facile et personnalisable d’enregistrer différents événements Web, y compris les exceptions non gérées.</span><span class="sxs-lookup"><span data-stu-id="80e02-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="80e02-108">Ce didacticiel vous guide dans la configuration du système de contrôle d’intégrité pour enregistrer les exceptions non gérées dans une base de données et pour avertir les développeurs par le biais d’un message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>

## <a name="introduction"></a><span data-ttu-id="80e02-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="80e02-109">Introduction</span></span>

<span data-ttu-id="80e02-110">La journalisation est un outil utile pour surveiller l’intégrité d’une application déployée et pour diagnostiquer les problèmes qui peuvent survenir.</span><span class="sxs-lookup"><span data-stu-id="80e02-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="80e02-111">Il est particulièrement important de consigner les erreurs qui se produisent dans une application déployée afin qu’elles puissent être résolues.</span><span class="sxs-lookup"><span data-stu-id="80e02-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="80e02-112">L’événement `Error` est déclenché chaque fois qu’une exception non gérée se produit dans une application ASP.NET ; le [didacticiel précédent](processing-unhandled-exceptions-vb.md) a montré comment avertir un développeur d’une erreur et enregistrer ses détails en créant un gestionnaire d’événements pour l’événement `Error`.</span><span class="sxs-lookup"><span data-stu-id="80e02-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-vb.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="80e02-113">Toutefois, la création d’un gestionnaire d’événements `Error` pour consigner les détails de l’erreur et notifier un développeur n’est pas nécessaire, car cette tâche peut être effectuée par ASP. Système de *contrôle d’intégrité*du réseau.</span><span class="sxs-lookup"><span data-stu-id="80e02-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="80e02-114">Le système de contrôle d’intégrité a été introduit dans ASP.NET 2,0 et est conçu pour surveiller l’intégrité d’une application ASP.NET déployée en enregistrant les événements qui se produisent pendant la durée de vie de l’application ou de la demande.</span><span class="sxs-lookup"><span data-stu-id="80e02-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="80e02-115">Les événements consignés par le système de contrôle d’intégrité sont appelés *événements de contrôle d’intégrité* ou *événements Web*, et incluent les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="80e02-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="80e02-116">Événements de durée de vie de l’application, tels que le démarrage ou l’arrêt d’une application</span><span class="sxs-lookup"><span data-stu-id="80e02-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="80e02-117">Événements de sécurité, y compris les échecs de tentatives de connexion et les échecs de demandes d’autorisation d’URL</span><span class="sxs-lookup"><span data-stu-id="80e02-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="80e02-118">Erreurs d’application, y compris les exceptions non gérées, les exceptions d’analyse d’état d’affichage, les exceptions de validation de demande et les erreurs de compilation, parmi d’autres types d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="80e02-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="80e02-119">Lorsqu’un événement de contrôle d’intégrité est déclenché, il peut être enregistré dans n’importe quel nombre de *sources de journaux*spécifiées.</span><span class="sxs-lookup"><span data-stu-id="80e02-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="80e02-120">Le système de contrôle d’intégrité est fourni avec les sources de journaux qui journalisent les événements Web dans une base de données Microsoft SQL Server, dans le journal des événements Windows ou via un message électronique, entre autres.</span><span class="sxs-lookup"><span data-stu-id="80e02-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="80e02-121">Vous pouvez également créer vos propres sources de journaux.</span><span class="sxs-lookup"><span data-stu-id="80e02-121">You can also create your own log sources.</span></span>

<span data-ttu-id="80e02-122">Les événements journalisés par le système de surveillance de l’intégrité, ainsi que les sources de journal utilisées, sont définis dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="80e02-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="80e02-123">Avec quelques lignes de balisage de configuration, vous pouvez utiliser le contrôle d’intégrité pour consigner toutes les exceptions non gérées dans une base de données et vous avertir de l’exception par courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="80e02-124">Exploration de la configuration du système de contrôle d’intégrité</span><span class="sxs-lookup"><span data-stu-id="80e02-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="80e02-125">Le comportement du système de contrôle d’intégrité est défini par ses informations de configuration, qui se trouvent dans l' [élément`<healthMonitoring>`](https://msdn.microsoft.com/library/2fwh2ss9.aspx) dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="80e02-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="80e02-126">Cette section de configuration définit, entre autres choses, les trois éléments d’information importants suivants :</span><span class="sxs-lookup"><span data-stu-id="80e02-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="80e02-127">Événements de contrôle d’intégrité qui, lorsqu’ils sont déclenchés, doivent être journalisés,</span><span class="sxs-lookup"><span data-stu-id="80e02-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="80e02-128">Sources du journal, et</span><span class="sxs-lookup"><span data-stu-id="80e02-128">The log sources, and</span></span>
3. <span data-ttu-id="80e02-129">Comment chaque événement de contrôle d’intégrité défini dans (1) est mappé aux sources de journaux définies dans (2).</span><span class="sxs-lookup"><span data-stu-id="80e02-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="80e02-130">Ces informations sont spécifiées à l’aide de trois éléments de configuration enfants : [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx)et [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectivement.</span><span class="sxs-lookup"><span data-stu-id="80e02-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="80e02-131">Les informations de configuration du système de contrôle d’intégrité par défaut se trouvent dans le fichier `Web.config` dans `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` dossier.</span><span class="sxs-lookup"><span data-stu-id="80e02-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="80e02-132">Ces informations de configuration par défaut, avec des balises supprimées par souci de concision, sont présentées ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="80e02-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample1.xml)]

<span data-ttu-id="80e02-133">Les événements de contrôle d’État intéressants sont définis dans l’élément `<eventMappings>`, qui donne un nom convivial à une classe d’événements de contrôle d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="80e02-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="80e02-134">Dans le balisage ci-dessus, l’élément `<eventMappings>` affecte le nom convivial « toutes les erreurs » aux événements de contrôle d’intégrité de type `WebBaseErrorEvent` et le nom « audits des échecs » pour les événements de contrôle d’intégrité de type `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="80e02-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="80e02-135">L’élément `<providers>` définit les sources de journal, en leur donnant un nom convivial et en spécifiant les informations de configuration spécifiques à la source du journal.</span><span class="sxs-lookup"><span data-stu-id="80e02-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="80e02-136">Le premier élément `<add>` définit le fournisseur « EventLogProvider », qui journalise les événements de contrôle d’intégrité spécifiés à l’aide de la classe `EventLogWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="80e02-137">La classe `EventLogWebEventProvider` enregistre l’événement dans le journal des événements Windows.</span><span class="sxs-lookup"><span data-stu-id="80e02-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="80e02-138">Le deuxième élément `<add>` définit le fournisseur « SqlWebEventProvider », qui consigne les événements dans une base de données Microsoft SQL Server via la classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="80e02-139">La configuration « SqlWebEventProvider » spécifie la chaîne de connexion de la base de données (`connectionStringName`) parmi d’autres options de configuration.</span><span class="sxs-lookup"><span data-stu-id="80e02-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="80e02-140">L’élément `<rules>` mappe les événements spécifiés dans l’élément `<eventMappings>` à des sources de journal dans l’élément `<providers>`.</span><span class="sxs-lookup"><span data-stu-id="80e02-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="80e02-141">Par défaut, les applications Web ASP.NET consignent toutes les exceptions non gérées et les échecs d’audit dans le journal des événements Windows.</span><span class="sxs-lookup"><span data-stu-id="80e02-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="80e02-142">Journalisation des événements dans une base de données</span><span class="sxs-lookup"><span data-stu-id="80e02-142">Logging Events to a Database</span></span>

<span data-ttu-id="80e02-143">La configuration par défaut du système de contrôle d’intégrité peut être personnalisée en fonction de l’application Web, par l’ajout d’une `<healthMonitoring>` section au fichier `Web.config` de l’application.</span><span class="sxs-lookup"><span data-stu-id="80e02-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="80e02-144">Vous pouvez inclure des éléments supplémentaires dans les sections `<eventMappings>`, `<providers>`et `<rules>` à l’aide de l’élément `<add>`.</span><span class="sxs-lookup"><span data-stu-id="80e02-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="80e02-145">Pour supprimer un paramètre de la configuration par défaut, utilisez l’élément `<remove>` ou `<clear />` pour supprimer toutes les valeurs par défaut de l’une de ces sections.</span><span class="sxs-lookup"><span data-stu-id="80e02-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="80e02-146">Nous allons configurer l’application Web de révisions de livres pour consigner toutes les exceptions non gérées dans une base de données Microsoft SQL Server à l’aide de la classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="80e02-147">La classe `SqlWebEventProvider` fait partie du système de contrôle d’intégrité et enregistre un événement de contrôle d’intégrité dans une base de données SQL Server spécifiée.</span><span class="sxs-lookup"><span data-stu-id="80e02-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="80e02-148">La classe `SqlWebEventProvider` s’attend à ce que la base de données spécifiée comprenne une procédure stockée nommée `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="80e02-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="80e02-149">Cette procédure stockée reçoit les détails de l’événement et est chargé de stocker les détails de l’événement.</span><span class="sxs-lookup"><span data-stu-id="80e02-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="80e02-150">La bonne nouvelle, c’est que vous n’avez pas besoin de créer cette procédure stockée ou la table pour stocker les détails de l’événement.</span><span class="sxs-lookup"><span data-stu-id="80e02-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="80e02-151">Vous pouvez ajouter ces objets à votre base de données à l’aide de l’outil `aspnet_regsql.exe`.</span><span class="sxs-lookup"><span data-stu-id="80e02-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="80e02-152">L’outil `aspnet_regsql.exe` a été abordé dans la page [ *configuration d’un site Web qui utilise services d’application* didacticiel](configuring-a-website-that-uses-application-services-vb.md) lorsque nous avons ajouté la prise en charge d’ASP. Services d’application du réseau.</span><span class="sxs-lookup"><span data-stu-id="80e02-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-vb.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="80e02-153">Par conséquent, la base de données du site Web de révisions de livres contient déjà la procédure stockée `aspnet_WebEvent_LogEvent`, qui stocke les informations d’événement dans une table nommée `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="80e02-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>

<span data-ttu-id="80e02-154">Une fois que vous avez ajouté la table et la procédure stockée nécessaires à votre base de données, il ne reste plus qu’à demander à l’analyse du fonctionnement de consigner toutes les exceptions non gérées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="80e02-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="80e02-155">Pour ce faire, ajoutez le balisage suivant au fichier `Web.config` de votre site Web :</span><span class="sxs-lookup"><span data-stu-id="80e02-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample2.xml)]

<span data-ttu-id="80e02-156">Le balisage de la configuration du contrôle d’intégrité ci-dessus utilise `<clear />` éléments pour effacer les informations de configuration du contrôle d’intégrité prédéfinies à partir des sections `<eventMappings>`, `<providers>`et `<rules>`.</span><span class="sxs-lookup"><span data-stu-id="80e02-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="80e02-157">Il ajoute ensuite une seule entrée à chacune de ces sections.</span><span class="sxs-lookup"><span data-stu-id="80e02-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="80e02-158">L’élément `<eventMappings>` définit un événement d’analyse d’intégrité unique nommé « toutes les erreurs », qui est déclenché chaque fois qu’une exception non gérée se produit.</span><span class="sxs-lookup"><span data-stu-id="80e02-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="80e02-159">L’élément `<providers>` définit une source de journal unique nommée « SqlWebEventProvider » qui utilise la classe `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="80e02-160">L’attribut `connectionStringName` a été défini sur « ReviewsConnectionString », qui est le nom de la chaîne de connexion définie dans la section `<connectionStrings>`.</span><span class="sxs-lookup"><span data-stu-id="80e02-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="80e02-161">Enfin, l’élément &lt;Rules&gt; indique qu’en cas d’événement « All Errors » (toutes les erreurs), il doit être journalisé à l’aide du fournisseur « SqlWebEventProvider ».</span><span class="sxs-lookup"><span data-stu-id="80e02-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="80e02-162">Ces informations de configuration demandent au système de contrôle d’intégrité d’enregistrer toutes les exceptions non gérées dans la base de données de révisions de livres.</span><span class="sxs-lookup"><span data-stu-id="80e02-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="80e02-163">L’événement `WebBaseErrorEvent` est déclenché uniquement pour les erreurs de serveur ; elle n’est pas déclenchée pour les erreurs HTTP, telles qu’une demande de ressource ASP.NET introuvable.</span><span class="sxs-lookup"><span data-stu-id="80e02-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="80e02-164">Cela diffère du comportement de l’événement `Error` de la classe `HttpApplication`, qui est déclenché à la fois pour les erreurs serveur et HTTP.</span><span class="sxs-lookup"><span data-stu-id="80e02-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>

<span data-ttu-id="80e02-165">Pour voir le système de contrôle d’intégrité en action, visitez le site Web et générez une erreur d’exécution en visitant `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="80e02-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="80e02-166">Vous devez voir la page d’erreur appropriée, à savoir les détails de l’exception écran jaune de la mort (lors de la visite locale) ou la page d’erreurs personnalisée (lorsque vous vous rendez sur le site en production).</span><span class="sxs-lookup"><span data-stu-id="80e02-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="80e02-167">En arrière-plan, le système de contrôle d’intégrité a consigné les informations d’erreur dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="80e02-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="80e02-168">Il doit y avoir un enregistrement dans la table `aspnet_WebEvent_Events` (voir **figure 1**). Cet enregistrement contient des informations sur l’erreur d’exécution qui vient de se produire.</span><span class="sxs-lookup"><span data-stu-id="80e02-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image1.png)

<span data-ttu-id="80e02-169">**Figure 1**: les détails de l’erreur ont été enregistrés dans la table `aspnet_WebEvent_Events`</span><span class="sxs-lookup"><span data-stu-id="80e02-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="80e02-170">([Cliquez pour afficher l’image en taille réelle](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="80e02-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="80e02-171">Affichage du journal des erreurs dans une page Web</span><span class="sxs-lookup"><span data-stu-id="80e02-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="80e02-172">Avec la configuration actuelle du site Web, le système de surveillance de l’intégrité enregistre toutes les exceptions non gérées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="80e02-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="80e02-173">Toutefois, le contrôle d’intégrité ne fournit aucun mécanisme permettant d’afficher le journal des erreurs via une page Web.</span><span class="sxs-lookup"><span data-stu-id="80e02-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="80e02-174">Toutefois, vous pouvez créer une page ASP.NET qui affiche ces informations à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="80e02-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="80e02-175">(Comme nous le verrons momentanément, vous pouvez choisir de vous envoyer les détails de l’erreur dans un message électronique.)</span><span class="sxs-lookup"><span data-stu-id="80e02-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="80e02-176">Si vous créez une page de ce type, veillez à prendre les mesures nécessaires pour autoriser uniquement les utilisateurs autorisés à afficher les détails de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="80e02-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="80e02-177">Si votre site utilise déjà des comptes d’utilisateur, vous pouvez utiliser des règles d’autorisation d’URL pour limiter l’accès à la page à certains utilisateurs ou rôles.</span><span class="sxs-lookup"><span data-stu-id="80e02-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="80e02-178">Pour plus d’informations sur l’octroi ou la restriction de l’accès aux pages Web en fonction de l’utilisateur connecté, consultez les didacticiels sur la sécurité de mon [site Web](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="80e02-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="80e02-179">Le didacticiel suivant explore un autre système de journalisation des erreurs et de notification nommé ELMAH.</span><span class="sxs-lookup"><span data-stu-id="80e02-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="80e02-180">ELMAH comprend un mécanisme intégré permettant d’afficher le journal des erreurs à la fois sur une page Web et en tant que flux RSS.</span><span class="sxs-lookup"><span data-stu-id="80e02-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>

## <a name="logging-events-to-email"></a><span data-ttu-id="80e02-181">Journalisation des événements dans un message électronique</span><span class="sxs-lookup"><span data-stu-id="80e02-181">Logging Events to Email</span></span>

<span data-ttu-id="80e02-182">Le système de contrôle d’intégrité comprend un fournisseur de source de journal qui « enregistre » un événement dans un message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="80e02-183">La source du journal comprend les mêmes informations qui sont consignées dans la base de données dans le corps du message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="80e02-184">Vous pouvez utiliser cette source de journal pour notifier un développeur lorsqu’un certain événement de contrôle d’intégrité se produit.</span><span class="sxs-lookup"><span data-stu-id="80e02-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="80e02-185">Nous allons mettre à jour la configuration du site Web de révisions de livres pour recevoir un e-mail chaque fois qu’une exception se produit.</span><span class="sxs-lookup"><span data-stu-id="80e02-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="80e02-186">Pour ce faire, nous devons effectuer trois tâches :</span><span class="sxs-lookup"><span data-stu-id="80e02-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="80e02-187">Configurez l’application Web ASP.NET pour l’envoi de courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="80e02-188">Pour ce faire, vous devez spécifier la façon dont les messages électroniques sont envoyés par le biais de l’élément de configuration `<system.net>`.</span><span class="sxs-lookup"><span data-stu-id="80e02-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="80e02-189">Pour plus d’informations sur l’envoi de messages électroniques dans une application ASP.NET, consultez [Envoyer un message électronique dans ASP.net](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) et le [FAQ System .net. mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="80e02-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="80e02-190">Inscrivez le fournisseur de source de journaux de messagerie dans l’élément `<providers>`, et</span><span class="sxs-lookup"><span data-stu-id="80e02-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="80e02-191">Ajoutez une entrée à l’élément `<rules>` qui mappe l’événement « All Errors » au fournisseur de source de journal ajouté à l’étape (2).</span><span class="sxs-lookup"><span data-stu-id="80e02-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="80e02-192">Le système de contrôle d’intégrité comprend deux classes de fournisseur de sources de journaux de messagerie : `SimpleMailWebEventProvider` et `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="80e02-193">La [classe`SimpleMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) envoie un message électronique de texte brut qui inclut les détails de l’événement et fournit peu de personnalisation du corps de l’e-mail.</span><span class="sxs-lookup"><span data-stu-id="80e02-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="80e02-194">Avec la [classe`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) , vous spécifiez une page ASP.net dont le balisage rendu est utilisé comme corps du message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="80e02-195">La [classe`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) vous donne un meilleur contrôle sur le contenu et le format du message électronique, mais nécessite un peu plus de travail avant que vous ne deviez créer la page ASP.net qui génère le corps du message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="80e02-196">Ce didacticiel se concentre sur l’utilisation de la classe `SimpleMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="80e02-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="80e02-197">Mettez à jour l’élément `<providers>` du système de contrôle d’intégrité dans le fichier `Web.config` pour inclure une source de journal pour la classe `SimpleMailWebEventProvider` :</span><span class="sxs-lookup"><span data-stu-id="80e02-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample3.xml)]

<span data-ttu-id="80e02-198">Le balisage ci-dessus utilise la classe `SimpleMailWebEventProvider` comme fournisseur de source de journal et lui attribue le nom convivial « EmailWebEventProvider ».</span><span class="sxs-lookup"><span data-stu-id="80e02-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="80e02-199">En outre, l’attribut `<add>` comprend des options de configuration supplémentaires, telles que les adresses à et depuis du message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="80e02-200">Avec la source du journal des e-mails définie, il ne reste plus qu’à demander au système de contrôle d’intégrité d’utiliser cette source pour « journaliser » les exceptions non gérées.</span><span class="sxs-lookup"><span data-stu-id="80e02-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="80e02-201">Pour ce faire, ajoutez une nouvelle règle dans la section `<rules>` :</span><span class="sxs-lookup"><span data-stu-id="80e02-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-vb/samples/sample4.xml)]

<span data-ttu-id="80e02-202">La section `<rules>` comprend désormais deux règles.</span><span class="sxs-lookup"><span data-stu-id="80e02-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="80e02-203">Le premier, nommé « toutes les erreurs à envoyer par courrier électronique », envoie toutes les exceptions non gérées à la source du journal « EmailWebEventProvider ».</span><span class="sxs-lookup"><span data-stu-id="80e02-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="80e02-204">Cette règle a pour effet d’envoyer des détails sur les erreurs sur le site Web à l’adresse spécifiée.</span><span class="sxs-lookup"><span data-stu-id="80e02-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="80e02-205">La règle « toutes les erreurs dans la base de données » enregistre les détails de l’erreur dans la base de données du site.</span><span class="sxs-lookup"><span data-stu-id="80e02-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="80e02-206">Par conséquent, chaque fois qu’une exception non gérée se produit sur le site, ses détails sont tous deux enregistrés dans la base de données et envoyés à l’adresse de messagerie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="80e02-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="80e02-207">La **figure 2** montre l’e-mail généré par la classe `SimpleMailWebEventProvider` lors de la visite `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="80e02-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-vb/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-vb/_static/image4.png)

<span data-ttu-id="80e02-208">**Figure 2**: les détails de l’erreur sont envoyés dans un message électronique</span><span class="sxs-lookup"><span data-stu-id="80e02-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="80e02-209">([Cliquez pour afficher l’image en taille réelle](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="80e02-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-vb/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="80e02-210">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="80e02-210">Summary</span></span>

<span data-ttu-id="80e02-211">Le système de contrôle d’intégrité ASP.NET est conçu pour permettre aux administrateurs de surveiller l’intégrité d’une application Web déployée.</span><span class="sxs-lookup"><span data-stu-id="80e02-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="80e02-212">Les événements de contrôle d’intégrité sont déclenchés lorsque certaines actions se déroulent, par exemple lorsque l’application s’arrête, lorsqu’un utilisateur se connecte avec succès au site ou lorsqu’une exception non gérée se produit.</span><span class="sxs-lookup"><span data-stu-id="80e02-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="80e02-213">Ces événements peuvent être enregistrés dans un nombre quelconque de sources de journaux.</span><span class="sxs-lookup"><span data-stu-id="80e02-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="80e02-214">Ce didacticiel vous a montré comment enregistrer les détails des exceptions non gérées dans une base de données et par le biais d’un message électronique.</span><span class="sxs-lookup"><span data-stu-id="80e02-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="80e02-215">Ce didacticiel se concentre sur l’utilisation de la surveillance de l’intégrité pour consigner les exceptions non gérées, mais gardez à l’esprit que le contrôle d’intégrité est conçu pour mesurer l’intégrité globale d’une application ASP.NET déployée et qu’elle comprend une multitude d’événements de contrôle d’intégrité et de sources de journaux non exploré ici.</span><span class="sxs-lookup"><span data-stu-id="80e02-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="80e02-216">De plus, vous pouvez créer vos propres événements de surveillance de l’intégrité et sources de journaux, en cas de besoin.</span><span class="sxs-lookup"><span data-stu-id="80e02-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="80e02-217">Si vous souhaitez en savoir plus sur la surveillance de l’intégrité, la première étape consiste à lire le FAQ sur la surveillance de l' [intégrité](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)de [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="80e02-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="80e02-218">Ensuite, consultez [la rubrique Comment : utiliser le contrôle d’intégrité dans ASP.NET 2,0](https://msdn.microsoft.com/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="80e02-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="80e02-219">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="80e02-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="80e02-220">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="80e02-220">Further Reading</span></span>

<span data-ttu-id="80e02-221">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="80e02-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="80e02-222">Vue d’ensemble de la surveillance de l’intégrité ASP.NET</span><span class="sxs-lookup"><span data-stu-id="80e02-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="80e02-223">Configuration et personnalisation du système de contrôle d’intégrité de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="80e02-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="80e02-224">FAQ-surveillance de l’intégrité dans ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="80e02-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="80e02-225">Procédure : envoyer un message électronique pour les notifications de surveillance de l’intégrité</span><span class="sxs-lookup"><span data-stu-id="80e02-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="80e02-226">Procédure : utiliser le contrôle d’intégrité dans ASP.NET</span><span class="sxs-lookup"><span data-stu-id="80e02-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="80e02-227">Surveillance de l’intégrité dans ASP.NET</span><span class="sxs-lookup"><span data-stu-id="80e02-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="80e02-228">[Précédent](processing-unhandled-exceptions-vb.md)
> [Suivant](logging-error-details-with-elmah-vb.md)</span><span class="sxs-lookup"><span data-stu-id="80e02-228">[Previous](processing-unhandled-exceptions-vb.md)
[Next](logging-error-details-with-elmah-vb.md)</span></span>
