---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
title: Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-part 7 | Microsoft Docs
author: tdykstra
description: L’exemple d’application Web Contoso University montre comment créer des applications de Web Forms ASP.NET à l’aide de l’Entity Framework. L’exemple d’application est...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: f8afb245-b705-419c-8790-0b295e90d5e2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
msc.type: authoredcontent
ms.openlocfilehash: 18d4b44c5e23fd6942c3adf48a33a5602e6df6d0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78603431"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-7"></a><span data-ttu-id="551f2-104">Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-part 7</span><span class="sxs-lookup"><span data-stu-id="551f2-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 7</span></span>

<span data-ttu-id="551f2-105">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="551f2-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="551f2-106">L’exemple d’application Web Contoso University montre comment créer des applications ASP.NET Web Forms à l’aide de la Entity Framework 4,0 et de Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="551f2-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="551f2-107">Pour plus d’informations sur la série de didacticiels, consultez [le premier didacticiel de la série](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="551f2-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="using-stored-procedures"></a><span data-ttu-id="551f2-108">Utilisation des procédures stockées</span><span class="sxs-lookup"><span data-stu-id="551f2-108">Using Stored Procedures</span></span>

<span data-ttu-id="551f2-109">Dans le didacticiel précédent, vous avez implémenté un modèle d’héritage TPH (table par hiérarchie).</span><span class="sxs-lookup"><span data-stu-id="551f2-109">In the previous tutorial you implemented a table-per-hierarchy inheritance pattern.</span></span> <span data-ttu-id="551f2-110">Ce didacticiel vous montre comment utiliser des procédures stockées pour mieux contrôler l’accès aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="551f2-110">This tutorial will show you how to use stored procedures to gain more control over database access.</span></span>

<span data-ttu-id="551f2-111">Le Entity Framework vous permet de spécifier qu’il doit utiliser des procédures stockées pour l’accès aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="551f2-111">The Entity Framework lets you specify that it should use stored procedures for database access.</span></span> <span data-ttu-id="551f2-112">Pour tout type d’entité, vous pouvez spécifier une procédure stockée à utiliser pour créer, mettre à jour ou supprimer des entités de ce type.</span><span class="sxs-lookup"><span data-stu-id="551f2-112">For any entity type, you can specify a stored procedure to use for creating, updating, or deleting entities of that type.</span></span> <span data-ttu-id="551f2-113">Ensuite, dans le modèle de données, vous pouvez ajouter des références à des procédures stockées que vous pouvez utiliser pour effectuer des tâches telles que la récupération de jeux d’entités.</span><span class="sxs-lookup"><span data-stu-id="551f2-113">Then in the data model you can add references to stored procedures that you can use to perform tasks such as retrieving sets of entities.</span></span>

<span data-ttu-id="551f2-114">L’utilisation de procédures stockées est une exigence courante pour l’accès aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="551f2-114">Using stored procedures is a common requirement for database access.</span></span> <span data-ttu-id="551f2-115">Dans certains cas, un administrateur de base de données peut exiger que tous les accès à la base de données passent par des procédures stockées pour des raisons de sécurité.</span><span class="sxs-lookup"><span data-stu-id="551f2-115">In some cases a database administrator may require that all database access go through stored procedures for security reasons.</span></span> <span data-ttu-id="551f2-116">Dans d’autres cas, vous pouvez créer une logique métier dans certains processus que le Entity Framework utilise lorsqu’il met à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="551f2-116">In other cases you may want to build business logic into some of the processes that the Entity Framework uses when it updates the database.</span></span> <span data-ttu-id="551f2-117">Par exemple, chaque fois qu’une entité est supprimée, vous souhaiterez peut-être la copier dans une base de données d’archivage.</span><span class="sxs-lookup"><span data-stu-id="551f2-117">For example, whenever an entity is deleted you might want to copy it to an archive database.</span></span> <span data-ttu-id="551f2-118">Ou lorsqu’une ligne est mise à jour, vous souhaiterez peut-être écrire une ligne dans une table de journalisation qui enregistre la personne qui a apporté la modification.</span><span class="sxs-lookup"><span data-stu-id="551f2-118">Or whenever a row is updated you might want to write a row to a logging table that records who made the change.</span></span> <span data-ttu-id="551f2-119">Vous pouvez effectuer ces genres de tâches dans une procédure stockée appelée chaque fois que le Entity Framework supprime une entité ou met à jour une entité.</span><span class="sxs-lookup"><span data-stu-id="551f2-119">You can perform these kinds of tasks in a stored procedure that's called whenever the Entity Framework deletes an entity or updates an entity.</span></span>

<span data-ttu-id="551f2-120">Comme dans le didacticiel précédent, vous ne créez pas de nouvelles pages.</span><span class="sxs-lookup"><span data-stu-id="551f2-120">As in the previous tutorial, you'll not create any new pages.</span></span> <span data-ttu-id="551f2-121">Au lieu de cela, vous allez modifier la manière dont le Entity Framework accède à la base de données pour certaines des pages que vous avez déjà créées.</span><span class="sxs-lookup"><span data-stu-id="551f2-121">Instead, you'll change the way the Entity Framework accesses the database for some of the pages you already created.</span></span>

<span data-ttu-id="551f2-122">Dans ce didacticiel, vous allez créer des procédures stockées dans la base de données pour insérer des entités `Student` et `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="551f2-122">In this tutorial you'll create stored procedures in the database for inserting `Student` and `Instructor` entities.</span></span> <span data-ttu-id="551f2-123">Vous allez les ajouter au modèle de données et spécifier que le Entity Framework doit les utiliser pour ajouter des entités `Student` et `Instructor` à la base de données.</span><span class="sxs-lookup"><span data-stu-id="551f2-123">You'll add them to the data model, and you'll specify that the Entity Framework should use them for adding `Student` and `Instructor` entities to the database.</span></span> <span data-ttu-id="551f2-124">Vous allez également créer une procédure stockée que vous pouvez utiliser pour récupérer `Course` entités.</span><span class="sxs-lookup"><span data-stu-id="551f2-124">You'll also create a stored procedure that you can use to retrieve `Course` entities.</span></span>

## <a name="creating-stored-procedures-in-the-database"></a><span data-ttu-id="551f2-125">Création de procédures stockées dans la base de données</span><span class="sxs-lookup"><span data-stu-id="551f2-125">Creating Stored Procedures in the Database</span></span>

<span data-ttu-id="551f2-126">(Si vous utilisez le fichier *School. mdf* du projet disponible en téléchargement dans ce didacticiel, vous pouvez ignorer cette section, car les procédures stockées existent déjà.)</span><span class="sxs-lookup"><span data-stu-id="551f2-126">(If you're using the *School.mdf* file from the project available for download with this tutorial, you can skip this section because the stored procedures already exist.)</span></span>

<span data-ttu-id="551f2-127">Dans **Explorateur de serveurs**, développez *School. mdf*, cliquez avec le bouton droit sur **procédures stockées**, puis sélectionnez **Ajouter une nouvelle procédure stockée**.</span><span class="sxs-lookup"><span data-stu-id="551f2-127">In **Server Explorer**, expand *School.mdf*, right-click **Stored Procedures**, and select **Add New Stored Procedure**.</span></span>

<span data-ttu-id="551f2-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span></span>

<span data-ttu-id="551f2-129">Copiez les instructions SQL suivantes et collez-les dans la fenêtre procédure stockée, en remplaçant la procédure stockée squelette.</span><span class="sxs-lookup"><span data-stu-id="551f2-129">Copy the following SQL statements and paste them into the stored procedure window, replacing the skeleton stored procedure.</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample1.sql)]

<span data-ttu-id="551f2-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span></span>

<span data-ttu-id="551f2-131">les entités `Student` ont quatre propriétés : `PersonID`, `LastName`, `FirstName`et `EnrollmentDate`.</span><span class="sxs-lookup"><span data-stu-id="551f2-131">`Student` entities have four properties: `PersonID`, `LastName`, `FirstName`, and `EnrollmentDate`.</span></span> <span data-ttu-id="551f2-132">La base de données génère automatiquement la valeur d’ID, et la procédure stockée accepte des paramètres pour les trois autres.</span><span class="sxs-lookup"><span data-stu-id="551f2-132">The database generates the ID value automatically, and the stored procedure accepts parameters for the other three.</span></span> <span data-ttu-id="551f2-133">La procédure stockée retourne la valeur de la clé d’enregistrement de la nouvelle ligne afin que le Entity Framework puisse suivre cela dans la version de l’entité qu’elle conserve en mémoire.</span><span class="sxs-lookup"><span data-stu-id="551f2-133">The stored procedure returns the value of the new row's record key so that the Entity Framework can keep track of that in the version of the entity it keeps in memory.</span></span>

<span data-ttu-id="551f2-134">Enregistrez et fermez la fenêtre procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="551f2-134">Save and close the stored procedure window.</span></span>

<span data-ttu-id="551f2-135">Créez une procédure stockée `InsertInstructor` de la même manière, à l’aide des instructions SQL suivantes :</span><span class="sxs-lookup"><span data-stu-id="551f2-135">Create an `InsertInstructor` stored procedure in the same manner, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample2.sql)]

<span data-ttu-id="551f2-136">Créez également des procédures stockées `Update` pour les entités `Student` et `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="551f2-136">Create `Update` stored procedures for `Student` and `Instructor` entities also.</span></span> <span data-ttu-id="551f2-137">(La base de données a déjà une procédure stockée `DeletePerson` qui fonctionne pour les entités `Instructor` et `Student`.)</span><span class="sxs-lookup"><span data-stu-id="551f2-137">(The database already has a `DeletePerson` stored procedure which will work for both `Instructor` and `Student` entities.)</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample3.sql)]

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample4.sql)]

<span data-ttu-id="551f2-138">Dans ce didacticiel, vous allez mapper les trois fonctions (Insert, Update et Delete) pour chaque type d’entité.</span><span class="sxs-lookup"><span data-stu-id="551f2-138">In this tutorial you'll map all three functions -- insert, update, and delete -- for each entity type.</span></span> <span data-ttu-id="551f2-139">Le Entity Framework version 4 vous permet de mapper uniquement une ou deux de ces fonctions aux procédures stockées sans mapper les autres, à une exception près : Si vous mappez la fonction de mise à jour mais pas la fonction de suppression, la Entity Framework lèvera une exception lorsque vous tentative de suppression d’une entité.</span><span class="sxs-lookup"><span data-stu-id="551f2-139">The Entity Framework version 4 allows you to map just one or two of these functions to stored procedures without mapping the others, with one exception: if you map the update function but not the delete function, the Entity Framework will throw an exception when you attempt to delete an entity.</span></span> <span data-ttu-id="551f2-140">Dans le Entity Framework version 3,5, vous ne disposiez pas de cette flexibilité dans le mappage des procédures stockées : Si vous avez mappé une fonction que vous deviez mapper les trois.</span><span class="sxs-lookup"><span data-stu-id="551f2-140">In the Entity Framework version 3.5, you did not have this much flexibility in mapping stored procedures: if you mapped one function you were required to map all three.</span></span>

<span data-ttu-id="551f2-141">Pour créer une procédure stockée qui lit plutôt que met à jour les données, créez-en une qui sélectionne toutes les entités `Course`, à l’aide des instructions SQL suivantes :</span><span class="sxs-lookup"><span data-stu-id="551f2-141">To create a stored procedure that reads rather than updates data, create one that selects all `Course` entities, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample5.sql)]

## <a name="adding-the-stored-procedures-to-the-data-model"></a><span data-ttu-id="551f2-142">Ajout de procédures stockées au modèle de données</span><span class="sxs-lookup"><span data-stu-id="551f2-142">Adding the Stored Procedures to the Data Model</span></span>

<span data-ttu-id="551f2-143">Les procédures stockées sont maintenant définies dans la base de données, mais elles doivent être ajoutées au modèle de données pour les mettre à disposition du Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="551f2-143">The stored procedures are now defined in the database, but they must be added to the data model to make them available to the Entity Framework.</span></span> <span data-ttu-id="551f2-144">Ouvrez *SchoolModel. edmx*, cliquez avec le bouton droit sur l’aire de conception, puis sélectionnez **mettre à jour le modèle à partir de la base de données**.</span><span class="sxs-lookup"><span data-stu-id="551f2-144">Open *SchoolModel.edmx*, right-click the design surface, and select **Update Model from Database**.</span></span> <span data-ttu-id="551f2-145">Dans l’onglet **Ajouter** de la boîte **de dialogue choisir vos objets de base de données** , développez **procédures stockées**, sélectionnez les procédures stockées nouvellement créées et la procédure stockée `DeletePerson`, puis cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="551f2-145">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures**, select the newly created stored procedures and the `DeletePerson` stored procedure, and then click **Finish**.</span></span>

<span data-ttu-id="551f2-146">[![Image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span></span>

## <a name="mapping-the-stored-procedures"></a><span data-ttu-id="551f2-147">Mappage des procédures stockées</span><span class="sxs-lookup"><span data-stu-id="551f2-147">Mapping the Stored Procedures</span></span>

<span data-ttu-id="551f2-148">Dans le concepteur de modèle de données, cliquez avec le bouton droit sur l’entité `Student`, puis sélectionnez **mappage de procédure stockée**.</span><span class="sxs-lookup"><span data-stu-id="551f2-148">In the data model designer, right-click the `Student` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="551f2-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span></span>

<span data-ttu-id="551f2-150">La fenêtre **Détails de mappage** s’affiche, dans laquelle vous pouvez spécifier des procédures stockées que le Entity Framework doit utiliser pour l’insertion, la mise à jour et la suppression d’entités de ce type.</span><span class="sxs-lookup"><span data-stu-id="551f2-150">The **Mapping Details** window appears, in which you can specify stored procedures that the Entity Framework should use for inserting, updating, and deleting entities of this type.</span></span>

<span data-ttu-id="551f2-151">[![Image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span></span>

<span data-ttu-id="551f2-152">Définissez la fonction **Insert** sur **InsertStudent**.</span><span class="sxs-lookup"><span data-stu-id="551f2-152">Set the **Insert** function to **InsertStudent**.</span></span> <span data-ttu-id="551f2-153">La fenêtre affiche une liste de paramètres de procédure stockée, chacun d’entre eux devant être mappé à une propriété d’entité.</span><span class="sxs-lookup"><span data-stu-id="551f2-153">The window shows a list of stored procedure parameters, each of which must be mapped to an entity property.</span></span> <span data-ttu-id="551f2-154">Deux d’entre elles sont mappées automatiquement, car les noms sont identiques.</span><span class="sxs-lookup"><span data-stu-id="551f2-154">Two of these are mapped automatically because the names are the same.</span></span> <span data-ttu-id="551f2-155">Il n’existe aucune propriété d’entité nommée `FirstName`. vous devez donc sélectionner manuellement `FirstMidName` dans une liste déroulante qui affiche les propriétés d’entité disponibles.</span><span class="sxs-lookup"><span data-stu-id="551f2-155">There's no entity property named `FirstName`, so you must manually select `FirstMidName` from a drop-down list that shows available entity properties.</span></span> <span data-ttu-id="551f2-156">(Cela est dû au fait que vous avez remplacé le nom de la propriété `FirstName` par `FirstMidName` dans le premier didacticiel.)</span><span class="sxs-lookup"><span data-stu-id="551f2-156">(This is because you changed the name of the `FirstName` property to `FirstMidName` in the first tutorial.)</span></span>

<span data-ttu-id="551f2-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span></span>

<span data-ttu-id="551f2-158">Dans la même fenêtre **Détails de mappage** , mappez la fonction `Update` à la procédure stockée `UpdateStudent` (veillez à spécifier `FirstMidName` comme valeur de paramètre pour `FirstName`, comme vous l’avez fait pour la procédure stockée `Insert`) et la fonction `Delete` à la procédure stockée `DeletePerson`.</span><span class="sxs-lookup"><span data-stu-id="551f2-158">In the same **Mapping Details** window, map the `Update` function to the `UpdateStudent` stored procedure (make sure you specify `FirstMidName` as the parameter value for `FirstName`, as you did for the `Insert` stored procedure) and the `Delete` function to the `DeletePerson` stored procedure.</span></span>

<span data-ttu-id="551f2-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span></span>

<span data-ttu-id="551f2-160">Suivez la même procédure pour mapper les procédures stockées INSERT, Update et Delete pour les formateurs à l’entité `Instructor`.</span><span class="sxs-lookup"><span data-stu-id="551f2-160">Follow the same procedure to map the insert, update, and delete stored procedures for instructors to the `Instructor` entity.</span></span>

<span data-ttu-id="551f2-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span></span>

<span data-ttu-id="551f2-162">Pour les procédures stockées qui lisent plutôt que les données de mise à jour, vous utilisez la fenêtre **Explorateur de modèles** pour mapper la procédure stockée au type d’entité qu’elle retourne.</span><span class="sxs-lookup"><span data-stu-id="551f2-162">For stored procedures that read rather than update data, you use the **Model Browser** window to map the stored procedure to the entity type it returns.</span></span> <span data-ttu-id="551f2-163">Dans le concepteur de modèle de données, cliquez avec le bouton droit sur l’aire de conception, puis sélectionnez **Explorateur de modèles**.</span><span class="sxs-lookup"><span data-stu-id="551f2-163">In the data model designer, right-click the design surface and select **Model Browser**.</span></span> <span data-ttu-id="551f2-164">Ouvrez le nœud **SchoolModel. Store** , puis ouvrez le nœud **procédures stockées** .</span><span class="sxs-lookup"><span data-stu-id="551f2-164">Open the **SchoolModel.Store** node and then open the **Stored Procedures** node.</span></span> <span data-ttu-id="551f2-165">Cliquez ensuite avec le bouton droit sur la procédure stockée `GetCourses`, puis sélectionnez **Ajouter une importation de fonction**.</span><span class="sxs-lookup"><span data-stu-id="551f2-165">Then right-click the `GetCourses` stored procedure and select **Add Function Import**.</span></span>

<span data-ttu-id="551f2-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span></span>

<span data-ttu-id="551f2-167">Dans la boîte de dialogue **Ajouter une importation de fonction** , sous **retourne une collection d'** **entités**Select, puis sélectionnez `Course` comme type d’entité retourné.</span><span class="sxs-lookup"><span data-stu-id="551f2-167">In the **Add Function Import** dialog box, under **Returns a Collection Of** select **Entities**, and then select `Course` as the entity type returned.</span></span> <span data-ttu-id="551f2-168">Quand vous avez terminé, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="551f2-168">When you're done, click **OK**.</span></span> <span data-ttu-id="551f2-169">Enregistrez et fermez le fichier *. edmx* .</span><span class="sxs-lookup"><span data-stu-id="551f2-169">Save and close the *.edmx* file.</span></span>

<span data-ttu-id="551f2-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span></span>

## <a name="using-insert-update-and-delete-stored-procedures"></a><span data-ttu-id="551f2-171">Utilisation des procédures stockées INSERT, Update et Delete</span><span class="sxs-lookup"><span data-stu-id="551f2-171">Using Insert, Update, and Delete Stored Procedures</span></span>

<span data-ttu-id="551f2-172">Les procédures stockées pour insérer, mettre à jour et supprimer des données sont utilisées par le Entity Framework automatiquement une fois que vous les avez ajoutées au modèle de données et les avez mappées aux entités appropriées.</span><span class="sxs-lookup"><span data-stu-id="551f2-172">Stored procedures to insert, update, and delete data are used by the Entity Framework automatically after you've added them to the data model and mapped them to the appropriate entities.</span></span> <span data-ttu-id="551f2-173">Vous pouvez maintenant exécuter la page *StudentsAdd. aspx* , et chaque fois que vous créez un nouvel étudiant, le Entity Framework utilisera la procédure stockée `InsertStudent` pour ajouter la nouvelle ligne à la table `Student`.</span><span class="sxs-lookup"><span data-stu-id="551f2-173">You can now run the *StudentsAdd.aspx* page, and every time you create a new student, the Entity Framework will use the `InsertStudent` stored procedure to add the new row to the `Student` table.</span></span>

<span data-ttu-id="551f2-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span></span>

<span data-ttu-id="551f2-175">Exécutez la page *students. aspx* et le nouvel étudiant apparaît dans la liste.</span><span class="sxs-lookup"><span data-stu-id="551f2-175">Run the *Students.aspx* page and the new student appears in the list.</span></span>

<span data-ttu-id="551f2-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span></span>

<span data-ttu-id="551f2-177">Modifiez le nom pour vérifier que la fonction de mise à jour fonctionne, puis supprimez l’étudiant pour vérifier que la fonction de suppression fonctionne.</span><span class="sxs-lookup"><span data-stu-id="551f2-177">Change the name to verify that the update function works, and then delete the student to verify that the delete function works.</span></span>

<span data-ttu-id="551f2-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="551f2-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span></span>

## <a name="using-select-stored-procedures"></a><span data-ttu-id="551f2-179">Utilisation des procédures stockées Select</span><span class="sxs-lookup"><span data-stu-id="551f2-179">Using Select Stored Procedures</span></span>

<span data-ttu-id="551f2-180">Le Entity Framework n’exécute pas automatiquement les procédures stockées telles que `GetCourses`, et vous ne pouvez pas les utiliser avec le contrôle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="551f2-180">The Entity Framework does not automatically run stored procedures such as `GetCourses`, and you cannot use them with the `EntityDataSource` control.</span></span> <span data-ttu-id="551f2-181">Pour les utiliser, vous les appelez à partir du code.</span><span class="sxs-lookup"><span data-stu-id="551f2-181">To use them, you call them from code.</span></span>

<span data-ttu-id="551f2-182">Ouvrez le fichier *InstructorsCourses.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="551f2-182">Open the *InstructorsCourses.aspx.cs* file.</span></span> <span data-ttu-id="551f2-183">La méthode `PopulateDropDownLists` utilise une requête LINQ-to-Entities pour récupérer toutes les entités course afin qu’elle puisse parcourir la liste et déterminer à qui un formateur est assigné et quels sont ceux qui ne sont pas assignés :</span><span class="sxs-lookup"><span data-stu-id="551f2-183">The `PopulateDropDownLists` method uses a LINQ-to-Entities query to retrieve all course entities so that it can loop through the list and determine which ones an instructor is assigned to and which ones are unassigned:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample6.cs)]

<span data-ttu-id="551f2-184">Remplacez ceci par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="551f2-184">Replace this with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample7.cs)]

<span data-ttu-id="551f2-185">La page utilise à présent la procédure stockée `GetCourses` pour récupérer la liste de tous les cours.</span><span class="sxs-lookup"><span data-stu-id="551f2-185">The page now uses the `GetCourses` stored procedure to retrieve the list of all courses.</span></span> <span data-ttu-id="551f2-186">Exécutez la page pour vérifier qu’elle fonctionne comme avant.</span><span class="sxs-lookup"><span data-stu-id="551f2-186">Run the page to verify that it works as it did before.</span></span>

<span data-ttu-id="551f2-187">(Les propriétés de navigation des entités récupérées par une procédure stockée peuvent ne pas être renseignées automatiquement avec les données associées à ces entités, selon `ObjectContext` paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="551f2-187">(Navigation properties of entities retrieved by a stored procedure might not be automatically populated with the data related to those entities, depending on `ObjectContext` default settings.</span></span> <span data-ttu-id="551f2-188">Pour plus d’informations, consultez [chargement d’objets connexes](https://msdn.microsoft.com/library/bb896272.aspx) dans la bibliothèque MSDN.)</span><span class="sxs-lookup"><span data-stu-id="551f2-188">For more information, see [Loading Related Objects](https://msdn.microsoft.com/library/bb896272.aspx) in the MSDN Library.)</span></span>

<span data-ttu-id="551f2-189">Dans le didacticiel suivant, vous apprendrez à utiliser Dynamic Data fonctionnalité pour faciliter la programmation et le test des règles de mise en forme et de validation des données.</span><span class="sxs-lookup"><span data-stu-id="551f2-189">In the next tutorial, you'll learn how to use Dynamic Data functionality to make it easier to program and test data formatting and validation rules.</span></span> <span data-ttu-id="551f2-190">Au lieu de spécifier sur chaque règle de page Web, comme les chaînes de format de données, et si un champ est obligatoire ou non, vous pouvez spécifier ces règles dans les métadonnées du modèle de données et elles sont automatiquement appliquées à chaque page.</span><span class="sxs-lookup"><span data-stu-id="551f2-190">Instead of specifying on each web page rules such as data format strings and whether or not a field is required, you can specify such rules in data model metadata and they're automatically applied on every page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="551f2-191">[Précédent](the-entity-framework-and-aspnet-getting-started-part-6.md)
> [Suivant](the-entity-framework-and-aspnet-getting-started-part-8.md)</span><span class="sxs-lookup"><span data-stu-id="551f2-191">[Previous](the-entity-framework-and-aspnet-getting-started-part-6.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-8.md)</span></span>
