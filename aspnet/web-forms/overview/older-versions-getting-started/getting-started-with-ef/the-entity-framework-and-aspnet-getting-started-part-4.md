---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
title: Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-part 4 | Microsoft Docs
author: tdykstra
description: L’exemple d’application Web Contoso University montre comment créer des applications de Web Forms ASP.NET à l’aide de l’Entity Framework. L’exemple d’application est...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: ceb9e60f-957c-4d25-9331-cc527de96a33
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-4
msc.type: authoredcontent
ms.openlocfilehash: eb75a76038466bf30738387ed4739687de1df944
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78638165"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-4"></a><span data-ttu-id="54929-104">Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-part 4</span><span class="sxs-lookup"><span data-stu-id="54929-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 4</span></span>

<span data-ttu-id="54929-105">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="54929-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="54929-106">L’exemple d’application Web Contoso University montre comment créer des applications ASP.NET Web Forms à l’aide de la Entity Framework 4,0 et de Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="54929-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="54929-107">Pour plus d’informations sur la série de didacticiels, consultez [le premier didacticiel de la série](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="54929-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="working-with-related-data"></a><span data-ttu-id="54929-108">Utilisation des données associées</span><span class="sxs-lookup"><span data-stu-id="54929-108">Working with Related Data</span></span>

<span data-ttu-id="54929-109">Dans le didacticiel précédent, vous avez utilisé le contrôle `EntityDataSource` pour filtrer, trier et regrouper des données.</span><span class="sxs-lookup"><span data-stu-id="54929-109">In the previous tutorial you used the `EntityDataSource` control to filter, sort, and group data.</span></span> <span data-ttu-id="54929-110">Dans ce didacticiel, vous allez afficher et mettre à jour les données associées.</span><span class="sxs-lookup"><span data-stu-id="54929-110">In this tutorial you'll display and update related data.</span></span>

<span data-ttu-id="54929-111">Vous allez créer la page des instructeurs qui affiche une liste d’instructeurs.</span><span class="sxs-lookup"><span data-stu-id="54929-111">You'll create the Instructors page that shows a list of instructors.</span></span> <span data-ttu-id="54929-112">Lorsque vous sélectionnez un formateur, vous voyez une liste des cours traités par ce formateur.</span><span class="sxs-lookup"><span data-stu-id="54929-112">When you select an instructor, you see a list of courses taught by that instructor.</span></span> <span data-ttu-id="54929-113">Lorsque vous sélectionnez un cours, vous voyez les détails relatifs au cours et à la liste des étudiants inscrits au cours.</span><span class="sxs-lookup"><span data-stu-id="54929-113">When you select a course, you see details for the course and a list of students enrolled in the course.</span></span> <span data-ttu-id="54929-114">Vous pouvez modifier le nom de l’instructeur, la date d’embauche et l’affectation Office.</span><span class="sxs-lookup"><span data-stu-id="54929-114">You can edit the instructor name, hire date, and office assignment.</span></span> <span data-ttu-id="54929-115">L’attribution de bureau est un jeu d’entités distinct auquel vous accédez via une propriété de navigation.</span><span class="sxs-lookup"><span data-stu-id="54929-115">The office assignment is a separate entity set that you access through a navigation property.</span></span>

<span data-ttu-id="54929-116">Vous pouvez lier des données de référence à des données de détail dans le balisage ou dans le code.</span><span class="sxs-lookup"><span data-stu-id="54929-116">You can link master data to detail data in markup or in code.</span></span> <span data-ttu-id="54929-117">Dans cette partie du didacticiel, vous allez utiliser les deux méthodes.</span><span class="sxs-lookup"><span data-stu-id="54929-117">In this part of the tutorial, you'll use both methods.</span></span>

<span data-ttu-id="54929-118">[![image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="54929-118">[![Image01](the-entity-framework-and-aspnet-getting-started-part-4/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image1.png)</span></span>

## <a name="displaying-and-updating-related-entities-in-a-gridview-control"></a><span data-ttu-id="54929-119">Affichage et mise à jour des entités associées dans un contrôle GridView</span><span class="sxs-lookup"><span data-stu-id="54929-119">Displaying and Updating Related Entities in a GridView Control</span></span>

<span data-ttu-id="54929-120">Créez une nouvelle page Web nommée *Instructors. aspx* qui utilise la page maître *site. Master* , puis ajoutez le balisage suivant au contrôle `Content` nommé `Content2`:</span><span class="sxs-lookup"><span data-stu-id="54929-120">Create a new web page named *Instructors.aspx* that uses the *Site.Master* master page, and add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample1.aspx)]

<span data-ttu-id="54929-121">Ce balisage crée un contrôle de `EntityDataSource` qui sélectionne les instructeurs et active les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="54929-121">This markup creates an `EntityDataSource` control that selects instructors and enables updates.</span></span> <span data-ttu-id="54929-122">L’élément `div` configure la balise à afficher à gauche pour que vous puissiez ajouter une colonne à droite ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="54929-122">The `div` element configures markup to render on the left so that you can add a column on the right later.</span></span>

<span data-ttu-id="54929-123">Entre le balisage `EntityDataSource` et la balise de `</div>` de fermeture, ajoutez la balise suivante qui crée un contrôle `GridView` et un `Label` contrôle que vous allez utiliser pour les messages d’erreur :</span><span class="sxs-lookup"><span data-stu-id="54929-123">Between the `EntityDataSource` markup and the closing `</div>` tag, add the following markup that creates a `GridView` control and a `Label` control that you'll use for error messages:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample2.aspx)]

<span data-ttu-id="54929-124">Ce contrôle de `GridView` permet de sélectionner la ligne, met en surbrillance la ligne sélectionnée avec une couleur d’arrière-plan gris clair et spécifie les gestionnaires (que vous créerez ultérieurement) pour les événements `SelectedIndexChanged` et `Updating`.</span><span class="sxs-lookup"><span data-stu-id="54929-124">This `GridView` control enables row selection, highlights the selected row with a light gray background color, and specifies handlers (which you'll create later) for the `SelectedIndexChanged` and `Updating` events.</span></span> <span data-ttu-id="54929-125">Il spécifie également `PersonID` pour la propriété `DataKeyNames`, afin que la valeur de clé de la ligne sélectionnée puisse être passée à un autre contrôle que vous ajouterez ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="54929-125">It also specifies `PersonID` for the `DataKeyNames` property, so that the key value of the selected row can be passed to another control that you'll add later.</span></span>

<span data-ttu-id="54929-126">La dernière colonne contient l’attribution de bureau de l’instructeur, qui est stockée dans une propriété de navigation de l’entité `Person`, car elle provient d’une entité associée.</span><span class="sxs-lookup"><span data-stu-id="54929-126">The last column contains the instructor's office assignment, which is stored in a navigation property of the `Person` entity because it comes from an associated entity.</span></span> <span data-ttu-id="54929-127">Notez que l’élément `EditItemTemplate` spécifie `Eval` au lieu de `Bind`, car le contrôle `GridView` ne peut pas effectuer de liaison directe avec les propriétés de navigation pour les mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="54929-127">Notice that the `EditItemTemplate` element specifies `Eval` instead of `Bind`, because the `GridView` control cannot directly bind to navigation properties in order to update them.</span></span> <span data-ttu-id="54929-128">Vous allez mettre à jour l’attribution de bureau dans le code.</span><span class="sxs-lookup"><span data-stu-id="54929-128">You'll update the office assignment in code.</span></span> <span data-ttu-id="54929-129">Pour ce faire, vous avez besoin d’une référence au contrôle `TextBox`, et vous pouvez l’obtenir et l’enregistrer dans l’événement `Init` du contrôle `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="54929-129">To do that, you'll need a reference to the `TextBox` control, and you'll get and save that in the `TextBox` control's `Init` event.</span></span>

<span data-ttu-id="54929-130">Le contrôle de `GridView` est un contrôle `Label` utilisé pour les messages d’erreur.</span><span class="sxs-lookup"><span data-stu-id="54929-130">Following the `GridView` control is a `Label` control that's used for error messages.</span></span> <span data-ttu-id="54929-131">La propriété `Visible` du contrôle est `false`et l’état d’affichage est désactivé, afin que l’étiquette s’affiche uniquement lorsque le code le rend visible en réponse à une erreur.</span><span class="sxs-lookup"><span data-stu-id="54929-131">The control's `Visible` property is `false`, and view state is turned off, so that the label will appear only when code makes it visible in response to an error.</span></span>

<span data-ttu-id="54929-132">Ouvrez le fichier *Instructors.aspx.cs* et ajoutez l’instruction `using` suivante :</span><span class="sxs-lookup"><span data-stu-id="54929-132">Open the *Instructors.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample3.cs)]

<span data-ttu-id="54929-133">Ajoutez un champ de classe privé immédiatement après la déclaration de nom de classe partielle pour contenir une référence à la zone de texte Assignment Office.</span><span class="sxs-lookup"><span data-stu-id="54929-133">Add a private class field immediately after the partial-class name declaration to hold a reference to the office assignment text box.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample4.cs)]

<span data-ttu-id="54929-134">Ajoutez un stub pour le gestionnaire d’événements `SelectedIndexChanged` auquel vous ajouterez du code pour une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="54929-134">Add a stub for the `SelectedIndexChanged` event handler that you'll add code for later.</span></span> <span data-ttu-id="54929-135">Ajoutez également un gestionnaire pour l’événement `Init` du contrôle de `TextBox` d’affectation Office afin que vous puissiez stocker une référence au contrôle `TextBox`.</span><span class="sxs-lookup"><span data-stu-id="54929-135">Also add a handler for the office assignment `TextBox` control's `Init` event so that you can store a reference to the `TextBox` control.</span></span> <span data-ttu-id="54929-136">Vous utiliserez cette référence pour récupérer la valeur entrée par l’utilisateur afin de mettre à jour l’entité associée à la propriété de navigation.</span><span class="sxs-lookup"><span data-stu-id="54929-136">You'll use this reference to get the value the user entered in order to update the entity associated with the navigation property.</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample5.cs)]

<span data-ttu-id="54929-137">Vous utiliserez l’événement `Updating` du contrôle `GridView` pour mettre à jour la propriété `Location` de l’entité `OfficeAssignment` associée.</span><span class="sxs-lookup"><span data-stu-id="54929-137">You'll use the `GridView` control's `Updating` event to update the `Location` property of the associated `OfficeAssignment` entity.</span></span> <span data-ttu-id="54929-138">Ajoutez le gestionnaire suivant pour l’événement `Updating` :</span><span class="sxs-lookup"><span data-stu-id="54929-138">Add the following handler for the `Updating` event:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample6.cs)]

<span data-ttu-id="54929-139">Ce code est exécuté lorsque l’utilisateur clique sur **mettre à jour** dans une ligne `GridView`.</span><span class="sxs-lookup"><span data-stu-id="54929-139">This code is run when the user clicks **Update** in a `GridView` row.</span></span> <span data-ttu-id="54929-140">Le code utilise LINQ to Entities pour récupérer l’entité `OfficeAssignment` qui est associée à l’entité `Person` actuelle, à l’aide de la `PersonID` de la ligne sélectionnée à partir de l’argument d’événement.</span><span class="sxs-lookup"><span data-stu-id="54929-140">The code uses LINQ to Entities to retrieve the `OfficeAssignment` entity that's associated with the current `Person` entity, using the `PersonID` of the selected row from the event argument.</span></span>

<span data-ttu-id="54929-141">Le code effectue ensuite l’une des actions suivantes en fonction de la valeur du contrôle `InstructorOfficeTextBox` :</span><span class="sxs-lookup"><span data-stu-id="54929-141">The code then takes one of the following actions depending on the value in the `InstructorOfficeTextBox` control:</span></span>

- <span data-ttu-id="54929-142">Si la zone de texte a une valeur et qu’il n’existe aucune entité `OfficeAssignment` à mettre à jour, elle en crée une.</span><span class="sxs-lookup"><span data-stu-id="54929-142">If the text box has a value and there's no `OfficeAssignment` entity to update, it creates one.</span></span>
- <span data-ttu-id="54929-143">Si la zone de texte a une valeur et qu’il existe une entité `OfficeAssignment`, elle met à jour la valeur de la propriété `Location`.</span><span class="sxs-lookup"><span data-stu-id="54929-143">If the text box has a value and there's an `OfficeAssignment` entity, it updates the `Location` property value.</span></span>
- <span data-ttu-id="54929-144">Si la zone de texte est vide et qu’une entité `OfficeAssignment` existe, elle supprime l’entité.</span><span class="sxs-lookup"><span data-stu-id="54929-144">If the text box is empty and an `OfficeAssignment` entity exists, it deletes the entity.</span></span>

<span data-ttu-id="54929-145">Après cela, il enregistre les modifications dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="54929-145">After this, it saves the changes to the database.</span></span> <span data-ttu-id="54929-146">Si une exception se produit, elle affiche un message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="54929-146">If an exception occurs, it displays an error message.</span></span>

<span data-ttu-id="54929-147">Exécutez la page.</span><span class="sxs-lookup"><span data-stu-id="54929-147">Run the page.</span></span>

<span data-ttu-id="54929-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="54929-148">[![Image02](the-entity-framework-and-aspnet-getting-started-part-4/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image3.png)</span></span>

<span data-ttu-id="54929-149">Cliquez sur **modifier** pour que tous les champs soient modifiés en zones de texte.</span><span class="sxs-lookup"><span data-stu-id="54929-149">Click **Edit** and all fields change to text boxes.</span></span>

<span data-ttu-id="54929-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="54929-150">[![Image03](the-entity-framework-and-aspnet-getting-started-part-4/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image5.png)</span></span>

<span data-ttu-id="54929-151">Modifiez l’une de ces valeurs, y compris l' **attribution de bureau**.</span><span class="sxs-lookup"><span data-stu-id="54929-151">Change any of these values, including **Office Assignment**.</span></span> <span data-ttu-id="54929-152">Cliquez sur **mettre à jour** pour voir les modifications reflétées dans la liste.</span><span class="sxs-lookup"><span data-stu-id="54929-152">Click **Update** and you'll see the changes reflected in the list.</span></span>

## <a name="displaying-related-entities-in-a-separate-control"></a><span data-ttu-id="54929-153">Affichage des entités associées dans un contrôle distinct</span><span class="sxs-lookup"><span data-stu-id="54929-153">Displaying Related Entities in a Separate Control</span></span>

<span data-ttu-id="54929-154">Chaque formateur peut enseigner un ou plusieurs cours. vous allez donc ajouter un contrôle de `EntityDataSource` et un contrôle `GridView` pour répertorier les cours associés à l’option Instructor sélectionné dans le contrôle `GridView` des enseignants.</span><span class="sxs-lookup"><span data-stu-id="54929-154">Each instructor can teach one or more courses, so you'll add an `EntityDataSource` control and a `GridView` control to list the courses associated with whichever instructor is selected in the instructors `GridView` control.</span></span> <span data-ttu-id="54929-155">Pour créer un en-tête et le contrôle de `EntityDataSource` pour les entités de cours, ajoutez le balisage suivant entre le message d’erreur `Label` contrôle et la balise de `</div>` de fermeture :</span><span class="sxs-lookup"><span data-stu-id="54929-155">To create a heading and the `EntityDataSource` control for courses entities, add the following markup between the error message `Label` control and the closing `</div>` tag:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample7.aspx)]

<span data-ttu-id="54929-156">Le paramètre `Where` contient la valeur de la `PersonID` de l’instructeur dont la ligne est sélectionnée dans le contrôle `InstructorsGridView`.</span><span class="sxs-lookup"><span data-stu-id="54929-156">The `Where` parameter contains the value of the `PersonID` of the instructor whose row is selected in the `InstructorsGridView` control.</span></span> <span data-ttu-id="54929-157">La propriété `Where` contient une commande de sous-sélection qui obtient toutes les entités `Person` associées de la propriété de navigation `People` d’une entité `Course` et sélectionne l’entité `Course` uniquement si l’une des entités `Person` associées contient la valeur `PersonID` sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="54929-157">The `Where` property contains a subselect command that gets all associated `Person` entities from a `Course` entity's `People` navigation property and selects the `Course` entity only if one of the associated `Person` entities contains the selected `PersonID` value.</span></span>

<span data-ttu-id="54929-158">Pour créer le contrôle `GridView`, ajoutez le balisage suivant immédiatement après le contrôle `CoursesEntityDataSource` (avant la balise de `</div>` de fermeture) :</span><span class="sxs-lookup"><span data-stu-id="54929-158">To create the `GridView` control., add the following markup immediately following the `CoursesEntityDataSource` control (before the closing `</div>` tag):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample8.aspx)]

<span data-ttu-id="54929-159">Étant donné qu’aucun cours ne sera affiché si aucun formateur n’est sélectionné, un élément `EmptyDataTemplate` est inclus.</span><span class="sxs-lookup"><span data-stu-id="54929-159">Because no courses will be displayed if no instructor is selected, an `EmptyDataTemplate` element is included.</span></span>

<span data-ttu-id="54929-160">Exécutez la page.</span><span class="sxs-lookup"><span data-stu-id="54929-160">Run the page.</span></span>

<span data-ttu-id="54929-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="54929-161">[![Image04](the-entity-framework-and-aspnet-getting-started-part-4/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image7.png)</span></span>

<span data-ttu-id="54929-162">Sélectionnez un formateur qui a un ou plusieurs cours attribués, et le ou les cours apparaissent dans la liste.</span><span class="sxs-lookup"><span data-stu-id="54929-162">Select an instructor who has one or more courses assigned, and the course or courses appear in the list.</span></span> <span data-ttu-id="54929-163">(Remarque : bien que le schéma de base de données autorise plusieurs cours, les données de test fournies avec la base de données ne comportent pas plus d’un cours.</span><span class="sxs-lookup"><span data-stu-id="54929-163">(Note: although the database schema allows multiple courses, in the test data supplied with the database no instructor actually has more than one course.</span></span> <span data-ttu-id="54929-164">Vous pouvez ajouter vous-même des cours à la base de données à l’aide de la fenêtre **Explorateur de serveurs** ou de la page *CoursesAdd. aspx* , que vous ajouterez dans un didacticiel ultérieur.)</span><span class="sxs-lookup"><span data-stu-id="54929-164">You can add courses to the database yourself using the **Server Explorer** window or the *CoursesAdd.aspx* page, which you'll add in a later tutorial.)</span></span>

<span data-ttu-id="54929-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="54929-165">[![Image05](the-entity-framework-and-aspnet-getting-started-part-4/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image9.png)</span></span>

<span data-ttu-id="54929-166">Le contrôle `CoursesGridView` affiche uniquement quelques champs de cours.</span><span class="sxs-lookup"><span data-stu-id="54929-166">The `CoursesGridView` control shows only a few course fields.</span></span> <span data-ttu-id="54929-167">Pour afficher tous les détails d’un cours, vous utiliserez un contrôle de `DetailsView` pour le cours que l’utilisateur sélectionne.</span><span class="sxs-lookup"><span data-stu-id="54929-167">To display all the details for a course, you'll use a `DetailsView` control for the course that the user selects.</span></span> <span data-ttu-id="54929-168">Dans *Instructors. aspx*, ajoutez le balisage suivant après la balise `</div>` fermante (veillez à placer ce balisage **après** la balise div de fermeture, et non avant) :</span><span class="sxs-lookup"><span data-stu-id="54929-168">In *Instructors.aspx*, add the following markup after the closing `</div>` tag (make sure you place this markup **after** the closing div tag, not before it):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample9.aspx)]

<span data-ttu-id="54929-169">Ce balisage crée un contrôle `EntityDataSource` qui est lié au jeu d’entités `Courses`.</span><span class="sxs-lookup"><span data-stu-id="54929-169">This markup creates an `EntityDataSource` control that's bound to the `Courses` entity set.</span></span> <span data-ttu-id="54929-170">La propriété `Where` sélectionne un cours à l’aide de la valeur `CourseID` de la ligne sélectionnée dans le contrôle `GridView` des cours.</span><span class="sxs-lookup"><span data-stu-id="54929-170">The `Where` property selects a course using the `CourseID` value of the selected row in the courses `GridView` control.</span></span> <span data-ttu-id="54929-171">Le balisage spécifie un gestionnaire pour l’événement `Selected`, que vous utiliserez ultérieurement pour afficher les notes des étudiants, qui est un autre niveau plus bas dans la hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="54929-171">The markup specifies a handler for the `Selected` event, which you'll use later for displaying student grades, which is another level lower in the hierarchy.</span></span>

<span data-ttu-id="54929-172">Dans *Instructors.aspx.cs*, créez le stub suivant pour la méthode `CourseDetailsEntityDataSource_Selected`.</span><span class="sxs-lookup"><span data-stu-id="54929-172">In *Instructors.aspx.cs*, create the following stub for the `CourseDetailsEntityDataSource_Selected` method.</span></span> <span data-ttu-id="54929-173">(Vous allez remplir ce talon plus loin dans le didacticiel. pour l’instant, vous en aurez besoin pour que la page soit compilée et exécutée.)</span><span class="sxs-lookup"><span data-stu-id="54929-173">(You'll fill this stub out later in the tutorial; for now, you need it so that the page will compile and run.)</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample10.cs)]

<span data-ttu-id="54929-174">Exécutez la page.</span><span class="sxs-lookup"><span data-stu-id="54929-174">Run the page.</span></span>

<span data-ttu-id="54929-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="54929-175">[![Image06](the-entity-framework-and-aspnet-getting-started-part-4/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image11.png)</span></span>

<span data-ttu-id="54929-176">Initialement, il n’y a pas de détails sur les cours, car aucun cours n’est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="54929-176">Initially there are no course details because no course is selected.</span></span> <span data-ttu-id="54929-177">Sélectionnez un formateur qui a un cours affecté, puis sélectionnez un cours pour afficher les détails.</span><span class="sxs-lookup"><span data-stu-id="54929-177">Select an instructor who has a course assigned, and then select a course to see the details.</span></span>

<span data-ttu-id="54929-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="54929-178">[![Image07](the-entity-framework-and-aspnet-getting-started-part-4/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image13.png)</span></span>

## <a name="using-the-entitydatasource-selected-event-to-display-related-data"></a><span data-ttu-id="54929-179">Utilisation de l’événement « sélectionné » EntityDataSource pour afficher les données associées</span><span class="sxs-lookup"><span data-stu-id="54929-179">Using the EntityDataSource "Selected" Event to Display Related Data</span></span>

<span data-ttu-id="54929-180">Enfin, vous souhaitez afficher tous les étudiants inscrits et leurs notes pour le cours sélectionné.</span><span class="sxs-lookup"><span data-stu-id="54929-180">Finally, you want to show all of the enrolled students and their grades for the selected course.</span></span> <span data-ttu-id="54929-181">Pour ce faire, vous allez utiliser l’événement `Selected` du contrôle `EntityDataSource` lié à la `DetailsView`course.</span><span class="sxs-lookup"><span data-stu-id="54929-181">To do this, you'll use the `Selected` event of the `EntityDataSource` control bound to the course `DetailsView`.</span></span>

<span data-ttu-id="54929-182">Dans *Instructors. aspx*, ajoutez le balisage suivant après le contrôle `DetailsView` :</span><span class="sxs-lookup"><span data-stu-id="54929-182">In *Instructors.aspx*, add the following markup after the `DetailsView` control:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample11.aspx)]

<span data-ttu-id="54929-183">Ce balisage crée un contrôle de `ListView` qui affiche une liste d’étudiants et leurs notes pour le cours sélectionné.</span><span class="sxs-lookup"><span data-stu-id="54929-183">This markup creates a `ListView` control that displays a list of students and their grades for the selected course.</span></span> <span data-ttu-id="54929-184">Aucune source de données n’est spécifiée, car vous allez créer un DataBind du contrôle dans le code.</span><span class="sxs-lookup"><span data-stu-id="54929-184">No data source is specified because you'll databind the control in code.</span></span> <span data-ttu-id="54929-185">L’élément `EmptyDataTemplate` fournit un message à afficher quand aucun cours n’est sélectionné. dans ce cas, il n’y a aucun étudiant à afficher.</span><span class="sxs-lookup"><span data-stu-id="54929-185">The `EmptyDataTemplate` element provides a message to display when no course is selected—in that case, there are no students to display.</span></span> <span data-ttu-id="54929-186">L’élément `LayoutTemplate` crée une table HTML pour afficher la liste, tandis que le `ItemTemplate` spécifie les colonnes à afficher.</span><span class="sxs-lookup"><span data-stu-id="54929-186">The `LayoutTemplate` element creates an HTML table to display the list, and the `ItemTemplate` specifies the columns to display.</span></span> <span data-ttu-id="54929-187">L’ID de l’étudiant et le grade des étudiants proviennent de l’entité `StudentGrade`, et le nom de l’étudiant provient de l’entité `Person` que le Entity Framework met à disposition dans la propriété de navigation `Person` de l’entité `StudentGrade`.</span><span class="sxs-lookup"><span data-stu-id="54929-187">The student ID and the student grade are from the `StudentGrade` entity, and the student name is from the `Person` entity that the Entity Framework makes available in the `Person` navigation property of the `StudentGrade` entity.</span></span>

<span data-ttu-id="54929-188">Dans *Instructors.aspx.cs*, remplacez la méthode extraite `CourseDetailsEntityDataSource_Selected` par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="54929-188">In *Instructors.aspx.cs*, replace the stubbed-out `CourseDetailsEntityDataSource_Selected` method with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample12.cs)]

<span data-ttu-id="54929-189">L’argument d’événement de cet événement fournit les données sélectionnées sous la forme d’une collection, qui n’aura aucun élément si rien n’est sélectionné ou un élément si une `Course` entité est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="54929-189">The event argument for this event provides the selected data in the form of a collection, which will have zero items if nothing is selected or one item if a `Course` entity is selected.</span></span> <span data-ttu-id="54929-190">Si une entité de `Course` est sélectionnée, le code utilise la méthode `First` pour convertir la collection en un seul objet.</span><span class="sxs-lookup"><span data-stu-id="54929-190">If a `Course` entity is selected, the code uses the `First` method to convert the collection to a single object.</span></span> <span data-ttu-id="54929-191">Il obtient ensuite `StudentGrade` entités de la propriété de navigation, les convertit en une collection et lie le contrôle `GradesListView` à la collection.</span><span class="sxs-lookup"><span data-stu-id="54929-191">It then gets `StudentGrade` entities from the navigation property, converts them to a collection, and binds the `GradesListView` control to the collection.</span></span>

<span data-ttu-id="54929-192">Cela suffit pour afficher les notes, mais vous voulez vous assurer que le message dans le modèle de données vide s’affiche la première fois que la page est affichée et chaque fois qu’un cours n’est pas sélectionné.</span><span class="sxs-lookup"><span data-stu-id="54929-192">This is sufficient to display grades, but you want to make sure that the message in the empty data template is displayed the first time the page is displayed and whenever a course is not selected.</span></span> <span data-ttu-id="54929-193">Pour ce faire, créez la méthode suivante, que vous allez appeler à partir de deux emplacements :</span><span class="sxs-lookup"><span data-stu-id="54929-193">To do that, create the following method, which you'll call from two places:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample13.cs)]

<span data-ttu-id="54929-194">Appelez cette nouvelle méthode à partir de la méthode `Page_Load` pour afficher le modèle de données vide la première fois que la page est affichée.</span><span class="sxs-lookup"><span data-stu-id="54929-194">Call this new method from the `Page_Load` method to display the empty data template the first time the page is displayed.</span></span> <span data-ttu-id="54929-195">Et l’appellent à partir de la méthode `InstructorsGridView_SelectedIndexChanged`, car cet événement est déclenché lorsqu’un formateur est sélectionné, ce qui signifie que les nouveaux cours sont chargés dans les cours `GridView` contrôle et qu’aucun n’est encore sélectionné.</span><span class="sxs-lookup"><span data-stu-id="54929-195">And call it from the `InstructorsGridView_SelectedIndexChanged` method because that event is raised when an instructor is selected, which means new courses are loaded into the courses `GridView` control and none is selected yet.</span></span> <span data-ttu-id="54929-196">Voici les deux appels :</span><span class="sxs-lookup"><span data-stu-id="54929-196">Here are the two calls:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample14.cs)]

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-4/samples/sample15.cs)]

<span data-ttu-id="54929-197">Exécutez la page.</span><span class="sxs-lookup"><span data-stu-id="54929-197">Run the page.</span></span>

<span data-ttu-id="54929-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="54929-198">[![Image08](the-entity-framework-and-aspnet-getting-started-part-4/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image15.png)</span></span>

<span data-ttu-id="54929-199">Sélectionnez un formateur auquel un cours est affecté, puis sélectionnez le cours.</span><span class="sxs-lookup"><span data-stu-id="54929-199">Select an instructor that has a course assigned, and then select the course.</span></span>

<span data-ttu-id="54929-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="54929-200">[![Image09](the-entity-framework-and-aspnet-getting-started-part-4/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-4/_static/image17.png)</span></span>

<span data-ttu-id="54929-201">Vous avez maintenant vu quelques façons d’utiliser les données associées.</span><span class="sxs-lookup"><span data-stu-id="54929-201">You have now seen a few ways to work with related data.</span></span> <span data-ttu-id="54929-202">Dans le didacticiel suivant, vous allez apprendre à ajouter des relations entre des entités existantes, à supprimer des relations et à ajouter une nouvelle entité qui a une relation à une entité existante.</span><span class="sxs-lookup"><span data-stu-id="54929-202">In the following tutorial, you'll learn how to add relationships between existing entities, how to remove relationships, and how to add a new entity that has a relationship to an existing entity.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="54929-203">[Précédent](the-entity-framework-and-aspnet-getting-started-part-3.md)
> [Suivant](the-entity-framework-and-aspnet-getting-started-part-5.md)</span><span class="sxs-lookup"><span data-stu-id="54929-203">[Previous](the-entity-framework-and-aspnet-getting-started-part-3.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-5.md)</span></span>
