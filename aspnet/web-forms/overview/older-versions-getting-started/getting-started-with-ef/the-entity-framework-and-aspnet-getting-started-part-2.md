---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-part 2 | Microsoft Docs
author: tdykstra
description: L’exemple d’application Web Contoso University montre comment créer des applications de Web Forms ASP.NET à l’aide de l’Entity Framework. L’exemple d’application est...
ms.author: riande
ms.date: 12/03/2010
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: bd6a2e29e6f0df04e39be29160e2e08cc99c4706
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78566009"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="e55ec-104">Prise en main avec Entity Framework 4,0 Database First et ASP.NET 4 Web Forms-partie 2</span><span class="sxs-lookup"><span data-stu-id="e55ec-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>

<span data-ttu-id="e55ec-105">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e55ec-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="e55ec-106">L’exemple d’application Web Contoso University montre comment créer des applications ASP.NET Web Forms à l’aide de la Entity Framework 4,0 et de Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="e55ec-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="e55ec-107">Pour plus d’informations sur la série de didacticiels, consultez [le premier didacticiel de la série](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="e55ec-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="the-entitydatasource-control"></a><span data-ttu-id="e55ec-108">Contrôle EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="e55ec-108">The EntityDataSource Control</span></span>

<span data-ttu-id="e55ec-109">Dans le didacticiel précédent, vous avez créé un site Web, une base de données et un modèle de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="e55ec-110">Dans ce didacticiel, vous travaillez avec le contrôle `EntityDataSource` fourni par ASP.NET pour faciliter l’utilisation d’un modèle de données Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="e55ec-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="e55ec-111">Vous allez créer un contrôle de `GridView` pour l’affichage et la modification des données des étudiants, un contrôle `DetailsView` pour l’ajout de nouveaux élèves et un contrôle `DropDownList` pour la sélection d’un service (que vous utiliserez ultérieurement pour afficher les cours associés).</span><span class="sxs-lookup"><span data-stu-id="e55ec-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="e55ec-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="e55ec-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="e55ec-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="e55ec-115">Notez que dans cette application, vous n’ajouterez pas de validation d’entrée aux pages qui mettent à jour la base de données, et une partie de la gestion des erreurs n’est pas aussi robuste que nécessaire dans une application de production.</span><span class="sxs-lookup"><span data-stu-id="e55ec-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="e55ec-116">Cela permet de conserver le didacticiel sur le Entity Framework et de le maintenir trop long.</span><span class="sxs-lookup"><span data-stu-id="e55ec-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="e55ec-117">Pour plus d’informations sur la façon d’ajouter ces fonctionnalités à votre application, consultez Validation de l' [entrée d’utilisateur dans pages Web ASP.net](https://msdn.microsoft.com/library/7kh55542.aspx) et [gestion des erreurs dans les Pages et applications ASP.net](https://msdn.microsoft.com/library/w16865z6.aspx).</span><span class="sxs-lookup"><span data-stu-id="e55ec-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="e55ec-118">Ajout et configuration du contrôle EntityDataSource</span><span class="sxs-lookup"><span data-stu-id="e55ec-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="e55ec-119">Vous commencerez par configurer un contrôle de `EntityDataSource` pour lire les entités `Person` à partir du jeu d’entités `People`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="e55ec-120">Assurez-vous que Visual Studio est ouvert et que vous utilisez le projet que vous avez créé dans la partie 1.</span><span class="sxs-lookup"><span data-stu-id="e55ec-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="e55ec-121">Si vous n’avez pas généré le projet depuis que vous avez créé le modèle de données ou depuis la dernière modification apportée à celui-ci, générez le projet maintenant.</span><span class="sxs-lookup"><span data-stu-id="e55ec-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="e55ec-122">Les modifications apportées au modèle de données ne sont pas mises à la disposition du concepteur tant que le projet n’est pas généré.</span><span class="sxs-lookup"><span data-stu-id="e55ec-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="e55ec-123">Créez une nouvelle page Web à l’aide du **formulaire Web à l’aide** du modèle de page maître et nommez-la Student *. aspx*.</span><span class="sxs-lookup"><span data-stu-id="e55ec-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="e55ec-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="e55ec-125">Spécifiez *site. Master* comme page maître.</span><span class="sxs-lookup"><span data-stu-id="e55ec-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="e55ec-126">Toutes les pages que vous créez pour ces didacticiels utilisent cette page maître.</span><span class="sxs-lookup"><span data-stu-id="e55ec-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="e55ec-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="e55ec-128">En mode **source** , ajoutez une `h2` en-tête au contrôle `Content` nommé `Content2`, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="e55ec-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="e55ec-129">À partir de l’onglet **données** de la **boîte à outils**, faites glisser un contrôle `EntityDataSource` sur la page, déposez-le sous l’en-tête et remplacez l’ID par `StudentsEntityDataSource`:</span><span class="sxs-lookup"><span data-stu-id="e55ec-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="e55ec-130">Basculez en mode **conception** , cliquez sur la balise active du contrôle de source de données, puis cliquez sur **configurer la source de données** pour lancer l’Assistant Configuration de la source de **données** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="e55ec-131">[![image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="e55ec-132">Dans l’étape **configurer** l’Assistant ObjectContext, sélectionnez **SchoolEntities** comme valeur pour **connexion nommée**et sélectionnez **SchoolEntities** comme valeur **DefaultContainerName** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="e55ec-133">Cliquez ensuite sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-133">Then click **Next**.</span></span>

<span data-ttu-id="e55ec-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="e55ec-135">Remarque : Si vous recevez la boîte de dialogue suivante à ce stade, vous devez générer le projet avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="e55ec-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="e55ec-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="e55ec-137">Dans l’étape **configurer la sélection des données** , sélectionnez **personnes** comme valeur pour **EntitySetName**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="e55ec-138">Sous **Sélectionner**, assurez-vous que la case à cocher **Sélectionner une** ll est activée.</span><span class="sxs-lookup"><span data-stu-id="e55ec-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="e55ec-139">Sélectionnez ensuite les options permettant d’activer la mise à jour et la suppression.</span><span class="sxs-lookup"><span data-stu-id="e55ec-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="e55ec-140">Lorsque vous avez terminé, cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="e55ec-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="e55ec-142">Configuration des règles de base de données pour autoriser la suppression</span><span class="sxs-lookup"><span data-stu-id="e55ec-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="e55ec-143">Vous allez créer une page qui permet aux utilisateurs de supprimer les élèves de la table `Person`, qui a trois relations avec d’autres tables (`Course`, `StudentGrade`et `OfficeAssignment`).</span><span class="sxs-lookup"><span data-stu-id="e55ec-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="e55ec-144">Par défaut, la base de données empêche la suppression d’une ligne dans `Person` s’il existe des lignes connexes dans l’une des autres tables.</span><span class="sxs-lookup"><span data-stu-id="e55ec-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="e55ec-145">Vous pouvez supprimer manuellement les lignes associées en premier, ou vous pouvez configurer la base de données pour les supprimer automatiquement lorsque vous supprimez une ligne de `Person`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="e55ec-146">Pour les dossiers des élèves de ce didacticiel, vous allez configurer la base de données de façon à supprimer automatiquement les données associées.</span><span class="sxs-lookup"><span data-stu-id="e55ec-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="e55ec-147">Étant donné que les élèves peuvent avoir des lignes associées uniquement dans la table `StudentGrade`, vous ne devez configurer qu’une seule des trois relations.</span><span class="sxs-lookup"><span data-stu-id="e55ec-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="e55ec-148">Si vous utilisez le fichier *School. mdf* que vous avez téléchargé à partir du projet qui accompagne ce didacticiel, vous pouvez ignorer cette section, car ces modifications de configuration ont déjà été effectuées.</span><span class="sxs-lookup"><span data-stu-id="e55ec-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="e55ec-149">Si vous avez créé la base de données en exécutant un script, configurez la base de données en effectuant les procédures suivantes.</span><span class="sxs-lookup"><span data-stu-id="e55ec-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="e55ec-150">Dans **Explorateur de serveurs**, ouvrez le schéma de base de données que vous avez créé dans la partie 1.</span><span class="sxs-lookup"><span data-stu-id="e55ec-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="e55ec-151">Cliquez avec le bouton droit sur la relation entre `Person` et `StudentGrade` (la ligne entre les tables), puis sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="e55ec-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="e55ec-153">Dans la fenêtre **Propriétés** , développez **spécification Insert et Update** , puis affectez à la propriété **DeleteRule** la valeur **cascade**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="e55ec-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="e55ec-155">Enregistrez et fermez le diagramme.</span><span class="sxs-lookup"><span data-stu-id="e55ec-155">Save and close the diagram.</span></span> <span data-ttu-id="e55ec-156">Si vous êtes invité à indiquer si vous souhaitez mettre à jour la base de données, cliquez sur **Oui**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="e55ec-157">Pour vous assurer que le modèle conserve les entités en mémoire synchronisées avec ce que fait la base de données, vous devez définir les règles correspondantes dans le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="e55ec-158">Ouvrez *SchoolModel. edmx*, cliquez avec le bouton droit sur la ligne d’association entre `Person` et `StudentGrade`, puis sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="e55ec-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="e55ec-160">Dans la fenêtre **Propriétés** , affectez à **End1 OnDelete** la valeur **cascade**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="e55ec-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="e55ec-162">Enregistrez et fermez le fichier *SchoolModel. edmx* , puis régénérez le projet.</span><span class="sxs-lookup"><span data-stu-id="e55ec-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="e55ec-163">En général, lorsque la base de données change, vous avez plusieurs possibilités pour synchroniser le modèle :</span><span class="sxs-lookup"><span data-stu-id="e55ec-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="e55ec-164">Pour certains types de modifications (telles que l’ajout ou l’actualisation des tables, des vues ou des procédures stockées), cliquez avec le bouton droit dans le concepteur et sélectionnez **mettre à jour le modèle à partir de la base de données** pour que le concepteur effectue automatiquement les modifications.</span><span class="sxs-lookup"><span data-stu-id="e55ec-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="e55ec-165">Régénérez le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-165">Regenerate the data model.</span></span>
- <span data-ttu-id="e55ec-166">Effectuez des mises à jour manuelles comme celle-ci.</span><span class="sxs-lookup"><span data-stu-id="e55ec-166">Make manual updates like this one.</span></span>

<span data-ttu-id="e55ec-167">Dans ce cas, vous pouvez avoir régénéré le modèle ou actualisé les tables affectées par la modification de la relation, mais vous devez alors réactiver la modification du nom de champ (de `FirstName` à `FirstMidName`).</span><span class="sxs-lookup"><span data-stu-id="e55ec-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="e55ec-168">Utilisation d’un contrôle GridView pour lire et mettre à jour des entités</span><span class="sxs-lookup"><span data-stu-id="e55ec-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="e55ec-169">Dans cette section, vous allez utiliser un contrôle de `GridView` pour afficher, mettre à jour ou supprimer des élèves.</span><span class="sxs-lookup"><span data-stu-id="e55ec-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="e55ec-170">Ouvrez ou basculez vers *students. aspx* et basculez en mode **Design** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="e55ec-171">À partir de l’onglet **données** de la **boîte à outils**, faites glisser un contrôle `GridView` à droite du contrôle `EntityDataSource`, nommez-le `StudentsGridView`, cliquez sur la balise active, puis sélectionnez **StudentsEntityDataSource** comme source de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="e55ec-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="e55ec-173">Cliquez sur **Actualiser le schéma** (cliquez sur **Oui** si vous êtes invité à confirmer), puis cliquez sur **activer la pagination**, sur Activer le **Tri**, sur **activer la modification**et sur **activer la suppression**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="e55ec-174">Cliquez sur **modifier les colonnes**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="e55ec-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="e55ec-176">Dans la zone **champs sélectionnés** , supprimez **PersonID**, **LastName**et **HireDate**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="e55ec-177">En général, vous n’affichez pas de clé d’enregistrement pour les utilisateurs, la date d’embauche n’est pas pertinente pour les élèves et vous placez les deux parties du nom dans un champ, de sorte que vous n’avez besoin que d’un des champs nom.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="e55ec-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="e55ec-179">Sélectionnez le champ **FirstMidName** , puis cliquez sur **convertir ce champ en TemplateField**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="e55ec-180">Procédez de la même façon pour **EnrollmentDate**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="e55ec-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="e55ec-182">Cliquez sur **OK** , puis basculez en mode **source** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="e55ec-183">Les modifications restantes seront plus faciles à effectuer directement dans le balisage.</span><span class="sxs-lookup"><span data-stu-id="e55ec-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="e55ec-184">Le balisage de contrôle `GridView` se présente maintenant comme dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="e55ec-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="e55ec-185">La première colonne après le champ de commande est un champ de modèle qui affiche actuellement le prénom.</span><span class="sxs-lookup"><span data-stu-id="e55ec-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="e55ec-186">Modifiez le balisage de ce champ de modèle pour qu’il ressemble à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="e55ec-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="e55ec-187">En mode d’affichage, deux contrôles de `Label` affichent le prénom et le nom.</span><span class="sxs-lookup"><span data-stu-id="e55ec-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="e55ec-188">En mode édition, deux zones de texte sont fournies pour vous permettre de modifier le prénom et le nom.</span><span class="sxs-lookup"><span data-stu-id="e55ec-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="e55ec-189">Comme avec les contrôles `Label` en mode d’affichage, vous utilisez des expressions `Bind` et `Eval` exactement comme vous le feriez avec les contrôles de source de données ASP.NET qui se connectent directement aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="e55ec-190">La seule différence est que vous spécifiez des propriétés d’entité au lieu de colonnes de base de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="e55ec-191">La dernière colonne est un champ de modèle qui affiche la date d’inscription.</span><span class="sxs-lookup"><span data-stu-id="e55ec-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="e55ec-192">Modifiez le balisage de ce champ pour qu’il ressemble à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="e55ec-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="e55ec-193">En mode affichage et édition, la chaîne de format « {0, d} » entraîne l’affichage de la date au format « date abrégée ».</span><span class="sxs-lookup"><span data-stu-id="e55ec-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="e55ec-194">(Votre ordinateur peut être configuré pour afficher ce format différemment des images d’écran présentées dans ce didacticiel.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="e55ec-195">Notez que dans chacun de ces champs de modèle, le concepteur a utilisé une expression `Bind` par défaut, mais vous l’avez changée en expression `Eval` dans les éléments `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="e55ec-196">L’expression `Bind` rend les données disponibles dans les propriétés de contrôle `GridView` au cas où vous devriez accéder aux données dans le code.</span><span class="sxs-lookup"><span data-stu-id="e55ec-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="e55ec-197">Dans cette page, vous n’avez pas besoin d’accéder à ces données dans le code, vous pouvez donc utiliser `Eval`, ce qui est plus efficace.</span><span class="sxs-lookup"><span data-stu-id="e55ec-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="e55ec-198">Pour plus d’informations, consultez [récupération de vos données des contrôles de données](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span><span class="sxs-lookup"><span data-stu-id="e55ec-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="e55ec-199">Révision du balisage de contrôle EntityDataSource pour améliorer les performances</span><span class="sxs-lookup"><span data-stu-id="e55ec-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="e55ec-200">Dans le balisage du contrôle `EntityDataSource`, supprimez les attributs `ConnectionString` et `DefaultContainerName` et remplacez-les par un attribut `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="e55ec-201">Il s’agit d’une modification que vous devez effectuer chaque fois que vous créez un contrôle `EntityDataSource`, sauf si vous devez utiliser une connexion différente de celle qui est codée en dur dans la classe de contexte de l’objet.</span><span class="sxs-lookup"><span data-stu-id="e55ec-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="e55ec-202">L’utilisation de l’attribut `ContextTypeName` offre les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="e55ec-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="e55ec-203">Performances améliorées.</span><span class="sxs-lookup"><span data-stu-id="e55ec-203">Better performance.</span></span> <span data-ttu-id="e55ec-204">Lorsque le contrôle de `EntityDataSource` Initialise le modèle de données à l’aide des attributs `ConnectionString` et `DefaultContainerName`, il effectue un travail supplémentaire pour charger les métadonnées à chaque requête.</span><span class="sxs-lookup"><span data-stu-id="e55ec-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="e55ec-205">Cela n’est pas nécessaire si vous spécifiez l’attribut `ContextTypeName`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="e55ec-206">Le chargement différé est activé par défaut dans les classes de contexte d’objet générées (telles que `SchoolEntities` dans ce didacticiel) dans Entity Framework 4,0.</span><span class="sxs-lookup"><span data-stu-id="e55ec-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="e55ec-207">Cela signifie que les propriétés de navigation sont chargées automatiquement avec les données associées lorsque vous en avez besoin.</span><span class="sxs-lookup"><span data-stu-id="e55ec-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="e55ec-208">Le chargement différé est expliqué plus en détail plus loin dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e55ec-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="e55ec-209">Toutes les personnalisations que vous avez appliquées à la classe de contexte de l’objet (dans ce cas, la classe `SchoolEntities`) sont disponibles pour les contrôles qui utilisent le contrôle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="e55ec-210">La personnalisation de la classe de contexte de l’objet est une rubrique avancée qui n’est pas traitée dans cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="e55ec-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="e55ec-211">Pour plus d’informations, consultez [extension des types générés par Entity Framework](https://msdn.microsoft.com/library/dd456844.aspx).</span><span class="sxs-lookup"><span data-stu-id="e55ec-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="e55ec-212">La balise est maintenant similaire à l’exemple suivant (l’ordre des propriétés peut être différent) :</span><span class="sxs-lookup"><span data-stu-id="e55ec-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="e55ec-213">L’attribut `EnableFlattening` fait référence à une fonctionnalité qui était nécessaire dans les versions antérieures du Entity Framework, car les colonnes clés étrangères n’étaient pas exposées comme propriétés d’entité.</span><span class="sxs-lookup"><span data-stu-id="e55ec-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="e55ec-214">La version actuelle permet d’utiliser des *associations de clé étrangère*, ce qui signifie que les propriétés de clé étrangère sont exposées pour toutes les associations sauf plusieurs-à-plusieurs.</span><span class="sxs-lookup"><span data-stu-id="e55ec-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="e55ec-215">Si vos entités ont des propriétés de clé étrangère et aucun [type complexe](https://msdn.microsoft.com/library/bb738472.aspx), vous pouvez conserver cet attribut défini sur `False`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="e55ec-216">Ne supprimez pas l’attribut du balisage, car la valeur par défaut est `True`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="e55ec-217">Pour plus d’informations, consultez [aplatissement des objets (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span><span class="sxs-lookup"><span data-stu-id="e55ec-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="e55ec-218">Exécutez la page pour afficher la liste des étudiants et des employés (vous allez filtrer uniquement les élèves dans le didacticiel suivant).</span><span class="sxs-lookup"><span data-stu-id="e55ec-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="e55ec-219">Les nom et prénom sont affichés ensemble.</span><span class="sxs-lookup"><span data-stu-id="e55ec-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="e55ec-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="e55ec-221">Pour trier l’affichage, cliquez sur un nom de colonne.</span><span class="sxs-lookup"><span data-stu-id="e55ec-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="e55ec-222">Cliquez sur **modifier** dans une ligne.</span><span class="sxs-lookup"><span data-stu-id="e55ec-222">Click **Edit** in any row.</span></span> <span data-ttu-id="e55ec-223">Les zones de texte s’affichent pour vous permettre de modifier le prénom et le nom.</span><span class="sxs-lookup"><span data-stu-id="e55ec-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="e55ec-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="e55ec-225">Le bouton **supprimer** fonctionne également.</span><span class="sxs-lookup"><span data-stu-id="e55ec-225">The **Delete** button also works.</span></span> <span data-ttu-id="e55ec-226">Cliquez sur supprimer pour une ligne qui a une date d’inscription et la ligne disparaît.</span><span class="sxs-lookup"><span data-stu-id="e55ec-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="e55ec-227">(Les lignes sans date d’inscription représentent des instructeurs et vous pouvez obtenir une erreur d’intégrité référentielle.</span><span class="sxs-lookup"><span data-stu-id="e55ec-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="e55ec-228">Dans le didacticiel suivant, vous allez filtrer cette liste pour inclure uniquement les élèves.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="e55ec-229">Affichage de données à partir d’une propriété de navigation</span><span class="sxs-lookup"><span data-stu-id="e55ec-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="e55ec-230">Supposons à présent que vous souhaitiez connaître le nombre de cours inscrits dans chaque étudiant.</span><span class="sxs-lookup"><span data-stu-id="e55ec-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="e55ec-231">Le Entity Framework fournit ces informations dans la propriété de navigation `StudentGrades` de l’entité `Person`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="e55ec-232">Étant donné que la conception de la base de données n’autorise pas l’inscription d’un étudiant dans un cours sans avoir de catégorie affectée, vous pouvez supposer qu’une ligne dans la ligne de table `StudentGrade` associée à un cours est la même que celle inscrite dans le cours.</span><span class="sxs-lookup"><span data-stu-id="e55ec-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="e55ec-233">(La propriété de navigation `Courses` est uniquement pour les formateurs.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="e55ec-234">Lorsque vous utilisez l’attribut `ContextTypeName` du contrôle `EntityDataSource`, le Entity Framework récupère automatiquement les informations d’une propriété de navigation lorsque vous accédez à cette propriété.</span><span class="sxs-lookup"><span data-stu-id="e55ec-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="e55ec-235">C’est ce que l’on appelle le *chargement différé*.</span><span class="sxs-lookup"><span data-stu-id="e55ec-235">This is called *lazy loading*.</span></span> <span data-ttu-id="e55ec-236">Toutefois, cela peut être inefficace, car cela entraîne un appel séparé à la base de données chaque fois que des informations supplémentaires sont nécessaires.</span><span class="sxs-lookup"><span data-stu-id="e55ec-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="e55ec-237">Si vous avez besoin de données de la propriété de navigation pour chaque entité retournée par le contrôle `EntityDataSource`, il est plus efficace d’extraire les données associées avec l’entité elle-même dans un seul appel à la base de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="e55ec-238">C’est ce que l’on appelle le *chargement hâtif*et vous spécifiez un chargement hâtif pour une propriété de navigation en définissant la propriété `Include` du contrôle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="e55ec-239">Dans *students. aspx*, vous souhaitez afficher le nombre de cours pour chaque étudiant. par conséquent, le chargement hâtif est le meilleur choix.</span><span class="sxs-lookup"><span data-stu-id="e55ec-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="e55ec-240">Si vous affichiez tous les élèves, mais que vous affichez le nombre de cours uniquement pour certains d’entre eux (ce qui nécessiterait l’écriture de code en plus du balisage), le chargement différé peut être un meilleur choix.</span><span class="sxs-lookup"><span data-stu-id="e55ec-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="e55ec-241">Ouvrez ou basculez vers *students. aspx*, basculez en mode **conception** , sélectionnez `StudentsEntityDataSource`, puis dans la fenêtre **Propriétés** , affectez à la propriété **inclure** la valeur **StudentGrades**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="e55ec-242">(Si vous souhaitez obtenir plusieurs propriétés de navigation, vous pouvez spécifier leurs noms séparés par des virgules, par exemple **StudentGrades, courses**.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="e55ec-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="e55ec-244">Basculez en mode **source** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-244">Switch to **Source** view.</span></span> <span data-ttu-id="e55ec-245">Dans le contrôle `StudentsGridView`, après le dernier élément `asp:TemplateField`, ajoutez le nouveau champ de modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="e55ec-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="e55ec-246">Dans l’expression `Eval`, vous pouvez référencer la propriété de navigation `StudentGrades`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="e55ec-247">Étant donné que cette propriété contient une collection, elle a une propriété `Count` que vous pouvez utiliser pour afficher le nombre de cours dans lesquels l’étudiant est inscrit.</span><span class="sxs-lookup"><span data-stu-id="e55ec-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="e55ec-248">Dans un didacticiel ultérieur, vous verrez comment afficher des données de propriétés de navigation qui contiennent des entités uniques au lieu de collections.</span><span class="sxs-lookup"><span data-stu-id="e55ec-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="e55ec-249">(Notez que vous ne pouvez pas utiliser `BoundField` éléments pour afficher des données à partir des propriétés de navigation.)</span><span class="sxs-lookup"><span data-stu-id="e55ec-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="e55ec-250">Exécutez la page pour voir le nombre de cours inscrits dans chaque étudiant.</span><span class="sxs-lookup"><span data-stu-id="e55ec-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="e55ec-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="e55ec-252">Utilisation d’un contrôle DetailsView pour insérer des entités</span><span class="sxs-lookup"><span data-stu-id="e55ec-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="e55ec-253">L’étape suivante consiste à créer une page qui possède un contrôle `DetailsView` qui vous permet d’ajouter de nouveaux élèves.</span><span class="sxs-lookup"><span data-stu-id="e55ec-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="e55ec-254">Fermez le navigateur, puis créez une nouvelle page Web à l’aide de la page maître *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="e55ec-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="e55ec-255">Nommez la page *StudentsAdd. aspx*, puis basculez en mode **source** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="e55ec-256">Ajoutez le balisage suivant pour remplacer le balisage existant pour le contrôle `Content` nommé `Content2`:</span><span class="sxs-lookup"><span data-stu-id="e55ec-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="e55ec-257">Ce balisage crée un contrôle `EntityDataSource` similaire à celui que vous avez créé dans *students. aspx*, sauf qu’il permet l’insertion.</span><span class="sxs-lookup"><span data-stu-id="e55ec-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="e55ec-258">Comme avec le contrôle `GridView`, les champs liés du contrôle `DetailsView` sont codés exactement comme s’il s’agissait d’un contrôle de données qui se connecte directement à une base de données, sauf qu’ils font référence à des propriétés d’entité.</span><span class="sxs-lookup"><span data-stu-id="e55ec-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="e55ec-259">Dans ce cas, le contrôle de `DetailsView` est utilisé uniquement pour l’insertion de lignes. vous avez donc défini le mode par défaut sur `Insert`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="e55ec-260">Exécutez la page et ajoutez un nouvel étudiant.</span><span class="sxs-lookup"><span data-stu-id="e55ec-260">Run the page and add a new student.</span></span>

<span data-ttu-id="e55ec-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="e55ec-262">Rien ne se produit après l’insertion d’un nouvel étudiant, mais si vous exécutez maintenant *students. aspx*, vous verrez les nouvelles informations sur les étudiants.</span><span class="sxs-lookup"><span data-stu-id="e55ec-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="e55ec-263">Affichage des données dans une liste déroulante</span><span class="sxs-lookup"><span data-stu-id="e55ec-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="e55ec-264">Dans les étapes suivantes, vous allez lier un contrôle `DropDownList` à un jeu d’entités à l’aide d’un contrôle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="e55ec-265">Dans cette partie du didacticiel, vous ne faites pas grand-chose dans cette liste.</span><span class="sxs-lookup"><span data-stu-id="e55ec-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="e55ec-266">Dans les parties suivantes, toutefois, vous allez utiliser la liste pour permettre aux utilisateurs de sélectionner un service afin d’afficher les cours associés au service.</span><span class="sxs-lookup"><span data-stu-id="e55ec-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="e55ec-267">Créez une nouvelle page Web nommée *courses. aspx*.</span><span class="sxs-lookup"><span data-stu-id="e55ec-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="e55ec-268">En mode **source** , ajoutez un en-tête au contrôle `Content` nommé `Content2`:</span><span class="sxs-lookup"><span data-stu-id="e55ec-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="e55ec-269">En mode **Design** , ajoutez un contrôle `EntityDataSource` à la page comme vous l’avez fait précédemment, à l’exception de ce nom d’heure `DepartmentsEntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="e55ec-270">Sélectionnez **Departments** comme valeur **EntitySetName** , puis sélectionnez uniquement les propriétés **DepartmentID** et **Name** .</span><span class="sxs-lookup"><span data-stu-id="e55ec-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="e55ec-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="e55ec-272">À partir de l’onglet **standard** de la **boîte à outils**, faites glisser un contrôle `DropDownList` sur la page, nommez-le `DepartmentsDropDownList`, cliquez sur la balise active, puis sélectionnez **choisir la source de données** pour démarrer l' **Assistant Configuration**de source de données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="e55ec-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="e55ec-274">Dans l’étape **choisir une source de données** , sélectionnez **DepartmentsEntityDataSource** comme source de données, cliquez sur **Actualiser le schéma**, puis sélectionnez **nom** comme champ de données à afficher et **DepartmentID** comme champ de données de la valeur.</span><span class="sxs-lookup"><span data-stu-id="e55ec-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="e55ec-275">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="e55ec-275">Click **OK**.</span></span>

<span data-ttu-id="e55ec-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="e55ec-277">La méthode que vous utilisez pour lier le contrôle à l’aide de l’Entity Framework est identique à celle des autres contrôles de source de données ASP.NET, à ceci près que vous spécifiez des entités et des propriétés d’entité.</span><span class="sxs-lookup"><span data-stu-id="e55ec-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="e55ec-278">Basculez en mode **source** et ajoutez « sélectionner un département : » immédiatement avant le contrôle `DropDownList`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="e55ec-279">En guise de rappel, modifiez la balise du contrôle `EntityDataSource` à ce stade en remplaçant les attributs `ConnectionString` et `DefaultContainerName` par un attribut `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="e55ec-280">Il est souvent préférable d’attendre une fois que vous avez créé le contrôle lié aux données qui est lié au contrôle de source de données avant de modifier le balisage de contrôle `EntityDataSource`, car une fois que vous avez apporté la modification, le concepteur ne vous fournit pas une option **Actualiser le schéma** dans le contrôle lié aux données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="e55ec-281">Exécutez la page et sélectionnez un service dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="e55ec-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="e55ec-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="e55ec-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="e55ec-283">Cela termine l’introduction à l’utilisation du contrôle `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e55ec-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="e55ec-284">L’utilisation de ce contrôle n’est généralement pas différente de celle des autres contrôles de source de données ASP.NET, à ceci près que vous référencez des entités et des propriétés au lieu de tables et de colonnes.</span><span class="sxs-lookup"><span data-stu-id="e55ec-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="e55ec-285">La seule exception est lorsque vous souhaitez accéder aux propriétés de navigation.</span><span class="sxs-lookup"><span data-stu-id="e55ec-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="e55ec-286">Dans le didacticiel suivant, vous verrez que la syntaxe que vous utilisez avec `EntityDataSource` contrôle peut également différer des autres contrôles de source de données lorsque vous filtrez, regroupez et commandez des données.</span><span class="sxs-lookup"><span data-stu-id="e55ec-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e55ec-287">[Précédent](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [Suivant](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="e55ec-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
