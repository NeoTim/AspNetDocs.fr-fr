---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
title: 'Déploiement d’une application Web ASP.NET avec SQL Server Compact à l’aide de Visual Studio ou Visual Web Developer : migration vers SQL Server-10 sur 12 | Microsoft Docs'
author: tdykstra
description: Cette série de didacticiels vous montre comment déployer (publier) un projet d’application Web ASP.NET qui comprend une base de données SQL Server Compact à l’aide de Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: a89d6f32-b71b-4036-8ff7-5f8ac2a6eca8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12
msc.type: authoredcontent
ms.openlocfilehash: c5281a42596d95e725b32e652c75785abe0fd64e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78573464"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-migrating-to-sql-server---10-of-12"></a><span data-ttu-id="5b4f0-103">Déploiement d’une application Web ASP.NET avec SQL Server Compact à l’aide de Visual Studio ou Visual Web Developer : migration vers SQL Server-10 sur 12</span><span class="sxs-lookup"><span data-stu-id="5b4f0-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Migrating to SQL Server - 10 of 12</span></span>

<span data-ttu-id="5b4f0-104">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="5b4f0-105">Télécharger le projet de démarrage</span><span class="sxs-lookup"><span data-stu-id="5b4f0-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="5b4f0-106">Cette série de didacticiels vous montre comment déployer (publier) un projet d’application Web ASP.NET qui comprend une base de données SQL Server Compact à l’aide de Visual Studio 2012 RC ou Visual Studio Express 2012 RC pour le Web.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="5b4f0-107">Vous pouvez également utiliser Visual Studio 2010 si vous installez la mise à jour de publication Web.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="5b4f0-108">Pour obtenir une présentation de la série, consultez [le premier didacticiel de la série](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="5b4f0-109">Pour obtenir un didacticiel qui présente les fonctionnalités de déploiement introduites après la version RC de Visual Studio 2012, montre comment déployer des éditions SQL Server autres que SQL Server Compact et montre comment déployer vers Azure App Service Web Apps, consultez [déploiement Web ASP.net à l’aide de Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="5b4f0-110">Présentation</span><span class="sxs-lookup"><span data-stu-id="5b4f0-110">Overview</span></span>

<span data-ttu-id="5b4f0-111">Ce didacticiel vous montre comment effectuer une migration de SQL Server Compact vers SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-111">This tutorial shows you how to migrate from SQL Server Compact to SQL Server.</span></span> <span data-ttu-id="5b4f0-112">Cela peut être utile pour tirer parti des fonctionnalités de SQL Server que SQL Server Compact ne prend pas en charge, telles que les procédures stockées, les déclencheurs, les vues ou la réplication.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-112">One reason you might want to do that is to take advantage of SQL Server features that SQL Server Compact does not support, such as stored procedures, triggers, views, or replication.</span></span> <span data-ttu-id="5b4f0-113">Pour plus d’informations sur les différences entre les SQL Server Compact et les SQL Server, consultez le didacticiel sur le [déploiement de SQL Server Compact](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md) .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-113">For more information about the differences between SQL Server Compact and SQL Server, see the [Deploying SQL Server Compact](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12.md) tutorial.</span></span>

### <a name="sql-server-express-versus-full-sql-server-for-development"></a><span data-ttu-id="5b4f0-114">SQL Server Express et SQL Server complet pour le développement</span><span class="sxs-lookup"><span data-stu-id="5b4f0-114">SQL Server Express versus full SQL Server for Development</span></span>

<span data-ttu-id="5b4f0-115">Une fois que vous avez décidé de mettre à niveau vers SQL Server, vous souhaiterez peut-être utiliser SQL Server ou SQL Server Express dans vos environnements de développement et de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-115">Once you've decided to upgrade to SQL Server, you might want to use SQL Server or SQL Server Express in your development and test environments.</span></span> <span data-ttu-id="5b4f0-116">Outre les différences de prise en charge des outils et dans les fonctionnalités du moteur de base de données, il existe des différences entre les implémentations de fournisseur entre SQL Server Compact et d’autres versions de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-116">In addition to the differences in tool support and in database engine features, there are differences in provider implementations between SQL Server Compact and other versions of SQL Server.</span></span> <span data-ttu-id="5b4f0-117">Ces différences peuvent entraîner un même code pour générer des résultats différents.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-117">These differences can cause the same code to generate different results.</span></span> <span data-ttu-id="5b4f0-118">Par conséquent, si vous décidez de conserver SQL Server Compact comme base de données de développement, vous devez tester minutieusement votre site dans SQL Server ou SQL Server Express dans un environnement de test avant chaque déploiement en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-118">Therefore, if you decide to keep SQL Server Compact as your development database, you should thoroughly test your site in SQL Server or SQL Server Express in a test environment before each deployment to production.</span></span>

<span data-ttu-id="5b4f0-119">Contrairement à SQL Server Compact, SQL Server Express est essentiellement le même moteur de base de données et utilise le même fournisseur .NET que le SQL Server complet.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-119">Unlike SQL Server Compact, SQL Server Express is essentially the same database engine and uses the same .NET provider as full SQL Server.</span></span> <span data-ttu-id="5b4f0-120">Lorsque vous testez avec SQL Server Express, vous pouvez être certain d’obtenir les mêmes résultats que dans le cadre d’SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-120">When you test with SQL Server Express, you can be confident of getting the same results as you will with SQL Server.</span></span> <span data-ttu-id="5b4f0-121">Vous pouvez utiliser la plupart des mêmes outils de base de données avec des SQL Server Express que vous pouvez utiliser avec SQL Server (une exception notable [SQL Server Profiler](https://msdn.microsoft.com/library/ms181091.aspx)) et il prend en charge d’autres fonctionnalités de SQL Server comme les procédures stockées, les vues, les déclencheurs et la réplication.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-121">You can use most of the same database tools with SQL Server Express that you can use with SQL Server (a notable exception being [SQL Server Profiler](https://msdn.microsoft.com/library/ms181091.aspx)), and it supports other features of SQL Server like stored procedures, views, triggers, and replication.</span></span> <span data-ttu-id="5b4f0-122">(En général, vous devez utiliser la SQL Server complète sur un site Web de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-122">(You typically have to use full SQL Server in a production website, however.</span></span> <span data-ttu-id="5b4f0-123">SQL Server Express peut s’exécuter dans un environnement d’hébergement partagé, mais il n’a pas été conçu pour cela, et de nombreux fournisseurs d’hébergement ne le prennent pas en charge.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-123">SQL Server Express can run in a shared hosting environment, but it was not designed for that, and many hosting providers do not support it.)</span></span>

<span data-ttu-id="5b4f0-124">Si vous utilisez Visual Studio 2012, vous choisissez généralement SQL Server Express base de données locale pour votre environnement de développement, car c’est ce qui est installé par défaut dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-124">If you are using Visual Studio 2012, you typically choose SQL Server Express LocalDB for your development environment because that is what is installed by default with Visual Studio.</span></span> <span data-ttu-id="5b4f0-125">Toutefois, la base de données locale ne fonctionne pas dans IIS. par conséquent, pour votre environnement de test, vous devez utiliser SQL Server ou SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-125">However, LocalDB does not work in IIS, so for your test environment you have to use either SQL Server or SQL Server Express.</span></span>

### <a name="combining-databases-versus-keeping-them-separate"></a><span data-ttu-id="5b4f0-126">Combiner les bases de données et les conserver séparées</span><span class="sxs-lookup"><span data-stu-id="5b4f0-126">Combining Databases versus Keeping Them Separate</span></span>

<span data-ttu-id="5b4f0-127">L’application Contoso University dispose de deux bases de données SQL Server Compact : la base de données d’appartenance (*Aspnet. sdf*) et la base de données d’application (*School. sdf*).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-127">The Contoso University application has two SQL Server Compact databases: the membership database (*aspnet.sdf*) and the application database (*School.sdf*).</span></span> <span data-ttu-id="5b4f0-128">Lorsque vous migrez, vous pouvez migrer ces bases de données vers deux bases de données distinctes ou vers une base de données unique.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-128">When you migrate, you can migrate these databases to two separate databases or to a single database.</span></span> <span data-ttu-id="5b4f0-129">Vous pouvez les combiner pour faciliter les jointures de base de données entre votre base de données d’application et votre base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-129">You might want to combine them in order to facilitate database joins between your application database and your membership database.</span></span> <span data-ttu-id="5b4f0-130">Votre plan d’hébergement peut également fournir une raison pour les combiner.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-130">Your hosting plan might also provide a reason to combine them.</span></span> <span data-ttu-id="5b4f0-131">Par exemple, le fournisseur d’hébergement peut être facturé pour plusieurs bases de données ou même autoriser plusieurs bases de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-131">For example, the hosting provider might charge more for multiple databases or might not even allow more than one database.</span></span> <span data-ttu-id="5b4f0-132">C’est le cas avec le compte d’hébergement Cytanium Lite utilisé pour ce didacticiel, qui n’autorise qu’une seule base de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-132">That's the case with the Cytanium Lite hosting account that's used for this tutorial, which allows only a single SQL Server database.</span></span>

<span data-ttu-id="5b4f0-133">Dans ce didacticiel, vous allez migrer vos deux bases de données de cette façon :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-133">In this tutorial, you'll migrate your two databases this way:</span></span>

- <span data-ttu-id="5b4f0-134">Migrez vers deux bases de données de base de données locale dans l’environnement de développement.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-134">Migrate to two LocalDB databases in the development environment.</span></span>
- <span data-ttu-id="5b4f0-135">Migrer vers deux bases de données de SQL Server Express dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-135">Migrate to two SQL Server Express databases in the test environment.</span></span>
- <span data-ttu-id="5b4f0-136">Migrer vers une base de données SQL Server complète combinée dans l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-136">Migrate to one combined full SQL Server database in the production environment.</span></span>

<span data-ttu-id="5b4f0-137">Rappel : Si vous recevez un message d’erreur ou si une action ne fonctionne pas au fur et à mesure que vous parcourez le didacticiel, veillez à consulter la [page de résolution des problèmes](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-137">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="installing-sql-server-express"></a><span data-ttu-id="5b4f0-138">Installation de SQL Server Express</span><span class="sxs-lookup"><span data-stu-id="5b4f0-138">Installing SQL Server Express</span></span>

<span data-ttu-id="5b4f0-139">SQL Server Express est automatiquement installé par défaut avec Visual Studio 2010, mais par défaut, il n’est pas installé avec Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-139">SQL Server Express is automatically installed by default with Visual Studio 2010, but by default it is not installed with Visual Studio 2012.</span></span> <span data-ttu-id="5b4f0-140">Pour installer SQL Server 2012 Express, cliquez sur le lien suivant.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-140">To install SQL Server 2012 Express, click the following link</span></span>

- [<span data-ttu-id="5b4f0-141">SQL Server Express 2012</span><span class="sxs-lookup"><span data-stu-id="5b4f0-141">SQL Server Express 2012</span></span>](https://www.microsoft.com/download/details.aspx?id=29062)

<span data-ttu-id="5b4f0-142">Choisissez *fra/x64/SQLEXPR\_x64\_fra. exe* ou *fra/x86/SQLEXPR\_x86\_fra. exe*, et dans l’Assistant Installation, acceptez les paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-142">Choose *ENU/x64/SQLEXPR\_x64\_ENU.exe* or *ENU/x86/SQLEXPR\_x86\_ENU.exe*, and in the installation wizard accept the default settings.</span></span> <span data-ttu-id="5b4f0-143">Pour plus d’informations sur les options d’installation, consultez [installer SQL Server 2012 à partir de l’Assistant Installation (programme d’installation)](https://msdn.microsoft.com/library/ms143219.aspx).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-143">For more information about installation options, see [Install SQL Server 2012 from the Installation Wizard (Setup)](https://msdn.microsoft.com/library/ms143219.aspx).</span></span>

## <a name="creating-sql-server-express-databases-for-the-test-environment"></a><span data-ttu-id="5b4f0-144">Création de bases de données SQL Server Express pour l’environnement de test</span><span class="sxs-lookup"><span data-stu-id="5b4f0-144">Creating SQL Server Express Databases for the Test Environment</span></span>

<span data-ttu-id="5b4f0-145">L’étape suivante consiste à créer les bases de données d’appartenance ASP.NET et School.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-145">The next step is to create the ASP.NET membership and School databases.</span></span>

<span data-ttu-id="5b4f0-146">Dans le **menu Affichage** , sélectionnez **Explorateur de serveurs** (**Explorateur de base de données** dans Visual Web Developer), puis cliquez avec le bouton droit sur **connexions de données** et sélectionnez créer une **nouvelle base de données SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-146">From the **View** menu select **Server Explorer** (**Database Explorer** in Visual Web Developer), and then right-click **Data Connections** and select **Create New SQL Server Database**.</span></span>

![Selecting_Create_New_SQL_Server_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image1.png)

<span data-ttu-id="5b4f0-148">Dans la boîte **de dialogue créer une nouvelle base de données SQL Server** , entrez « .\SQLEXPRESS » dans la zone **nom du serveur** et « ASPNET-test » dans la zone **nom de la nouvelle base de données** , puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-148">In the **Create New SQL Server Database** dialog box, enter ".\SQLExpress" in the **Server name** box and "aspnet-Test" in the **New database name** box, then click **OK**.</span></span>

![Create_New_SQL_Server_Database_aspnet](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image2.png)

<span data-ttu-id="5b4f0-150">Suivez la même procédure pour créer une nouvelle base de données SQL Server Express School nommée « School-test ».</span><span class="sxs-lookup"><span data-stu-id="5b4f0-150">Follow the same procedure to create a new SQL Server Express School database named "School-Test".</span></span>

<span data-ttu-id="5b4f0-151">(Vous ajoutez « test » à ces noms de base de données, car ultérieurement, vous créerez une instance supplémentaire de chaque base de données pour l’environnement de développement, et vous devez être en mesure de différencier les deux ensembles de bases de données.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-151">(You're appending "Test" to these database names because later you'll create an additional instance of each database for the development environment, and you need to be able to differentiate the two sets of databases.)</span></span>

<span data-ttu-id="5b4f0-152">**Explorateur de serveurs** affiche à présent les deux nouvelles bases de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-152">**Server Explorer** now shows the two new databases.</span></span>

![New_databases_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image3.png)

## <a name="creating-a-grant-script-for-the-new-databases"></a><span data-ttu-id="5b4f0-154">Création d’un script Grant pour les nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="5b4f0-154">Creating a Grant Script for the New Databases</span></span>

<span data-ttu-id="5b4f0-155">Lorsque l’application s’exécute dans IIS sur votre ordinateur de développement, l’application accède à la base de données à l’aide des informations d’identification du pool d’applications par défaut.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-155">When the application runs in IIS on your development computer, the application accesses the database by using the default application pool's credentials.</span></span> <span data-ttu-id="5b4f0-156">Toutefois, par défaut, l’identité du pool d’applications n’a pas l’autorisation d’ouvrir les bases de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-156">However, by default, the application pool identity does not have permission to open the databases.</span></span> <span data-ttu-id="5b4f0-157">Vous devez donc exécuter un script pour accorder cette autorisation.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-157">So you have to run a script to grant that permission.</span></span> <span data-ttu-id="5b4f0-158">Dans cette section, vous allez créer le script que vous exécuterez ultérieurement pour vous assurer que l’application peut ouvrir les bases de données lorsqu’elle s’exécute dans IIS.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-158">In this section you create the script that you'll run later to make sure that the application can open the databases when it runs in IIS.</span></span>

<span data-ttu-id="5b4f0-159">Dans le dossier *SolutionFiles* de la solution que vous avez créé dans le didacticiel [déploiement dans l’environnement de production](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) , créez un nouveau fichier SQL nommé *Grant. SQL*.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-159">In the solution's *SolutionFiles* folder that you created in the [Deploying to the Production Environment](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) tutorial, create a new SQL file named *Grant.sql*.</span></span> <span data-ttu-id="5b4f0-160">Copiez les commandes SQL suivantes dans le fichier, puis enregistrez et fermez le fichier :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-160">Copy the following SQL commands into the file, and then save and close the file:</span></span>

[!code-sql[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample1.sql)]

> [!NOTE]
> <span data-ttu-id="5b4f0-161">Ce script est conçu pour fonctionner avec SQL Server 2008 et avec les paramètres IIS dans Windows 7 tels qu’ils sont spécifiés dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-161">This script is designed to work with SQL Server 2008 and with the IIS settings in Windows 7 as they are specified in this tutorial.</span></span> <span data-ttu-id="5b4f0-162">Si vous utilisez une autre version de SQL Server ou de Windows, ou si vous configurez les services IIS sur votre ordinateur différemment, les modifications apportées à ce script peuvent être nécessaires.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-162">If you're using a different version of SQL Server or of Windows, or if you set up IIS on your computer differently, changes to this script might be required.</span></span> <span data-ttu-id="5b4f0-163">Pour plus d’informations sur les scripts SQL Server, consultez [documentation en ligne de SQL Server](https://go.microsoft.com/fwlink/?LinkId=132511).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-163">For more information about SQL Server scripts, see [SQL Server Books Online](https://go.microsoft.com/fwlink/?LinkId=132511).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="5b4f0-164">**Note de sécurité** Ce script donne aux utilisateurs de base de données\_autorisations de propriétaire l’accès à la base de données au moment de l’exécution, ce que vous aurez dans l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-164">**Security Note** This script gives db\_owner permissions to the user that accesses the database at run time, which is what you'll have in the production environment.</span></span> <span data-ttu-id="5b4f0-165">Dans certains scénarios, vous souhaiterez peut-être spécifier un utilisateur qui dispose d’autorisations de mise à jour complète du schéma de base de données uniquement pour le déploiement, et spécifier pour l’exécution un autre utilisateur disposant d’autorisations uniquement pour lire et écrire des données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-165">In some scenarios you might want to specify a user that has full database schema update permissions only for deployment, and specify for run time a different user that has permissions only to read and write data.</span></span> <span data-ttu-id="5b4f0-166">Pour plus d’informations, consultez **examen des modifications automatiques de Web. config pour migrations code First** dans [déploiement sur IIS en tant qu’environnement de test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-166">For more information, see **Reviewing the Automatic Web.config Changes for Code First Migrations** in [Deploying to IIS as a Test Environment](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md).</span></span>

## <a name="configuring-database-deployment-for-the-test-environment"></a><span data-ttu-id="5b4f0-167">Configuration du déploiement de base de données pour l’environnement de test</span><span class="sxs-lookup"><span data-stu-id="5b4f0-167">Configuring Database Deployment for the Test Environment</span></span>

<span data-ttu-id="5b4f0-168">Ensuite, vous allez configurer Visual Studio pour qu’il effectue les tâches suivantes pour chaque base de données :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-168">Next, you'll configure Visual Studio so that it will do the following tasks for each database:</span></span>

- <span data-ttu-id="5b4f0-169">Générez un script SQL qui crée la structure de la base de données source (tables, colonnes, contraintes, etc.) dans la base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-169">Generate a SQL script that creates the source database's structure (tables, columns, constraints, etc.) in the destination database.</span></span>
- <span data-ttu-id="5b4f0-170">Générez un script SQL qui insère les données de la base de données source dans les tables de la base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-170">Generate a SQL script that inserts the source database's data into the tables in the destination database.</span></span>
- <span data-ttu-id="5b4f0-171">Exécutez les scripts générés et le script Grant que vous avez créé dans la base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-171">Run the generated scripts, and the Grant script that you created, in the destination database.</span></span>

<span data-ttu-id="5b4f0-172">Ouvrez la fenêtre **Propriétés du projet** et sélectionnez l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-172">Open the **Project Properties** window and select the **Package/Publish SQL** tab.</span></span>

<span data-ttu-id="5b4f0-173">Assurez-vous que l’option **active (Release)** ou **Release** est sélectionnée dans la liste déroulante **configuration** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-173">Make sure that **Active (Release)** or **Release** is selected in the **Configuration** drop-down list.</span></span>

<span data-ttu-id="5b4f0-174">Cliquez sur **activer cette page**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-174">Click **Enable this Page**.</span></span>

![Package_Publish_SQL_tab_Enable_This_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image4.png)

<span data-ttu-id="5b4f0-176">L’onglet **Package/Publication SQL** est normalement désactivé, car il spécifie une méthode de déploiement héritée.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-176">The **Package/Publish SQL** tab is normally disabled because it specifies a legacy deployment method.</span></span> <span data-ttu-id="5b4f0-177">Pour la plupart des scénarios, vous devez configurer le déploiement de la base de données dans l’Assistant **publier le site Web** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-177">For most scenarios, you should configure database deployment in the **Publish Web** wizard.</span></span> <span data-ttu-id="5b4f0-178">La migration à partir de SQL Server Compact vers SQL Server ou SQL Server Express est un cas particulier pour lequel cette méthode est un bon choix.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-178">Migrating from SQL Server Compact to SQL Server or SQL Server Express is a special case for which this method is a good choice.</span></span>

<span data-ttu-id="5b4f0-179">Cliquez sur **Importer à partir de Web. config**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-179">Click **Import from Web.config**.</span></span>

![Selecting_Import_from_Web.config](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image5.png)

<span data-ttu-id="5b4f0-181">Visual Studio recherche des chaînes de connexion dans le fichier *Web. config* , en trouve un pour la base de données d’appartenance et une pour la base de données School, et ajoute une ligne correspondant à chaque chaîne de connexion dans le tableau **entrées de la base de données** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-181">Visual Studio looks for connection strings in the *Web.config* file, finds one for the membership database and one for the School database, and adds a row corresponding to each connection string in the **Database Entries** table.</span></span> <span data-ttu-id="5b4f0-182">Les chaînes de connexion qu’il trouve correspondent aux bases de données SQL Server Compact existantes, et l’étape suivante consiste à configurer le mode et l’emplacement de déploiement de ces bases de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-182">The connection strings it finds are for the existing SQL Server Compact databases, and your next step will be to configure how and where to deploy these databases.</span></span>

<span data-ttu-id="5b4f0-183">Vous entrez les paramètres de déploiement de base de données dans la section **Détails de l’entrée de base** de données sous le tableau **entrées de base de** données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-183">You enter database deployment settings in the **Database Entry Details** section below the **Database Entries** table.</span></span> <span data-ttu-id="5b4f0-184">Les paramètres affichés dans la section **Détails de l’entrée de base de données** se rapportent à la ligne de la table **entrées de la base de** données qui est sélectionnée, comme indiqué dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-184">The settings shown in the **Database Entry Details** section pertain to whichever row in the **Database Entries** table is selected, as shown in the following illustration.</span></span>

![Database_Entry_Details_section_of_Package_Publish_SQL_tab](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image6.png)

### <a name="configuring-deployment-settings-for-the-membership-database"></a><span data-ttu-id="5b4f0-186">Configuration des paramètres de déploiement pour la base de données d’appartenance</span><span class="sxs-lookup"><span data-stu-id="5b4f0-186">Configuring Deployment Settings for the Membership Database</span></span>

<span data-ttu-id="5b4f0-187">Sélectionnez la ligne **DefaultConnection-Deployment** dans le tableau **entrées de la base de données** afin de configurer les paramètres qui s’appliquent à la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-187">Select the **DefaultConnection-Deployment** row in the **Database Entries** table in order to configure settings that apply to the membership database.</span></span>

<span data-ttu-id="5b4f0-188">Dans **chaîne de connexion de la base de données de destination**, entrez une chaîne de connexion qui pointe vers la nouvelle base de données d’appartenance SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-188">In **Connection string for destination database**, enter a connection string that points to the new SQL Server Express membership database.</span></span> <span data-ttu-id="5b4f0-189">Vous pouvez récupérer la chaîne de connexion dont vous avez besoin à partir de **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-189">You can get the connection string you need from **Server Explorer**.</span></span> <span data-ttu-id="5b4f0-190">Dans **Explorateur de serveurs**, développez **connexions de données** , sélectionnez la base de données **aspnetTest** , puis dans la fenêtre **Propriétés** , copiez la valeur de la **chaîne de connexion** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-190">In **Server Explorer**, expand **Data Connections** and select the **aspnetTest** database, then from the **Properties** window copy the **Connection String** value.</span></span>

![aspnet_connection_string_in_Server_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image7.png)

<span data-ttu-id="5b4f0-192">La même chaîne de connexion est reproduite ici :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-192">The same connection string is reproduced here:</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample2.cmd)]

<span data-ttu-id="5b4f0-193">Copiez et collez cette chaîne de connexion dans la chaîne de connexion de la **base de données de destination** dans l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-193">Copy and paste this connection string into **Connection string for destination database** in the **Package/Publish SQL** tab.</span></span>

<span data-ttu-id="5b4f0-194">Assurez-vous que **les données d’extraction et/ou le schéma d’une base de données existante** sont sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-194">Make sure that **Pull data and/or schema from an existing database** is selected.</span></span> <span data-ttu-id="5b4f0-195">C’est ainsi que les scripts SQL sont automatiquement générés et exécutés dans la base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-195">This is what causes SQL scripts to be automatically generated and run in the destination database.</span></span>

<span data-ttu-id="5b4f0-196">La **chaîne de connexion pour la valeur de la base de données source** est extraite du fichier *Web. config* et pointe vers la base de données de développement SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-196">The **Connection string for the source database** value is extracted from the *Web.config* file and points to the development SQL Server Compact database.</span></span> <span data-ttu-id="5b4f0-197">Il s’agit de la base de données source qui sera utilisée pour générer les scripts qui s’exécuteront ultérieurement dans la base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-197">This is the source database that will be used to generate the scripts that will run later in the destination database.</span></span> <span data-ttu-id="5b4f0-198">Étant donné que vous souhaitez déployer la version de production de la base de données, remplacez « aspnet-Dev. sdf » par « aspnet-Prod. sdf ».</span><span class="sxs-lookup"><span data-stu-id="5b4f0-198">Since you want to deploy the production version of the database, change "aspnet-Dev.sdf" to "aspnet-Prod.sdf".</span></span>

<span data-ttu-id="5b4f0-199">Modifiez les **options de script de base de données** du **schéma uniquement** en **schéma et données**, car vous souhaitez copier vos données (comptes d’utilisateur et rôles), ainsi que la structure de la base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-199">Change **Database scripting options** from **Schema Only** to **Schema and data**, since you want to copy your data (user accounts and roles) as well as the database structure.</span></span>

<span data-ttu-id="5b4f0-200">Pour configurer le déploiement afin d’exécuter les scripts d’octroi que vous avez créés précédemment, vous devez les ajouter à la section **scripts de base de données** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-200">To configure deployment to run the grant scripts that you created earlier, you have to add them to the **Database Scripts** section.</span></span> <span data-ttu-id="5b4f0-201">Cliquez sur **Ajouter un script**, puis dans la boîte de dialogue Ajouter des **scripts SQL** , accédez au dossier dans lequel vous avez stocké le script Grant (il s’agit du dossier qui contient votre fichier solution).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-201">Click **Add Script**, and in the **Add SQL Scripts** dialog box, navigate to the folder where you stored the grant script (this is the folder that contains your solution file).</span></span> <span data-ttu-id="5b4f0-202">Sélectionnez le fichier nommé *Grant. SQL*, puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-202">Select the file named *Grant.sql*, and click **Open**.</span></span>

<span data-ttu-id="5b4f0-203">[![Select_File_dialog_box_grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image9.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-203">[![Select_File_dialog_box_grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image9.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image8.png)</span></span>

<span data-ttu-id="5b4f0-204">Les paramètres de la ligne **DefaultConnection-Deployment** des **entrées de base de données** ressemblent maintenant à l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-204">The settings for the **DefaultConnection-Deployment** row in **Database Entries** now look like the following illustration:</span></span>

![Database_Entry_Details_for_DefaultConnection_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image10.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a><span data-ttu-id="5b4f0-206">Configuration des paramètres de déploiement pour la base de données School</span><span class="sxs-lookup"><span data-stu-id="5b4f0-206">Configuring Deployment Settings for the School Database</span></span>

<span data-ttu-id="5b4f0-207">Ensuite, sélectionnez la ligne **SchoolContext-Deployment** dans le tableau **entrées de la base de données** afin de configurer les paramètres de déploiement de la base de données School.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-207">Next, select the **SchoolContext-Deployment** row in the **Database Entries** table in order to configure deployment settings for the School database.</span></span>

<span data-ttu-id="5b4f0-208">Vous pouvez utiliser la même méthode que celle utilisée précédemment pour obtenir la chaîne de connexion pour la nouvelle base de données de SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-208">You can use the same method you used earlier to get the connection string for the new SQL Server Express database.</span></span> <span data-ttu-id="5b4f0-209">Copiez cette chaîne de connexion dans la chaîne de connexion de la **base de données de destination** sous l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-209">Copy this connection string into **Connection string for destination database** in the **Package/Publish SQL** tab.</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample3.cmd)]

<span data-ttu-id="5b4f0-210">Assurez-vous que **les données d’extraction et/ou le schéma d’une base de données existante** sont sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-210">Make sure that **Pull data and/or schema from an existing database** is selected.</span></span>

<span data-ttu-id="5b4f0-211">La **chaîne de connexion pour la valeur de la base de données source** est extraite du fichier *Web. config* et pointe vers la base de données de développement SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-211">The **Connection string for the source database** value is extracted from the *Web.config* file and points to the development SQL Server Compact database.</span></span> <span data-ttu-id="5b4f0-212">Remplacez « School-Dev. sdf » par « School-Prod. sdf » pour déployer la version de production de la base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-212">Change "School-Dev.sdf" to "School-Prod.sdf" to deploy the production version of the database.</span></span> <span data-ttu-id="5b4f0-213">(Vous n’avez jamais créé de fichier School-Prod. sdf dans le dossier de données de l’application\_. vous allez donc copier ce fichier de l’environnement de test vers le dossier de données de l’application\_dans le dossier de projet ContosoUniversity, plus tard.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-213">(You never created a School-Prod.sdf file in the App\_Data folder, so you'll copy that file from the test environment to the App\_Data folder in the ContosoUniversity project folder later.)</span></span>

<span data-ttu-id="5b4f0-214">Modifiez les **options de script de base de données** en **schéma et données**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-214">Change **Database scripting options** to **Schema and data**.</span></span>

<span data-ttu-id="5b4f0-215">Vous souhaitez également exécuter le script pour accorder l’autorisation de lecture et d’écriture pour cette base de données à l’identité du pool d’applications. par conséquent, ajoutez le fichier de script *Grant. SQL* comme vous l’avez fait pour la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-215">You also want to run the script to grant read and write permission for this database to the application pool identity, so add the *Grant.sql* script file as you did for the membership database.</span></span>

<span data-ttu-id="5b4f0-216">Lorsque vous avez terminé, les paramètres de la ligne **SchoolContext-Deployment** des **entrées de base de données** ressemblent à l’illustration suivante :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-216">When you're done, the settings for the **SchoolContext-Deployment** row in **Database Entries** look like the following illustration:</span></span>

![Database_Entry_Details_for_SchoolContext_Test](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image11.png)

<span data-ttu-id="5b4f0-218">Enregistrez les modifications apportées à l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-218">Save the changes to the **Package/Publish SQL** tab.</span></span>

<span data-ttu-id="5b4f0-219">Copiez le fichier *School-prod. sdf* à partir du dossier *c:\inetpub\wwwroot\ContosoUniversity\App\_Data* dans le dossier *application\_Data* du projet ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-219">Copy the *School-Prod.sdf* file from the *c:\inetpub\wwwroot\ContosoUniversity\App\_Data* folder to the *App\_Data* folder in the ContosoUniversity project.</span></span>

### <a name="specifying-transacted-mode-for-the-grant-script"></a><span data-ttu-id="5b4f0-220">Spécification du mode traité pour le script Grant</span><span class="sxs-lookup"><span data-stu-id="5b4f0-220">Specifying Transacted Mode for the Grant Script</span></span>

<span data-ttu-id="5b4f0-221">Le processus de déploiement génère des scripts qui déploient le schéma et les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-221">The deployment process generates scripts that deploy the database schema and data.</span></span> <span data-ttu-id="5b4f0-222">Par défaut, ces scripts s’exécutent dans une transaction.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-222">By default, these scripts run in a transaction.</span></span> <span data-ttu-id="5b4f0-223">Toutefois, les scripts personnalisés (comme les scripts d’octroi) par défaut ne s’exécutent pas dans une transaction.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-223">However, custom scripts (like the grant scripts) by default do not run in a transaction.</span></span> <span data-ttu-id="5b4f0-224">Si le processus de déploiement combine les modes de transaction, vous pouvez obtenir une erreur de délai d’attente lorsque les scripts s’exécutent pendant le déploiement.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-224">If the deployment process mixes transaction modes, you might get a timeout error when the scripts run during deployment.</span></span> <span data-ttu-id="5b4f0-225">Dans cette section, vous allez modifier le fichier projet afin de configurer les scripts personnalisés à exécuter dans une transaction.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-225">In this section, you edit the project file in order to configure the custom scripts to run in a transaction.</span></span>

<span data-ttu-id="5b4f0-226">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet **ContosoUniversity** et sélectionnez **décharger le projet**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-226">In **Solution Explorer**, right-click the **ContosoUniversity** project and select **Unload Project**.</span></span>

![Unload_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image12.png)

<span data-ttu-id="5b4f0-228">Cliquez ensuite avec le bouton droit sur le projet et sélectionnez **modifier ContosoUniversity. csproj**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-228">Then right-click the project again and select **Edit ContosoUniversity.csproj**.</span></span>

![Edit_Project_in_Solution_Explorer](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image13.png)

<span data-ttu-id="5b4f0-230">L’éditeur Visual Studio affiche le contenu XML du fichier projet.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-230">The Visual Studio editor shows you the XML content of the project file.</span></span> <span data-ttu-id="5b4f0-231">Notez qu’il existe plusieurs éléments `PropertyGroup`.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-231">Notice that there are several `PropertyGroup` elements.</span></span> <span data-ttu-id="5b4f0-232">(Dans l’image, le contenu des éléments de `PropertyGroup` a été omis.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-232">(In the image, the contents of the `PropertyGroup` elements have been omitted.)</span></span>

![Fenêtre de l’éditeur du fichier projet](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image15.png)

<span data-ttu-id="5b4f0-234">Le premier, qui n’a pas d’attribut `Condition`, est destiné aux paramètres qui s’appliquent indépendamment de la configuration de Build.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-234">The first one, which has no `Condition` attribute, is for settings that apply regardless of build configuration.</span></span> <span data-ttu-id="5b4f0-235">Un élément `PropertyGroup` s’applique uniquement à la configuration de build debug (Notez l’attribut `Condition`), l’un s’applique uniquement à la configuration de build Release, et l’autre à la configuration de build de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-235">One `PropertyGroup` element applies only to the Debug build configuration (note the `Condition` attribute), one applies only to the Release build configuration, and one applies only to the Test build configuration.</span></span> <span data-ttu-id="5b4f0-236">Dans l’élément `PropertyGroup` de la configuration de build Release, vous verrez un élément `PublishDatabaseSettings` qui contient les paramètres que vous avez entrés dans l’onglet **Package/Publication SQL** . Il existe un élément `Object` qui correspond à chacun des scripts Grant que vous avez spécifiés (Notez les deux instances de « Grant. Sql »).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-236">Within the `PropertyGroup` element for the Release build configuration, you'll see a `PublishDatabaseSettings` element that contains the settings you entered on the **Package/Publish SQL** tab. There is an `Object` element that corresponds to each of the grant scripts you specified (notice the two instances of "Grant.sql").</span></span> <span data-ttu-id="5b4f0-237">Par défaut, l’attribut `Transacted` de l’élément `Source` de chaque script Grant est `False`.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-237">By default, the `Transacted` attribute of the `Source` element for each grant script is `False`.</span></span>

![Transacted_false](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image16.png)

<span data-ttu-id="5b4f0-239">Remplacez la valeur de l’attribut `Transacted` de l’élément `Source` par `True`.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-239">Change the value of the `Transacted` attribute of the `Source` element to `True`.</span></span>

![Transacted_true](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image17.png)

<span data-ttu-id="5b4f0-241">Enregistrez et fermez le fichier projet, puis cliquez avec le bouton droit sur le projet dans **Explorateur de solutions** et sélectionnez **recharger le projet**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-241">Save and close the project file, and then right-click the project in **Solution Explorer** and select **Reload Project**.</span></span>

![Reload_project](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image18.png)

## <a name="setting-up-webconfig-transformations-for-the-connection-strings"></a><span data-ttu-id="5b4f0-243">Configuration des transformations Web. config pour les chaînes de connexion</span><span class="sxs-lookup"><span data-stu-id="5b4f0-243">Setting up Web.Config Transformations for the Connection Strings</span></span>

<span data-ttu-id="5b4f0-244">Les chaînes de connexion pour les nouvelles bases de données SQL Express que vous avez entrées dans l’onglet **Package/Publication SQL** sont utilisées par les Web Deploy uniquement pour la mise à jour de la base de données de destination pendant le déploiement.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-244">The connection strings for the new SQL Express databases that you entered on the **Package/Publish SQL** tab are used by Web Deploy only for updating the destination database during deployment.</span></span> <span data-ttu-id="5b4f0-245">Vous devez toujours configurer des transformations *Web. config* afin que les chaînes de connexion dans le fichier *Web. config* déployé pointent vers les nouvelles bases de données de SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-245">You still have to set up *Web.config* transformations so that the connection strings in the deployed *Web.config* file point to the new SQL Server Express databases.</span></span> <span data-ttu-id="5b4f0-246">(Lorsque vous utilisez l’onglet **Package/Publication SQL** , vous ne pouvez pas configurer les chaînes de connexion dans le profil de publication.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-246">(When you use the **Package/Publish SQL** tab, you can't configure connection strings in the publish profile.)</span></span>

<span data-ttu-id="5b4f0-247">Ouvrez le *fichier Web. test. config* et remplacez l’élément `connectionStrings` par l’élément `connectionStrings` dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-247">Open *Web.Test.config* and replace the `connectionStrings` element with the `connectionStrings` element in the following example.</span></span> <span data-ttu-id="5b4f0-248">(Assurez-vous de copier uniquement l’élément connectionStrings, et non le code environnant qui est indiqué ici pour fournir le contexte.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-248">(Make sure you only copy the connectionStrings element, not the surrounding code that is shown here to provide context.)</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample4.xml?highlight=2-11)]

<span data-ttu-id="5b4f0-249">Ce code entraîne le remplacement des attributs `connectionString` et `providerName` de chaque élément `add` dans le fichier *Web. config* déployé.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-249">This code causes the `connectionString` and `providerName` attributes of each `add` element to be replaced in the deployed *Web.config* file.</span></span> <span data-ttu-id="5b4f0-250">Ces chaînes de connexion ne sont pas identiques à celles que vous avez entrées dans l’onglet **Package/Publication SQL** . Le paramètre « MultipleActiveResultSets = true » a été ajouté, car il est requis pour le Entity Framework et le Fournisseurs universels.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-250">These connection strings are not identical to the ones you entered in the **Package/Publish SQL** tab. The setting "MultipleActiveResultSets=True" has been added to them because it's required for the Entity Framework and the Universal Providers.</span></span>

## <a name="installing-sql-server-compact"></a><span data-ttu-id="5b4f0-251">Installation de SQL Server Compact</span><span class="sxs-lookup"><span data-stu-id="5b4f0-251">Installing SQL Server Compact</span></span>

<span data-ttu-id="5b4f0-252">Le package NuGet SqlServerCompact fournit les assemblys du moteur de base de données SQL Server Compact pour l’application Contoso University.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-252">The SqlServerCompact NuGet package provides the SQL Server Compact database engine assemblies for the Contoso University application.</span></span> <span data-ttu-id="5b4f0-253">Mais maintenant, il ne s’agit pas de l’application, mais Web Deploy qui doit être en mesure de lire les bases de données SQL Server Compact, afin de créer des scripts à exécuter dans les bases de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-253">But now it is not the application but Web Deploy that must be able to read the SQL Server Compact databases, in order to create scripts to run in the SQL Server databases.</span></span> <span data-ttu-id="5b4f0-254">Pour permettre à Web Deploy de lire SQL Server Compact bases de données, installez SQL Server Compact sur l’ordinateur de développement à l’aide du lien suivant : [Microsoft SQL Server Compact 4,0](https://www.microsoft.com/downloads/details.aspx?FamilyID=15F7C9B3-A150-4AD2-823E-E4E0DCF85DF6).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-254">To enable Web Deploy to read SQL Server Compact databases, install SQL Server Compact on the development computer by using the following link: [Microsoft SQL Server Compact 4.0](https://www.microsoft.com/downloads/details.aspx?FamilyID=15F7C9B3-A150-4AD2-823E-E4E0DCF85DF6).</span></span>

## <a name="deploying-to-the-test-environment"></a><span data-ttu-id="5b4f0-255">Déploiement dans l’environnement de test</span><span class="sxs-lookup"><span data-stu-id="5b4f0-255">Deploying to the Test Environment</span></span>

<span data-ttu-id="5b4f0-256">Pour publier dans l’environnement de test, vous devez créer un profil de publication configuré pour utiliser l’onglet **Package/Publication SQL** pour la publication de base de données à la place des paramètres de base de données de profil de publication.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-256">In order to publish to the Test environment, you have to create a publish profile that is configured to use the **Package/Publish SQL** tab for database publishing instead of the publish profile database settings.</span></span>

<span data-ttu-id="5b4f0-257">Tout d’abord, supprimez le profil de test existant.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-257">First, delete the existing Test profile.</span></span>

<span data-ttu-id="5b4f0-258">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity, puis cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-258">In **Solution Explorer**, right-click the ContosoUniversity project, and click **Publish**.</span></span>

<span data-ttu-id="5b4f0-259">Sélectionnez l’onglet **Profil** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-259">Select the **Profile** tab.</span></span>

<span data-ttu-id="5b4f0-260">Cliquez sur **Manage Profiles (Gérer les profils)** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-260">Click **Manage Profiles**.</span></span>

<span data-ttu-id="5b4f0-261">Sélectionnez **test**, cliquez sur **supprimer**, puis sur **Fermer**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-261">Select **Test**, click **Remove**, and then click **Close**.</span></span>

<span data-ttu-id="5b4f0-262">Fermez l’Assistant **publier le site Web** pour enregistrer cette modification.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-262">Close the **Publish Web** wizard to save this change.</span></span>

<span data-ttu-id="5b4f0-263">Ensuite, créez un nouveau profil de test et utilisez-le pour publier le projet.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-263">Next, create a new Test profile and use it to publish the project.</span></span>

<span data-ttu-id="5b4f0-264">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity, puis cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-264">In **Solution Explorer**, right-click the ContosoUniversity project, and click **Publish**.</span></span>

<span data-ttu-id="5b4f0-265">Sélectionnez l’onglet **Profil** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-265">Select the **Profile** tab.</span></span>

<span data-ttu-id="5b4f0-266">Sélectionnez **&lt;nouveau...&gt;** dans la liste déroulante, puis entrez « test » comme nom de profil.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-266">Select **&lt;New...&gt;** from the drop-down list, and enter "Test" as the profile name.</span></span>

<span data-ttu-id="5b4f0-267">Dans la zone **URL du service** , entrez *localhost*.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-267">In the **Service URL** box, enter *localhost*.</span></span>

<span data-ttu-id="5b4f0-268">Dans la zone **site/application** , entrez *Default Web site/ContosoUniversity*.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-268">In the **Site/application** box, enter *Default Web Site/ContosoUniversity*.</span></span>

<span data-ttu-id="5b4f0-269">Dans la zone **URL de destination** , entrez `http://localhost/ContosoUniversity/`.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-269">In the **Destination URL** box, enter `http://localhost/ContosoUniversity/`.</span></span>

<span data-ttu-id="5b4f0-270">Cliquez sur **Next**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-270">Click **Next**.</span></span>

<span data-ttu-id="5b4f0-271">L’onglet **paramètres** vous avertit que l’onglet **Package/Publication SQL** a été configuré et vous donne la possibilité de les remplacer en cliquant sur Activer les nouvelles améliorations de la publication de base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-271">The **Settings** tab warns you that the **Package/Publish SQL** tab has been configured, and it gives you an opportunity to override them by clicking enable the new database publishing improvements.</span></span> <span data-ttu-id="5b4f0-272">Pour ce déploiement, vous ne souhaitez pas remplacer les paramètres de l’onglet **Package/Publication SQL** , il vous suffit de cliquer sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-272">For this deployment you don't want to override the **Package/Publish SQL** tab settings, so just click **Next**.</span></span>

![Publish_Web_wizard_Settings_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image19.png)

<span data-ttu-id="5b4f0-274">Un message dans l’onglet **Aperçu** indique qu' **aucune base de données n’est sélectionnée pour la publication**, mais cela signifie uniquement que la publication de base de données n’est pas configurée dans le profil de publication.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-274">A message on the **Preview** tab indicates that **No databases are selected to publish**, but this only means that database publishing is not configured in the publish profile.</span></span>

<span data-ttu-id="5b4f0-275">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-275">Click **Publish**.</span></span>

![Publish_Web_wizard_Preview_tab_Migrate](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image20.png)

<span data-ttu-id="5b4f0-277">Visual Studio déploie l’application et ouvre le navigateur sur la page d’hébergement du site dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-277">Visual Studio deploys the application and opens the browser to the home page of the site in the test environment.</span></span> <span data-ttu-id="5b4f0-278">Exécutez la page des enseignants pour voir qu’elle affiche les mêmes données que celles que vous avez vues précédemment.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-278">Run the Instructors page to see that it displays the same data that you saw earlier.</span></span> <span data-ttu-id="5b4f0-279">Exécutez la page **Ajouter des élèves** , ajoutez un nouvel étudiant, puis affichez le nouvel étudiant dans la page des **étudiants** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-279">Run the **Add Students** page, add a new student, and then view the new student in the **Students** page.</span></span> <span data-ttu-id="5b4f0-280">Cela permet de vérifier que vous pouvez mettre à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-280">This verifies that the you can update the database.</span></span> <span data-ttu-id="5b4f0-281">Sélectionnez la page **mettre à jour les crédits** (vous devez vous connecter) pour vérifier que la base de données d’appartenance a été déployée et que vous y avez accès.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-281">Select the **Update Credits** page (you'll need to log in) to verify that the membership database was deployed and you have access to it.</span></span>

## <a name="creating-a-sql-server-database-for-the-production-environment"></a><span data-ttu-id="5b4f0-282">Création d’une base de données SQL Server pour l’environnement de production</span><span class="sxs-lookup"><span data-stu-id="5b4f0-282">Creating a SQL Server Database for the Production Environment</span></span>

<span data-ttu-id="5b4f0-283">Maintenant que vous avez déployé dans l’environnement de test, vous êtes prêt à configurer le déploiement en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-283">Now that you've deployed to the test environment, you're ready to set up deployment to production.</span></span> <span data-ttu-id="5b4f0-284">Vous commencez comme vous l’avez fait pour l’environnement de test en créant une base de données sur laquelle effectuer le déploiement.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-284">You begin as you did for the test environment, by creating a database to deploy to.</span></span> <span data-ttu-id="5b4f0-285">Comme vous l’avez vu dans la vue d’ensemble, le plan d’hébergement Cytanium Lite n’autorise qu’une seule base de données SQL Server, de sorte que vous ne configurez qu’une seule base de données, et non pas deux.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-285">As you recall from the Overview, the Cytanium Lite hosting plan only allows a single SQL Server database, so you will set up only one database, not two.</span></span> <span data-ttu-id="5b4f0-286">Toutes les tables et données des bases de données d’appartenance et scolaires SQL Server Compact sont déployées dans une base de données SQL Server en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-286">All of the tables and data from the membership and School SQL Server Compact databases will be deployed into one SQL Server database in production.</span></span>

<span data-ttu-id="5b4f0-287">Accédez au panneau de configuration Cytanium à [http://panel.cytanium.com](http://panel.cytanium.com).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-287">Go to the Cytanium control panel at [http://panel.cytanium.com](http://panel.cytanium.com).</span></span> <span data-ttu-id="5b4f0-288">Maintenez la souris sur **bases de données** , puis cliquez sur **SQL Server 2008**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-288">Hold the mouse over **Databases** and then click **SQL Server 2008**.</span></span>

<span data-ttu-id="5b4f0-289">[![Selecting_Databases_in_Control_Panel](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image22.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-289">[![Selecting_Databases_in_Control_Panel](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image22.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image21.png)</span></span>

<span data-ttu-id="5b4f0-290">Dans la page **SQL Server 2008** , cliquez sur **créer une base de données**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-290">In the **SQL Server 2008** page, click **Create Database**.</span></span>

<span data-ttu-id="5b4f0-291">[![Selecting_Create_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image24.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-291">[![Selecting_Create_Database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image24.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image23.png)</span></span>

<span data-ttu-id="5b4f0-292">Nommez la base de données « School », puis cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-292">Name the database "School" and click **Save**.</span></span> <span data-ttu-id="5b4f0-293">(La page ajoute automatiquement le préfixe « contoso », donc le nom effectif sera « contosouSchool ».)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-293">(The page automatically adds the prefix "contosou", so the effective name will be "contosouSchool".)</span></span>

<span data-ttu-id="5b4f0-294">[![Naming_the_database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image26.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-294">[![Naming_the_database](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image26.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image25.png)</span></span>

<span data-ttu-id="5b4f0-295">Sur la même page, cliquez sur **créer un utilisateur**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-295">On the same page, click **Create User**.</span></span> <span data-ttu-id="5b4f0-296">Sur les serveurs de Cytanium, au lieu d’utiliser la sécurité intégrée de Windows et de permettre à l’identité du pool d’applications d’ouvrir votre base de données, vous allez créer un utilisateur habilité à ouvrir votre base de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-296">On Cytanium's servers, rather than using integrated Windows security and letting the application pool identity open your database, you'll create a user that has authority to open your database.</span></span> <span data-ttu-id="5b4f0-297">Vous allez ajouter les informations d’identification de l’utilisateur aux chaînes de connexion qui se trouvent dans le fichier *Web. config* de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-297">You'll add the user's credentials to the connection strings that go in the production *Web.config* file.</span></span> <span data-ttu-id="5b4f0-298">Au cours de cette étape, vous allez créer ces informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-298">In this step you create those credentials.</span></span>

<span data-ttu-id="5b4f0-299">[![Creating_a_database_user](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image28.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-299">[![Creating_a_database_user](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image28.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image27.png)</span></span>

<span data-ttu-id="5b4f0-300">Renseignez les champs requis dans la page Propriétés de l' **utilisateur SQL** :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-300">Fill in the required fields in the **SQL User Properties** page:</span></span>

- <span data-ttu-id="5b4f0-301">Entrez « ContosoUniversityUser » comme nom.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-301">Enter "ContosoUniversityUser" as the name.</span></span>
- <span data-ttu-id="5b4f0-302">Entrez un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-302">Enter a password.</span></span>
- <span data-ttu-id="5b4f0-303">Sélectionnez **contosouSchool** comme base de données par défaut.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-303">Select **contosouSchool** as the default database.</span></span>
- <span data-ttu-id="5b4f0-304">Activez la case à cocher **contosouSchool** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-304">Select the **contosouSchool** check box.</span></span>

<span data-ttu-id="5b4f0-305">[![SQL_User_Properties_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image30.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-305">[![SQL_User_Properties_page](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image30.png)](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image29.png)</span></span>

## <a name="configuring-database-deployment-for-the-production-environment"></a><span data-ttu-id="5b4f0-306">Configuration du déploiement de base de données pour l’environnement de production</span><span class="sxs-lookup"><span data-stu-id="5b4f0-306">Configuring Database Deployment for the Production Environment</span></span>

<span data-ttu-id="5b4f0-307">Vous êtes maintenant prêt à configurer les paramètres de déploiement de base de données dans l’onglet **Package/Publication SQL** , comme vous l’avez fait précédemment pour l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-307">Now you're ready to set up database deployment settings in the **Package/Publish SQL** tab, as you did earlier for the test environment.</span></span>

<span data-ttu-id="5b4f0-308">Ouvrez la fenêtre **Propriétés du projet** , sélectionnez l’onglet **Package/Publication SQL** , et assurez-vous que l’option **active (version finale)** ou **mise en sortie** est sélectionnée dans la liste déroulante **configuration** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-308">Open the **Project Properties** window, select the **Package/Publish SQL** tab, and make sure that **Active (Release)** or **Release** is selected in the **Configuration** drop-down list.</span></span>

<span data-ttu-id="5b4f0-309">Quand vous configurez les paramètres de déploiement pour chaque base de données, la principale différence entre ce que vous faites pour les environnements de production et de test réside dans la façon dont vous configurez les chaînes de connexion.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-309">When you configure deployment settings for each database, the key difference between what you do for production and test environments is in how you configure connection strings.</span></span> <span data-ttu-id="5b4f0-310">Pour l’environnement de test, vous avez entré des chaînes de connexion de base de données de destination différentes, mais pour l’environnement de production, la chaîne de connexion de destination sera la même pour les deux bases de données.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-310">For the test environment you entered different destination database connection strings, but for the production environment the destination connection string will be the same for both databases.</span></span> <span data-ttu-id="5b4f0-311">Cela est dû au fait que vous déployez les deux bases de données dans une base de données en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-311">This is because you are deploying both databases to one database in production.</span></span>

### <a name="configuring-deployment-settings-for-the-membership-database"></a><span data-ttu-id="5b4f0-312">Configuration des paramètres de déploiement pour la base de données d’appartenance</span><span class="sxs-lookup"><span data-stu-id="5b4f0-312">Configuring Deployment Settings for the Membership Database</span></span>

<span data-ttu-id="5b4f0-313">Pour configurer les paramètres qui s’appliquent à la base de données d’appartenance, sélectionnez la ligne **DefaultConnection-Deployment** dans le tableau **entrées de la base de données** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-313">To configure settings that apply to the membership database, select the **DefaultConnection-Deployment** row in the **Database Entries** table.</span></span>

<span data-ttu-id="5b4f0-314">Dans **chaîne de connexion de la base de données de destination**, entrez une chaîne de connexion qui pointe vers la nouvelle base de données de production SQL Server que vous venez de créer.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-314">In **Connection string for destination database**, enter a connection string that points to the new production SQL Server database that you just created.</span></span> <span data-ttu-id="5b4f0-315">Vous pouvez récupérer la chaîne de connexion à partir de votre e-mail de bienvenue.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-315">You can get the connection string from your welcome email.</span></span> <span data-ttu-id="5b4f0-316">La partie correspondante de l’e-mail contient l’exemple de chaîne de connexion suivant :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-316">The relevant part of the email contains the following sample connection string:</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample5.cmd)]

<span data-ttu-id="5b4f0-317">Une fois que vous avez remplacé les trois variables, la chaîne de connexion dont vous avez besoin ressemble à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-317">After you replace the three variables, the connection string you need looks like this example:</span></span>

[!code-console[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample6.cmd)]

<span data-ttu-id="5b4f0-318">Copiez et collez cette chaîne de connexion dans la chaîne de connexion de la **base de données de destination** dans l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-318">Copy and paste this connection string into **Connection string for destination database** in the **Package/Publish SQL** tab.</span></span>

<span data-ttu-id="5b4f0-319">Assurez-vous que les **données extraites et/ou le schéma d’une base de données existante** sont toujours sélectionnés, et que les **options de script de base de données** sont toujours **schéma et données**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-319">Make sure that **Pull data and/or schema from an existing database** is still selected, and that **Database scripting options** is still **Schema and Data**.</span></span>

<span data-ttu-id="5b4f0-320">Dans la zone **scripts de base de données** , désactivez la case à cocher en regard du script Grant. Sql.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-320">In the **Database Scripts** box, clear the check box next to the Grant.sql script.</span></span>

![Disable_Grant_script](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/_static/image31.png)

### <a name="configuring-deployment-settings-for-the-school-database"></a><span data-ttu-id="5b4f0-322">Configuration des paramètres de déploiement pour la base de données School</span><span class="sxs-lookup"><span data-stu-id="5b4f0-322">Configuring Deployment Settings for the School Database</span></span>

<span data-ttu-id="5b4f0-323">Ensuite, sélectionnez la ligne **SchoolContext-Deployment** dans le tableau **entrées de la base de données** afin de configurer les paramètres de la base de données School.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-323">Next, select the **SchoolContext-Deployment** row in the **Database Entries** table in order to configure the School database settings.</span></span>

<span data-ttu-id="5b4f0-324">Copiez la même chaîne de connexion dans la **chaîne de connexion de la base de données de destination** que vous avez copiée dans ce champ pour la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-324">Copy the same connection string into **Connection string for destination database** that you copied into that field for the membership database.</span></span>

<span data-ttu-id="5b4f0-325">Assurez-vous que les **données extraites et/ou le schéma d’une base de données existante** sont toujours sélectionnés, et que les **options de script de base de données** sont toujours **schéma et données**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-325">Make sure that **Pull data and/or schema from an existing database** is still selected, and that **Database scripting options** is still **Schema and Data**.</span></span>

<span data-ttu-id="5b4f0-326">Dans la zone **scripts de base de données** , désactivez la case à cocher en regard du script Grant. Sql.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-326">In the **Database Scripts** box, clear the check box next to the Grant.sql script.</span></span>

<span data-ttu-id="5b4f0-327">Enregistrez les modifications apportées à l’onglet **Package/Publication SQL** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-327">Save the changes to the **Package/Publish SQL** tab.</span></span>

## <a name="setting-up-webconfig-transforms-for-the-connection-strings-to-production-databases"></a><span data-ttu-id="5b4f0-328">Configuration des transformations Web. config pour les chaînes de connexion aux bases de données de production</span><span class="sxs-lookup"><span data-stu-id="5b4f0-328">Setting Up Web.Config Transforms for the Connection Strings to Production Databases</span></span>

<span data-ttu-id="5b4f0-329">Ensuite, vous allez configurer les transformations *Web. config* afin que les chaînes de connexion dans le fichier *Web. config* déployés pointent vers la nouvelle base de données de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-329">Next, you'll set up *Web.config* transformations so that the connection strings in the deployed *Web.config* file to point to the new production database.</span></span> <span data-ttu-id="5b4f0-330">La chaîne de connexion que vous avez entrée sous l’onglet **Package/Publication SQL** pour Web Deploy à utiliser est identique à celle que l’application doit utiliser, à l’exception de l’ajout de l’option `MultipleResultSets`.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-330">The connection string that you entered on the **Package/Publish SQL** tab for Web Deploy to use is the same as the one the application needs to use, except for the addition of the `MultipleResultSets` option.</span></span>

<span data-ttu-id="5b4f0-331">Ouvrez *Web. production. config* et remplacez l’élément `connectionStrings` par un élément `connectionStrings` ressemblant à l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-331">Open *Web.Production.config* and replace the `connectionStrings` element with a `connectionStrings` element that looks like the following example.</span></span> <span data-ttu-id="5b4f0-332">(Copiez uniquement l’élément `connectionStrings`, pas les balises environnantes fournies pour afficher le contexte.)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-332">(Only copy the `connectionStrings` element, not the surrounding tags that are provided to show the context.)</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample7.xml?highlight=2-11)]

<span data-ttu-id="5b4f0-333">Vous pouvez parfois voir des conseils qui vous indiquent de toujours chiffrer les chaînes de connexion dans le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-333">You sometimes see advice that tells you to always encrypt connection strings in the *Web.config* file.</span></span> <span data-ttu-id="5b4f0-334">Cela peut être approprié si vous déployez sur des serveurs sur le réseau de votre propre entreprise.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-334">This might be appropriate if you were deploying to servers on your own company's network.</span></span> <span data-ttu-id="5b4f0-335">Toutefois, lorsque vous déployez dans un environnement d’hébergement partagé, vous faites confiance aux pratiques de sécurité du fournisseur d’hébergement et il n’est pas nécessaire ou pratique de chiffrer les chaînes de connexion.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-335">When you are deploying to a shared hosting environment, though, you're trusting the security practices of the hosting provider, and it's not necessary or practical to encrypt the connection strings.</span></span>

## <a name="deploying-to-the-production-environment"></a><span data-ttu-id="5b4f0-336">Déploiement dans l’environnement de production</span><span class="sxs-lookup"><span data-stu-id="5b4f0-336">Deploying to the Production Environment</span></span>

<span data-ttu-id="5b4f0-337">Vous êtes maintenant prêt à effectuer le déploiement en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-337">Now you're ready to deploy to production.</span></span> <span data-ttu-id="5b4f0-338">Web Deploy lit les bases de données SQL Server Compact dans le dossier des *données de l’application\_* de votre projet et recrée toutes leurs tables et données dans la base de données de SQL Server de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-338">Web Deploy will read the SQL Server Compact databases in your project's *App\_Data* folder and re-create all of their tables and data in the production SQL Server database.</span></span> <span data-ttu-id="5b4f0-339">Pour publier à l’aide des paramètres de l’onglet **Package/Publication Web** , vous devez créer un nouveau profil de publication pour la production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-339">In order to publish by using the **Package/Publish Web** tab settings, you have to create a new publish profile for production.</span></span>

<span data-ttu-id="5b4f0-340">Tout d’abord, supprimez le profil de production existant comme vous l’avez fait précédemment.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-340">First, delete the existing Production profile as you did the Test profile earlier.</span></span>

<span data-ttu-id="5b4f0-341">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity, puis cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-341">In **Solution Explorer**, right-click the ContosoUniversity project, and click **Publish**.</span></span>

<span data-ttu-id="5b4f0-342">Sélectionnez l’onglet **Profil** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-342">Select the **Profile** tab.</span></span>

<span data-ttu-id="5b4f0-343">Cliquez sur **Manage Profiles (Gérer les profils)** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-343">Click **Manage Profiles**.</span></span>

<span data-ttu-id="5b4f0-344">Sélectionnez **production**, cliquez sur **supprimer**, puis sur **Fermer**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-344">Select **Production**, click **Remove**, and then click **Close**.</span></span>

<span data-ttu-id="5b4f0-345">Fermez l’Assistant **publier le site Web** pour enregistrer cette modification.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-345">Close the **Publish Web** wizard to save this change.</span></span>

<span data-ttu-id="5b4f0-346">Ensuite, créez un nouveau profil de production et utilisez-le pour publier le projet.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-346">Next, create a new Production profile and use it to publish the project.</span></span>

<span data-ttu-id="5b4f0-347">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity, puis cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-347">In **Solution Explorer**, right-click the ContosoUniversity project, and click **Publish**.</span></span>

<span data-ttu-id="5b4f0-348">Sélectionnez l’onglet **Profil** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-348">Select the **Profile** tab.</span></span>

<span data-ttu-id="5b4f0-349">Cliquez sur **Importer**, puis sélectionnez le fichier. publishsettings que vous avez téléchargé précédemment.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-349">Click **Import**, and select the .publishsettings file that you downloaded earlier.</span></span>

<span data-ttu-id="5b4f0-350">Sous l’onglet **connexion** , remplacez l' **URL de destination** par l’URL temporaire correcte, qui, dans cet exemple, est http://contosouniversity.com.vserver01.cytanium.com.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-350">On the **Connection** tab, change the **Destination URL** to the correct temporary URL, which in this example is http://contosouniversity.com.vserver01.cytanium.com.</span></span>

<span data-ttu-id="5b4f0-351">Renommez le profil en production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-351">Rename the profile to Production.</span></span> <span data-ttu-id="5b4f0-352">(Sélectionnez l’onglet **Profil** , puis cliquez sur **gérer les profils** pour effectuer cette opération).</span><span class="sxs-lookup"><span data-stu-id="5b4f0-352">(Select the **Profile** tab and click **Manage Profiles** to do that).</span></span>

<span data-ttu-id="5b4f0-353">Fermez l’Assistant **publier le site Web** pour enregistrer vos modifications.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-353">Close the **Publish Web** wizard to save your changes.</span></span>

<span data-ttu-id="5b4f0-354">Dans une application réelle dans laquelle la base de données a été mise à jour en production, vous devez effectuer deux étapes supplémentaires maintenant avant de publier :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-354">In a real application in which the database was being updated in production, you would do two additional steps now before you publish:</span></span>

1. <span data-ttu-id="5b4f0-355">Téléchargez l' *application\_offline. htm*, comme indiqué dans le didacticiel [sur le déploiement dans l’environnement de production](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-355">Upload *app\_offline.htm*, as shown in the [Deploying to the Production Environment](deployment-to-a-hosting-provider-deploying-to-the-production-environment-7-of-12.md) tutorial.</span></span>
2. <span data-ttu-id="5b4f0-356">Utilisez la **fonctionnalité gestionnaire de fichiers** du panneau de configuration Cytanium pour copier les fichiers *ASPNET-prod. sdf* et *School-prod. sdf* à partir du site de production vers le dossier de données de l' *application\_* du projet ContosoUniversity.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-356">Use the **File Manager** feature of the Cytanium control panel to copy the *aspnet-Prod.sdf* and *School-Prod.sdf* files from the production site to the *App\_Data* folder of the ContosoUniversity project.</span></span> <span data-ttu-id="5b4f0-357">Cela permet de s’assurer que les données que vous déployez dans la nouvelle base de données SQL Server incluent les dernières mises à jour apportées par votre site Web de production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-357">This ensures that the data you're deploying to the new SQL Server database includes the latest updates made by your production website.</span></span>

<span data-ttu-id="5b4f0-358">Dans la barre d’outils **publication Web en un clic** , assurez-vous que le profil de **production** est sélectionné, puis cliquez sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-358">In the **Web One Click Publish** toolbar, make sure that the **Production** profile is selected, and then click **Publish**.</span></span>

<span data-ttu-id="5b4f0-359">Si vous avez téléchargé l' <em>application\_offline. htm</em> avant la publication, vous devez utiliser l’utilitaire <strong>Gestionnaire de fichiers</strong> dans le panneau de configuration Cytanium pour supprimer l' <em>application\_hors connexion.</em> htm avant de tester.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-359">If you uploaded <em>app\_offline.htm</em> before publishing, you have to use the <strong>File Manager</strong> utility in the Cytanium control panel to delete <em>app\_offline.</em>htm before you test.</span></span> <span data-ttu-id="5b4f0-360">Vous pouvez également supprimer les fichiers <em>. sdf</em> du dossier de données de l' <em>application\_</em> .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-360">You can also at the same time delete the <em>.sdf</em> files from the <em>App\_Data</em> folder.</span></span>

<span data-ttu-id="5b4f0-361">Vous pouvez maintenant ouvrir un navigateur et accéder à l’URL de votre site public pour tester l’application de la même façon que vous l’avez fait après le déploiement dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-361">You can now open a browser and go to the URL of your public site to test the application the same way you did after deploying to the test environment.</span></span>

## <a name="switching-to-sql-server-express-localdb-in-development"></a><span data-ttu-id="5b4f0-362">Passage à SQL Server Express base de données locale en développement</span><span class="sxs-lookup"><span data-stu-id="5b4f0-362">Switching to SQL Server Express LocalDB in Development</span></span>

<span data-ttu-id="5b4f0-363">Comme expliqué dans la vue d’ensemble, il est généralement préférable d’utiliser le moteur de base de données en développement que vous utilisez dans les tests et la production.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-363">As was explained in the Overview, it's generally best to use the same database engine in development that you use in test and production.</span></span> <span data-ttu-id="5b4f0-364">(N’oubliez pas que l’avantage d’utiliser SQL Server Express dans le développement est que la base de données fonctionnera de la même façon dans vos environnements de développement, de test et de production.) Dans cette section, vous allez configurer le projet ContosoUniversity pour utiliser SQL Server Express base de données locale lorsque vous exécutez l’application à partir de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-364">(Remember that the advantage to using SQL Server Express in development is that the database will work the same in your development, test, and production environments.) In this section you'll set up the ContosoUniversity project to use SQL Server Express LocalDB when you run the application from Visual Studio.</span></span>

<span data-ttu-id="5b4f0-365">La façon la plus simple d’effectuer cette migration consiste à laisser Code First et le système d’appartenance créera les deux bases de données de développement pour vous.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-365">The simplest way to perform this migration is to let Code First and the membership system create both new development databases for you.</span></span> <span data-ttu-id="5b4f0-366">L’utilisation de cette méthode pour migrer requiert trois étapes :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-366">Using this method to migrate requires three steps:</span></span>

1. <span data-ttu-id="5b4f0-367">Modifiez les chaînes de connexion pour spécifier de nouvelles bases de données SQL Express de base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-367">Change the connection strings to specify new SQL Express LocalDB databases.</span></span>
2. <span data-ttu-id="5b4f0-368">Exécutez l’outil Administration de site Web pour créer un utilisateur administrateur.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-368">Run the Web Site Administration Tool to create an administrator user.</span></span> <span data-ttu-id="5b4f0-369">La base de données d’appartenance est alors créée.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-369">This creates the membership database.</span></span>
3. <span data-ttu-id="5b4f0-370">Utilisez la commande Migrations Code First Update-Database pour créer et amorcer la base de données d’application.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-370">Use the Code First Migrations update-database command to create and seed the application database.</span></span>

### <a name="updating-connection-strings-in-the-webconfig-file"></a><span data-ttu-id="5b4f0-371">Mise à jour des chaînes de connexion dans le fichier Web. config</span><span class="sxs-lookup"><span data-stu-id="5b4f0-371">Updating Connection Strings in the Web.config file</span></span>

<span data-ttu-id="5b4f0-372">Ouvrez le fichier *Web. config* et remplacez l’élément `connectionStrings` par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-372">Open the *Web.config* file and replace the `connectionStrings` element with the following code:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample8.xml)]

### <a name="creating-the-membership-database"></a><span data-ttu-id="5b4f0-373">Création de la base de données d’appartenance</span><span class="sxs-lookup"><span data-stu-id="5b4f0-373">Creating the Membership Database</span></span>

<span data-ttu-id="5b4f0-374">Dans **Explorateur de solutions**, sélectionnez le projet ContosoUniversity, puis cliquez sur **configuration de ASP.net** dans le menu **projet** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-374">In **Solution Explorer**, select the ContosoUniversity project, and then click **ASP.NET Configuration** in the **Project** menu.</span></span>

<span data-ttu-id="5b4f0-375">Cliquez sur l'onglet Sécurité.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-375">Select the Security tab.</span></span>

<span data-ttu-id="5b4f0-376">Cliquez sur **créer ou gérer des rôles**, puis créez un rôle d' **administrateur** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-376">Click **Create or Manage Roles**, and then create an **Administrator** role.</span></span>

<span data-ttu-id="5b4f0-377">Revenez à l’onglet sécurité.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-377">Return to the Security tab.</span></span>

<span data-ttu-id="5b4f0-378">Cliquez sur **créer un utilisateur**, puis activez la case à cocher **administrateur** et créez un utilisateur nommé Admin.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-378">Click **Create user**, and then select the **Administrator** check box and create a user named admin.</span></span>

<span data-ttu-id="5b4f0-379">Fermez l' **outil Administration de site Web**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-379">Close the **Web Site Administration Tool**.</span></span>

### <a name="creating-the-school-database"></a><span data-ttu-id="5b4f0-380">Création de la base de données School</span><span class="sxs-lookup"><span data-stu-id="5b4f0-380">Creating the School Database</span></span>

<span data-ttu-id="5b4f0-381">Ouvrez la fenêtre de console du gestionnaire de package.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-381">Open the Package Manager Console window.</span></span>

<span data-ttu-id="5b4f0-382">Dans la liste déroulante **projet par défaut** , sélectionnez le projet CONTOSOUNIVERSITY. dal.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-382">In the **Default project** drop-down list, select the ContosoUniversity.DAL project.</span></span>

<span data-ttu-id="5b4f0-383">Entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="5b4f0-383">Enter the following command:</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12/samples/sample9.ps1)]

<span data-ttu-id="5b4f0-384">Migrations Code First applique la migration initiale qui crée la base de données, puis applique la migration AddBirthDate, puis il exécute la méthode Seed.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-384">Code First Migrations applies the Initial migration that creates the database and then applies the AddBirthDate migration, then it runs the Seed method.</span></span>

<span data-ttu-id="5b4f0-385">Exécutez le site en appuyant sur CTRL + F5.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-385">Run the site by pressing Control-F5.</span></span> <span data-ttu-id="5b4f0-386">Comme vous l’avez fait pour les environnements de test et de production, exécutez la page **Ajouter des élèves** , ajoutez un nouvel étudiant, puis affichez le nouvel étudiant dans la page des **étudiants** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-386">As you did for the test and production environments, run the **Add Students** page, add a new student, and then view the new student in the **Students** page.</span></span> <span data-ttu-id="5b4f0-387">Cela permet de vérifier que la base de données School a été créée et initialisée et que vous disposez d’un accès en lecture et en écriture à celle-ci.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-387">This verifies that the School database was created and initialized and that you have read and write access to it.</span></span>

<span data-ttu-id="5b4f0-388">Sélectionnez la page **mettre à jour les crédits** et connectez-vous pour vérifier que la base de données d’appartenance a été déployée et que vous y avez accès.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-388">Select the **Update Credits** page and log in to verify that the membership database was deployed and that you have access to it.</span></span> <span data-ttu-id="5b4f0-389">Si vous n’avez pas migré vos comptes d’utilisateur, créez un compte d’administrateur, puis sélectionnez la page **mettre à jour les crédits** pour vérifier qu’elle fonctionne.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-389">If you did not migrate your user accounts, create an administrator account and then select the **Update Credits** page to verify that it works.</span></span>

## <a name="cleaning-up-sql-server-compact-files"></a><span data-ttu-id="5b4f0-390">Nettoyage des fichiers SQL Server Compact</span><span class="sxs-lookup"><span data-stu-id="5b4f0-390">Cleaning Up SQL Server Compact Files</span></span>

<span data-ttu-id="5b4f0-391">Vous n’avez plus besoin de fichiers et de packages NuGet inclus pour prendre en charge SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-391">You no longer need files and NuGet packages that were included to support SQL Server Compact.</span></span> <span data-ttu-id="5b4f0-392">Si vous le souhaitez (cette étape n’est pas requise), vous pouvez nettoyer les fichiers et références inutiles.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-392">If you want (this step is not required), you can clean up unneeded files and references.</span></span>

<span data-ttu-id="5b4f0-393">Dans **Explorateur de solutions**, supprimez les fichiers *. sdf* du dossier *app\_Data* et des dossiers *amd64* et *x86* du dossier *bin* .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-393">In **Solution Explorer**, delete the *.sdf* files from the *App\_Data* folder and the *amd64* and *x86* folders from the *bin* folder.</span></span>

<span data-ttu-id="5b4f0-394">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur la solution (et non sur l’un des projets), puis cliquez sur **gérer les packages NuGet pour la solution**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-394">In **Solution Explorer**, right-click the solution (not one of the projects), and then click **Manage NuGet Packages for Solution**.</span></span>

<span data-ttu-id="5b4f0-395">Dans le volet gauche de la boîte de dialogue **gérer les packages NuGet** , sélectionnez **packages installés**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-395">In the left pane of the **Manage NuGet Packages** dialog box, select **Installed packages**.</span></span>

<span data-ttu-id="5b4f0-396">Sélectionnez le package **EntityFramework. SqlServerCompact** , puis cliquez sur **gérer**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-396">Select the **EntityFramework.SqlServerCompact** package and click **Manage**.</span></span>

<span data-ttu-id="5b4f0-397">Dans la boîte de dialogue **Sélectionner les projets** , les deux projets sont sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-397">In the **Select Projects** dialog box, both projects are selected.</span></span> <span data-ttu-id="5b4f0-398">Pour désinstaller le package dans les deux projets, désactivez les deux cases à cocher, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-398">To uninstall the package in both projects, clear both check boxes, then click **OK**.</span></span>

<span data-ttu-id="5b4f0-399">Dans la boîte de dialogue qui vous demande si vous souhaitez désinstaller également les packages dépendants, cliquez sur non.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-399">In the dialog box that asks if you want to uninstall the dependent packages also, click No.</span></span> <span data-ttu-id="5b4f0-400">L’une d’entre elles est le package de Entity Framework que vous devez conserver.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-400">One of these is the Entity Framework package that you have to keep.</span></span>

<span data-ttu-id="5b4f0-401">Suivez la même procédure pour désinstaller le package **SqlServerCompact** .</span><span class="sxs-lookup"><span data-stu-id="5b4f0-401">Follow the same procedure to uninstall the **SqlServerCompact** package.</span></span> <span data-ttu-id="5b4f0-402">(Les packages doivent être désinstallés dans cet ordre, car le package **EntityFramework. SqlServerCompact** dépend du package **SqlServerCompact** .)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-402">(The packages must be uninstalled in this order because the **EntityFramework.SqlServerCompact** package depends on the **SqlServerCompact** package.)</span></span>

<span data-ttu-id="5b4f0-403">Vous avez maintenant effectué une migration vers SQL Server Express et une SQL Server complète.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-403">You have now successfully migrated to SQL Server Express and full SQL Server.</span></span> <span data-ttu-id="5b4f0-404">Dans le didacticiel suivant, vous allez modifier une autre base de données, et vous verrez comment déployer les modifications de la base de données lorsque vos bases de données de test et de production utilisent la SQL Server Express et la SQL Server complète.</span><span class="sxs-lookup"><span data-stu-id="5b4f0-404">In the next tutorial you'll make another database change, and you'll see how to deploy database changes when your test and production databases use SQL Server Express and full SQL Server.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5b4f0-405">[Précédent](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md)
> [Suivant](deployment-to-a-hosting-provider-deploying-a-sql-server-database-update-11-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="5b4f0-405">[Previous](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md)
[Next](deployment-to-a-hosting-provider-deploying-a-sql-server-database-update-11-of-12.md)</span></span>
