---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12
title: 'Déploiement d’une application Web ASP.NET avec SQL Server Compact à l’aide de Visual Studio ou Visual Web Developer : déploiement de SQL Server Compact bases de données-2 sur 12 | Microsoft Docs'
author: tdykstra
description: Cette série de didacticiels vous montre comment déployer (publier) un projet d’application Web ASP.NET qui comprend une base de données SQL Server Compact à l’aide de Stu...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: c3c76516-4c48-4153-bd03-d70e3a3edbb0
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12
msc.type: authoredcontent
ms.openlocfilehash: 56ceabc79947967846d342354fd033510be5f05a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74625539"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-sql-server-compact-databases---2-of-12"></a><span data-ttu-id="d0afb-103">Déploiement d’une application Web ASP.NET avec SQL Server Compact à l’aide de Visual Studio ou Visual Web Developer : déploiement de bases de données SQL Server Compact-2 sur 12</span><span class="sxs-lookup"><span data-stu-id="d0afb-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying SQL Server Compact Databases - 2 of 12</span></span>

<span data-ttu-id="d0afb-104">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="d0afb-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="d0afb-105">Télécharger le projet de démarrage</span><span class="sxs-lookup"><span data-stu-id="d0afb-105">Download Starter Project</span></span>](https://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="d0afb-106">Cette série de didacticiels vous montre comment déployer (publier) un projet d’application Web ASP.NET qui comprend une base de données SQL Server Compact à l’aide de Visual Studio 2012 RC ou Visual Studio Express 2012 RC pour le Web.</span><span class="sxs-lookup"><span data-stu-id="d0afb-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="d0afb-107">Vous pouvez également utiliser Visual Studio 2010 si vous installez la mise à jour de publication Web.</span><span class="sxs-lookup"><span data-stu-id="d0afb-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="d0afb-108">Pour obtenir une présentation de la série, consultez [le premier didacticiel de la série](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="d0afb-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="d0afb-109">Pour obtenir un didacticiel qui présente les fonctionnalités de déploiement introduites après la version RC de Visual Studio 2012, montre comment déployer des éditions SQL Server autres que SQL Server Compact et montre comment déployer vers Azure App Service Web Apps, consultez [déploiement Web ASP.net à l’aide de Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d0afb-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="d0afb-110">Vue d'ensemble de</span><span class="sxs-lookup"><span data-stu-id="d0afb-110">Overview</span></span>

<span data-ttu-id="d0afb-111">Ce didacticiel montre comment configurer deux bases de données SQL Server Compact et le moteur de base de données pour le déploiement.</span><span class="sxs-lookup"><span data-stu-id="d0afb-111">This tutorial shows how to set up two SQL Server Compact databases and the database engine for deployment.</span></span>

<span data-ttu-id="d0afb-112">Pour l’accès à la base de données, l’application Contoso University requiert les logiciels suivants qui doivent être déployés avec l’application, car elle n’est pas incluse dans le .NET Framework :</span><span class="sxs-lookup"><span data-stu-id="d0afb-112">For database access, the Contoso University application requires the following software that must be deployed with the application because it is not included in the .NET Framework:</span></span>

- <span data-ttu-id="d0afb-113">[SQL Server Compact](https://www.microsoft.com/sqlserver/en/us/editions/compact.aspx) (moteur de base de données).</span><span class="sxs-lookup"><span data-stu-id="d0afb-113">[SQL Server Compact](https://www.microsoft.com/sqlserver/en/us/editions/compact.aspx) (the database engine).</span></span>
- <span data-ttu-id="d0afb-114">[Fournisseurs universels ASP.net](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) (qui permettent au système d’appartenance ASP.net d’utiliser SQL Server Compact)</span><span class="sxs-lookup"><span data-stu-id="d0afb-114">[ASP.NET Universal Providers](http://www.hanselman.com/blog/IntroducingSystemWebProvidersASPNETUniversalProvidersForSessionMembershipRolesAndUserProfileOnSQLCompactAndSQLAzure.aspx) (which enable the ASP.NET membership system to use SQL Server Compact)</span></span>
- <span data-ttu-id="d0afb-115">[Entity Framework 5,0](https://msdn.microsoft.com/library/gg696172(d=lightweight,v=vs.103).aspx)(code First avec des migrations).</span><span class="sxs-lookup"><span data-stu-id="d0afb-115">[Entity Framework 5.0](https://msdn.microsoft.com/library/gg696172(d=lightweight,v=vs.103).aspx)(Code First with Migrations).</span></span>

<span data-ttu-id="d0afb-116">La structure de la base de données et certaines (pas toutes) des données dans les deux bases de données de l’application doivent également être déployées.</span><span class="sxs-lookup"><span data-stu-id="d0afb-116">The database structure and some (not all) of the data in the application's two databases must also be deployed.</span></span> <span data-ttu-id="d0afb-117">En règle générale, lorsque vous développez une application, vous entrez des données de test dans une base de données que vous ne souhaitez pas déployer sur un site actif.</span><span class="sxs-lookup"><span data-stu-id="d0afb-117">Typically, as you develop an application, you enter test data into a database that you don't want to deploy to a live site.</span></span> <span data-ttu-id="d0afb-118">Toutefois, vous pouvez également entrer des données de production que vous souhaitez déployer.</span><span class="sxs-lookup"><span data-stu-id="d0afb-118">However, you might also enter some production data that you do want to deploy.</span></span> <span data-ttu-id="d0afb-119">Dans ce didacticiel, vous allez configurer le projet Contoso University afin que les logiciels requis et les données correctes soient inclus au moment du déploiement.</span><span class="sxs-lookup"><span data-stu-id="d0afb-119">In this tutorial you'll configure the Contoso University project so that the required software and the correct data are included when you deploy.</span></span>

<span data-ttu-id="d0afb-120">Rappel : Si vous recevez un message d’erreur ou si une action ne fonctionne pas au fur et à mesure que vous parcourez le didacticiel, veillez à consulter la [page de résolution des problèmes](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="d0afb-120">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="sql-server-compact-versus-sql-server-express"></a><span data-ttu-id="d0afb-121">SQL Server Compact contre SQL Server Express</span><span class="sxs-lookup"><span data-stu-id="d0afb-121">SQL Server Compact versus SQL Server Express</span></span>

<span data-ttu-id="d0afb-122">L’exemple d’application utilise SQL Server Compact 4,0.</span><span class="sxs-lookup"><span data-stu-id="d0afb-122">The sample application uses SQL Server Compact 4.0.</span></span> <span data-ttu-id="d0afb-123">Ce moteur de base de données est une option relativement nouvelle pour les sites Web. les versions antérieures de SQL Server Compact ne fonctionnent pas dans un environnement d’hébergement Web.</span><span class="sxs-lookup"><span data-stu-id="d0afb-123">This database engine is a relatively new option for websites; earlier versions of SQL Server Compact do not work in a web hosting environment.</span></span> <span data-ttu-id="d0afb-124">SQL Server Compact offre un certain nombre d’avantages par rapport au scénario plus courant de développement avec SQL Server Express et de déploiement sur un SQL Server complet.</span><span class="sxs-lookup"><span data-stu-id="d0afb-124">SQL Server Compact offers a few benefits compared to the more common scenario of developing with SQL Server Express and deploying to full SQL Server.</span></span> <span data-ttu-id="d0afb-125">En fonction du fournisseur d’hébergement que vous choisissez, SQL Server Compact peut être moins coûteuse à déployer, car certains fournisseurs chargent des compléments pour prendre en charge une base de données SQL Server complète.</span><span class="sxs-lookup"><span data-stu-id="d0afb-125">Depending on the hosting provider you choose, SQL Server Compact might be cheaper to deploy, because some providers charge extra to support a full SQL Server database.</span></span> <span data-ttu-id="d0afb-126">Aucun frais supplémentaire n’est facturé pour SQL Server Compact, car vous pouvez déployer le moteur de base de données lui-même dans le cadre de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="d0afb-126">There is no extra charge for SQL Server Compact because you can deploy the database engine itself as part of your web application.</span></span>

<span data-ttu-id="d0afb-127">Toutefois, vous devez également être conscient de ses limitations.</span><span class="sxs-lookup"><span data-stu-id="d0afb-127">However, you should also be aware of its limitations.</span></span> <span data-ttu-id="d0afb-128">SQL Server Compact ne prend pas en charge les procédures stockées, les déclencheurs, les vues ou la réplication.</span><span class="sxs-lookup"><span data-stu-id="d0afb-128">SQL Server Compact does not support stored procedures, triggers, views, or replication.</span></span> <span data-ttu-id="d0afb-129">(Pour obtenir la liste complète des fonctionnalités de SQL Server qui ne sont pas prises en charge par SQL Server Compact, consultez [différences entre SQL Server Compact et SQL Server](https://msdn.microsoft.com/library/bb896140.aspx).) En outre, certains des outils que vous pouvez utiliser pour manipuler des schémas et des données dans SQL Server Express et SQL Server bases de données ne fonctionnent pas avec SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="d0afb-129">(For a complete list of SQL Server features that are not supported by SQL Server Compact, see [Differences Between SQL Server Compact and SQL Server](https://msdn.microsoft.com/library/bb896140.aspx).) Also, some of the tools that you can use to manipulate schemas and data in SQL Server Express and SQL Server databases do not work with SQL Server Compact.</span></span> <span data-ttu-id="d0afb-130">Par exemple, vous ne pouvez pas utiliser SQL Server Management Studio ou SQL Server Data Tools dans Visual Studio avec SQL Server Compact bases de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-130">For example, you cannot use SQL Server Management Studio or SQL Server Data Tools in Visual Studio with SQL Server Compact databases.</span></span> <span data-ttu-id="d0afb-131">Vous disposez d’autres options pour travailler avec des bases de données SQL Server Compact :</span><span class="sxs-lookup"><span data-stu-id="d0afb-131">You do have other options for working with SQL Server Compact databases:</span></span>

- <span data-ttu-id="d0afb-132">Vous pouvez utiliser Explorateur de serveurs dans Visual Studio, qui offre des fonctionnalités de manipulation de base de données limitées pour les SQL Server Compact.</span><span class="sxs-lookup"><span data-stu-id="d0afb-132">You can use Server Explorer in Visual Studio, which offers limited database manipulation functionality for SQL Server Compact.</span></span>
- <span data-ttu-id="d0afb-133">Vous pouvez utiliser la fonctionnalité de manipulation de base de données de [WebMatrix](https://www.microsoft.com/web/webmatrix/), qui offre plus de fonctionnalités que Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="d0afb-133">You can use the database manipulation feature of [WebMatrix](https://www.microsoft.com/web/webmatrix/), which has more features than Server Explorer.</span></span>
- <span data-ttu-id="d0afb-134">Vous pouvez utiliser des outils tiers ou open source relativement complets, tels que la [boîte à outils SQL Server Compact](https://github.com/ErikEJ/SqlCeToolbox) et l' [utilitaire de script de schéma et de données SQL Compact](https://github.com/ErikEJ/SqlCeToolbox).</span><span class="sxs-lookup"><span data-stu-id="d0afb-134">You can use relatively full-featured third-party or open source tools, such as the [SQL Server Compact Toolbox](https://github.com/ErikEJ/SqlCeToolbox) and [SQL Compact data and schema script utility](https://github.com/ErikEJ/SqlCeToolbox).</span></span>
- <span data-ttu-id="d0afb-135">Vous pouvez écrire et exécuter vos propres scripts DDL (Data Definition Language) pour manipuler le schéma de la base de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-135">You can write and run your own DDL (data definition language) scripts to manipulate the database schema.</span></span>

<span data-ttu-id="d0afb-136">Vous pouvez commencer par SQL Server Compact, puis effectuer une mise à niveau ultérieurement à mesure que vos besoins évoluent.</span><span class="sxs-lookup"><span data-stu-id="d0afb-136">You can start with SQL Server Compact and then upgrade later as your needs evolve.</span></span> <span data-ttu-id="d0afb-137">Les didacticiels ultérieurs de cette série vous montrent comment migrer de SQL Server Compact vers SQL Server Express et vers SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d0afb-137">Later tutorials in this series show you how to migrate from SQL Server Compact to SQL Server Express and to SQL Server.</span></span> <span data-ttu-id="d0afb-138">Toutefois, si vous créez une nouvelle application et que vous vous attendez à ce que SQL Server dans un avenir proche, il est probablement préférable de commencer par SQL Server ou SQL Server Express.</span><span class="sxs-lookup"><span data-stu-id="d0afb-138">However, if you're creating a new application and expect to need SQL Server in the near future, it's probably best to start with SQL Server or SQL Server Express.</span></span>

## <a name="configuring-the-sql-server-compact-database-engine-for-deployment"></a><span data-ttu-id="d0afb-139">Configuration de la Moteur de base de données SQL Server Compact pour le déploiement</span><span class="sxs-lookup"><span data-stu-id="d0afb-139">Configuring the SQL Server Compact Database Engine for Deployment</span></span>

<span data-ttu-id="d0afb-140">Les logiciels requis pour l’accès aux données dans l’application Contoso University ont été ajoutés en installant les packages NuGet suivants :</span><span class="sxs-lookup"><span data-stu-id="d0afb-140">The software required for data access in the Contoso University application was added by installing the following NuGet packages:</span></span>

- [<span data-ttu-id="d0afb-141">SqlServerCompact</span><span class="sxs-lookup"><span data-stu-id="d0afb-141">SqlServerCompact</span></span>](http://nuget.org/List/Packages/SqlServerCompact)
- <span data-ttu-id="d0afb-142">[System. Web. Providers](http://nuget.org/List/Packages/System.Web.Providers) (ASP.net Universal Providers)</span><span class="sxs-lookup"><span data-stu-id="d0afb-142">[System.Web.Providers](http://nuget.org/List/Packages/System.Web.Providers) (ASP.NET universal providers)</span></span>
- [<span data-ttu-id="d0afb-143">EntityFramework</span><span class="sxs-lookup"><span data-stu-id="d0afb-143">EntityFramework</span></span>](http://nuget.org/List/Packages/EntityFramework)
- [<span data-ttu-id="d0afb-144">EntityFramework. SqlServerCompact</span><span class="sxs-lookup"><span data-stu-id="d0afb-144">EntityFramework.SqlServerCompact</span></span>](http://nuget.org/List/Packages/EntityFramework.sqlservercompact)

<span data-ttu-id="d0afb-145">Les liens pointent vers les versions actuelles de ces packages, qui peuvent être plus récents que ce qui est installé dans le projet de démarrage que vous avez téléchargé pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="d0afb-145">The links point to the current versions of these packages, which might be newer than what is installed in the starter project that you downloaded for this tutorial.</span></span> <span data-ttu-id="d0afb-146">Pour le déploiement sur un fournisseur d’hébergement, assurez-vous d’utiliser Entity Framework 5,0 ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="d0afb-146">For deployment to a hosting provider, make sure that you use Entity Framework 5.0 or later.</span></span> <span data-ttu-id="d0afb-147">Les versions antérieures de Migrations Code First requièrent une confiance totale et, dans de nombreux fournisseurs d’hébergement, votre application s’exécutera en mode de confiance moyenne.</span><span class="sxs-lookup"><span data-stu-id="d0afb-147">Earlier versions of Code First Migrations require Full Trust, and at many hosting providers your application will run in Medium Trust.</span></span> <span data-ttu-id="d0afb-148">Pour plus d’informations sur la confiance moyenne, consultez le didacticiel sur le [déploiement d’IIS en tant qu’environnement de test](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) .</span><span class="sxs-lookup"><span data-stu-id="d0afb-148">For more information about Medium Trust, see the [Deploying to IIS as a Test Environment](deployment-to-a-hosting-provider-deploying-to-iis-as-a-test-environment-5-of-12.md) tutorial.</span></span>

<span data-ttu-id="d0afb-149">L’installation du package NuGet se charge généralement de tout ce dont vous avez besoin pour déployer ce logiciel avec l’application.</span><span class="sxs-lookup"><span data-stu-id="d0afb-149">NuGet package installation generally takes care of everything that you need in order to deploy this software with the application.</span></span> <span data-ttu-id="d0afb-150">Dans certains cas, cela implique des tâches telles que la modification du fichier Web. config et l’ajout de scripts PowerShell qui s’exécutent chaque fois que vous générez la solution.</span><span class="sxs-lookup"><span data-stu-id="d0afb-150">In some cases, this involves tasks such as changing the Web.config file and adding PowerShell scripts that run whenever you build the solution.</span></span> <span data-ttu-id="d0afb-151">**Si vous souhaitez ajouter la prise en charge de l’une de ces fonctionnalités (telles que SQL Server Compact et Entity Framework) sans utiliser NuGet, assurez-vous que vous savez à quoi sert l’installation du package NuGet pour pouvoir effectuer le même travail manuellement.**</span><span class="sxs-lookup"><span data-stu-id="d0afb-151">**If you want to add support for any of these features (such as SQL Server Compact and Entity Framework) without using NuGet, make sure that you know what NuGet package installation does so that you can do the same work manually.**</span></span>

<span data-ttu-id="d0afb-152">Il existe une exception dans laquelle NuGet ne tient pas compte de tout ce que vous devez faire pour garantir la réussite du déploiement.</span><span class="sxs-lookup"><span data-stu-id="d0afb-152">There is one exception where NuGet doesn't take care of everything you have to do in order to ensure successful deployment.</span></span> <span data-ttu-id="d0afb-153">Le package NuGet SqlServerCompact ajoute un script de publication à votre projet qui copie les assemblys natifs dans des sous-dossiers *x86* et *amd64* sous le dossier *bin* du projet, mais le script n’inclut pas ces dossiers dans le projet.</span><span class="sxs-lookup"><span data-stu-id="d0afb-153">The SqlServerCompact NuGet package adds a post-build script to your project that copies the native assemblies to *x86* and *amd64* subfolders under the project *bin* folder, but the script does not include those folders in the project.</span></span> <span data-ttu-id="d0afb-154">Par conséquent, Web Deploy ne les copie pas sur le site Web de destination, sauf si vous les incluez manuellement dans le projet.</span><span class="sxs-lookup"><span data-stu-id="d0afb-154">As a result, Web Deploy will not copy them to the destination web site unless you manually include them in the project.</span></span> <span data-ttu-id="d0afb-155">(Ce comportement résulte de la configuration de déploiement par défaut ; une autre option, que vous n’utiliserez pas dans ces didacticiels, consiste à modifier le paramètre qui contrôle ce comportement.</span><span class="sxs-lookup"><span data-stu-id="d0afb-155">(This behavior results from the default deployment configuration; another option, which you won't use in these tutorials, is to change the setting that controls this behavior.</span></span> <span data-ttu-id="d0afb-156">Le paramètre que vous pouvez modifier n’est que les **fichiers nécessaires à l’exécution de l’application** sous **éléments à déployer** sous l’onglet **Package/Publication Web** de la fenêtre **Propriétés du projet** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-156">The setting that you can change is **Only files needed to run the application** under **Items to deploy** on the **Package/Publish Web** tab of the **Project Properties** window.</span></span> <span data-ttu-id="d0afb-157">La modification de ce paramètre n’est généralement pas recommandée, car cela peut entraîner le déploiement de nombreux autres fichiers dans l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-157">Changing this setting is not generally recommended because it can result in the deployment of many more files to the production environment than are needed there.</span></span> <span data-ttu-id="d0afb-158">Pour plus d’informations sur les alternatives, consultez le didacticiel sur la [Configuration des propriétés de projet](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md) .)</span><span class="sxs-lookup"><span data-stu-id="d0afb-158">For more information about the alternatives, see the [Configuring Project Properties](deployment-to-a-hosting-provider-configuring-project-properties-4-of-12.md) tutorial.)</span></span>

<span data-ttu-id="d0afb-159">Générez le projet, puis, dans **Explorateur de solutions** cliquez sur **Afficher tous les fichiers** si vous ne l’avez pas déjà fait.</span><span class="sxs-lookup"><span data-stu-id="d0afb-159">Build the project, and then in **Solution Explorer** click **Show all Files** if you have not already done so.</span></span> <span data-ttu-id="d0afb-160">Vous devrez peut-être également cliquer sur **Actualiser**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-160">You might also have to click **Refresh**.</span></span>

![Solution_Explorer_Show_All_Files](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image1.png)

<span data-ttu-id="d0afb-162">Développez le dossier **bin** pour voir les dossiers **amd64** et **x86** , puis sélectionnez ces dossiers, cliquez avec le bouton droit et sélectionnez **inclure dans le projet**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-162">Expand the **bin** folder to see the **amd64** and **x86** folders, and then select those folders, right-click, and select **Include in Project**.</span></span>

![amd64_and_x86_in_Solution_Explorer. png](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image2.png)

<span data-ttu-id="d0afb-164">Les icônes de dossier changent pour indiquer que le dossier a été inclus dans le projet.</span><span class="sxs-lookup"><span data-stu-id="d0afb-164">The folder icons change to show that the folder has been included in the project.</span></span>

![Solution_Explorer_amd64_included. png](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image3.png)

## <a name="configuring-code-first-migrations-for-application-database-deployment"></a><span data-ttu-id="d0afb-166">Configuration de Migrations Code First pour le déploiement d’une base de données d’application</span><span class="sxs-lookup"><span data-stu-id="d0afb-166">Configuring Code First Migrations for Application Database Deployment</span></span>

<span data-ttu-id="d0afb-167">Lorsque vous déployez une base de données d’application, vous ne déployez généralement pas simplement votre base de données de développement avec toutes les données qu’elle contient en production, car la plupart des données qu’elle contient sont probablement à des fins de test.</span><span class="sxs-lookup"><span data-stu-id="d0afb-167">When you deploy an application database, typically you don't simply deploy your development database with all of the data in it to production, because much of the data in it is probably there only for testing purposes.</span></span> <span data-ttu-id="d0afb-168">Par exemple, les noms des étudiants dans une base de données de test sont fictifs.</span><span class="sxs-lookup"><span data-stu-id="d0afb-168">For example, the student names in a test database are fictional.</span></span> <span data-ttu-id="d0afb-169">En revanche, il est souvent impossible de déployer uniquement la structure de la base de données, sans aucune donnée.</span><span class="sxs-lookup"><span data-stu-id="d0afb-169">On the other hand, you often can't deploy just the database structure with no data in it at all.</span></span> <span data-ttu-id="d0afb-170">Certaines des données de votre base de données de test peuvent être des données réelles et doivent être utilisées lorsque les utilisateurs commencent à utiliser l’application.</span><span class="sxs-lookup"><span data-stu-id="d0afb-170">Some of the data in your test database might be real data and must be there when users begin to use the application.</span></span> <span data-ttu-id="d0afb-171">Par exemple, votre base de données peut avoir une table qui contient des valeurs de classe valides ou des noms de service réels.</span><span class="sxs-lookup"><span data-stu-id="d0afb-171">For example, your database might have a table that contains valid grade values or real department names.</span></span>

<span data-ttu-id="d0afb-172">Pour simuler ce scénario courant, vous configurerez une méthode Migrations Code First Seed qui insère dans la base de données uniquement les données que vous souhaitez utiliser en production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-172">To simulate this common scenario, you'll configure a Code First Migrations Seed method that inserts into the database only the data that you want to be there in production.</span></span> <span data-ttu-id="d0afb-173">Cette méthode Seed n’insère pas de données de test, car elle s’exécute en production après Code First crée la base de données en production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-173">This Seed method won't insert test data because it will run in production after Code First creates the database in production.</span></span>

<span data-ttu-id="d0afb-174">Dans les versions antérieures de Code First avant la publication des migrations, il était courant que les méthodes de départ insèrent également des données de test, car avec chaque modification de modèle au cours du développement, la base de données devait être complètement supprimée et recréée à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="d0afb-174">In earlier versions of Code First before Migrations was released, it was common for Seed methods to insert test data also, because with every model change during development the database had to be completely deleted and re-created from scratch.</span></span> <span data-ttu-id="d0afb-175">Avec Migrations Code First, les données de test sont conservées après la modification de la base de données, de sorte que les données de test dans la méthode Seed ne sont pas nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d0afb-175">With Code First Migrations, test data is retained after database changes, so including test data in the Seed method is not necessary.</span></span> <span data-ttu-id="d0afb-176">Le projet que vous avez téléchargé utilise la méthode de pré-migrations pour inclure toutes les données dans la méthode Seed d’une classe d’initialiseur.</span><span class="sxs-lookup"><span data-stu-id="d0afb-176">The project you downloaded uses the pre-Migrations method of including all data in the Seed method of an initializer class.</span></span> <span data-ttu-id="d0afb-177">Dans ce didacticiel, vous allez désactiver la classe de l’initialiseur et activer les migrations.</span><span class="sxs-lookup"><span data-stu-id="d0afb-177">In this tutorial you'll disable the initializer class and enable Migrations.</span></span> <span data-ttu-id="d0afb-178">Ensuite, vous allez mettre à jour la méthode Seed dans la classe de configuration migrations afin qu’elle insère uniquement les données que vous souhaitez insérer en production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-178">Then you'll update the Seed method in the Migrations configuration class so that it inserts only data that you want to be inserted in production.</span></span>

<span data-ttu-id="d0afb-179">Le diagramme suivant illustre le schéma de la base de données d’application :</span><span class="sxs-lookup"><span data-stu-id="d0afb-179">The following diagram illustrates the schema of the application database:</span></span>

<span data-ttu-id="d0afb-180">[![School_database_diagram](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-180">[![School_database_diagram](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image4.png)</span></span>

<span data-ttu-id="d0afb-181">Pour ces didacticiels, vous supposez que les tables `Student` et `Enrollment` doivent être vides lorsque le site est déployé pour la première fois.</span><span class="sxs-lookup"><span data-stu-id="d0afb-181">For these tutorials, you'll assume that the `Student` and `Enrollment` tables should be empty when the site is first deployed.</span></span> <span data-ttu-id="d0afb-182">Les autres tables contiennent des données qui doivent être préchargées lorsque l’application est en ligne.</span><span class="sxs-lookup"><span data-stu-id="d0afb-182">The other tables contain data that has to be preloaded when the application goes live.</span></span>

<span data-ttu-id="d0afb-183">Dans la mesure où vous utiliserez Migrations Code First, vous n’avez plus besoin d’utiliser l’initialiseur de Code First **DropCreateDatabaseIfModelChanges** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-183">Since you will be using Code First Migrations, you no longer have to use the **DropCreateDatabaseIfModelChanges** Code First initializer.</span></span> <span data-ttu-id="d0afb-184">Le code de cet initialiseur se trouve dans le fichier SchoolInitializer.cs du projet ContosoUniversity. DAL.</span><span class="sxs-lookup"><span data-stu-id="d0afb-184">The code for this initializer is in the SchoolInitializer.cs file in the ContosoUniversity.DAL project.</span></span> <span data-ttu-id="d0afb-185">Un paramètre dans l’élément **appSettings** du fichier Web. config provoque l’exécution de cet initialiseur chaque fois que l’application tente d’accéder à la base de données pour la première fois :</span><span class="sxs-lookup"><span data-stu-id="d0afb-185">A setting in the **appSettings** element of the Web.config file causes this initializer to run whenever the application tries to access the database for the first time:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample1.xml?highlight=3)]

<span data-ttu-id="d0afb-186">Ouvrez le fichier Web. config de l’application et supprimez l’élément qui spécifie la classe d’initialiseur Code First de l’élément appSettings.</span><span class="sxs-lookup"><span data-stu-id="d0afb-186">Open the application Web.config file and remove the element that specifies the Code First initializer class from the appSettings element.</span></span> <span data-ttu-id="d0afb-187">L’élément appSettings ressemble maintenant à ceci :</span><span class="sxs-lookup"><span data-stu-id="d0afb-187">The appSettings element now looks like this:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample2.xml)]

> [!NOTE]
> <span data-ttu-id="d0afb-188">Pour spécifier une classe d’initialiseur, vous pouvez également appeler `Database.SetInitializer` dans la méthode `Application_Start` dans le fichier *global. asax* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-188">Another way to specify an initializer class is do it by calling `Database.SetInitializer` in the `Application_Start` method in the *Global.asax* file.</span></span> <span data-ttu-id="d0afb-189">Si vous activez des migrations dans un projet qui utilise cette méthode pour spécifier l’initialiseur, supprimez cette ligne de code.</span><span class="sxs-lookup"><span data-stu-id="d0afb-189">If you are enabling Migrations in a project that uses that method to specify the initializer, remove that line of code.</span></span>

<span data-ttu-id="d0afb-190">Ensuite, activez Migrations Code First.</span><span class="sxs-lookup"><span data-stu-id="d0afb-190">Next, enable Code First Migrations.</span></span>

<span data-ttu-id="d0afb-191">La première étape consiste à s’assurer que le projet ContosoUniversity est défini comme projet de démarrage.</span><span class="sxs-lookup"><span data-stu-id="d0afb-191">The first step is to make sure that the ContosoUniversity project is set as the startup project.</span></span> <span data-ttu-id="d0afb-192">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity et sélectionnez **définir comme projet de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-192">In **Solution Explorer**, right-click the ContosoUniversity project and select **Set as Startup Project**.</span></span> <span data-ttu-id="d0afb-193">Migrations Code First Rechercher la chaîne de connexion de base de données dans le projet de démarrage.</span><span class="sxs-lookup"><span data-stu-id="d0afb-193">Code First Migrations will look in the startup project to find the database connection string.</span></span>

<span data-ttu-id="d0afb-194">Dans le menu **Outils** , cliquez sur **Gestionnaire de package NuGet** , puis sur **console du gestionnaire de package**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-194">From the **Tools** menu, click **NuGet Package Manager** and then **Package Manager Console**.</span></span>

![Selecting_Package_Manager_Console](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image6.png)

<span data-ttu-id="d0afb-196">En haut de la fenêtre de la **console du gestionnaire de package** , sélectionnez CONTOSOUNIVERSITY. dal comme projet par défaut puis, à l’invite de `PM>`, entrez « activer-migrations ».</span><span class="sxs-lookup"><span data-stu-id="d0afb-196">At the top of the **Package Manager Console** window select ContosoUniversity.DAL as the default project and then at the `PM>` prompt enter "enable-migrations".</span></span>

![activer-migrations_command](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image7.png)

<span data-ttu-id="d0afb-198">Cette commande crée un fichier *Configuration.cs* dans un nouveau dossier *migrations* dans le projet ContosoUniversity. dal.</span><span class="sxs-lookup"><span data-stu-id="d0afb-198">This command creates a *Configuration.cs* file in a new *Migrations* folder in the ContosoUniversity.DAL project.</span></span>

![Migrations_folder_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image8.png)

<span data-ttu-id="d0afb-200">Vous avez sélectionné le projet DAL, car la commande « Activer-migrations » doit être exécutée dans le projet qui contient la classe de contexte Code First.</span><span class="sxs-lookup"><span data-stu-id="d0afb-200">You selected the DAL project because the "enable-migrations" command must be executed in the project that contains the Code First context class.</span></span> <span data-ttu-id="d0afb-201">Lorsque cette classe se trouve dans un projet de bibliothèque de classes, Migrations Code First recherche la chaîne de connexion de la base de données dans le projet de démarrage pour la solution.</span><span class="sxs-lookup"><span data-stu-id="d0afb-201">When that class is in a class library project, Code First Migrations looks for the database connection string in the startup project for the solution.</span></span> <span data-ttu-id="d0afb-202">Dans la solution ContosoUniversity, le projet Web a été défini comme projet de démarrage.</span><span class="sxs-lookup"><span data-stu-id="d0afb-202">In the ContosoUniversity solution, the web project has been set as the startup project.</span></span> <span data-ttu-id="d0afb-203">(Si vous ne souhaitez pas désigner le projet qui a la chaîne de connexion comme projet de démarrage dans Visual Studio, vous pouvez spécifier le projet de démarrage dans la commande PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d0afb-203">(If you did not want to designate the project that has the connection string as the startup project in Visual Studio, you can specify the startup project in the PowerShell command.</span></span> <span data-ttu-id="d0afb-204">Pour afficher la syntaxe de commande pour la commande Enable-migrations, vous pouvez entrer la commande « obtenir-Help Enable-migrations ».)</span><span class="sxs-lookup"><span data-stu-id="d0afb-204">To see the command syntax for the enable-migrations command, you can enter the command "get-help enable-migrations".)</span></span>

<span data-ttu-id="d0afb-205">Ouvrez le fichier Configuration.cs et remplacez les commentaires de la méthode `Seed` par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="d0afb-205">Open the Configuration.cs file and replace the comments in the `Seed` method with the following code:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample3.cs)]

<span data-ttu-id="d0afb-206">Les références à `List` comportent des lignes ondulées rouges, car vous n’avez pas encore d’instruction `using` pour son espace de noms.</span><span class="sxs-lookup"><span data-stu-id="d0afb-206">The references to `List` have red squiggly lines under them because you don't have a `using` statement for its namespace yet.</span></span> <span data-ttu-id="d0afb-207">Cliquez avec le bouton droit sur l’une des instances de `List` puis cliquez sur **résoudre**, puis sur **utilisation de System. Collections. Generic**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-207">Right-click one of the instances of `List` and click **Resolve**, and then click **using System.Collections.Generic**.</span></span>

![Résoudre avec l’instruction using](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image9.png)

<span data-ttu-id="d0afb-209">Cette sélection de menu ajoute le code suivant aux instructions `using` en haut du fichier.</span><span class="sxs-lookup"><span data-stu-id="d0afb-209">This menu selection adds the following code to the `using` statements near the top of the file.</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample4.cs)]

> [!NOTE]
> <span data-ttu-id="d0afb-210">L’ajout de code à la méthode `Seed` est l’une des nombreuses façons dont vous pouvez insérer des données fixes dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-210">Adding code to the `Seed` method is one of many ways that you can insert fixed data into the database.</span></span> <span data-ttu-id="d0afb-211">Une alternative consiste à ajouter du code aux méthodes `Up` et `Down` de chaque classe de migration.</span><span class="sxs-lookup"><span data-stu-id="d0afb-211">An alternative is to add code to the `Up` and `Down` methods of each migration class.</span></span> <span data-ttu-id="d0afb-212">Les méthodes `Up` et `Down` contiennent du code qui implémente des modifications de base de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-212">The `Up` and `Down` methods contain code that implements database changes.</span></span> <span data-ttu-id="d0afb-213">Vous y verrez des exemples dans le didacticiel sur le [déploiement d’une mise à jour de base de données](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md) .</span><span class="sxs-lookup"><span data-stu-id="d0afb-213">You'll see examples of them in the [Deploying a Database Update](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12.md) tutorial.</span></span>
> 
> <span data-ttu-id="d0afb-214">Vous pouvez également écrire du code qui exécute des instructions SQL à l’aide de la méthode `Sql`.</span><span class="sxs-lookup"><span data-stu-id="d0afb-214">You can also write code that executes SQL statements by using the `Sql` method.</span></span> <span data-ttu-id="d0afb-215">Par exemple, si vous ajoutez une colonne budget à la table Department et souhaitez initialiser tous les budgets de service à $1 000,00 dans le cadre d’une migration, vous pouvez ajouter la ligne de code suivante à la méthode `Up` pour cette migration :</span><span class="sxs-lookup"><span data-stu-id="d0afb-215">For example, if you were adding a Budget column to the Department table and wanted to initialize all department budgets to $1,000.00 as part of a migration, you could add the following line of code to the `Up` method for that migration:</span></span>
> 
> `Sql("UPDATE Department SET Budget = 1000");`
> 
> <span data-ttu-id="d0afb-216">Cet exemple présenté pour ce didacticiel utilise la méthode `AddOrUpdate` dans la méthode `Seed` de la classe `Configuration` Migrations Code First.</span><span class="sxs-lookup"><span data-stu-id="d0afb-216">This example shown for this tutorial uses the `AddOrUpdate` method in the `Seed` method of the Code First Migrations `Configuration` class.</span></span> <span data-ttu-id="d0afb-217">Migrations Code First appelle la méthode `Seed` après chaque migration, et cette méthode met à jour les lignes qui ont déjà été insérées, ou les insère si elles n’existent pas encore.</span><span class="sxs-lookup"><span data-stu-id="d0afb-217">Code First Migrations calls the `Seed` method after every migration, and this method updates rows that have already been inserted, or inserts them if they don't exist yet.</span></span> <span data-ttu-id="d0afb-218">La méthode `AddOrUpdate` peut ne pas être le meilleur choix pour votre scénario.</span><span class="sxs-lookup"><span data-stu-id="d0afb-218">The `AddOrUpdate` method might not be the best choice for your scenario.</span></span> <span data-ttu-id="d0afb-219">Pour plus d’informations, consultez la rubrique se [préoccuper de la méthode EF 4,3 AddOrUpdate](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) sur le blog de Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="d0afb-219">For more information, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

<span data-ttu-id="d0afb-220">Appuyez sur CTRL-SHIFT-B pour générer le projet.</span><span class="sxs-lookup"><span data-stu-id="d0afb-220">Press CTRL-SHIFT-B to build the project.</span></span>

<span data-ttu-id="d0afb-221">L’étape suivante consiste à créer une classe de `DbMigration` pour la migration initiale.</span><span class="sxs-lookup"><span data-stu-id="d0afb-221">The next step is to create a `DbMigration` class for the initial migration.</span></span> <span data-ttu-id="d0afb-222">Vous souhaitez que cette migration crée une nouvelle base de données. vous devez donc supprimer la base de données qui existe déjà.</span><span class="sxs-lookup"><span data-stu-id="d0afb-222">You want this migration to create a new database, so you have to delete the database that already exists.</span></span> <span data-ttu-id="d0afb-223">SQL Server Compact bases de données sont contenues dans des fichiers *. sdf* dans le dossier de données de l' *application\_* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-223">SQL Server Compact databases are contained in *.sdf* files in the *App\_Data* folder.</span></span> <span data-ttu-id="d0afb-224">Dans **Explorateur de solutions**, développez *application\_données* dans le projet ContosoUniversity pour voir les deux bases de données SQL Server Compact, qui sont représentées par des fichiers *. sdf* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-224">In **Solution Explorer**, expand *App\_Data* in the ContosoUniversity project to see the two SQL Server Compact databases, which are represented by *.sdf* files.</span></span>

<span data-ttu-id="d0afb-225">Cliquez avec le bouton droit sur le fichier *School. sdf* , puis cliquez sur **supprimer**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-225">Right-click the *School.sdf* file and click **Delete**.</span></span>

![sdf_files_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image10.png)

<span data-ttu-id="d0afb-227">Dans la fenêtre **console du gestionnaire de package** , entrez la commande « Add-migration initial » pour créer la migration initiale et la nommer « initial ».</span><span class="sxs-lookup"><span data-stu-id="d0afb-227">In the **Package Manager Console** window, enter the command "add-migration Initial" to create the initial migration and name it "Initial".</span></span>

![Add-migration_command](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image11.png)

<span data-ttu-id="d0afb-229">Migrations Code First crée un autre fichier de classe dans le dossier *migrations* , et cette classe contient le code qui crée le schéma de la base de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-229">Code First Migrations creates another class file in the *Migrations* folder, and this class contains code that creates the database schema.</span></span>

<span data-ttu-id="d0afb-230">Dans la **console du gestionnaire de package**, entrez la commande Update-Database pour créer la base de données et exécuter la méthode **Seed** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-230">In the **Package Manager Console**, enter the command "update-database" to create the database and run the **Seed** method.</span></span>

![mise à jour-database_command](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image12.png)

<span data-ttu-id="d0afb-232">(Si vous recevez une erreur indiquant qu’une table existe déjà et ne peut pas être créée, cela est probablement dû au fait que vous avez exécuté l’application après avoir supprimé la base de données et avant d’avoir exécuté `update-database`.</span><span class="sxs-lookup"><span data-stu-id="d0afb-232">(If you get an error that indicates a table already exists and can't be created, it is probably because you ran the application after you deleted the database and before you executed `update-database`.</span></span> <span data-ttu-id="d0afb-233">Dans ce cas, supprimez de nouveau le fichier *School. sdf* et relancez la commande `update-database`.)</span><span class="sxs-lookup"><span data-stu-id="d0afb-233">In that case, delete the *School.sdf* file again and retry the `update-database` command.)</span></span>

<span data-ttu-id="d0afb-234">Exécutez l'application.</span><span class="sxs-lookup"><span data-stu-id="d0afb-234">Run the application.</span></span> <span data-ttu-id="d0afb-235">La page Students est désormais vide, mais la page des formateurs contient des instructeurs.</span><span class="sxs-lookup"><span data-stu-id="d0afb-235">Now the Students page is empty but the Instructors page contains instructors.</span></span> <span data-ttu-id="d0afb-236">C’est ce que vous obtiendrez en production après avoir déployé l’application.</span><span class="sxs-lookup"><span data-stu-id="d0afb-236">This is what you will get in production after you deploy the application.</span></span>

![Empty_Students_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image13.png)

![Instructors_page_after_initial_migration](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image14.png)

<span data-ttu-id="d0afb-239">Le projet est maintenant prêt à déployer la base de données *School* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-239">The project is now ready to deploy the *School* database.</span></span>

## <a name="creating-a-membership-database-for-deployment"></a><span data-ttu-id="d0afb-240">Création d’une base de données d’appartenance pour le déploiement</span><span class="sxs-lookup"><span data-stu-id="d0afb-240">Creating a Membership Database for Deployment</span></span>

<span data-ttu-id="d0afb-241">L’application Contoso University utilise le système d’appartenance ASP.NET et l’authentification par formulaire pour authentifier et autoriser les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="d0afb-241">The Contoso University application uses the ASP.NET membership system and forms authentication to authenticate and authorize users.</span></span> <span data-ttu-id="d0afb-242">L’une de ses pages est accessible uniquement aux administrateurs.</span><span class="sxs-lookup"><span data-stu-id="d0afb-242">One of its pages is accessible only to administrators.</span></span> <span data-ttu-id="d0afb-243">Pour afficher cette page, exécutez l’application et sélectionnez **mettre à jour les crédits** dans le menu contextuel sous **cours**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-243">To see this page, run the application and select **Update Credits** from the flyout menu under **Courses**.</span></span> <span data-ttu-id="d0afb-244">L’application affiche la page **de connexion** , car seuls les administrateurs sont autorisés à utiliser la page **mettre à jour les crédits** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-244">The application displays the **Log In** page, because only administrators are authorized to use the **Update Credits** page.</span></span>

<span data-ttu-id="d0afb-245">[![Log_in_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image16.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-245">[![Log_in_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image16.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image15.png)</span></span>

<span data-ttu-id="d0afb-246">Connectez-vous en tant que « admin » à l’aide du mot de passe « pas $ w0rd » (Notez le nombre zéro à la place de la lettre « o » dans « w0rd »).</span><span class="sxs-lookup"><span data-stu-id="d0afb-246">Log in as "admin" using the password "Pas$w0rd" (notice the number zero in place of the letter "o" in "w0rd").</span></span> <span data-ttu-id="d0afb-247">Une fois que vous êtes connecté, la page **mettre à jour les crédits** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="d0afb-247">After you log in, the **Update Credits** page is displayed.</span></span>

<span data-ttu-id="d0afb-248">[![Update_Credits_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-248">[![Update_Credits_page](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image18.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image17.png)</span></span>

<span data-ttu-id="d0afb-249">Lorsque vous déployez un site pour la première fois, il est courant d’exclure la plupart ou la totalité des comptes d’utilisateur que vous créez pour le test.</span><span class="sxs-lookup"><span data-stu-id="d0afb-249">When you deploy a site for the first time, it is common to exclude most or all of the user accounts you create for testing.</span></span> <span data-ttu-id="d0afb-250">Dans ce cas, vous allez déployer un compte d’administrateur et aucun compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d0afb-250">In this case, you'll deploy an administrator account and no user accounts.</span></span> <span data-ttu-id="d0afb-251">Au lieu de supprimer manuellement les comptes de test, vous allez créer une nouvelle base de données d’appartenance qui n’a que le seul compte d’utilisateur administrateur dont vous avez besoin en production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-251">Rather than manually deleting test accounts, you'll create a new membership database that has only the one administrator user account that you need in production.</span></span>

> [!NOTE]
> <span data-ttu-id="d0afb-252">La base de données d’appartenance stocke un hachage de mots de passe de compte.</span><span class="sxs-lookup"><span data-stu-id="d0afb-252">The membership database stores a hash of account passwords.</span></span> <span data-ttu-id="d0afb-253">Pour déployer des comptes d’un ordinateur à un autre, vous devez vous assurer que les routines de hachage ne génèrent pas d’autres hachages sur le serveur de destination que sur l’ordinateur source.</span><span class="sxs-lookup"><span data-stu-id="d0afb-253">In order to deploy accounts from one machine to another, you must make sure that hashing routines don't generate different hashes on the destination server than they do on the source computer.</span></span> <span data-ttu-id="d0afb-254">Ils génèrent les mêmes hachages lorsque vous utilisez la Fournisseurs universels ASP.NET, à condition de ne pas modifier l’algorithme par défaut.</span><span class="sxs-lookup"><span data-stu-id="d0afb-254">They will generate the same hashes when you use the ASP.NET Universal Providers, as long as you don't change the default algorithm.</span></span> <span data-ttu-id="d0afb-255">L’algorithme par défaut est HMACSHA256 et est spécifié dans l’attribut de **validation** de l’élément **[machineKey](https://msdn.microsoft.com/library/w8h3skw9.aspx)** dans le fichier Web. config.</span><span class="sxs-lookup"><span data-stu-id="d0afb-255">The default algorithm is HMACSHA256 and is specified in the **validation** attribute of the **[machineKey](https://msdn.microsoft.com/library/w8h3skw9.aspx)** element in the Web.config file.</span></span>

<span data-ttu-id="d0afb-256">La base de données d’appartenance n’est pas gérée par Migrations Code First, et il n’existe aucun initialiseur automatique qui amorce la base de données avec des comptes de test (comme c’est le cas pour la base de données School).</span><span class="sxs-lookup"><span data-stu-id="d0afb-256">The membership database is not maintained by Code First Migrations, and there is no automatic initializer that seeds the database with test accounts (as there is for the School database).</span></span> <span data-ttu-id="d0afb-257">Par conséquent, pour conserver les données de test disponibles, vous allez effectuer une copie de la base de données de test avant d’en créer une nouvelle.</span><span class="sxs-lookup"><span data-stu-id="d0afb-257">Therefore, to keep test data available you'll make a copy of the test database before you create a new one.</span></span>

<span data-ttu-id="d0afb-258">Dans **Explorateur de solutions**, renommez le fichier *Aspnet. sdf* dans le dossier *application\_Data* en *ASPNET-dev. sdf*.</span><span class="sxs-lookup"><span data-stu-id="d0afb-258">In **Solution Explorer**, rename the *aspnet.sdf* file in the *App\_Data* folder to *aspnet-Dev.sdf*.</span></span> <span data-ttu-id="d0afb-259">(Ne faites pas de copie, renommez-la, vous allez créer une nouvelle base de données dans un moment.)</span><span class="sxs-lookup"><span data-stu-id="d0afb-259">(Don't make a copy, just rename it — you'll create a new database in a moment.)</span></span>

<span data-ttu-id="d0afb-260">Dans **Explorateur de solutions**, assurez-vous que le projet Web (ContosoUniversity, et non CONTOSOUNIVERSITY. dal) est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="d0afb-260">In **Solution Explorer**, make sure that the web project (ContosoUniversity, not ContosoUniversity.DAL) is selected.</span></span> <span data-ttu-id="d0afb-261">Ensuite, dans le menu **projet** , sélectionnez **configuration de ASP.net** pour exécuter l' **outil Administration de site Web**(WAT).</span><span class="sxs-lookup"><span data-stu-id="d0afb-261">Then in the **Project** menu, select **ASP.NET Configuration** to run the **Web Site Administration Tool**(WAT).</span></span>

<span data-ttu-id="d0afb-262">Sélectionnez l’onglet **Sécurité**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-262">Select the **Security** tab.</span></span>

<span data-ttu-id="d0afb-263">[![WAT_Security_tab](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-263">[![WAT_Security_tab](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image20.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image19.png)</span></span>

<span data-ttu-id="d0afb-264">Cliquez sur **créer ou gérer des rôles** et ajouter un rôle d' **administrateur** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-264">Click **Create or Manage Roles** and add an **Administrator** role.</span></span>

<span data-ttu-id="d0afb-265">[![WAT_Create_New_Role](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-265">[![WAT_Create_New_Role](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image22.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image21.png)</span></span>

<span data-ttu-id="d0afb-266">Revenez à l’onglet **sécurité** , cliquez sur **créer un utilisateur**, puis ajoutez l’utilisateur « administrateur » en tant qu’administrateur.</span><span class="sxs-lookup"><span data-stu-id="d0afb-266">Navigate back to the **Security** tab, click **Create User**, and add user "admin" as an administrator.</span></span> <span data-ttu-id="d0afb-267">Avant de cliquer sur le bouton **créer un utilisateur** dans la page **créer un utilisateur** , assurez-vous que vous activez la case à cocher **administrateur** .</span><span class="sxs-lookup"><span data-stu-id="d0afb-267">Before you click the **Create User** button on the **Create User** page, make sure that you select the **Administrator** check box.</span></span> <span data-ttu-id="d0afb-268">Le mot de passe utilisé dans ce didacticiel est « pas $ w0rd » et vous pouvez entrer une adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="d0afb-268">The password used in this tutorial is "Pas$w0rd", and you can enter any email address.</span></span>

<span data-ttu-id="d0afb-269">[![WAT_Create_User](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="d0afb-269">[![WAT_Create_User](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image24.png)](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image23.png)</span></span>

<span data-ttu-id="d0afb-270">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="d0afb-270">Close the browser.</span></span> <span data-ttu-id="d0afb-271">Dans **Explorateur de solutions**, cliquez sur le bouton Actualiser pour afficher le nouveau fichier *Aspnet. sdf* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-271">In **Solution Explorer**, click the refresh button to see the new *aspnet.sdf* file.</span></span>

![New_aspnet. sdf_in_Solution_Explorer](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image25.png)

<span data-ttu-id="d0afb-273">Cliquez avec le bouton droit sur **Aspnet. sdf** et sélectionnez **inclure dans le projet**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-273">Right-click **aspnet.sdf** and select **Include in Project**.</span></span>

## <a name="distinguishing-development-from-production-databases"></a><span data-ttu-id="d0afb-274">Distinction entre le développement et les bases de données de production</span><span class="sxs-lookup"><span data-stu-id="d0afb-274">Distinguishing Development from Production Databases</span></span>

<span data-ttu-id="d0afb-275">Dans cette section, vous allez renommer les bases de données afin que les versions de développement soient School-Dev. sdf et aspnet-Dev. sdf et que les versions de production soient School-Prod. sdf et aspnet-Prod. sdf.</span><span class="sxs-lookup"><span data-stu-id="d0afb-275">In this section, you'll rename the databases so that the development versions are School-Dev.sdf and aspnet-Dev.sdf and the production versions are School-Prod.sdf and aspnet-Prod.sdf.</span></span> <span data-ttu-id="d0afb-276">Cela n’est pas nécessaire, mais cela vous empêchera d’obtenir des versions de test et de production des bases de données confuses.</span><span class="sxs-lookup"><span data-stu-id="d0afb-276">This isn't necessary, but doing so will help keep you from getting test and production versions of the databases confused.</span></span>

<span data-ttu-id="d0afb-277">Dans **Explorateur de solutions**, cliquez sur **Actualiser** , puis développez le dossier application\_Data pour afficher la base de données School que vous avez créée précédemment. cliquez dessus avec le bouton droit et sélectionnez **inclure dans le projet**.</span><span class="sxs-lookup"><span data-stu-id="d0afb-277">In **Solution Explorer**, click **Refresh** and expand the App\_Data folder to see the School database that you created earlier; right-click it and select **Include in project**.</span></span>

![Including_School. sdf_in_project](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/_static/image26.png)

<span data-ttu-id="d0afb-279">Renommez *Aspnet. sdf* en *ASPNET-prod. sdf*.</span><span class="sxs-lookup"><span data-stu-id="d0afb-279">Rename *aspnet.sdf* to *aspnet-Prod.sdf*.</span></span>

<span data-ttu-id="d0afb-280">Renommez *School. sdf* en *School-dev. sdf*.</span><span class="sxs-lookup"><span data-stu-id="d0afb-280">Rename *School.sdf* to *School-Dev.sdf*.</span></span>

<span data-ttu-id="d0afb-281">Quand vous exécutez l’application dans Visual Studio, vous ne souhaitez pas utiliser les versions *-prod* des fichiers de base de données, mais vous souhaitez utiliser les versions *-dev* .</span><span class="sxs-lookup"><span data-stu-id="d0afb-281">When you run the application in Visual Studio you don't want to use the *-Prod* versions of the database files, you want to use *-Dev* versions.</span></span> <span data-ttu-id="d0afb-282">Par conséquent, vous devez modifier les chaînes de connexion dans le fichier Web. config afin qu’elles pointent vers les versions *-dev* des bases de données.</span><span class="sxs-lookup"><span data-stu-id="d0afb-282">Therefore you have to change the connection strings in the Web.config file so that they point to the *-Dev* versions of the databases.</span></span> <span data-ttu-id="d0afb-283">(Vous n’avez pas créé de fichier School-Prod. sdf, mais cela est OK, car Code First créera cette base de données en production la première fois que vous exécuterez votre application ici.)</span><span class="sxs-lookup"><span data-stu-id="d0afb-283">(You haven't created a School-Prod.sdf file, but that's OK because Code First will create that database in production the first time you run your app there.)</span></span>

<span data-ttu-id="d0afb-284">Ouvrez le fichier Web. config de l’application, puis localisez les chaînes de connexion :</span><span class="sxs-lookup"><span data-stu-id="d0afb-284">Open the application Web.config file, and locate the connection strings:</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample5.xml)]

<span data-ttu-id="d0afb-285">Remplacez « Aspnet. sdf » par « aspnet-Dev. sdf » et remplacez « School. sdf » par « School-Dev. sdf » :</span><span class="sxs-lookup"><span data-stu-id="d0afb-285">Change "aspnet.sdf" to "aspnet-Dev.sdf", and change "School.sdf" to "School-Dev.sdf":</span></span>

[!code-xml[Main](deployment-to-a-hosting-provider-deploying-sql-server-compact-databases-2-of-12/samples/sample6.xml?highlight=4-5)]

<span data-ttu-id="d0afb-286">Le moteur de base de données SQL Server Compact et les deux bases de données sont maintenant prêts à être déployés.</span><span class="sxs-lookup"><span data-stu-id="d0afb-286">The SQL Server Compact database engine and both databases are now ready to be deployed.</span></span> <span data-ttu-id="d0afb-287">Dans le didacticiel suivant, vous configurez des transformations de fichier *Web. config* automatiques pour les paramètres qui doivent être différents dans les environnements de développement, de test et de production.</span><span class="sxs-lookup"><span data-stu-id="d0afb-287">In the following tutorial you set up automatic *Web.config* file transformations for settings that must be different in the development, test, and production environments.</span></span> <span data-ttu-id="d0afb-288">(Parmi les paramètres qui doivent être modifiés sont les chaînes de connexion, mais vous allez les configurer ultérieurement lorsque vous créez un profil de publication.)</span><span class="sxs-lookup"><span data-stu-id="d0afb-288">(Among the settings that must be changed are the connection strings, but you'll set up those changes later when you create a publish profile.)</span></span>

## <a name="more-information"></a><span data-ttu-id="d0afb-289">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="d0afb-289">More Information</span></span>

<span data-ttu-id="d0afb-290">Pour plus d’informations sur NuGet, consultez [gérer les bibliothèques de projets avec NuGet](https://msdn.microsoft.com/magazine/hh547106.aspx) et [la documentation NuGet](http://docs.nuget.org/docs/start-here/overview).</span><span class="sxs-lookup"><span data-stu-id="d0afb-290">For more information on NuGet, see [Manage Project Libraries with NuGet](https://msdn.microsoft.com/magazine/hh547106.aspx) and [NuGet Documentation](http://docs.nuget.org/docs/start-here/overview).</span></span> <span data-ttu-id="d0afb-291">Si vous ne souhaitez pas utiliser NuGet, vous devez apprendre à analyser un package NuGet pour déterminer ce qu’il fait lorsqu’il est installé.</span><span class="sxs-lookup"><span data-stu-id="d0afb-291">If you don't want to use NuGet, you'll need to learn how to analyze a NuGet package to determine what it does when it is installed.</span></span> <span data-ttu-id="d0afb-292">(Par exemple, il peut configurer des transformations *Web. config* , configurer des scripts PowerShell pour qu’ils s’exécutent au moment de la génération, etc.) Pour en savoir plus sur le fonctionnement de NuGet, consultez la page [création et publication d’un package et d’un](http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package) [fichier de configuration et des transformations de code source](http://docs.nuget.org/docs/creating-packages/configuration-file-and-source-code-transformations).</span><span class="sxs-lookup"><span data-stu-id="d0afb-292">(For example, it might configure *Web.config* transformations, configure PowerShell scripts to run at build time, etc.) To learn more about how NuGet works, see especially [Creating and Publishing a Package](http://docs.nuget.org/docs/creating-packages/creating-and-publishing-a-package) and [Configuration File and Source Code Transformations](http://docs.nuget.org/docs/creating-packages/configuration-file-and-source-code-transformations).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d0afb-293">[Précédent](deployment-to-a-hosting-provider-introduction-1-of-12.md)
> [Suivant](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="d0afb-293">[Previous](deployment-to-a-hosting-provider-introduction-1-of-12.md)
[Next](deployment-to-a-hosting-provider-web-config-file-transformations-3-of-12.md)</span></span>
