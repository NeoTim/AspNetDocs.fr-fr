---
uid: web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
title: 'Déploiement Web ASP.NET à l’aide de Visual Studio : déploiement en production | Microsoft Docs'
author: tdykstra
description: Cette série de didacticiels vous montre comment déployer (publier) une application Web ASP.NET sur Azure App Service Web Apps ou sur un fournisseur d’hébergement tiers, par utilisez...
ms.author: riande
ms.date: 02/15/2013
ms.assetid: 416438a1-3b2f-4d27-bf53-6b76223c33bf
msc.legacyurl: /web-forms/overview/deployment/visual-studio-web-deployment/deploying-to-production
msc.type: authoredcontent
ms.openlocfilehash: ec025e757d00cbfbfbcda9408739d2593908bc07
ms.sourcegitcommit: 0cf7d06071a8ff986e6c028ac9daf0c0e7490412
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85240623"
---
# <a name="aspnet-web-deployment-using-visual-studio-deploying-to-production"></a><span data-ttu-id="ede9d-103">Déploiement Web ASP.NET à l’aide de Visual Studio : déploiement en production</span><span class="sxs-lookup"><span data-stu-id="ede9d-103">ASP.NET Web Deployment using Visual Studio: Deploying to Production</span></span>

<span data-ttu-id="ede9d-104">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="ede9d-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="ede9d-105">Télécharger le projet de démarrage</span><span class="sxs-lookup"><span data-stu-id="ede9d-105">Download Starter Project</span></span>](https://go.microsoft.com/fwlink/p/?LinkId=282627)

> <span data-ttu-id="ede9d-106">Cette série de didacticiels vous montre comment déployer (publier) une application Web ASP.NET sur Azure App Service Web Apps ou sur un fournisseur d’hébergement tiers, à l’aide de Visual Studio 2012 ou de Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="ede9d-106">This tutorial series shows you how to deploy (publish) an ASP.NET web application to Azure App Service Web Apps or to a third-party hosting provider, by using Visual Studio 2012 or Visual Studio 2010.</span></span> <span data-ttu-id="ede9d-107">Pour plus d’informations sur la série, consultez [le premier didacticiel de la série](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="ede9d-107">For information about the series, see [the first tutorial in the series](introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="ede9d-108">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="ede9d-108">Overview</span></span>

<span data-ttu-id="ede9d-109">Dans ce didacticiel, vous allez configurer un compte Microsoft Azure, créer des environnements intermédiaires et de production, puis déployer votre application Web ASP.NET dans les environnements intermédiaire et de production à l’aide de la fonctionnalité de publication en un clic de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ede9d-109">In this tutorial, you set up a Microsoft Azure account, create staging and production environments, and deploy your ASP.NET web application to the staging and production environments by using the Visual Studio one-click publish feature.</span></span>

<span data-ttu-id="ede9d-110">Si vous préférez, vous pouvez effectuer le déploiement sur un fournisseur d’hébergement tiers.</span><span class="sxs-lookup"><span data-stu-id="ede9d-110">If you prefer, you can deploy to a third-party hosting provider.</span></span> <span data-ttu-id="ede9d-111">La plupart des procédures décrites dans ce didacticiel sont les mêmes pour un fournisseur d’hébergement ou pour Azure, à ceci près que chaque fournisseur possède sa propre interface utilisateur pour la gestion des comptes et des sites Web.</span><span class="sxs-lookup"><span data-stu-id="ede9d-111">Most of the procedures described in this tutorial are the same for a hosting provider or for Azure, except that each provider has its own user interface for account and web site management.</span></span> <span data-ttu-id="ede9d-112">Vous pouvez trouver un fournisseur d’hébergement dans la [Galerie de fournisseurs](https://www.microsoft.com/web/hosting) sur le site Web Microsoft.com.</span><span class="sxs-lookup"><span data-stu-id="ede9d-112">You can find a hosting provider in the [gallery of providers](https://www.microsoft.com/web/hosting) on the Microsoft.com web site.</span></span>

<span data-ttu-id="ede9d-113">Rappel : Si vous recevez un message d’erreur ou si une action ne fonctionne pas au fur et à mesure que vous suivez le didacticiel, consultez la page de résolution des problèmes dans cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="ede9d-113">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the Troubleshooting page in this tutorial series.</span></span>

## <a name="get-a-microsoft-azure-account"></a><span data-ttu-id="ede9d-114">Obtenir un compte Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="ede9d-114">Get a Microsoft Azure account</span></span>

<span data-ttu-id="ede9d-115">Si vous n’avez pas encore de compte Azure, vous pouvez créer un compte d’évaluation gratuit en quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="ede9d-115">If you don't already have an Azure account, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="ede9d-116">Pour plus d’informations, consultez [Essai gratuit Azure](https://azure.microsoft.com/free/dotnet/).</span><span class="sxs-lookup"><span data-stu-id="ede9d-116">For details, see [Azure Free Trial](https://azure.microsoft.com/free/dotnet/).</span></span>

## <a name="create-a-staging-environment"></a><span data-ttu-id="ede9d-117">Créer un environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="ede9d-117">Create a staging environment</span></span>

> [!NOTE]
> <span data-ttu-id="ede9d-118">Depuis l’écriture de ce didacticiel, Azure App Service ajouté une nouvelle fonctionnalité pour automatiser un grand nombre des processus de création d’environnements intermédiaires et de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-118">Since this tutorial was written, Azure App Service added a new feature to automate many of the processes for creating staging and production environments.</span></span> <span data-ttu-id="ede9d-119">Consultez [configurer des environnements intermédiaires pour les applications Web dans Azure App service](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span><span class="sxs-lookup"><span data-stu-id="ede9d-119">See [Set up staging environments for web apps in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="ede9d-120">Comme expliqué dans le [didacticiel déployer dans l’environnement de test](deploying-to-iis.md), l’environnement de test le plus fiable est un site Web au niveau du fournisseur d’hébergement qui se présente comme le site Web de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-120">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), the most reliable test environment is a web site at the hosting provider that's just like the production web site.</span></span> <span data-ttu-id="ede9d-121">Chez de nombreux fournisseurs d’hébergement, vous auriez à évaluer les avantages de cette solution par rapport à des coûts supplémentaires significatifs, mais dans Azure, vous pouvez créer une application Web gratuite supplémentaire en tant qu’application intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="ede9d-121">At many hosting providers you would have to weigh the benefits of this against significant additional cost, but in Azure you can create an additional free web app as your staging app.</span></span> <span data-ttu-id="ede9d-122">Vous avez également besoin d’une base de données, et les dépenses supplémentaires pour celles-ci au détriment de votre base de données de production seront soit None, soit minimal.</span><span class="sxs-lookup"><span data-stu-id="ede9d-122">You also need a database, and the additional expense for that over the expense of your production database will be either none or minimal.</span></span> <span data-ttu-id="ede9d-123">Dans Azure, vous payez la quantité de stockage de base de données que vous utilisez plutôt que pour chaque base de données, et la quantité de stockage supplémentaire que vous allez utiliser dans la mise en lots sera minime.</span><span class="sxs-lookup"><span data-stu-id="ede9d-123">In Azure you pay for the amount of database storage you use rather than for each database, and the amount of additional storage you'll use in staging will be minimal.</span></span>

<span data-ttu-id="ede9d-124">Comme expliqué dans le [didacticiel déployer dans l’environnement de test](deploying-to-iis.md), dans intermédiaire et de production, vous allez déployer vos deux bases de données dans une seule base de données.</span><span class="sxs-lookup"><span data-stu-id="ede9d-124">As explained in the [Deploy to the Test Environment tutorial](deploying-to-iis.md), in staging and production you're going to deploy your two databases into one database.</span></span> <span data-ttu-id="ede9d-125">Si vous souhaitez les conserver séparées, le processus est le même, sauf que vous créez une base de données supplémentaire pour chaque environnement et que vous sélectionnez la chaîne de destination correcte pour chaque base de données lorsque vous créez le profil de publication.</span><span class="sxs-lookup"><span data-stu-id="ede9d-125">If you wanted to keep them separate, the process would be the same except that you'd create an additional database for each environment and you would select the correct destination string for each database when you create the publish profile.</span></span>

<span data-ttu-id="ede9d-126">Dans cette section du didacticiel, vous allez créer une application Web et une base de données à utiliser pour l’environnement intermédiaire, et vous allez effectuer un déploiement dans un environnement intermédiaire et de test avant de créer et de déployer dans l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-126">In this section of the tutorial you'll create a web app and database to use for the staging environment, and you'll deploy to staging and test there before creating and deploying to the production environment.</span></span>

> [!NOTE]
> <span data-ttu-id="ede9d-127">Les étapes suivantes montrent comment créer une application Web dans Azure App Service à l’aide du portail de gestion Azure.</span><span class="sxs-lookup"><span data-stu-id="ede9d-127">The following steps show how to create a web app in Azure App Service by using the Azure management portal.</span></span> <span data-ttu-id="ede9d-128">Dans la dernière version du kit de développement logiciel (SDK) Azure, vous pouvez également effectuer cette opération sans quitter Visual Studio, à l’aide de Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="ede9d-128">In the latest version of the Azure SDK, you can also do this without leaving Visual Studio, by using Server Explorer.</span></span> <span data-ttu-id="ede9d-129">Dans Visual Studio 2013, vous pouvez également créer une application Web directement à partir de la boîte de dialogue publier.</span><span class="sxs-lookup"><span data-stu-id="ede9d-129">In Visual Studio 2013, you can also create a web app directly from the Publish dialog.</span></span> <span data-ttu-id="ede9d-130">Pour plus d’informations, consultez [créer une application web ASP.net dans Azure App service.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span><span class="sxs-lookup"><span data-stu-id="ede9d-130">For more information, see [Create an ASP.NET web app in Azure App Service.](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet)</span></span>

1. <span data-ttu-id="ede9d-131">Dans le [portail de gestion Azure](https://manage.windowsazure.com/), cliquez sur **sites Web**, puis sur **nouveau**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-131">In the [Azure Management Portal](https://manage.windowsazure.com/), click **Websites**, and then click **New**.</span></span>
2. <span data-ttu-id="ede9d-132">Cliquez sur **site Web**, puis sur **création personnalisée**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-132">Click **Website**, and then click **Custom Create**.</span></span>

    <span data-ttu-id="ede9d-133">L’Assistant **nouveau site Web-création personnalisée** s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="ede9d-133">The **New Website - Custom Create** wizard opens.</span></span> <span data-ttu-id="ede9d-134">L’Assistant **création personnalisée** vous permet de créer un site Web et une base de données en même temps.</span><span class="sxs-lookup"><span data-stu-id="ede9d-134">The **Custom Create** wizard enables you to create a web site and a database at the same time.</span></span>
3. <span data-ttu-id="ede9d-135">Dans l’étape **créer un site Web** de l’Assistant, entrez une chaîne dans la zone **URL** à utiliser comme URL unique pour l’environnement intermédiaire de votre application.</span><span class="sxs-lookup"><span data-stu-id="ede9d-135">In the **Create Website** step of the wizard, enter a string in the **URL** box to use as the unique URL for your application's staging environment.</span></span> <span data-ttu-id="ede9d-136">Par exemple, entrez ContosoUniversity-staging123 (y compris des nombres aléatoires à la fin pour le rendre unique au cas où l’intermédiaire de ContosoUniversity est pris).</span><span class="sxs-lookup"><span data-stu-id="ede9d-136">For example, enter ContosoUniversity-staging123 (including random numbers at the end to make it unique in case ContosoUniversity-staging is taken).</span></span>

    <span data-ttu-id="ede9d-137">L’URL complète se composera du texte entré dans cette zone, ainsi que du suffixe affiché en regard de la zone.</span><span class="sxs-lookup"><span data-stu-id="ede9d-137">The complete URL will consist of what you enter here plus the suffix that you see next to the text box.</span></span>
4. <span data-ttu-id="ede9d-138">Dans la liste déroulante **région** , choisissez la région la plus proche de vous.</span><span class="sxs-lookup"><span data-stu-id="ede9d-138">In the **Region** drop-down list, choose the region that is closest to you.</span></span>

    <span data-ttu-id="ede9d-139">Ce paramètre spécifie le centre de données dans lequel votre application Web s’exécutera.</span><span class="sxs-lookup"><span data-stu-id="ede9d-139">This setting specifies which data center your web app will run in.</span></span>
5. <span data-ttu-id="ede9d-140">Dans la liste déroulante **base de données** , choisissez **créer une nouvelle base de données SQL**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-140">In the **Database** drop-down list, choose **Create a new SQL database**.</span></span>
6. <span data-ttu-id="ede9d-141">Dans la zone nom de la **chaîne de connexion de base de base** , laissez la valeur par défaut, *DefaultConnection*.</span><span class="sxs-lookup"><span data-stu-id="ede9d-141">In the **DB Connection String Name** box, leave the default value, *DefaultConnection*.</span></span>
7. <span data-ttu-id="ede9d-142">Cliquez sur la flèche qui pointe vers la droite au bas de la zone.</span><span class="sxs-lookup"><span data-stu-id="ede9d-142">Click the arrow that points to the right at the bottom of the box.</span></span>

    <span data-ttu-id="ede9d-143">L’illustration suivante montre la boîte de dialogue **créer un site Web** contenant des exemples de valeurs.</span><span class="sxs-lookup"><span data-stu-id="ede9d-143">The following illustration shows the **Create Website** dialog with sample values in it.</span></span> <span data-ttu-id="ede9d-144">L’URL et la région que vous avez entrées seront différentes.</span><span class="sxs-lookup"><span data-stu-id="ede9d-144">The URL and Region that you have entered will be different.</span></span>

    ![Créer une étape de site Web](deploying-to-production/_static/image1.png)

    <span data-ttu-id="ede9d-146">L’Assistant passe à l’étape **Specify database settings** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-146">The wizard advances to the **Specify database settings** step.</span></span>
8. <span data-ttu-id="ede9d-147">Dans la zone **nom** , entrez *ContosoUniversity* plus un nombre aléatoire pour le rendre unique, par exemple *ContosoUniversity123*.</span><span class="sxs-lookup"><span data-stu-id="ede9d-147">In the **Name** box, enter *ContosoUniversity* plus a random number to make it unique, for example *ContosoUniversity123*.</span></span>
9. <span data-ttu-id="ede9d-148">Dans la zone **serveur** , sélectionnez **nouveau SQL Database serveur**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-148">In the **Server** box, select **New SQL Database Server**.</span></span>
10. <span data-ttu-id="ede9d-149">Entrez un nom d’administrateur et un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="ede9d-149">Enter an administrator name and password.</span></span>

    <span data-ttu-id="ede9d-150">Vous n’entrez pas de nom et de mot de passe existants ici.</span><span class="sxs-lookup"><span data-stu-id="ede9d-150">You aren't entering an existing name and password here.</span></span> <span data-ttu-id="ede9d-151">Vous entrez de nouveaux nom et mot de passe que vous définissez maintenant pour les utiliser ultérieurement lorsque vous accédez à la base de données.</span><span class="sxs-lookup"><span data-stu-id="ede9d-151">You're entering a new name and password that you're defining now to use later when you access the database.</span></span>
11. <span data-ttu-id="ede9d-152">Dans la zone **région** , choisissez la même région que celle que vous avez choisie pour l’application Web.</span><span class="sxs-lookup"><span data-stu-id="ede9d-152">In the **Region** box, choose the same region that you chose for the web app.</span></span>

    <span data-ttu-id="ede9d-153">Le fait de conserver le serveur Web et le serveur de base de données dans la même région vous offre les meilleures performances et réduit les dépenses.</span><span class="sxs-lookup"><span data-stu-id="ede9d-153">Keeping the web server and the database server in the same region gives you the best performance and minimizes expenses.</span></span>
12. <span data-ttu-id="ede9d-154">Cliquez sur la coche en bas de la zone pour indiquer que vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="ede9d-154">Click the check mark at the bottom of the box to indicate that you're finished.</span></span>

    <span data-ttu-id="ede9d-155">L’illustration suivante montre la boîte de dialogue **spécifier les paramètres de base de données** avec des exemples de valeurs.</span><span class="sxs-lookup"><span data-stu-id="ede9d-155">The following illustration shows the **Specify database settings** dialog with sample values in it.</span></span> <span data-ttu-id="ede9d-156">Les valeurs que vous avez entrées peuvent être différentes.</span><span class="sxs-lookup"><span data-stu-id="ede9d-156">The values you have entered may be different.</span></span>

    ![Étape des paramètres de base de données du nouveau site Web-Assistant créer avec base de données](deploying-to-production/_static/image2.png)

    <span data-ttu-id="ede9d-158">La Portail de gestion retourne à la page sites Web, et la colonne **État** indique que l’application Web est en cours de création.</span><span class="sxs-lookup"><span data-stu-id="ede9d-158">The Management Portal returns to the Websites page, and the **Status** column shows that the web app is being created.</span></span> <span data-ttu-id="ede9d-159">Après un certain temps (généralement inférieur à une minute), la colonne **État** indique que l’application Web a été créée avec succès.</span><span class="sxs-lookup"><span data-stu-id="ede9d-159">After a while (typically less than a minute), the **Status** column shows that the web app was successfully created.</span></span> <span data-ttu-id="ede9d-160">Dans la barre de navigation de gauche, le nombre d’applications Web que vous avez dans votre compte apparaît en regard de l’icône de **sites Web** , et le nombre de bases de données s’affiche en regard de l’icône **bases de données SQL** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-160">In the navigation bar at the left, the number of web apps you have in your account appears next to the **Websites** icon, and the number of databases appears next to the **SQL Databases** icon.</span></span>

    ![Page sites Web de Portail de gestion, site Web créé](deploying-to-production/_static/image3.png)

    <span data-ttu-id="ede9d-162">Le nom de votre application Web sera différent de l’exemple d’application dans l’illustration.</span><span class="sxs-lookup"><span data-stu-id="ede9d-162">Your web app name will be different from the example app in the illustration.</span></span>

## <a name="deploy-the-application-to-staging"></a><span data-ttu-id="ede9d-163">Déployer l’application dans un environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="ede9d-163">Deploy the application to staging</span></span>

<span data-ttu-id="ede9d-164">Maintenant que vous avez créé une application Web et une base de données pour l’environnement intermédiaire, vous pouvez y déployer le projet.</span><span class="sxs-lookup"><span data-stu-id="ede9d-164">Now that you have created a web app and database for the staging environment, you can deploy the project to it.</span></span>

> [!NOTE]
> <span data-ttu-id="ede9d-165">Ces instructions indiquent comment créer un profil de publication en téléchargeant un fichier *. publishsettings* , qui fonctionne non seulement pour Azure, mais également pour les fournisseurs d’hébergement tiers.</span><span class="sxs-lookup"><span data-stu-id="ede9d-165">These instructions show how to create a publish profile by downloading a *.publishsettings* file, which works not only for Azure but also for third-party hosting providers.</span></span> <span data-ttu-id="ede9d-166">Le dernier Kit de développement logiciel (SDK) Azure vous permet également de vous connecter directement à Azure à partir de Visual Studio et de choisir parmi une liste d’applications Web dont vous disposez dans votre compte Azure.</span><span class="sxs-lookup"><span data-stu-id="ede9d-166">The latest Azure SDK also enables you to connect directly to Azure from Visual Studio, and choose from a list of web apps that you have in your Azure account.</span></span> <span data-ttu-id="ede9d-167">Dans Visual Studio 2013, vous pouvez vous connecter à Azure à partir de la boîte de dialogue publier sur le **Web** ou de la fenêtre **Explorateur de serveurs** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-167">In Visual Studio 2013, you can sign in to Azure from the **Web Publish** dialog or from the **Server Explorer** window.</span></span> <span data-ttu-id="ede9d-168">Pour plus d’informations, consultez [créer une application web ASP.net dans Azure App service](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span><span class="sxs-lookup"><span data-stu-id="ede9d-168">For more information, see [Create an ASP.NET web app in Azure App Service](https://docs.microsoft.com/azure/app-service-web/app-service-web-get-started-dotnet).</span></span>

### <a name="download-the-publishsettings-file"></a><span data-ttu-id="ede9d-169">Télécharger le fichier. publishsettings</span><span class="sxs-lookup"><span data-stu-id="ede9d-169">Download the .publishsettings file</span></span>

1. <span data-ttu-id="ede9d-170">Cliquez sur le nom de l’application Web que vous venez de créer.</span><span class="sxs-lookup"><span data-stu-id="ede9d-170">Click the name of the web app that you just created.</span></span>

    ![Cliquez sur le site pour accéder au tableau de bord.](deploying-to-production/_static/image4.png)
2. <span data-ttu-id="ede9d-172">Sous **Aperçu rapide** de l’onglet **tableau de bord** , cliquez sur Télécharger le profil de **publication**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-172">Under **Quick glance** in the **Dashboard** tab, click **Download publish profile**.</span></span>

    ![Télécharger le lien du profil de publication](deploying-to-production/_static/image5.png)

    <span data-ttu-id="ede9d-174">Cette étape télécharge un fichier qui contient tous les paramètres dont vous avez besoin pour déployer une application sur votre application Web.</span><span class="sxs-lookup"><span data-stu-id="ede9d-174">This step downloads a file that contains all of the settings that you need in order to deploy an application to your web app.</span></span> <span data-ttu-id="ede9d-175">Vous allez importer ce fichier dans Visual Studio pour ne pas avoir à entrer ces informations manuellement.</span><span class="sxs-lookup"><span data-stu-id="ede9d-175">You'll import this file into Visual Studio so you don't have to enter this information manually.</span></span>
3. <span data-ttu-id="ede9d-176">Enregistrez le fichier *. publishsettings* dans un dossier auquel vous pouvez accéder à partir de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ede9d-176">Save the *.publishsettings* file in a folder that you can access from Visual Studio.</span></span>

    ![enregistrement du fichier. publishsettings](deploying-to-production/_static/image6.png)

    > [!WARNING]
    > <span data-ttu-id="ede9d-178">Sécurité : le fichier *. publishsettings* contient vos informations d’identification (non codées) utilisées pour gérer vos abonnements et services Azure.</span><span class="sxs-lookup"><span data-stu-id="ede9d-178">Security - The *.publishsettings* file contains your credentials (unencoded) that are used to administer your Azure subscriptions and services.</span></span> <span data-ttu-id="ede9d-179">Pour des raisons de sécurité, il est recommandé de stocker ce fichier temporairement en dehors de vos répertoires sources (par exemple, dans le dossier Bibliothèques\Documents), puis de le supprimer une fois l'importation terminée.</span><span class="sxs-lookup"><span data-stu-id="ede9d-179">The security best practice for this file is to store it temporarily outside your source directories (for example in the Libraries\Documents folder), and then delete it once the import has completed.</span></span> <span data-ttu-id="ede9d-180">Un utilisateur malveillant qui accède au fichier *. publishsettings* peut modifier, créer et supprimer vos services Azure.</span><span class="sxs-lookup"><span data-stu-id="ede9d-180">A malicious user who gains access to the *.publishsettings* file can edit, create, and delete your Azure services.</span></span>

### <a name="create-a-publish-profile"></a><span data-ttu-id="ede9d-181">Créer un profil de publication</span><span class="sxs-lookup"><span data-stu-id="ede9d-181">Create a publish profile</span></span>

1. <span data-ttu-id="ede9d-182">Dans Visual Studio, cliquez avec le bouton droit sur le projet ContosoUniversity dans **Explorateur de solutions** , puis sélectionnez **publier** dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="ede9d-182">In Visual Studio, right-click the ContosoUniversity project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    <span data-ttu-id="ede9d-183">L'Assistant **Publier le site Web** s'ouvre.</span><span class="sxs-lookup"><span data-stu-id="ede9d-183">The **Publish Web** wizard opens.</span></span>
2. <span data-ttu-id="ede9d-184">Cliquez sur l’onglet **Profil** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-184">Click the **Profile** tab.</span></span>
3. <span data-ttu-id="ede9d-185">Cliquez sur **Importer**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-185">Click **Import**.</span></span>
4. <span data-ttu-id="ede9d-186">Accédez au fichier *. publishsettings* que vous avez téléchargé précédemment, puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-186">Navigate to the *.publishsettings* file you downloaded earlier, and then click **Open**.</span></span>

    ![Boîte de dialogue Importer les paramètres de publication](deploying-to-production/_static/image7.png)
5. <span data-ttu-id="ede9d-188">Dans l’onglet **connexion** , cliquez sur **valider la connexion** pour vous assurer que les paramètres sont corrects.</span><span class="sxs-lookup"><span data-stu-id="ede9d-188">In the **Connection** tab, click **Validate Connection** to make sure that the settings are correct.</span></span>

    <span data-ttu-id="ede9d-189">Une fois la connexion validée, une coche verte s’affiche en regard du bouton **valider la connexion** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-189">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span>

    <span data-ttu-id="ede9d-190">Pour certains fournisseurs d’hébergement, lorsque vous cliquez sur **valider la connexion**, une boîte de dialogue **erreur de certificat** peut s’afficher.</span><span class="sxs-lookup"><span data-stu-id="ede9d-190">For some hosting providers, when you click **Validate Connection**, you might see a **Certificate Error** dialog box.</span></span> <span data-ttu-id="ede9d-191">Si vous le faites, vérifiez que le nom du serveur correspond à ce que vous attendez.</span><span class="sxs-lookup"><span data-stu-id="ede9d-191">If you do, verify that the server name is what you expect.</span></span> <span data-ttu-id="ede9d-192">Si le nom du serveur est correct, sélectionnez **enregistrer ce certificat pour les futures sessions de Visual Studio** , puis cliquez sur **accepter**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-192">If the server name is correct, select **Save this certificate for future sessions of Visual Studio** and click **Accept**.</span></span> <span data-ttu-id="ede9d-193">(Cette erreur signifie que le fournisseur d’hébergement a choisi d’éviter les dépenses liées à l’achat d’un certificat SSL pour l’URL vers laquelle vous effectuez le déploiement.</span><span class="sxs-lookup"><span data-stu-id="ede9d-193">(This error means that the hosting provider has chosen to avoid the expense of purchasing an SSL certificate for the URL that you are deploying to.</span></span> <span data-ttu-id="ede9d-194">Si vous préférez établir une connexion sécurisée à l’aide d’un certificat valide, contactez votre fournisseur d’hébergement.)</span><span class="sxs-lookup"><span data-stu-id="ede9d-194">If you prefer to establish a secure connection by using a valid certificate, contact your hosting provider.)</span></span>
6. <span data-ttu-id="ede9d-195">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-195">Click **Next**.</span></span>

    ![icône connexion réussie et bouton suivant dans l’onglet connexion](deploying-to-production/_static/image8.png)
7. <span data-ttu-id="ede9d-197">Dans l’onglet **paramètres** , développez **options de publication de fichiers**, puis sélectionnez **exclure des fichiers du \_ dossier de données d’application**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-197">In the **Settings** tab, expand **File Publish Options**, and then select **Exclude files from the App\_Data folder**.</span></span>

    <span data-ttu-id="ede9d-198">Pour plus d’informations sur les autres options disponibles sous **options de publication de fichier**, consultez le didacticiel [déploiement sur IIS](deploying-to-iis.md) .</span><span class="sxs-lookup"><span data-stu-id="ede9d-198">For information about the other options under **File Publish Options**, see the [deploying to IIS](deploying-to-iis.md) tutorial.</span></span> <span data-ttu-id="ede9d-199">La capture d’écran qui montre le résultat de cette étape et les étapes de configuration de base de données suivantes se trouve à la fin des étapes de configuration de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ede9d-199">The screen shot that shows the result of this step and the following database configuration steps is at the end of the database configuration steps.</span></span>
8. <span data-ttu-id="ede9d-200">Sous **DefaultConnection** dans la section **bases de données** , configurez le déploiement de base de données pour la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="ede9d-200">Under **DefaultConnection** in the **Databases** section, configure database deployment for the membership database.</span></span>
9. 1. <span data-ttu-id="ede9d-201">Sélectionnez **mettre à jour la base de données**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-201">Select **Update database**.</span></span>

        <span data-ttu-id="ede9d-202">La zone **chaîne de connexion distante** située directement sous **DefaultConnection** est renseignée avec la chaîne de connexion du fichier. publishsettings. La chaîne de connexion comprend SQL Server informations d’identification, qui sont stockées en texte brut dans le fichier *. pubxml* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-202">The **Remote connection string** box directly below **DefaultConnection** is filled in with the connection string from the .publishsettings file.The connection string includes SQL Server credentials, which are stored in plain text in the *.pubxml* file.</span></span> <span data-ttu-id="ede9d-203">Si vous préférez ne pas les stocker de manière permanente, vous pouvez les supprimer du profil de publication après le déploiement de la base de données et les stocker dans Azure à la place.</span><span class="sxs-lookup"><span data-stu-id="ede9d-203">If you prefer not to store them permanently there, you can remove them from the publish profile after the database is deployed and store them in Azure instead.</span></span> <span data-ttu-id="ede9d-204">Pour plus d’informations, consultez [Comment garder vos chaînes de connexion de base de données ASP.NET sécurisées lors du déploiement sur Azure à partir de la source](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) sur le blog de Scott Hanselman.</span><span class="sxs-lookup"><span data-stu-id="ede9d-204">For more information, see [How to keep your ASP.NET database connection strings secure when deploying to Azure from Source](http://www.hanselman.com/blog/HowToKeepYourASPNETDatabaseConnectionStringsSecureWhenDeployingToAzureFromSource.aspx) on Scott Hanselman's blog.</span></span>
      2. <span data-ttu-id="ede9d-205">Cliquez sur **configurer les mises à jour de la base de données**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-205">Click **Configure database updates**.</span></span>
      3. <span data-ttu-id="ede9d-206">Dans la boîte de dialogue **configurer les mises à jour de la base de données** , cliquez sur **Ajouter un script SQL**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-206">In the **Configure Database Updates** dialog box, click **Add SQL Script**.</span></span>
      4. <span data-ttu-id="ede9d-207">Dans la zone **Ajouter un script SQL** , accédez au script *ASPNET-Data-prod. SQL* que vous avez enregistré précédemment dans le dossier de la solution, puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-207">In the **Add SQL Script** box, navigate to the *aspnet-data-prod.sql* script that you saved earlier in the solution folder, and then click **Open**.</span></span>
      5. <span data-ttu-id="ede9d-208">Fermez la boîte **de dialogue Configurer les mises à jour de la base de données** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-208">Close the **Configure Database Updates** dialog box.</span></span>
10. <span data-ttu-id="ede9d-209">Sous **SchoolContext** dans la section **bases de données** , sélectionnez **exécuter migrations code First (s’exécute au démarrage de l’application)**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-209">Under **SchoolContext** in the **Databases** section, select **Execute Code First Migrations (runs on application start)**.</span></span>

    <span data-ttu-id="ede9d-210">Visual Studio affiche **exécuter migrations code First** au lieu de **mettre à jour la base de données** pour les `DbContext` classes.</span><span class="sxs-lookup"><span data-stu-id="ede9d-210">Visual Studio displays **Execute Code First Migrations** instead of **Update Database** for `DbContext` classes.</span></span> <span data-ttu-id="ede9d-211">Si vous souhaitez utiliser le fournisseur dbDacFx au lieu des migrations pour déployer une base de données à laquelle vous accédez à l’aide d’une `DbContext` classe, consultez [Comment faire déployer une base de données Code First sans migrations ?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) dans le Forum aux questions sur le déploiement Web pour Visual Studio et ASP.net sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="ede9d-211">If you want to use the dbDacFx provider instead of Migrations to deploy a database that you access by using a `DbContext` class, see [How do I deploy a Code First database without Migrations?](https://msdn.microsoft.com/library/ee942158.aspx#deploy_code_first_without_migrations) in the Web Deployment FAQ for Visual Studio and ASP.NET on MSDN.</span></span>

    <span data-ttu-id="ede9d-212">L’onglet **paramètres** ressemble maintenant à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="ede9d-212">The **Settings** tab now looks like the following example:</span></span>

    ![Onglet Paramètres pour la mise en lots](deploying-to-production/_static/image9.png)
11. <span data-ttu-id="ede9d-214">Pour enregistrer le profil et le renommer en *intermédiaire*, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="ede9d-214">Perform the following steps to save the profile and rename it to *Staging*:</span></span>

    1. <span data-ttu-id="ede9d-215">Cliquez sur l’onglet **Profil** , puis sur **gérer les profils**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-215">Click the **Profile** tab, and then click **Manage Profiles**.</span></span>
    2. <span data-ttu-id="ede9d-216">L’importation a créé deux nouveaux profils, un pour FTP et un pour Web Deploy.</span><span class="sxs-lookup"><span data-stu-id="ede9d-216">The import created two new profiles, one for FTP and one for Web Deploy.</span></span> <span data-ttu-id="ede9d-217">Vous avez configuré le profil de Web Deploy : renommez ce profil en *intermédiaire*.</span><span class="sxs-lookup"><span data-stu-id="ede9d-217">You configured the Web Deploy profile: rename this profile to *Staging*.</span></span>

        ![Renommer le profil en intermédiaire](deploying-to-production/_static/image10.png)
    3. <span data-ttu-id="ede9d-219">Fermez la boîte de dialogue **modifier les profils de publication Web** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-219">Close the **Edit Web Publish Profiles** dialog box.</span></span>
    4. <span data-ttu-id="ede9d-220">Fermez l’Assistant **publier le site Web** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-220">Close the **Publish Web** wizard.</span></span>

### <a name="configure-a-publish-profile-transform-for-the-environment-indicator"></a><span data-ttu-id="ede9d-221">Configurer une transformation de profil de publication pour l’indicateur d’environnement</span><span class="sxs-lookup"><span data-stu-id="ede9d-221">Configure a publish profile transform for the environment indicator</span></span>

> [!NOTE]
> <span data-ttu-id="ede9d-222">Cette section montre comment configurer une transformation de Web.config pour l’indicateur d’environnement.</span><span class="sxs-lookup"><span data-stu-id="ede9d-222">This section shows how to set up a Web.config transform for the environment indicator.</span></span> <span data-ttu-id="ede9d-223">Étant donné que l’indicateur se trouve dans l' `<appSettings>` élément, vous disposez d’une autre solution pour spécifier la transformation lorsque vous effectuez le déploiement sur Azure App service.</span><span class="sxs-lookup"><span data-stu-id="ede9d-223">Because the indicator is in the `<appSettings>` element, you have another alternative for specifying the transformation when you're deploying to Azure App Service.</span></span> <span data-ttu-id="ede9d-224">Pour plus d’informations, consultez [spécification des paramètres de Web.config dans Azure](web-config-transformations.md#watransforms).</span><span class="sxs-lookup"><span data-stu-id="ede9d-224">For more information, see [Specifying Web.config settings in Azure](web-config-transformations.md#watransforms).</span></span>

1. <span data-ttu-id="ede9d-225">Dans **Explorateur de solutions**, développez **Propriétés**, puis **PublishProfiles**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-225">In **Solution Explorer**, expand **Properties**, and then expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="ede9d-226">Cliquez avec le bouton droit sur *Staging. pubxml*, puis cliquez sur **Ajouter une transformation de configuration**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-226">Right-click *Staging.pubxml*, and then click **Add Config Transform**.</span></span>

    ![Ajouter une transformation de configuration pour la mise en lots](deploying-to-production/_static/image11.png)

    <span data-ttu-id="ede9d-228">Visual Studio crée le fichier de transformation *Web.Staging.config* et l’ouvre.</span><span class="sxs-lookup"><span data-stu-id="ede9d-228">Visual Studio creates the *Web.Staging.config* transform file and opens it.</span></span>
3. <span data-ttu-id="ede9d-229">Dans le fichier de transformation *Web.Staging.config* , insérez le code suivant immédiatement après la `configuration` balise d’ouverture.</span><span class="sxs-lookup"><span data-stu-id="ede9d-229">In the *Web.Staging.config* transform file, insert the following code immediately after the opening `configuration` tag.</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample1.xml)]

    <span data-ttu-id="ede9d-230">Lorsque vous utilisez le profil de publication intermédiaire, cette transformation définit l’indicateur d’environnement sur « prod ».</span><span class="sxs-lookup"><span data-stu-id="ede9d-230">When you use the Staging publish profile, this transform sets the environment indicator to "Prod".</span></span> <span data-ttu-id="ede9d-231">Dans l’application Web déployée, vous ne verrez aucun suffixe tel que « (dev) » ou « (test) » après l’en-tête « Contoso University » H1.</span><span class="sxs-lookup"><span data-stu-id="ede9d-231">In the deployed web app, you won't see any suffix such as "(Dev)" or "(Test)" after the "Contoso University" H1 heading.</span></span>
4. <span data-ttu-id="ede9d-232">Cliquez avec le bouton droit sur le fichier *Web.Staging.config* , puis cliquez sur Aperçu de la **transformation** pour vous assurer que la transformation que vous avez codée produit les modifications attendues.</span><span class="sxs-lookup"><span data-stu-id="ede9d-232">Right-click the *Web.Staging.config* file and click **Preview Transform** to make sure that the transform you coded produces the expected changes.</span></span>

    <span data-ttu-id="ede9d-233">La fenêtre d' **Aperçu duWeb.config** affiche le résultat de l’application des transformations *Web.Release.config* et des transformations *Web.Staging.config* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-233">The **Web.config Preview** window shows the result of applying both the *Web.Release.config* transforms and the *Web.Staging.config* transforms.</span></span>

### <a name="prevent-public-use-of-the-test-app"></a><span data-ttu-id="ede9d-234">Empêcher l’utilisation publique de l’application de test</span><span class="sxs-lookup"><span data-stu-id="ede9d-234">Prevent public use of the test app</span></span>

<span data-ttu-id="ede9d-235">Une considération importante pour l’application intermédiaire est qu’elle est en ligne sur Internet, mais que vous ne voulez pas que le public l’utilise.</span><span class="sxs-lookup"><span data-stu-id="ede9d-235">An important consideration for the staging app is that it will be live on the Internet, but you don't want the public to use it.</span></span> <span data-ttu-id="ede9d-236">Pour réduire la probabilité que les gens la trouvent et l’utilisent, vous pouvez utiliser une ou plusieurs des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="ede9d-236">To minimize the likelihood that people will find and use it, you can use one or more of the following methods:</span></span>

- <span data-ttu-id="ede9d-237">Définir des règles de pare-feu qui autorisent l’accès à l’application intermédiaire uniquement à partir d’adresses IP que vous utilisez pour tester la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="ede9d-237">Set firewall rules that allow access to the staging app only from IP addresses that you use to test staging.</span></span>
- <span data-ttu-id="ede9d-238">Utilisez une URL obscurcie qui serait impossible à deviner.</span><span class="sxs-lookup"><span data-stu-id="ede9d-238">Use an obfuscated URL that would be impossible to guess.</span></span>
- <span data-ttu-id="ede9d-239">Créez un fichier de *robots.txt* pour vous assurer que les moteurs de recherche n’analyseront pas l’application de test et les liens de rapport vers ce dernier dans les résultats de la recherche.</span><span class="sxs-lookup"><span data-stu-id="ede9d-239">Create a *robots.txt* file to ensure that search engines will not crawl the test app and report links to it in search results.</span></span>

<span data-ttu-id="ede9d-240">La première de ces méthodes est la plus efficace, mais n’est pas traitée dans ce didacticiel, car elle nécessiterait le déploiement vers un service Cloud Azure au lieu de Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="ede9d-240">The first of these methods is the most effective but is not covered in this tutorial because it would require that you deploy to an Azure Cloud Service instead of Azure App Service.</span></span> <span data-ttu-id="ede9d-241">Pour plus d’informations sur les services Cloud et les restrictions d’adresse IP dans Azure, consultez [options d’hébergement de calcul fournies par Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) et [empêcher des adresses IP spécifiques d’accéder à un rôle Web](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span><span class="sxs-lookup"><span data-stu-id="ede9d-241">For more information about Cloud Services and IP restrictions in Azure, see [Compute Hosting Options Provided by Azure](https://docs.microsoft.com/azure/cloud-services/cloud-services-choose-me) and [Block Specific IP Addresses from Accessing a Web Role](https://msdn.microsoft.com/library/windowsazure/jj154098.aspx).</span></span> <span data-ttu-id="ede9d-242">Si vous déployez sur un fournisseur d’hébergement tiers, contactez le fournisseur pour savoir comment implémenter des restrictions d’adresse IP.</span><span class="sxs-lookup"><span data-stu-id="ede9d-242">If you are deploying to a third-party hosting provider, contact the provider to find out how to implement IP restrictions.</span></span>

<span data-ttu-id="ede9d-243">Pour ce didacticiel, vous allez créer un fichier *robots.txt* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-243">For this tutorial, you'll create a *robots.txt* file.</span></span>

1. <span data-ttu-id="ede9d-244">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet ContosoUniversity, puis cliquez sur **Ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-244">In **Solution Explorer**, right-click the ContosoUniversity project and click **Add New Item**.</span></span>
2. <span data-ttu-id="ede9d-245">Créez un **fichier texte** nommé *robots.txt*et placez-y le texte suivant :</span><span class="sxs-lookup"><span data-stu-id="ede9d-245">Create a new **Text File** named *robots.txt*, and put the following text in it:</span></span>

    [!code-console[Main](deploying-to-production/samples/sample2.cmd)]

    <span data-ttu-id="ede9d-246">La `User-agent` ligne indique aux moteurs de recherche que les règles du fichier s’appliquent à tous les robots d’indexation (robots) du moteur de recherche, et la `Disallow` ligne spécifie qu’aucune page du site ne doit être analysée.</span><span class="sxs-lookup"><span data-stu-id="ede9d-246">The `User-agent` line tells search engines that the rules in the file apply to all search engine web crawlers (robots), and the `Disallow` line specifies that no pages on the site should be crawled.</span></span>

    <span data-ttu-id="ede9d-247">Vous souhaitez que les moteurs de recherche cataloguent votre application de production. vous devez donc exclure ce fichier du déploiement de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-247">You do want search engines to catalog your production app, so you need to exclude this file from production deployment.</span></span> <span data-ttu-id="ede9d-248">Pour ce faire, vous configurez un paramètre dans le profil de publication de production lorsque vous le créez.</span><span class="sxs-lookup"><span data-stu-id="ede9d-248">To do that, you'll configure a setting in the Production publish profile when you create it.</span></span>

### <a name="deploy-to-staging"></a><span data-ttu-id="ede9d-249">Déployer vers un environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="ede9d-249">Deploy to staging</span></span>

1. <span data-ttu-id="ede9d-250">Ouvrez l’Assistant **publier le site Web** en cliquant avec le bouton droit sur le projet Contoso University et en cliquant sur **publier**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-250">Open the **Publish Web** wizard by right-clicking the Contoso University project and clicking **Publish**.</span></span>
2. <span data-ttu-id="ede9d-251">Assurez-vous que le profil **intermédiaire** est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="ede9d-251">Make sure that the **Staging** profile is selected.</span></span>
3. <span data-ttu-id="ede9d-252">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-252">Click **Publish**.</span></span>

    <span data-ttu-id="ede9d-253">La fenêtre **Output** indique les actions de déploiement entreprises et signale la réussite du déploiement.</span><span class="sxs-lookup"><span data-stu-id="ede9d-253">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span> <span data-ttu-id="ede9d-254">Le navigateur par défaut s’ouvre automatiquement à l’URL de l’application Web déployée.</span><span class="sxs-lookup"><span data-stu-id="ede9d-254">The default browser automatically opens to the URL of the deployed web app.</span></span>

## <a name="test-in-the-staging-environment"></a><span data-ttu-id="ede9d-255">Test dans l’environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="ede9d-255">Test in the staging environment</span></span>

<span data-ttu-id="ede9d-256">Notez que l’indicateur d’environnement est absent (il n’y a pas de « (test) » ou « (dev) » après l’en-tête H1, qui indique que la transformation de *Web.config* pour l’indicateur d’environnement a réussi.</span><span class="sxs-lookup"><span data-stu-id="ede9d-256">Notice that the environment indicator is absent (there is no "(Test)" or "(Dev)" after the H1 heading, which shows that the *Web.config* transformation for the environment indicator was successful.</span></span>

![Mise en lots des pages d’hébergement](deploying-to-production/_static/image12.png)

<span data-ttu-id="ede9d-258">Exécutez la page **students** pour vérifier que la base de données déployée ne dispose d’aucun étudiant.</span><span class="sxs-lookup"><span data-stu-id="ede9d-258">Run the **Students** page to verify that the deployed database has no students.</span></span>

<span data-ttu-id="ede9d-259">Exécutez la page des **enseignants** pour vérifier que code First amorcé la base de données avec les données de l’instructeur :</span><span class="sxs-lookup"><span data-stu-id="ede9d-259">Run the **Instructors** page to verify that Code First seeded the database with instructor data:</span></span>

<span data-ttu-id="ede9d-260">Sélectionnez **Ajouter des élèves** dans le menu **élèves** , ajoutez un étudiant, puis affichez le nouvel étudiant dans la page des **étudiants** pour vérifier que vous pouvez écrire correctement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ede9d-260">Select **Add Students** from the **Students** menu, add a student, and then view the new student in the **Students** page to verify that you can successfully write to the database.</span></span>

<span data-ttu-id="ede9d-261">Sur la page **cours** , cliquez sur **mettre à jour les crédits**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-261">From the **Courses** page, click **Update Credits**.</span></span> <span data-ttu-id="ede9d-262">La page **mettre à jour les crédits** requiert des autorisations d’administrateur, donc la page **de connexion** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="ede9d-262">The **Update Credits** page requires administrator permissions, so the **Log In** page is displayed.</span></span> <span data-ttu-id="ede9d-263">Entrez les informations d’identification du compte d’administrateur que vous avez créées précédemment (« admin » et « prodpwd »).</span><span class="sxs-lookup"><span data-stu-id="ede9d-263">Enter the administrator account credentials that you created earlier ("admin" and "prodpwd").</span></span> <span data-ttu-id="ede9d-264">La page **mettre à jour les crédits** s’affiche, qui vérifie que le compte d’administrateur que vous avez créé dans le didacticiel précédent a été correctement déployé dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="ede9d-264">The **Update Credits** page is displayed, which verifies that the administrator account that you created in the previous tutorial was correctly deployed to the test environment.</span></span>

<span data-ttu-id="ede9d-265">Demandez une URL non valide pour provoquer une erreur que ELMAH effectue le suivi, puis demandez le rapport d’erreurs ELMAH.</span><span class="sxs-lookup"><span data-stu-id="ede9d-265">Request an invalid URL to cause an error that ELMAH will track, and then request the ELMAH error report.</span></span> <span data-ttu-id="ede9d-266">Si vous déployez sur un fournisseur d’hébergement tiers, vous constaterez probablement que le rapport est vide pour la raison pour laquelle il était vide dans le didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="ede9d-266">If you are deploying to a third-party hosting provider, you will probably find that the report is empty for the same reason that it was empty in the previous tutorial.</span></span> <span data-ttu-id="ede9d-267">Vous devrez utiliser les outils de gestion de compte du fournisseur d’hébergement pour configurer les autorisations de dossier afin de permettre à ELMAH d’écrire dans le dossier du journal.</span><span class="sxs-lookup"><span data-stu-id="ede9d-267">You will have to use the hosting provider's account management tools to configure folder permissions to enable ELMAH to write to the log folder.</span></span>

<span data-ttu-id="ede9d-268">L’application que vous avez créée est maintenant exécutée dans le Cloud dans une application Web comme ce que vous allez utiliser pour la production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-268">The application that you created is now running in the cloud in a web app that is just like what you will use for production.</span></span> <span data-ttu-id="ede9d-269">Dans la mesure où tout fonctionne correctement, l’étape suivante consiste à déployer en production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-269">Since everything is working correctly, the next step is to deploy to production.</span></span>

## <a name="deploy-to-production"></a><span data-ttu-id="ede9d-270">Déployer en production</span><span class="sxs-lookup"><span data-stu-id="ede9d-270">Deploy to production</span></span>

<span data-ttu-id="ede9d-271">Le processus de création d’une application Web de production et de déploiement en production est le même que pour la mise en lots, sauf que vous devez exclure les *robots.txt* du déploiement.</span><span class="sxs-lookup"><span data-stu-id="ede9d-271">The process for creating a production web app and deploying to production is the same as for staging, except that you need to exclude the *robots.txt* from deployment.</span></span> <span data-ttu-id="ede9d-272">Pour ce faire, vous allez modifier le fichier de profil de publication.</span><span class="sxs-lookup"><span data-stu-id="ede9d-272">To do that you'll edit the publish profile file.</span></span>

### <a name="create-the-production-environment-and-the-production-publish-profile"></a><span data-ttu-id="ede9d-273">Créer l’environnement de production et le profil de publication de production</span><span class="sxs-lookup"><span data-stu-id="ede9d-273">Create the production environment and the production publish profile</span></span>

1. <span data-ttu-id="ede9d-274">Créez l’application Web et la base de données de production dans Azure, en suivant la même procédure que celle utilisée pour la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="ede9d-274">Create the production web app and database in Azure, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="ede9d-275">Lorsque vous créez la base de données, vous pouvez choisir de la placer sur le serveur que vous avez créé précédemment ou de créer un nouveau serveur.</span><span class="sxs-lookup"><span data-stu-id="ede9d-275">When you create the database, you can choose to put it on the same server you created earlier, or create a new server.</span></span>
2. <span data-ttu-id="ede9d-276">Téléchargez le fichier *. publishsettings* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-276">Download the *.publishsettings* file.</span></span>
3. <span data-ttu-id="ede9d-277">Créez le profil de publication en important le fichier production *. publishsettings* en suivant la procédure que vous avez utilisée pour la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="ede9d-277">Create the publish profile by importing the production *.publishsettings* file, following the same procedure that you used for staging.</span></span>

    <span data-ttu-id="ede9d-278">N’oubliez pas de configurer le script de déploiement de données sous **DefaultConnection** dans la section **bases de données** de l’onglet **paramètres** .</span><span class="sxs-lookup"><span data-stu-id="ede9d-278">Don't forget to configure the data deployment script under **DefaultConnection** in the **Databases** section of the **Settings** tab.</span></span>
4. <span data-ttu-id="ede9d-279">Renommez le profil de publication en *production*.</span><span class="sxs-lookup"><span data-stu-id="ede9d-279">Rename the publish profile to *Production*.</span></span>
5. <span data-ttu-id="ede9d-280">Configurez une transformation de profil de publication pour l’indicateur d’environnement, en suivant la procédure que vous avez utilisée pour la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="ede9d-280">Configure a publish profile transform for the environment indicator, following the same procedure that you used for staging..</span></span>

### <a name="edit-the-pubxml-file-to-exclude-robotstxt"></a><span data-ttu-id="ede9d-281">Modifiez le fichier. pubxml pour exclure robots.txt</span><span class="sxs-lookup"><span data-stu-id="ede9d-281">Edit the .pubxml file to exclude robots.txt</span></span>

<span data-ttu-id="ede9d-282">Les fichiers de profil de publication sont nommés &lt; ProfileName &gt; *. pubxml* et se trouvent dans le dossier *PublishProfiles* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-282">Publish profile files are named &lt;profilename&gt;*.pubxml* and are located in the *PublishProfiles* folder.</span></span> <span data-ttu-id="ede9d-283">Le dossier *PublishProfiles* se trouve dans le dossier *Propriétés* d’un projet d’application Web C#, sous le dossier *mon projet* dans un projet d’application Web VB, ou sous le dossier *application \_ Data* dans un projet d’application Web.</span><span class="sxs-lookup"><span data-stu-id="ede9d-283">The *PublishProfiles* folder is under the *Properties* folder in a C# web application project, under the *My Project* folder in a VB web application project, or under the *App\_Data* folder in a web app project.</span></span> <span data-ttu-id="ede9d-284">Chaque fichier *. pubxml* contient des paramètres qui s’appliquent à un profil de publication.</span><span class="sxs-lookup"><span data-stu-id="ede9d-284">Each *.pubxml* file contains settings that apply to one publish profile.</span></span> <span data-ttu-id="ede9d-285">Les valeurs que vous entrez dans l’Assistant publier le site Web sont stockées dans ces fichiers et vous pouvez les modifier pour créer ou modifier des paramètres qui ne sont pas mis à disposition dans l’interface utilisateur de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ede9d-285">The values you enter in the Publish Web wizard are stored in these files, and you can edit them to create or change settings that aren't made available in the Visual Studio UI.</span></span>

<span data-ttu-id="ede9d-286">Par défaut, les fichiers *. pubxml* sont inclus dans le projet lorsque vous créez un profil de publication, mais vous pouvez les exclure du projet et Visual Studio les utilisera toujours.</span><span class="sxs-lookup"><span data-stu-id="ede9d-286">By default, *.pubxml* files are included in the project when you create a publish profile, but you can exclude them from the project and Visual Studio will still use them.</span></span> <span data-ttu-id="ede9d-287">Visual Studio recherche les fichiers *. pubxml* dans le dossier *PublishProfiles* , qu’ils soient inclus ou non dans le projet.</span><span class="sxs-lookup"><span data-stu-id="ede9d-287">Visual Studio looks in the *PublishProfiles* folder for *.pubxml* files, regardless of whether they are included in the project.</span></span>

<span data-ttu-id="ede9d-288">Chaque fichier *. pubxml* contient un fichier *. pubxml. User* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-288">For each *.pubxml* file there is a *.pubxml.user* file.</span></span> <span data-ttu-id="ede9d-289">Le fichier *. pubxml. User* contient le mot de passe chiffré si vous avez sélectionné l’option **enregistrer le mot de passe** . par défaut, il est exclu du projet.</span><span class="sxs-lookup"><span data-stu-id="ede9d-289">The *.pubxml.user* file contains the encrypted password if you selected the **Save password** option, and by default it is excluded from the project.</span></span>

<span data-ttu-id="ede9d-290">Un fichier *. pubxml* contient les paramètres qui se rapportent à un profil de publication spécifique.</span><span class="sxs-lookup"><span data-stu-id="ede9d-290">A *.pubxml* file contains the settings that pertain to a specific publish profile.</span></span> <span data-ttu-id="ede9d-291">Si vous souhaitez configurer des paramètres qui s’appliquent à tous les profils, vous pouvez créer un fichier *. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-291">If you want to configure settings that apply to all profiles, you can create a *.wpp.targets* file.</span></span> <span data-ttu-id="ede9d-292">Le processus de génération importe ces fichiers dans le fichier projet *. csproj* ou *. vbproj* , de sorte que la plupart des paramètres que vous pouvez configurer dans le fichier projet peuvent être configurés dans ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="ede9d-292">The build process imports these files into the *.csproj* or *.vbproj* project file, so most settings that you can configure in the project file can be configured in these files.</span></span> <span data-ttu-id="ede9d-293">Pour plus d’informations sur les fichiers *. pubxml* et *. WPP. targets* , consultez [procédure : modifier les paramètres de déploiement dans les fichiers de profil de publication (. pubxml) et le fichier. WPP. targets dans les projets Web Visual Studio](https://msdn.microsoft.com/library/ff398069.aspx).</span><span class="sxs-lookup"><span data-stu-id="ede9d-293">For more information about *.pubxml* files and *.wpp.targets* files, see [How to: Edit Deployment Settings in Publish Profile (.pubxml) Files and the .wpp.targets File in Visual Studio Web Projects](https://msdn.microsoft.com/library/ff398069.aspx).</span></span>

1. <span data-ttu-id="ede9d-294">Dans **Explorateur de solutions**, développez **Propriétés** et développez **PublishProfiles**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-294">In **Solution Explorer**, expand **Properties** and expand **PublishProfiles**.</span></span>
2. <span data-ttu-id="ede9d-295">Cliquez avec le bouton droit sur *production. pubxml* , puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-295">Right-click *Production.pubxml* and click **Open**.</span></span>

    ![Ouvrez le fichier. pubxml](deploying-to-production/_static/image13.png)
3. <span data-ttu-id="ede9d-297">Cliquez avec le bouton droit sur *production. pubxml* , puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="ede9d-297">Right-click *Production.pubxml* and click **Open**.</span></span>
4. <span data-ttu-id="ede9d-298">Ajoutez les lignes suivantes juste avant l’élément de fermeture `PropertyGroup` :</span><span class="sxs-lookup"><span data-stu-id="ede9d-298">Add the following lines immediately before the closing `PropertyGroup` element:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample3.xml)]

    <span data-ttu-id="ede9d-299">Le fichier. pubxml ressemble maintenant à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="ede9d-299">The .pubxml file now looks like the following example:</span></span>

    [!code-xml[Main](deploying-to-production/samples/sample4.xml?highlight=18-20)]

    <span data-ttu-id="ede9d-300">Pour plus d’informations sur l’exclusion de fichiers et de dossiers, consultez peux- [je exclure des fichiers ou des dossiers spécifiques du déploiement ?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) dans le **Forum aux questions sur le déploiement Web pour Visual Studio et ASP.net** sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="ede9d-300">For more information about how to exclude files and folders, see [Can I exclude specific files or folders from deployment?](https://msdn.microsoft.com/library/ee942158.aspx#can_i_exclude_specific_files_or_folders_from_deployment) in the **Web Deployment FAQ for Visual Studio and ASP.NET** on MSDN.</span></span>

### <a name="deploy-to-production"></a><span data-ttu-id="ede9d-301">Déployer en production</span><span class="sxs-lookup"><span data-stu-id="ede9d-301">Deploy to production</span></span>

1. <span data-ttu-id="ede9d-302">Ouvrez l' **Assistant publier le site Web** . Assurez-vous que le profil de publication de **production** est sélectionné, puis cliquez sur **Démarrer l’aperçu** sous l’onglet **Aperçu** pour vérifier que le fichier *robots.txt* ne sera pas copié dans l’application de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-302">Open the **Publish Web** wizard make sure that the **Production** publish profile is selected, and then click **Start Preview** on the **Preview** tab to verify that the *robots.txt* file will not be copied to the production app.</span></span>

    ![Aperçu des fichiers à publier en production](deploying-to-production/_static/image14.png)

    <span data-ttu-id="ede9d-304">Passez en revue la liste des fichiers qui seront copiés.</span><span class="sxs-lookup"><span data-stu-id="ede9d-304">Review the list of files that will be copied.</span></span> <span data-ttu-id="ede9d-305">Vous verrez que tous les fichiers *. cs* , y compris les fichiers *. aspx.cs*, *. aspx.Designer.cs*, *Master.cs*et *Master.Designer.cs* sont omis.</span><span class="sxs-lookup"><span data-stu-id="ede9d-305">You'll see that all of the *.cs* files, including *.aspx.cs*, *.aspx.designer.cs*, *Master.cs*, and *Master.designer.cs* files are omitted.</span></span> <span data-ttu-id="ede9d-306">Tout ce code a été compilé dans les fichiers *ContosoUniversity.dll* et *ContosoUniversity. pdb* que vous trouverez dans le dossier *bin* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-306">All of this code has been compiled into the *ContosoUniversity.dll* and *ContosoUniversity.pdb* files that you'll find in the *bin* folder.</span></span> <span data-ttu-id="ede9d-307">Étant donné que seul le *fichier. dll* est nécessaire pour exécuter l’application, et que vous avez spécifié précédemment que seuls les fichiers nécessaires à l’exécution de l’application doivent être déployés, aucun fichier *. cs* n’a été copié dans l’environnement de destination.</span><span class="sxs-lookup"><span data-stu-id="ede9d-307">Because only the *.dll* is needed to run the application, and you specified earlier that only files needed to run the application should be deployed, no *.cs* files were copied to the destination environment.</span></span> <span data-ttu-id="ede9d-308">Le dossier *obj* et les fichiers *ContosoUniversity. csproj* et *. csproj. User* sont omis pour la même raison.</span><span class="sxs-lookup"><span data-stu-id="ede9d-308">The *obj* folder and the *ContosoUniversity.csproj* and *.csproj.user* files are omitted for the same reason.</span></span>

    <span data-ttu-id="ede9d-309">Cliquez sur **publier** pour déployer dans l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-309">Click **Publish** to deploy to the production environment.</span></span>
2. <span data-ttu-id="ede9d-310">Testez en production en suivant la même procédure que celle utilisée pour la mise en lots.</span><span class="sxs-lookup"><span data-stu-id="ede9d-310">Test in production, following the same procedure you used for staging.</span></span>

    <span data-ttu-id="ede9d-311">Tout est identique à la mise en lots, à l’exception de l’URL et de l’absence du fichier de *robots.txt* .</span><span class="sxs-lookup"><span data-stu-id="ede9d-311">Everything is identical to staging except for the URL and the absence of the *robots.txt* file.</span></span>

## <a name="summary"></a><span data-ttu-id="ede9d-312">Résumé</span><span class="sxs-lookup"><span data-stu-id="ede9d-312">Summary</span></span>

<span data-ttu-id="ede9d-313">Vous avez maintenant déployé et testé votre application Web avec succès et elle est disponible publiquement sur Internet.</span><span class="sxs-lookup"><span data-stu-id="ede9d-313">You have now successfully deployed and tested your web app and it is available publicly over the Internet.</span></span>

![Production de la page d’hébergement](deploying-to-production/_static/image15.png)

<span data-ttu-id="ede9d-315">Dans le didacticiel suivant, vous allez mettre à jour le code de l’application et déployer la modification dans les environnements de test, intermédiaire et de production.</span><span class="sxs-lookup"><span data-stu-id="ede9d-315">In the next tutorial, you'll update application code and deploy the change to the test, staging, and production environments.</span></span>

> [!NOTE]
> <span data-ttu-id="ede9d-316">Lorsque votre application est en cours d’utilisation dans l’environnement de production, vous devez implémenter un plan de récupération.</span><span class="sxs-lookup"><span data-stu-id="ede9d-316">While your application is in use in the production environment you should be implementing a recovery plan.</span></span> <span data-ttu-id="ede9d-317">Autrement dit, vous devez sauvegarder régulièrement vos bases de données de l’application de production vers un emplacement de stockage sécurisé, et vous devez conserver plusieurs générations de ces sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="ede9d-317">That is, you should be periodically backing up your databases from the production app to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="ede9d-318">Lorsque vous mettez à jour la base de données, vous devez effectuer une copie de sauvegarde immédiatement avant la modification.</span><span class="sxs-lookup"><span data-stu-id="ede9d-318">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="ede9d-319">Ensuite, si vous faites une erreur et que vous ne la Découvrez pas tant que vous ne l’avez pas déployée en production, vous pourrez toujours récupérer la base de données dans l’État où elle se trouvait avant qu’elle ne soit endommagée.</span><span class="sxs-lookup"><span data-stu-id="ede9d-319">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span> <span data-ttu-id="ede9d-320">Pour en savoir plus, consultez [Sauvegarde et restauration d’une base de données Azure SQL](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span><span class="sxs-lookup"><span data-stu-id="ede9d-320">For more information, see [Azure SQL Database Backup and Restore](https://msdn.microsoft.com/library/windowsazure/jj650016.aspx).</span></span>
> 
> 
> [!NOTE]
> <span data-ttu-id="ede9d-321">Dans ce didacticiel, l’édition SQL Server sur laquelle vous effectuez le déploiement est Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="ede9d-321">In this tutorial the SQL Server edition that you are deploying to is Azure SQL Database.</span></span> <span data-ttu-id="ede9d-322">Alors que le processus de déploiement est similaire à d’autres éditions de SQL Server, une application de production réelle peut nécessiter du code spécial pour Azure SQL Database dans certains scénarios.</span><span class="sxs-lookup"><span data-stu-id="ede9d-322">While the deployment process is similar to other editions of SQL Server, a real production application might require special code for Azure SQL Database in some scenarios.</span></span> <span data-ttu-id="ede9d-323">Pour plus d’informations, consultez [utilisation de Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) et [choix entre SQL Server et Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span><span class="sxs-lookup"><span data-stu-id="ede9d-323">For more information, see [Working with Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdb) and [Choosing between SQL Server and Azure SQL Database](../../../../whitepapers/aspnet-data-access-content-map.md#ssdbchoosing).</span></span>
> 
> [!div class="step-by-step"]
> <span data-ttu-id="ede9d-324">[Précédent](setting-folder-permissions.md) 
>  [Suivant](deploying-a-code-update.md)</span><span class="sxs-lookup"><span data-stu-id="ede9d-324">[Previous](setting-folder-permissions.md)
[Next](deploying-a-code-update.md)</span></span>
