---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file
title: Création et exécution d’un fichier de commandes de déploiement | Microsoft Docs
author: jrjlee
description: Cette rubrique explique comment générer un fichier de commandes qui vous permet d’exécuter un déploiement à l’aide de fichiers de projet Microsoft Build Engine (MSBuild) comme une seule étape...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: c61560e9-9f6c-4985-834a-08a3eabf9c3c
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/creating-and-running-a-deployment-command-file
msc.type: authoredcontent
ms.openlocfilehash: f1477ff423e4898385066a35b42503f3c70dcc68
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78634308"
---
# <a name="creating-and-running-a-deployment-command-file"></a><span data-ttu-id="04ca5-103">Création et exécution d’un fichier de commandes de déploiement</span><span class="sxs-lookup"><span data-stu-id="04ca5-103">Creating and Running a Deployment Command File</span></span>

<span data-ttu-id="04ca5-104">par [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="04ca5-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="04ca5-105">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="04ca5-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="04ca5-106">Cette rubrique explique comment générer un fichier de commandes qui vous permet d’exécuter un déploiement à l’aide de fichiers de projet Microsoft Build Engine (MSBuild) en tant que processus reproductible à étape unique.</span><span class="sxs-lookup"><span data-stu-id="04ca5-106">This topic describes how to build a command file that will let you run a deployment using Microsoft Build Engine (MSBuild) project files as a single-step, repeatable process.</span></span>

<span data-ttu-id="04ca5-107">Cette rubrique fait partie d’une série de didacticiels basés sur les exigences de déploiement en entreprise d’une société fictive nommée Fabrikam, Inc. Cette série de didacticiels utilise un&#x2014;exemple de solution de&#x2014;gestion des [contacts](the-contact-manager-solution.md) pour représenter une application Web avec un niveau de complexité réaliste, y compris une application ASP.NET MVC 3, un service Windows Communication Foundation (WCF) et un projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="04ca5-107">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager](the-contact-manager-solution.md) solution&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="04ca5-108">La méthode de déploiement au cœur de ces didacticiels est basée sur l’approche de fichier de projet fractionné décrite dans [fonctionnement du processus de génération](understanding-the-build-process.md), dans lequel le processus de génération est&#x2014;contrôlé par deux fichiers projet contenant des instructions de génération qui s’appliquent à chaque environnement de destination, et un qui contient des paramètres de génération et de déploiement spécifiques à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="04ca5-108">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Build Process](understanding-the-build-process.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="04ca5-109">Au moment de la génération, le fichier projet spécifique à l’environnement est fusionné dans le fichier projet indépendant de l’environnement pour former un ensemble complet d’instructions de génération.</span><span class="sxs-lookup"><span data-stu-id="04ca5-109">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="process-overview"></a><span data-ttu-id="04ca5-110">Vue d’ensemble du processus</span><span class="sxs-lookup"><span data-stu-id="04ca5-110">Process Overview</span></span>

<span data-ttu-id="04ca5-111">Dans cette rubrique, vous allez apprendre à créer et exécuter un fichier de commandes qui utilise ces fichiers projet pour effectuer un déploiement reproductible dans votre environnement cible.</span><span class="sxs-lookup"><span data-stu-id="04ca5-111">In this topic, you'll learn how to create and run a command file that uses these project files to perform a repeatable deployment to your target environment.</span></span> <span data-ttu-id="04ca5-112">Fondamentalement, le fichier de commandes doit simplement contenir une commande MSBuild qui :</span><span class="sxs-lookup"><span data-stu-id="04ca5-112">Essentially, the command file simply needs to contain an MSBuild command that:</span></span>

- <span data-ttu-id="04ca5-113">Indique à MSBuild d’exécuter le fichier *Publish. proj* agnostique à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="04ca5-113">Tells MSBuild to execute the environment-agnostic *Publish.proj* file.</span></span>
- <span data-ttu-id="04ca5-114">Indique au fichier *Publish. proj* quel fichier contient les paramètres de projet spécifiques à l’environnement et où le trouver.</span><span class="sxs-lookup"><span data-stu-id="04ca5-114">Tells the *Publish.proj* file which file contains the environment-specific project settings and where to find it.</span></span>

## <a name="create-an-msbuild-command"></a><span data-ttu-id="04ca5-115">Créer une commande MSBuild</span><span class="sxs-lookup"><span data-stu-id="04ca5-115">Create an MSBuild Command</span></span>

<span data-ttu-id="04ca5-116">Comme décrit dans [la rubrique comprendre le processus de génération](understanding-the-build-process.md), le fichier&#x2014;projet spécifique à l’environnement, par exemple, *env-dev. proj*&#x2014;est conçu pour être importé dans le fichier *Publish. proj* non agnostique de l’environnement au moment de la génération.</span><span class="sxs-lookup"><span data-stu-id="04ca5-116">As described in [Understanding the Build Process](understanding-the-build-process.md), the environment-specific project file&#x2014;for example, *Env-Dev.proj*&#x2014;is designed to be imported into the environment-agnostic *Publish.proj* file at build time.</span></span> <span data-ttu-id="04ca5-117">Ensemble, ces deux fichiers fournissent un ensemble complet d’instructions qui indiquent à MSBuild comment créer et déployer votre solution.</span><span class="sxs-lookup"><span data-stu-id="04ca5-117">Together, these two files provide a complete set of instructions that tell MSBuild how to build and deploy your solution.</span></span>

<span data-ttu-id="04ca5-118">Le fichier *Publish. proj* utilise un élément **Import** pour importer le fichier projet spécifique à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="04ca5-118">The *Publish.proj* file uses an **Import** element to import the environment-specific project file.</span></span>

[!code-xml[Main](creating-and-running-a-deployment-command-file/samples/sample1.xml)]

<span data-ttu-id="04ca5-119">Par conséquent, lorsque vous utilisez MSBuild. exe pour générer et déployer la solution du gestionnaire de contacts, vous devez :</span><span class="sxs-lookup"><span data-stu-id="04ca5-119">As such, when you use MSBuild.exe to build and deploy the Contact Manager solution, you need to:</span></span>

- <span data-ttu-id="04ca5-120">Exécutez MSBuild. exe sur le fichier *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="04ca5-120">Run MSBuild.exe on the *Publish.proj* file.</span></span>
- <span data-ttu-id="04ca5-121">Spécifiez l’emplacement du fichier projet spécifique à l’environnement en fournissant un paramètre de ligne de commande nommé **TargetEnvPropsFile**.</span><span class="sxs-lookup"><span data-stu-id="04ca5-121">Specify the location of the environment-specific project file by supplying a command-line parameter named **TargetEnvPropsFile**.</span></span>

<span data-ttu-id="04ca5-122">Pour ce faire, votre commande MSBuild doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="04ca5-122">To do this, your MSBuild command should resemble this:</span></span>

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample2.cmd)]

<span data-ttu-id="04ca5-123">À ce stade, il s’agit d’une étape simple pour passer à un déploiement reproductible à une seule étape.</span><span class="sxs-lookup"><span data-stu-id="04ca5-123">From here, it's a simple step to move to a repeatable, single-step deployment.</span></span> <span data-ttu-id="04ca5-124">Il vous suffit d’ajouter votre commande MSBuild dans un fichier. cmd.</span><span class="sxs-lookup"><span data-stu-id="04ca5-124">All you need to do is to add your MSBuild command to a .cmd file.</span></span> <span data-ttu-id="04ca5-125">Dans la solution du gestionnaire de contacts, le dossier de publication comprend un fichier nommé *Publish-dev. cmd* qui fait exactement cela.</span><span class="sxs-lookup"><span data-stu-id="04ca5-125">In the Contact Manager solution, the Publish folder includes a file named *Publish-Dev.cmd* that does exactly this.</span></span>

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample3.cmd)]

> [!NOTE]
> <span data-ttu-id="04ca5-126">Le commutateur **/FL** indique à MSBuild de créer un fichier journal nommé *MSBuild. log* dans le répertoire de travail dans lequel MSBuild. exe a été appelé.</span><span class="sxs-lookup"><span data-stu-id="04ca5-126">The **/fl** switch instructs MSBuild to create a log file named *msbuild.log* in the working directory in which MSBuild.exe was invoked.</span></span>

<span data-ttu-id="04ca5-127">Pour déployer ou redéployer la solution du gestionnaire de contacts, il vous suffit d’exécuter le fichier *Publish-dev. cmd* .</span><span class="sxs-lookup"><span data-stu-id="04ca5-127">To deploy or redeploy the Contact Manager solution, all you need to do is run the *Publish-Dev.cmd* file.</span></span> <span data-ttu-id="04ca5-128">Quand vous exécutez le fichier, MSBuild :</span><span class="sxs-lookup"><span data-stu-id="04ca5-128">When you run the file, MSBuild will:</span></span>

- <span data-ttu-id="04ca5-129">Générez tous les projets de la solution.</span><span class="sxs-lookup"><span data-stu-id="04ca5-129">Build all the projects in the solution.</span></span>
- <span data-ttu-id="04ca5-130">Générez des packages Web pouvant être déployés pour les projets d’application Web.</span><span class="sxs-lookup"><span data-stu-id="04ca5-130">Generate deployable web packages for the web application projects.</span></span>
- <span data-ttu-id="04ca5-131">Générez des fichiers. dbschema et. DeployManifest pour les projets de base de données.</span><span class="sxs-lookup"><span data-stu-id="04ca5-131">Generate .dbschema and .deploymanifest files for the database projects.</span></span>
- <span data-ttu-id="04ca5-132">Déployez les packages Web sur le serveur Web.</span><span class="sxs-lookup"><span data-stu-id="04ca5-132">Deploy the web packages to the web server.</span></span>
- <span data-ttu-id="04ca5-133">Déployez la base de données sur le serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="04ca5-133">Deploy the database to the database server.</span></span>

## <a name="run-the-deployment"></a><span data-ttu-id="04ca5-134">Exécuter le déploiement</span><span class="sxs-lookup"><span data-stu-id="04ca5-134">Run the Deployment</span></span>

<span data-ttu-id="04ca5-135">Une fois que vous avez créé un fichier de commandes pour votre environnement cible, vous devez être en mesure d’effectuer l’intégralité du déploiement en exécutant simplement le fichier.</span><span class="sxs-lookup"><span data-stu-id="04ca5-135">When you've created a command file for your target environment, you should be able to complete the entire deployment by simply running the file.</span></span>

<span data-ttu-id="04ca5-136">**Pour déployer la solution gestionnaire de contacts dans votre environnement de test**</span><span class="sxs-lookup"><span data-stu-id="04ca5-136">**To deploy the Contact Manager solution to your test environment**</span></span>

1. <span data-ttu-id="04ca5-137">Sur votre station de travail de développeur, ouvrez l’Explorateur Windows, puis accédez à l’emplacement du fichier *Publish-dev. cmd* .</span><span class="sxs-lookup"><span data-stu-id="04ca5-137">On your developer workstation, open Windows Explorer, and then browse to the location of the *Publish-Dev.cmd* file.</span></span>
2. <span data-ttu-id="04ca5-138">Double-cliquez sur le fichier pour l’exécuter.</span><span class="sxs-lookup"><span data-stu-id="04ca5-138">Double-click the file to run it.</span></span>
3. <span data-ttu-id="04ca5-139">Si une boîte de dialogue **ouvrir un fichier-Avertissement de sécurité** s’affiche, cliquez sur **exécuter**.</span><span class="sxs-lookup"><span data-stu-id="04ca5-139">If an **Open File – Security Warning** dialog box appears, click **Run**.</span></span>
4. <span data-ttu-id="04ca5-140">Si vos paramètres de configuration et vos serveurs de test sont correctement configurés, la fenêtre d’invite de commandes affiche un message **Build Succeeded** lorsque MSBuild a terminé le traitement des fichiers projet.</span><span class="sxs-lookup"><span data-stu-id="04ca5-140">If your configuration settings and test servers are set up correctly, the Command Prompt window will show a **Build succeeded** message when MSBuild has finished processing the project files.</span></span>

    ![](creating-and-running-a-deployment-command-file/_static/image1.png)
5. <span data-ttu-id="04ca5-141">S’il s’agit de la première fois que vous déployez la solution dans cet environnement, vous devez ajouter le compte d’ordinateur du serveur Web de test aux rôles de base de données **\_DataWriter** et **DB\_DataReader** sur la base de données **ContactManager** .</span><span class="sxs-lookup"><span data-stu-id="04ca5-141">If this is the first time you've deployed the solution to this environment, you'll need to add the test web server machine account to the **db\_datawriter** and **db\_datareader** roles on the **ContactManager** database.</span></span> <span data-ttu-id="04ca5-142">Cette procédure est décrite dans [configurer un serveur de base de données pour la publication de Web Deploy](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).</span><span class="sxs-lookup"><span data-stu-id="04ca5-142">This procedure is described in [Configure a Database Server for Web Deploy Publishing](../configuring-server-environments-for-web-deployment/configuring-a-database-server-for-web-deploy-publishing.md).</span></span>

    > [!NOTE]
    > <span data-ttu-id="04ca5-143">Vous devez uniquement attribuer ces autorisations lorsque vous créez la base de données.</span><span class="sxs-lookup"><span data-stu-id="04ca5-143">You only need to assign these permissions when you create the database.</span></span> <span data-ttu-id="04ca5-144">Par défaut, le processus de génération ne recrée pas la base de données&#x2014;sur chaque déploiement à la place, il compare la base de données existante au schéma le plus récent et ne fait que les modifications requises.</span><span class="sxs-lookup"><span data-stu-id="04ca5-144">By default, the build process will not recreate the database on every deployment&#x2014;instead, it will compare the existing database to the latest schema and make only the changes required.</span></span> <span data-ttu-id="04ca5-145">Par conséquent, vous devez uniquement mapper ces rôles de base de données la première fois que vous déployez la solution.</span><span class="sxs-lookup"><span data-stu-id="04ca5-145">As a result, you should only need to map these database roles the first time you deploy the solution.</span></span>
6. <span data-ttu-id="04ca5-146">Ouvrez Internet Explorer et accédez à l’URL de l’application du gestionnaire de contacts (par exemple, `http://testweb1:85/ContactManager/`).</span><span class="sxs-lookup"><span data-stu-id="04ca5-146">Open Internet Explorer and browse to the URL of the Contact Manager application (for example, `http://testweb1:85/ContactManager/`).</span></span>
7. <span data-ttu-id="04ca5-147">Vérifiez que l’application fonctionne comme prévu et que vous êtes en mesure d’ajouter des contacts.</span><span class="sxs-lookup"><span data-stu-id="04ca5-147">Verify that the application works as expected and you're able to add contacts.</span></span>

    ![](creating-and-running-a-deployment-command-file/_static/image2.png)

## <a name="conclusion"></a><span data-ttu-id="04ca5-148">Conclusion</span><span class="sxs-lookup"><span data-stu-id="04ca5-148">Conclusion</span></span>

<span data-ttu-id="04ca5-149">La création d’un fichier de commandes contenant vos instructions MSBuild vous offre un moyen simple et rapide de créer et de déployer une solution à projets multiples dans un environnement de destination spécifique.</span><span class="sxs-lookup"><span data-stu-id="04ca5-149">Creating a command file containing your MSBuild instructions provides you with a quick and easy way of building and deploying a multi-project solution to a specific destination environment.</span></span> <span data-ttu-id="04ca5-150">Si vous devez déployer à plusieurs reprises votre solution dans plusieurs environnements de destination, vous pouvez créer plusieurs fichiers de commandes.</span><span class="sxs-lookup"><span data-stu-id="04ca5-150">If you need to repeatedly deploy your solution to multiple destination environments, you can create multiple command files.</span></span> <span data-ttu-id="04ca5-151">Dans chaque fichier de commande, la commande MSBuild génère le même fichier de projet universel, mais elle spécifie un autre fichier projet spécifique à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="04ca5-151">In each command file, the MSBuild command will build the same universal project file, but it will specify a different environment-specific project file.</span></span> <span data-ttu-id="04ca5-152">Par exemple, un fichier de commandes à publier dans un environnement de développement ou de test peut contenir cette commande MSBuild :</span><span class="sxs-lookup"><span data-stu-id="04ca5-152">For example, a command file to publish to a developer or test environment might contain this MSBuild command:</span></span>

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample4.cmd)]

<span data-ttu-id="04ca5-153">Un fichier de commandes à publier dans un environnement intermédiaire peut contenir cette commande MSBuild :</span><span class="sxs-lookup"><span data-stu-id="04ca5-153">A command file to publish to a staging environment might contain this MSBuild command:</span></span>

[!code-console[Main](creating-and-running-a-deployment-command-file/samples/sample5.cmd)]

> [!NOTE]
> <span data-ttu-id="04ca5-154">Pour obtenir des conseils sur la personnalisation des fichiers projet spécifiques à l’environnement pour vos propres environnements de serveur, consultez [configurer les propriétés de déploiement pour un environnement cible](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).</span><span class="sxs-lookup"><span data-stu-id="04ca5-154">For guidance on how to customize the environment-specific project files for your own server environments, see [Configure Deployment Properties for a Target Environment](../configuring-server-environments-for-web-deployment/configuring-deployment-properties-for-a-target-environment.md).</span></span>

<span data-ttu-id="04ca5-155">Vous pouvez également personnaliser le processus de génération pour chaque environnement en remplaçant les propriétés ou en définissant différents commutateurs dans votre commande MSBuild.</span><span class="sxs-lookup"><span data-stu-id="04ca5-155">You can also customize the build process for each environment by overriding properties or setting various other switches in your MSBuild command.</span></span> <span data-ttu-id="04ca5-156">Pour plus d’informations, consultez Référence de la [ligne de commande MSBuild](https://msdn.microsoft.com/library/ms164311.aspx).</span><span class="sxs-lookup"><span data-stu-id="04ca5-156">For more information, see [MSBuild Command Line Reference](https://msdn.microsoft.com/library/ms164311.aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="04ca5-157">[Précédent](deploying-database-projects.md)
> [Suivant](manually-installing-web-packages.md)</span><span class="sxs-lookup"><span data-stu-id="04ca5-157">[Previous](deploying-database-projects.md)
[Next](manually-installing-web-packages.md)</span></span>
