---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
title: Personnalisation des déploiements de base de données pour plusieurs environnements | Microsoft Docs
author: jrjlee
description: 'Cette rubrique décrit comment personnaliser les propriétés d’une base de données pour les environnements cibles spécifiques dans le cadre du processus de déploiement. Remarque : La rubrique suppose th...'
ms.author: riande
ms.date: 05/04/2012
ms.assetid: a172979a-1318-4318-a9c6-4f9560d26267
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments
msc.type: authoredcontent
ms.openlocfilehash: 8ae8cb1a322afb95c5d2e8d5e73c7825c7b2fe5a
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65108310"
---
# <a name="customizing-database-deployments-for-multiple-environments"></a><span data-ttu-id="6948c-104">Personnalisation de déploiements de base de données pour plusieurs environnements</span><span class="sxs-lookup"><span data-stu-id="6948c-104">Customizing Database Deployments for Multiple Environments</span></span>

<span data-ttu-id="6948c-105">par [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="6948c-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="6948c-106">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="6948c-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="6948c-107">Cette rubrique décrit comment personnaliser les propriétés d’une base de données pour les environnements cibles spécifiques dans le cadre du processus de déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-107">This topic describes how to tailor the properties of a database to specific target environments as part of the deployment process.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="6948c-108">La rubrique suppose que vous déployez un projet de base de données de Visual Studio 2010 à l’aide de MSBuild.exe et VSDBCMD.exe.</span><span class="sxs-lookup"><span data-stu-id="6948c-108">The topic assumes that you're deploying a Visual Studio 2010 database project using MSBuild.exe and VSDBCMD.exe.</span></span> <span data-ttu-id="6948c-109">Pour plus d’informations sur la raison pour laquelle vous pouvez choisir cette approche, consultez [déploiement Web dans l’entreprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) et [déploiement de projets de base de données](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-109">For more information on why you might choose this approach, see [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) and [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span>
> 
> 
> <span data-ttu-id="6948c-110">Lorsque vous déployez un projet de base de données vers plusieurs destinations, vous aurez souvent besoin de personnaliser les propriétés de déploiement de base de données pour chaque environnement cible.</span><span class="sxs-lookup"><span data-stu-id="6948c-110">When you deploy a database project to multiple destinations, you'll often want to customize the database deployment properties for each target environment.</span></span> <span data-ttu-id="6948c-111">Par exemple, dans les environnements de test vous serez généralement recréer la base de données sur chaque déploiement, tandis que dans les environnements de production ou intermédiaire vous serait beaucoup plus susceptibles de rendre les mises à jour incrémentielles pour préserver vos données.</span><span class="sxs-lookup"><span data-stu-id="6948c-111">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span>
> 
> <span data-ttu-id="6948c-112">Dans un projet de base de données Visual Studio 2010, les paramètres de déploiement sont contenus dans un fichier de configuration (.sqldeployment) de déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-112">In a Visual Studio 2010 database project, deployment settings are contained within a deployment configuration (.sqldeployment) file.</span></span> <span data-ttu-id="6948c-113">Cette rubrique sera vous montrent comment créer des fichiers de configuration spécifiques à l’environnement de déploiement et de spécifier celui que vous souhaitez utiliser comme paramètre VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="6948c-113">This topic will show you how to create environment-specific deployment configuration files and specify the one you want to use as a VSDBCMD parameter.</span></span>

<span data-ttu-id="6948c-114">Cette rubrique fait partie d’une série de didacticiels basées sur les exigences de déploiement d’entreprise de la société fictive Fabrikam, Inc. Cette série de didacticiels utilise un exemple de solution&#x2014;le [solution Gestionnaire de contacts](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;pour représenter une application web avec un niveau réaliste de complexité, y compris une application ASP.NET MVC 3, une Communication de Windows Foundation (WCF) service et un projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-114">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="6948c-115">La méthode de déploiement au cœur de ces didacticiels est basée sur l’approche de fichier de projet de fractionnement décrite dans [présentation du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md), dans lequel le processus de génération est contrôlé par deux fichiers de projet&#x2014;contenant un seul les instructions qui s’appliquent à chaque environnement de destination et celui qui contient les paramètres de génération et de déploiement spécifiques à l’environnement de génération.</span><span class="sxs-lookup"><span data-stu-id="6948c-115">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="6948c-116">Au moment de la génération, le fichier de projet spécifique à l’environnement est fusionné dans le fichier de projet d’indépendant de l’environnement pour former un ensemble complet d’instructions de génération.</span><span class="sxs-lookup"><span data-stu-id="6948c-116">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="6948c-117">Présentation de la tâche</span><span class="sxs-lookup"><span data-stu-id="6948c-117">Task Overview</span></span>

<span data-ttu-id="6948c-118">Cette rubrique suppose que :</span><span class="sxs-lookup"><span data-stu-id="6948c-118">This topic assumes that:</span></span>

- <span data-ttu-id="6948c-119">Vous utilisez l’approche des fichiers projet partagé pour le déploiement d’une solution, comme décrit dans [présentation du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-119">You use the split project file approach to solution deployment, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span>
- <span data-ttu-id="6948c-120">Vous appelez VSDBCMD à partir du fichier projet pour déployer votre projet de base de données, comme décrit dans [comprendre le processus de génération](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-120">You call VSDBCMD from the project file to deploy your database project, as described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="6948c-121">Pour créer un système de déploiement qui prend en charge de faire varier les propriétés de déploiement de base de données entre les environnements cibles, vous devrez :</span><span class="sxs-lookup"><span data-stu-id="6948c-121">To create a deployment system that supports varying the database deployment properties between target environments, you'll need to:</span></span>

- <span data-ttu-id="6948c-122">Créez un fichier de configuration (.sqldeployment) de déploiement pour chaque environnement cible.</span><span class="sxs-lookup"><span data-stu-id="6948c-122">Create a deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="6948c-123">Créer une commande VSDBCMD qui spécifie le fichier de configuration de déploiement comme un commutateur de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="6948c-123">Create a VSDBCMD command that specifies the deployment configuration file as a command-line switch.</span></span>
- <span data-ttu-id="6948c-124">Paramétrer la commande VSDBCMD dans un fichier de projet Microsoft Build Engine (MSBuild), afin que les options VSDBCMD sont appropriées à l’environnement cible.</span><span class="sxs-lookup"><span data-stu-id="6948c-124">Parameterize the VSDBCMD command in a Microsoft Build Engine (MSBuild) project file, so that the VSDBCMD options are appropriate to the target environment.</span></span>

<span data-ttu-id="6948c-125">Cette rubrique sera vous montrent comment effectuer chacune de ces procédures.</span><span class="sxs-lookup"><span data-stu-id="6948c-125">This topic will show you how to perform each of these procedures.</span></span>

## <a name="creating-environment-specific-deployment-configuration-files"></a><span data-ttu-id="6948c-126">Création de fichiers de Configuration spécifiques à l’environnement de déploiement</span><span class="sxs-lookup"><span data-stu-id="6948c-126">Creating Environment-Specific Deployment Configuration Files</span></span>

<span data-ttu-id="6948c-127">Par défaut, un projet de base de données contient un fichier de configuration de déploiement unique nommé *Database.sqldeployment*.</span><span class="sxs-lookup"><span data-stu-id="6948c-127">By default, a database project contains a single deployment configuration file named *Database.sqldeployment*.</span></span> <span data-ttu-id="6948c-128">Si vous ouvrez ce fichier dans Visual Studio 2010, vous pouvez voir différentes options de déploiement qui sont à votre disposition :</span><span class="sxs-lookup"><span data-stu-id="6948c-128">If you open this file in Visual Studio 2010, you can see the different deployment options that are available to you:</span></span>

- <span data-ttu-id="6948c-129">**Classement de la comparaison déploiement**.</span><span class="sxs-lookup"><span data-stu-id="6948c-129">**Deployment comparison collation**.</span></span> <span data-ttu-id="6948c-130">Cela vous permet de choisir s’il faut utiliser le classement de base de données de votre projet (le *source* classement) ou le classement de base de données de votre serveur de destination (le *cible* classement).</span><span class="sxs-lookup"><span data-stu-id="6948c-130">This lets you choose whether to use the database collation of your project (the *source* collation) or the database collation of your destination server (the *target* collation).</span></span> <span data-ttu-id="6948c-131">Dans la plupart des cas, vous souhaiterez utiliser le classement source lors de la déployer dans un environnement de développement ou de l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="6948c-131">In most cases, you'll want to use the source collation when you deploy to a development or test environment.</span></span> <span data-ttu-id="6948c-132">Lorsque vous déployez dans un environnement intermédiaire ou de production, vous souhaiterez généralement conserver le classement cible inchangé pour éviter tout problème d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="6948c-132">When you deploy to a staging or production environment, you'll usually want to leave the target collation unchanged to avoid any interoperability issues.</span></span>
- <span data-ttu-id="6948c-133">**Déployer les propriétés de la base de données**.</span><span class="sxs-lookup"><span data-stu-id="6948c-133">**Deploy database properties**.</span></span> <span data-ttu-id="6948c-134">Cela vous permet de choisir s’il faut appliquer les propriétés de la base de données, tel que défini dans le *Database.sqlsettings* fichier.</span><span class="sxs-lookup"><span data-stu-id="6948c-134">This lets you choose whether to apply the database properties, as defined in the *Database.sqlsettings* file.</span></span> <span data-ttu-id="6948c-135">Lorsque vous déployez une base de données pour la première fois, vous devez déployer les propriétés de la base de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-135">When you deploy a database for the first time, you should deploy the database properties.</span></span> <span data-ttu-id="6948c-136">Si vous mettez à jour une base de données existante, les propriétés doivent être déjà en place et vous n’avez pas besoin de les déployer de nouveau.</span><span class="sxs-lookup"><span data-stu-id="6948c-136">If you're updating an existing database, the properties should already be in place, and you shouldn't need to deploy them again.</span></span>
- <span data-ttu-id="6948c-137">**Toujours recréer la base de données**.</span><span class="sxs-lookup"><span data-stu-id="6948c-137">**Always re-create database**.</span></span> <span data-ttu-id="6948c-138">Ce vous permet de choisir s’il faut recréer la base de données cible chaque fois que vous déployez ou apportez des modifications incrémentielles à mettre la base de données cible à jour avec votre schéma.</span><span class="sxs-lookup"><span data-stu-id="6948c-138">This lets you choose whether to re-create the target database every time you deploy or make incremental changes to bring the target database up to date with your schema.</span></span> <span data-ttu-id="6948c-139">Si vous recréez la base de données, vous perdrez toutes les données dans la base de données existante.</span><span class="sxs-lookup"><span data-stu-id="6948c-139">If you re-create the database, you'll lose any data in the existing database.</span></span> <span data-ttu-id="6948c-140">Par conséquent, vous devez généralement définir cela sur **false** pour les déploiements dans un environnement intermédiaire ou de production.</span><span class="sxs-lookup"><span data-stu-id="6948c-140">As such, you should usually set this to **false** for deployments to staging or production environments.</span></span>
- <span data-ttu-id="6948c-141">**Bloquer le déploiement incrémentiel si une perte de données peut se produire**.</span><span class="sxs-lookup"><span data-stu-id="6948c-141">**Block incremental deployment if data loss might occur**.</span></span> <span data-ttu-id="6948c-142">Cela vous permet de choisir si déploiement doit s’arrêter si une modification au schéma de base de données entraîne la perte de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-142">This lets you choose whether deployment should stop if a change to the database schema will cause the loss of data.</span></span> <span data-ttu-id="6948c-143">Vous définissez ces propriétés **true** pour un déploiement dans un environnement de production, pour vous donner la possibilité d’intervenir et de protéger toutes les données importantes.</span><span class="sxs-lookup"><span data-stu-id="6948c-143">You typically set this to **true** for a deployment to a production environment, to give you the opportunity to intervene and protect any important data.</span></span> <span data-ttu-id="6948c-144">Si vous avez défini **base de données de la recréer toujours** à **false**, ce paramètre n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="6948c-144">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="6948c-145">**Exécuter un déploiement en mode mono-utilisateur**.</span><span class="sxs-lookup"><span data-stu-id="6948c-145">**Execute deployment in single-user mode**.</span></span> <span data-ttu-id="6948c-146">Cela n’est pas généralement un problème dans les environnements de développement ou de test.</span><span class="sxs-lookup"><span data-stu-id="6948c-146">This is not usually an issue in development or test environments.</span></span> <span data-ttu-id="6948c-147">Toutefois, vous devez généralement définir cela **true** pour les déploiements dans un environnement intermédiaire ou de production.</span><span class="sxs-lookup"><span data-stu-id="6948c-147">However, you should typically set this to **true** for deployments to staging or production environments.</span></span> <span data-ttu-id="6948c-148">Cela empêche les utilisateurs d’apporter des modifications à la base de données pendant le déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-148">This prevents users from making changes to the database while the deployment is underway.</span></span>
- <span data-ttu-id="6948c-149">**Sauvegarder la base de données avant le déploiement**.</span><span class="sxs-lookup"><span data-stu-id="6948c-149">**Back up database before deployment**.</span></span> <span data-ttu-id="6948c-150">Vous définissez ces propriétés **true** lorsque vous déployez dans un environnement de production, afin d’éviter une perte de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-150">You typically set this to **true** when you deploy to a production environment, as a precaution against data loss.</span></span> <span data-ttu-id="6948c-151">Vous pouvez également lui affecter **true** lorsque vous déployez dans un environnement intermédiaire, si votre base de données intermédiaire contient une grande quantité de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-151">You may also want to set it to **true** when you deploy to a staging environment, if your staging database contains a lot of data.</span></span>
- <span data-ttu-id="6948c-152">**Générer des instructions DROP pour les objets dans la base de données cible, mais qui ne sont pas dans le projet de base de données**.</span><span class="sxs-lookup"><span data-stu-id="6948c-152">**Generate DROP statements for objects that are in the target database but that are not in the database project**.</span></span> <span data-ttu-id="6948c-153">Dans la plupart des cas, il s’agit d’une partie intégrale et essentielle des modifications incrémentielles apportées à une base de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-153">In most cases, this is an integral and essential part of making incremental changes to a database.</span></span> <span data-ttu-id="6948c-154">Si vous avez défini **base de données de la recréer toujours** à **false**, ce paramètre n’a aucun effet.</span><span class="sxs-lookup"><span data-stu-id="6948c-154">If you have set **Always re-create database** to **false**, this setting will have no effect.</span></span>
- <span data-ttu-id="6948c-155">**N’utilisez pas d’instructions ALTER ASSEMBLY pour mettre à jour les types CLR**.</span><span class="sxs-lookup"><span data-stu-id="6948c-155">**Do not use ALTER ASSEMBLY statements to update CLR types**.</span></span> <span data-ttu-id="6948c-156">Ce paramètre détermine comment SQL Server doit mettre à jour les types common language runtime (CLR) aux plus récentes versions d’assembly.</span><span class="sxs-lookup"><span data-stu-id="6948c-156">This setting determines how SQL Server should update common language runtime (CLR) types to newer assembly versions.</span></span> <span data-ttu-id="6948c-157">Cela doit être défini sur **false** dans la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="6948c-157">This should be set to **false** in most scenarios.</span></span>

<span data-ttu-id="6948c-158">Ce tableau montre les paramètres de déploiement classique pour différents environnements de destination.</span><span class="sxs-lookup"><span data-stu-id="6948c-158">This table shows typical deployment settings for different destination environments.</span></span> <span data-ttu-id="6948c-159">Toutefois, vos paramètres peuvent différer selon vos besoins exacts.</span><span class="sxs-lookup"><span data-stu-id="6948c-159">However, your settings may be different depending on your exact requirements.</span></span>

|  | <span data-ttu-id="6948c-160">Développement/Test</span><span class="sxs-lookup"><span data-stu-id="6948c-160">Developer/Test</span></span> | <span data-ttu-id="6948c-161">Intégration/la mise en lots</span><span class="sxs-lookup"><span data-stu-id="6948c-161">Staging/Integration</span></span> | <span data-ttu-id="6948c-162">Production</span><span class="sxs-lookup"><span data-stu-id="6948c-162">Production</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6948c-163">**Classement de comparaison de déploiement**</span><span class="sxs-lookup"><span data-stu-id="6948c-163">**Deployment comparison collation**</span></span> | <span data-ttu-id="6948c-164">Source</span><span class="sxs-lookup"><span data-stu-id="6948c-164">Source</span></span> | <span data-ttu-id="6948c-165">une cible</span><span class="sxs-lookup"><span data-stu-id="6948c-165">Target</span></span> | <span data-ttu-id="6948c-166">une cible</span><span class="sxs-lookup"><span data-stu-id="6948c-166">Target</span></span> |
| <span data-ttu-id="6948c-167">**Déployer les propriétés de la base de données**</span><span class="sxs-lookup"><span data-stu-id="6948c-167">**Deploy database properties**</span></span> | <span data-ttu-id="6948c-168">True</span><span class="sxs-lookup"><span data-stu-id="6948c-168">True</span></span> | <span data-ttu-id="6948c-169">Uniquement la première fois</span><span class="sxs-lookup"><span data-stu-id="6948c-169">First time only</span></span> | <span data-ttu-id="6948c-170">Uniquement la première fois</span><span class="sxs-lookup"><span data-stu-id="6948c-170">First time only</span></span> |
| <span data-ttu-id="6948c-171">**Toujours recréer la base de données**</span><span class="sxs-lookup"><span data-stu-id="6948c-171">**Always re-create database**</span></span> | <span data-ttu-id="6948c-172">True</span><span class="sxs-lookup"><span data-stu-id="6948c-172">True</span></span> | <span data-ttu-id="6948c-173">False</span><span class="sxs-lookup"><span data-stu-id="6948c-173">False</span></span> | <span data-ttu-id="6948c-174">False</span><span class="sxs-lookup"><span data-stu-id="6948c-174">False</span></span> |
| <span data-ttu-id="6948c-175">**Bloquer le déploiement incrémentiel si une perte de données peut se produire.**</span><span class="sxs-lookup"><span data-stu-id="6948c-175">**Block incremental deployment if data loss might occur**</span></span> | <span data-ttu-id="6948c-176">False</span><span class="sxs-lookup"><span data-stu-id="6948c-176">False</span></span> | <span data-ttu-id="6948c-177">Peut-être</span><span class="sxs-lookup"><span data-stu-id="6948c-177">Maybe</span></span> | <span data-ttu-id="6948c-178">True</span><span class="sxs-lookup"><span data-stu-id="6948c-178">True</span></span> |
| <span data-ttu-id="6948c-179">**Exécutez le script de déploiement en mode mono-utilisateur**</span><span class="sxs-lookup"><span data-stu-id="6948c-179">**Execute deployment script in single-user mode**</span></span> | <span data-ttu-id="6948c-180">False</span><span class="sxs-lookup"><span data-stu-id="6948c-180">False</span></span> | <span data-ttu-id="6948c-181">True</span><span class="sxs-lookup"><span data-stu-id="6948c-181">True</span></span> | <span data-ttu-id="6948c-182">True</span><span class="sxs-lookup"><span data-stu-id="6948c-182">True</span></span> |
| <span data-ttu-id="6948c-183">**Sauvegarder la base de données avant le déploiement**</span><span class="sxs-lookup"><span data-stu-id="6948c-183">**Back up database before deployment**</span></span> | <span data-ttu-id="6948c-184">False</span><span class="sxs-lookup"><span data-stu-id="6948c-184">False</span></span> | <span data-ttu-id="6948c-185">Peut-être</span><span class="sxs-lookup"><span data-stu-id="6948c-185">Maybe</span></span> | <span data-ttu-id="6948c-186">True</span><span class="sxs-lookup"><span data-stu-id="6948c-186">True</span></span> |
| <span data-ttu-id="6948c-187">**Générer des instructions DROP pour les objets dans la base de données cible, mais qui ne sont pas dans le projet de base de données**</span><span class="sxs-lookup"><span data-stu-id="6948c-187">**Generate DROP statements for objects that are in the target database but that are not in the database project**</span></span> | <span data-ttu-id="6948c-188">False</span><span class="sxs-lookup"><span data-stu-id="6948c-188">False</span></span> | <span data-ttu-id="6948c-189">True</span><span class="sxs-lookup"><span data-stu-id="6948c-189">True</span></span> | <span data-ttu-id="6948c-190">True</span><span class="sxs-lookup"><span data-stu-id="6948c-190">True</span></span> |
| <span data-ttu-id="6948c-191">**N’utilisez pas d’instructions ALTER ASSEMBLY pour mettre à jour les types CLR**</span><span class="sxs-lookup"><span data-stu-id="6948c-191">**Do not use ALTER ASSEMBLY statements to update CLR types**</span></span> | <span data-ttu-id="6948c-192">False</span><span class="sxs-lookup"><span data-stu-id="6948c-192">False</span></span> | <span data-ttu-id="6948c-193">False</span><span class="sxs-lookup"><span data-stu-id="6948c-193">False</span></span> | <span data-ttu-id="6948c-194">False</span><span class="sxs-lookup"><span data-stu-id="6948c-194">False</span></span> |

> [!NOTE]
> <span data-ttu-id="6948c-195">Pour plus d’informations sur les propriétés de déploiement de base de données et les considérations sur l’environnement, consultez [une vue d’ensemble de base de données de paramètres de projet](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [Comment : Configurer les propriétés des détails du déploiement](https://msdn.microsoft.com/library/dd172125.aspx), [générer et déployer la base de données à un environnement de développement isolé](https://msdn.microsoft.com/library/dd193409.aspx), et [créer et déployer des bases de données dans un environnement intermédiaire ou d’un environnement de Production](https://msdn.microsoft.com/library/dd193413.aspx).</span><span class="sxs-lookup"><span data-stu-id="6948c-195">For more information on database deployment properties and environment considerations, see [An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx), [How to: Configure Properties for Deployment Details](https://msdn.microsoft.com/library/dd172125.aspx), [Build and Deploy Database to an Isolated Development Environment](https://msdn.microsoft.com/library/dd193409.aspx), and [Build and Deploy Databases to a Staging or Production Environment](https://msdn.microsoft.com/library/dd193413.aspx).</span></span>

<span data-ttu-id="6948c-196">Pour prendre en charge le déploiement d’un projet de base de données vers plusieurs destinations, vous devez créer un fichier de configuration de déploiement pour chaque environnement cible.</span><span class="sxs-lookup"><span data-stu-id="6948c-196">To support the deployment of a database project to multiple destinations, you should create a deployment configuration file for each target environment.</span></span>

<span data-ttu-id="6948c-197">**Pour créer un fichier de configuration spécifiques à l’environnement**</span><span class="sxs-lookup"><span data-stu-id="6948c-197">**To create an environment-specific configuration file**</span></span>

1. <span data-ttu-id="6948c-198">Dans Visual Studio 2010, dans le **l’Explorateur de solutions** fenêtre, cliquez sur votre projet de base de données, puis cliquez sur **propriétés**.</span><span class="sxs-lookup"><span data-stu-id="6948c-198">In Visual Studio 2010, in the **Solution Explorer** window, right-click your database project, and then click **Properties**.</span></span>
2. <span data-ttu-id="6948c-199">Dans la page de propriétés de projet de base de données, sur le **déployer** sous l’onglet le **fichier de configuration de déploiement** de ligne, cliquez sur **New**.</span><span class="sxs-lookup"><span data-stu-id="6948c-199">On the database project properties page, on the **Deploy** tab, in the **Deployment configuration file** row, click **New**.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image1.png)
3. <span data-ttu-id="6948c-200">Dans le **nouveau fichier de Configuration de déploiement** boîte de dialogue zone, attribuez au fichier un nom explicite (par exemple, **TestEnvironment.sqldeployment**), puis cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="6948c-200">In the **New Deployment Configuration File** dialog box, give the file a meaningful name (for example, **TestEnvironment.sqldeployment**), and then click **Save**.</span></span>
4. <span data-ttu-id="6948c-201">Sur le *[nom_fichier] \*\*\* .sqldeployment*\* page, définissez les propriétés de déploiement qui répondent aux besoins de votre environnement de destination, puis enregistrez le fichier.</span><span class="sxs-lookup"><span data-stu-id="6948c-201">On the *[Filename]\*\*\*.sqldeployment*\* page, set the deployment properties to match the requirements of your destination environment, and then save the file.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image2.png)
5. <span data-ttu-id="6948c-202">Notez que le nouveau fichier est ajouté au dossier des propriétés dans votre projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-202">Notice that the new file is added to the Properties folder in your database project.</span></span>

    ![](customizing-database-deployments-for-multiple-environments/_static/image3.png)

## <a name="specifying-the-deployment-configuration-file-in-vsdbcmd"></a><span data-ttu-id="6948c-203">En spécifiant le fichier de Configuration de déploiement dans VSDBCMD</span><span class="sxs-lookup"><span data-stu-id="6948c-203">Specifying the Deployment Configuration File in VSDBCMD</span></span>

<span data-ttu-id="6948c-204">Lorsque vous utilisez des configurations de solution (par exemple, Debug et Release) de Visual Studio 2010, vous pouvez associer un fichier de configuration de déploiement avec chaque configuration.</span><span class="sxs-lookup"><span data-stu-id="6948c-204">When you use solution configurations (like Debug and Release) within Visual Studio 2010, you can associate a deployment configuration file with each configuration.</span></span> <span data-ttu-id="6948c-205">Lorsque vous créez une configuration particulière, le processus de génération génère un fichier de manifeste de déploiement spécifique de la configuration qui pointe vers le fichier de configuration de déploiement spécifique de la configuration.</span><span class="sxs-lookup"><span data-stu-id="6948c-205">When you build a particular configuration, the build process generates a configuration-specific deployment manifest file that points to the configuration-specific deployment configuration file.</span></span> <span data-ttu-id="6948c-206">Toutefois, un des objectifs principaux de l’approche de déploiement décrite dans ces didacticiels est donnons la possibilité de contrôler le processus de déploiement sans utiliser Visual Studio 2010 et les configurations de solutions.</span><span class="sxs-lookup"><span data-stu-id="6948c-206">However, one of the main aims of the approach to deployment described in these tutorials is to give people the ability to control the deployment process without using Visual Studio 2010 and solution configurations.</span></span> <span data-ttu-id="6948c-207">Dans cette approche, la configuration de solution est le même quel que soit l’environnement de déploiement cible.</span><span class="sxs-lookup"><span data-stu-id="6948c-207">In this approach, the solution configuration is the same regardless of the target deployment environment.</span></span> <span data-ttu-id="6948c-208">Pour personnaliser votre déploiement de base de données dans un environnement de destination spécifique, vous pouvez utiliser les options de ligne de commande VSDBCMD pour spécifier votre fichier de configuration de déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-208">To tailor your database deployment to a specific destination environment, you can use the VSDBCMD command-line options to specify your deployment configuration file.</span></span>

<span data-ttu-id="6948c-209">Pour spécifier un fichier de configuration de déploiement dans votre VSDBCMD, utilisez le **p:/DeploymentConfigurationFile** basculer et fournir le chemin d’accès complet à votre fichier.</span><span class="sxs-lookup"><span data-stu-id="6948c-209">To specify a deployment configuration file in your VSDBCMD, use the **p:/DeploymentConfigurationFile** switch and provide the full path to your file.</span></span> <span data-ttu-id="6948c-210">Cela remplace le fichier de configuration de déploiement qui identifie le manifeste de déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-210">This will override the deployment configuration file that the deployment manifest identifies.</span></span> <span data-ttu-id="6948c-211">Par exemple, vous pouvez utiliser cette commande VSDBCMD pour déployer le **ContactManager** base de données à un environnement de test :</span><span class="sxs-lookup"><span data-stu-id="6948c-211">For example, you could use this VSDBCMD command to deploy the **ContactManager** database to a test environment:</span></span>

[!code-console[Main](customizing-database-deployments-for-multiple-environments/samples/sample1.cmd)]

> [!NOTE]
> <span data-ttu-id="6948c-212">Notez que le processus de génération peut renommer votre fichier .sqldeployment lorsqu’il copie le fichier vers le répertoire de sortie.</span><span class="sxs-lookup"><span data-stu-id="6948c-212">Note that the build process may rename your .sqldeployment file when it copies the file to the output directory.</span></span>

<span data-ttu-id="6948c-213">Si vous utilisez des variables de commande SQL dans vos scripts SQL de prédéploiement ou de post-déploiement, vous pouvez utiliser une approche similaire pour associer un fichier spécifique à l’environnement .sqlcmdvars à votre déploiement.</span><span class="sxs-lookup"><span data-stu-id="6948c-213">If you use SQL command variables in your pre-deployment or post-deployment SQL scripts, you can use a similar approach to associate an environment-specific .sqlcmdvars file with your deployment.</span></span> <span data-ttu-id="6948c-214">Dans ce cas, vous utilisez le **p:/SqlCommandVariablesFile** commutateur pour identifier votre fichier .sqlcmdvars.</span><span class="sxs-lookup"><span data-stu-id="6948c-214">In this case, you use the **p:/SqlCommandVariablesFile** switch to identify your .sqlcmdvars file.</span></span>

## <a name="running-the-vsdbcmd-command-from-an-msbuild-project-file"></a><span data-ttu-id="6948c-215">La commande VSDBCMD en cours d’exécution à partir d’un fichier projet MSBuild</span><span class="sxs-lookup"><span data-stu-id="6948c-215">Running the VSDBCMD Command from an MSBuild Project File</span></span>

<span data-ttu-id="6948c-216">Vous pouvez appeler une commande VSDBCMD à partir d’un fichier projet MSBuild à l’aide un **Exec** tâche dans une cible MSBuild.</span><span class="sxs-lookup"><span data-stu-id="6948c-216">You can invoke a VSDBCMD command from an MSBuild project file by using an **Exec** task within an MSBuild target.</span></span> <span data-ttu-id="6948c-217">Dans sa forme la plus simple, elle ressemblerait à ceci :</span><span class="sxs-lookup"><span data-stu-id="6948c-217">In its simplest form, it would look like this:</span></span>

[!code-xml[Main](customizing-database-deployments-for-multiple-environments/samples/sample2.xml)]

- <span data-ttu-id="6948c-218">Dans la pratique, pour rendre vos fichiers projet facile à lire et à réutiliser, vous souhaiterez créer des propriétés pour stocker les différents paramètres de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="6948c-218">In practice, to make your project files easy to read and reuse, you'll want to create properties to store the various command-line parameters.</span></span> <span data-ttu-id="6948c-219">Cela rend plus facile pour les utilisateurs à fournir des valeurs de propriété dans un fichier de projet spécifique à l’environnement ou à remplacer les valeurs par défaut à partir de la ligne de commande MSBuild.</span><span class="sxs-lookup"><span data-stu-id="6948c-219">This makes it easier for users to provide property values in an environment-specific project file or to override default values from the MSBuild command line.</span></span> <span data-ttu-id="6948c-220">Si vous utilisez l’approche de fichier de projet de fractionnement décrite dans [présentation du fichier de projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md), vous devez diviser vos instructions de génération et les propriétés entre les deux fichiers en conséquence :</span><span class="sxs-lookup"><span data-stu-id="6948c-220">If you use the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), you should divide your build instructions and properties between the two files accordingly:</span></span>
- <span data-ttu-id="6948c-221">Les paramètres spécifiques à l’environnement, telles que le nom de fichier de configuration de déploiement, la chaîne de connexion de base de données et le nom de la base de données cible doit être placé dans le fichier de projet spécifique à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="6948c-221">Environment-specific settings, like the deployment configuration filename, the database connection string, and the target database name, should go in the environment-specific project file.</span></span>
- <span data-ttu-id="6948c-222">La cible MSBuild qui exécute la commande VSDBCMD, ainsi que toutes les propriétés telles que l’emplacement de l’exécutable VSDBCMD, universelles doit être placé dans le fichier de projet d’application universelle.</span><span class="sxs-lookup"><span data-stu-id="6948c-222">The MSBuild target that runs the VSDBCMD command, together with any universal properties like the location of the VSDBCMD executable, should go in the universal project file.</span></span>

<span data-ttu-id="6948c-223">Vous devez également vous assurer que vous générez le projet de base de données avant de vous appelez VSDBCMD afin que le fichier .deploymanifest est créé et prêt à être utilisé.</span><span class="sxs-lookup"><span data-stu-id="6948c-223">You should also ensure that you build the database project before you invoke VSDBCMD so that the .deploymanifest file is created and ready to use.</span></span> <span data-ttu-id="6948c-224">Vous pouvez voir un exemple complet de cette approche dans la rubrique [comprendre le processus de génération](../web-deployment-in-the-enterprise/understanding-the-build-process.md), qui vous guide dans les fichiers projet dans le [solution d’exemple de gestionnaire de contacts](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-224">You can see a full example of this approach in the topic [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), which walks you through the project files in the [Contact Manager sample solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md).</span></span>

## <a name="conclusion"></a><span data-ttu-id="6948c-225">Conclusion</span><span class="sxs-lookup"><span data-stu-id="6948c-225">Conclusion</span></span>

<span data-ttu-id="6948c-226">Cette rubrique décrit comment vous pouvez adapter les propriétés de base de données pour différents environnements de destination lorsque vous déployez des projets de base de données à l’aide de MSBuild et VSDBCMD.</span><span class="sxs-lookup"><span data-stu-id="6948c-226">This topic described how you can tailor database properties to different destination environments when you deploy database projects using MSBuild and VSDBCMD.</span></span> <span data-ttu-id="6948c-227">Cette approche est utile lorsque vous avez besoin déployer des projets de base de données dans le cadre de la plus grande, solutions d’échelle de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="6948c-227">This approach is useful when you need to deploy database projects as part of larger, enterprise-scale solutions.</span></span> <span data-ttu-id="6948c-228">Ces solutions sont souvent déployées vers plusieurs destinations, telles que des environnements sandbox de développement ou de test, intermédiaire ou l’intégration des plates-formes et production ou des environnements en direct.</span><span class="sxs-lookup"><span data-stu-id="6948c-228">These solutions are often deployed to multiple destinations, like sandboxed development or test environments, staging or integration platforms, and production or live environments.</span></span> <span data-ttu-id="6948c-229">Chacun de ces environnements cible nécessite généralement un ensemble unique de propriétés de déploiement de base de données.</span><span class="sxs-lookup"><span data-stu-id="6948c-229">Each of these target environments typically requires a unique set of database deployment properties.</span></span>

## <a name="further-reading"></a><span data-ttu-id="6948c-230">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="6948c-230">Further Reading</span></span>

<span data-ttu-id="6948c-231">Pour plus d’informations sur le déploiement des projets de base de données à l’aide de VSDBCMD.exe, consultez [déploiement de projets de base de données](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-231">For more information on deploying database projects using VSDBCMD.exe, see [Deploying Database Projects](../web-deployment-in-the-enterprise/deploying-database-projects.md).</span></span> <span data-ttu-id="6948c-232">Pour plus d’informations sur l’utilisation de fichiers de projet MSBuild personnalisées pour contrôler le processus de déploiement, consultez [présentation du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md) et [comprendre le processus de génération](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span><span class="sxs-lookup"><span data-stu-id="6948c-232">For more information on using custom MSBuild project files to control the deployment process, see [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md) and [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md).</span></span>

<span data-ttu-id="6948c-233">Ces articles sur MSDN fournissent des instructions plus générales sur le déploiement de la base de données :</span><span class="sxs-lookup"><span data-stu-id="6948c-233">These articles on MSDN provide more general guidance on database deployment:</span></span>

- <span data-ttu-id="6948c-234">[Une vue d’ensemble de paramètres de projet de base de données](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="6948c-234">[An Overview of Database Project Settings](https://msdn.microsoft.com/library/aa833291(v=VS.100).aspx)</span></span>
- [<span data-ttu-id="6948c-235">Guide pratique pour Configurer les propriétés des détails du déploiement</span><span class="sxs-lookup"><span data-stu-id="6948c-235">How to: Configure Properties for Deployment Details</span></span>](https://msdn.microsoft.com/library/dd172125.aspx)
- [<span data-ttu-id="6948c-236">Créer et déployer des bases de données dans un environnement de développement isolé</span><span class="sxs-lookup"><span data-stu-id="6948c-236">Build and Deploy Databases to an Isolated Development Environment</span></span>](https://msdn.microsoft.com/library/dd193409.aspx)
- [<span data-ttu-id="6948c-237">Créer et déployer des bases de données dans un environnement intermédiaire ou d’un environnement de Production</span><span class="sxs-lookup"><span data-stu-id="6948c-237">Build and Deploy Databases to a Staging or Production Environment</span></span>](https://msdn.microsoft.com/library/dd193413.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="6948c-238">[Précédent](performing-a-what-if-deployment.md)
> [Suivant](deploying-database-role-memberships-to-test-environments.md)</span><span class="sxs-lookup"><span data-stu-id="6948c-238">[Previous](performing-a-what-if-deployment.md)
[Next](deploying-database-role-memberships-to-test-environments.md)</span></span>
