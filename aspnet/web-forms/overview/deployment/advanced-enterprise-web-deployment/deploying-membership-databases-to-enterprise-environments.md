---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
title: Déploiement de bases de données d’appartenance dans des environnements d’entreprise | Microsoft Docs
author: jrjlee
description: Cette rubrique explique les principaux points à prendre en compte lors de la configuration des bases de données des services d’application ASP.NET (plus courantes...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3cf765df-d311-4f68-a295-c9685ceea830
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments
msc.type: authoredcontent
ms.openlocfilehash: 50f49af502b75aa5ad52756a76a5e7340aca53f7
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78526004"
---
# <a name="deploying-membership-databases-to-enterprise-environments"></a><span data-ttu-id="82fd6-103">Déploiement de bases de données d’appartenance pour les environnements d’entreprise</span><span class="sxs-lookup"><span data-stu-id="82fd6-103">Deploying Membership Databases to Enterprise Environments</span></span>

<span data-ttu-id="82fd6-104">par [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="82fd6-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="82fd6-105">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="82fd6-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="82fd6-106">Cette rubrique explique les principaux points à prendre en compte lorsque vous approvisionnez des bases de données de services d’application ASP.NET (plus communément appelées bases de données d’appartenance) dans des environnements de test, intermédiaires ou de production.</span><span class="sxs-lookup"><span data-stu-id="82fd6-106">This topic explains the key considerations and challenges you'll need to overcome when you provision ASP.NET application services databases (more commonly referred to as membership databases) in test, staging, or production environments.</span></span> <span data-ttu-id="82fd6-107">Il décrit également les approches que vous pouvez utiliser pour répondre à ces défis.</span><span class="sxs-lookup"><span data-stu-id="82fd6-107">It also describes approaches you can use to meet these challenges.</span></span>

<span data-ttu-id="82fd6-108">Cette rubrique fait partie d’une série de didacticiels basés sur les exigences de déploiement en entreprise d’une société fictive nommée Fabrikam, Inc. Cette série de didacticiels utilise un&#x2014;exemple de solution de [gestion des contacts](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;pour représenter une application Web avec un niveau de complexité réaliste, y compris une application ASP.NET MVC 3, un service Windows Communication Foundation (WCF) et un projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="82fd6-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="82fd6-109">La méthode de déploiement au cœur de ces didacticiels est basée sur l’approche de fichier de projet fractionné décrite dans [fonctionnement du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md), dans lequel le processus de génération est contrôlé&#x2014;par deux fichiers projet qui contiennent des instructions de génération qui s’appliquent à chaque environnement de destination, et un qui contient des paramètres de génération et de déploiement spécifiques à l’environnement.</span><span class="sxs-lookup"><span data-stu-id="82fd6-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="82fd6-110">Au moment de la génération, le fichier projet spécifique à l’environnement est fusionné dans le fichier projet indépendant de l’environnement pour former un ensemble complet d’instructions de génération.</span><span class="sxs-lookup"><span data-stu-id="82fd6-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="what-are-the-issues-when-you-deploy-a-membership-database"></a><span data-ttu-id="82fd6-111">Quels sont les problèmes lorsque vous déployez une base de données d’appartenance ?</span><span class="sxs-lookup"><span data-stu-id="82fd6-111">What Are the Issues When You Deploy a Membership Database?</span></span>

<span data-ttu-id="82fd6-112">Dans la plupart des cas, lorsque vous concevez une stratégie de déploiement pour une base de données, la première chose que vous devez prendre en compte est celle que vous souhaitez déployer.</span><span class="sxs-lookup"><span data-stu-id="82fd6-112">In most cases, when you devise a deployment strategy for a database, the first thing you need to consider is what data you want to deploy.</span></span> <span data-ttu-id="82fd6-113">Dans un environnement de développement ou de test, vous souhaiterez peut-être déployer des données de compte d’utilisateur pour accélérer et faciliter les tests.</span><span class="sxs-lookup"><span data-stu-id="82fd6-113">In a development or test environment, you might want to deploy user account data to facilitate quick and easy testing.</span></span> <span data-ttu-id="82fd6-114">Dans un environnement intermédiaire ou de production, il est très peu probable que vous souhaitiez déployer des données de compte d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="82fd6-114">In a staging or production environment, it's very unlikely that you'd want to deploy user account data.</span></span>

<span data-ttu-id="82fd6-115">Malheureusement, les bases de données d’appartenance ASP.NET présentent des défis spécifiques qui rendent cette décision beaucoup plus complexe :</span><span class="sxs-lookup"><span data-stu-id="82fd6-115">Unfortunately, ASP.NET membership databases introduce some specific challenges that make this decision a lot more complex:</span></span>

- <span data-ttu-id="82fd6-116">Un déploiement de schéma uniquement laisse la base de données d’appartenance dans un État non opérationnel.</span><span class="sxs-lookup"><span data-stu-id="82fd6-116">A schema-only deployment will leave the membership database in a non-operational state.</span></span> <span data-ttu-id="82fd6-117">Cela est dû au fait que la base de données d’appartenance comprend des données de configuration (dans la table **aspnet\_SchemaVersions** ) dont la base de données a besoin pour fonctionner.</span><span class="sxs-lookup"><span data-stu-id="82fd6-117">This is because the membership database includes some configuration data (in the **aspnet\_SchemaVersions** table) that the database requires in order to function.</span></span> <span data-ttu-id="82fd6-118">Par conséquent, si vous effectuez un déploiement de schéma uniquement de votre base de données d’appartenance afin d’exclure les données de compte d’utilisateur, vous devez exécuter un script de publication pour ajouter les données de configuration essentielles.</span><span class="sxs-lookup"><span data-stu-id="82fd6-118">As such, if you perform a schema-only deployment of your membership database in order to exclude user account data, you'll need to run a post-deployment script to add the essential configuration data.</span></span>
- <span data-ttu-id="82fd6-119">Selon la configuration de votre base de données d’appartenance, le fournisseur d’appartenances peut utiliser la clé de l’ordinateur pour chiffrer les mots de passe et les stocker dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="82fd6-119">Depending on how your membership database is configured, the membership provider may use the machine key to encrypt passwords and store them in the database.</span></span> <span data-ttu-id="82fd6-120">Dans ce cas, les données de compte d’utilisateur que vous déployez avec la base de données deviennent inutilisables sur le serveur de destination.</span><span class="sxs-lookup"><span data-stu-id="82fd6-120">In this case, any user account data you deploy with the database will become unusable on the destination server.</span></span> <span data-ttu-id="82fd6-121">Pour cette raison, le déploiement des données de compte d’utilisateur n’est pas un scénario pris en charge.</span><span class="sxs-lookup"><span data-stu-id="82fd6-121">For this reason, deploying user account data is not a supported scenario.</span></span>

## <a name="choosing-a-membership-database-strategy"></a><span data-ttu-id="82fd6-122">Choix d’une stratégie de base de données d’appartenance</span><span class="sxs-lookup"><span data-stu-id="82fd6-122">Choosing a Membership Database Strategy</span></span>

<span data-ttu-id="82fd6-123">Suivez ces instructions lorsque vous choisissez le mode d’approvisionnement d’une base de données d’appartenance dans un environnement de serveur d’entreprise :</span><span class="sxs-lookup"><span data-stu-id="82fd6-123">Use these guidelines when you choose how to provision a membership database in an enterprise server environment:</span></span>

- <span data-ttu-id="82fd6-124">Dans la mesure du possible, ne déployez pas les bases de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="82fd6-124">Wherever possible, do not deploy membership databases.</span></span> <span data-ttu-id="82fd6-125">Au lieu de cela, créez la base de données d’appartenance manuellement sur le serveur de base de données cible.</span><span class="sxs-lookup"><span data-stu-id="82fd6-125">Instead, create the membership database manually on the target database server.</span></span> <span data-ttu-id="82fd6-126">Si vous n’avez pas personnalisé le schéma de votre base de données d’appartenance, vous pouvez simplement en créer un nouveau dans l’emplacement de destination à l’aide de l' [outil ASP.NET SQL Server Registration (aspnet\_RegSql. exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-126">If you haven't customized your membership database schema, you can simply create a new one in situ at the destination using the [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span>
- <span data-ttu-id="82fd6-127">Si vous n’avez pas d’option mais que vous souhaitez&#x2014;déployer une base de données d’appartenance, par exemple, si vous&#x2014;avez apporté des modifications importantes au schéma de base de données, vous devez effectuer un déploiement de la base de données d’appartenance dans un schéma uniquement, pour exclure les données de compte d’utilisateur, puis exécuter un script de publication pour ajouter les données de configuration requises.</span><span class="sxs-lookup"><span data-stu-id="82fd6-127">If you have no option but to deploy a membership database&#x2014;for example, if you've made extensive modifications to the database schema&#x2014;you should perform a schema-only deployment of the membership database, to exclude user account data, and then run a post-deployment script to add any required configuration data.</span></span> <span data-ttu-id="82fd6-128">Vous trouverez des instructions générales sur ces approches dans [Comment : déployer la base de données d’appartenance ASP.net sans inclure de comptes d’utilisateur](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-128">You can find broad guidance on these approaches in [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

<span data-ttu-id="82fd6-129">Il est important de se souvenir que *le schéma de votre base de données d’appartenance est susceptible d’être relativement statique*.</span><span class="sxs-lookup"><span data-stu-id="82fd6-129">It's important to remember that *the schema of your membership database is likely to be fairly static*.</span></span> <span data-ttu-id="82fd6-130">Même si vous avez personnalisé la base de données d’appartenance, il est peu probable que vous deviez mettre à jour le&#x2014;schéma régulièrement. il ne va pas changer avec la même fréquence que le code d’une application Web ou d’un projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="82fd6-130">Even if you've customized the membership database, it's unlikely that you'll need to update the schema on a regular basis&#x2014;it's not going to change with the same frequency as the code in a web application or a database project.</span></span> <span data-ttu-id="82fd6-131">Par conséquent, il n’est pas nécessaire d’inclure la base de données d’appartenance dans des processus de déploiement automatisés ou en une seule étape.</span><span class="sxs-lookup"><span data-stu-id="82fd6-131">As such, you shouldn't need to include the membership database in any automated or single-step deployment processes.</span></span>

## <a name="using-vsdbcmd-to-update-a-membership-database-schema"></a><span data-ttu-id="82fd6-132">Utilisation de VSDBCMD pour mettre à jour un schéma de base de données d’appartenance</span><span class="sxs-lookup"><span data-stu-id="82fd6-132">Using VSDBCMD to Update a Membership Database Schema</span></span>

<span data-ttu-id="82fd6-133">Si vous modifiez la structure de votre base de données d’appartenance après votre premier déploiement, vous ne souhaiterez peut-être pas utiliser l’outil de déploiement Web (Web Deploy) Internet Information Services (IIS) pour redéployer la base de données.</span><span class="sxs-lookup"><span data-stu-id="82fd6-133">If you modify the structure of your membership database after your first deployment, you may not want to use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to redeploy the database.</span></span> <span data-ttu-id="82fd6-134">La fonctionnalité de déploiement de base de données dans Web Deploy n’inclut pas la possibilité d’effectuer des mises à&#x2014;jour différentielles à une base de données de destination à la place, Web Deploy devez supprimer et recréer la base de données.</span><span class="sxs-lookup"><span data-stu-id="82fd6-134">The database deployment functionality in Web Deploy doesn't include the capability to make differential updates to a destination database&#x2014;instead, Web Deploy must drop and re-create the database.</span></span> <span data-ttu-id="82fd6-135">Cela signifie que vous perdez les données de compte d’utilisateur existantes, ce qui n’est généralement pas souhaitable dans les environnements intermédiaires ou de production.</span><span class="sxs-lookup"><span data-stu-id="82fd6-135">This means that you lose any existing user account data, which is typically undesirable in staging or production environments.</span></span>

<span data-ttu-id="82fd6-136">L’alternative consiste à utiliser l’utilitaire VSDBCMD pour mettre à jour le schéma de votre base de données de destination.</span><span class="sxs-lookup"><span data-stu-id="82fd6-136">The alternative is to use the VSDBCMD utility to update the schema of your destination database.</span></span> <span data-ttu-id="82fd6-137">VSDBCMD comprend deux fonctionnalités importantes.</span><span class="sxs-lookup"><span data-stu-id="82fd6-137">VSDBCMD includes two important capabilities.</span></span> <span data-ttu-id="82fd6-138">Tout d’abord, il peut importer le schéma d’une base de données existante dans un fichier. dbschema.</span><span class="sxs-lookup"><span data-stu-id="82fd6-138">First, it can import the schema of an existing database into a .dbschema file.</span></span> <span data-ttu-id="82fd6-139">Deuxièmement, il peut déployer un fichier. dbschema dans une base de données existante en tant que mise à jour différentielle, ce qui signifie qu’il effectue uniquement les modifications nécessaires pour mettre à jour la base de données cible et que vous ne perdez aucune donnée.</span><span class="sxs-lookup"><span data-stu-id="82fd6-139">Second, it can deploy a .dbschema file to an existing database as a differential update, which means that it only makes the changes required to bring the target database up to date and you don't lose any data.</span></span>

<span data-ttu-id="82fd6-140">Vous pouvez utiliser ces étapes de haut niveau pour mettre à jour un schéma de base de données d’appartenance :</span><span class="sxs-lookup"><span data-stu-id="82fd6-140">You can use these high-level steps to update a membership database schema:</span></span>

1. <span data-ttu-id="82fd6-141">Utilisez l’action d' **importation** VSDBCMD pour générer un fichier. dbschema pour votre base de données d’appartenance source.</span><span class="sxs-lookup"><span data-stu-id="82fd6-141">Use the VSDBCMD **Import** action to generate a .dbschema file for your source membership database.</span></span> <span data-ttu-id="82fd6-142">Cette procédure est décrite dans [procédure : importer un schéma à partir d’une invite de commandes](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-142">This procedure is described in [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span>
2. <span data-ttu-id="82fd6-143">Utilisez l’action VSDBCMD **Deploy** pour déployer le fichier. dbschema dans votre base de données d’appartenance de destination.</span><span class="sxs-lookup"><span data-stu-id="82fd6-143">Use the VSDBCMD **Deploy** action to deploy the .dbschema file to your destination membership database.</span></span> <span data-ttu-id="82fd6-144">Cette procédure est décrite dans [référence de la ligne de commande pour VSDBCMD. EXE (déploiement et importation de schéma)](https://msdn.microsoft.com/library/dd193283.aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-144">This procedure is described in [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx).</span></span>

## <a name="conclusion"></a><span data-ttu-id="82fd6-145">Conclusion</span><span class="sxs-lookup"><span data-stu-id="82fd6-145">Conclusion</span></span>

<span data-ttu-id="82fd6-146">Cette rubrique décrit certains des problèmes que vous pouvez rencontrer lorsque vous avez besoin d’approvisionner des bases de données d’appartenance ASP.NET dans différents environnements cibles.</span><span class="sxs-lookup"><span data-stu-id="82fd6-146">This topic described some of the challenges you may face when you need to provision ASP.NET membership databases in various target environments.</span></span> <span data-ttu-id="82fd6-147">En particulier, il expliquait pourquoi les déploiements de schéma uniquement laissent la base de données d’appartenance dans un État non opérationnel et pourquoi le déploiement des données de compte d’utilisateur n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="82fd6-147">In particular, it explained why schema-only deployments will leave the membership database in a non-operational state and why deploying user account data is not supported.</span></span> <span data-ttu-id="82fd6-148">Elle explique également comment approvisionner, déployer et mettre à jour des bases de données d’appartenance dans différents scénarios.</span><span class="sxs-lookup"><span data-stu-id="82fd6-148">The topic also presented guidance on how to provision, deploy, and update membership databases in different scenarios.</span></span>

## <a name="further-reading"></a><span data-ttu-id="82fd6-149">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="82fd6-149">Further Reading</span></span>

<span data-ttu-id="82fd6-150">Pour obtenir des instructions et des exemples d’utilisation de VSDBCMD, consultez [référence de ligne de commande pour VSDBCMD. EXE (déploiement et importation de schéma)](https://msdn.microsoft.com/library/dd193283.aspx) et [procédure : importer un schéma à partir d’une invite de commandes](https://msdn.microsoft.com/library/dd172135.aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-150">For more guidance and examples of how to use VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Import a Schema from a Command Prompt](https://msdn.microsoft.com/library/dd172135.aspx).</span></span> <span data-ttu-id="82fd6-151">Pour plus d’informations sur l’utilisation de ASPNET\_RegSql. exe pour créer des bases de données d’appartenance, consultez [ASP.NET SQL Server Registration Tool (aspnet\_RegSql. exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-151">For more information on using aspnet\_regsql.exe to create membership databases, see [ASP.NET SQL Server Registration Tool (aspnet\_regsql.exe)](https://msdn.microsoft.com/library/ms229862(v=vs.100).aspx).</span></span> <span data-ttu-id="82fd6-152">Pour obtenir des instructions plus générales sur le déploiement de bases de données d’appartenance, consultez [procédure : déployer la base de données d’appartenance ASP.net sans inclure de comptes d’utilisateur](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="82fd6-152">For more general guidance on deploying membership databases, see [How to: Deploy the ASP.NET Membership Database Without Including User Accounts](https://msdn.microsoft.com/library/ff361972(v=vs.100).aspx).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="82fd6-153">[Précédent](deploying-database-role-memberships-to-test-environments.md)
> [Suivant](excluding-files-and-folders-from-deployment.md)</span><span class="sxs-lookup"><span data-stu-id="82fd6-153">[Previous](deploying-database-role-memberships-to-test-environments.md)
[Next](excluding-files-and-folders-from-deployment.md)</span></span>
