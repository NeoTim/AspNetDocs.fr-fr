---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Passage d’Applications Web en mode hors connexion avec Web déployer | Microsoft Docs
author: jrjlee
description: Cette rubrique explique comment prendre une application web en mode hors connexion pendant la durée d’un déploiement automatisé à l’aide du dépl Web Internet Information Services (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: 017eceb8567859fdbe28bb87af844eee20dfa525
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59415477"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="b25a6-103">Passage d’applications web hors connexion avec Web Deploy</span><span class="sxs-lookup"><span data-stu-id="b25a6-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="b25a6-104">par [Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="b25a6-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="b25a6-105">Télécharger le PDF</span><span class="sxs-lookup"><span data-stu-id="b25a6-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="b25a6-106">Cette rubrique décrit comment prendre une application web en mode hors connexion pendant la durée d’un déploiement automatisé à l’aide de l’outil de déploiement Web Internet Information Services (IIS) (Web Deploy).</span><span class="sxs-lookup"><span data-stu-id="b25a6-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="b25a6-107">Les utilisateurs qui accèdent à l’application web sont redirigés vers un *application\_offline.htm* fichier jusqu'à ce que le déploiement est terminé.</span><span class="sxs-lookup"><span data-stu-id="b25a6-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>


<span data-ttu-id="b25a6-108">Cette rubrique fait partie d’une série de didacticiels basées sur les exigences de déploiement d’entreprise de la société fictive Fabrikam, Inc. Cette série de didacticiels utilise un exemple de solution&#x2014;le [solution Gestionnaire de contacts](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;pour représenter une application web avec un niveau réaliste de complexité, y compris une application ASP.NET MVC 3, une Communication de Windows Foundation (WCF) service et un projet de base de données.</span><span class="sxs-lookup"><span data-stu-id="b25a6-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="b25a6-109">La méthode de déploiement au cœur de ces didacticiels est basée sur l’approche de fichier de projet de fractionnement décrite dans [présentation du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md), dans lequel le processus de génération est contrôlé par deux fichiers de projet&#x2014;contenant un seul les instructions qui s’appliquent à chaque environnement de destination et celui qui contient les paramètres de génération et de déploiement spécifiques à l’environnement de génération.</span><span class="sxs-lookup"><span data-stu-id="b25a6-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="b25a6-110">Au moment de la génération, le fichier de projet spécifique à l’environnement est fusionné dans le fichier de projet d’indépendant de l’environnement pour former un ensemble complet d’instructions de génération.</span><span class="sxs-lookup"><span data-stu-id="b25a6-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="b25a6-111">Présentation de la tâche</span><span class="sxs-lookup"><span data-stu-id="b25a6-111">Task Overview</span></span>

<span data-ttu-id="b25a6-112">Dans de nombreux scénarios, vous souhaiterez hors connexion d’une application web pendant que vous apportez des modifications à des composants associés, tels que les bases de données ou des services web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="b25a6-113">En règle générale, dans IIS et ASP.NET, vous y parvenir en plaçant un fichier nommé *application\_offline.htm* dans le dossier racine de l’application de site Web ou web IIS.</span><span class="sxs-lookup"><span data-stu-id="b25a6-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="b25a6-114">Le *application\_offline.htm* fichier est un fichier HTML standard et contient généralement un simple message informant l’utilisateur que le site est temporairement indisponible en raison de la maintenance.</span><span class="sxs-lookup"><span data-stu-id="b25a6-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="b25a6-115">Bien que le *application\_offline.htm* le fichier existe dans le dossier racine du site Web, IIS redirige automatiquement toutes les demandes vers le fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="b25a6-116">Lorsque vous avez terminé d’apporter des mises à jour, vous supprimez le *application\_offline.htm* de fichiers et le site Web reprend de servir les requêtes comme d’habitude.</span><span class="sxs-lookup"><span data-stu-id="b25a6-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="b25a6-117">Lorsque vous utilisez Web Deploy pour effectuer des déploiements automatisés ou étape unique à un environnement cible, vous souhaiterez incorporer Ajout et suppression de la *application\_offline.htm* fichier dans votre processus de déploiement.</span><span class="sxs-lookup"><span data-stu-id="b25a6-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="b25a6-118">Pour ce faire, vous aurez besoin effectuer ces tâches de haut niveau :</span><span class="sxs-lookup"><span data-stu-id="b25a6-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="b25a6-119">Dans le fichier de projet Microsoft Build Engine (MSBuild) qui vous permet de contrôler le processus de déploiement, créez une cible MSBuild qui copie un *application\_offline.htm* fichier sur le serveur de destination avant les tâches de déploiement commencer.</span><span class="sxs-lookup"><span data-stu-id="b25a6-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="b25a6-120">Ajouter une autre cible MSBuild qui supprime le *application\_offline.htm* fichier à partir du serveur de destination lorsque toutes les tâches de déploiement sont terminées.</span><span class="sxs-lookup"><span data-stu-id="b25a6-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="b25a6-121">Dans le projet d’application web, créez un *..WPP cible* fichier qui garantit qu’un *application\_offline.htm* fichier est ajouté au package de déploiement lorsque Web Deploy est appelé.</span><span class="sxs-lookup"><span data-stu-id="b25a6-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="b25a6-122">Cette rubrique sera vous montrent comment effectuer ces procédures.</span><span class="sxs-lookup"><span data-stu-id="b25a6-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="b25a6-123">Les tâches et les procédures pas à pas dans cette rubrique supposent que vous avez déjà créé une solution qui contient au moins un projet d’application web, et que vous utilisez un fichier de projet personnalisé pour contrôler le processus de déploiement comme décrit dans [déploiement Web dans le Entreprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="b25a6-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="b25a6-124">Vous pouvez également utiliser le [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) exemple de solution pour suivre les exemples dans la rubrique.</span><span class="sxs-lookup"><span data-stu-id="b25a6-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-appoffline-file-to-a-web-application-project"></a><span data-ttu-id="b25a6-125">Ajout d’une application\_fichier hors connexion à un projet d’Application Web</span><span class="sxs-lookup"><span data-stu-id="b25a6-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="b25a6-126">La première tâche, vous devez suivre consiste à ajouter un *application\_hors connexion* fichier à votre projet d’application web :</span><span class="sxs-lookup"><span data-stu-id="b25a6-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="b25a6-127">Pour empêcher le fichier d’interférer avec le processus de développement (vous ne souhaitez que votre application soit définitivement hors connexion), vous devez l’appeler quelque chose autre que *application\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="b25a6-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="b25a6-128">Par exemple, vous pouvez nommer le fichier *application\_hors connexion template.htm*.</span><span class="sxs-lookup"><span data-stu-id="b25a6-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="b25a6-129">Pour empêcher le fichier d’être déployés en tant que-est, vous devez définir l’action de génération sur **aucun**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

**<span data-ttu-id="b25a6-130">Pour ajouter une application\_fichier hors connexion à un projet d’application web</span><span class="sxs-lookup"><span data-stu-id="b25a6-130">To add an App\_offline file to a web application project</span></span>**

1. <span data-ttu-id="b25a6-131">Ouvrez votre solution dans Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b25a6-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="b25a6-132">Dans le **l’Explorateur de solutions** fenêtre, cliquez sur votre projet d’application web, pointez sur **ajouter**, puis cliquez sur **un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="b25a6-133">Dans le **ajouter un nouvel élément** boîte de dialogue, sélectionnez **HTML Page**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="b25a6-134">Dans le **nom** , tapez **application\_hors connexion template.htm**, puis cliquez sur **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="b25a6-135">Ajouter du code HTML simple pour informer les utilisateurs que l’application n’est pas disponible, puis enregistrez le fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="b25a6-136">N’incluez pas de balises côté serveur (par exemple, toutes les balises qui sont précédés de « asp : »).</span><span class="sxs-lookup"><span data-stu-id="b25a6-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="b25a6-137">Dans le **l’Explorateur de solutions** fenêtre, cliquez sur le nouveau fichier, puis cliquez sur **propriétés**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="b25a6-138">Dans le **propriétés** fenêtre, dans le **Action de génération** ligne, sélectionnez **aucun**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-appoffline-file"></a><span data-ttu-id="b25a6-139">Déploiement et la suppression d’une application\_fichier hors connexion</span><span class="sxs-lookup"><span data-stu-id="b25a6-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="b25a6-140">L’étape suivante consiste à modifier votre logique de déploiement pour copier le fichier vers le serveur de destination au début du processus de déploiement et le supprimer à la fin.</span><span class="sxs-lookup"><span data-stu-id="b25a6-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="b25a6-141">La procédure suivante suppose que vous utilisez un fichier de projet MSBuild personnalisé pour contrôler votre processus de déploiement, comme décrit dans [présentation du fichier projet](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="b25a6-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="b25a6-142">Si vous effectuez un déploiement direct à partir de Visual Studio, vous devez utiliser une approche différente.</span><span class="sxs-lookup"><span data-stu-id="b25a6-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="b25a6-143">Sayed Ibrahim Hashimi décrit une telle approche dans [comment prendre votre application en mode hors connexion au cours de publication sur le Web](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="b25a6-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>


<span data-ttu-id="b25a6-144">Pour déployer un *application\_hors connexion* fichier vers un site Web IIS de destination, vous devez appeler à l’aide de MSDeploy.exe le [Web Deploy **contentPath** fournisseur](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="b25a6-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="b25a6-145">Le **contentPath** fournisseur prend en charge les chemins d’accès du répertoire physique et les chemins de site Web ou application IIS, ce qui rend le choix idéal pour la synchronisation d’un fichier entre un dossier de projet Visual Studio et une application web IIS.</span><span class="sxs-lookup"><span data-stu-id="b25a6-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="b25a6-146">Pour déployer le fichier, votre commande MSDeploy doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="b25a6-146">To deploy the file, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]


<span data-ttu-id="b25a6-147">Pour supprimer le fichier à partir du site de destination à la fin du processus de déploiement, votre commande MSDeploy doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="b25a6-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>


[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]


<span data-ttu-id="b25a6-148">Pour automatiser ces commandes en tant que partie d’un processus de génération et de déploiement, vous devez les intégrer dans votre fichier de projet MSBuild personnalisée.</span><span class="sxs-lookup"><span data-stu-id="b25a6-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="b25a6-149">La procédure suivante décrit comment effectuer cette opération.</span><span class="sxs-lookup"><span data-stu-id="b25a6-149">The next procedure describes how to do this.</span></span>

**<span data-ttu-id="b25a6-150">Pour déployer et supprimer une application\_fichier hors connexion</span><span class="sxs-lookup"><span data-stu-id="b25a6-150">To deploy and delete an App\_offline file</span></span>**

1. <span data-ttu-id="b25a6-151">Dans Visual Studio 2010, ouvrez le fichier projet MSBuild qui contrôle le processus de déploiement.</span><span class="sxs-lookup"><span data-stu-id="b25a6-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="b25a6-152">Dans le [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) exemple de solution, il s’agit du *Publish.proj* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="b25a6-153">Dans la racine **projet** élément, créez un **PropertyGroup** élément à stocker les variables pour le *application\_hors connexion* déploiement :</span><span class="sxs-lookup"><span data-stu-id="b25a6-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="b25a6-154">Le **SourceRoot** propriété est définie ailleurs dans le *Publish.proj* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="b25a6-155">Cette propriété indique l’emplacement du dossier racine pour le contenu source par rapport à l’emplacement actuel&#x2014;en d’autres termes, par rapport à l’emplacement de la *Publish.proj* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="b25a6-156">Le **contentPath** fournisseur n’accepte pas les chemins d’accès relatif du fichier, vous devez obtenir un chemin d’accès absolu au fichier source avant de pouvoir le déployer.</span><span class="sxs-lookup"><span data-stu-id="b25a6-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="b25a6-157">Vous pouvez utiliser la [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) tâche pour ce faire.</span><span class="sxs-lookup"><span data-stu-id="b25a6-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="b25a6-158">Ajouter un nouveau **cible** élément nommé **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="b25a6-159">Dans cette cible, utilisez le **ConvertToAbsolutePath** tâche pour obtenir un chemin d’accès absolu pour le *application\_hors connexion de modèle* fichier dans votre dossier de projet.</span><span class="sxs-lookup"><span data-stu-id="b25a6-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="b25a6-160">Cette cible prend le chemin d’accès relatif à la *application\_hors connexion de modèle* fichier dans votre dossier de projet et l’enregistre dans une nouvelle propriété comme un chemin d’accès absolu du fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="b25a6-161">Le **BeforeTargets** attribut spécifie que vous souhaitez que cette cible à exécuter avant le **DeployAppOffline** cible, que vous allez créer à l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="b25a6-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="b25a6-162">Ajouter une nouvelle cible nommée **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="b25a6-163">Dans cette cible, appeler la commande MSDeploy.exe qui déploie votre *application\_hors connexion* fichier sur le serveur web de destination.</span><span class="sxs-lookup"><span data-stu-id="b25a6-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="b25a6-164">Dans cet exemple, le **ContactManagerIisPath** propriété est définie ailleurs dans le fichier projet.</span><span class="sxs-lookup"><span data-stu-id="b25a6-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="b25a6-165">Il s’agit simplement un chemin d’application IIS, sous la forme *[nom du site Web IIS] / [nom de l’Application]*.</span><span class="sxs-lookup"><span data-stu-id="b25a6-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="b25a6-166">Y compris une condition dans la cible permet aux utilisateurs de basculer le *application\_hors connexion* déploiement ou désactiver en modifiant une valeur de propriété ou en fournissant un paramètre de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="b25a6-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="b25a6-167">Ajouter une nouvelle cible nommée **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="b25a6-168">Dans cette cible, appeler la commande MSDeploy.exe qui supprime votre *application\_hors connexion* fichier à partir du serveur web de destination.</span><span class="sxs-lookup"><span data-stu-id="b25a6-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="b25a6-169">La dernière tâche consiste à appeler ces nouvelles cibles aux endroits appropriés lors de l’exécution de votre fichier projet.</span><span class="sxs-lookup"><span data-stu-id="b25a6-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="b25a6-170">Pour cela, de différentes manières.</span><span class="sxs-lookup"><span data-stu-id="b25a6-170">You can do this in various ways.</span></span> <span data-ttu-id="b25a6-171">Par exemple, dans le *Publish.proj* fichier, le **FullPublishDependsOn** propriété spécifie une liste de cibles qui doivent être exécutées en ordre lorsque la **FullPublish** par défaut la cible est appelée.</span><span class="sxs-lookup"><span data-stu-id="b25a6-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="b25a6-172">Modifiez votre fichier de projet MSBuild pour appeler le **DeployAppOffline** et **DeleteAppOffline** cibles aux endroits appropriés dans le processus de publication.</span><span class="sxs-lookup"><span data-stu-id="b25a6-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="b25a6-173">Lorsque vous exécutez votre fichier projet MSBuild personnalisé, le *application\_hors connexion* fichier sera déployé sur le serveur immédiatement après une génération réussie.</span><span class="sxs-lookup"><span data-stu-id="b25a6-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="b25a6-174">Il sera supprimé à partir du serveur puis une fois que toutes les tâches de déploiement sont terminées.</span><span class="sxs-lookup"><span data-stu-id="b25a6-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-appoffline-file-to-deployment-packages"></a><span data-ttu-id="b25a6-175">Ajout d’une application\_fichier hors connexion aux Packages de déploiement</span><span class="sxs-lookup"><span data-stu-id="b25a6-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="b25a6-176">Selon la façon dont vous configurez votre déploiement, les contenus existants à la destination IIS application web&#x2014;comme le *application\_offline.htm* fichier&#x2014;peuvent être supprimées automatiquement lorsque vous déployez un site web package à la destination.</span><span class="sxs-lookup"><span data-stu-id="b25a6-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="b25a6-177">Pour vous assurer que le *application\_offline.htm* fichier reste en place pour la durée du déploiement, vous devez inclure le fichier dans le package de déploiement web lui-même en outre à déployer le fichier directement au début de le processus de déploiement.</span><span class="sxs-lookup"><span data-stu-id="b25a6-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="b25a6-178">Si vous avez suivi les tâches précédentes dans cette rubrique, vous aurez ajouté le *application\_offline.htm* fichier à votre projet d’application web sous un nom de fichier différent (nous avons utilisé *application\_ en mode hors connexion template.htm*) et vous devez définir l’action de génération **aucun**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="b25a6-179">Ces modifications sont nécessaires pour éviter que le fichier à partir d’interférer avec le développement et le débogage.</span><span class="sxs-lookup"><span data-stu-id="b25a6-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="b25a6-180">Par conséquent, vous devez personnaliser le processus d’empaquetage pour vous assurer que le *application\_offline.htm* fichier est inclus dans le package de déploiement web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="b25a6-181">Web Publishing Pipeline (WPP) utilise une liste d’éléments nommée **FilesForPackagingFromProject** pour générer une liste de fichiers qui doivent être inclus dans le package de déploiement web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="b25a6-182">Vous pouvez personnaliser le contenu de vos packages web en ajoutant vos propres éléments à cette liste.</span><span class="sxs-lookup"><span data-stu-id="b25a6-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="b25a6-183">Pour ce faire, vous devez suivre ces étapes générales :</span><span class="sxs-lookup"><span data-stu-id="b25a6-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="b25a6-184">Créez un fichier de projet personnalisé nommé *[nom_projet].wpp.targets* dans le même dossier que votre fichier projet.</span><span class="sxs-lookup"><span data-stu-id="b25a6-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b25a6-185">Le *..WPP cible* fichier doit aller dans le même dossier que votre fichier de projet d’application web&#x2014;par exemple, *ContactManager.Mvc.csproj*&#x2014;plutôt que dans le même dossier que n’importe quel personnalisé fichiers de projet que vous utilisez pour contrôler le processus de génération et de déploiement.</span><span class="sxs-lookup"><span data-stu-id="b25a6-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="b25a6-186">Dans le *..WPP cible* de fichiers, créez une nouvelle cible MSBuild qui exécute *avant* le **CopyAllFilesToSingleFolderForPackage** cible.</span><span class="sxs-lookup"><span data-stu-id="b25a6-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="b25a6-187">Il s’agit de la cible WPP qui génère la liste des éléments à inclure dans le package.</span><span class="sxs-lookup"><span data-stu-id="b25a6-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="b25a6-188">Dans la nouvelle cible, créez un **ItemGroup** élément.</span><span class="sxs-lookup"><span data-stu-id="b25a6-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="b25a6-189">Dans le **ItemGroup** élément, ajoutez un **FilesForPackagingFromProject** d’élément et spécifiez le *application\_offline.htm* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="b25a6-190">Le *..WPP cible* fichier doit ressembler à ceci :</span><span class="sxs-lookup"><span data-stu-id="b25a6-190">The *.wpp.targets* file should resemble this:</span></span>


[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]


<span data-ttu-id="b25a6-191">Voici les points clés de la Remarque Dans cet exemple :</span><span class="sxs-lookup"><span data-stu-id="b25a6-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="b25a6-192">Le **BeforeTargets** d’insertions d’attribut dans les fournisseurs de services en spécifiant cette cible qui il doit être exécuté immédiatement avant le **CopyAllFilesToSingleFolderForPackage** cible.</span><span class="sxs-lookup"><span data-stu-id="b25a6-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="b25a6-193">Le **FilesForPackagingFromProject** élément utilise le **DestinationRelativePath** valeur des métadonnées pour renommer le fichier à partir de *application\_hors connexion template.htm* pour *application\_offline.htm* car il est ajouté à la liste.</span><span class="sxs-lookup"><span data-stu-id="b25a6-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="b25a6-194">La procédure suivante vous montre comment ajouter cela *..WPP cible* fichier à un projet d’application web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

**<span data-ttu-id="b25a6-195">Pour ajouter un. fichier.WPP cible à un package de déploiement web</span><span class="sxs-lookup"><span data-stu-id="b25a6-195">To add a .wpp.targets file to a web deployment package</span></span>**

1. <span data-ttu-id="b25a6-196">Ouvrez votre solution dans Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="b25a6-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="b25a6-197">Dans le **l’Explorateur de solutions** fenêtre, avec le bouton droit de votre nœud de projet d’application web (par exemple, **ContactManager.Mvc**), pointez sur **ajouter**, puis cliquez sur **Un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="b25a6-198">Dans le **ajouter un nouvel élément** boîte de dialogue, sélectionnez le **fichier XML** modèle.</span><span class="sxs-lookup"><span data-stu-id="b25a6-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="b25a6-199">Dans le **nom** , tapez \*[nom_projet] \***.wpp.targets** (par exemple, **ContactManager.Mvc.wpp.targets**), puis cliquez sur **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="b25a6-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="b25a6-200">Si vous ajoutez un nouvel élément vers le nœud racine d’un projet, le fichier est créé dans le même dossier que le fichier projet.</span><span class="sxs-lookup"><span data-stu-id="b25a6-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="b25a6-201">Vous pouvez le vérifier en ouvrant le dossier dans l’Explorateur Windows.</span><span class="sxs-lookup"><span data-stu-id="b25a6-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="b25a6-202">Dans le fichier, ajoutez le balisage de MSBuild décrit précédemment.</span><span class="sxs-lookup"><span data-stu-id="b25a6-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="b25a6-203">Enregistrez et fermez le *[nom_projet].wpp.targets* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="b25a6-204">La prochaine génération et package de votre projet d’application web, les fournisseurs de services détecte automatiquement le *..WPP cible* fichier.</span><span class="sxs-lookup"><span data-stu-id="b25a6-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="b25a6-205">Le *application\_hors connexion template.htm* fichier figureront dans le package de déploiement web qui en résulte que *application\_offline.htm*.</span><span class="sxs-lookup"><span data-stu-id="b25a6-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="b25a6-206">Si votre déploiement échoue, le *application\_offline.htm* fichier restent en place et de votre application reste hors connexion.</span><span class="sxs-lookup"><span data-stu-id="b25a6-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="b25a6-207">C’est généralement le comportement souhaité.</span><span class="sxs-lookup"><span data-stu-id="b25a6-207">This is typically the desired behavior.</span></span> <span data-ttu-id="b25a6-208">Pour remettre votre application en ligne, vous pouvez supprimer le *application\_offline.htm* fichier à partir de votre serveur web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="b25a6-209">Vous pouvez également, si vous corrigez les erreurs éventuelles et que vous exécutez un déploiement réussi, le *application\_offline.htm* fichier sera supprimé.</span><span class="sxs-lookup"><span data-stu-id="b25a6-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>


## <a name="conclusion"></a><span data-ttu-id="b25a6-210">Conclusion</span><span class="sxs-lookup"><span data-stu-id="b25a6-210">Conclusion</span></span>

<span data-ttu-id="b25a6-211">Cette rubrique décrit comment prendre une application web en mode hors connexion pendant la durée d’un déploiement, en publiant un *application\_offline.htm* de fichiers sur le serveur de destination au début du processus de déploiement et la suppression à la fin.</span><span class="sxs-lookup"><span data-stu-id="b25a6-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="b25a6-212">Vous avez également vu comment inclure un *application\_offline.htm* fichier dans un package de déploiement web.</span><span class="sxs-lookup"><span data-stu-id="b25a6-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="b25a6-213">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="b25a6-213">Further Reading</span></span>

<span data-ttu-id="b25a6-214">Pour plus d’informations sur l’empaquetage et le processus de déploiement, consultez [génération et empaquetage Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [configuration des paramètres pour le déploiement du Package Web](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), et [ Déploiement de Packages Web](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="b25a6-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="b25a6-215">Si vous publiez vos applications web directement à partir de Visual Studio, plutôt que d’à l’aide de l’approche de fichier de projet MSBuild personnalisée décrite dans ces didacticiels, vous devez utiliser une approche légèrement différente pour mettre votre application hors ligne pendant la publication processus.</span><span class="sxs-lookup"><span data-stu-id="b25a6-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span> <span data-ttu-id="b25a6-216">Pour plus d’informations, consultez [comment faire passer votre application web en mode hors connexion lors de la publication](https://go.microsoft.com/?linkid=9805135) (billet de blog).</span><span class="sxs-lookup"><span data-stu-id="b25a6-216">For more information, see [How to take your web app offline during publishing](https://go.microsoft.com/?linkid=9805135) (blog post).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b25a6-217">[Précédent](excluding-files-and-folders-from-deployment.md)
> [Suivant](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="b25a6-217">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
