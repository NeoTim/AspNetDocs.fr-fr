---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
title: Pagination efficace dans de grandes quantités de données (VB) | Microsoft Docs
author: rick-anderson
description: Ne convient pas l’option de la pagination par défaut d’un contrôle de présentation des données lorsque vous travaillez avec grandes quantités de données, comme son retriev de contrôle de source données sous-jacent...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 3e20e64a-8808-4b49-88d6-014e2629d56f
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-vb
msc.type: authoredcontent
ms.openlocfilehash: dd1fd089bc4faa18fb2e8112b2820788c1f25ceb
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65130962"
---
# <a name="efficiently-paging-through-large-amounts-of-data-vb"></a><span data-ttu-id="e1ffd-103">Pagination efficace dans de grandes quantités de données (VB)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-103">Efficiently Paging Through Large Amounts of Data (VB)</span></span>

<span data-ttu-id="e1ffd-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e1ffd-105">[Télécharger l’exemple d’application](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) ou [télécharger le PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_VB.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-vb/_static/datatutorial25vb1.pdf)</span></span>

> <span data-ttu-id="e1ffd-106">L’option de la pagination par défaut d’un contrôle de présentation de données ne convient pas lorsque vous travaillez avec grandes quantités de données, comme son contrôle de source de données sous-jacente récupère tous les enregistrements, même si seul un sous-ensemble de données est affiché.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="e1ffd-107">Dans de telles circonstances, nous devons activer personnalisés à la pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-107">In such circumstances, we must turn to custom paging.</span></span>

## <a name="introduction"></a><span data-ttu-id="e1ffd-108">Introduction</span><span class="sxs-lookup"><span data-stu-id="e1ffd-108">Introduction</span></span>

<span data-ttu-id="e1ffd-109">Comme expliqué dans le didacticiel précédent, la pagination peut être implémentée de deux manières :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="e1ffd-110">**La pagination par défaut** peut être implémentée en activant simplement l’option Activer la pagination dans les données de contrôle Web s des balises actives ; Toutefois, chaque fois que l’affichage d’une page de données, ObjectDataSource récupère *tous les* des enregistrements, y compris Bien qu’uniquement un sous-ensemble d'entre eux sont affichés dans la page</span><span class="sxs-lookup"><span data-stu-id="e1ffd-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="e1ffd-111">**La pagination personnalisée** améliore les performances de valeur par défaut la pagination en récupérant uniquement les enregistrements à partir de la base de données qui doivent être affichés pour la page de données demandée par l’utilisateur ; Toutefois, la pagination personnalisée implique un peu plus d’efforts à mettre en œuvre à la pagination par défaut</span><span class="sxs-lookup"><span data-stu-id="e1ffd-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="e1ffd-112">En raison de la facilité de vérification de mise en œuvre simplement une case à cocher et que vous re terminé !</span><span class="sxs-lookup"><span data-stu-id="e1ffd-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="e1ffd-113">la pagination par défaut est une option intéressante.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-113">default paging is an attractive option.</span></span> <span data-ttu-id="e1ffd-114">Son approche de ve na lors de la récupération de tous les enregistrements, cependant, rend un choix possible lors de la pagination via suffisamment grandes quantités de données ou pour les sites comportant de nombreux utilisateurs simultanés.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="e1ffd-115">Dans de telles circonstances, nous devons activer la pagination afin de fournir un système réactif personnalisées.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="e1ffd-116">Le défi de la pagination personnalisée est la possibilité d’écrire une requête qui retourne l’ensemble précis des enregistrements nécessaires pour une page particulière de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="e1ffd-117">Heureusement, Microsoft SQL Server 2005 fournit un nouveau mot clé pour le classement des résultats, ce qui nous permet d’écrire une requête qui peut récupérer efficacement le sous-ensemble d’enregistrements approprié.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="e1ffd-118">Dans ce didacticiel, nous allons voir comment utiliser ce nouveau mot clé de SQL Server 2005 pour implémenter la pagination personnalisée dans un contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="e1ffd-119">Alors que l’interface utilisateur pour la pagination personnalisée est identique à celui de la pagination par défaut, pas à pas d’une page à la suivante à l’aide la pagination personnalisée peut être plus rapide que la pagination par défaut plusieurs ordres de grandeur.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="e1ffd-120">Le gain de performances exact exposé par la pagination personnalisée varie selon le nombre total d’enregistrements en cours de pagination via et de la charge qui est placée sur le serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="e1ffd-121">À la fin de ce didacticiel, nous allons examiner certaines mesures approximative qui mettent en évidence les avantages de performances obtenues via la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>

## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="e1ffd-122">Étape 1 : Présentation du processus de la pagination personnalisée</span><span class="sxs-lookup"><span data-stu-id="e1ffd-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="e1ffd-123">Lors de la pagination des données, les enregistrements précis affichés dans une page dépendent de la page de données demandées et le nombre d’enregistrements affichés par page.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="e1ffd-124">Par exemple, imaginez que nous souhaitons parcourir les 81 produits, affichant les 10 produits par page.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="e1ffd-125">Lorsque vous affichez la première page, d voulons-nous produits 1 à 10 ; lors de l’affichage de la deuxième page d nous intéresser 11 20 par le biais de produits et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="e1ffd-126">Il existe trois variables qui déterminent ce que les enregistrements doivent être récupérées et mode de rendu de l’interface de pagination :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="e1ffd-127">**Index de ligne de début** l’index de la première ligne dans la page de données à afficher ; peut être calculée en multipliant l’index de page par les enregistrements à afficher par page et ajout d’un index.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="e1ffd-128">Par exemple, lorsque la pagination des enregistrements 10 à la fois, pour la première page (dont l’index de page est 0), l’Index de ligne de début est 0 \* 10 + 1 ou 1 ; pour la deuxième page (dont l’index de page est 1), l’Index de ligne de début est 1 \* 10 + 1 , ou 11.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="e1ffd-129">**Nombre maximal de lignes** le nombre maximal d’enregistrements à afficher par page.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="e1ffd-130">Cette variable est appelée nombre maximal de lignes dans la mesure où de la dernière page il peut être moins d’enregistrements retournés à la taille de page.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="e1ffd-131">Par exemple, lors de la pagination via les enregistrements de 81 produits 10 par page, la neuvième et dernière page aura qu’un seul enregistrement.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="e1ffd-132">Cependant, aucune page, n’affiche plus d’enregistrements que la valeur du nombre maximal de lignes.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="e1ffd-133">**Nombre total d’enregistrements** le nombre total d’enregistrements en cours de pagination via.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="e1ffd-134">Bien que cet t de la variable n’est nécessaire pour déterminer les enregistrements à récupérer pour une page donnée, il impose l’interface de pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="e1ffd-135">Par exemple, s’il existe des 81 produits averti par radiomessagerie via, l’interface de pagination sait pour afficher les numéros de page neuf dans l’interface utilisateur de pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="e1ffd-136">Avec la pagination par défaut, l’Index de ligne de début est calculée en tant que le produit de l’index de page et la taille de page plus un, tandis que le nombre maximal de lignes est simplement la taille de page.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="e1ffd-137">Dans la mesure où la pagination par défaut récupère tous les enregistrements à partir de la base de données lors du rendu de n’importe quelle page de données, l’index pour chaque ligne est connu, rendant ainsi déplacement à la ligne d’Index de ligne de démarrer une tâche aisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="e1ffd-138">En outre, le nombre Total d’enregistrements est prête, tel qu’il s simplement le nombre d’enregistrements dans la table de données (ou tout objet est utilisé pour stocker les résultats de la base de données).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="e1ffd-139">Étant donné les variables de l’Index de ligne de début et le nombre maximal de lignes, une implémentation de la pagination personnalisée doit retourner uniquement le sous-ensemble précis d’enregistrements en commençant à l’Index de ligne de début et de nombre de lignes maximal d’enregistrements après cela.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="e1ffd-140">La pagination personnalisée fournit deux défis :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="e1ffd-141">Nous devons être en mesure d’associer efficacement un index de ligne avec chaque ligne dans l’ensemble des données en cours de pagination via afin que nous pouvons commencer à retourner des enregistrements à l’Index de ligne de début spécifié</span><span class="sxs-lookup"><span data-stu-id="e1ffd-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="e1ffd-142">Nous devons fournir le nombre total d’enregistrements en cours de pagination via</span><span class="sxs-lookup"><span data-stu-id="e1ffd-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="e1ffd-143">Dans les deux étapes suivantes, nous allons examiner le script SQL nécessaire pour répondre à ces deux défis.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="e1ffd-144">Outre le script SQL, nous devez également implémenter des méthodes dans la couche DAL et la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="e1ffd-145">Étape 2 : Renvoi du nombre Total d’enregistrements en cours de pagination via</span><span class="sxs-lookup"><span data-stu-id="e1ffd-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="e1ffd-146">Avant d’examiner comment récupérer le sous-ensemble précis d’enregistrements pour la page s’affiche, permettent de s commencer par examiner comment retourner le nombre total d’enregistrements en cours de pagination via.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="e1ffd-147">Ces informations sont nécessaires pour configurer correctement l’interface utilisateur de pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="e1ffd-148">Le nombre total d’enregistrements renvoyés par une requête SQL spécifique peut être obtenu à l’aide de la [ `COUNT` fonction d’agrégation](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="e1ffd-149">Par exemple, pour déterminer le nombre total d’enregistrements dans la `Products` table, nous pouvons utiliser la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample1.sql)]

<span data-ttu-id="e1ffd-150">Permettent d’ajouter une méthode à notre DAL qui retourne cette information s.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="e1ffd-151">En particulier, nous allons créer une méthode de la couche DAL appelée `TotalNumberOfProducts()` qui exécute la `SELECT` instruction ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="e1ffd-152">Commencez par ouvrir le `Northwind.xsd` fichier DataSet typée dans la `App_Code/DAL` dossier.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="e1ffd-153">Ensuite, avec le bouton droit sur le `ProductsTableAdapter` dans le concepteur et choisissez Ajouter une requête.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="e1ffd-154">Comme nous ve vu dans les didacticiels précédents, cela nous permettra d’ajouter une nouvelle méthode à la couche DAL qui, lorsqu’elle est appelée, exécute une procédure stockée ou une instruction SQL donnée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="e1ffd-155">Comme avec nos méthodes TableAdapter dans les didacticiels précédents, pour celle-ci opter pour utiliser une instruction SQL d’ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>

![Utilisez une instruction SQL de Ad-Hoc](efficiently-paging-through-large-amounts-of-data-vb/_static/image1.png)

<span data-ttu-id="e1ffd-157">**Figure 1**: Utilisez une instruction SQL de Ad-Hoc</span><span class="sxs-lookup"><span data-stu-id="e1ffd-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>

<span data-ttu-id="e1ffd-158">Dans l’écran suivant, nous pouvons spécifier quel type de requête à créer.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="e1ffd-159">Étant donné que cette requête retourne une valeur scalaire unique le nombre total d’enregistrements dans le `Products` tableau choisir le `SELECT` qui retourne une option de valeur unique.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>

![Configurer la requête pour utiliser une instruction SELECT qui retourne une valeur unique](efficiently-paging-through-large-amounts-of-data-vb/_static/image2.png)

<span data-ttu-id="e1ffd-161">**Figure 2**: Configurer la requête pour utiliser une instruction SELECT qui retourne une valeur unique</span><span class="sxs-lookup"><span data-stu-id="e1ffd-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>

<span data-ttu-id="e1ffd-162">Après avoir indiquant le type de requête à utiliser, nous devons ensuite spécifier la requête.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-162">After indicating the type of query to use, we must next specify the query.</span></span>

![Utiliser le SELECT count à partir de la requête de produits](efficiently-paging-through-large-amounts-of-data-vb/_static/image3.png)

<span data-ttu-id="e1ffd-164">**Figure 3**: Utiliser le SELECT COUNT (\*) FROM produits requête</span><span class="sxs-lookup"><span data-stu-id="e1ffd-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>

<span data-ttu-id="e1ffd-165">Enfin, spécifiez le nom de la méthode.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="e1ffd-166">Comme mentionné ci-dessus, vous permettent de s utiliser `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>

![Nom de la méthode de la couche DAL TotalNumberOfProducts](efficiently-paging-through-large-amounts-of-data-vb/_static/image4.png)

<span data-ttu-id="e1ffd-168">**Figure 4**: Nom de la méthode de la couche DAL TotalNumberOfProducts</span><span class="sxs-lookup"><span data-stu-id="e1ffd-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>

<span data-ttu-id="e1ffd-169">Après avoir cliqué sur Terminer, l’Assistant ajoutera les `TotalNumberOfProducts` méthode à la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="e1ffd-170">Les méthodes de retour scalaires dans la couche DAL retournent des types nullable, au cas où le résultat de la requête SQL est `NULL`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="e1ffd-171">Notre `COUNT` requête, cependant, retourne toujours une non -`NULL` valeur ; tous les cas, la méthode de la couche DAL retourne un entier nullable.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="e1ffd-172">Outre la méthode de la couche DAL, nous avons également besoin d’une méthode dans la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="e1ffd-173">Ouvrir le `ProductsBLL` fichier de classe et ajoutez un `TotalNumberOfProducts` méthode qui appelle simplement vers le bas de la couche DAL s `TotalNumberOfProducts` méthode :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>

[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample2.vb)]

<span data-ttu-id="e1ffd-174">La couche DAL s `TotalNumberOfProducts` méthode retourne un entier nullable ; Toutefois, nous ve créé le `ProductsBLL` classe s `TotalNumberOfProducts` méthode pour qu’elle retourne un entier standard.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="e1ffd-175">Par conséquent, nous devons disposer le `ProductsBLL` classe s `TotalNumberOfProducts` méthode retourner la partie de la valeur de l’entier nullable retourné par la couche DAL s `TotalNumberOfProducts` (méthode).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="e1ffd-176">L’appel à `GetValueOrDefault()` retourne la valeur de l’entier nullable, si elle existe ; si l’entier nullable est `null`, toutefois, elle retourne la valeur d’entier par défaut, 0.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="e1ffd-177">Étape 3 : Retourner le sous-ensemble précis d’enregistrements</span><span class="sxs-lookup"><span data-stu-id="e1ffd-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="e1ffd-178">Notre tâche suivante consiste à créer des méthodes dans la couche DAL et la couche BLL qui acceptent l’Index de ligne de démarrage et les variables de nombre maximal de lignes décrits précédemment et retournent les enregistrements appropriés.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="e1ffd-179">Avant cela, nous permettent de s par examiner le script SQL nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="e1ffd-180">Le défi nous est que nous devons être en mesure d’assigner efficacement un index pour chaque ligne dans les résultats complets averti par radiomessagerie via afin que nous pouvons renvoyer uniquement les enregistrements commençant à l’Index de ligne de démarrer (et jusqu’au nombre d’enregistrements maximal d’enregistrements).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="e1ffd-181">Cela n’est pas un véritable défi s’il existe déjà une colonne dans la table de base de données qui sert d’un index de ligne.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="e1ffd-182">À première vue nous pourrions penser que le `Products` table s `ProductID` champ suffirait, comme le premier produit a `ProductID` 1, le second est un 2, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="e1ffd-183">Toutefois, la suppression d’un produit laisse une discontinuité dans la séquence, en annulant cette approche.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="e1ffd-184">Il existe deux techniques générales utilisées pour associer efficacement un index de ligne avec les données pour parcourir, permettant ainsi le sous-ensemble précis d’enregistrements à récupérer :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="e1ffd-185">**À l’aide de SQL Server 2005 s `ROW_NUMBER()` mot clé** nouveau vers SQL Server 2005, le `ROW_NUMBER()` mot clé associe un classement de chaque enregistrement renvoyé en fonction de classement.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="e1ffd-186">Ce classement peut être utilisé comme un index de ligne pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="e1ffd-187">**À l’aide d’une Variable de Table et `SET ROWCOUNT`**  s de SQL Server [ `SET ROWCOUNT` instruction](https://msdn.microsoft.com/library/ms188774.aspx) peut être utilisé pour spécifier le nombre total d’enregistrements une requête doit traiter avant de s’arrêter ; [variables de table](http://www.sqlteam.com/item.asp?ItemID=9454) sont des variables locales T-SQL pouvant contenir des données tabulaires, akin [tables temporaires](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="e1ffd-188">Cette approche fonctionne aussi bien avec Microsoft SQL Server 2005 et SQL Server 2000 (alors que le `ROW_NUMBER()` approche fonctionne uniquement avec SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="e1ffd-189">L’idée consiste à créer une variable de table qui a un `IDENTITY` et colonnes pour les clés primaires de la table dont les données sont paginées par le biais.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="e1ffd-190">Ensuite, le contenu de la table dont les données sont paginées via sont vidées dans la variable de table, association d’un index de ligne séquentiel ainsi (via la `IDENTITY` colonne) pour chaque enregistrement dans la table.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="e1ffd-191">Une fois que la variable de table a été remplie, un `SELECT` instruction sur la variable de table, jointe à la table sous-jacente, peut être exécuté pour extraire les enregistrements particuliers.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="e1ffd-192">La `SET ROWCOUNT` instruction sert à intelligemment limiter le nombre d’enregistrements qui doivent être vidées dans la variable de table.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="e1ffd-193">Cette efficacité approche s est basée sur le numéro de page demandé, comme le `SET ROWCOUNT` valeur est assignée à la valeur d’Index de ligne de début ainsi que le nombre maximal de lignes.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="e1ffd-194">Lorsque la pagination des pages de bas niveau telles que la première de plusieurs pages de données, cette approche est très efficace.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="e1ffd-195">Toutefois, il présente des performances similaires à la pagination par défaut lors de la récupération d’une page vers la fin.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="e1ffd-196">Ce didacticiel met en œuvre à l’aide de la pagination personnalisée la `ROW_NUMBER()` mot clé.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="e1ffd-197">Pour plus d’informations sur l’utilisation de la variable de table et `SET ROWCOUNT` technique, consultez [A plus optimisent la pagination par le biais de grands jeux de résultats](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="e1ffd-198">Le `ROW_NUMBER()` mot clé associé à un classement chaque enregistrement retourné sur un classement spécifique à l’aide de la syntaxe suivante :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample3.sql)]

<span data-ttu-id="e1ffd-199">`ROW_NUMBER()` Retourne une valeur numérique qui spécifie le classement pour chaque enregistrement en ce qui concerne l’ordre indiqué.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="e1ffd-200">Par exemple, pour voir le rang de chaque produit, classé du plus coûteux pour le moins, nous pourrions utiliser la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample4.sql)]

<span data-ttu-id="e1ffd-201">La figure 5 illustre cette requête résultats s lors de l’exécution via la fenêtre de requête dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="e1ffd-202">Notez que les produits sont classés par prix, ainsi que d’un rang de prix pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>

![Le rang de prix est inclus pour chaque enregistrement retourné](efficiently-paging-through-large-amounts-of-data-vb/_static/image5.png)

<span data-ttu-id="e1ffd-204">**Figure 5**: Le rang de prix est inclus pour chaque enregistrement retourné</span><span class="sxs-lookup"><span data-stu-id="e1ffd-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>

> [!NOTE]
> <span data-ttu-id="e1ffd-205">`ROW_NUMBER()` un seul des nombreuses nouvelles fonctions de classement n’est pas disponible dans SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="e1ffd-206">Pour une discussion plus approfondie de `ROW_NUMBER()`, ainsi que les autres fonctions de classement, lire [retour de résultats classés avec Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>

<span data-ttu-id="e1ffd-207">Lorsque les résultats de classement par spécifié `ORDER BY` colonne dans le `OVER` clause (`UnitPrice`, dans l’exemple ci-dessus), SQL Server doit trier les résultats.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="e1ffd-208">Ceci est une opération rapide s’il y a un index cluster sur l’ou les colonnes les résultats sont classées par, ou s’il existe une couverture d’index, mais peut être plus coûteux dans le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="e1ffd-209">Pour aider à améliorer les performances des requêtes suffisamment volumineuses, envisagez d’ajouter un index non cluster pour la colonne selon laquelle les résultats sont triés par.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="e1ffd-210">Consultez [fonctions de classement et de performances dans SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) pour examiner les considérations de performances plus détaillée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="e1ffd-211">Les informations de classement retournées par `ROW_NUMBER()` ne peut pas être utilisé directement dans le `WHERE` clause.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="e1ffd-212">Toutefois, une table dérivée peut être utilisée pour retourner le `ROW_NUMBER()` résultat, qui peut ensuite apparaître dans le `WHERE` clause.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="e1ffd-213">Par exemple, la requête suivante utilise une table dérivée pour retourner les colonnes ProductName et UnitPrice, ainsi que la `ROW_NUMBER()` résultat, puis utilise un `WHERE` clause afin de retourner uniquement les produits dont le rang prix est compris entre 11 et 20 :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample5.sql)]

<span data-ttu-id="e1ffd-214">Étendre ce concept un peu plus tard, que nous pouvons utiliser cette approche pour récupérer une page spécifique de données selon les valeurs d’Index de ligne de début et le nombre maximal de lignes souhaités :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>

[!code-html[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="e1ffd-215">Comme nous verrons plus loin dans ce didacticiel, le *`StartRowIndex`* fourni par ObjectDataSource est indexé à partir de zéro, tandis que le `ROW_NUMBER()` valeur retournée par SQL Server 2005 est indexée en commençant à 1.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="e1ffd-216">Par conséquent, le `WHERE` clause retourne les enregistrements où `PriceRank` est strictement supérieur à *`StartRowIndex`* et inférieure ou égale à *`StartRowIndex`*  +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>

<span data-ttu-id="e1ffd-217">Maintenant que nous avons ve abordé comment `ROW_NUMBER()` peut être utilisée pour récupérer une page particulière de données selon les valeurs d’Index de ligne de début et le nombre maximal de lignes, nous devons maintenant implémenter cette logique en tant que méthodes dans la couche DAL et la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="e1ffd-218">Lors de la création de cette requête, que nous devons déterminer l’ordre selon lequel les résultats sont classés ; permettent de trier les produits par leur nom dans l’ordre alphabétique s.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="e1ffd-219">Cela signifie qu’avec l’implémentation de la pagination personnalisée dans ce didacticiel, nous ne pourrez pas créer un rapport paginé personnalisé que peuvent également être triées.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="e1ffd-220">Cependant, dans le didacticiel suivant, nous allons voir comment cette fonctionnalité peut être fournie.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="e1ffd-221">Dans la section précédente, nous avons créé la méthode de la couche DAL comme instruction SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="e1ffd-222">Malheureusement, l’analyseur T-SQL dans Visual Studio utilisé par le TableAdapter Assistant n t comme le `OVER` syntaxe utilisée par le `ROW_NUMBER()` (fonction).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="e1ffd-223">Par conséquent, nous devons créer cette méthode de la couche DAL comme une procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="e1ffd-224">Sélectionnez l’Explorateur de serveurs à partir du menu Affichage (ou appuyez sur Ctrl + Alt + S) et développez le `NORTHWND.MDF` nœud.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="e1ffd-225">Pour ajouter une nouvelle procédure stockée, avec le bouton droit sur le nœud procédures stockées et choisissez Ajouter une nouvelle procédure stockée (voir Figure 6).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>

![Ajouter une nouvelle procédure stockée pour la pagination via les produits](efficiently-paging-through-large-amounts-of-data-vb/_static/image6.png)

<span data-ttu-id="e1ffd-227">**Figure 6**: Ajouter une nouvelle procédure stockée pour la pagination via les produits</span><span class="sxs-lookup"><span data-stu-id="e1ffd-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>

<span data-ttu-id="e1ffd-228">Cette procédure stockée doit accepter deux paramètres d’entrée de type entier - `@startRowIndex` et `@maximumRows` et utiliser le `ROW_NUMBER()` fonction classés par le `ProductName` champ, retour uniquement les lignes supérieures à spécifié `@startRowIndex` et inférieur à ou égal à `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="e1ffd-229">Entrez le script suivant dans la nouvelle procédure stockée, puis sur l’icône Enregistrer pour ajouter la procédure stockée à la base de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>

[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample7.sql)]

<span data-ttu-id="e1ffd-230">Après avoir créé la procédure stockée, prenez un moment pour faire des tests. Avec le bouton droit sur le `GetProductsPaged` procédure stockée nom dans l’Explorateur de serveurs et choisissez l’option d’exécution.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="e1ffd-231">Visual Studio vous invitera ensuite les paramètres d’entrée, `@startRowIndex` et `@maximumRow` s (voir la Figure 7).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="e1ffd-232">Essayer différentes valeurs et examiner les résultats.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-232">Try different values and examine the results.</span></span>

![Entrez une valeur pour le @startRowIndex et @maximumRows paramètres](efficiently-paging-through-large-amounts-of-data-vb/_static/image7.png)

<span data-ttu-id="e1ffd-234"><strong>Figure 7</strong>: Entrez une valeur pour le @startRowIndex et @maximumRows paramètres</span><span class="sxs-lookup"><span data-stu-id="e1ffd-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>

<span data-ttu-id="e1ffd-235">Une fois ces choix des valeurs de paramètres d’entrée, la fenêtre Sortie affiche les résultats.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="e1ffd-236">La figure 8 illustre les résultats lors du passage de 10 à la fois pour le `@startRowIndex` et `@maximumRows` paramètres.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>

<span data-ttu-id="e1ffd-237">[![Les enregistrements que s’affiche dans la deuxième Page de données sont retournées.](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-vb/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image8.png)</span></span>

<span data-ttu-id="e1ffd-238">**Figure 8**: Les enregistrements que s’affiche dans la deuxième Page de données sont retournés ([cliquez pour afficher l’image en taille réelle](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="e1ffd-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image10.png))</span></span>

<span data-ttu-id="e1ffd-239">Avec cette procédure stockée créée, nous vous êtes prêt à créer le `ProductsTableAdapter` (méthode).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="e1ffd-240">Ouvrez le `Northwind.xsd` DataSet typée, avec le bouton droit dans le `ProductsTableAdapter`, puis choisissez l’option Ajouter une requête.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="e1ffd-241">Au lieu de créer la requête à l’aide d’une instruction SQL ad hoc, créez-le à l’aide d’une procédure stockée existante.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>

![Créer la méthode de la couche DAL à l’aide d’une procédure stockée existante](efficiently-paging-through-large-amounts-of-data-vb/_static/image11.png)

<span data-ttu-id="e1ffd-243">**Figure 9**: Créer la méthode de la couche DAL à l’aide d’une procédure stockée existante</span><span class="sxs-lookup"><span data-stu-id="e1ffd-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>

<span data-ttu-id="e1ffd-244">Ensuite, nous sommes invités à sélectionner la procédure stockée à appeler.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="e1ffd-245">Choisir le `GetProductsPaged` procédure dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>

![Choisissez le GetProductsPaged procédure dans la liste déroulante](efficiently-paging-through-large-amounts-of-data-vb/_static/image12.png)

<span data-ttu-id="e1ffd-247">**Figure 10**: Choisissez le GetProductsPaged procédure dans la liste déroulante</span><span class="sxs-lookup"><span data-stu-id="e1ffd-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>

<span data-ttu-id="e1ffd-248">L’écran suivant vous demande ensuite de quel type de données est retourné par la procédure stockée : données tabulaires, une valeur unique ou aucune valeur.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="e1ffd-249">Dans la mesure où le `GetProductsPaged` procédure stockée peut retourner plusieurs enregistrements, indiquer qu’il retourne des données tabulaires.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>

![Indiquer que la procédure stockée retourne des données tabulaires](efficiently-paging-through-large-amounts-of-data-vb/_static/image13.png)

<span data-ttu-id="e1ffd-251">**Figure 11**: Indiquer que la procédure stockée retourne des données tabulaires</span><span class="sxs-lookup"><span data-stu-id="e1ffd-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>

<span data-ttu-id="e1ffd-252">Enfin, indiquez les noms des méthodes que vous souhaitez avoir créé.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="e1ffd-253">Comme avec nos didacticiels précédents, continuez et créer un jeu de méthodes à l’aide à la fois le remplissage et retourner un DataTable.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="e1ffd-254">Nommez la première méthode `FillPaged` et le second `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>

![Nom de la FillPaged de méthodes et GetProductsPaged](efficiently-paging-through-large-amounts-of-data-vb/_static/image14.png)

<span data-ttu-id="e1ffd-256">**Figure 12**: Nom de la FillPaged de méthodes et GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="e1ffd-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>

<span data-ttu-id="e1ffd-257">En outre créé une méthode de la couche DAL pour retourner une page particulière de produits, nous devons également fournir cette fonctionnalité dans la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="e1ffd-258">Comme la méthode de la couche DAL, la couche BLL GetProductsPaged méthode doit accepter deux entrées entier pour spécifier l’Index de ligne de début et le nombre maximal de lignes et doit retourner uniquement les enregistrements qui se situent dans la plage spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="e1ffd-259">Créer une telle méthode BLL dans la classe ProductsBLL que simplement des appels vers le bas dans le s DAL GetProductsPaged (méthode), comme suit :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>

[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample8.vb)]

<span data-ttu-id="e1ffd-260">Vous pouvez utiliser n’importe quel nom pour les paramètres d’entrée de la méthode s de couche de logique métier, mais, comme nous le verrons bientôt, vous choisissez d’utiliser les `startRowIndex` et `maximumRows` nous évite d’un supplémentaire peu de travail lors de la configuration d’ObjectDataSource pour utiliser cette méthode.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="e1ffd-261">Étape 4 : Configuration de l’ObjectDataSource pour utiliser la pagination personnalisée</span><span class="sxs-lookup"><span data-stu-id="e1ffd-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="e1ffd-262">Avec les méthodes BLL et DAL pour accéder à un sous-ensemble particulier d’enregistrements terminées, nous vous êtes prêt à créer un GridView contrôler ce pages via ses enregistrements sous-jacent à l’aide de la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="e1ffd-263">Commencez par ouvrir le `EfficientPaging.aspx` page dans le `PagingAndSorting` dossier, ajoutez un GridView à la page et configurez-le pour utiliser un nouveau contrôle ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="e1ffd-264">Dans nos derniers didacticiels, nous avions souvent ObjectDataSource configuré pour utiliser le `ProductsBLL` classe s `GetProducts` (méthode).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="e1ffd-265">Cette fois, cependant, nous souhaitons utiliser la `GetProductsPaged` méthode au lieu de cela, depuis le `GetProducts` méthode retourne *tous les* des produits dans la base de données tandis que `GetProductsPaged` retourne uniquement un sous-ensemble particulier d’enregistrements.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>

![Configurer pour utiliser la méthode de GetProductsPaged ProductsBLL classe s ObjectDataSource](efficiently-paging-through-large-amounts-of-data-vb/_static/image15.png)

<span data-ttu-id="e1ffd-267">**Figure 13**: Configurer pour utiliser la méthode de GetProductsPaged ProductsBLL classe s ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="e1ffd-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>

<span data-ttu-id="e1ffd-268">Dans la mesure où re création d’un GridView en lecture seule, prenez un moment pour définir la liste déroulante de méthode dans l’instruction INSERT, UPDATE et supprimer des onglets à (None).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="e1ffd-269">Ensuite, l’Assistant ObjectDataSource nous demande les sources de la `GetProductsPaged` méthode s `startRowIndex` et `maximumRows` les valeurs de paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="e1ffd-270">Ces paramètres d’entrée sont réellement définies par le contrôle GridView automatiquement, il vous suffit de None conservez la valeur de la source et cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>

![Laissez les Sources de paramètre d’entrée en tant que None](efficiently-paging-through-large-amounts-of-data-vb/_static/image16.png)

<span data-ttu-id="e1ffd-272">**Figure 14**: Laissez les Sources de paramètre d’entrée en tant que None</span><span class="sxs-lookup"><span data-stu-id="e1ffd-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>

<span data-ttu-id="e1ffd-273">À l’issue de l’Assistant ObjectDataSource, le contrôle GridView contiendra un BoundField ou du CheckBoxField pour chacun des champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="e1ffd-274">N’hésitez pas à personnaliser l’apparence de s GridView comme vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="e1ffd-275">Je ve choisi d’afficher uniquement les `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, et `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="e1ffd-276">En outre, configurez le contrôle GridView pour prendre en charge la pagination en cochant la case Activer la pagination dans sa balise active.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="e1ffd-277">Après ces modifications, le balisage déclaratif GridView et ObjectDataSource doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample9.aspx)]

<span data-ttu-id="e1ffd-278">Si vous visitez la page via un navigateur, toutefois, le contrôle GridView est introuvable à rechercher.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>

![Le contrôle GridView est pas affichée](efficiently-paging-through-large-amounts-of-data-vb/_static/image17.png)

<span data-ttu-id="e1ffd-280">**Figure 15**: Le contrôle GridView est pas affichée</span><span class="sxs-lookup"><span data-stu-id="e1ffd-280">**Figure 15**: The GridView is Not Displayed</span></span>

<span data-ttu-id="e1ffd-281">Le contrôle GridView est manquant, car l’ObjectDataSource est actuellement à l’aide de 0 en tant que les valeurs pour les deux le `GetProductsPaged` `startRowIndex` et `maximumRows` paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="e1ffd-282">Par conséquent, la requête SQL qui en résulte n’est retourner aucun enregistrement et par conséquent le GridView n’est pas affiché.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="e1ffd-283">Pour résoudre ce problème, nous devons configurer ObjectDataSource pour utiliser la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="e1ffd-284">Cela peut être accompli dans les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="e1ffd-285">**Définir les opérations de mappage ObjectDataSource `EnablePaging` propriété `true`**  cela indique à ObjectDataSource qui doit s’écouler pour le `SelectMethod` deux paramètres supplémentaires : un pour spécifier l’Index de ligne de début ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) et l’autre pour spécifier le nombre de lignes maximal ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="e1ffd-286">**Définir les opérations de mappage ObjectDataSource `StartRowIndexParameterName` et `MaximumRowsParameterName` propriétés en conséquence** le `StartRowIndexParameterName` et `MaximumRowsParameterName` propriétés indiquent les noms des paramètres d’entrée passés à la `SelectMethod` aux fins de la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="e1ffd-287">Par défaut, ces noms de paramètre sont `startIndexRow` et `maximumRows`, c’est pourquoi, lorsque vous créez le `GetProductsPaged` méthode dans la couche BLL, j’ai utilisé ces valeurs pour les paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="e1ffd-288">Si vous avez choisi d’utiliser des noms de paramètres différents pour la couche BLL s `GetProductsPaged` méthode telle que `startIndex` et `maxRows`, par exemple, vous devez définie le s ObjectDataSource `StartRowIndexParameterName` et `MaximumRowsParameterName` propriétés en conséquence (par exemple startIndex pour `StartRowIndexParameterName` et maxRows pour `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="e1ffd-289">**Définir les opérations de mappage ObjectDataSource [ `SelectCountMethod` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) au nom de la méthode qui retourne le Total nombre d’enregistrements en cours paginée via (`TotalNumberOfProducts`)** n’oubliez pas que la `ProductsBLL` classe s `TotalNumberOfProducts`méthode retourne le nombre total d’enregistrements averti par radiomessagerie à l’aide d’une méthode de la couche DAL qui exécute un `SELECT COUNT(*) FROM Products` requête.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="e1ffd-290">Ces informations sont nécessaires par ObjectDataSource afin de restituer correctement l’interface de pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="e1ffd-291">**Supprimer le `startRowIndex` et `maximumRows` `<asp:Parameter>` éléments à partir de la s ObjectDataSource balisage déclaratif** lors de la configuration ObjectDataSource via l’Assistant, Visual Studio automatiquement ajouté deux `<asp:Parameter>` éléments pour le `GetProductsPaged` méthode s des paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="e1ffd-292">En définissant `EnablePaging` à `true`, ces paramètres sont passés automatiquement ; si elles apparaissent également dans la syntaxe déclarative, ObjectDataSource tente de passer *quatre* paramètres pour le `GetProductsPaged` (méthode) et deux paramètres à la `TotalNumberOfProducts` (méthode).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="e1ffd-293">Si vous oubliez pas de supprimer ces `<asp:Parameter>` éléments, lors de la visite de la page via un navigateur, vous obtiendrez un message d’erreur tels que : *ObjectDataSource 'ObjectDataSource1' ne trouve pas une méthode non générique 'TotalNumberOfProducts' qui possède des paramètres : startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="e1ffd-294">Après avoir apporté ces modifications, la syntaxe déclarative de s ObjectDataSource doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample10.aspx)]

<span data-ttu-id="e1ffd-295">Notez que le `EnablePaging` et `SelectCountMethod` propriétés ont été définies et le `<asp:Parameter>` éléments ont été supprimés.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="e1ffd-296">Figure 16 illustre une capture d’écran de la fenêtre Propriétés après ont apporté ces modifications.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>

![Pour utiliser la pagination personnalisée, configurer le contrôle ObjectDataSource](efficiently-paging-through-large-amounts-of-data-vb/_static/image18.png)

<span data-ttu-id="e1ffd-298">**Figure 16**: Pour utiliser la pagination personnalisée, configurer le contrôle ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="e1ffd-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>

<span data-ttu-id="e1ffd-299">Après avoir apporté ces modifications, visitez cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="e1ffd-300">Vous devriez voir 10 produits répertoriés, classés par ordre alphabétique.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="e1ffd-301">Prenez un moment pour parcourir les données d’une page à la fois.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="e1ffd-302">Il n’existe aucune différence visuelle à partir de la perspective de s utilisateur final entre la pagination par défaut et la pagination personnalisée, plus efficacement la pagination personnalisée pages dans de grandes quantités de données, car elle récupère uniquement les enregistrements qui doivent être affichés pour une page donnée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>

<span data-ttu-id="e1ffd-303">[![Les données, trié par le produit s nom, est notifié par radiomessagerie à l’aide personnalisée la pagination](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-vb/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image19.png)</span></span>

<span data-ttu-id="e1ffd-304">**Figure 17**: Les données, trié par le produit s nom, est personnalisé paginée à l’aide de pagination ([cliquez pour afficher l’image en taille réelle](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e1ffd-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="e1ffd-305">Avec la pagination personnalisée, la page compter la valeur retournée par les opérations de mappage ObjectDataSource `SelectCountMethod` est stocké dans l’état d’affichage GridView s.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="e1ffd-306">Autres variables GridView le `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection et ainsi de suite sont stockés dans *état du contrôle*, qui est conservé sans tenir compte de la valeur de la s GridView `EnableViewState` propriété.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="e1ffd-307">Dans la mesure où le `PageCount` valeur est persistante entre les postbacks à l’aide d’état d’affichage, lorsque vous utilisez une interface de pagination qui inclut un lien vers la dernière page, il est impératif que l’état d’affichage GridView s soit activé.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="e1ffd-308">(Si votre interface de pagination n’inclut pas un lien direct vers la dernière page, puis vous pouvez désactiver l’état d’affichage).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>

<span data-ttu-id="e1ffd-309">En cliquant sur le dernier lien de page provoque une publication (postback) et indique le contrôle GridView à mettre à jour son `PageIndex` propriété.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="e1ffd-310">Si l’utilisateur clique sur le dernier lien de page, le contrôle GridView assigne son `PageIndex` propriété à une valeur inférieure à sa `PageCount` propriété.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="e1ffd-311">Avec l’état d’affichage désactivé, le `PageCount` valeur est perdue entre les postbacks et `PageIndex` est affectée la valeur maximale entière à la place.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="e1ffd-312">Ensuite, le contrôle GridView tente de déterminer l’index de ligne de départ en multipliant le `PageSize` et `PageCount` propriétés.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="e1ffd-313">Il en résulte un `OverflowException` dans la mesure où le produit dépasse la taille maximum autorisée d’un entier.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="e1ffd-314">Implémentez la pagination personnalisée et le tri</span><span class="sxs-lookup"><span data-stu-id="e1ffd-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="e1ffd-315">Notre implémentation de la pagination personnalisée actuelle nécessite que l’ordre selon lequel les données sont paginées via être spécifié de manière statique lorsque vous créez le `GetProductsPaged` procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="e1ffd-316">Toutefois, vous avez peut-être noté que la balise active de GridView s contient une case à cocher Activer le tri en plus de l’option Activer la pagination.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="e1ffd-317">Malheureusement, ajout de prise en charge de tri pour le contrôle GridView avec notre implémentation de la pagination personnalisée en cours ne concerne que les enregistrements sur la page actuellement affichée de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="e1ffd-318">Par exemple, si vous configurez le contrôle GridView pour prennent également en charge la pagination et, lors de l’affichage de la première page de données, trier par nom de produit par ordre décroissant, il sera inverser l’ordre des produits sur la page 1.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="e1ffd-319">Comme le montre la Figure 18, par exemple montre crevettes tigres en tant que le premier produit lors du tri par ordre alphabétique inverse, qui ignore les 71 autres produits qui suivent crevettes tigres, par ordre alphabétique ; Seuls les enregistrements sur la première page sont prises en compte dans le tri.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>

<span data-ttu-id="e1ffd-320">[![Uniquement les données affichées sur la Page actuelle est triée.](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-vb/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-vb/_static/image22.png)</span></span>

<span data-ttu-id="e1ffd-321">**Figure 18**: Uniquement les données affichées sur la Page actuelle est triée ([cliquez pour afficher l’image en taille réelle](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="e1ffd-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-vb/_static/image24.png))</span></span>

<span data-ttu-id="e1ffd-322">Le tri s’applique uniquement à la page de données actuelle, car le tri se produit une fois que les données ont été récupérées à partir de la couche BLL s `GetProductsPaged` (méthode) et cette méthode retourne uniquement les enregistrements de la page spécifique.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="e1ffd-323">Pour implémenter le tri correctement, nous devons transmettre l’expression de tri à la `GetProductsPaged` méthode afin que les données peuvent être classées de façon appropriée avant de retourner la page spécifique de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="e1ffd-324">Nous verrons comment procéder dans notre didacticiel suivant.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="e1ffd-325">Implémentation personnalisée de la pagination et la suppression</span><span class="sxs-lookup"><span data-stu-id="e1ffd-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="e1ffd-326">Si vous l’activation de la fonctionnalité de suppression dans un GridView dont les données sont paginées à l’aide de techniques de la pagination personnalisée vous constaterez que lors de la suppression du dernier enregistrement à partir de la dernière page, le contrôle GridView disparaît au lieu de la décrémentation de manière appropriée le s GridView `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="e1ffd-327">Pour reproduire ce bogue, activez la suppression pour le didacticiel que simplement nous venons de créer.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="e1ffd-328">Accédez à la dernière page (9), où vous devriez voir un produit unique dans la mesure où nous avons la pagination des 81, les produits 10 à la fois.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="e1ffd-329">Supprimer ce produit.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-329">Delete this product.</span></span>

<span data-ttu-id="e1ffd-330">Lors de la suppression du dernier produit, le contrôle GridView *doit* accéder automatiquement à la page huitième, et cette fonctionnalité est apparue avec pagination par défaut.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="e1ffd-331">Avec la pagination personnalisée, toutefois, après la suppression de ce dernier produit sur la dernière page, le contrôle GridView simplement disparaît de l’écran complètement.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="e1ffd-332">La raison précise *pourquoi* dans ce cas est un peu au-delà de la portée de ce didacticiel, consultez [si vous supprimez le dernier enregistrement de la dernière Page un GridView avec la pagination personnalisée](http://scottonwriting.net/sowblog/posts/7326.aspx) pour plus d’informations quant à la source de bas niveau Ce problème.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="e1ffd-333">En résumé il s en raison de la séquence suivante d’étapes effectuées par le contrôle GridView lors de l’utilisateur clique sur le bouton Supprimer :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="e1ffd-334">Supprimer l’enregistrement</span><span class="sxs-lookup"><span data-stu-id="e1ffd-334">Delete the record</span></span>
2. <span data-ttu-id="e1ffd-335">Obtenir les enregistrements appropriés à afficher pour le texte spécifié `PageIndex` et `PageSize`</span><span class="sxs-lookup"><span data-stu-id="e1ffd-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="e1ffd-336">Vérifiez que le `PageIndex` ne dépasse pas le nombre de pages de données dans la source de données ; si elle est le cas, automatiquement décrémenter le s GridView `PageIndex` propriété</span><span class="sxs-lookup"><span data-stu-id="e1ffd-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="e1ffd-337">Lier la page appropriée de données pour le contrôle GridView à l’aide d’enregistrements obtenus à l’étape 2</span><span class="sxs-lookup"><span data-stu-id="e1ffd-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="e1ffd-338">Le problème vient du fait que dans étape 2 le `PageIndex` utilisé lors de la récupérer les enregistrements pour afficher le fichier est toujours le `PageIndex` de la dernière page dont seul enregistrement a été simplement supprimé.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="e1ffd-339">Par conséquent, dans l’étape 2, *aucune* enregistrements sont renvoyés dans la mesure où cette dernière page de données ne contient plus d’enregistrements.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="e1ffd-340">Ensuite, à l’étape 3, le contrôle GridView se rend compte que son `PageIndex` propriété est supérieure au nombre total de pages dans la source de données (dans la mesure où ve supprimé le dernier enregistrement de la dernière page) et par conséquent décrémente son `PageIndex` propriété.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="e1ffd-341">À l’étape 4 GridView tente de se lier aux données récupérées à l’étape 2 ; Toutefois, à l’étape 2, aucun enregistrement ont été retournés, par conséquent, ce qui entraîne un GridView vide.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="e1ffd-342">Avec la pagination par défaut, cet t ne de problème de surface, car à l’étape 2 *tous les* enregistrements sont récupérés à partir de la source de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="e1ffd-343">Pour résoudre ce problème, nous avons deux options.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-343">To fix this we have two options.</span></span> <span data-ttu-id="e1ffd-344">La première consiste à créer un gestionnaire d’événements pour les opérations de mappage GridView `RowDeleted` Gestionnaire d’événements qui détermine le nombre d’enregistrements ont été affiché dans la page qui a été simplement supprimée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="e1ffd-345">Si il y a un seul enregistrement, puis l’enregistrement simplement supprimé doit vous avoir été dernier signet et nous avons besoin décrémenter le s GridView `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="e1ffd-346">Bien sûr, nous ne souhaitons mettre à jour le `PageIndex` si l’opération de suppression a réussi en fait, qui peut être déterminée en s’assurant que le `e.Exception` propriété est `null`.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="e1ffd-347">Cette approche fonctionne, car elle met à jour le `PageIndex` après l’étape 1, mais avant l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="e1ffd-348">Par conséquent, à l’étape 2, l’ensemble approprié d’enregistrements est retournée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="e1ffd-349">Pour ce faire, utilisez le code comme suit :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-349">To accomplish this, use code like the following:</span></span>

[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample11.vb)]

<span data-ttu-id="e1ffd-350">Une autre solution consiste à créer un gestionnaire d’événements pour les opérations de mappage ObjectDataSource `RowDeleted` événement et de définir le `AffectedRows` propriété une valeur de 1.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="e1ffd-351">Après avoir supprimé l’enregistrement à l’étape 1 (mais avant de les récupérer de nouveau les données à l’étape 2), le contrôle GridView met à jour son `PageIndex` propriété si une ou plusieurs lignes ont été affectés par l’opération.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="e1ffd-352">Toutefois, le `AffectedRows` propriété n’est pas définie par l’ObjectDataSource et par conséquent, cette étape est ignorée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="e1ffd-353">Pour disposer de cette étape exécutée consiste à définir manuellement le `AffectedRows` propriété si l’opération de suppression est terminée avec succès.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="e1ffd-354">Cela peut être accompli à l’aide de code semblable au suivant :</span><span class="sxs-lookup"><span data-stu-id="e1ffd-354">This can be accomplished using code like the following:</span></span>

[!code-vb[Main](efficiently-paging-through-large-amounts-of-data-vb/samples/sample12.vb)]

<span data-ttu-id="e1ffd-355">Vous trouverez le code pour les deux de ces gestionnaires d’événements dans la classe code-behind de la `EfficientPaging.aspx` exemple.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="e1ffd-356">Comparer les performances de la valeur par défaut et la pagination personnalisée</span><span class="sxs-lookup"><span data-stu-id="e1ffd-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="e1ffd-357">Dans la mesure où la pagination personnalisée récupère uniquement les enregistrements nécessaires, tandis que la pagination par défaut retourne *tous les* des enregistrements pour chaque page affichée, elle s effacer que la pagination personnalisée est plus efficace que la pagination par défaut.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="e1ffd-358">Mais le fait bien plus efficace est la pagination personnalisée ?</span><span class="sxs-lookup"><span data-stu-id="e1ffd-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="e1ffd-359">Le tri des gains de performances sont consultables en passant par la pagination par défaut à la pagination personnalisée ?</span><span class="sxs-lookup"><span data-stu-id="e1ffd-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="e1ffd-360">Malheureusement, s’il y a aucune convenant à tous les répondent ici.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="e1ffd-361">Le gain de performances dépend de plusieurs facteurs, mises en évidence deux équivalant au nombre d’enregistrements en cours de pagination via et de la charge placée sur les canaux de communication et de serveur de base de données entre le serveur web et le serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="e1ffd-362">Pour les petites tables avec seulement quelques douzaines enregistrements, la différence de performances peut être négligeable.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="e1ffd-363">Cependant, pour les tables volumineuses, avec des milliers à des centaines de milliers de lignes, la différence de performances est élevée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="e1ffd-364">Un article de mes amis, [la pagination personnalisée dans ASP.NET 2.0 avec SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contient certains tests de performances que j’ai exécuté pour présenter les différences entre ces deux techniques de pagination lorsque vous choisissez une table de base de données avec les performances 50 000 enregistrements.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="e1ffd-365">Dans ces tests, j’ai examiné les deux le temps d’exécution de la requête au niveau de SQL Server (à l’aide de [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) et à la page ASP.NET à l’aide [fonctionnalités de traçage ASP.NET s](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="e1ffd-366">N’oubliez pas que ces tests ont été exécutés sur mon développement avec un seul utilisateur actif, par conséquent peu scientifique et sont n’imitent pas les modèles de charge de site Web classique.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="e1ffd-367">Malgré tout, les résultats illustrent les différences relatives de durée d’exécution pour la valeur par défaut et la pagination personnalisée lorsque vous travaillez avec suffisamment de grandes quantités de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>

|  | <span data-ttu-id="e1ffd-368">**Moy. Durée (s)**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="e1ffd-369">**Lectures**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e1ffd-370">**Par défaut la pagination SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="e1ffd-371">1.411</span><span class="sxs-lookup"><span data-stu-id="e1ffd-371">1.411</span></span> | <span data-ttu-id="e1ffd-372">383</span><span class="sxs-lookup"><span data-stu-id="e1ffd-372">383</span></span> |
| <span data-ttu-id="e1ffd-373">**Profiler SQL de la pagination personnalisée**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="e1ffd-374">0.002</span><span class="sxs-lookup"><span data-stu-id="e1ffd-374">0.002</span></span> | <span data-ttu-id="e1ffd-375">29</span><span class="sxs-lookup"><span data-stu-id="e1ffd-375">29</span></span> |
| <span data-ttu-id="e1ffd-376">**Trace de ASP.NET de la pagination par défaut**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="e1ffd-377">2.379</span><span class="sxs-lookup"><span data-stu-id="e1ffd-377">2.379</span></span> | <span data-ttu-id="e1ffd-378">*N/A*</span><span class="sxs-lookup"><span data-stu-id="e1ffd-378">*N/A*</span></span> |
| <span data-ttu-id="e1ffd-379">**Trace de ASP.NET de la pagination personnalisée**</span><span class="sxs-lookup"><span data-stu-id="e1ffd-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="e1ffd-380">0.029</span><span class="sxs-lookup"><span data-stu-id="e1ffd-380">0.029</span></span> | <span data-ttu-id="e1ffd-381">*N/A*</span><span class="sxs-lookup"><span data-stu-id="e1ffd-381">*N/A*</span></span> |

<span data-ttu-id="e1ffd-382">Comme vous pouvez le voir, récupération d’une page particulière de données requis 354 moins de lectures en moyenne et terminée en une fraction du temps.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="e1ffd-383">Sur la page ASP.NET, personnalisé la page a été en mesure d’effectuer le rendu dans proche de 1/100<sup>th</sup> du temps nécessaire lors de l’utilisation de la pagination par défaut.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="e1ffd-384">Consultez [mon article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) pour plus d’informations sur ces résultats, ainsi que le code et une base de données, vous pouvez télécharger pour reproduire ces tests dans votre propre environnement.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="e1ffd-385">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="e1ffd-385">Summary</span></span>

<span data-ttu-id="e1ffd-386">La pagination par défaut est un jeu d’enfant implémenter simplement cocher la case à cocher Activer la pagination dans la balise active de données Web contrôle s, mais cette simplicité vient au détriment des performances.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="e1ffd-387">Avec la pagination par défaut, lorsqu’un utilisateur demande à n’importe quelle page de données *tous les* enregistrements sont renvoyés, même si seule une toute petite partie d'entre eux peut-être s’afficher.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="e1ffd-388">Pour lutter contre cette surcharge de performances, ObjectDataSource offre une autre échange option la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="e1ffd-389">Bien que la pagination personnalisée améliore les problèmes de performances s d’échange en récupérant uniquement les enregistrements qui doivent être affichés, par défaut il s plus complexe à implémenter la pagination personnalisée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="e1ffd-390">Tout d’abord, une requête doit être écrite que (efficacement et correctement) accède à du sous-ensemble spécifique d’enregistrements demandé.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="e1ffd-391">Cela peut être accompli de plusieurs façons ; celui que nous avons examiné dans ce didacticiel consiste à utiliser SQL Server 2005 s nouvelle `ROW_NUMBER()` fonction de classement des résultats, et puis résultats pour retourner uniquement ceux dont le classement correspond à une plage spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="e1ffd-392">En outre, nous devons ajouter un moyen de déterminer le nombre total d’enregistrements en cours de pagination via.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="e1ffd-393">Après avoir créé ces méthodes de la couche DAL et la couche BLL, nous devons également configurer ObjectDataSource afin qu’elle puisse déterminer le nombre total d’enregistrements sont en cours de pagination via et peuvent passer correctement les valeurs d’Index de ligne de début et le nombre maximal de lignes à la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="e1ffd-394">Tandis que la mise en œuvre de la pagination personnalisée requiert-il un nombre d’étapes est pas presque aussi simple que la pagination par défaut, la pagination personnalisée est une nécessité lorsque la pagination via suffisamment grandes quantités de données.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="e1ffd-395">Comme examiné les résultats de la pagination a révélé que, personnalisée peut alléger secondes sur le temps de rendu de page ASP.NET et peut alléger la charge sur le serveur de base de données par un ou plusieurs ordres de grandeur.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="e1ffd-396">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="e1ffd-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e1ffd-397">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="e1ffd-397">About the Author</span></span>

<span data-ttu-id="e1ffd-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept les livres sur ASP/ASP.NET et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e1ffd-399">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="e1ffd-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e1ffd-400">Son dernier ouvrage est [*SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e1ffd-401">Il peut être contacté à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e1ffd-402">ou via son blog, qui se trouve à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e1ffd-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e1ffd-403">[Précédent](paging-and-sorting-report-data-vb.md)
> [Suivant](sorting-custom-paged-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e1ffd-403">[Previous](paging-and-sorting-report-data-vb.md)
[Next](sorting-custom-paged-data-vb.md)</span></span>
