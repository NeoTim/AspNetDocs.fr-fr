---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: Téléchargement des fichiers (C#) | Microsoft Docs
author: rick-anderson
description: Découvrez comment permettre aux utilisateurs de charger des fichiers binaires (tels que des documents Word ou PDF) sur votre site Web où ils peuvent être stockés dans le système de fichiers du serveur...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 4e3e32a829de386a681504c8d5d61dd258b8b2e6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74581874"
---
# <a name="uploading-files-c"></a><span data-ttu-id="8421a-103">Chargement de fichiers (C#)</span><span class="sxs-lookup"><span data-stu-id="8421a-103">Uploading Files (C#)</span></span>

<span data-ttu-id="8421a-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8421a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8421a-105">[Télécharger l’exemple d’application](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) ou [Télécharger le PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8421a-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="8421a-106">Découvrez comment permettre aux utilisateurs de charger des fichiers binaires (tels que des documents Word ou PDF) sur votre site Web où ils peuvent être stockés dans le système de fichiers du serveur ou dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="8421a-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="8421a-107">Introduction</span></span>

<span data-ttu-id="8421a-108">Tous les didacticiels que nous avons examinés jusqu’à présent ont travaillé exclusivement avec des données texte.</span><span class="sxs-lookup"><span data-stu-id="8421a-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="8421a-109">Toutefois, de nombreuses applications ont des modèles de données qui capturent à la fois des données texte et des données binaires.</span><span class="sxs-lookup"><span data-stu-id="8421a-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="8421a-110">Un site de mise à jour en ligne peut permettre aux utilisateurs de télécharger une image à associer à leur profil.</span><span class="sxs-lookup"><span data-stu-id="8421a-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="8421a-111">Un site Web de recrutement peut permettre aux utilisateurs de charger leur CV sous forme de document Microsoft Word ou PDF.</span><span class="sxs-lookup"><span data-stu-id="8421a-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="8421a-112">L’utilisation de données binaires ajoute un nouvel ensemble de défis.</span><span class="sxs-lookup"><span data-stu-id="8421a-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="8421a-113">Nous devons décider de la façon dont les données binaires sont stockées dans l’application.</span><span class="sxs-lookup"><span data-stu-id="8421a-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="8421a-114">L’interface utilisée pour l’insertion de nouveaux enregistrements doit être mise à jour pour permettre à l’utilisateur de télécharger un fichier à partir de son ordinateur et des étapes supplémentaires doivent être effectuées pour afficher ou fournir un moyen de télécharger les données binaires associées à un enregistrement.</span><span class="sxs-lookup"><span data-stu-id="8421a-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="8421a-115">Dans ce didacticiel et les trois suivants, nous allons découvrir comment faire face à ces défis.</span><span class="sxs-lookup"><span data-stu-id="8421a-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="8421a-116">À la fin de ces didacticiels, nous avons créé une application entièrement fonctionnelle qui associe une brochure d’image et de PDF à chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="8421a-117">Dans ce didacticiel, nous allons examiner différentes techniques pour stocker des données binaires et découvrir comment permettre aux utilisateurs de télécharger un fichier à partir de leur ordinateur et les avoir enregistrés sur le système de fichiers du serveur Web s.</span><span class="sxs-lookup"><span data-stu-id="8421a-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="8421a-118">Les données binaires qui font partie d’un modèle de données d’application sont parfois appelées [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), acronyme pour Binary Large Object.</span><span class="sxs-lookup"><span data-stu-id="8421a-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="8421a-119">Dans ces didacticiels, j’ai choisi d’utiliser la terminologie données binaires, bien que le terme objet BLOB soit synonyme.</span><span class="sxs-lookup"><span data-stu-id="8421a-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>

## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="8421a-120">Étape 1 : création de l’utilisation des pages Web de données binaires</span><span class="sxs-lookup"><span data-stu-id="8421a-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="8421a-121">Avant de commencer à explorer les défis associés à l’ajout de la prise en charge des données binaires, commencez par prendre un moment pour créer les pages ASP.NET dans notre projet de site Web dont nous aurons besoin pour ce didacticiel et les trois prochaines.</span><span class="sxs-lookup"><span data-stu-id="8421a-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="8421a-122">Commencez par ajouter un nouveau dossier nommé `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="8421a-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="8421a-123">Ajoutez ensuite les pages ASP.NET suivantes à ce dossier, en veillant à associer chaque page à la page maître `Site.master` :</span><span class="sxs-lookup"><span data-stu-id="8421a-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`

![Ajouter les pages ASP.NET pour les didacticiels relatifs aux données binaires](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="8421a-125">**Figure 1**: ajouter les pages ASP.net pour les didacticiels relatifs aux données binaires</span><span class="sxs-lookup"><span data-stu-id="8421a-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>

<span data-ttu-id="8421a-126">Comme dans les autres dossiers, `Default.aspx` dans le dossier `BinaryData` répertorie les didacticiels de la section.</span><span class="sxs-lookup"><span data-stu-id="8421a-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="8421a-127">N’oubliez pas que le contrôle utilisateur `SectionLevelTutorialListing.ascx` fournit cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="8421a-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="8421a-128">Par conséquent, ajoutez ce contrôle utilisateur à `Default.aspx` en le faisant glisser de l’Explorateur de solutions sur la page s Mode Création.</span><span class="sxs-lookup"><span data-stu-id="8421a-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="8421a-129">[![ajouter le contrôle utilisateur SectionLevelTutorialListing. ascx à default. aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="8421a-130">**Figure 2**: ajouter le contrôle utilisateur `SectionLevelTutorialListing.ascx` à `Default.aspx` ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>

<span data-ttu-id="8421a-131">Enfin, ajoutez ces pages en tant qu’entrées au fichier `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="8421a-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="8421a-132">Plus précisément, ajoutez le balisage suivant après l’amélioration du `<siteMapNode>`GridView :</span><span class="sxs-lookup"><span data-stu-id="8421a-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>

[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="8421a-133">Après avoir mis à jour `Web.sitemap`, prenez un moment pour afficher le site Web des didacticiels via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="8421a-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="8421a-134">Le menu à gauche contient maintenant des éléments pour les didacticiels utilisation de données binaires.</span><span class="sxs-lookup"><span data-stu-id="8421a-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>

![Le plan de site contient maintenant des entrées pour les didacticiels utilisation de données binaires](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="8421a-136">**Figure 3**: le plan de site contient maintenant des entrées pour les didacticiels utilisation de données binaires</span><span class="sxs-lookup"><span data-stu-id="8421a-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>

## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="8421a-137">Étape 2 : choix de l’emplacement de stockage des données binaires</span><span class="sxs-lookup"><span data-stu-id="8421a-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="8421a-138">Les données binaires associées au modèle de données de l’application peuvent être stockées dans l’un des deux emplacements suivants : sur le système de fichiers du serveur Web, avec une référence au fichier stocké dans la base de données ; ou directement dans la base de données elle-même (voir figure 4).</span><span class="sxs-lookup"><span data-stu-id="8421a-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="8421a-139">Chaque approche a son propre ensemble de professionnels et de inconvénients et mérite une discussion plus détaillée.</span><span class="sxs-lookup"><span data-stu-id="8421a-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>

<span data-ttu-id="8421a-140">[![données binaires peuvent être stockées dans le système de fichiers ou directement dans la base de données](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="8421a-141">**Figure 4**: les données binaires peuvent être stockées dans le système de fichiers ou directement dans la base de données ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>

<span data-ttu-id="8421a-142">Imaginez que nous souhaitions étendre la base de données Northwind pour associer une image à chaque produit.</span><span class="sxs-lookup"><span data-stu-id="8421a-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="8421a-143">Une option consiste à stocker ces fichiers image sur le système de fichiers du serveur Web et à enregistrer le chemin d’accès dans la table `Products`.</span><span class="sxs-lookup"><span data-stu-id="8421a-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="8421a-144">Avec cette approche, nous ajoutons une `ImagePath` colonne à la table de `Products` de type `varchar(200)`, peut-être.</span><span class="sxs-lookup"><span data-stu-id="8421a-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="8421a-145">Lorsqu’un utilisateur a chargé une image pour Chai, cette image peut être stockée sur le système de fichiers du serveur Web s à `~/Images/Tea.jpg`, où `~` représente le chemin d’accès physique de l’application.</span><span class="sxs-lookup"><span data-stu-id="8421a-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="8421a-146">Autrement dit, si le site Web est enraciné au chemin d’accès physique `C:\Websites\Northwind\`, `~/Images/Tea.jpg` équivaut à `C:\Websites\Northwind\Images\Tea.jpg`.</span><span class="sxs-lookup"><span data-stu-id="8421a-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="8421a-147">Après avoir chargé le fichier image, nous mettons à jour l’enregistrement Chai dans la table `Products` afin que sa colonne `ImagePath` référencée le chemin d’accès de la nouvelle image.</span><span class="sxs-lookup"><span data-stu-id="8421a-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="8421a-148">Nous pourrions utiliser `~/Images/Tea.jpg` ou simplement `Tea.jpg` si nous avons décidé que toutes les images de produit seraient placées dans le dossier application s `Images`.</span><span class="sxs-lookup"><span data-stu-id="8421a-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="8421a-149">Les principaux avantages du stockage des données binaires sur le système de fichiers sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="8421a-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="8421a-150">La **facilité d’implémentation** , comme nous le verrons bientôt, le stockage et la récupération de données binaires stockées directement dans la base de données impliquent un peu plus de code que lors de l’utilisation de données via le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="8421a-151">En outre, pour permettre à un utilisateur d’afficher ou de télécharger des données binaires, une URL vers ces données doit être présentée à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8421a-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="8421a-152">Si les données résident sur le système de fichiers du serveur Web, l’URL est simple.</span><span class="sxs-lookup"><span data-stu-id="8421a-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="8421a-153">Toutefois, si les données sont stockées dans la base de données, vous devez créer une page Web qui récupère et retourne les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="8421a-154">**Accès plus étendu aux données binaires** il se peut que les données binaires doivent être accessibles à d’autres services ou applications, qui ne peuvent pas extraire les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="8421a-155">Par exemple, les images associées à chaque produit peuvent également être accessibles aux utilisateurs via [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol). dans ce cas, nous voulons stocker les données binaires sur le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="8421a-156">**Performances** si les données binaires sont stockées sur le système de fichiers, la demande et la congestion du réseau entre le serveur de base de données et le serveur Web sont inférieures à si les données binaires sont stockées directement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="8421a-157">Le principal inconvénient du stockage de données binaires sur le système de fichiers est qu’il dissocie les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="8421a-158">Si un enregistrement est supprimé de la table `Products`, le fichier associé sur le système de fichiers du serveur Web n’est pas supprimé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="8421a-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="8421a-159">Nous devons écrire du code supplémentaire pour supprimer le fichier, sans quoi le système de fichiers deviendra encombré de fichiers orphelins inutilisés.</span><span class="sxs-lookup"><span data-stu-id="8421a-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="8421a-160">En outre, lors de la sauvegarde de la base de données, nous devons veiller à effectuer également des sauvegardes des données binaires associées dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="8421a-161">Le déplacement de la base de données vers un autre site ou serveur pose des problèmes similaires.</span><span class="sxs-lookup"><span data-stu-id="8421a-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="8421a-162">En guise d’alternative, les données binaires peuvent être stockées directement dans une base de données Microsoft SQL Server 2005 en créant une colonne de type `varbinary`.</span><span class="sxs-lookup"><span data-stu-id="8421a-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="8421a-163">Comme avec d’autres types de données de longueur variable, vous pouvez spécifier une longueur maximale des données binaires qui peuvent être conservées dans cette colonne.</span><span class="sxs-lookup"><span data-stu-id="8421a-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="8421a-164">Par exemple, pour réserver au plus 5 000 octets, utilisez `varbinary(5000)`; `varbinary(MAX)` permet d’obtenir la taille de stockage maximale, environ 2 Go.</span><span class="sxs-lookup"><span data-stu-id="8421a-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="8421a-165">Le principal avantage de stocker des données binaires directement dans la base de données est le couplage étroit entre les données binaires et l’enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="8421a-166">Cela simplifie grandement les tâches d’administration de base de données, telles que les sauvegardes ou le déplacement de la base de données vers un autre site ou serveur.</span><span class="sxs-lookup"><span data-stu-id="8421a-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="8421a-167">En outre, la suppression d’un enregistrement entraîne la suppression automatique des données binaires correspondantes.</span><span class="sxs-lookup"><span data-stu-id="8421a-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="8421a-168">Il existe également des avantages plus subtils du stockage des données binaires dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="8421a-169">Pour plus d’informations, consultez [stockage de fichiers binaires directement dans la base de données à l’aide de ASP.NET 2,0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) .</span><span class="sxs-lookup"><span data-stu-id="8421a-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="8421a-170">Dans Microsoft SQL Server 2000 et versions antérieures, le type de données `varbinary` avait une limite maximale de 8 000 octets.</span><span class="sxs-lookup"><span data-stu-id="8421a-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="8421a-171">Pour stocker jusqu’à 2 Go de données binaires, le [type de données`image`](https://msdn.microsoft.com/library/ms187993.aspx) doit être utilisé à la place.</span><span class="sxs-lookup"><span data-stu-id="8421a-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="8421a-172">Toutefois, avec l’ajout de `MAX` dans SQL Server 2005, le type de données `image` est déconseillé.</span><span class="sxs-lookup"><span data-stu-id="8421a-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="8421a-173">Elle est toujours prise en charge à des fins de compatibilité descendante, mais Microsoft a annoncé que le type de données `image` sera supprimé dans une future version de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8421a-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>

<span data-ttu-id="8421a-174">Si vous utilisez un modèle de données plus ancien, vous pouvez voir le type de données `image`.</span><span class="sxs-lookup"><span data-stu-id="8421a-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="8421a-175">La table `Categories` de la base de données Northwind contient une colonne `Picture` qui peut être utilisée pour stocker les données binaires d’un fichier image pour la catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="8421a-176">Étant donné que la base de données Northwind a ses racines dans Microsoft Access et les versions antérieures de SQL Server, cette colonne est de type `image`.</span><span class="sxs-lookup"><span data-stu-id="8421a-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="8421a-177">Pour ce didacticiel et les trois suivants, nous allons utiliser les deux approches.</span><span class="sxs-lookup"><span data-stu-id="8421a-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="8421a-178">La table `Categories` a déjà une colonne `Picture` pour stocker le contenu binaire d’une image pour la catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="8421a-179">Nous allons ajouter une colonne supplémentaire, `BrochurePath`, pour stocker un chemin d’accès à un fichier PDF sur le système de fichiers du serveur Web, qui peut être utilisé pour fournir une vue d’ensemble de qualité d’impression et impeccable de la catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="8421a-180">Étape 3 : ajout de la colonne`BrochurePath`à la table`Categories`</span><span class="sxs-lookup"><span data-stu-id="8421a-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="8421a-181">Actuellement, la table categories ne contient que quatre colonnes : `CategoryID`, `CategoryName`, `Description`et `Picture`.</span><span class="sxs-lookup"><span data-stu-id="8421a-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="8421a-182">En plus de ces champs, nous devons en ajouter un nouveau qui pointera vers la brochure catégorie s (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="8421a-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="8421a-183">Pour ajouter cette colonne, accédez à la Explorateur de serveurs, explorez les tables, cliquez avec le bouton droit sur la table `Categories` et choisissez Ouvrir la définition de table (voir la figure 5).</span><span class="sxs-lookup"><span data-stu-id="8421a-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="8421a-184">Si vous ne voyez pas la Explorateur de serveurs, affichez-la en sélectionnant l’option Explorateur de serveurs dans le menu Affichage ou appuyez sur Ctrl + Alt + S.</span><span class="sxs-lookup"><span data-stu-id="8421a-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="8421a-185">Ajoutez une nouvelle `varchar(200)` colonne à la table `Categories` nommée `BrochurePath` et autorise `NULL` s, puis cliquez sur l’icône d’enregistrement (ou appuyez sur CTRL + S).</span><span class="sxs-lookup"><span data-stu-id="8421a-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>

<span data-ttu-id="8421a-186">[![ajouter une colonne BrochurePath à la table Categories](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="8421a-187">**Figure 5**: ajouter une colonne `BrochurePath` à la table `Categories` ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>

## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="8421a-188">Étape 4 : mise à jour de l’architecture pour utiliser les colonnes`Picture`et`BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="8421a-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="8421a-189">Le `CategoriesDataTable` de la couche d’accès aux données (DAL) possède actuellement quatre `DataColumn` s définis : `CategoryID`, `CategoryName`, `Description`et `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="8421a-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="8421a-190">Lorsque nous avons conçu à l’origine ce DataTable dans le didacticiel [création d’une couche d’accès aux données](../introduction/creating-a-data-access-layer-cs.md) , le `CategoriesDataTable` avait uniquement les trois premières colonnes ; la colonne `NumberOfProducts` a été ajoutée dans le [maître/détail à l’aide d’une liste à puces d’enregistrements principaux avec un didacticiel des détails DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="8421a-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="8421a-191">Comme décrit dans *création d’une couche d’accès aux données*, les DataTables dans le DataSet typé composent les objets métier.</span><span class="sxs-lookup"><span data-stu-id="8421a-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="8421a-192">Les TableAdapters sont responsables de la communication avec la base de données et du remplissage des objets métier avec les résultats de la requête.</span><span class="sxs-lookup"><span data-stu-id="8421a-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="8421a-193">Le `CategoriesDataTable` est rempli par le `CategoriesTableAdapter`, qui a trois méthodes de récupération de données :</span><span class="sxs-lookup"><span data-stu-id="8421a-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="8421a-194">`GetCategories()` exécute la requête principale du TableAdapter et retourne les champs `CategoryID`, `CategoryName`et `Description` de tous les enregistrements de la table `Categories`.</span><span class="sxs-lookup"><span data-stu-id="8421a-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="8421a-195">La requête principale est utilisée par les méthodes de `Insert` et de `Update` générées automatiquement.</span><span class="sxs-lookup"><span data-stu-id="8421a-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="8421a-196">`GetCategoryByCategoryID(categoryID)` retourne les champs `CategoryID`, `CategoryName`et `Description` de la catégorie dont `CategoryID` est égal à *CategoryID*.</span><span class="sxs-lookup"><span data-stu-id="8421a-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="8421a-197">`GetCategoriesAndNumberOfProducts()` : renvoie les champs `CategoryID`, `CategoryName`et `Description` pour tous les enregistrements de la table `Categories`.</span><span class="sxs-lookup"><span data-stu-id="8421a-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="8421a-198">Utilise également une sous-requête pour retourner le nombre de produits associés à chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="8421a-199">Notez qu’aucune de ces requêtes ne retourne la `Categories` table s `Picture` ou `BrochurePath` colonnes ; les `CategoriesDataTable` ne fournissent pas non plus `DataColumn` s pour ces champs.</span><span class="sxs-lookup"><span data-stu-id="8421a-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="8421a-200">Pour pouvoir utiliser les propriétés Picture et `BrochurePath`, nous devons d’abord les ajouter au `CategoriesDataTable`, puis mettre à jour la classe `CategoriesTableAdapter` pour retourner ces colonnes.</span><span class="sxs-lookup"><span data-stu-id="8421a-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="8421a-201">Ajout des`Picture`et des`BrochurePath``DataColumn` s</span><span class="sxs-lookup"><span data-stu-id="8421a-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="8421a-202">Commencez par ajouter ces deux colonnes au `CategoriesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="8421a-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="8421a-203">Cliquez avec le bouton droit sur l’en-tête `CategoriesDataTable` s, sélectionnez Ajouter dans le menu contextuel, puis choisissez l’option colonne.</span><span class="sxs-lookup"><span data-stu-id="8421a-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="8421a-204">Cette opération crée un `DataColumn` dans le DataTable nommé `Column1`.</span><span class="sxs-lookup"><span data-stu-id="8421a-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="8421a-205">Renommez cette colonne pour `Picture`.</span><span class="sxs-lookup"><span data-stu-id="8421a-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="8421a-206">À partir de la Fenêtre Propriétés, définissez la propriété `DataColumn` s `DataType` sur `System.Byte[]` (il ne s’agit pas d’une option dans la liste déroulante ; vous devez la saisir).</span><span class="sxs-lookup"><span data-stu-id="8421a-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>

<span data-ttu-id="8421a-207">[![créer une image nommée DataColumn dont le type de données est System. Byte []](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="8421a-208">**Figure 6**: créer un `DataColumn` nommé `Picture` dont `DataType` est `System.Byte[]` ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>

<span data-ttu-id="8421a-209">Ajoutez un autre `DataColumn` au DataTable, en le nommant `BrochurePath` à l’aide de la valeur de `DataType` par défaut (`System.String`).</span><span class="sxs-lookup"><span data-stu-id="8421a-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="8421a-210">Retour des valeurs`Picture`et`BrochurePath`à partir du TableAdapter</span><span class="sxs-lookup"><span data-stu-id="8421a-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="8421a-211">Une fois ces deux `DataColumn` ajoutés au `CategoriesDataTable`, nous sommes prêts à mettre à jour le `CategoriesTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="8421a-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="8421a-212">Nous aurions pu faire en sorte que ces deux valeurs de colonne soient retournées dans la requête principale du TableAdapter, mais cela réafficherait les données binaires chaque fois que la méthode `GetCategories()` a été appelée.</span><span class="sxs-lookup"><span data-stu-id="8421a-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="8421a-213">Au lieu de cela, nous allons mettre à jour la requête principale du TableAdapter pour rétablir `BrochurePath` et créer une méthode de récupération de données supplémentaire qui retourne une catégorie particulière de `Picture` colonne.</span><span class="sxs-lookup"><span data-stu-id="8421a-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="8421a-214">Pour mettre à jour la requête principale du TableAdapter, cliquez avec le bouton droit sur l’en-tête `CategoriesTableAdapter` s et choisissez l’option configurer dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="8421a-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="8421a-215">L’Assistant Configuration de l’adaptateur de table, que nous avons vu dans un certain nombre de didacticiels précédents, s’affiche.</span><span class="sxs-lookup"><span data-stu-id="8421a-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="8421a-216">Mettez à jour la requête pour rétablir le `BrochurePath`, puis cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="8421a-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>

<span data-ttu-id="8421a-217">[![mettre à jour la liste des colonnes dans l’instruction SELECT pour retourner également BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="8421a-218">**Figure 7**: mettre à jour la liste des colonnes dans l’instruction `SELECT` pour retourner également `BrochurePath` ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>

<span data-ttu-id="8421a-219">Lorsque vous utilisez des instructions SQL ad hoc pour le TableAdapter, la mise à jour de la liste des colonnes dans la requête principale met à jour la liste des colonnes de toutes les `SELECT` méthodes de requête dans le TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8421a-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="8421a-220">Cela signifie que la méthode `GetCategoryByCategoryID(categoryID)` a été mise à jour pour retourner la colonne `BrochurePath`, ce qui peut être ce que nous avions prévu.</span><span class="sxs-lookup"><span data-stu-id="8421a-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="8421a-221">Toutefois, elle a également mis à jour la liste des colonnes dans la méthode `GetCategoriesAndNumberOfProducts()`, en supprimant la sous-requête qui retourne le nombre de produits pour chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="8421a-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="8421a-222">Par conséquent, nous devons mettre à jour cette méthode `SELECT` requête.</span><span class="sxs-lookup"><span data-stu-id="8421a-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="8421a-223">Cliquez avec le bouton droit sur la méthode `GetCategoriesAndNumberOfProducts()`, choisissez configurer, puis rétablissez la valeur d’origine de la requête `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="8421a-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="8421a-224">Ensuite, créez une nouvelle méthode TableAdapter qui retourne une catégorie particulière s `Picture` valeur de colonne.</span><span class="sxs-lookup"><span data-stu-id="8421a-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="8421a-225">Cliquez avec le bouton droit sur l’en-tête `CategoriesTableAdapter` s et choisissez l’option Ajouter une requête pour lancer l’Assistant Configuration de requêtes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="8421a-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="8421a-226">La première étape de cet Assistant nous demande si vous souhaitez interroger les données à l’aide d’une instruction SQL ad hoc, d’une nouvelle procédure stockée ou d’une procédure existante.</span><span class="sxs-lookup"><span data-stu-id="8421a-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="8421a-227">Sélectionnez utiliser des instructions SQL, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="8421a-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="8421a-228">Étant donné que nous allons retourner une ligne, choisissez l’option SELECT qui retourne les lignes de la deuxième étape.</span><span class="sxs-lookup"><span data-stu-id="8421a-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>

<span data-ttu-id="8421a-229">[![sélectionnez l’option utiliser des instructions SQL](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="8421a-230">**Figure 8**: sélectionner l’option utiliser des instructions SQL ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>

<span data-ttu-id="8421a-231">[![étant donné que la requête renverra un enregistrement de la table Categories, choisissez SELECT qui retourne des lignes](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="8421a-232">**Figure 9**: étant donné que la requête renverra un enregistrement de la table Categories, choisissez SELECT qui retourne des lignes ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>

<span data-ttu-id="8421a-233">À la troisième étape, entrez la requête SQL suivante, puis cliquez sur suivant :</span><span class="sxs-lookup"><span data-stu-id="8421a-233">In the third step, enter the following SQL query and click Next:</span></span>

[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="8421a-234">La dernière étape consiste à choisir le nom de la nouvelle méthode.</span><span class="sxs-lookup"><span data-stu-id="8421a-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="8421a-235">Utilisez `FillCategoryWithBinaryDataByCategoryID` et `GetCategoryWithBinaryDataByCategoryID` pour les modèles remplir un DataTable et retourner un DataTable, respectivement.</span><span class="sxs-lookup"><span data-stu-id="8421a-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="8421a-236">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="8421a-236">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="8421a-237">[![choisir les noms des méthodes du TableAdapter](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="8421a-238">**Figure 10**: choisir les noms des méthodes des TableAdapter s ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>

> [!NOTE]
> <span data-ttu-id="8421a-239">Après avoir terminé l’Assistant Configuration des requêtes de l’adaptateur de table, vous pouvez voir une boîte de dialogue vous informant que le nouveau texte de la commande retourne des données avec un schéma différent du schéma de la requête principale.</span><span class="sxs-lookup"><span data-stu-id="8421a-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="8421a-240">En bref, l’Assistant remarque que la requête principale du TableAdapter s `GetCategories()` retourne un schéma différent de celui que nous venons de créer.</span><span class="sxs-lookup"><span data-stu-id="8421a-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="8421a-241">Mais c’est ce que nous voulons, vous pouvez donc ignorer ce message.</span><span class="sxs-lookup"><span data-stu-id="8421a-241">But this is what we want, so you can disregard this message.</span></span>

<span data-ttu-id="8421a-242">En outre, gardez à l’esprit que si vous utilisez des instructions SQL ad hoc et que vous utilisez l’Assistant pour modifier la requête principale du TableAdapter à un moment ultérieur, elle modifiera la `GetCategoryWithBinaryDataByCategoryID` méthode s `SELECT` liste des colonnes de l’instruction s pour n’inclure que les colonnes de la requête principale (autrement dit, elle supprimera la `Picture` colonne de la requête).</span><span class="sxs-lookup"><span data-stu-id="8421a-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="8421a-243">Vous devrez mettre à jour manuellement la liste des colonnes pour retourner la colonne `Picture`, de la même façon que nous l’avons fait avec la méthode `GetCategoriesAndNumberOfProducts()` précédemment dans cette étape.</span><span class="sxs-lookup"><span data-stu-id="8421a-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="8421a-244">Après avoir ajouté les deux `DataColumn` s aux `CategoriesDataTable` et la méthode `GetCategoryWithBinaryDataByCategoryID` au `CategoriesTableAdapter`, ces classes dans le concepteur de DataSet typé doivent ressembler à la capture d’écran de la figure 11.</span><span class="sxs-lookup"><span data-stu-id="8421a-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>

![Le concepteur de DataSet comprend les nouvelles colonnes et la nouvelle méthode](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="8421a-246">**Figure 11**: le concepteur de DataSet comprend les nouvelles colonnes et la nouvelle méthode</span><span class="sxs-lookup"><span data-stu-id="8421a-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>

## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="8421a-247">Mise à jour de la couche de logique métier (BLL)</span><span class="sxs-lookup"><span data-stu-id="8421a-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="8421a-248">Avec la couche DAL mise à jour, il ne reste plus qu’à compléter la couche BLL (Business Logic Layer) pour inclure une méthode pour la nouvelle méthode `CategoriesTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="8421a-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="8421a-249">Ajoutez la méthode suivante à la classe `CategoriesBLL` :</span><span class="sxs-lookup"><span data-stu-id="8421a-249">Add the following method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="8421a-250">Étape 5 : Téléchargement d’un fichier à partir du client vers le serveur Web</span><span class="sxs-lookup"><span data-stu-id="8421a-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="8421a-251">Lorsque vous collectez des données binaires, ces données sont souvent fournies par un utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="8421a-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="8421a-252">Pour capturer ces informations, l’utilisateur doit être en mesure de charger un fichier à partir de son ordinateur sur le serveur Web.</span><span class="sxs-lookup"><span data-stu-id="8421a-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="8421a-253">Les données chargées doivent ensuite être intégrées au modèle de données, ce qui peut signifier l’enregistrement du fichier dans le système de fichiers du serveur Web et l’ajout d’un chemin d’accès au fichier dans la base de données, ou l’écriture du contenu binaire directement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="8421a-254">Dans cette étape, nous allons examiner comment autoriser un utilisateur à télécharger des fichiers à partir de son ordinateur sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="8421a-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="8421a-255">Dans le didacticiel suivant, nous allons attirer l’attention sur l’intégration du fichier téléchargé avec le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="8421a-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="8421a-256">ASP.NET 2,0 s nouveau [contrôle Web FileUpload](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) fournit un mécanisme permettant aux utilisateurs d’envoyer un fichier de leur ordinateur au serveur Web.</span><span class="sxs-lookup"><span data-stu-id="8421a-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="8421a-257">Le contrôle FileUpload est rendu sous la forme d’un élément `<input>` dont l’attribut `type` est défini sur file, que les navigateurs affichent sous forme de zone de texte avec un bouton Parcourir.</span><span class="sxs-lookup"><span data-stu-id="8421a-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="8421a-258">Le fait de cliquer sur le bouton Parcourir permet d’ouvrir une boîte de dialogue dans laquelle l’utilisateur peut sélectionner un fichier.</span><span class="sxs-lookup"><span data-stu-id="8421a-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="8421a-259">Lorsque le formulaire est publié, le contenu des fichiers sélectionnés est envoyé avec la publication (postback).</span><span class="sxs-lookup"><span data-stu-id="8421a-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="8421a-260">Côté serveur, les informations sur le fichier téléchargé sont accessibles via les propriétés du contrôle FileUpload s.</span><span class="sxs-lookup"><span data-stu-id="8421a-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="8421a-261">Pour illustrer le téléchargement de fichiers, ouvrez la page `FileUpload.aspx` dans le dossier `BinaryData`, faites glisser un contrôle FileUpload de la boîte à outils vers le concepteur et définissez la propriété Control s `ID` sur `UploadTest`.</span><span class="sxs-lookup"><span data-stu-id="8421a-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="8421a-262">Ensuite, ajoutez un contrôle Web Button en définissant ses propriétés `ID` et `Text` sur `UploadButton` et télécharger le fichier sélectionné, respectivement.</span><span class="sxs-lookup"><span data-stu-id="8421a-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="8421a-263">Enfin, placez un contrôle Web Label sous le bouton, effacez sa propriété `Text` et affectez à sa propriété `ID` la valeur `UploadDetails`.</span><span class="sxs-lookup"><span data-stu-id="8421a-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>

<span data-ttu-id="8421a-264">[![ajouter un contrôle FileUpload à la page ASP.NET](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="8421a-265">**Figure 12**: ajouter un contrôle FileUpload à la page ASP.net ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>

<span data-ttu-id="8421a-266">La figure 13 illustre cette page lorsque vous l’affichez dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="8421a-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="8421a-267">Notez que le fait de cliquer sur le bouton Parcourir permet d’ouvrir une boîte de dialogue de sélection de fichier, ce qui permet à l’utilisateur de choisir un fichier sur son ordinateur.</span><span class="sxs-lookup"><span data-stu-id="8421a-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="8421a-268">Une fois qu’un fichier a été sélectionné, le fait de cliquer sur le bouton charger le fichier sélectionné entraîne une publication qui envoie le contenu binaire des fichiers sélectionnés au serveur Web.</span><span class="sxs-lookup"><span data-stu-id="8421a-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>

<span data-ttu-id="8421a-269">[![l’utilisateur peut sélectionner un fichier à télécharger à partir de son ordinateur sur le serveur](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="8421a-270">**Figure 13**: l’utilisateur peut sélectionner un fichier à télécharger à partir de son ordinateur sur le serveur ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>

<span data-ttu-id="8421a-271">Lors de la publication (postback), le fichier téléchargé peut être enregistré dans le système de fichiers ou ses données binaires peuvent être utilisées directement via un flux.</span><span class="sxs-lookup"><span data-stu-id="8421a-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="8421a-272">Pour cet exemple, vous allez créer un dossier `~/Brochures` et y enregistrer le fichier chargé.</span><span class="sxs-lookup"><span data-stu-id="8421a-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="8421a-273">Commencez par ajouter le dossier `Brochures` au site en tant que sous-dossier du répertoire racine.</span><span class="sxs-lookup"><span data-stu-id="8421a-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="8421a-274">Ensuite, créez un gestionnaire d’événements pour l’événement `UploadButton` s `Click` et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="8421a-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>

[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="8421a-275">Le contrôle FileUpload fournit diverses propriétés permettant d’utiliser les données chargées.</span><span class="sxs-lookup"><span data-stu-id="8421a-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="8421a-276">Par exemple, la [propriété`HasFile`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indique si un fichier a été téléchargé par l’utilisateur, tandis que la [propriété`FileBytes`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) fournit l’accès aux données binaires téléchargées sous la forme d’un tableau d’octets.</span><span class="sxs-lookup"><span data-stu-id="8421a-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="8421a-277">Le gestionnaire d’événements `Click` démarre en s’assurant qu’un fichier a été chargé.</span><span class="sxs-lookup"><span data-stu-id="8421a-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="8421a-278">Si un fichier a été chargé, l’étiquette indique le nom du fichier téléchargé, sa taille en octets et son Content-type.</span><span class="sxs-lookup"><span data-stu-id="8421a-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="8421a-279">Pour vous assurer que l’utilisateur charge un fichier, vous pouvez vérifier la propriété `HasFile` et afficher un avertissement s’il est `false`ou vous pouvez utiliser le [contrôle RequiredFieldValidator](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) à la place.</span><span class="sxs-lookup"><span data-stu-id="8421a-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>

<span data-ttu-id="8421a-280">Le `SaveAs(filePath)` FileUpload enregistre le fichier chargé dans le *filePath*spécifié.</span><span class="sxs-lookup"><span data-stu-id="8421a-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="8421a-281">*filePath* doit être un *chemin d’accès physique* (`C:\Websites\Brochures\SomeFile.pdf`) au lieu *d’un chemin d’accès* *virtuel* (`/Brochures/SomeFile.pdf`).</span><span class="sxs-lookup"><span data-stu-id="8421a-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="8421a-282">La [méthode`Server.MapPath(virtPath)`](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) prend un chemin d’accès virtuel et retourne son chemin d’accès physique correspondant.</span><span class="sxs-lookup"><span data-stu-id="8421a-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="8421a-283">Ici, le chemin d’accès virtuel est `~/Brochures/fileName`, où *filename* est le nom du fichier chargé.</span><span class="sxs-lookup"><span data-stu-id="8421a-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="8421a-284">Pour plus d’informations sur les chemins d’accès virtuel et physique et l’utilisation de `Server.MapPath`, consultez [utilisation de Server. MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) .</span><span class="sxs-lookup"><span data-stu-id="8421a-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="8421a-285">Après avoir terminé le gestionnaire d’événements `Click`, prenez un moment pour tester la page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="8421a-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="8421a-286">Cliquez sur le bouton Parcourir et sélectionnez un fichier sur votre disque dur, puis cliquez sur le bouton charger le fichier sélectionné.</span><span class="sxs-lookup"><span data-stu-id="8421a-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="8421a-287">La publication envoie le contenu du fichier sélectionné au serveur Web, qui affiche ensuite des informations sur le fichier avant de l’enregistrer dans le dossier `~/Brochures`.</span><span class="sxs-lookup"><span data-stu-id="8421a-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="8421a-288">Après avoir téléchargé le fichier, revenez à Visual Studio et cliquez sur le bouton Actualiser dans la Explorateur de solutions.</span><span class="sxs-lookup"><span data-stu-id="8421a-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="8421a-289">Vous devez voir le fichier que vous venez de charger dans le dossier ~/brochures !</span><span class="sxs-lookup"><span data-stu-id="8421a-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>

<span data-ttu-id="8421a-290">[![le fichier EvolutionValley. jpg a été chargé sur le serveur Web](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="8421a-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="8421a-291">**Figure 14**: le fichier `EvolutionValley.jpg` a été chargé sur le serveur Web ([cliquez pour afficher l’image en taille réelle](uploading-files-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="8421a-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>

![EvolutionValley. jpg a été enregistré dans le dossier ~/brochures](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="8421a-293">**Figure 15**: `EvolutionValley.jpg` a été enregistré dans le dossier `~/Brochures`</span><span class="sxs-lookup"><span data-stu-id="8421a-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>

## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="8421a-294">Subtilités de l’enregistrement des fichiers téléchargés dans le système de fichiers</span><span class="sxs-lookup"><span data-stu-id="8421a-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="8421a-295">Plusieurs subtilités sont à prendre en compte lors de l’enregistrement du téléchargement des fichiers sur le système de fichiers du serveur Web s.</span><span class="sxs-lookup"><span data-stu-id="8421a-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="8421a-296">Tout d’abord, il y a un problème de sécurité.</span><span class="sxs-lookup"><span data-stu-id="8421a-296">First, there s the issue of security.</span></span> <span data-ttu-id="8421a-297">Pour enregistrer un fichier dans le système de fichiers, le contexte de sécurité sous lequel la page ASP.NET s’exécute doit avoir des autorisations en écriture.</span><span class="sxs-lookup"><span data-stu-id="8421a-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="8421a-298">Le serveur Web de développement ASP.NET s’exécute dans le contexte de votre compte d’utilisateur actuel.</span><span class="sxs-lookup"><span data-stu-id="8421a-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="8421a-299">Si vous utilisez Microsoft s Internet Information Services (IIS) comme serveur Web, le contexte de sécurité dépend de la version d’IIS et de sa configuration.</span><span class="sxs-lookup"><span data-stu-id="8421a-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="8421a-300">L’enregistrement des fichiers dans le système de fichiers repose également sur l’attribution d’un nom aux fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="8421a-301">Actuellement, notre page enregistre tous les fichiers téléchargés dans le répertoire `~/Brochures` en utilisant le même nom que le fichier sur l’ordinateur client s.</span><span class="sxs-lookup"><span data-stu-id="8421a-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="8421a-302">Si l’utilisateur A télécharge une brochure portant le nom `Brochure.pdf`, le fichier est enregistré en tant que `~/Brochure/Brochure.pdf`.</span><span class="sxs-lookup"><span data-stu-id="8421a-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="8421a-303">Mais que se passe-t-il si, plus tard, l’utilisateur B charge un autre fichier de brochure qui a le même nom de fichier (`Brochure.pdf`) ?</span><span class="sxs-lookup"><span data-stu-id="8421a-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="8421a-304">Avec le code que nous avons maintenant, l’utilisateur A est remplacé par le fichier de téléchargement de l’utilisateur B.</span><span class="sxs-lookup"><span data-stu-id="8421a-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="8421a-305">Il existe plusieurs techniques pour résoudre les conflits de noms de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="8421a-306">L’une des options consiste à interdire le chargement d’un fichier s’il en existe déjà un portant le même nom.</span><span class="sxs-lookup"><span data-stu-id="8421a-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="8421a-307">Avec cette approche, lorsque l’utilisateur B tente de télécharger un fichier nommé `Brochure.pdf`, le système n’enregistre pas son fichier et affiche à la place un message informant l’utilisateur B pour renommer le fichier et réessayer.</span><span class="sxs-lookup"><span data-stu-id="8421a-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="8421a-308">Une autre approche consiste à enregistrer le fichier à l’aide d’un nom de fichier unique, qui peut être un [identificateur global unique (Guid)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) ou la valeur de la ou des colonnes de clé primaire de l’enregistrement de base de données correspondant (en supposant que le téléchargement est associé à une ligne particulière dans le modèle de données).</span><span class="sxs-lookup"><span data-stu-id="8421a-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="8421a-309">Dans le didacticiel suivant, nous allons explorer ces options plus en détail.</span><span class="sxs-lookup"><span data-stu-id="8421a-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="8421a-310">Défis liés à de très grandes quantités de données binaires</span><span class="sxs-lookup"><span data-stu-id="8421a-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="8421a-311">Ces didacticiels partent du principe que la taille des données binaires capturées est modeste.</span><span class="sxs-lookup"><span data-stu-id="8421a-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="8421a-312">L’utilisation de très grandes quantités de fichiers de données binaires de plusieurs mégaoctets ou plus entraîne de nouveaux défis qui n’entrent pas dans le cadre de ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="8421a-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="8421a-313">Par exemple, par défaut, ASP.NET rejette les chargements de plus de 4 Mo, bien que cela puisse être configuré par le biais de l' [élément`<httpRuntime>`](https://msdn.microsoft.com/library/e1f13641.aspx) dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="8421a-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="8421a-314">IIS impose également ses propres limitations de taille de chargement de fichiers.</span><span class="sxs-lookup"><span data-stu-id="8421a-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="8421a-315">Pour plus d’informations, consultez [taille du fichier de téléchargement IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) .</span><span class="sxs-lookup"><span data-stu-id="8421a-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="8421a-316">En outre, le temps nécessaire pour charger des fichiers volumineux peut dépasser la valeur par défaut de 110 secondes ASP.NET attend une demande.</span><span class="sxs-lookup"><span data-stu-id="8421a-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="8421a-317">Il existe également des problèmes de mémoire et de performances qui surviennent lors de l’utilisation de fichiers volumineux.</span><span class="sxs-lookup"><span data-stu-id="8421a-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="8421a-318">Le contrôle FileUpload n’est pas pratique pour les chargements de fichiers volumineux.</span><span class="sxs-lookup"><span data-stu-id="8421a-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="8421a-319">Au fur et à mesure que le contenu des fichiers est publié sur le serveur, l’utilisateur final doit patienter sans confirmer que son chargement progresse.</span><span class="sxs-lookup"><span data-stu-id="8421a-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="8421a-320">Cela ne pose pas de problème lorsque vous traitez des fichiers plus petits qui peuvent être téléchargés en quelques secondes, mais peut être un problème lorsque vous traitez des fichiers plus volumineux qui peuvent prendre plusieurs minutes à charger.</span><span class="sxs-lookup"><span data-stu-id="8421a-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="8421a-321">Un grand nombre de contrôles de téléchargement de fichiers tiers sont mieux adaptés à la gestion des chargements volumineux et un grand nombre de ces fournisseurs fournissent des indicateurs de progression et des gestionnaires de téléchargement ActiveX qui présentent une expérience utilisateur beaucoup plus soignée.</span><span class="sxs-lookup"><span data-stu-id="8421a-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="8421a-322">Si votre application doit gérer des fichiers volumineux, vous devez examiner attentivement les défis et trouver les solutions appropriées pour vos besoins spécifiques.</span><span class="sxs-lookup"><span data-stu-id="8421a-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="8421a-323">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="8421a-323">Summary</span></span>

<span data-ttu-id="8421a-324">La création d’une application qui doit capturer des données binaires présente un certain nombre de défis.</span><span class="sxs-lookup"><span data-stu-id="8421a-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="8421a-325">Dans ce didacticiel, nous avons abordé les deux premières : décider où stocker les données binaires et permettre à un utilisateur de charger du contenu binaire via une page Web.</span><span class="sxs-lookup"><span data-stu-id="8421a-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="8421a-326">Dans les trois didacticiels suivants, nous verrons comment associer les données chargées à un enregistrement dans la base de données et comment afficher les données binaires en même temps que les champs de données de texte.</span><span class="sxs-lookup"><span data-stu-id="8421a-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="8421a-327">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="8421a-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="8421a-328">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="8421a-328">Further Reading</span></span>

<span data-ttu-id="8421a-329">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="8421a-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="8421a-330">Utilisation des types de données de valeur élevée</span><span class="sxs-lookup"><span data-stu-id="8421a-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="8421a-331">Démarrages rapides du contrôle FileUpload</span><span class="sxs-lookup"><span data-stu-id="8421a-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="8421a-332">Contrôle serveur FileUpload ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="8421a-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="8421a-333">Côté sombre des chargements de fichiers</span><span class="sxs-lookup"><span data-stu-id="8421a-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="8421a-334">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="8421a-334">About the Author</span></span>

<span data-ttu-id="8421a-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="8421a-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8421a-336">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="8421a-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8421a-337">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8421a-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8421a-338">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8421a-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8421a-339">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8421a-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8421a-340">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="8421a-340">Special Thanks To</span></span>

<span data-ttu-id="8421a-341">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="8421a-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8421a-342">Les réviseurs de leads pour ce didacticiel étaient Teresa Murphy et Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="8421a-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="8421a-343">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="8421a-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8421a-344">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8421a-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="8421a-345">Suivant</span><span class="sxs-lookup"><span data-stu-id="8421a-345">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
