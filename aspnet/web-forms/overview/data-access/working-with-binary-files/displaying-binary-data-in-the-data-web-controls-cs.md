---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
title: Affichage de données binaires dans les contrôles WebC#de données () | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous examinons les options permettant de présenter des données binaires sur une page Web, y compris l’affichage d’un fichier image et la fourniture d’un lien’Télécharger'...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 5cbeb9f8-5f92-4ba8-87ae-0b4d460ae6d4
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
msc.type: authoredcontent
ms.openlocfilehash: f38de7adcd77b3dc2622759646168cf533b8308f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74642564"
---
# <a name="displaying-binary-data-in-the-data-web-controls-c"></a><span data-ttu-id="6e8de-103">Affichage de données binaires dans les contrôles web de données (C#)</span><span class="sxs-lookup"><span data-stu-id="6e8de-103">Displaying Binary Data in the Data Web Controls (C#)</span></span>

<span data-ttu-id="6e8de-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6e8de-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6e8de-105">[Télécharger l’exemple d’application](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe) ou [Télécharger le PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6e8de-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span></span>

> <span data-ttu-id="6e8de-106">Dans ce didacticiel, nous examinons les options permettant de présenter des données binaires sur une page Web, notamment l’affichage d’un fichier image et la fourniture d’un lien « Télécharger » pour un fichier PDF.</span><span class="sxs-lookup"><span data-stu-id="6e8de-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>

## <a name="introduction"></a><span data-ttu-id="6e8de-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="6e8de-107">Introduction</span></span>

<span data-ttu-id="6e8de-108">Dans le didacticiel précédent, nous avons exploré les deux techniques permettant d’associer des données binaires à un modèle de données sous-jacent des applications et utilisé le contrôle FileUpload pour charger des fichiers à partir d’un navigateur vers le système de fichiers du serveur Web s.</span><span class="sxs-lookup"><span data-stu-id="6e8de-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="6e8de-109">Nous avons encore vu comment associer les données binaires téléchargées au modèle de données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="6e8de-110">Autrement dit, une fois qu’un fichier a été téléchargé et enregistré dans le système de fichiers, un chemin d’accès au fichier doit être stocké dans l’enregistrement de base de données approprié.</span><span class="sxs-lookup"><span data-stu-id="6e8de-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="6e8de-111">Si les données sont stockées directement dans la base de données, les données binaires téléchargées ne doivent pas être enregistrées dans le système de fichiers, mais doivent être injectées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="6e8de-112">Avant d’envisager d’associer les données au modèle de données, voyons d’abord comment fournir les données binaires à l’utilisateur final.</span><span class="sxs-lookup"><span data-stu-id="6e8de-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="6e8de-113">La présentation des données texte est assez simple, mais comment les données binaires doivent-elles être présentées ?</span><span class="sxs-lookup"><span data-stu-id="6e8de-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="6e8de-114">Il dépend, bien sûr, du type de données binaires.</span><span class="sxs-lookup"><span data-stu-id="6e8de-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="6e8de-115">Pour les images, nous souhaitons probablement afficher l’image. pour les fichiers PDF, les documents Microsoft Word, les fichiers ZIP et d’autres types de données binaires, la fourniture d’un lien de téléchargement est probablement plus appropriée.</span><span class="sxs-lookup"><span data-stu-id="6e8de-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="6e8de-116">Dans ce didacticiel, nous allons examiner comment présenter les données binaires en même temps que les données texte associées à l’aide de contrôles Web de données tels que GridView et DetailsView.</span><span class="sxs-lookup"><span data-stu-id="6e8de-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="6e8de-117">Dans le didacticiel suivant, nous allons attirer l’attention sur l’Association d’un fichier chargé à la base de données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="6e8de-118">Étape 1 : fournir des valeurs de`BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="6e8de-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="6e8de-119">La `Picture` colonne de la table `Categories` contient déjà des données binaires pour les différentes images de catégorie.</span><span class="sxs-lookup"><span data-stu-id="6e8de-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="6e8de-120">Plus précisément, la `Picture` colonne pour chaque enregistrement contient le contenu binaire d’une image bitmap de couleur de grain, de faible qualité et de plus de 16 couleurs.</span><span class="sxs-lookup"><span data-stu-id="6e8de-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="6e8de-121">Chaque image de catégorie a une largeur de 172 pixels et une hauteur de 120 pixels et consomme environ 11 Ko.</span><span class="sxs-lookup"><span data-stu-id="6e8de-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="6e8de-122">De plus, le contenu binaire de la colonne `Picture` comprend un en-tête [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) de 78 octets qui doit être supprimé avant d’afficher l’image.</span><span class="sxs-lookup"><span data-stu-id="6e8de-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="6e8de-123">Ces informations d’en-tête sont présentes, car la base de données Northwind a ses racines dans Microsoft Access.</span><span class="sxs-lookup"><span data-stu-id="6e8de-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="6e8de-124">Dans Access, les données binaires sont stockées à l’aide du type de données objet OLE, qui s’oriente sur cet en-tête.</span><span class="sxs-lookup"><span data-stu-id="6e8de-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="6e8de-125">Pour le moment, nous verrons comment supprimer les en-têtes de ces images de qualité inférieure afin d’afficher l’image.</span><span class="sxs-lookup"><span data-stu-id="6e8de-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="6e8de-126">Dans un prochain didacticiel, nous allons créer une interface pour mettre à jour une catégorie s `Picture` colonne et remplacer ces images bitmap qui utilisent des en-têtes OLE avec des images JPG équivalentes sans en-têtes OLE inutiles.</span><span class="sxs-lookup"><span data-stu-id="6e8de-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="6e8de-127">Dans le didacticiel précédent, nous avons vu comment utiliser le contrôle FileUpload.</span><span class="sxs-lookup"><span data-stu-id="6e8de-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="6e8de-128">Par conséquent, vous pouvez continuer et ajouter des fichiers de brochure au système de fichiers du serveur Web s.</span><span class="sxs-lookup"><span data-stu-id="6e8de-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="6e8de-129">Toutefois, cela ne met pas à jour la colonne `BrochurePath` dans la table `Categories`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="6e8de-130">Dans le didacticiel suivant, nous allons voir comment y parvenir, mais pour le moment, nous devons fournir manuellement les valeurs de cette colonne.</span><span class="sxs-lookup"><span data-stu-id="6e8de-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="6e8de-131">Dans ce didacticiel, vous allez télécharger sept fichiers de brochure PDF dans le dossier `~/Brochures`, un pour chacune des catégories, à l’exception des fruits de mer.</span><span class="sxs-lookup"><span data-stu-id="6e8de-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="6e8de-132">J’ai volontairement omis d’ajouter une brochure de produits de la mer pour illustrer comment gérer les scénarios où tous les enregistrements n’ont pas de données binaires associées.</span><span class="sxs-lookup"><span data-stu-id="6e8de-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="6e8de-133">Pour mettre à jour la table `Categories` avec ces valeurs, cliquez avec le bouton droit sur le nœud `Categories` à partir de Explorateur de serveurs, puis choisissez afficher les données de la table.</span><span class="sxs-lookup"><span data-stu-id="6e8de-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="6e8de-134">Ensuite, entrez les chemins d’accès virtuels aux fichiers de brochure pour chaque catégorie qui a une brochure, comme le montre la figure 1.</span><span class="sxs-lookup"><span data-stu-id="6e8de-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="6e8de-135">Étant donné qu’il n’y a aucune brochure pour la catégorie de produits de la mer, conservez la valeur de `BrochurePath` colonne s comme `NULL`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>

<span data-ttu-id="6e8de-136">[![entrer manuellement les valeurs de la colonne BrochurePath de la table des catégories](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span></span>

<span data-ttu-id="6e8de-137">**Figure 1**: entrer manuellement les valeurs de la colonne `Categories` de la Table s `BrochurePath` ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span></span>

## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="6e8de-138">Étape 2 : fournir un lien de téléchargement pour les brochures dans un GridView</span><span class="sxs-lookup"><span data-stu-id="6e8de-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="6e8de-139">Avec les valeurs `BrochurePath` fournies pour la table `Categories`, nous sommes prêts à créer un GridView qui répertorie chaque catégorie avec un lien pour télécharger la brochure catégorie s.</span><span class="sxs-lookup"><span data-stu-id="6e8de-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="6e8de-140">À l’étape 4, nous allons étendre ce GridView pour afficher également l’image de la catégorie s.</span><span class="sxs-lookup"><span data-stu-id="6e8de-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="6e8de-141">Commencez par faire glisser un contrôle GridView de la boîte à outils vers le concepteur de la page `DisplayOrDownloadData.aspx` dans le dossier `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="6e8de-142">Définissez le `ID` GridView s sur `Categories` et par le biais de la balise active GridView s, puis choisissez de le lier à une nouvelle source de données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="6e8de-143">Plus précisément, liez-le à un ObjectDataSource nommé `CategoriesDataSource` qui récupère les données à l’aide de la méthode `GetCategories()` `CategoriesBLL` objet.</span><span class="sxs-lookup"><span data-stu-id="6e8de-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>

<span data-ttu-id="6e8de-144">[![créer un ObjectDataSource nommé CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span></span>

<span data-ttu-id="6e8de-145">**Figure 2**: créer un ObjectDataSource nommé `CategoriesDataSource` ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span></span>

<span data-ttu-id="6e8de-146">[![configurer ObjectDataSource pour utiliser la classe CategoriesBLL](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span></span>

<span data-ttu-id="6e8de-147">**Figure 3**: configurer ObjectDataSource pour utiliser la classe `CategoriesBLL` ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span></span>

<span data-ttu-id="6e8de-148">[![récupérer la liste des catégories à l’aide de la méthode GetCategories ()](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span></span>

<span data-ttu-id="6e8de-149">**Figure 4**: récupérer la liste des catégories à l’aide de la méthode `GetCategories()` ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span></span>

<span data-ttu-id="6e8de-150">À l’issue de l’exécution de l’Assistant Configuration de la source de données, Visual Studio ajoute automatiquement un BoundField au `Categories` GridView pour les `NumberOfProducts`s `CategoryID`, `CategoryName`, `Description`, `BrochurePath` et `DataColumn`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="6e8de-151">Continuez et supprimez le `NumberOfProducts` BoundField puisque la requête de la méthode `GetCategories()` ne récupère pas ces informations.</span><span class="sxs-lookup"><span data-stu-id="6e8de-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="6e8de-152">Supprimez également le `CategoryID` BoundField et renommez les propriétés `CategoryName` et `BrochurePath` BoundFields `HeaderText` en Category et brochure, respectivement.</span><span class="sxs-lookup"><span data-stu-id="6e8de-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="6e8de-153">Une fois ces modifications effectuées, vos balises déclaratives GridView et ObjectDataSource doivent ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="6e8de-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample1.aspx)]

<span data-ttu-id="6e8de-154">Affichez cette page dans un navigateur (voir figure 5).</span><span class="sxs-lookup"><span data-stu-id="6e8de-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="6e8de-155">Chacune des huit catégories est indiquée.</span><span class="sxs-lookup"><span data-stu-id="6e8de-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="6e8de-156">Les sept catégories avec `BrochurePath` valeurs ont la valeur `BrochurePath` affichée dans le BoundField respectif.</span><span class="sxs-lookup"><span data-stu-id="6e8de-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="6e8de-157">Les fruits de mer, qui ont une valeur de `NULL` pour ses `BrochurePath`, affichent une cellule vide.</span><span class="sxs-lookup"><span data-stu-id="6e8de-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>

<span data-ttu-id="6e8de-158">[![chaque nom, description et valeur BrochurePath de chaque catégorie est indiqué](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span></span>

<span data-ttu-id="6e8de-159">**Figure 5**: chaque nom de catégorie, Description et `BrochurePath` valeur est listé ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span></span>

<span data-ttu-id="6e8de-160">Au lieu d’afficher le texte de la colonne `BrochurePath`, nous voulons créer un lien vers la brochure.</span><span class="sxs-lookup"><span data-stu-id="6e8de-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="6e8de-161">Pour ce faire, supprimez le `BrochurePath` BoundField et remplacez-le par un HyperLinkField.</span><span class="sxs-lookup"><span data-stu-id="6e8de-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="6e8de-162">Affectez à la nouvelle propriété HyperLinkField s `HeaderText` la valeur brochure, à sa propriété `Text` la valeur afficher la brochure et à la propriété `DataNavigateUrlFields` la valeur `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>

![Ajouter un HyperLinkField pour BrochurePath](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.gif)

<span data-ttu-id="6e8de-164">**Figure 6**: ajouter un HyperLinkField pour `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="6e8de-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>

<span data-ttu-id="6e8de-165">Cette opération ajoute une colonne de liens au GridView, comme le montre la figure 7.</span><span class="sxs-lookup"><span data-stu-id="6e8de-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="6e8de-166">Le fait de cliquer sur un lien Afficher la brochure permet d’afficher le fichier PDF directement dans le navigateur ou de demander à l’utilisateur de télécharger le fichier, selon qu’un lecteur PDF est installé et les paramètres du navigateur.</span><span class="sxs-lookup"><span data-stu-id="6e8de-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>

<span data-ttu-id="6e8de-167">[![une brochure de catégorie s peut être affichée en cliquant sur le lien Afficher la brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span></span>

<span data-ttu-id="6e8de-168">**Figure 7**: une brochure catégorie s peut être affichée en cliquant sur le lien Afficher la brochure ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span></span>

<span data-ttu-id="6e8de-169">[![le fichier PDF de la brochure catégorie s s’affiche](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span></span>

<span data-ttu-id="6e8de-170">**Figure 8**: affichage du fichier PDF de la brochure catégorie s ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span></span>

## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="6e8de-171">Masquage du texte afficher la brochure pour les catégories sans brochure</span><span class="sxs-lookup"><span data-stu-id="6e8de-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="6e8de-172">Comme illustré à la figure 7, le `BrochurePath` HyperLinkField affiche sa valeur de propriété `Text` (afficher la brochure) pour tous les enregistrements, qu’il y ait une valeur non`NULL` pour `BrochurePath`ou non.</span><span class="sxs-lookup"><span data-stu-id="6e8de-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="6e8de-173">Bien entendu, si `BrochurePath` est `NULL`, le lien est affiché sous forme de texte uniquement, comme c’est le cas avec la catégorie Food (reportez-vous à la figure 7).</span><span class="sxs-lookup"><span data-stu-id="6e8de-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="6e8de-174">Au lieu d’afficher la brochure de l’affichage de texte, il peut être intéressant de faire en sorte que ces catégories n’affichent pas `BrochurePath` de texte de remplacement, comme aucune brochure disponible.</span><span class="sxs-lookup"><span data-stu-id="6e8de-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="6e8de-175">Pour fournir ce comportement, nous devons utiliser un TemplateField dont le contenu est généré via un appel à une méthode de page qui émet la sortie appropriée en fonction de la valeur de `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="6e8de-176">Nous avons d’abord abordé cette technique de mise en forme dans le didacticiel [utilisation de TemplateFields dans le contrôle GridView](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="6e8de-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial.</span></span>

<span data-ttu-id="6e8de-177">Transformez le HyperLinkField en TemplateField en sélectionnant le `BrochurePath` HyperLinkField, puis en cliquant sur le lien convertir ce champ en TemplateField dans la boîte de dialogue Modifier les colonnes.</span><span class="sxs-lookup"><span data-stu-id="6e8de-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>

![Convertir le HyperLinkField en TemplateField](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.gif)

<span data-ttu-id="6e8de-179">**Figure 9**: convertir le HyperLinkField en TemplateField</span><span class="sxs-lookup"><span data-stu-id="6e8de-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>

<span data-ttu-id="6e8de-180">Cela créera un TemplateField avec un `ItemTemplate` qui contient un contrôle Web HYPERLINK dont la propriété `NavigateUrl` est liée à la valeur `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="6e8de-181">Remplacez ce balisage par un appel à la méthode `GenerateBrochureLink`, en passant la valeur de `BrochurePath`:</span><span class="sxs-lookup"><span data-stu-id="6e8de-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample2.aspx)]

<span data-ttu-id="6e8de-182">Ensuite, créez une méthode `protected` dans la classe code-behind ASP.NET page s nommée `GenerateBrochureLink` qui retourne un `string` et qui accepte un `object` comme paramètre d’entrée.</span><span class="sxs-lookup"><span data-stu-id="6e8de-182">Next, create a `protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `string` and accepts an `object` as an input parameter.</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample3.cs)]

<span data-ttu-id="6e8de-183">Cette méthode détermine si la valeur `object` passée est une base de données `NULL` et, le cas échéant, retourne un message indiquant que la catégorie n’a pas de brochure.</span><span class="sxs-lookup"><span data-stu-id="6e8de-183">This method determines if the passed-in `object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="6e8de-184">Sinon, s’il existe une valeur `BrochurePath`, elle s’affiche dans un lien hypertexte.</span><span class="sxs-lookup"><span data-stu-id="6e8de-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="6e8de-185">Notez que si la valeur `BrochurePath` est présente, elle est transmise dans la [méthode`ResolveUrl(url)`](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span><span class="sxs-lookup"><span data-stu-id="6e8de-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="6e8de-186">Cette méthode résout l' *URL*passée, en remplaçant le caractère `~` par le chemin d’accès virtuel approprié.</span><span class="sxs-lookup"><span data-stu-id="6e8de-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="6e8de-187">Par exemple, si l’application est enracinée à `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` retourne `/Tutorial55/Brochures/Meat.pdf`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="6e8de-188">La figure 10 montre la page après que ces modifications ont été appliquées.</span><span class="sxs-lookup"><span data-stu-id="6e8de-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="6e8de-189">Notez que le champ `BrochurePath` des catégories de produits de la mer contient maintenant le texte aucune brochure disponible.</span><span class="sxs-lookup"><span data-stu-id="6e8de-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>

<span data-ttu-id="6e8de-190">[![le texte aucune brochure disponible ne s’affiche pour ces catégories sans brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span></span>

<span data-ttu-id="6e8de-191">**Figure 10**: le texte aucune brochure disponible s’affiche pour ces catégories sans brochure ([cliquez pour afficher l’image en plein écran](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span></span>

## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="6e8de-192">Étape 3 : ajout d’une page Web pour afficher une image de catégorie</span><span class="sxs-lookup"><span data-stu-id="6e8de-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="6e8de-193">Lorsqu’un utilisateur visite une page ASP.NET, il reçoit le code HTML de la page ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6e8de-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="6e8de-194">Le code HTML reçu est simplement du texte et ne contient pas de données binaires.</span><span class="sxs-lookup"><span data-stu-id="6e8de-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="6e8de-195">Toutes les données binaires supplémentaires, telles que les images, les fichiers audio, les applications Macromedia Flash, les vidéos Windows Media Player incorporées, etc., existent en tant que ressources distinctes sur le serveur Web.</span><span class="sxs-lookup"><span data-stu-id="6e8de-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="6e8de-196">Le code HTML contient des références à ces fichiers, mais il n’inclut pas le contenu réel des fichiers.</span><span class="sxs-lookup"><span data-stu-id="6e8de-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="6e8de-197">Par exemple, en HTML, l’élément `<img>` est utilisé pour référencer une image, avec l’attribut `src` qui pointe vers le fichier image comme suit :</span><span class="sxs-lookup"><span data-stu-id="6e8de-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>

[!code-html[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample4.html)]

<span data-ttu-id="6e8de-198">Quand un navigateur reçoit ce code HTML, il envoie une autre demande au serveur Web pour récupérer le contenu binaire du fichier image, qu’il affiche ensuite dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="6e8de-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="6e8de-199">Le même concept s’applique à toutes les données binaires.</span><span class="sxs-lookup"><span data-stu-id="6e8de-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="6e8de-200">À l’étape 2, la brochure n’a pas été envoyée au navigateur dans le cadre du balisage HTML de la page.</span><span class="sxs-lookup"><span data-stu-id="6e8de-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="6e8de-201">Au lieu de cela, le HTML rendu fournissait des liens hypertexte qui, lorsque vous cliquez dessus, ont fait en sorte que le navigateur demande le document PDF directement.</span><span class="sxs-lookup"><span data-stu-id="6e8de-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="6e8de-202">Pour afficher ou autoriser les utilisateurs à télécharger des données binaires qui résident dans la base de données, nous devons créer une page Web distincte qui retourne les données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="6e8de-203">Pour notre application, il n’y a qu’un seul champ de données binaires stocké directement dans la base de données de l’image de la catégorie.</span><span class="sxs-lookup"><span data-stu-id="6e8de-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="6e8de-204">Par conséquent, nous avons besoin d’une page qui, lorsqu’elle est appelée, retourne les données d’image pour une catégorie particulière.</span><span class="sxs-lookup"><span data-stu-id="6e8de-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="6e8de-205">Ajoutez une nouvelle page ASP.NET au dossier `BinaryData` nommé `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="6e8de-206">Quand vous procédez ainsi, n’activez pas la case à cocher sélectionner une page maître.</span><span class="sxs-lookup"><span data-stu-id="6e8de-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="6e8de-207">Cette page attend une valeur `CategoryID` dans QueryString et retourne les données binaires de cette catégorie `Picture` colonne.</span><span class="sxs-lookup"><span data-stu-id="6e8de-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="6e8de-208">Étant donné que cette page retourne des données binaires et rien d’autre, elle n’a besoin d’aucun balisage dans la section HTML.</span><span class="sxs-lookup"><span data-stu-id="6e8de-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="6e8de-209">Par conséquent, cliquez sur l’onglet source dans le coin inférieur gauche et supprimez tout le balisage de la page, à l’exception de la directive `<%@ Page %>`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="6e8de-210">Autrement dit, `DisplayCategoryPicture.aspx` le balisage déclaratif doit se composer d’une seule ligne :</span><span class="sxs-lookup"><span data-stu-id="6e8de-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample5.aspx)]

<span data-ttu-id="6e8de-211">Si vous voyez l’attribut `MasterPageFile` dans la directive `<%@ Page %>`, supprimez-le.</span><span class="sxs-lookup"><span data-stu-id="6e8de-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="6e8de-212">Dans la classe code-behind de la page, ajoutez le code suivant au gestionnaire d’événements `Page_Load` :</span><span class="sxs-lookup"><span data-stu-id="6e8de-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample6.cs)]

<span data-ttu-id="6e8de-213">Ce code commence par lire la valeur QueryString `CategoryID` dans une variable nommée `categoryID`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="6e8de-214">Ensuite, les données de l’image sont récupérées via un appel à la méthode `CategoriesBLL` classe s `GetCategoryWithBinaryDataByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="6e8de-215">Ces données sont retournées au client à l’aide de la méthode `Response.BinaryWrite(data)`, mais avant que cette méthode soit appelée, l’en-tête OLE de la valeur de colonne `Picture` s doit être supprimé.</span><span class="sxs-lookup"><span data-stu-id="6e8de-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="6e8de-216">Pour ce faire, vous devez créer un tableau `byte` nommé `strippedImageData` qui contiendra précisément 78 caractères inférieurs à ceux de la colonne `Picture`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-216">This is accomplished by creating a `byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="6e8de-217">La [méthode`Array.Copy`](https://msdn.microsoft.com/library/z50k9bft.aspx) est utilisée pour copier les données à partir de `category.Picture` en commençant à la position 78 sur `strippedImageData`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="6e8de-218">La propriété `Response.ContentType` spécifie le [type MIME](http://en.wikipedia.org/wiki/MIME) du contenu renvoyé afin que le navigateur sache comment le restituer.</span><span class="sxs-lookup"><span data-stu-id="6e8de-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="6e8de-219">Étant donné que la colonne `Categories` table s `Picture` est une image bitmap, le type MIME bitmap est utilisé ici (image/BMP).</span><span class="sxs-lookup"><span data-stu-id="6e8de-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="6e8de-220">Si vous omettez le type MIME, la plupart des navigateurs affichent toujours l’image correctement, car ils peuvent déduire le type en fonction du contenu des données binaires du fichier image.</span><span class="sxs-lookup"><span data-stu-id="6e8de-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="6e8de-221">Toutefois, il est prudent d’inclure le type MIME lorsque cela est possible.</span><span class="sxs-lookup"><span data-stu-id="6e8de-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="6e8de-222">Pour obtenir la liste complète des [types de média MIME](http://www.iana.org/assignments/media-types/), consultez le [site Web de l’autorité de certification Internet Assigned Numbers](http://www.iana.org/) .</span><span class="sxs-lookup"><span data-stu-id="6e8de-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="6e8de-223">Une fois cette page créée, une image particulière des catégories peut être affichée en visitant `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="6e8de-224">La figure 11 montre l’image des catégories de boissons, que vous pouvez afficher à partir de `DisplayCategoryPicture.aspx?CategoryID=1`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>

<span data-ttu-id="6e8de-225">[![l’image de la catégorie boissons est affichée](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span></span>

<span data-ttu-id="6e8de-226">**Figure 11**: l’image de la catégorie boissons s s’affiche ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span></span>

<span data-ttu-id="6e8de-227">Si, lors de la visite `DisplayCategoryPicture.aspx?CategoryID=categoryID`, vous obtenez une exception qui empêche le cast d’un objet de type’System. DBNull’en type’System. Byte [] ', il y a deux choses qui peuvent être à l’origine de ce problème.</span><span class="sxs-lookup"><span data-stu-id="6e8de-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="6e8de-228">Tout d’abord, la colonne `Categories` table s `Picture` autorise les valeurs `NULL`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="6e8de-229">La page `DisplayCategoryPicture.aspx`, cependant, suppose qu’il y a une valeur non`NULL` présente.</span><span class="sxs-lookup"><span data-stu-id="6e8de-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="6e8de-230">La propriété `Picture` du `CategoriesDataTable` ne peut pas être directement accessible si elle a une valeur de `NULL`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="6e8de-231">Si vous ne souhaitez pas autoriser `NULL` valeurs pour la colonne `Picture`, vous devez inclure la condition suivante :</span><span class="sxs-lookup"><span data-stu-id="6e8de-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>

[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample7.cs)]

<span data-ttu-id="6e8de-232">Le code ci-dessus suppose que certains fichiers image nommés `NoPictureAvailable.gif` dans le dossier `Images` que vous souhaitez afficher pour ces catégories sans image.</span><span class="sxs-lookup"><span data-stu-id="6e8de-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="6e8de-233">Cette exception peut également se produire si l’instruction `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` méthode s `SELECT` est revenue à la liste des colonnes de la requête principale, ce qui peut se produire si vous utilisez des instructions SQL ad hoc et que vous exécutez à nouveau l’Assistant pour la requête principale du TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="6e8de-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="6e8de-234">Vérifiez que `GetCategoryWithBinaryDataByCategoryID` méthode s `SELECT` contient toujours la colonne `Picture`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="6e8de-235">Chaque fois que la `DisplayCategoryPicture.aspx` est visitée, la base de données est accédée et les données d’image des catégories spécifiées sont retournées.</span><span class="sxs-lookup"><span data-stu-id="6e8de-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="6e8de-236">Toutefois, si l’image de la catégorie n’a pas changé depuis la dernière consultation de l’utilisateur, l’effort est perdu.</span><span class="sxs-lookup"><span data-stu-id="6e8de-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="6e8de-237">Heureusement, le protocole HTTP permet d' *obtenir des inconditionnels*.</span><span class="sxs-lookup"><span data-stu-id="6e8de-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="6e8de-238">Avec un accès conditionnel, le client qui effectue la requête HTTP envoie le long d’un [en-tête http`If-Modified-Since`](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) qui fournit la date et l’heure auxquelles le client a récupéré la dernière fois cette ressource à partir du serveur Web.</span><span class="sxs-lookup"><span data-stu-id="6e8de-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="6e8de-239">Si le contenu n’a pas été modifié depuis la date spécifiée, le serveur Web peut répondre avec un [code d’État non modifié (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) et renoncer à renvoyer le contenu des ressources demandées.</span><span class="sxs-lookup"><span data-stu-id="6e8de-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="6e8de-240">En bref, cette technique évite au serveur Web d’avoir à renvoyer le contenu d’une ressource s’il n’a pas été modifié depuis le dernier accès au client.</span><span class="sxs-lookup"><span data-stu-id="6e8de-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>

<span data-ttu-id="6e8de-241">Toutefois, pour implémenter ce comportement, vous devez ajouter une colonne `PictureLastModified` à la table `Categories` pour capturer la dernière mise à jour de la colonne `Picture`, ainsi que le code permettant de vérifier l’en-tête `If-Modified-Since`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="6e8de-242">Pour plus d’informations sur l’en-tête `If-Modified-Since` et le flux de travail d’extraction conditionnel, consultez la page obtenir une requête HTTP [conditionnelle pour les pirates RSS](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) et [un examen plus approfondi sur l’exécution de requêtes http dans une page ASP.net](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="6e8de-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="6e8de-243">Étape 4 : affichage des images de catégorie dans un GridView</span><span class="sxs-lookup"><span data-stu-id="6e8de-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="6e8de-244">Maintenant que nous disposons d’une page Web pour afficher une image particulière des catégories, nous pouvons l’afficher à l’aide du [contrôle image Web](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) ou d’un élément `<img>` html pointant vers `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="6e8de-245">Les images dont l’URL est déterminée par les données de la base de données peuvent être affichées dans le contrôle GridView ou DetailsView à l’aide de ImageField.</span><span class="sxs-lookup"><span data-stu-id="6e8de-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="6e8de-246">ImageField contient des propriétés `DataImageUrlField` et `DataImageUrlFormatString` qui fonctionnent comme les propriétés HyperLinkField s `DataNavigateUrlFields` et `DataNavigateUrlFormatString`.</span><span class="sxs-lookup"><span data-stu-id="6e8de-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="6e8de-247">Nous allons ajouter le `Categories` GridView dans `DisplayOrDownloadData.aspx` en ajoutant un ImageField pour afficher chaque image de catégorie.</span><span class="sxs-lookup"><span data-stu-id="6e8de-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="6e8de-248">Ajoutez simplement le ImageField et définissez ses propriétés `DataImageUrlField` et `DataImageUrlFormatString` sur `CategoryID` et `DisplayCategoryPicture.aspx?CategoryID={0}`, respectivement.</span><span class="sxs-lookup"><span data-stu-id="6e8de-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="6e8de-249">Cela permet de créer une colonne GridView qui restitue un élément `<img>` dont l’attribut `src` fait référence à `DisplayCategoryPicture.aspx?CategoryID={0}`, où {0} est remplacé par la valeur `CategoryID` de la ligne GridView.</span><span class="sxs-lookup"><span data-stu-id="6e8de-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>

![Ajouter un ImageField au GridView](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.gif)

<span data-ttu-id="6e8de-251">**Figure 12**: ajouter un ImageField au GridView</span><span class="sxs-lookup"><span data-stu-id="6e8de-251">**Figure 12**: Add an ImageField to the GridView</span></span>

<span data-ttu-id="6e8de-252">Après avoir ajouté le ImageField, la syntaxe déclarative de GridView s doit ressembler à la suivante :</span><span class="sxs-lookup"><span data-stu-id="6e8de-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample8.aspx)]

<span data-ttu-id="6e8de-253">Prenez un moment pour afficher cette page par le biais d’un navigateur.</span><span class="sxs-lookup"><span data-stu-id="6e8de-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="6e8de-254">Notez comment chaque enregistrement comprend désormais une image pour la catégorie.</span><span class="sxs-lookup"><span data-stu-id="6e8de-254">Note how each record now includes a picture for the category.</span></span>

<span data-ttu-id="6e8de-255">[![l’image des catégories s’affiche pour chaque ligne](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6e8de-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span></span>

<span data-ttu-id="6e8de-256">**Figure 13**: l’image des catégories s’affiche pour chaque ligne ([cliquez pour afficher l’image en taille réelle](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="6e8de-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span></span>

## <a name="summary"></a><span data-ttu-id="6e8de-257">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="6e8de-257">Summary</span></span>

<span data-ttu-id="6e8de-258">Dans ce didacticiel, nous avons examiné comment présenter des données binaires.</span><span class="sxs-lookup"><span data-stu-id="6e8de-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="6e8de-259">Le mode de présentation des données dépend du type de données.</span><span class="sxs-lookup"><span data-stu-id="6e8de-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="6e8de-260">Pour les fichiers de la brochure PDF, nous avons proposé à l’utilisateur un lien Afficher la brochure qui, lorsque vous cliquez dessus, a pris l’utilisateur directement dans le fichier PDF.</span><span class="sxs-lookup"><span data-stu-id="6e8de-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="6e8de-261">Pour l’image des catégories, nous avons d’abord créé une page pour récupérer et retourner les données binaires de la base de données, puis utilisé cette page pour afficher chaque image de catégorie dans un GridView.</span><span class="sxs-lookup"><span data-stu-id="6e8de-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="6e8de-262">Maintenant que nous avons vu comment afficher des données binaires, nous sommes prêts à examiner comment effectuer des insertions, des mises à jour et des suppressions sur la base de données avec les données binaires.</span><span class="sxs-lookup"><span data-stu-id="6e8de-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="6e8de-263">Dans le didacticiel suivant, nous allons examiner comment associer un fichier chargé à son enregistrement de base de données correspondant.</span><span class="sxs-lookup"><span data-stu-id="6e8de-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="6e8de-264">Dans ce didacticiel, nous verrons comment mettre à jour les données binaires existantes et comment supprimer les données binaires lorsque l’enregistrement qui lui est associé est supprimé.</span><span class="sxs-lookup"><span data-stu-id="6e8de-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="6e8de-265">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="6e8de-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6e8de-266">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="6e8de-266">About the Author</span></span>

<span data-ttu-id="6e8de-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="6e8de-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6e8de-268">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="6e8de-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6e8de-269">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="6e8de-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6e8de-270">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6e8de-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="6e8de-271">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="6e8de-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6e8de-272">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="6e8de-272">Special Thanks To</span></span>

<span data-ttu-id="6e8de-273">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="6e8de-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6e8de-274">Les réviseurs de leads pour ce didacticiel étaient Teresa Murphy et Dave Gardner.</span><span class="sxs-lookup"><span data-stu-id="6e8de-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="6e8de-275">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="6e8de-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6e8de-276">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6e8de-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6e8de-277">[Précédent](uploading-files-cs.md)
> [Suivant](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span><span class="sxs-lookup"><span data-stu-id="6e8de-277">[Previous](uploading-files-cs.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span></span>
