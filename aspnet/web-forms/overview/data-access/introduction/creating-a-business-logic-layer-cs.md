---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Création d’une couche de logique métier (c#) | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous allons voir comment centraliser vos règles d’entreprise dans une couche BLL (Business Logic) qui sert d’intermédiaire pour l’échange de données entre t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: fd3bf46394f562462c561bf06370d2f372e47d0a
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59415261"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="3186d-103">Création d’une couche de logique métier (C#)</span><span class="sxs-lookup"><span data-stu-id="3186d-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="3186d-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3186d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3186d-105">[Télécharger l’exemple d’application](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) ou [télécharger le PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3186d-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="3186d-106">Dans ce didacticiel, nous allons voir comment centraliser vos règles d’entreprise dans une couche BLL (Business Logic) qui sert d’intermédiaire pour l’échange de données entre la couche de présentation et la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="3186d-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="3186d-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="3186d-107">Introduction</span></span>

<span data-ttu-id="3186d-108">La couche DAL (Data Access) est créé dans le [premier didacticiel](creating-a-data-access-layer-cs.md) sépare correctement les données d’accès logique à partir de la logique de présentation.</span><span class="sxs-lookup"><span data-stu-id="3186d-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="3186d-109">Toutefois, alors que la couche DAL sépare les détails d’accès aux données à partir de la couche de présentation, il n’applique pas les règles d’entreprise qui peuvent s’appliquer.</span><span class="sxs-lookup"><span data-stu-id="3186d-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="3186d-110">Par exemple, pour notre application nous souhaiterons peut-être interdire la `CategoryID` ou `SupplierID` champs de la `Products` table d’être modifiées lorsque le `Discontinued` champ est défini sur 1, ou nous pourrions appliquer des règles d’ancienneté, interdisant les situations dans lesquelles un employé est géré par une personne qui a été embauchés après leur.</span><span class="sxs-lookup"><span data-stu-id="3186d-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="3186d-111">Un autre scénario courant est d’autorisation peut-être seuls les utilisateurs dans un rôle particulier peuvent supprimer des produits ou peuvent modifier le `UnitPrice` valeur.</span><span class="sxs-lookup"><span data-stu-id="3186d-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="3186d-112">Dans ce didacticiel, nous allons voir comment centraliser ces règles d’entreprise dans une couche BLL (Business Logic) qui sert d’intermédiaire pour l’échange de données entre la couche de présentation et la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="3186d-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="3186d-113">Dans une application réelle, la couche BLL doit être implémentée comme un projet de bibliothèque de classes distinct ; Toutefois, pour ces didacticiels, nous allons implémenter la couche BLL comme une série de classes dans notre `App_Code` dossier afin de simplifier la structure de projet.</span><span class="sxs-lookup"><span data-stu-id="3186d-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="3186d-114">La figure 1 illustre les relations architecturales entre la couche de présentation, BLL et DAL.</span><span class="sxs-lookup"><span data-stu-id="3186d-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![La couche BLL sépare la couche de présentation de la couche d’accès aux données et impose des règles d’entreprise](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="3186d-116">**Figure 1**: La couche BLL sépare la couche de présentation de la couche d’accès aux données et impose des règles d’entreprise</span><span class="sxs-lookup"><span data-stu-id="3186d-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="3186d-117">Étape 1 : Création des Classes de couche de logique métier</span><span class="sxs-lookup"><span data-stu-id="3186d-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="3186d-118">Notre BLL est composée de quatre classes, une pour chaque TableAdapter dans la couche DAL ; chacune de ces classes de la couche BLL aura des méthodes pour récupérer, insertion, mise à jour et si vous supprimez le TableAdapter respectif dans la couche DAL, en appliquant les règles métier appropriée.</span><span class="sxs-lookup"><span data-stu-id="3186d-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="3186d-119">Pour plus de proprement séparer les classes liées BLL et DAL, nous allons créer deux sous-dossiers dans le `App_Code` dossier, `DAL` et `BLL`.</span><span class="sxs-lookup"><span data-stu-id="3186d-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="3186d-120">Simplement avec le bouton droit sur le `App_Code` dossier dans l’Explorateur de solutions et choisissez Nouveau dossier.</span><span class="sxs-lookup"><span data-stu-id="3186d-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="3186d-121">Après avoir créé ces deux dossiers, déplacer le DataSet typé créé dans le premier didacticiel dans le `DAL` sous-dossier.</span><span class="sxs-lookup"><span data-stu-id="3186d-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="3186d-122">Ensuite, créez les quatre fichiers de classe de couche de logique métier dans le `BLL` sous-dossier.</span><span class="sxs-lookup"><span data-stu-id="3186d-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="3186d-123">Pour ce faire, cliquez sur le `BLL` sous-dossier, choisissez Ajouter un nouvel élément, puis choisissez le modèle de classe.</span><span class="sxs-lookup"><span data-stu-id="3186d-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="3186d-124">Nommez les quatre classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, et `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="3186d-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Ajoutez quatre nouvelles Classes dans le dossier App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="3186d-126">**Figure 2**: Ajoutez quatre nouvelles Classes pour la `App_Code` dossier</span><span class="sxs-lookup"><span data-stu-id="3186d-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="3186d-127">Ensuite, nous allons ajouter des méthodes pour chacune des classes simplement d’intégrer les méthodes définies pour les TableAdapters dans le premier didacticiel.</span><span class="sxs-lookup"><span data-stu-id="3186d-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="3186d-128">Pour l’instant, ces méthodes simplement appelle directement dans la couche DAL ; Nous allons retourner par la suite pour ajouter une logique métier nécessaire.</span><span class="sxs-lookup"><span data-stu-id="3186d-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="3186d-129">Si vous utilisez Visual Studio Standard Edition ou ultérieur (autrement dit, vous êtes *pas* à l’aide de Visual Web Developer), vous pouvez éventuellement concevoir vos classes visuellement à l’aide de la [Concepteur de classes](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="3186d-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="3186d-130">Reportez-vous à la [classe concepteur Blog](https://blogs.msdn.com/classdesigner/default.aspx) pour plus d’informations sur cette nouvelle fonctionnalité dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="3186d-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="3186d-131">Pour le `ProductsBLL` nous devons ajouter un total de sept méthodes de classe :</span><span class="sxs-lookup"><span data-stu-id="3186d-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="3186d-132">`GetProducts()` Retourne tous les produits</span><span class="sxs-lookup"><span data-stu-id="3186d-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="3186d-133">`GetProductByProductID(productID)` Retourne le produit avec l’ID de produit spécifié</span><span class="sxs-lookup"><span data-stu-id="3186d-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="3186d-134">`GetProductsByCategoryID(categoryID)` Retourne tous les produits à partir de la catégorie spécifiée</span><span class="sxs-lookup"><span data-stu-id="3186d-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="3186d-135">`GetProductsBySupplier(supplierID)` Retourne tous les produits du fournisseur spécifié</span><span class="sxs-lookup"><span data-stu-id="3186d-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="3186d-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` Insère un nouveau produit dans la base de données en utilisant les valeurs passées dans ; Retourne le `ProductID` valeur de l’enregistrement qui vient d’être inséré.</span><span class="sxs-lookup"><span data-stu-id="3186d-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="3186d-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` met à jour un produit existant dans la base de données en utilisant les valeurs passées dans ; Retourne `true` si précisément une ligne a été mis à jour, `false` sinon</span><span class="sxs-lookup"><span data-stu-id="3186d-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="3186d-138">`DeleteProduct(productID)` Supprime le produit spécifié à partir de la base de données</span><span class="sxs-lookup"><span data-stu-id="3186d-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="3186d-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="3186d-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="3186d-140">Les méthodes qui retournent des données `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, et `GetProductBySuppliersID` sont assez simples car ils appellent simplement vers le bas dans la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="3186d-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="3186d-141">Bien que dans certains scénarios il peut y avoir des règles d’entreprise qui doivent être implémentées à ce niveau (par exemple, les règles d’autorisation en fonction de l’utilisateur actuellement connecté ou le rôle auquel appartient l’utilisateur), nous laisserons simplement ces méthodes en tant que-est.</span><span class="sxs-lookup"><span data-stu-id="3186d-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="3186d-142">Pour ces méthodes, puis, la couche BLL sert simplement un proxy via lequel la couche de présentation accède aux données sous-jacentes à partir de la couche d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="3186d-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="3186d-143">Le `AddProduct` et `UpdateProduct` méthodes à la fois prendre en tant que paramètres, les valeurs pour les différents champs de produit et ajouter un nouveau produit ou mettre à jour une existante, respectivement.</span><span class="sxs-lookup"><span data-stu-id="3186d-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="3186d-144">Depuis de nombreuses le `Product` les colonnes de la table peuvent accepter `NULL` valeurs (`CategoryID`, `SupplierID`, et `UnitPrice`, pour citer que quelques), les paramètres d’entrée pour `AddProduct` et `UpdateProduct` qui correspondent à une telle utilisation de colonnes [types nullable](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="3186d-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="3186d-145">Types Nullable débutez avec .NET 2.0 et fournir une technique de qui indique si un type valeur doit, au lieu de cela, être `null`.</span><span class="sxs-lookup"><span data-stu-id="3186d-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="3186d-146">En c#, vous pouvez marquer un type valeur comme un type nullable en ajoutant `?` après le type (comme `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="3186d-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="3186d-147">Reportez-vous à la [Types Nullable](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section dans le [Guide de programmation c#](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="3186d-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="3186d-148">Les trois méthodes retournent une valeur booléenne indiquant si une ligne a été insérée, mise à jour ou supprimée, car l’opération peut ne pas entraîne une ligne concernée.</span><span class="sxs-lookup"><span data-stu-id="3186d-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="3186d-149">Par exemple, si le développeur de pages appelle `DeleteProduct` en passant un `ProductID` pour un produit inexistante, la `DELETE` instruction émise à la base de données n’a aucun effet et par conséquent le `DeleteProduct` méthode retournera `false`.</span><span class="sxs-lookup"><span data-stu-id="3186d-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="3186d-150">Notez que lorsque vous ajoutez un nouveau produit ou de la mise à jour un nous prendre les valeurs du produit nouveau ou modifié des champs comme une liste de valeurs scalaires par opposition à accepter un `ProductsRow` instance.</span><span class="sxs-lookup"><span data-stu-id="3186d-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="3186d-151">Cette approche a été choisie, car le `ProductsRow` classe dérive de ADO.NET `DataRow` (classe), qui n’a pas de constructeur sans paramètre par défaut.</span><span class="sxs-lookup"><span data-stu-id="3186d-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="3186d-152">Pour créer un nouveau `ProductsRow` instance, nous devons d’abord créer un `ProductsDataTable` de l’instance, puis appelez ses `NewProductRow()` (méthode) (ce que nous faisons `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="3186d-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="3186d-153">Cet inconvénient élevant sa tête lorsque nous tourner vers insertion et mise à jour de produits à l’aide de l’ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="3186d-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="3186d-154">En bref, ObjectDataSource tente de créer une instance des paramètres d’entrée.</span><span class="sxs-lookup"><span data-stu-id="3186d-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="3186d-155">Si la méthode de la couche BLL attend un `ProductsRow` instance, ObjectDataSource tente de créer un, mais échouer en raison du manque d’un constructeur sans paramètre par défaut.</span><span class="sxs-lookup"><span data-stu-id="3186d-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="3186d-156">Pour plus d’informations sur ce problème, consultez les publications de Forums ASP.NET deux suivantes : [La mise à jour de ObjectDataSources avec fortement typée DataSets](https://forums.asp.net/1098630/ShowPost.aspx), et [problème lié à ObjectDataSource et DataSet fortement typée](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="3186d-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="3186d-157">Ensuite, dans les deux `AddProduct` et `UpdateProduct`, le code crée un `ProductsRow` de l’instance et le remplit avec les valeurs passées simplement.</span><span class="sxs-lookup"><span data-stu-id="3186d-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="3186d-158">Lors de l’affectation de valeurs à celui de DataColumns d’un DataRow plusieurs vérifications de validation au niveau du champ peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="3186d-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="3186d-159">Par conséquent, remettre manuellement les valeurs transmises dans un DataRow permet de garantir la validité des données transmises à la méthode de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="3186d-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="3186d-160">Malheureusement les classes de DataRow fortement typé générés par Visual Studio n’utilisent pas les types nullable.</span><span class="sxs-lookup"><span data-stu-id="3186d-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="3186d-161">Au lieu de cela, pour indiquer qu’une colonne de données particulière dans un DataRow doit correspondre à un `NULL` de base de données de valeur, nous devons utiliser le `SetColumnNameNull()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="3186d-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="3186d-162">Dans `UpdateProduct` nous charger tout d’abord dans le produit pour mettre à jour à l’aide de `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="3186d-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="3186d-163">Bien que cela puisse sembler un aller-retour inutile à la base de données, ce trajet supplémentaire s’avère utile dans les futures didacticiels qui explorent l’accès concurrentiel optimiste.</span><span class="sxs-lookup"><span data-stu-id="3186d-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="3186d-164">L’accès concurrentiel optimiste est une technique pour vous assurer que deux utilisateurs qui travaillent simultanément sur les mêmes données écraser accidentellement les modifications par un autre.</span><span class="sxs-lookup"><span data-stu-id="3186d-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="3186d-165">En saisissant l’enregistrement complet rend également plus facile de créer des méthodes de mise à jour dans la couche BLL qui modifient uniquement un sous-ensemble de colonnes de DataRow.</span><span class="sxs-lookup"><span data-stu-id="3186d-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="3186d-166">Lorsque nous explorons les `SuppliersBLL` nous verrons un exemple de ce type de classe.</span><span class="sxs-lookup"><span data-stu-id="3186d-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="3186d-167">Enfin, notez que le `ProductsBLL` classe a le [attribut DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) appliquée (la `[System.ComponentModel.DataObject]` syntaxe juste avant l’instruction de classe vers le haut du fichier) et les méthodes ont [ Les attributs DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="3186d-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="3186d-168">Le `DataObject` attribut marque la classe comme étant un objet pouvant être lié à un [contrôle ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), tandis que le `DataObjectMethodAttribute` indique l’objectif de la méthode.</span><span class="sxs-lookup"><span data-stu-id="3186d-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="3186d-169">Nous verrons dans un avenir didacticiels, ObjectDataSource d’ASP.NET 2.0 rend plus facile de façon déclarative accéder aux données à partir d’une classe.</span><span class="sxs-lookup"><span data-stu-id="3186d-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="3186d-170">Pour aider à filtrer la liste des classes possibles à lier dans l’Assistant de l’ObjectDataSource, par défaut uniquement les classes marquées comme `DataObjects` figurent dans la liste déroulante de l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="3186d-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="3186d-171">Le `ProductsBLL` classe fonctionnera aussi bien sans ces attributs, mais ajouter rend plus facile à utiliser dans l’Assistant de l’ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="3186d-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="3186d-172">Ajout d’autres Classes</span><span class="sxs-lookup"><span data-stu-id="3186d-172">Adding the Other Classes</span></span>

<span data-ttu-id="3186d-173">Avec la `ProductsBLL` classe complète, nous avons besoin ajouter des classes pour l’utilisation des catégories, les fournisseurs et les employés.</span><span class="sxs-lookup"><span data-stu-id="3186d-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="3186d-174">Prenez un moment pour créer les classes et les concepts de l’exemple ci-dessus d’à l’aide des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="3186d-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="3186d-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="3186d-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="3186d-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="3186d-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="3186d-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="3186d-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="3186d-178">La méthode à noter est la `SuppliersBLL` la classe `UpdateSupplierAddress` (méthode).</span><span class="sxs-lookup"><span data-stu-id="3186d-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="3186d-179">Cette méthode fournit une interface pour la mise à jour uniquement les informations d’adresse du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="3186d-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="3186d-180">En interne, cette méthode lit dans le `SupplierDataRow` objet spécifié `supplierID` (à l’aide de `GetSupplierBySupplierID`), définit ses propriétés liées aux adresses et appelle ensuite vers le bas dans la `SupplierDataTable`de `Update` (méthode).</span><span class="sxs-lookup"><span data-stu-id="3186d-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="3186d-181">Le `UpdateSupplierAddress` méthode suit :</span><span class="sxs-lookup"><span data-stu-id="3186d-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="3186d-182">Reportez-vous au téléchargement de cet article pour mon implémentation complète de classes de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="3186d-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="3186d-183">Étape 2 : L’accès à des groupes de données typés via les Classes de la couche BLL</span><span class="sxs-lookup"><span data-stu-id="3186d-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="3186d-184">Dans le premier didacticiel nous avons cité des exemples de travailler directement avec le DataSet typé par programmation, mais avec l’ajout de nos classes de la couche BLL, la couche de présentation doit fonctionner par rapport à la couche BLL à la place.</span><span class="sxs-lookup"><span data-stu-id="3186d-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="3186d-185">Dans le `AllProducts.aspx` exemple à partir du premier didacticiel, le `ProductsTableAdapter` a été utilisée pour lier la liste des produits à un GridView, comme indiqué dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="3186d-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="3186d-186">Pour utiliser la couche BLL de nouvelles classes, tout cela doit être modifiée est la première ligne de code suffit de remplacer le `ProductsTableAdapter` de l’objet avec un `ProductBLL` objet :</span><span class="sxs-lookup"><span data-stu-id="3186d-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="3186d-187">Les classes de la couche BLL sont également accessible déclarative (comme vous pouvez le DataSet typé) à l’aide de l’ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="3186d-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="3186d-188">Nous allons aborder l’ObjectDataSource plus en détail dans les didacticiels suivants.</span><span class="sxs-lookup"><span data-stu-id="3186d-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="3186d-189">[![La liste de produits s’affiche dans un GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="3186d-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="3186d-190">**Figure 3**: La liste de produits s’affiche dans un GridView ([cliquez pour afficher l’image en taille réelle](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="3186d-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="3186d-191">Étape 3 : Ajout d’une Validation au niveau du champ pour les Classes de DataRow</span><span class="sxs-lookup"><span data-stu-id="3186d-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="3186d-192">Validation au niveau du champ sont les vérifications relatives aux valeurs de propriété des objets métier pendant l’insertion ou la mise à jour.</span><span class="sxs-lookup"><span data-stu-id="3186d-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="3186d-193">Certaines règles de validation au niveau du champ pour les produits sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="3186d-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="3186d-194">Le `ProductName` champ doit être de 40 caractères ou moins</span><span class="sxs-lookup"><span data-stu-id="3186d-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="3186d-195">Le `QuantityPerUnit` champ doit être de 20 caractères ou moins</span><span class="sxs-lookup"><span data-stu-id="3186d-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="3186d-196">Le `ProductID`, `ProductName`, et `Discontinued` champs sont obligatoires, mais tous les autres champs sont facultatifs</span><span class="sxs-lookup"><span data-stu-id="3186d-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="3186d-197">Le `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, et `ReorderLevel` champs doivent être supérieure ou égale à zéro</span><span class="sxs-lookup"><span data-stu-id="3186d-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="3186d-198">Ces règles peuvent et doivent être exprimés au niveau de la base de données.</span><span class="sxs-lookup"><span data-stu-id="3186d-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="3186d-199">La limite de caractères sur la `ProductName` et `QuantityPerUnit` champs sont capturées par les types de données de ces colonnes dans le `Products` table (`nvarchar(40)` et `nvarchar(20)`, respectivement).</span><span class="sxs-lookup"><span data-stu-id="3186d-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="3186d-200">Si les champs sont obligatoires et facultatifs sont exprimées par si la colonne de table de base de données autorise `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="3186d-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="3186d-201">Quatre [contraintes check](https://msdn.microsoft.com/library/ms188258.aspx) existe, visant à garantir que seules les valeurs supérieures ou égales à zéro peuvent rendre dans le `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, ou `ReorderLevel` colonnes.</span><span class="sxs-lookup"><span data-stu-id="3186d-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="3186d-202">En plus en appliquant ces règles à la base de données qu’ils doivent également être appliquées au niveau du jeu de données.</span><span class="sxs-lookup"><span data-stu-id="3186d-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="3186d-203">En fait, la longueur de champ et si une valeur est obligatoire ou facultatif sont déjà capturés pour l’ensemble de chaque DataTable de DataColumns.</span><span class="sxs-lookup"><span data-stu-id="3186d-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="3186d-204">Pour afficher la validation au niveau du champ existante fournie automatiquement, accédez au Concepteur de DataSet, sélectionnez un champ à partir d’une des tables et puis accédez à la fenêtre Propriétés.</span><span class="sxs-lookup"><span data-stu-id="3186d-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="3186d-205">Comme le montre la Figure 4, le `QuantityPerUnit` DataColumn dans le `ProductsDataTable` a une longueur maximale de 20 caractères et autorise `NULL` valeurs.</span><span class="sxs-lookup"><span data-stu-id="3186d-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="3186d-206">Si vous tentez de définir la `ProductsDataRow`de `QuantityPerUnit` propriété une valeur de chaîne plue de 20 caractères un `ArgumentException` sera levée.</span><span class="sxs-lookup"><span data-stu-id="3186d-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="3186d-207">[![Le DataColumn fournit une Validation au niveau du champ de base](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="3186d-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="3186d-208">**Figure 4**: Le DataColumn fournit au niveau du champ Validation de base ([cliquez pour afficher l’image en taille réelle](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="3186d-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="3186d-209">Malheureusement, nous ne pouvons pas spécifier les vérifications des limites, telles que la `UnitPrice` valeur doit être supérieure ou égale à zéro, via la fenêtre Propriétés.</span><span class="sxs-lookup"><span data-stu-id="3186d-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="3186d-210">Pour fournir ce type de validation au niveau du champ que nous avons besoin créer un gestionnaire d’événements pour le DataTable [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) événement.</span><span class="sxs-lookup"><span data-stu-id="3186d-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="3186d-211">Comme mentionné dans le [didacticiel précédent](creating-a-data-access-layer-cs.md), les objets DataSet, DataTables et DataRow créés par le DataSet typé peuvent être étendus via l’utilisation des classes partielles.</span><span class="sxs-lookup"><span data-stu-id="3186d-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="3186d-212">À l’aide de cette technique, nous pouvons créer un `ColumnChanging` Gestionnaire d’événements pour le `ProductsDataTable` classe.</span><span class="sxs-lookup"><span data-stu-id="3186d-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="3186d-213">Commencez par créer une classe dans le `App_Code` dossier nommé `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="3186d-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="3186d-214">[![Ajoutez une nouvelle classe dans le dossier App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="3186d-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="3186d-215">**Figure 5**: Ajoutez une nouvelle classe à la `App_Code` dossier ([cliquez pour afficher l’image en taille réelle](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="3186d-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="3186d-216">Ensuite, créez un gestionnaire d’événements pour le `ColumnChanging` événement qui garantit que le `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, et `ReorderLevel` les valeurs de colonne (si ce n’est pas `NULL`) sont supérieurs ou égaux à zéro.</span><span class="sxs-lookup"><span data-stu-id="3186d-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="3186d-217">Si une telle colonne est hors limites, lever une `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="3186d-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="3186d-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="3186d-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="3186d-219">Étape 4 : Ajout de règles d’entreprise personnalisées pour les Classes de la couche BLL</span><span class="sxs-lookup"><span data-stu-id="3186d-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="3186d-220">En plus de la validation au niveau du champ, il peut exister des règles d’entreprise personnalisées haut niveau qui impliquent des entités différentes ou des concepts ne pouvant pas être exprimées au niveau de la colonne unique, tel que :</span><span class="sxs-lookup"><span data-stu-id="3186d-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="3186d-221">Si un produit a été supprimé, son `UnitPrice` ne peut pas être mis à jour</span><span class="sxs-lookup"><span data-stu-id="3186d-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="3186d-222">Pays d’un employé de résidence doit être le même que le pays de son gestionnaire de résidence</span><span class="sxs-lookup"><span data-stu-id="3186d-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="3186d-223">Un produit ne peut pas être supprimé s’il s’agit du seul produit fourni par le fournisseur</span><span class="sxs-lookup"><span data-stu-id="3186d-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="3186d-224">Les classes de la couche BLL doivent contenir des vérifications pour assurer la conformité aux règles d’entreprise de l’application.</span><span class="sxs-lookup"><span data-stu-id="3186d-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="3186d-225">Ces vérifications peuvent être ajoutées directement aux méthodes auquel elles s’appliquent.</span><span class="sxs-lookup"><span data-stu-id="3186d-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="3186d-226">Imaginez que notre entreprise déterminée par les règles qu’un produit pas pu être marqué supprimée s’il s’agissait du seul produit à partir d’un fournisseur donné.</span><span class="sxs-lookup"><span data-stu-id="3186d-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="3186d-227">Autrement dit, si produit *X* a été le seul produit nous achetés à partir du fournisseur *Y*, nous ne pouvons pas marquer *X* comme interrompue ; si, toutefois, fournisseur *Y*nous fourni avec trois produits, *A*, *B*, et *C*, puis nous aurions pu marquer tout et tous ces éléments comme abandonné.</span><span class="sxs-lookup"><span data-stu-id="3186d-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="3186d-228">Une règle d’entreprise impair, mais les règles d’entreprise et le bon sens ne sont pas alignées toujours !</span><span class="sxs-lookup"><span data-stu-id="3186d-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="3186d-229">Pour appliquer cette règle d’entreprise dans le `UpdateProducts` méthode nous démarre en vérifiant si `Discontinued` a été défini sur `true` et, si par conséquent, nous devrions appeler `GetProductsBySupplierID` pour déterminer combien de produits que nous avons acheté à partir de ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="3186d-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="3186d-230">Si seul un produit acheté à partir de ce fournisseur, nous levons une `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="3186d-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="3186d-231">Répondre aux erreurs de Validation dans la couche de présentation</span><span class="sxs-lookup"><span data-stu-id="3186d-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="3186d-232">Lors de l’appel de la couche BLL à partir de la couche de présentation que nous pouvons décider tenter de gérer les exceptions qui peuvent être déclenchées ou leur permettent de se propagent dans ASP.NET (ce qui déclenche la `HttpApplication`de `Error` événement).</span><span class="sxs-lookup"><span data-stu-id="3186d-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="3186d-233">Pour gérer une exception lorsque vous travaillez par programmation de la couche BLL, nous pouvons utiliser un [try... catch](https://msdn.microsoft.com/library/0yd65esw.aspx) bloc, comme le montre l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="3186d-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="3186d-234">Comme nous le verrons dans un avenir didacticiels, gestion des exceptions qui se propagent de la couche BLL lors de l’utilisation de données Web de contrôle pour l’insertion, la mise à jour, ou la suppression des données peut être gérée directement dans un gestionnaire d’événements au lieu d’avoir à la ligne de code dans `try...catch` blocs.</span><span class="sxs-lookup"><span data-stu-id="3186d-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="3186d-235">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="3186d-235">Summary</span></span>

<span data-ttu-id="3186d-236">Une application bien conçue est judicieusement de couches distinctes, chacune encapsule un rôle particulier.</span><span class="sxs-lookup"><span data-stu-id="3186d-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="3186d-237">Dans le premier didacticiel de cette série d’articles, nous avons créé une couche d’accès aux données à l’aide de données typés ; Dans ce didacticiel nous intégrée une couche de logique métier en tant que série de classes de notre application `App_Code` dossier appel descendant dans notre DAL.</span><span class="sxs-lookup"><span data-stu-id="3186d-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="3186d-238">La couche BLL implémente la logique au niveau du champ et de niveau entreprise pour notre application.</span><span class="sxs-lookup"><span data-stu-id="3186d-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="3186d-239">Outre la création d’une couche de logique métier distinct, comme nous l’avons fait dans ce didacticiel, une autre option consiste à étendre les méthodes des TableAdapters via l’utilisation des classes partielles.</span><span class="sxs-lookup"><span data-stu-id="3186d-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="3186d-240">Toutefois, à l’aide de cette technique ne permet pas de substituer des méthodes existantes, ni il sépare notre DAL et notre BLL comme correctement en tant que l’approche que nous avons pris dans cet article.</span><span class="sxs-lookup"><span data-stu-id="3186d-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="3186d-241">Avec la couche DAL et de la couche BLL terminée, nous sommes prêts à démarrer sur notre couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="3186d-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="3186d-242">Dans le [didacticiel suivant](master-pages-and-site-navigation-cs.md) nous allons prendre un bref détour à partir des rubriques d’accès aux données et définir une disposition de page cohérente à utiliser dans les didacticiels.</span><span class="sxs-lookup"><span data-stu-id="3186d-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="3186d-243">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="3186d-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="3186d-244">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="3186d-244">About the Author</span></span>

<span data-ttu-id="3186d-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept les livres sur ASP/ASP.NET et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="3186d-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3186d-246">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="3186d-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3186d-247">Son dernier ouvrage est [*SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="3186d-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3186d-248">Il peut être contacté à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3186d-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="3186d-249">ou via son blog, qui se trouve à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="3186d-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="3186d-250">Remerciements</span><span class="sxs-lookup"><span data-stu-id="3186d-250">Special Thanks To</span></span>

<span data-ttu-id="3186d-251">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="3186d-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3186d-252">Les réviseurs tête pour ce didacticiel ont été Liz Shulok, Dennis Patterson, Carlos Santos et Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="3186d-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="3186d-253">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="3186d-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3186d-254">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3186d-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3186d-255">[Précédent](creating-a-data-access-layer-cs.md)
> [Suivant](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="3186d-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
