---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-vb
title: Création d’une couche d’accès aux données (VB) | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous allons commencer par le tout début et créer la couche d’accès aux données (DAL), à l’aide de DataSets typés, pour accéder aux informations d’une base de données.
ms.author: riande
ms.date: 04/05/2010
ms.assetid: 6227233a-6254-4b6b-9a89-947efef22330
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-vb
msc.type: authoredcontent
ms.openlocfilehash: 51c9255f80f83a68cf26decf318347752498491a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74635138"
---
# <a name="creating-a-data-access-layer-vb"></a><span data-ttu-id="30265-103">Création d’une couche d’accès aux données (VB)</span><span class="sxs-lookup"><span data-stu-id="30265-103">Creating a Data Access Layer (VB)</span></span>

<span data-ttu-id="30265-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="30265-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="30265-105">[Télécharger l’exemple d’application](https://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_1_VB.exe) ou [Télécharger le PDF](creating-a-data-access-layer-vb/_static/datatutorial01vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="30265-105">[Download Sample App](https://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_1_VB.exe) or [Download PDF](creating-a-data-access-layer-vb/_static/datatutorial01vb1.pdf)</span></span>

> <span data-ttu-id="30265-106">Dans ce didacticiel, nous allons commencer par le tout début et créer la couche d’accès aux données (DAL), à l’aide de DataSets typés, pour accéder aux informations d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>

## <a name="introduction"></a><span data-ttu-id="30265-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="30265-107">Introduction</span></span>

<span data-ttu-id="30265-108">En tant que développeurs Web, notre vie repose sur l’utilisation des données.</span><span class="sxs-lookup"><span data-stu-id="30265-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="30265-109">Nous créons des bases de données pour stocker les données, le code pour les récupérer et les modifier, et les pages Web pour les collecter et les résumer.</span><span class="sxs-lookup"><span data-stu-id="30265-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="30265-110">Il s’agit du premier didacticiel d’une série longue qui explore les techniques permettant d’implémenter ces modèles courants dans ASP.NET 2,0.</span><span class="sxs-lookup"><span data-stu-id="30265-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="30265-111">Nous allons commencer par créer une [architecture logicielle](http://en.wikipedia.org/wiki/Software_architecture) composée d’une couche d’accès aux données (DAL) à l’aide de datasets typés, d’une couche de logique métier (BLL) qui applique des règles métier personnalisées et d’une couche de présentation composée de pages ASP.net qui partagent une disposition de page commune.</span><span class="sxs-lookup"><span data-stu-id="30265-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="30265-112">Une fois ce serveur principal posé, nous passerons à la création de rapports, en indiquant comment afficher, synthétiser, collecter et valider les données à partir d’une application Web.</span><span class="sxs-lookup"><span data-stu-id="30265-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="30265-113">Ces didacticiels sont destinés à être concis et fournissent des instructions pas à pas avec de nombreuses captures d’écran pour vous guider tout au long du processus.</span><span class="sxs-lookup"><span data-stu-id="30265-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="30265-114">Chaque Didacticiel est disponible dans C# et Visual Basic versions et comprend un téléchargement du code complet utilisé.</span><span class="sxs-lookup"><span data-stu-id="30265-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="30265-115">(Ce premier didacticiel est assez long, mais le reste est présenté dans des blocs beaucoup plus digestibles.)</span><span class="sxs-lookup"><span data-stu-id="30265-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="30265-116">Pour ces didacticiels, nous allons utiliser une version Microsoft SQL Server 2005 Express Edition de la base de données Northwind placée dans le répertoire `App_Data`.</span><span class="sxs-lookup"><span data-stu-id="30265-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the `App_Data` directory.</span></span> <span data-ttu-id="30265-117">En plus du fichier de base de données, le dossier `App_Data` contient également les scripts SQL pour la création de la base de données, au cas où vous souhaiteriez utiliser une version de base de données différente.</span><span class="sxs-lookup"><span data-stu-id="30265-117">In addition to the database file, the `App_Data` folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="30265-118">Vous pouvez également télécharger ces scripts [directement à partir de Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), si vous préférez.</span><span class="sxs-lookup"><span data-stu-id="30265-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="30265-119">Si vous utilisez une version de SQL Server différente de la base de données Northwind, vous devez mettre à jour le paramètre `NORTHWNDConnectionString` dans le fichier `Web.config` de l’application.</span><span class="sxs-lookup"><span data-stu-id="30265-119">If you use a different SQL Server version of the Northwind database, you will need to update the `NORTHWNDConnectionString` setting in the application's `Web.config` file.</span></span> <span data-ttu-id="30265-120">L’application Web a été créée à l’aide de Visual Studio 2005 Professional Edition comme un projet de site Web basé sur un système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="30265-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="30265-121">Toutefois, tous les didacticiels fonctionnent aussi bien avec la version gratuite de Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span><span class="sxs-lookup"><span data-stu-id="30265-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>

<span data-ttu-id="30265-122">Dans ce didacticiel, nous allons commencer par le tout début et créer la couche d’accès aux données (DAL), puis créer la [couche de logique métier (BLL)](creating-a-business-logic-layer-vb.md) dans le deuxième didacticiel et travailler sur la [mise en page et la navigation](master-pages-and-site-navigation-vb.md) dans la troisième.</span><span class="sxs-lookup"><span data-stu-id="30265-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the [Business Logic Layer (BLL)](creating-a-business-logic-layer-vb.md) in the second tutorial, and working on [page layout and navigation](master-pages-and-site-navigation-vb.md) in the third.</span></span> <span data-ttu-id="30265-123">Les didacticiels qui suivent le troisième s’appuient sur les fondations posées dans les trois premières.</span><span class="sxs-lookup"><span data-stu-id="30265-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="30265-124">Nous avons beaucoup à aborder dans ce premier didacticiel, donc à démarrer Visual Studio et à commencer !</span><span class="sxs-lookup"><span data-stu-id="30265-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="30265-125">Étape 1 : création d’un projet Web et connexion à la base de données</span><span class="sxs-lookup"><span data-stu-id="30265-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="30265-126">Avant de pouvoir créer notre couche d’accès aux données (DAL), nous devons tout d’abord créer un site Web et configurer notre base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="30265-127">Commencez par créer un site Web ASP.NET basé sur un système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="30265-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="30265-128">Pour ce faire, accédez au menu fichier et sélectionnez Nouveau site Web, en affichant la boîte de dialogue Nouveau site Web.</span><span class="sxs-lookup"><span data-stu-id="30265-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="30265-129">Choisissez le modèle de site Web ASP.NET, définissez la liste déroulante emplacement sur système de fichiers, choisissez un dossier pour placer le site Web et définissez la langue sur Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="30265-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to Visual Basic.</span></span>

<span data-ttu-id="30265-130">[![créer un site Web basé sur un système de fichiers](creating-a-data-access-layer-vb/_static/image2.png)](creating-a-data-access-layer-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="30265-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-vb/_static/image2.png)](creating-a-data-access-layer-vb/_static/image1.png)</span></span>

<span data-ttu-id="30265-131">**Figure 1**: créer un site Web basé sur un système de fichiers ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="30265-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image3.png))</span></span>

<span data-ttu-id="30265-132">Cela permet de créer un nouveau site Web avec une `Default.aspx` page ASP.NET, un dossier `App_Data` et un fichier `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="30265-132">This will create a new web site with a `Default.aspx` ASP.NET page, an `App_Data` folder, and a `Web.config` file.</span></span>

<span data-ttu-id="30265-133">Une fois le site Web créé, l’étape suivante consiste à ajouter une référence à la base de données dans le Explorateur de serveurs de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="30265-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="30265-134">En ajoutant une base de données au Explorateur de serveurs vous pouvez ajouter des tables, des procédures stockées, des vues, et ainsi de suite dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="30265-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="30265-135">Vous pouvez également afficher des données de table ou créer vos propres requêtes à la main ou graphiquement par le biais de l’Générateur de requêtes.</span><span class="sxs-lookup"><span data-stu-id="30265-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="30265-136">En outre, lorsque nous créons les DataSets typés pour la couche DAL, nous devrons pointer Visual Studio vers la base de données à partir de laquelle les DataSets typés doivent être construits.</span><span class="sxs-lookup"><span data-stu-id="30265-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="30265-137">Nous pouvons fournir ces informations de connexion à ce moment-là, mais Visual Studio remplit automatiquement une liste déroulante des bases de données déjà inscrites dans le Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="30265-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="30265-138">Les étapes d’ajout de la base de données Northwind au Explorateur de serveurs varient selon que vous souhaitez utiliser la base de données SQL Server 2005 Express Edition dans le dossier `App_Data` ou si vous souhaitez utiliser à la place une installation du serveur de base de données Microsoft SQL Server 2000 ou 2005.</span><span class="sxs-lookup"><span data-stu-id="30265-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the `App_Data` folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-theapp_datafolder"></a><span data-ttu-id="30265-139">Utilisation d’une base de données dans le dossier`App_Data`</span><span class="sxs-lookup"><span data-stu-id="30265-139">Using a Database in the`App_Data`Folder</span></span>

<span data-ttu-id="30265-140">Si vous ne disposez pas d’un serveur de base de données SQL Server 2000 ou 2005 pour vous connecter à, ou si vous souhaitez simplement éviter d’avoir à ajouter la base de données à un serveur de base de données, vous pouvez utiliser la version SQL Server 2005 Express Edition de la base de données Northwind qui se trouve dans le dossier d' `App_Data` du site Web téléchargé (`NORTHWND.MDF`).</span><span class="sxs-lookup"><span data-stu-id="30265-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's `App_Data` folder (`NORTHWND.MDF`).</span></span>

<span data-ttu-id="30265-141">Une base de données placée dans le dossier `App_Data` est automatiquement ajoutée au Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="30265-141">A database placed in the `App_Data` folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="30265-142">En supposant que vous avez SQL Server 2005 Express Edition installé sur votre ordinateur, vous devez voir un nœud nommé fichier NORTHWND. MDF dans le Explorateur de serveurs, qui vous permet de développer et d’explorer ses tables, vues, procédures stockées, etc. (voir figure 2).</span><span class="sxs-lookup"><span data-stu-id="30265-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="30265-143">Le dossier `App_Data` peut également contenir des fichiers `.mdb` Microsoft Access, qui, comme leurs SQL Server équivalents, sont automatiquement ajoutés au Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="30265-143">The `App_Data` folder can also hold Microsoft Access `.mdb` files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="30265-144">Si vous ne souhaitez pas utiliser l’une des options de SQL Server, vous pouvez toujours [Télécharger une version Microsoft Access du fichier de base de données Northwind](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) et la placer dans le répertoire `App_Data`.</span><span class="sxs-lookup"><span data-stu-id="30265-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the `App_Data` directory.</span></span> <span data-ttu-id="30265-145">Gardez toutefois à l’esprit que les bases de données Access ne sont pas aussi riches en fonctionnalités que SQL Server et ne sont pas conçues pour être utilisées dans les scénarios de site Web.</span><span class="sxs-lookup"><span data-stu-id="30265-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="30265-146">En outre, quelques-uns des 35 didacticiels utiliseront certaines fonctionnalités de niveau base de données qui ne sont pas prises en charge par Access.</span><span class="sxs-lookup"><span data-stu-id="30265-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="30265-147">Connexion à la base de données dans un serveur de base de données Microsoft SQL Server 2000 ou 2005</span><span class="sxs-lookup"><span data-stu-id="30265-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="30265-148">Vous pouvez également vous connecter à une base de données Northwind installée sur un serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="30265-149">Si la base de données Northwind n’est pas encore installée sur le serveur de base de données, vous devez d’abord l’ajouter au serveur de base de données en exécutant le script d’installation inclus dans le téléchargement de ce didacticiel ou en [téléchargeant la version 2000 de Northwind et SQL Server le script d’installation](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directement à partir du site Web de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="30265-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="30265-150">Une fois la base de données installée, accédez au Explorateur de serveurs dans Visual Studio, cliquez avec le bouton droit sur le nœud Connexions de données, puis choisissez Ajouter une connexion.</span><span class="sxs-lookup"><span data-stu-id="30265-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="30265-151">Si vous ne voyez pas la Explorateur de serveurs accédez à la vue/Explorateur de serveurs ou appuyez sur Ctrl + Alt + S.</span><span class="sxs-lookup"><span data-stu-id="30265-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="30265-152">La boîte de dialogue Ajouter une connexion s’affiche, dans laquelle vous pouvez spécifier le serveur auquel vous souhaitez vous connecter, les informations d’authentification et le nom de la base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="30265-153">Une fois que vous avez correctement configuré les informations de connexion à la base de données et cliqué sur le bouton OK, la base de données est ajoutée en tant que nœud sous le nœud Connexions de données.</span><span class="sxs-lookup"><span data-stu-id="30265-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="30265-154">Vous pouvez développer le nœud de base de données pour explorer ses tables, vues, procédures stockées, etc.</span><span class="sxs-lookup"><span data-stu-id="30265-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>

![Ajouter une connexion à la base de données Northwind de votre serveur de base de données](creating-a-data-access-layer-vb/_static/image4.png)

<span data-ttu-id="30265-156">**Figure 2**: ajouter une connexion à la base de données Northwind de votre serveur de base de données</span><span class="sxs-lookup"><span data-stu-id="30265-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>

## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="30265-157">Étape 2 : création de la couche d’accès aux données</span><span class="sxs-lookup"><span data-stu-id="30265-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="30265-158">Lorsque vous utilisez des données, une option consiste à incorporer la logique spécifique aux données directement dans la couche de présentation (dans une application Web, les pages ASP.NET constituent la couche de présentation).</span><span class="sxs-lookup"><span data-stu-id="30265-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="30265-159">Cela peut prendre la forme d’écrire du code ADO.NET dans la partie de code de la page ASP.NET ou à l’aide du contrôle SqlDataSource à partir de la partie du balisage.</span><span class="sxs-lookup"><span data-stu-id="30265-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="30265-160">Dans les deux cas, cette approche couple étroitement la logique d’accès aux données à la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="30265-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="30265-161">Toutefois, l’approche recommandée consiste à séparer la logique d’accès aux données de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="30265-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="30265-162">Cette couche distincte est appelée couche d’accès aux données, DAL pour Short, et est généralement implémentée en tant que projet de bibliothèque de classes distinct.</span><span class="sxs-lookup"><span data-stu-id="30265-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="30265-163">Les avantages de cette architecture en couches sont bien documentés (reportez-vous à la section « lectures supplémentaires » à la fin de ce didacticiel pour plus d’informations sur ces avantages) et c’est l’approche que nous allons suivre dans cette série.</span><span class="sxs-lookup"><span data-stu-id="30265-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="30265-164">Tout le code spécifique à la source de données sous-jacente, par exemple créer une connexion à la base de données, émettre `SELECT`, `INSERT`, `UPDATE`et `DELETE` des commandes, etc., doit se trouver dans la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="30265-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing `SELECT`, `INSERT`, `UPDATE`, and `DELETE` commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="30265-165">La couche de présentation ne doit pas contenir de références à ce code d’accès aux données, mais doit à la place effectuer des appels dans la couche DAL pour toutes les requêtes de données.</span><span class="sxs-lookup"><span data-stu-id="30265-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="30265-166">Les couches d’accès aux données contiennent généralement des méthodes permettant d’accéder aux données de la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="30265-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="30265-167">Par exemple, la base de données Northwind a `Products` et `Categories` des tables qui enregistrent les produits à la vente et les catégories auxquelles elles appartiennent.</span><span class="sxs-lookup"><span data-stu-id="30265-167">The Northwind database, for example, has `Products` and `Categories` tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="30265-168">Dans notre DAL, nous disposons de méthodes telles que :</span><span class="sxs-lookup"><span data-stu-id="30265-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="30265-169">`GetCategories(),` qui retournera des informations sur toutes les catégories</span><span class="sxs-lookup"><span data-stu-id="30265-169">`GetCategories(),` which will return information about all of the categories</span></span>
- <span data-ttu-id="30265-170">`GetProducts()`, qui renverra des informations sur tous les produits</span><span class="sxs-lookup"><span data-stu-id="30265-170">`GetProducts()`, which will return information about all of the products</span></span>
- <span data-ttu-id="30265-171">`GetProductsByCategoryID(categoryID)`, qui retournera tous les produits appartenant à une catégorie spécifiée</span><span class="sxs-lookup"><span data-stu-id="30265-171">`GetProductsByCategoryID(categoryID)`, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="30265-172">`GetProductByProductID(productID)`, qui renverra des informations sur un produit particulier</span><span class="sxs-lookup"><span data-stu-id="30265-172">`GetProductByProductID(productID)`, which will return information about a particular product</span></span>

<span data-ttu-id="30265-173">Ces méthodes, lorsqu’elles sont appelées, se connectent à la base de données, émettent la requête appropriée et retournent les résultats.</span><span class="sxs-lookup"><span data-stu-id="30265-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="30265-174">La façon dont nous retournons ces résultats est importante.</span><span class="sxs-lookup"><span data-stu-id="30265-174">How we return these results is important.</span></span> <span data-ttu-id="30265-175">Ces méthodes peuvent simplement retourner un jeu de données ou un DataReader rempli par la requête de base de données, mais dans l’idéal, ces résultats doivent être retournés à l’aide d' *objets fortement typés*.</span><span class="sxs-lookup"><span data-stu-id="30265-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="30265-176">Un objet fortement typé est un objet dont le schéma est défini de façon rigide au moment de la compilation, tandis que l’inverse, un objet faiblement typé, est un objet dont le schéma n’est pas connu jusqu’à l’exécution.</span><span class="sxs-lookup"><span data-stu-id="30265-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="30265-177">Par exemple, le DataReader et le DataSet (par défaut) sont des objets faiblement typés, car leur schéma est défini par les colonnes retournées par la requête de base de données utilisée pour les remplir.</span><span class="sxs-lookup"><span data-stu-id="30265-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="30265-178">Pour accéder à une colonne particulière à partir d’un DataTable faiblement typé, nous devons utiliser une syntaxe comme : `DataTable.Rows(index)("columnName")`.</span><span class="sxs-lookup"><span data-stu-id="30265-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: `DataTable.Rows(index)("columnName")`.</span></span> <span data-ttu-id="30265-179">Le typage libre du DataTable dans cet exemple est présenté par le fait que nous devons accéder au nom de colonne à l’aide d’un index de chaîne ou d’un index ordinal.</span><span class="sxs-lookup"><span data-stu-id="30265-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="30265-180">En revanche, un DataTable fortement typé aura chacune de ses colonnes implémentée en tant que propriétés, ce qui entraînera un code similaire à celui-ci : `DataTable.Rows(index).columnName`.</span><span class="sxs-lookup"><span data-stu-id="30265-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: `DataTable.Rows(index).columnName`.</span></span>

<span data-ttu-id="30265-181">Pour retourner des objets fortement typés, les développeurs peuvent créer leurs propres objets métier personnalisés ou utiliser des DataSets typés.</span><span class="sxs-lookup"><span data-stu-id="30265-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="30265-182">Un objet métier est implémenté par le développeur sous la forme d’une classe dont les propriétés reflètent généralement les colonnes de la table de base de données sous-jacente représentée par l’objet métier.</span><span class="sxs-lookup"><span data-stu-id="30265-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="30265-183">Un DataSet typé est une classe générée par Visual Studio, basée sur un schéma de base de données et dont les membres sont fortement typés en fonction de ce schéma.</span><span class="sxs-lookup"><span data-stu-id="30265-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="30265-184">Le DataSet typé se compose de classes qui étendent les classes DataSet, DataTable et DataRow ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="30265-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="30265-185">En plus des DataTables fortement typés, les DataSets typés incluent désormais également les TableAdapters, qui sont des classes avec des méthodes permettant de remplir les DataTables du DataSet et de propager les modifications dans les DataTables vers la base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="30265-186">Pour plus d’informations sur les avantages et les inconvénients de l’utilisation de DataSets typés par rapport à des objets métier personnalisés, consultez conception de composants de la [couche données et transmission de données à travers des niveaux](https://msdn.microsoft.com/library/ms978496.aspx).</span><span class="sxs-lookup"><span data-stu-id="30265-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>

<span data-ttu-id="30265-187">Nous utiliserons des DataSets fortement typés pour l’architecture de ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="30265-188">La figure 3 illustre le flux de travail entre les différentes couches d’une application qui utilise des DataSets typés.</span><span class="sxs-lookup"><span data-stu-id="30265-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>

<span data-ttu-id="30265-189">[![tous les codes d’accès aux données sont relégués à la couche DAL](creating-a-data-access-layer-vb/_static/image6.png)](creating-a-data-access-layer-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="30265-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-vb/_static/image6.png)](creating-a-data-access-layer-vb/_static/image5.png)</span></span>

<span data-ttu-id="30265-190">**Figure 3**: tous les codes d’accès aux données sont relégués à la couche DAL ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="30265-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image7.png))</span></span>

## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="30265-191">Création d’un DataSet typé et d’un adaptateur de table</span><span class="sxs-lookup"><span data-stu-id="30265-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="30265-192">Pour commencer à créer notre couche DAL, nous commençons par ajouter un DataSet typé à notre projet.</span><span class="sxs-lookup"><span data-stu-id="30265-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="30265-193">Pour ce faire, cliquez avec le bouton droit sur le nœud du projet dans la Explorateur de solutions et choisissez Ajouter un nouvel élément.</span><span class="sxs-lookup"><span data-stu-id="30265-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="30265-194">Sélectionnez l’option DataSet dans la liste des modèles et nommez-la `Northwind.xsd`.</span><span class="sxs-lookup"><span data-stu-id="30265-194">Select the DataSet option from the list of templates and name it `Northwind.xsd`.</span></span>

<span data-ttu-id="30265-195">[![choisissez d’ajouter un nouveau jeu de données à votre projet](creating-a-data-access-layer-vb/_static/image9.png)](creating-a-data-access-layer-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="30265-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-vb/_static/image9.png)](creating-a-data-access-layer-vb/_static/image8.png)</span></span>

<span data-ttu-id="30265-196">**Figure 4**: choisir d’ajouter un nouveau jeu de données à votre projet ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="30265-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image10.png))</span></span>

<span data-ttu-id="30265-197">Après avoir cliqué sur Ajouter, lorsque vous êtes invité à ajouter le jeu de données au dossier `App_Code`, choisissez Oui.</span><span class="sxs-lookup"><span data-stu-id="30265-197">After clicking Add, when prompted to add the DataSet to the `App_Code` folder, choose Yes.</span></span> <span data-ttu-id="30265-198">Le concepteur du DataSet typé s’affiche alors et l’Assistant Configuration de TableAdapter démarre, ce qui vous permet d’ajouter votre premier TableAdapter au DataSet typé.</span><span class="sxs-lookup"><span data-stu-id="30265-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="30265-199">Un DataSet typé sert de collection fortement typée de données ; elle est composée d’instances de DataTable fortement typées, chacune d’elles étant à son tour composée d’instances DataRow fortement typées.</span><span class="sxs-lookup"><span data-stu-id="30265-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="30265-200">Nous allons créer un DataTable fortement typé pour chaque table de base de données sous-jacente que nous devons utiliser dans cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="30265-201">Commençons par créer un DataTable pour la table `Products`.</span><span class="sxs-lookup"><span data-stu-id="30265-201">Let's start with creating a DataTable for the `Products` table.</span></span>

<span data-ttu-id="30265-202">N’oubliez pas que les DataTables fortement typés n’incluent aucune information sur la façon d’accéder aux données à partir de la table de base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="30265-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="30265-203">Pour récupérer les données afin de remplir le DataTable, nous utilisons une classe TableAdapter, qui fonctionne comme la couche d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="30265-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="30265-204">Pour notre `Products` DataTable, le TableAdapter contient les méthodes `GetProducts()`, `GetProductByCategoryID(categoryID)`, etc. que nous appellerons à partir de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="30265-204">For our `Products` DataTable, the TableAdapter will contain the methods `GetProducts()`, `GetProductByCategoryID(categoryID)`, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="30265-205">Le rôle du DataTable est de servir d’objets fortement typés utilisés pour passer des données entre les couches.</span><span class="sxs-lookup"><span data-stu-id="30265-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="30265-206">L’Assistant Configuration de TableAdapter démarre en vous invitant à sélectionner la base de données à utiliser.</span><span class="sxs-lookup"><span data-stu-id="30265-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="30265-207">La liste déroulante affiche les bases de données du Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="30265-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="30265-208">Si vous n’avez pas ajouté la base de données Northwind au Explorateur de serveurs, vous pouvez cliquer sur le bouton nouvelle connexion à ce moment-là.</span><span class="sxs-lookup"><span data-stu-id="30265-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>

<span data-ttu-id="30265-209">[![choisir la base de données Northwind dans la liste déroulante](creating-a-data-access-layer-vb/_static/image12.png)](creating-a-data-access-layer-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="30265-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-vb/_static/image12.png)](creating-a-data-access-layer-vb/_static/image11.png)</span></span>

<span data-ttu-id="30265-210">**Figure 5**: choisir la base de données Northwind dans la liste déroulante ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="30265-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image13.png))</span></span>

<span data-ttu-id="30265-211">Après avoir sélectionné la base de données et cliqué sur suivant, un message vous demande si vous souhaitez enregistrer la chaîne de connexion dans le fichier de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="30265-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the `Web.config` file.</span></span> <span data-ttu-id="30265-212">En enregistrant la chaîne de connexion, vous évitez de la coder en dur dans les classes TableAdapter, ce qui simplifie les choses si les informations de chaîne de connexion changent à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="30265-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="30265-213">Si vous choisissez d’enregistrer la chaîne de connexion dans le fichier de configuration, elle est placée dans la section `<connectionStrings>`, qui peut [éventuellement être chiffrée](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) pour améliorer la sécurité ou être modifiée ultérieurement via la nouvelle page de propriétés ASP.NET 2,0 dans l’outil d’administration de l’interface utilisateur graphique IIS, ce qui est plus idéal pour les administrateurs.</span><span class="sxs-lookup"><span data-stu-id="30265-213">If you opt to save the connection string in the configuration file it's placed in the `<connectionStrings>` section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>

<span data-ttu-id="30265-214">[![enregistrer la chaîne de connexion dans Web. config](creating-a-data-access-layer-vb/_static/image15.png)](creating-a-data-access-layer-vb/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="30265-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-vb/_static/image15.png)](creating-a-data-access-layer-vb/_static/image14.png)</span></span>

<span data-ttu-id="30265-215">**Figure 6**: enregistrer la chaîne de connexion dans `Web.config` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="30265-215">**Figure 6**: Save the Connection String to `Web.config` ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image16.png))</span></span>

<span data-ttu-id="30265-216">Ensuite, nous devons définir le schéma pour le premier DataTable fortement typé et fournir la première méthode que notre TableAdapter utilisera lors du remplissage du DataSet fortement typé.</span><span class="sxs-lookup"><span data-stu-id="30265-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="30265-217">Ces deux étapes sont effectuées simultanément en créant une requête qui retourne les colonnes de la table que nous voulons voir reflétées dans notre DataTable.</span><span class="sxs-lookup"><span data-stu-id="30265-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="30265-218">À la fin de l’Assistant, nous attribuons un nom de méthode à cette requête.</span><span class="sxs-lookup"><span data-stu-id="30265-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="30265-219">Une fois cette opération effectuée, cette méthode peut être appelée à partir de notre couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="30265-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="30265-220">La méthode exécutera la requête définie et remplira un DataTable fortement typé.</span><span class="sxs-lookup"><span data-stu-id="30265-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="30265-221">Pour commencer à définir la requête SQL, nous devons d’abord indiquer comment le TableAdapter doit émettre la requête.</span><span class="sxs-lookup"><span data-stu-id="30265-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="30265-222">Nous pouvons utiliser une instruction SQL ad hoc, créer une nouvelle procédure stockée ou utiliser une procédure stockée existante.</span><span class="sxs-lookup"><span data-stu-id="30265-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="30265-223">Pour ces didacticiels, nous allons utiliser des instructions SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="30265-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="30265-224">Reportez-vous à l’article de [Brian auteur](http://briannoyes.net/), [créer une couche d’accès aux données avec le concepteur de DataSet Visual Studio 2005](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) pour obtenir un exemple d’utilisation de procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="30265-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>

<span data-ttu-id="30265-225">[![interroger les données à l’aide d’une instruction SQL ad hoc](creating-a-data-access-layer-vb/_static/image18.png)](creating-a-data-access-layer-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="30265-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-vb/_static/image18.png)](creating-a-data-access-layer-vb/_static/image17.png)</span></span>

<span data-ttu-id="30265-226">**Figure 7**: interroger les données à l’aide d’une instruction SQL ad hoc ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="30265-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image19.png))</span></span>

<span data-ttu-id="30265-227">À ce stade, nous pouvons taper la requête SQL manuellement.</span><span class="sxs-lookup"><span data-stu-id="30265-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="30265-228">Lors de la création de la première méthode dans le TableAdapter, vous souhaitez que la requête retourne les colonnes qui doivent être exprimées dans le DataTable correspondant.</span><span class="sxs-lookup"><span data-stu-id="30265-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="30265-229">Pour ce faire, nous pouvons créer une requête qui retourne toutes les colonnes et toutes les lignes de la table `Products` :</span><span class="sxs-lookup"><span data-stu-id="30265-229">We can accomplish this by creating a query that returns all columns and all rows from the `Products` table:</span></span>

<span data-ttu-id="30265-230">[![entrez la requête SQL dans la zone de texte](creating-a-data-access-layer-vb/_static/image21.png)](creating-a-data-access-layer-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="30265-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-vb/_static/image21.png)](creating-a-data-access-layer-vb/_static/image20.png)</span></span>

<span data-ttu-id="30265-231">**Figure 8**: entrez la requête SQL dans la zone de texte ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="30265-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image22.png))</span></span>

<span data-ttu-id="30265-232">Vous pouvez également utiliser la Générateur de requêtes et construire graphiquement la requête, comme illustré à la figure 9.</span><span class="sxs-lookup"><span data-stu-id="30265-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>

<span data-ttu-id="30265-233">[![créer la requête graphiquement, par le biais de l’éditeur de requête](creating-a-data-access-layer-vb/_static/image24.png)](creating-a-data-access-layer-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="30265-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-vb/_static/image24.png)](creating-a-data-access-layer-vb/_static/image23.png)</span></span>

<span data-ttu-id="30265-234">**Figure 9**: créer la requête graphiquement, par le biais de l’éditeur de requête ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="30265-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image25.png))</span></span>

<span data-ttu-id="30265-235">Après avoir créé la requête, mais avant de passer à l’écran suivant, cliquez sur le bouton Options avancées.</span><span class="sxs-lookup"><span data-stu-id="30265-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="30265-236">Dans les projets de site Web, « générer des instructions INSERT, Update et DELETE » est la seule option avancée sélectionnée par défaut. Si vous exécutez cet Assistant à partir d’une bibliothèque de classes ou d’un projet Windows, l’option utiliser l’accès concurrentiel optimiste est également sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="30265-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="30265-237">Laissez l’option « utiliser l’accès concurrentiel optimiste » désactivée pour le moment.</span><span class="sxs-lookup"><span data-stu-id="30265-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="30265-238">Nous examinerons l’accès concurrentiel optimiste dans les prochains didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-238">We'll examine optimistic concurrency in future tutorials.</span></span>

<span data-ttu-id="30265-239">[![sélectionnez uniquement l’option générer des instructions INSERT, Update et Delete](creating-a-data-access-layer-vb/_static/image27.png)](creating-a-data-access-layer-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="30265-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-vb/_static/image27.png)](creating-a-data-access-layer-vb/_static/image26.png)</span></span>

<span data-ttu-id="30265-240">**Figure 10**: sélectionner uniquement l’option générer des instructions INSERT, Update et Delete ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="30265-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image28.png))</span></span>

<span data-ttu-id="30265-241">Après avoir vérifié les options avancées, cliquez sur suivant pour passer à l’écran final.</span><span class="sxs-lookup"><span data-stu-id="30265-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="30265-242">Ici, nous sommes invités à sélectionner les méthodes à ajouter au TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="30265-243">Il existe deux modèles pour alimenter les données :</span><span class="sxs-lookup"><span data-stu-id="30265-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="30265-244">**Remplissez un DataTable** avec cette approche. une méthode est créée qui prend un DataTable comme paramètre et le remplit en fonction des résultats de la requête.</span><span class="sxs-lookup"><span data-stu-id="30265-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="30265-245">Par exemple, la classe ADO.NET DataAdapter implémente ce modèle avec sa méthode `Fill()`.</span><span class="sxs-lookup"><span data-stu-id="30265-245">The ADO.NET DataAdapter class, for example, implements this pattern with its `Fill()` method.</span></span>
- <span data-ttu-id="30265-246">**Retourner un DataTable** avec cette approche, la méthode crée et remplit le DataTable pour vous et le retourne comme valeur de retour des méthodes.</span><span class="sxs-lookup"><span data-stu-id="30265-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="30265-247">Vous pouvez faire en sorte que le TableAdapter implémente l’un ou l’autre de ces modèles.</span><span class="sxs-lookup"><span data-stu-id="30265-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="30265-248">Vous pouvez également renommer les méthodes fournies ici.</span><span class="sxs-lookup"><span data-stu-id="30265-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="30265-249">Laissez les deux cases à cocher activées, même si nous n’utiliserons le dernier modèle que dans ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="30265-250">Nous allons également renommer la méthode `GetData` plutôt générique pour `GetProducts`.</span><span class="sxs-lookup"><span data-stu-id="30265-250">Also, let's rename the rather generic `GetData` method to `GetProducts`.</span></span>

<span data-ttu-id="30265-251">Si elle est activée, la case à cocher finale, « GenerateDBDirectMethods », crée `Insert()`méthodes, `Update()`et `Delete()` pour le TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates `Insert()`, `Update()`, and `Delete()` methods for the TableAdapter.</span></span> <span data-ttu-id="30265-252">Si vous laissez cette option désactivée, toutes les mises à jour doivent être effectuées via la seule `Update()` méthode du TableAdapter, qui prend le DataSet typé, un DataTable, un DataRow unique ou un tableau de DataRows.</span><span class="sxs-lookup"><span data-stu-id="30265-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole `Update()` method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="30265-253">(Si vous avez désactivé l’option « générer des instructions INSERT, Update et Delete » dans les propriétés avancées de la figure 9, le paramètre de cette case à cocher n’a aucun effet.) Laissez cette case à cocher activée.</span><span class="sxs-lookup"><span data-stu-id="30265-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>

<span data-ttu-id="30265-254">[![modifier le nom de la méthode GetData en GetProducts](creating-a-data-access-layer-vb/_static/image30.png)](creating-a-data-access-layer-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="30265-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-vb/_static/image30.png)](creating-a-data-access-layer-vb/_static/image29.png)</span></span>

<span data-ttu-id="30265-255">**Figure 11**: remplacer le nom de la méthode `GetData` par `GetProducts` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="30265-255">**Figure 11**: Change the Method Name from `GetData` to `GetProducts` ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image31.png))</span></span>

<span data-ttu-id="30265-256">Terminez l’Assistant en cliquant sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="30265-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="30265-257">Une fois l’Assistant fermé, nous revenons au concepteur de DataSet qui affiche le DataTable que nous venons de créer.</span><span class="sxs-lookup"><span data-stu-id="30265-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="30265-258">Vous pouvez voir la liste des colonnes dans le `Products` DataTable (`ProductID`, `ProductName`, etc.), ainsi que les méthodes de l' `ProductsTableAdapter` (`Fill()` et `GetProducts()`).</span><span class="sxs-lookup"><span data-stu-id="30265-258">You can see the list of columns in the `Products` DataTable (`ProductID`, `ProductName`, and so on), as well as the methods of the `ProductsTableAdapter` (`Fill()` and `GetProducts()`).</span></span>

<span data-ttu-id="30265-259">[![les produits, DataTable et ProductsTableAdapter, ont été ajoutés au DataSet typé](creating-a-data-access-layer-vb/_static/image33.png)](creating-a-data-access-layer-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="30265-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-vb/_static/image33.png)](creating-a-data-access-layer-vb/_static/image32.png)</span></span>

<span data-ttu-id="30265-260">**Figure 12**: l' `Products` DataTable et `ProductsTableAdapter` ont été ajoutés au DataSet typé ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="30265-260">**Figure 12**: The `Products` DataTable and `ProductsTableAdapter` have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image34.png))</span></span>

<span data-ttu-id="30265-261">À ce stade, nous avons un DataSet typé avec un DataTable unique (`Northwind.Products`) et une classe DataAdapter fortement typée (`NorthwindTableAdapters.ProductsTableAdapter`) avec une méthode `GetProducts()`.</span><span class="sxs-lookup"><span data-stu-id="30265-261">At this point we have a Typed DataSet with a single DataTable (`Northwind.Products`) and a strongly-typed DataAdapter class (`NorthwindTableAdapters.ProductsTableAdapter`) with a `GetProducts()` method.</span></span> <span data-ttu-id="30265-262">Ces objets peuvent être utilisés pour accéder à une liste de tous les produits à partir d’un code tel que :</span><span class="sxs-lookup"><span data-stu-id="30265-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample1.vb)]

<span data-ttu-id="30265-263">Ce code n’a pas besoin d’écrire un peu de code spécifique à l’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="30265-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="30265-264">Nous n’avons pas eu à instancier des classes ADO.NET, nous n’avons pas besoin de faire référence à des chaînes de connexion, des requêtes SQL ou des procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="30265-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="30265-265">Au lieu de cela, le TableAdapter fournit le code d’accès aux données de bas niveau pour nous.</span><span class="sxs-lookup"><span data-stu-id="30265-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="30265-266">Chaque objet utilisé dans cet exemple est également fortement typé, ce qui permet à Visual Studio de fournir IntelliSense et la vérification de type au moment de la compilation.</span><span class="sxs-lookup"><span data-stu-id="30265-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="30265-267">Et mieux que tous les DataTables retournés par le TableAdapter peuvent être liés à des contrôles Web de données ASP.NET, tels que GridView, DetailsView, DropDownList, CheckBoxList et plusieurs autres.</span><span class="sxs-lookup"><span data-stu-id="30265-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="30265-268">L’exemple suivant illustre la liaison du DataTable retourné par la méthode `GetProducts()` à un GridView dans une simple ou trois lignes de code dans le gestionnaire d’événements `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="30265-268">The following example illustrates binding the DataTable returned by the `GetProducts()` method to a GridView in just a scant three lines of code within the `Page_Load` event handler.</span></span>

<span data-ttu-id="30265-269">AllProducts. aspx</span><span class="sxs-lookup"><span data-stu-id="30265-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-vb/samples/sample2.aspx)]

<span data-ttu-id="30265-270">AllProducts. aspx. vb</span><span class="sxs-lookup"><span data-stu-id="30265-270">AllProducts.aspx.vb</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample3.vb)]

<span data-ttu-id="30265-271">[![la liste des produits s’affiche dans un GridView](creating-a-data-access-layer-vb/_static/image36.png)](creating-a-data-access-layer-vb/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="30265-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-vb/_static/image36.png)](creating-a-data-access-layer-vb/_static/image35.png)</span></span>

<span data-ttu-id="30265-272">**Figure 13**: la liste des produits s’affiche dans un GridView ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="30265-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image37.png))</span></span>

<span data-ttu-id="30265-273">Bien que cet exemple exige que nous écrivions trois lignes de code dans le gestionnaire d’événements `Page_Load` de notre page ASP.NET, dans les prochains didacticiels, nous allons examiner comment utiliser ObjectDataSource pour récupérer de façon déclarative les données de la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="30265-273">While this example required that we write three lines of code in our ASP.NET page's `Page_Load` event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="30265-274">Avec ObjectDataSource, nous n’aurons pas à écrire de code et obtiendrons également la prise en charge de la pagination et du tri.</span><span class="sxs-lookup"><span data-stu-id="30265-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="30265-275">Étape 3 : ajout de méthodes paramétrables à la couche d’accès aux données</span><span class="sxs-lookup"><span data-stu-id="30265-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="30265-276">À ce stade, notre classe de `ProductsTableAdapter` a, mais une méthode, `GetProducts()`, qui retourne tous les produits de la base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-276">At this point our `ProductsTableAdapter` class has but one method, `GetProducts()`, which returns all of the products in the database.</span></span> <span data-ttu-id="30265-277">Bien qu’il soit très utile de pouvoir travailler avec tous les produits, il peut arriver que nous puissions récupérer des informations sur un produit spécifique ou sur tous les produits appartenant à une catégorie particulière.</span><span class="sxs-lookup"><span data-stu-id="30265-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="30265-278">Pour ajouter cette fonctionnalité à notre couche d’accès aux données, nous pouvons ajouter des méthodes paramétrables au TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="30265-279">Ajoutons la méthode `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="30265-279">Let's add the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="30265-280">Pour ajouter une nouvelle méthode à la couche DAL, revenez au concepteur de DataSet, cliquez avec le bouton droit dans la section `ProductsTableAdapter`, puis choisissez Ajouter une requête.</span><span class="sxs-lookup"><span data-stu-id="30265-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the `ProductsTableAdapter` section, and choose Add Query.</span></span>

![Cliquez avec le bouton droit sur le TableAdapter, puis choisissez Ajouter une requête.](creating-a-data-access-layer-vb/_static/image38.png)

<span data-ttu-id="30265-282">**Figure 14**: cliquez avec le bouton droit sur le TableAdapter, puis choisissez Ajouter une requête.</span><span class="sxs-lookup"><span data-stu-id="30265-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>

<span data-ttu-id="30265-283">Nous commençons par indiquer si nous souhaitons accéder à la base de données à l’aide d’une instruction SQL ad hoc ou d’une procédure stockée nouvelle ou existante.</span><span class="sxs-lookup"><span data-stu-id="30265-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="30265-284">Nous allons choisir une nouvelle fois une instruction SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="30265-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="30265-285">Ensuite, nous vous demanderons le type de requête SQL que nous souhaitons utiliser.</span><span class="sxs-lookup"><span data-stu-id="30265-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="30265-286">Étant donné que nous souhaitons renvoyer tous les produits appartenant à une catégorie spécifiée, nous voulons écrire une instruction `SELECT` qui retourne des lignes.</span><span class="sxs-lookup"><span data-stu-id="30265-286">Since we want to return all products that belong to a specified category, we want to write a `SELECT` statement which returns rows.</span></span>

<span data-ttu-id="30265-287">[![choisir de créer une instruction SELECT qui retourne des lignes](creating-a-data-access-layer-vb/_static/image40.png)](creating-a-data-access-layer-vb/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="30265-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-vb/_static/image40.png)](creating-a-data-access-layer-vb/_static/image39.png)</span></span>

<span data-ttu-id="30265-288">**Figure 15**: choisir de créer une instruction `SELECT` qui renvoie des lignes ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="30265-288">**Figure 15**: Choose to Create a `SELECT` Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image41.png))</span></span>

<span data-ttu-id="30265-289">L’étape suivante consiste à définir la requête SQL utilisée pour accéder aux données.</span><span class="sxs-lookup"><span data-stu-id="30265-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="30265-290">Étant donné que nous souhaitons retourner uniquement les produits appartenant à une catégorie particulière, j’utilise la même instruction `SELECT` dans `GetProducts()`, mais j’ajoute la clause `WHERE` suivante : `WHERE CategoryID = @CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="30265-290">Since we want to return only those products that belong to a particular category, I use the same `SELECT` statement from `GetProducts()`, but add the following `WHERE` clause: `WHERE CategoryID = @CategoryID`.</span></span> <span data-ttu-id="30265-291">Le paramètre `@CategoryID` indique à l’Assistant TableAdapter que la méthode que nous créons nécessite un paramètre d’entrée du type correspondant (c’est-à-dire un entier Nullable).</span><span class="sxs-lookup"><span data-stu-id="30265-291">The `@CategoryID` parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>

<span data-ttu-id="30265-292">[![entrer une requête pour retourner uniquement les produits d’une catégorie spécifiée](creating-a-data-access-layer-vb/_static/image43.png)](creating-a-data-access-layer-vb/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="30265-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-vb/_static/image43.png)](creating-a-data-access-layer-vb/_static/image42.png)</span></span>

<span data-ttu-id="30265-293">**Figure 16**: entrer une requête pour retourner uniquement les produits d’une catégorie spécifiée ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="30265-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image44.png))</span></span>

<span data-ttu-id="30265-294">Dans la dernière étape, nous pouvons choisir les modèles d’accès aux données à utiliser, ainsi que personnaliser les noms des méthodes générées.</span><span class="sxs-lookup"><span data-stu-id="30265-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="30265-295">Pour le modèle de remplissage, nous allons remplacer le nom par `FillByCategoryID` et pour que retourne un modèle de retour de DataTable (méthodes de `GetX`), nous utilisons `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="30265-295">For the Fill pattern, let's change the name to `FillByCategoryID` and for the return a DataTable return pattern (the `GetX` methods), let's use `GetProductsByCategoryID`.</span></span>

<span data-ttu-id="30265-296">[![choisir les noms des méthodes TableAdapter](creating-a-data-access-layer-vb/_static/image46.png)](creating-a-data-access-layer-vb/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="30265-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-vb/_static/image46.png)](creating-a-data-access-layer-vb/_static/image45.png)</span></span>

<span data-ttu-id="30265-297">**Figure 17**: choisir les noms des méthodes TableAdapter ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="30265-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image47.png))</span></span>

<span data-ttu-id="30265-298">Une fois l’Assistant terminé, le concepteur de DataSet comprend les nouvelles méthodes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>

![Les produits peuvent désormais être interrogés par catégorie](creating-a-data-access-layer-vb/_static/image48.png)

<span data-ttu-id="30265-300">**Figure 18**: les produits peuvent désormais être interrogés par catégorie</span><span class="sxs-lookup"><span data-stu-id="30265-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>

<span data-ttu-id="30265-301">Prenez un moment pour ajouter une méthode de `GetProductByProductID(productID)` à l’aide de la même technique.</span><span class="sxs-lookup"><span data-stu-id="30265-301">Take a moment to add a `GetProductByProductID(productID)` method using the same technique.</span></span>

<span data-ttu-id="30265-302">Ces requêtes paramétrables peuvent être testées directement à partir du concepteur de DataSet.</span><span class="sxs-lookup"><span data-stu-id="30265-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="30265-303">Cliquez avec le bouton droit sur la méthode dans le TableAdapter et choisissez Aperçu des données.</span><span class="sxs-lookup"><span data-stu-id="30265-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="30265-304">Ensuite, entrez les valeurs à utiliser pour les paramètres, puis cliquez sur Aperçu.</span><span class="sxs-lookup"><span data-stu-id="30265-304">Next, enter the values to use for the parameters and click Preview.</span></span>

<span data-ttu-id="30265-305">[![les produits appartenant à la catégorie boissons sont affichés](creating-a-data-access-layer-vb/_static/image50.png)](creating-a-data-access-layer-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="30265-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-vb/_static/image50.png)](creating-a-data-access-layer-vb/_static/image49.png)</span></span>

<span data-ttu-id="30265-306">**Figure 19**: les produits appartenant à la catégorie boissons sont affichés ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="30265-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image51.png))</span></span>

<span data-ttu-id="30265-307">Avec la méthode `GetProductsByCategoryID(categoryID)` dans notre couche DAL, nous pouvons maintenant créer une page ASP.NET qui affiche uniquement les produits appartenant à une catégorie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="30265-307">With the `GetProductsByCategoryID(categoryID)` method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="30265-308">L’exemple suivant affiche tous les produits qui se trouvent dans la catégorie boissons, qui ont une `CategoryID` de 1.</span><span class="sxs-lookup"><span data-stu-id="30265-308">The following example shows all products that are in the Beverages category, which have a `CategoryID` of 1.</span></span>

<span data-ttu-id="30265-309">Boissons. aspx</span><span class="sxs-lookup"><span data-stu-id="30265-309">Beverages.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-vb/samples/sample4.aspx)]

<span data-ttu-id="30265-310">Boissons. aspx. vb</span><span class="sxs-lookup"><span data-stu-id="30265-310">Beverages.aspx.vb</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample5.vb)]

<span data-ttu-id="30265-311">[![les produits de la catégorie boissons s’affichent.](creating-a-data-access-layer-vb/_static/image53.png)](creating-a-data-access-layer-vb/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="30265-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-vb/_static/image53.png)](creating-a-data-access-layer-vb/_static/image52.png)</span></span>

<span data-ttu-id="30265-312">**Figure 20**: les produits de la catégorie boissons sont affichés ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="30265-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image54.png))</span></span>

## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="30265-313">Étape 4 : insertion, mise à jour et suppression de données</span><span class="sxs-lookup"><span data-stu-id="30265-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="30265-314">Il existe deux modèles couramment utilisés pour l’insertion, la mise à jour et la suppression de données.</span><span class="sxs-lookup"><span data-stu-id="30265-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="30265-315">Le premier modèle, que j’appellerai le modèle de base de données direct, implique la création de méthodes qui, lorsqu’elles sont appelées, émettent une commande `INSERT`, `UPDATE`ou `DELETE` dans la base de données qui fonctionne sur un seul enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an `INSERT`, `UPDATE`, or `DELETE` command to the database that operates on a single database record.</span></span> <span data-ttu-id="30265-316">Ces méthodes sont généralement transmises dans une série de valeurs scalaires (entiers, chaînes, booléens, DateTime, etc.) qui correspondent aux valeurs à insérer, mettre à jour ou supprimer.</span><span class="sxs-lookup"><span data-stu-id="30265-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="30265-317">Par exemple, avec ce modèle pour la table `Products` la méthode Delete prendrait un paramètre entier, indiquant la `ProductID` de l’enregistrement à supprimer, tandis que la méthode Insert prendrait une chaîne pour le `ProductName`, un décimal pour le `UnitPrice`, un entier pour la `UnitsOnStock`, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="30265-317">For example, with this pattern for the `Products` table the delete method would take in an integer parameter, indicating the `ProductID` of the record to delete, while the insert method would take in a string for the `ProductName`, a decimal for the `UnitPrice`, an integer for the `UnitsOnStock`, and so on.</span></span>

<span data-ttu-id="30265-318">[![chaque demande d’insertion, de mise à jour et de suppression est immédiatement envoyée à la base de données.](creating-a-data-access-layer-vb/_static/image56.png)](creating-a-data-access-layer-vb/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="30265-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-vb/_static/image56.png)](creating-a-data-access-layer-vb/_static/image55.png)</span></span>

<span data-ttu-id="30265-319">**Figure 21**: chaque demande d’insertion, de mise à jour et de suppression est immédiatement envoyée à la base de données ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="30265-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image57.png))</span></span>

<span data-ttu-id="30265-320">L’autre modèle, que je vais désigner comme modèle de mise à jour par lot, consiste à mettre à jour l’intégralité d’un DataSet, d’un DataTable ou d’une collection de DataRows dans un appel de méthode.</span><span class="sxs-lookup"><span data-stu-id="30265-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="30265-321">Avec ce modèle, un développeur supprime, insère et modifie les DataRows dans un DataTable, puis passe ces DataRow ou DataTable dans une méthode de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="30265-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="30265-322">Cette méthode énumère ensuite les DataRows passés, détermine si elles ont été modifiées, ajoutées ou supprimées (via la valeur de la [propriété RowState](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) du DataRow) et émet la requête de base de données appropriée pour chaque enregistrement.</span><span class="sxs-lookup"><span data-stu-id="30265-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>

<span data-ttu-id="30265-323">[![toutes les modifications sont synchronisées avec la base de données lorsque la méthode Update est appelée](creating-a-data-access-layer-vb/_static/image59.png)](creating-a-data-access-layer-vb/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="30265-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-vb/_static/image59.png)](creating-a-data-access-layer-vb/_static/image58.png)</span></span>

<span data-ttu-id="30265-324">**Figure 22**: toutes les modifications sont synchronisées avec la base de données lorsque la méthode de mise à jour est appelée ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="30265-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image60.png))</span></span>

<span data-ttu-id="30265-325">Le TableAdapter utilise le modèle de mise à jour par lot par défaut, mais il prend également en charge le modèle de base de base de type direct.</span><span class="sxs-lookup"><span data-stu-id="30265-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="30265-326">Étant donné que nous avons sélectionné l’option « générer des instructions INSERT, Update et Delete » dans les propriétés avancées lors de la création de notre TableAdapter, le `ProductsTableAdapter` contient une méthode `Update()`, qui implémente le modèle de mise à jour par lot.</span><span class="sxs-lookup"><span data-stu-id="30265-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the `ProductsTableAdapter` contains an `Update()` method, which implements the batch update pattern.</span></span> <span data-ttu-id="30265-327">Plus précisément, le TableAdapter contient une méthode `Update()` qui peut être passée au DataSet typé, à un DataTable fortement typé ou à un ou plusieurs DataRows.</span><span class="sxs-lookup"><span data-stu-id="30265-327">Specifically, the TableAdapter contains an `Update()` method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="30265-328">Si vous avez laissé la case à cocher « GenerateDBDirectMethods » activée lors de la création initiale du TableAdapter, le modèle de base de base de type direct est également implémenté via les méthodes `Insert()`, `Update()`et `Delete()`.</span><span class="sxs-lookup"><span data-stu-id="30265-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via `Insert()`, `Update()`, and `Delete()` methods.</span></span>

<span data-ttu-id="30265-329">Les deux modèles de modification de données utilisent les propriétés `InsertCommand`, `UpdateCommand`et `DeleteCommand` du TableAdapter pour émettre leurs commandes `INSERT`, `UPDATE`et `DELETE` dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-329">Both data modification patterns use the TableAdapter's `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties to issue their `INSERT`, `UPDATE`, and `DELETE` commands to the database.</span></span> <span data-ttu-id="30265-330">Vous pouvez inspecter et modifier les propriétés `InsertCommand`, `UpdateCommand`et `DeleteCommand` en cliquant sur le TableAdapter dans le concepteur de DataSet, puis en accédant au Fenêtre Propriétés.</span><span class="sxs-lookup"><span data-stu-id="30265-330">You can inspect and modify the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="30265-331">(Assurez-vous que vous avez sélectionné le TableAdapter et que l’objet `ProductsTableAdapter` est celui sélectionné dans la liste déroulante de la Fenêtre Propriétés.)</span><span class="sxs-lookup"><span data-stu-id="30265-331">(Make sure you have selected the TableAdapter, and that the `ProductsTableAdapter` object is the one selected in the drop-down list in the Properties window.)</span></span>

<span data-ttu-id="30265-332">[![le TableAdapter possède les propriétés InsertCommand, UpdateCommand et DeleteCommand](creating-a-data-access-layer-vb/_static/image62.png)](creating-a-data-access-layer-vb/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="30265-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-vb/_static/image62.png)](creating-a-data-access-layer-vb/_static/image61.png)</span></span>

<span data-ttu-id="30265-333">**Figure 23**: le TableAdapter possède les propriétés `InsertCommand`, `UpdateCommand`et `DeleteCommand` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="30265-333">**Figure 23**: The TableAdapter has `InsertCommand`, `UpdateCommand`, and `DeleteCommand` Properties ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image63.png))</span></span>

<span data-ttu-id="30265-334">Pour examiner ou modifier l’une de ces propriétés de commande de base de données, cliquez sur la `CommandText` sous-propriété, qui affichera le Générateur de requêtes.</span><span class="sxs-lookup"><span data-stu-id="30265-334">To examine or modify any of these database command properties, click on the `CommandText` subproperty, which will bring up the Query Builder.</span></span>

<span data-ttu-id="30265-335">[![configurer les instructions INSERT, UPDATE et DELETE dans le Générateur de requêtes](creating-a-data-access-layer-vb/_static/image65.png)](creating-a-data-access-layer-vb/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="30265-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-vb/_static/image65.png)](creating-a-data-access-layer-vb/_static/image64.png)</span></span>

<span data-ttu-id="30265-336">**Figure 24**: configurer les instructions `INSERT`, `UPDATE`et `DELETE` dans le générateur de requêtes ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="30265-336">**Figure 24**: Configure the `INSERT`, `UPDATE`, and `DELETE` Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image66.png))</span></span>

<span data-ttu-id="30265-337">L’exemple de code suivant montre comment utiliser le modèle de mise à jour par lot pour doubler le prix de tous les produits qui ne sont pas interrompus et qui ont 25 unités en stock ou moins :</span><span class="sxs-lookup"><span data-stu-id="30265-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample6.vb)]

<span data-ttu-id="30265-338">Le code ci-dessous illustre l’utilisation du modèle de base de données direct pour supprimer par programmation un produit particulier, puis le mettre à jour, puis en ajouter un nouveau :</span><span class="sxs-lookup"><span data-stu-id="30265-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample7.vb)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="30265-339">Création de méthodes d’insertion, de mise à jour et de suppression personnalisées</span><span class="sxs-lookup"><span data-stu-id="30265-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="30265-340">Les méthodes `Insert()`, `Update()`et `Delete()` créées par la méthode DB direct peuvent être un peu fastidieuses, en particulier pour les tables comportant de nombreuses colonnes.</span><span class="sxs-lookup"><span data-stu-id="30265-340">The `Insert()`, `Update()`, and `Delete()` methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="30265-341">En examinant l’exemple de code précédent, sans l’aide d’IntelliSense, il n’est pas très facile de savoir ce que `Products` colonne de table mappe à chaque paramètre d’entrée aux méthodes de `Update()` et de `Insert()`.</span><span class="sxs-lookup"><span data-stu-id="30265-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what `Products` table column maps to each input parameter to the `Update()` and `Insert()` methods.</span></span> <span data-ttu-id="30265-342">Il peut arriver que vous souhaitiez uniquement mettre à jour une ou deux colonnes, ou une méthode de `Insert()` personnalisée qui, éventuellement, retourne la valeur du champ `IDENTITY` (incrémentation automatique) de l’enregistrement récemment inséré.</span><span class="sxs-lookup"><span data-stu-id="30265-342">There may be times when we only want to update a single column or two, or want a customized `Insert()` method that will, perhaps, return the value of the newly inserted record's `IDENTITY` (auto-increment) field.</span></span>

<span data-ttu-id="30265-343">Pour créer une telle méthode personnalisée, retournez dans le concepteur de DataSet.</span><span class="sxs-lookup"><span data-stu-id="30265-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="30265-344">Cliquez avec le bouton droit sur le TableAdapter et choisissez Ajouter une requête, en revenant à l’Assistant TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="30265-345">Dans le deuxième écran, nous pouvons indiquer le type de requête à créer.</span><span class="sxs-lookup"><span data-stu-id="30265-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="30265-346">Créons une méthode qui ajoute un nouveau produit, puis retourne la valeur de la `ProductID`de l’enregistrement qui vient d’être ajouté.</span><span class="sxs-lookup"><span data-stu-id="30265-346">Let's create a method that adds a new product and then returns the value of the newly added record's `ProductID`.</span></span> <span data-ttu-id="30265-347">Par conséquent, choisissez de créer une requête de `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="30265-347">Therefore, opt to create an `INSERT` query.</span></span>

<span data-ttu-id="30265-348">[![créer une méthode pour ajouter une nouvelle ligne à la table Products](creating-a-data-access-layer-vb/_static/image68.png)](creating-a-data-access-layer-vb/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="30265-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-vb/_static/image68.png)](creating-a-data-access-layer-vb/_static/image67.png)</span></span>

<span data-ttu-id="30265-349">**Figure 25**: créer une méthode pour ajouter une nouvelle ligne à la table `Products` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="30265-349">**Figure 25**: Create a Method to Add a New Row to the `Products` Table ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image69.png))</span></span>

<span data-ttu-id="30265-350">Dans l’écran suivant, le `CommandText` du `InsertCommand`s’affiche.</span><span class="sxs-lookup"><span data-stu-id="30265-350">On the next screen the `InsertCommand`'s `CommandText` appears.</span></span> <span data-ttu-id="30265-351">Augmentez cette requête en ajoutant `SELECT SCOPE_IDENTITY()` à la fin de la requête, qui renverra la dernière valeur d’identité insérée dans une colonne `IDENTITY` de la même portée.</span><span class="sxs-lookup"><span data-stu-id="30265-351">Augment this query by adding `SELECT SCOPE_IDENTITY()` at the end of the query, which will return the last identity value inserted into an `IDENTITY` column in the same scope.</span></span> <span data-ttu-id="30265-352">(Consultez la [documentation technique](https://msdn.microsoft.com/library/ms190315.aspx) pour plus d’informations sur les `SCOPE_IDENTITY()` et la raison pour laquelle vous souhaiterez probablement [utiliser l’étendue\_identité () à la place de @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Veillez à terminer l’instruction `INSERT` par un point-virgule avant d’ajouter l’instruction `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="30265-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about `SCOPE_IDENTITY()` and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the `INSERT` statement with a semi-colon before adding the `SELECT` statement.</span></span>

<span data-ttu-id="30265-353">[![augmenter la requête pour retourner la valeur SCOPE_IDENTITY ()](creating-a-data-access-layer-vb/_static/image71.png)](creating-a-data-access-layer-vb/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="30265-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-vb/_static/image71.png)](creating-a-data-access-layer-vb/_static/image70.png)</span></span>

<span data-ttu-id="30265-354">**Figure 26**: augmenter la requête pour retourner la valeur `SCOPE_IDENTITY()` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image72.png))</span><span class="sxs-lookup"><span data-stu-id="30265-354">**Figure 26**: Augment the Query to Return the `SCOPE_IDENTITY()` Value ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image72.png))</span></span>

<span data-ttu-id="30265-355">Enfin, nommez la nouvelle méthode `InsertProduct`.</span><span class="sxs-lookup"><span data-stu-id="30265-355">Finally, name the new method `InsertProduct`.</span></span>

<span data-ttu-id="30265-356">[![définir le nom de la nouvelle méthode sur InsertProduct](creating-a-data-access-layer-vb/_static/image74.png)](creating-a-data-access-layer-vb/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="30265-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-vb/_static/image74.png)](creating-a-data-access-layer-vb/_static/image73.png)</span></span>

<span data-ttu-id="30265-357">**Figure 27**: définir le nom de la nouvelle méthode sur `InsertProduct` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image75.png))</span><span class="sxs-lookup"><span data-stu-id="30265-357">**Figure 27**: Set the New Method Name to `InsertProduct` ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image75.png))</span></span>

<span data-ttu-id="30265-358">Lorsque vous revenez au concepteur de DataSet, vous verrez que le `ProductsTableAdapter` contient une nouvelle méthode, `InsertProduct`.</span><span class="sxs-lookup"><span data-stu-id="30265-358">When you return to the DataSet Designer you'll see that the `ProductsTableAdapter` contains a new method, `InsertProduct`.</span></span> <span data-ttu-id="30265-359">Si cette nouvelle méthode n’a pas de paramètre pour chaque colonne de la table `Products`, il est probable que vous ayez oublié de terminer l’instruction `INSERT` par un point-virgule.</span><span class="sxs-lookup"><span data-stu-id="30265-359">If this new method doesn't have a parameter for each column in the `Products` table, chances are you forgot to terminate the `INSERT` statement with a semi-colon.</span></span> <span data-ttu-id="30265-360">Configurez la méthode `InsertProduct` et assurez-vous de disposer d’un point-virgule délimitant les instructions `INSERT` et `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="30265-360">Configure the `InsertProduct` method and ensure you have a semi-colon delimiting the `INSERT` and `SELECT` statements.</span></span>

<span data-ttu-id="30265-361">Par défaut, les méthodes d’insertion émettent des méthodes qui ne sont pas des requêtes, ce qui signifie qu’elles retournent le nombre de lignes affectées.</span><span class="sxs-lookup"><span data-stu-id="30265-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="30265-362">Toutefois, nous voulons que la méthode `InsertProduct` retourne la valeur retournée par la requête, et non le nombre de lignes affectées.</span><span class="sxs-lookup"><span data-stu-id="30265-362">However, we want the `InsertProduct` method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="30265-363">Pour ce faire, affectez à la propriété `ExecuteMode` de la méthode `InsertProduct` la valeur `Scalar`.</span><span class="sxs-lookup"><span data-stu-id="30265-363">To accomplish this, adjust the `InsertProduct` method's `ExecuteMode` property to `Scalar`.</span></span>

<span data-ttu-id="30265-364">[![modifier la propriété ExecuteMode en scalaire](creating-a-data-access-layer-vb/_static/image77.png)](creating-a-data-access-layer-vb/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="30265-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-vb/_static/image77.png)](creating-a-data-access-layer-vb/_static/image76.png)</span></span>

<span data-ttu-id="30265-365">**Figure 28**: modifier la propriété `ExecuteMode` en `Scalar` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image78.png))</span><span class="sxs-lookup"><span data-stu-id="30265-365">**Figure 28**: Change the `ExecuteMode` Property to `Scalar` ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image78.png))</span></span>

<span data-ttu-id="30265-366">Le code suivant illustre cette nouvelle méthode de `InsertProduct` en action :</span><span class="sxs-lookup"><span data-stu-id="30265-366">The following code shows this new `InsertProduct` method in action:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample8.vb)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="30265-367">Étape 5 : fin de la couche d’accès aux données</span><span class="sxs-lookup"><span data-stu-id="30265-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="30265-368">Notez que la classe `ProductsTableAdapters` retourne les valeurs `CategoryID` et `SupplierID` de la table `Products`, mais n’inclut pas la colonne `CategoryName` de la table `Categories` ou la colonne `CompanyName` de la table `Suppliers`, bien qu’il s’agisse des colonnes que nous souhaitons afficher lors de l’affichage des informations sur le produit.</span><span class="sxs-lookup"><span data-stu-id="30265-368">Note that the `ProductsTableAdapters` class returns the `CategoryID` and `SupplierID` values from the `Products` table, but doesn't include the `CategoryName` column from the `Categories` table or the `CompanyName` column from the `Suppliers` table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="30265-369">Nous pouvons augmenter la méthode initiale du TableAdapter, `GetProducts()`, pour inclure les valeurs de colonne `CategoryName` et `CompanyName`, qui mettra à jour le DataTable fortement typé pour inclure ces nouvelles colonnes également.</span><span class="sxs-lookup"><span data-stu-id="30265-369">We can augment the TableAdapter's initial method, `GetProducts()`, to include both the `CategoryName` and `CompanyName` column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="30265-370">Cela peut présenter un problème, toutefois, comme les méthodes du TableAdapter pour l’insertion, la mise à jour et la suppression des données sont basées sur cette méthode initiale.</span><span class="sxs-lookup"><span data-stu-id="30265-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="30265-371">Heureusement, les méthodes générées automatiquement pour l’insertion, la mise à jour et la suppression ne sont pas affectées par les sous-requêtes dans la clause `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="30265-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the `SELECT` clause.</span></span> <span data-ttu-id="30265-372">En veillant à ajouter nos requêtes à `Categories` et `Suppliers` en tant que sous-requêtes, au lieu de `JOIN`, nous éviterons de devoir réutiliser ces méthodes pour modifier les données.</span><span class="sxs-lookup"><span data-stu-id="30265-372">By taking care to add our queries to `Categories` and `Suppliers` as subqueries, rather than `JOIN` s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="30265-373">Cliquez avec le bouton droit sur la méthode `GetProducts()` dans le `ProductsTableAdapter` et choisissez configurer.</span><span class="sxs-lookup"><span data-stu-id="30265-373">Right-click on the `GetProducts()` method in the `ProductsTableAdapter` and choose Configure.</span></span> <span data-ttu-id="30265-374">Ensuite, ajustez la clause `SELECT` afin qu’elle ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="30265-374">Then, adjust the `SELECT` clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-vb/samples/sample9.sql)]

<span data-ttu-id="30265-375">[![mettre à jour l’instruction SELECT pour la méthode GetProducts ()](creating-a-data-access-layer-vb/_static/image80.png)](creating-a-data-access-layer-vb/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="30265-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-vb/_static/image80.png)](creating-a-data-access-layer-vb/_static/image79.png)</span></span>

<span data-ttu-id="30265-376">**Figure 29**: mettre à jour l’instruction `SELECT` pour la méthode `GetProducts()` ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image81.png))</span><span class="sxs-lookup"><span data-stu-id="30265-376">**Figure 29**: Update the `SELECT` Statement for the `GetProducts()` Method ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image81.png))</span></span>

<span data-ttu-id="30265-377">Après la mise à jour de la méthode `GetProducts()` pour utiliser cette nouvelle requête, le DataTable inclut deux nouvelles colonnes : `CategoryName` et `SupplierName`.</span><span class="sxs-lookup"><span data-stu-id="30265-377">After updating the `GetProducts()` method to use this new query the DataTable will include two new columns: `CategoryName` and `SupplierName`.</span></span>

![Le DataTable Products comporte deux nouvelles colonnes](creating-a-data-access-layer-vb/_static/image82.png)

<span data-ttu-id="30265-379">**Figure 30**: le `Products` DataTable a deux nouvelles colonnes</span><span class="sxs-lookup"><span data-stu-id="30265-379">**Figure 30**: The `Products` DataTable has Two New Columns</span></span>

<span data-ttu-id="30265-380">Prenez un moment pour mettre à jour la clause `SELECT` dans la méthode `GetProductsByCategoryID(categoryID)` également.</span><span class="sxs-lookup"><span data-stu-id="30265-380">Take a moment to update the `SELECT` clause in the `GetProductsByCategoryID(categoryID)` method as well.</span></span>

<span data-ttu-id="30265-381">Si vous mettez à jour le `GetProducts()` `SELECT` à l’aide de la syntaxe `JOIN`, le concepteur de DataSet ne pourra pas générer automatiquement les méthodes d’insertion, de mise à jour et de suppression des données de base de données à l’aide du modèle de base de données direct.</span><span class="sxs-lookup"><span data-stu-id="30265-381">If you update the `GetProducts()` `SELECT` using `JOIN` syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="30265-382">Au lieu de cela, vous devez les créer manuellement comme nous l’avons fait avec la méthode `InsertProduct` plus haut dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="30265-382">Instead, you'll have to manually create them much like we did with the `InsertProduct` method earlier in this tutorial.</span></span> <span data-ttu-id="30265-383">En outre, vous devrez fournir manuellement les valeurs de propriété `InsertCommand`, `UpdateCommand`et `DeleteCommand` si vous souhaitez utiliser le modèle de mise à jour par lot.</span><span class="sxs-lookup"><span data-stu-id="30265-383">Furthermore, you'll manually have to provide the `InsertCommand`, `UpdateCommand`, and `DeleteCommand` property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="30265-384">Ajout des TableAdapters restants</span><span class="sxs-lookup"><span data-stu-id="30265-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="30265-385">Jusqu’à présent, nous avons uniquement regardé l’utilisation d’un seul TableAdapter pour une seule table de base de données.</span><span class="sxs-lookup"><span data-stu-id="30265-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="30265-386">Toutefois, la base de données Northwind contient plusieurs tables associées que nous devrons utiliser dans notre application Web.</span><span class="sxs-lookup"><span data-stu-id="30265-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="30265-387">Un DataSet typé peut contenir plusieurs DataTables associés.</span><span class="sxs-lookup"><span data-stu-id="30265-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="30265-388">Par conséquent, pour terminer notre DAL, nous devons ajouter des DataTables pour les autres tables que nous utiliserons dans ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="30265-389">Pour ajouter un nouveau TableAdapter à un DataSet typé, ouvrez le concepteur de DataSet, cliquez avec le bouton droit dans le concepteur, puis choisissez Ajouter/TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="30265-390">Cela créera un nouveau DataTable et TableAdapter et vous guidera tout au long de l’Assistant que nous avons examiné précédemment dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="30265-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="30265-391">Prenez quelques minutes pour créer les TableAdapters et les méthodes suivants à l’aide des requêtes suivantes.</span><span class="sxs-lookup"><span data-stu-id="30265-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="30265-392">Notez que les requêtes dans le `ProductsTableAdapter` incluent les sous-requêtes pour récupérer les noms de catégorie et de fournisseur de chaque produit.</span><span class="sxs-lookup"><span data-stu-id="30265-392">Note that the queries in the `ProductsTableAdapter` include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="30265-393">En outre, si vous avez déjà effectué les opérations suivantes, vous avez déjà ajouté les méthodes de `GetProducts()` et de `GetProductsByCategoryID(categoryID)` de la classe `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="30265-393">Additionally, if you've been following along, you've already added the `ProductsTableAdapter` class's `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods.</span></span>

- <span data-ttu-id="30265-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="30265-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="30265-395">**GetProducts**:</span><span class="sxs-lookup"><span data-stu-id="30265-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample10.sql)]
  - <span data-ttu-id="30265-396">**GetProductsByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="30265-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample11.sql)]
  - <span data-ttu-id="30265-397">**GetProductsBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="30265-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample12.sql)]
  - <span data-ttu-id="30265-398">**GetProductByProductID**:</span><span class="sxs-lookup"><span data-stu-id="30265-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample13.sql)]
- <span data-ttu-id="30265-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="30265-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="30265-400">**GetCategories**:</span><span class="sxs-lookup"><span data-stu-id="30265-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample14.sql)]
  - <span data-ttu-id="30265-401">**GetCategoryByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="30265-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample15.sql)]
- <span data-ttu-id="30265-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="30265-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="30265-403">**GetSuppliers**:</span><span class="sxs-lookup"><span data-stu-id="30265-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample16.sql)]
  - <span data-ttu-id="30265-404">**GetSuppliersByCountry**:</span><span class="sxs-lookup"><span data-stu-id="30265-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample17.sql)]
  - <span data-ttu-id="30265-405">**GetSupplierBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="30265-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample18.sql)]
- <span data-ttu-id="30265-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="30265-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="30265-407">**GetEmployees**:</span><span class="sxs-lookup"><span data-stu-id="30265-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample19.sql)]
  - <span data-ttu-id="30265-408">**GetEmployeesByManager**:</span><span class="sxs-lookup"><span data-stu-id="30265-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample20.sql)]
  - <span data-ttu-id="30265-409">**GetEmployeeByEmployeeID**:</span><span class="sxs-lookup"><span data-stu-id="30265-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-vb/samples/sample21.sql)]

<span data-ttu-id="30265-410">[![le concepteur de DataSet une fois que les quatre TableAdapters ont été ajoutés](creating-a-data-access-layer-vb/_static/image84.png)](creating-a-data-access-layer-vb/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="30265-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-vb/_static/image84.png)](creating-a-data-access-layer-vb/_static/image83.png)</span></span>

<span data-ttu-id="30265-411">**Figure 31**: concepteur de DataSet une fois que les quatre TableAdapters ont été ajoutés ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image85.png))</span><span class="sxs-lookup"><span data-stu-id="30265-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image85.png))</span></span>

## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="30265-412">Ajout de code personnalisé à la couche DAL</span><span class="sxs-lookup"><span data-stu-id="30265-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="30265-413">Les TableAdapters et les DataTables ajoutés au DataSet typé sont exprimés sous la forme d’un fichier de définition de schéma XML (`Northwind.xsd`).</span><span class="sxs-lookup"><span data-stu-id="30265-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (`Northwind.xsd`).</span></span> <span data-ttu-id="30265-414">Pour afficher ces informations de schéma, cliquez avec le bouton droit sur le fichier `Northwind.xsd` dans le Explorateur de solutions puis sélectionnez Afficher le code.</span><span class="sxs-lookup"><span data-stu-id="30265-414">You can view this schema information by right-clicking on the `Northwind.xsd` file in the Solution Explorer and choosing View Code.</span></span>

<span data-ttu-id="30265-415">[![le fichier XSD (XML Schema Definition) du DataSet typé Northwind](creating-a-data-access-layer-vb/_static/image87.png)](creating-a-data-access-layer-vb/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="30265-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-vb/_static/image87.png)](creating-a-data-access-layer-vb/_static/image86.png)</span></span>

<span data-ttu-id="30265-416">**Figure 32**: fichier XSD (XML Schema Definition) du DataSet typé Northwind ([cliquez pour afficher l’image en taille réelle](creating-a-data-access-layer-vb/_static/image88.png))</span><span class="sxs-lookup"><span data-stu-id="30265-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image88.png))</span></span>

<span data-ttu-id="30265-417">Ces informations de schéma sont traduites dans C# ou Visual Basic code au moment de la conception, lors de la compilation ou au moment de l’exécution (si nécessaire), à partir de quel moment vous pouvez effectuer un pas à pas détaillé avec le débogueur.</span><span class="sxs-lookup"><span data-stu-id="30265-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="30265-418">Pour afficher ce code généré automatiquement, accédez à la Affichage de classes et explorez les classes TableAdapter ou DataSet typé.</span><span class="sxs-lookup"><span data-stu-id="30265-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="30265-419">Si vous ne voyez pas l’Affichage de classes sur votre écran, accédez au menu Affichage et sélectionnez-le à partir de là, ou appuyez sur Ctrl + Maj + C.</span><span class="sxs-lookup"><span data-stu-id="30265-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="30265-420">À partir de la Affichage de classes vous pouvez voir les propriétés, les méthodes et les événements du DataSet typé et des classes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="30265-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="30265-421">Pour afficher le code d’une méthode particulière, double-cliquez sur le nom de la méthode dans la Affichage de classes ou cliquez dessus avec le bouton droit, puis choisissez atteindre la définition.</span><span class="sxs-lookup"><span data-stu-id="30265-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>

![Inspectez le code généré automatiquement en sélectionnant atteindre la définition dans la Affichage de classes](creating-a-data-access-layer-vb/_static/image89.png)

<span data-ttu-id="30265-423">**Figure 33**: inspecter le code généré automatiquement en sélectionnant atteindre la définition dans la affichage de classes</span><span class="sxs-lookup"><span data-stu-id="30265-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>

<span data-ttu-id="30265-424">Alors que le code généré automatiquement peut être un économiseur de temps, le code est souvent très générique et doit être personnalisé pour répondre aux besoins uniques d’une application.</span><span class="sxs-lookup"><span data-stu-id="30265-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="30265-425">Toutefois, le risque d’étendre le code généré automatiquement est que l’outil qui a généré le code peut décider qu’il est temps de « régénérer » et de remplacer vos personnalisations.</span><span class="sxs-lookup"><span data-stu-id="30265-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="30265-426">Avec le nouveau concept de classe partielle de .NET 2.0, il est facile de fractionner une classe entre plusieurs fichiers.</span><span class="sxs-lookup"><span data-stu-id="30265-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="30265-427">Cela nous permet d’ajouter nos propres méthodes, propriétés et événements aux classes générées automatiquement sans avoir à vous soucier de l’écrasement de nos personnalisations par Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="30265-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="30265-428">Pour illustrer comment personnaliser la couche DAL, nous allons ajouter une méthode `GetProducts()` à la classe `SuppliersRow`.</span><span class="sxs-lookup"><span data-stu-id="30265-428">To demonstrate how to customize the DAL, let's add a `GetProducts()` method to the `SuppliersRow` class.</span></span> <span data-ttu-id="30265-429">La classe `SuppliersRow` représente un enregistrement unique dans la table `Suppliers` ; chaque fournisseur peut fournir zéro à de nombreux produits, `GetProducts()` renverra donc les produits du fournisseur spécifié.</span><span class="sxs-lookup"><span data-stu-id="30265-429">The `SuppliersRow` class represents a single record in the `Suppliers` table; each supplier can provider zero to many products, so `GetProducts()` will return those products of the specified supplier.</span></span> <span data-ttu-id="30265-430">Pour ce faire, créez un nouveau fichier de classe dans le dossier `App_Code` nommé `SuppliersRow.vb` et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="30265-430">To accomplish this create a new class file in the `App_Code` folder named `SuppliersRow.vb` and add the following code:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample22.vb)]

<span data-ttu-id="30265-431">Cette classe partielle indique au compilateur que, lors de la génération de la classe `Northwind.SuppliersRow`, il doit inclure la méthode `GetProducts()` que nous venons de définir.</span><span class="sxs-lookup"><span data-stu-id="30265-431">This partial class instructs the compiler that when building the `Northwind.SuppliersRow` class to include the `GetProducts()` method we just defined.</span></span> <span data-ttu-id="30265-432">Si vous générez votre projet, puis revenez à la Affichage de classes vous verrez `GetProducts()` maintenant listé comme méthode de `Northwind.SuppliersRow`.</span><span class="sxs-lookup"><span data-stu-id="30265-432">If you build your project and then return to the Class View you'll see `GetProducts()` now listed as a method of `Northwind.SuppliersRow`.</span></span>

![La méthode GetProducts () fait maintenant partie de la classe Northwind. SuppliersRow](creating-a-data-access-layer-vb/_static/image90.png)

<span data-ttu-id="30265-434">**Figure 34**: la méthode `GetProducts()` fait maintenant partie de la classe `Northwind.SuppliersRow`</span><span class="sxs-lookup"><span data-stu-id="30265-434">**Figure 34**: The `GetProducts()` Method is Now Part of the `Northwind.SuppliersRow` Class</span></span>

<span data-ttu-id="30265-435">La méthode `GetProducts()` peut maintenant être utilisée pour énumérer l’ensemble des produits pour un fournisseur particulier, comme le montre le code suivant :</span><span class="sxs-lookup"><span data-stu-id="30265-435">The `GetProducts()` method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample23.vb)]

<span data-ttu-id="30265-436">Ces données peuvent également être affichées dans n’importe quel ASP. Contrôles Web de données du réseau.</span><span class="sxs-lookup"><span data-stu-id="30265-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="30265-437">La page suivante utilise un contrôle GridView avec deux champs :</span><span class="sxs-lookup"><span data-stu-id="30265-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="30265-438">BoundField qui affiche le nom de chaque fournisseur et</span><span class="sxs-lookup"><span data-stu-id="30265-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="30265-439">TemplateField qui contient un contrôle BulletedList lié aux résultats retournés par la méthode `GetProducts()` pour chaque fournisseur.</span><span class="sxs-lookup"><span data-stu-id="30265-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the `GetProducts()` method for each supplier.</span></span>

<span data-ttu-id="30265-440">Nous allons examiner comment afficher ces rapports maître/détail dans les prochains didacticiels.</span><span class="sxs-lookup"><span data-stu-id="30265-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="30265-441">Pour l’instant, cet exemple est conçu pour illustrer l’utilisation de la méthode personnalisée ajoutée à la classe `Northwind.SuppliersRow`.</span><span class="sxs-lookup"><span data-stu-id="30265-441">For now, this example is designed to illustrate using the custom method added to the `Northwind.SuppliersRow` class.</span></span>

<span data-ttu-id="30265-442">SuppliersAndProducts. aspx</span><span class="sxs-lookup"><span data-stu-id="30265-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-vb/samples/sample24.aspx)]

<span data-ttu-id="30265-443">SuppliersAndProducts. aspx. vb</span><span class="sxs-lookup"><span data-stu-id="30265-443">SuppliersAndProducts.aspx.vb</span></span>

[!code-vb[Main](creating-a-data-access-layer-vb/samples/sample25.vb)]

<span data-ttu-id="30265-444">[![le nom de la société du fournisseur est indiqué dans la colonne de gauche, ses produits à droite](creating-a-data-access-layer-vb/_static/image92.png)](creating-a-data-access-layer-vb/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="30265-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-vb/_static/image92.png)](creating-a-data-access-layer-vb/_static/image91.png)</span></span>

<span data-ttu-id="30265-445">**Figure 35**: le nom de la société du fournisseur est indiqué dans la colonne de gauche, à savoir ses produits à droite ([cliquez pour afficher l’image en plein écran](creating-a-data-access-layer-vb/_static/image93.png))</span><span class="sxs-lookup"><span data-stu-id="30265-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-vb/_static/image93.png))</span></span>

## <a name="summary"></a><span data-ttu-id="30265-446">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="30265-446">Summary</span></span>

<span data-ttu-id="30265-447">Quand vous créez une application Web, la création de la couche DAL doit être l’une de vos premières étapes, qui se produit avant de commencer à créer votre couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="30265-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="30265-448">Avec Visual Studio, la création d’une couche DAL basée sur des DataSets typés est une tâche qui peut être accomplie en 10-15 minutes sans écrire une ligne de code.</span><span class="sxs-lookup"><span data-stu-id="30265-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="30265-449">Les didacticiels qui évoluent vers l’avant seront générés sur cette couche DAL.</span><span class="sxs-lookup"><span data-stu-id="30265-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="30265-450">Dans le [didacticiel suivant](creating-a-business-logic-layer-vb.md) , nous allons définir un certain nombre de règles d’entreprise et voir comment les implémenter dans une couche de logique métier distincte.</span><span class="sxs-lookup"><span data-stu-id="30265-450">In the [next tutorial](creating-a-business-logic-layer-vb.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="30265-451">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="30265-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="30265-452">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="30265-452">Further Reading</span></span>

<span data-ttu-id="30265-453">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="30265-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="30265-454">Génération d’une couche DAL à l’aide de TableAdapters et de DataTables fortement typés dans VS 2005 et ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="30265-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="30265-455">Conception de composants de la couche données et transmission de données à travers les niveaux</span><span class="sxs-lookup"><span data-stu-id="30265-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="30265-456">Créer une couche d’accès aux données avec le concepteur de DataSet Visual Studio 2005</span><span class="sxs-lookup"><span data-stu-id="30265-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="30265-457">Chiffrement des informations de configuration dans les applications ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="30265-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="30265-458">Vue d’ensemble de TableAdapter</span><span class="sxs-lookup"><span data-stu-id="30265-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="30265-459">Utilisation d’un DataSet typé</span><span class="sxs-lookup"><span data-stu-id="30265-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="30265-460">Utilisation de l’accès aux données fortement typées dans Visual Studio 2005 et ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="30265-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="30265-461">Comment étendre des méthodes TableAdapter</span><span class="sxs-lookup"><span data-stu-id="30265-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="30265-462">Récupération de données scalaires à partir d’une procédure stockée</span><span class="sxs-lookup"><span data-stu-id="30265-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="30265-463">Formation vidéo sur les rubriques contenues dans ce didacticiel</span><span class="sxs-lookup"><span data-stu-id="30265-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="30265-464">Couches d’accès aux données dans les applications ASP.NET</span><span class="sxs-lookup"><span data-stu-id="30265-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="30265-465">Comment lier manuellement un DataSet à un DataGrid</span><span class="sxs-lookup"><span data-stu-id="30265-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="30265-466">Utilisation des jeux de données et des filtres d’une application ASP</span><span class="sxs-lookup"><span data-stu-id="30265-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="30265-467">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="30265-467">About the Author</span></span>

<span data-ttu-id="30265-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="30265-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="30265-469">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="30265-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="30265-470">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="30265-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="30265-471">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="30265-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="30265-472">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="30265-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="30265-473">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="30265-473">Special Thanks To</span></span>

<span data-ttu-id="30265-474">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="30265-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="30265-475">Les réviseurs de leads pour ce didacticiel sont Ron Green, Hilton Giesenow, Denis Patterson, Liz Shulok, Gomez et Carlos Santos.</span><span class="sxs-lookup"><span data-stu-id="30265-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="30265-476">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="30265-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="30265-477">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="30265-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="30265-478">[Précédent](master-pages-and-site-navigation-cs.md)
> [Suivant](creating-a-business-logic-layer-vb.md)</span><span class="sxs-lookup"><span data-stu-id="30265-478">[Previous](master-pages-and-site-navigation-cs.md)
[Next](creating-a-business-logic-layer-vb.md)</span></span>
