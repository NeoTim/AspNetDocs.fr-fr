---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
title: Mise à jour par lots (VB) | Microsoft Docs
author: rick-anderson
description: Découvrez comment mettre à jour plusieurs enregistrements de base de données en une seule opération. Dans la couche d’interface utilisateur, nous créons un GridView dans lequel chaque ligne est modifiable. Dans les données...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: d191a204-d7ea-458d-b81c-0b9049ecb55f
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
msc.type: authoredcontent
ms.openlocfilehash: f0bb83b17585876dd6d28a5893a223cce15da31d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74591237"
---
# <a name="batch-updating-vb"></a><span data-ttu-id="fc895-105">Mise à jour par lots (VB)</span><span class="sxs-lookup"><span data-stu-id="fc895-105">Batch Updating (VB)</span></span>

<span data-ttu-id="fc895-106">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fc895-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fc895-107">[Télécharger le code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) ou [Télécharger le PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="fc895-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) or [Download PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span></span>

> <span data-ttu-id="fc895-108">Découvrez comment mettre à jour plusieurs enregistrements de base de données en une seule opération.</span><span class="sxs-lookup"><span data-stu-id="fc895-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="fc895-109">Dans la couche d’interface utilisateur, nous créons un GridView dans lequel chaque ligne est modifiable.</span><span class="sxs-lookup"><span data-stu-id="fc895-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="fc895-110">Dans la couche d’accès aux données, nous encapsulons les multiples opérations de mise à jour dans une transaction pour vous assurer que toutes les mises à jour ont été effectuées correctement ou que toutes les mises à jour sont annulées.</span><span class="sxs-lookup"><span data-stu-id="fc895-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="fc895-111">Introduction</span><span class="sxs-lookup"><span data-stu-id="fc895-111">Introduction</span></span>

<span data-ttu-id="fc895-112">Dans le [didacticiel précédent](wrapping-database-modifications-within-a-transaction-vb.md) , nous avons vu comment étendre la couche d’accès aux données pour ajouter la prise en charge des transactions de base de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="fc895-113">Les transactions de base de données garantissent qu’une série d’instructions de modification de données sera traitée comme une seule opération atomique, ce qui garantit que toutes les modifications échoueront ou que toutes seront réussies.</span><span class="sxs-lookup"><span data-stu-id="fc895-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="fc895-114">Grâce à cette fonctionnalité de couche DAL de bas niveau, nous sommes prêts à attirer notre attention sur la création d’interfaces de modification de données batch.</span><span class="sxs-lookup"><span data-stu-id="fc895-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="fc895-115">Dans ce didacticiel, nous allons créer un GridView dans lequel chaque ligne est modifiable (voir la figure 1).</span><span class="sxs-lookup"><span data-stu-id="fc895-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="fc895-116">Étant donné que chaque ligne est rendue dans son interface de modification, il n’est pas nécessaire de disposer d’une colonne de boutons modifier, mettre à jour et annuler.</span><span class="sxs-lookup"><span data-stu-id="fc895-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="fc895-117">Au lieu de cela, il existe deux boutons mettre à jour les produits dans la page qui, lorsque vous cliquez dessus, énumère les lignes GridView et met à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="fc895-118">[![chaque ligne dans le GridView est modifiable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-118">[![Each Row in the GridView is Editable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span></span>

<span data-ttu-id="fc895-119">**Figure 1**: chaque ligne du contrôle GridView est modifiable ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-vb/_static/image2.png))</span></span>

<span data-ttu-id="fc895-120">Commençons !</span><span class="sxs-lookup"><span data-stu-id="fc895-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="fc895-121">Dans le didacticiel sur l' [exécution des mises à jour par lot](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) , nous avons créé une interface de modification par lot à l’aide du contrôle DataList.</span><span class="sxs-lookup"><span data-stu-id="fc895-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="fc895-122">Ce didacticiel diffère de l’ancien dans qui utilise un GridView et la mise à jour par lot est effectuée dans l’étendue d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="fc895-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="fc895-123">À la fin de ce didacticiel, je vous encourage à revenir au didacticiel précédent et à le mettre à jour pour utiliser les fonctionnalités liées aux transactions de base de données ajoutées dans le didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="fc895-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="fc895-124">Examen des étapes pour rendre toutes les lignes GridView modifiables</span><span class="sxs-lookup"><span data-stu-id="fc895-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="fc895-125">Comme indiqué dans le didacticiel [vue d’ensemble de l’insertion, de la mise à jour et de la suppression des données](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) , le contrôle GridView offre une prise en charge intégrée de la modification de ses données sous-jacentes en fonction de chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="fc895-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="fc895-126">En interne, le GridView note la ligne modifiable par le biais de sa [propriété`EditIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fc895-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="fc895-127">Étant donné que le GridView est lié à sa source de données, il vérifie chaque ligne pour voir si l’index de la ligne est égal à la valeur de `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="fc895-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="fc895-128">Si c’est le cas, les champs de ligne s sont rendus à l’aide de leurs interfaces de modification.</span><span class="sxs-lookup"><span data-stu-id="fc895-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="fc895-129">Pour BoundFields, l’interface de modification est une zone de texte dont la propriété `Text` est assignée à la valeur du champ de données spécifié par la propriété BoundField s `DataField`.</span><span class="sxs-lookup"><span data-stu-id="fc895-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="fc895-130">Pour TemplateFields, le `EditItemTemplate` est utilisé à la place du `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="fc895-131">Rappelez-vous que le flux de travail de modification démarre lorsqu’un utilisateur clique sur un bouton de modification de ligne.</span><span class="sxs-lookup"><span data-stu-id="fc895-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="fc895-132">Cela provoque une publication (postback), définit la propriété GridView s `EditIndex` sur l’index de la ligne sur laquelle vous avez cliqué, puis relit les données à la grille.</span><span class="sxs-lookup"><span data-stu-id="fc895-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="fc895-133">Quand l’utilisateur clique sur un bouton d’annulation de ligne, lors de la publication (postback), le `EditIndex` est défini sur une valeur de `-1` avant de relier les données à la grille.</span><span class="sxs-lookup"><span data-stu-id="fc895-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="fc895-134">Étant donné que les lignes du contrôle GridView commencent l’indexation à zéro, la définition de `EditIndex` sur `-1` a pour effet d’afficher le contrôle GridView en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="fc895-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="fc895-135">La propriété `EditIndex` fonctionne bien pour la modification par ligne, mais elle n’est pas conçue pour la modification par lot.</span><span class="sxs-lookup"><span data-stu-id="fc895-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="fc895-136">Pour rendre le GridView entièrement modifiable, nous devons afficher chaque ligne à l’aide de son interface de modification.</span><span class="sxs-lookup"><span data-stu-id="fc895-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="fc895-137">Le moyen le plus simple d’y parvenir consiste à créer où chaque champ modifiable est implémenté en tant que TemplateField avec son interface de modification définie dans la `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="fc895-138">Au cours des différentes étapes suivantes, nous allons créer un GridView entièrement modifiable.</span><span class="sxs-lookup"><span data-stu-id="fc895-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="fc895-139">À l’étape 1, nous allons commencer par créer le GridView et son ObjectDataSource, puis convertir ses BoundFields et CheckBoxField en TemplateFields.</span><span class="sxs-lookup"><span data-stu-id="fc895-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="fc895-140">Dans les étapes 2 et 3, nous allons déplacer les interfaces de modification de TemplateFields `EditItemTemplate` s vers leurs `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fc895-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="fc895-141">Étape 1 : affichage des informations sur le produit</span><span class="sxs-lookup"><span data-stu-id="fc895-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="fc895-142">Avant de vous soucier de la création d’un GridView dans lequel les lignes sont modifiables, commençons par afficher simplement les informations du produit.</span><span class="sxs-lookup"><span data-stu-id="fc895-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="fc895-143">Ouvrez la page `BatchUpdate.aspx` dans le dossier `BatchData` et faites glisser un contrôle GridView de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="fc895-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="fc895-144">Définissez le `ID` GridView s sur `ProductsGrid` et, à partir de sa balise active, choisissez de le lier à un nouvel ObjectDataSource nommé `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="fc895-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="fc895-145">Configurez l’ObjectDataSource pour récupérer ses données à partir de la méthode de `GetProducts` de la classe `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="fc895-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="fc895-146">[![configurer ObjectDataSource pour utiliser la classe ProductsBLL](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span></span>

<span data-ttu-id="fc895-147">**Figure 2**: configurer ObjectDataSource pour utiliser la classe `ProductsBLL` ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image4.png))</span></span>

<span data-ttu-id="fc895-148">[![récupérer les données du produit à l’aide de la méthode GetProducts](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span></span>

<span data-ttu-id="fc895-149">**Figure 3**: récupérer les données du produit à l’aide de la méthode `GetProducts` ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-vb/_static/image6.png))</span></span>

<span data-ttu-id="fc895-150">À l’instar de GridView, les fonctionnalités de modification de ObjectDataSource sont conçues pour travailler par ligne.</span><span class="sxs-lookup"><span data-stu-id="fc895-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="fc895-151">Pour mettre à jour un jeu d’enregistrements, nous devons écrire un peu de code dans la classe code-behind de la page ASP.NET pour traiter les données par lots et les transmettre à la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="fc895-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="fc895-152">Par conséquent, définissez les listes déroulantes dans les onglets mise à jour, insertion et suppression de ObjectDataSource s sur (aucune).</span><span class="sxs-lookup"><span data-stu-id="fc895-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="fc895-153">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="fc895-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="fc895-154">[![définir les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span></span>

<span data-ttu-id="fc895-155">**Figure 4**: définir les listes déroulantes des onglets mettre à jour, insérer et supprimer sur (aucun) ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image8.png))</span></span>

<span data-ttu-id="fc895-156">À l’issue de l’exécution de l’Assistant Configuration de la source de données, le balisage déclaratif s doit se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="fc895-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample1.aspx)]

<span data-ttu-id="fc895-157">L’exécution de l’Assistant Configuration de la source de données entraîne également la création par Visual Studio de BoundFields et d’un CheckBoxField pour les champs de données de produit dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="fc895-158">Pour ce didacticiel, autorisez uniquement l’utilisateur à afficher et à modifier le nom du produit, la catégorie, le prix et l’État abandonné.</span><span class="sxs-lookup"><span data-stu-id="fc895-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="fc895-159">Supprimez tous les champs sauf les `ProductName`, `CategoryName`, `UnitPrice`et `Discontinued` et renommez les propriétés `HeaderText` des trois premiers champs respectivement en Product, Category et Price.</span><span class="sxs-lookup"><span data-stu-id="fc895-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="fc895-160">Enfin, activez les cases à cocher Activer la pagination et activer le tri dans la balise active GridView s.</span><span class="sxs-lookup"><span data-stu-id="fc895-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="fc895-161">À ce stade, le contrôle GridView a trois BoundFields (`ProductName`, `CategoryName`et `UnitPrice`) et un CheckBoxField (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="fc895-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="fc895-162">Nous devons convertir ces quatre champs en TemplateFields, puis déplacer l’interface de modification du TemplateField s `EditItemTemplate` vers son `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="fc895-163">Nous avons exploré la création et la personnalisation de TemplateFields dans le didacticiel [Personnalisation de l’interface de modification des données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="fc895-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span> <span data-ttu-id="fc895-164">Nous allons examiner les étapes de la conversion de BoundFields et CheckBoxField en TemplateFields et la définition de leurs interfaces de modification dans leurs `ItemTemplate` s, mais si vous êtes bloqué ou si vous avez besoin d’un actualisateur, Don t hésite à revenir à ce didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="fc895-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="fc895-165">À partir de la balise active GridView s, cliquez sur le lien modifier les colonnes pour ouvrir la boîte de dialogue champs.</span><span class="sxs-lookup"><span data-stu-id="fc895-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="fc895-166">Ensuite, sélectionnez chaque champ, puis cliquez sur le lien convertir ce champ en TemplateField.</span><span class="sxs-lookup"><span data-stu-id="fc895-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Convertir le BoundFields et le CheckBoxField existants en TemplateFields](batch-updating-vb/_static/image5.gif)

<span data-ttu-id="fc895-168">**Figure 5**: convertir le BoundFields et le CheckBoxField existants en TemplateFields</span><span class="sxs-lookup"><span data-stu-id="fc895-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateFields</span></span>

<span data-ttu-id="fc895-169">Maintenant que chaque champ est un TemplateField, nous sommes prêts à déplacer l’interface de modification du `EditItemTemplate` s vers le `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fc895-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="fc895-170">Étape 2 : création des interfaces de modification`ProductName`,`UnitPrice`et`Discontinued`</span><span class="sxs-lookup"><span data-stu-id="fc895-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="fc895-171">La création des interfaces de modification `ProductName`, `UnitPrice`et `Discontinued` est la rubrique de cette étape et est assez simple, car chaque interface est déjà définie dans le `EditItemTemplate`TemplateField s.</span><span class="sxs-lookup"><span data-stu-id="fc895-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="fc895-172">La création de l’interface de modification `CategoryName` est un peu plus complexe, car nous devons créer un DropDownList des catégories applicables.</span><span class="sxs-lookup"><span data-stu-id="fc895-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="fc895-173">Cette `CategoryName` interface de modification est abordée à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="fc895-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="fc895-174">Commençons par le `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="fc895-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="fc895-175">Cliquez sur le lien modifier les modèles dans la balise active de GridView s et explorez le `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="fc895-176">Sélectionnez la zone de texte, copiez-la dans le presse-papiers, puis collez-la dans le `ProductName` TemplateField s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="fc895-177">Modifiez la propriété TextBox s `ID` en `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="fc895-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="fc895-178">Ensuite, ajoutez un RequiredFieldValidator au `ItemTemplate` pour vous assurer que l’utilisateur fournit une valeur pour chaque nom de produit.</span><span class="sxs-lookup"><span data-stu-id="fc895-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="fc895-179">Affectez à la propriété `ControlToValidate` la valeur ProductName, la propriété `ErrorMessage` à vous devez fournir le nom du produit.</span><span class="sxs-lookup"><span data-stu-id="fc895-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="fc895-180">et la propriété `Text` à \*.</span><span class="sxs-lookup"><span data-stu-id="fc895-180">and the `Text` property to \*.</span></span> <span data-ttu-id="fc895-181">Après avoir apporté ces ajouts au `ItemTemplate`, votre écran doit ressembler à la figure 6.</span><span class="sxs-lookup"><span data-stu-id="fc895-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="fc895-182">[![le TemplateField ProductName comprend désormais une zone de texte et un contrôle RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span></span>

<span data-ttu-id="fc895-183">**Figure 6**: le `ProductName` TemplateField comprend maintenant une zone de texte et un contrôle RequiredFieldValidator ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-vb/_static/image10.png))</span></span>

<span data-ttu-id="fc895-184">Pour l’interface de modification `UnitPrice`, commencez par copier la zone de texte du `EditItemTemplate` vers le `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="fc895-185">Ensuite, placez un $ devant la zone de texte et affectez à sa propriété `ID` la valeur UnitPrice et à sa propriété `Columns` la valeur 8.</span><span class="sxs-lookup"><span data-stu-id="fc895-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="fc895-186">Ajoutez également un CompareValidator au `UnitPrice` s `ItemTemplate` pour vous assurer que la valeur entrée par l’utilisateur est une valeur monétaire valide supérieure ou égale à $0,00.</span><span class="sxs-lookup"><span data-stu-id="fc895-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="fc895-187">Affectez à la propriété validateur s `ControlToValidate` la valeur UnitPrice, sa propriété `ErrorMessage` à vous devez entrer une valeur de devise valide.</span><span class="sxs-lookup"><span data-stu-id="fc895-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="fc895-188">Omettez les symboles monétaires., sa propriété `Text` à \*, sa propriété `Type` à `Currency`, sa propriété `Operator` à `GreaterThanEqual`, et sa propriété `ValueToCompare` à 0.</span><span class="sxs-lookup"><span data-stu-id="fc895-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="fc895-189">[![ajouter un CompareValidator pour vous assurer que le prix entré est une valeur monétaire non négative](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span></span>

<span data-ttu-id="fc895-190">**Figure 7**: ajouter un CompareValidator pour vous assurer que le prix entré est une valeur monétaire non négative ([cliquez pour afficher l’image en plein écran](batch-updating-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-vb/_static/image12.png))</span></span>

<span data-ttu-id="fc895-191">Pour le `Discontinued` TemplateField, vous pouvez utiliser la case à cocher déjà définie dans le `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="fc895-192">Il vous suffit de définir son `ID` sur Discontinued et sa propriété `Enabled` sur `True`.</span><span class="sxs-lookup"><span data-stu-id="fc895-192">Simply set its `ID` to Discontinued and its `Enabled` property to `True`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="fc895-193">Étape 3 : création de l’interface de modification`CategoryName`</span><span class="sxs-lookup"><span data-stu-id="fc895-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="fc895-194">L’interface de modification dans le `CategoryName` TemplateField s `EditItemTemplate` contient une zone de texte qui affiche la valeur du champ de données `CategoryName`.</span><span class="sxs-lookup"><span data-stu-id="fc895-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="fc895-195">Nous devons remplacer ceci par un DropDownList qui répertorie les catégories possibles.</span><span class="sxs-lookup"><span data-stu-id="fc895-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="fc895-196">Le didacticiel [Personnalisation de l’interface de modification des données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) contient une discussion plus complète et détaillée sur la personnalisation d’un modèle pour inclure un contrôle DropDownList par opposition à une zone de texte.</span><span class="sxs-lookup"><span data-stu-id="fc895-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="fc895-197">Tandis que les étapes sont terminées, elles sont présentées tersely.</span><span class="sxs-lookup"><span data-stu-id="fc895-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="fc895-198">Pour une analyse plus approfondie de la création et de la configuration des catégories DropDownList, reportez-vous au didacticiel [Personnalisation de l’interface de modification des données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="fc895-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span>

<span data-ttu-id="fc895-199">Faites glisser un DropDownList de la boîte à outils vers le `CategoryName` TemplateField s `ItemTemplate`, en affectant à sa `ID` la valeur `Categories`.</span><span class="sxs-lookup"><span data-stu-id="fc895-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="fc895-200">À ce stade, nous allons généralement définir la source de données DropDownList s par le biais de sa balise active, créant ainsi un ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="fc895-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="fc895-201">Toutefois, cette opération ajoute l’ObjectDataSource dans le `ItemTemplate`, ce qui entraîne la création d’une instance ObjectDataSource pour chaque ligne GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="fc895-202">Au lieu de cela, nous allons créer l’ObjectDataSource en dehors de la TemplateFields de GridView s.</span><span class="sxs-lookup"><span data-stu-id="fc895-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="fc895-203">Mettez fin à la modification du modèle et faites glisser un ObjectDataSource de la boîte à outils vers le concepteur sous le `ProductsDataSource` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="fc895-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="fc895-204">Nommez le nouvel ObjectDataSource `CategoriesDataSource` et configurez-le pour qu’il utilise la méthode de `CategoriesBLL` classe s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="fc895-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="fc895-205">[![configurer ObjectDataSource pour utiliser la classe CategoriesBLL](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span></span>

<span data-ttu-id="fc895-206">**Figure 8**: configurer ObjectDataSource pour utiliser la classe `CategoriesBLL` ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image14.png))</span></span>

<span data-ttu-id="fc895-207">[![récupérer les données de catégorie à l’aide de la méthode GetCategories](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span></span>

<span data-ttu-id="fc895-208">**Figure 9**: récupérer les données de catégorie à l’aide de la méthode `GetCategories` ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-vb/_static/image16.png))</span></span>

<span data-ttu-id="fc895-209">Comme cet ObjectDataSource est utilisé uniquement pour récupérer des données, définissez les listes déroulantes dans les onglets mettre à jour et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="fc895-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="fc895-210">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="fc895-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="fc895-211">[![définir les listes déroulantes dans les onglets mettre à jour et supprimer sur (aucun)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span></span>

<span data-ttu-id="fc895-212">**Figure 10**: définir les listes déroulantes des onglets mettre à jour et supprimer sur (aucun) ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image18.png))</span></span>

<span data-ttu-id="fc895-213">Une fois l’exécution de l’Assistant terminée, le balisage déclaratif `CategoriesDataSource` s doit se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="fc895-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample2.aspx)]

<span data-ttu-id="fc895-214">Une fois le `CategoriesDataSource` créé et configuré, revenez au `CategoryName` TemplateField s `ItemTemplate` et, à partir de la balise active DropDownList, cliquez sur le lien choisir la source de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="fc895-215">Dans l’Assistant Configuration de source de données, sélectionnez l’option `CategoriesDataSource` dans la première liste déroulante et choisissez de faire en sorte que `CategoryName` utilisé pour l’affichage et `CategoryID` comme valeur.</span><span class="sxs-lookup"><span data-stu-id="fc895-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="fc895-216">[![lier le DropDownList à CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span></span>

<span data-ttu-id="fc895-217">**Figure 11**: lier le DropDownList à l' `CategoriesDataSource` ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-vb/_static/image20.png))</span></span>

<span data-ttu-id="fc895-218">À ce stade, le `Categories` DropDownList répertorie toutes les catégories, mais ne sélectionne pas encore automatiquement la catégorie appropriée pour le produit lié à la ligne GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="fc895-219">Pour ce faire, nous devons définir le `SelectedValue` `Categories` DropDownList sur la valeur `CategoryID` du produit.</span><span class="sxs-lookup"><span data-stu-id="fc895-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="fc895-220">Cliquez sur le lien modifier les DataBindings de la balise active DropDownList et associez la propriété `SelectedValue` avec le champ de données `CategoryID`, comme indiqué dans la figure 12.</span><span class="sxs-lookup"><span data-stu-id="fc895-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Lier la valeur RéfCatégorie du produit à la propriété SelectedValue s de DropDownList](batch-updating-vb/_static/image12.gif)

<span data-ttu-id="fc895-222">**Figure 12**: lier la valeur du `CategoryID` du produit à la propriété DropDownList s `SelectedValue`</span><span class="sxs-lookup"><span data-stu-id="fc895-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="fc895-223">Un dernier problème subsiste : si le produit n’a pas de valeur `CategoryID` spécifiée, l’instruction DataBinding sur `SelectedValue` entraîne une exception.</span><span class="sxs-lookup"><span data-stu-id="fc895-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="fc895-224">Cela est dû au fait que le DropDownList contient uniquement des éléments pour les catégories et n’offre pas d’option pour les produits qui ont une valeur de base de données `NULL` pour `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="fc895-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="fc895-225">Pour remédier à cela, définissez la propriété DropDownList s `AppendDataBoundItems` sur `True` et ajoutez un nouvel élément à la DropDownList, en omettant la propriété `Value` de la syntaxe déclarative.</span><span class="sxs-lookup"><span data-stu-id="fc895-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `True` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="fc895-226">Autrement dit, assurez-vous que la syntaxe déclarative de `Categories` DropDownList ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="fc895-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample3.aspx)]

<span data-ttu-id="fc895-227">Notez comment la `<asp:ListItem Value="">`--Select One--a son attribut `Value` explicitement défini sur une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="fc895-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="fc895-228">Reportez-vous au didacticiel [Personnalisation de l’interface de modification des données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) pour une discussion plus approfondie sur la raison pour laquelle cet élément DropDownList supplémentaire est nécessaire pour gérer le cas `NULL` et pourquoi l’affectation de la propriété `Value` à une chaîne vide est essentielle.</span><span class="sxs-lookup"><span data-stu-id="fc895-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="fc895-229">Il y a un problème de performances et d’évolutivité potentiel qui mérite d’être mentionné.</span><span class="sxs-lookup"><span data-stu-id="fc895-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="fc895-230">Étant donné que chaque ligne a un DropDownList qui utilise le `CategoriesDataSource` comme source de données, la méthode `CategoriesBLL` classe s `GetCategories` sera appelée *n* fois par visite de page, où *n* est le nombre de lignes dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="fc895-231">Ces *n* appels à `GetCategories` aboutissent à *n* requêtes dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="fc895-232">Cet impact sur la base de données peut être atténué en mettant en cache les catégories retournées dans un cache par requête ou via la couche de mise en cache à l’aide d’une dépendance de mise en cache SQL ou d’une date d’expiration très brève.</span><span class="sxs-lookup"><span data-stu-id="fc895-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="fc895-233">Pour plus d’informations sur l’option de mise en cache par demande, consultez [`HttpContext.Items` un magasin de cache par demande](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="fc895-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="fc895-234">Étape 4 : fin de l’interface de modification</span><span class="sxs-lookup"><span data-stu-id="fc895-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="fc895-235">Nous avons apporté un certain nombre de modifications aux modèles GridView s sans pause pour voir notre progression.</span><span class="sxs-lookup"><span data-stu-id="fc895-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="fc895-236">Prenez un moment pour voir notre progression dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="fc895-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="fc895-237">Comme le montre la figure 13, chaque ligne est rendue à l’aide de son `ItemTemplate`, qui contient l’interface de modification des cellules.</span><span class="sxs-lookup"><span data-stu-id="fc895-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="fc895-238">[![chaque ligne GridView est modifiable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-238">[![Each GridView Row is Editable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span></span>

<span data-ttu-id="fc895-239">**Figure 13**: chaque ligne GridView est modifiable ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-vb/_static/image22.png))</span></span>

<span data-ttu-id="fc895-240">Il y a quelques problèmes de mise en forme mineurs que nous devrions prendre en charge à ce stade.</span><span class="sxs-lookup"><span data-stu-id="fc895-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="fc895-241">Tout d’abord, Notez que la valeur `UnitPrice` contient quatre points décimaux.</span><span class="sxs-lookup"><span data-stu-id="fc895-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="fc895-242">Pour résoudre ce problème, revenez au `UnitPrice` TemplateField s `ItemTemplate` et, à partir de la balise active TextBox s, cliquez sur le lien modifier les DataBindings.</span><span class="sxs-lookup"><span data-stu-id="fc895-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="fc895-243">Ensuite, spécifiez que la propriété `Text` doit être mise en forme en tant que nombre.</span><span class="sxs-lookup"><span data-stu-id="fc895-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Mettre en forme la propriété Text en tant que nombre](batch-updating-vb/_static/image14.gif)

<span data-ttu-id="fc895-245">**Figure 14**: mettre en forme la propriété `Text` en tant que nombre</span><span class="sxs-lookup"><span data-stu-id="fc895-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="fc895-246">Ensuite, laissez le centrer la case à cocher dans la colonne `Discontinued` (au lieu de l’aligner à gauche).</span><span class="sxs-lookup"><span data-stu-id="fc895-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="fc895-247">Cliquez sur modifier les colonnes dans la balise active de GridView s et sélectionnez le `Discontinued` TemplateField dans la liste des champs dans le coin inférieur gauche.</span><span class="sxs-lookup"><span data-stu-id="fc895-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="fc895-248">Explorez `ItemStyle` et affectez à la propriété `HorizontalAlign` la valeur Center, comme illustré dans la figure 15.</span><span class="sxs-lookup"><span data-stu-id="fc895-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Centrer la case à cocher abandonnée](batch-updating-vb/_static/image15.gif)

<span data-ttu-id="fc895-250">**Figure 15**: centrage de la case à cocher `Discontinued`</span><span class="sxs-lookup"><span data-stu-id="fc895-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="fc895-251">Ensuite, ajoutez un contrôle ValidationSummary à la page et affectez à sa propriété `ShowMessageBox` la valeur `True` et à sa propriété `ShowSummary` la valeur `False`.</span><span class="sxs-lookup"><span data-stu-id="fc895-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="fc895-252">Ajoutez également les contrôles Web Button qui, lorsque vous cliquez dessus, mettent à jour les modifications des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="fc895-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="fc895-253">En particulier, ajoutez deux contrôles Web Button, l’un au-dessus de GridView et l’autre au-dessous, en définissant les deux contrôles `Text` propriétés pour mettre à jour les produits.</span><span class="sxs-lookup"><span data-stu-id="fc895-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="fc895-254">Étant donné que l’interface de modification de GridView est définie dans son TemplateFields `ItemTemplate` s, les `EditItemTemplate` s sont superflues et peuvent être supprimées.</span><span class="sxs-lookup"><span data-stu-id="fc895-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="fc895-255">Après avoir effectué les modifications de mise en forme mentionnées ci-dessus, l’ajout des contrôles Button et la suppression des `EditItemTemplate` s inutiles, la syntaxe déclarative de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="fc895-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample4.aspx)]

<span data-ttu-id="fc895-256">La figure 16 illustre cette page quand elle est affichée dans un navigateur après l’ajout du bouton contrôles Web et la mise en forme des modifications apportées.</span><span class="sxs-lookup"><span data-stu-id="fc895-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="fc895-257">[![la page comprend désormais deux boutons mettre à jour les produits](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="fc895-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span></span>

<span data-ttu-id="fc895-258">**Figure 16**: la page comprend désormais deux boutons mettre à jour les produits ([cliquez pour afficher l’image en taille réelle](batch-updating-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="fc895-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-vb/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="fc895-259">Étape 5 : mise à jour des produits</span><span class="sxs-lookup"><span data-stu-id="fc895-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="fc895-260">Lorsqu’un utilisateur visite cette page, il effectue ses modifications, puis clique sur l’un des deux boutons mettre à jour les produits.</span><span class="sxs-lookup"><span data-stu-id="fc895-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="fc895-261">À ce stade, nous devons enregistrer les valeurs entrées par l’utilisateur pour chaque ligne dans une instance de `ProductsDataTable`, puis les transmettre à une méthode BLL qui transmet ensuite cette `ProductsDataTable` instance à la méthode de `UpdateWithTransaction` DAL.</span><span class="sxs-lookup"><span data-stu-id="fc895-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="fc895-262">La méthode `UpdateWithTransaction`, que nous avons créée dans le [didacticiel précédent](wrapping-database-modifications-within-a-transaction-vb.md), garantit que le lot de modifications sera mis à jour en tant qu’opération atomique.</span><span class="sxs-lookup"><span data-stu-id="fc895-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="fc895-263">Créez une méthode nommée `BatchUpdate` dans `BatchUpdate.aspx.vb` et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="fc895-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.vb` and add the following code:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample5.vb)]

<span data-ttu-id="fc895-264">Cette méthode démarre en réobtenant tous les produits dans un `ProductsDataTable` via un appel à la méthode de `GetProducts` BLL s.</span><span class="sxs-lookup"><span data-stu-id="fc895-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="fc895-265">Il énumère ensuite la collection `ProductGrid` GridView s [`Rows`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fc895-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="fc895-266">La collection `Rows` contient une [instance`GridViewRow`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) pour chaque ligne affichée dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="fc895-267">Étant donné que nous affichons au maximum dix lignes par page, la collection de `Rows` GridView ne comportera pas plus de dix éléments.</span><span class="sxs-lookup"><span data-stu-id="fc895-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="fc895-268">Pour chaque ligne, le `ProductID` est retiré de la collection `DataKeys` et le `ProductsRow` approprié est sélectionné dans le `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="fc895-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="fc895-269">Les quatre contrôles d’entrée TemplateField sont référencés par programmation et leurs valeurs affectées aux propriétés de l’instance `ProductsRow` s.</span><span class="sxs-lookup"><span data-stu-id="fc895-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="fc895-270">Une fois que chaque valeur des lignes de GridView a été utilisée pour mettre à jour le `ProductsDataTable`, elle est transmise à la méthode de `UpdateWithTransaction` BLL s qui, comme nous l’avons vu dans le didacticiel précédent, appelle simplement la méthode DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="fc895-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="fc895-271">L’algorithme de mise à jour par lot utilisé pour ce didacticiel met à jour chaque ligne de la `ProductsDataTable` qui correspond à une ligne dans le GridView, que les informations sur le produit aient été modifiées ou non.</span><span class="sxs-lookup"><span data-stu-id="fc895-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="fc895-272">Bien que ces mises à jour aveugles ne soient généralement pas un problème de performance, elles peuvent entraîner des enregistrements superflus si vous renouvelez l’audit des modifications apportées à la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="fc895-273">Dans le didacticiel sur l' [exécution des mises à jour par lots](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) , nous avons exploré une interface de mise à jour par lot avec la DataList et ajouté du code qui permet de mettre à jour uniquement les enregistrements qui ont été modifiés par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="fc895-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="fc895-274">N’hésitez pas à utiliser les techniques d' [exécution des mises à jour par lots](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) pour mettre à jour le code de ce didacticiel, si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="fc895-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="fc895-275">Lors de la liaison de la source de données au contrôle GridView par le biais de sa balise active, Visual Studio attribue automatiquement la ou les valeurs de clé primaire de la source de données à la propriété GridView s `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="fc895-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="fc895-276">Si vous n’avez pas lié ObjectDataSource au GridView via la balise active GridView s comme indiqué à l’étape 1, vous devez définir manuellement la propriété GridView s `DataKeyNames` sur ProductID pour accéder à la valeur `ProductID` pour chaque ligne via la collection `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="fc895-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="fc895-277">Le code utilisé dans `BatchUpdate` est semblable à celui utilisé dans les méthodes de `UpdateProduct` BLL s. la principale différence réside dans le fait que dans les méthodes de `UpdateProduct`, une seule instance de `ProductRow` est Récupérée de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="fc895-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="fc895-278">Le code qui affecte les propriétés de l' `ProductRow` est le même entre les méthodes `UpdateProducts` et le code de la boucle `For Each` dans `BatchUpdate`, comme le modèle global.</span><span class="sxs-lookup"><span data-stu-id="fc895-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `For Each` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="fc895-279">Pour suivre ce didacticiel, la méthode `BatchUpdate` doit être appelée lors d’un clic sur l’un des boutons des produits de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="fc895-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="fc895-280">Créez des gestionnaires d’événements pour les événements `Click` de ces deux contrôles Button et ajoutez le code suivant dans les gestionnaires d’événements :</span><span class="sxs-lookup"><span data-stu-id="fc895-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample6.vb)]

<span data-ttu-id="fc895-281">Tout d’abord, un appel est effectué pour `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="fc895-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="fc895-282">Ensuite, la [propriété`ClientScript`](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) est utilisée pour injecter du code JavaScript qui affichera un MessageBox qui lit les produits qui ont été mis à jour.</span><span class="sxs-lookup"><span data-stu-id="fc895-282">Next, the [`ClientScript` property](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="fc895-283">Prenez quelques minutes pour tester ce code.</span><span class="sxs-lookup"><span data-stu-id="fc895-283">Take a minute to test out this code.</span></span> <span data-ttu-id="fc895-284">Visitez `BatchUpdate.aspx` dans un navigateur, modifiez plusieurs lignes et cliquez sur l’un des boutons mettre à jour les produits.</span><span class="sxs-lookup"><span data-stu-id="fc895-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="fc895-285">En supposant qu’il n’y ait pas d’erreurs de validation d’entrée, vous devez voir une MessageBox qui lit les produits qui ont été mis à jour.</span><span class="sxs-lookup"><span data-stu-id="fc895-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="fc895-286">Pour vérifier l’atomicité de la mise à jour, envisagez d’ajouter une contrainte de `CHECK` aléatoire, comme celle qui interdit `UnitPrice` valeurs de 1234,56.</span><span class="sxs-lookup"><span data-stu-id="fc895-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="fc895-287">Ensuite, à partir de `BatchUpdate.aspx`, modifiez un nombre d’enregistrements, en veillant à définir l’une des valeurs de `UnitPrice` du produit sur la valeur interdite (1234,56).</span><span class="sxs-lookup"><span data-stu-id="fc895-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="fc895-288">Cela devrait entraîner une erreur lorsque vous cliquez sur mettre à jour les produits avec les autres modifications au cours de l’opération de traitement par lot restaurées à leurs valeurs d’origine.</span><span class="sxs-lookup"><span data-stu-id="fc895-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="fc895-289">Une autre méthode de`BatchUpdate`</span><span class="sxs-lookup"><span data-stu-id="fc895-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="fc895-290">La méthode `BatchUpdate` que nous venons d’examiner récupère *tous* les produits de la méthode de `GetProducts` BLL s et met à jour uniquement les enregistrements qui s’affichent dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="fc895-291">Cette approche est idéale si le contrôle GridView n’utilise pas la pagination, mais dans le cas contraire, il peut y avoir des centaines, des milliers ou des dizaines de milliers de produits, mais seulement dix lignes dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="fc895-292">Dans ce cas, l’obtention de tous les produits de la base de données uniquement pour modifier 10 d’entre eux est moins que idéale.</span><span class="sxs-lookup"><span data-stu-id="fc895-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="fc895-293">Pour ces types de situations, envisagez d’utiliser la méthode `BatchUpdateAlternate` suivante à la place :</span><span class="sxs-lookup"><span data-stu-id="fc895-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample7.vb)]

<span data-ttu-id="fc895-294">`BatchMethodAlternate` commence par créer un `ProductsDataTable` vide nommé `products`.</span><span class="sxs-lookup"><span data-stu-id="fc895-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="fc895-295">Il parcourt ensuite la collection de `Rows` GridView et, pour chaque ligne, obtient les informations de produit spécifiques à l’aide de la méthode de `GetProductByProductID(productID)` BLL s.</span><span class="sxs-lookup"><span data-stu-id="fc895-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="fc895-296">Les propriétés de l’instance de `ProductsRow` Récupérée sont mises à jour de la même façon que `BatchUpdate`, mais après la mise à jour de la ligne, elle est importée dans le `ProductsDataTable` `products` via la méthode DataTable s [`ImportRow(DataRow)`](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="fc895-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products` `ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="fc895-297">Une fois la `For Each` boucle terminée, `products` contient une instance `ProductsRow` pour chaque ligne du contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-297">After the `For Each` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="fc895-298">Étant donné que chaque instance de `ProductsRow` a été ajoutée à la `products` (au lieu d’être mise à jour), si nous la passons en aveugle à la méthode `UpdateWithTransaction`, le `ProductsTableAdapter` essaiera d’insérer chacun des enregistrements dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="fc895-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="fc895-299">Au lieu de cela, nous devons spécifier que chacune de ces lignes a été modifiée (pas ajoutée).</span><span class="sxs-lookup"><span data-stu-id="fc895-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="fc895-300">Pour ce faire, vous pouvez ajouter une nouvelle méthode à la couche BLL nommée `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="fc895-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="fc895-301">`UpdateProductsWithTransaction`, comme indiqué ci-dessous, définit la `RowState` de chacune des instances `ProductsRow` de l' `ProductsDataTable` sur `Modified`, puis passe la `ProductsDataTable` à la méthode de `UpdateWithTransaction` DAL s.</span><span class="sxs-lookup"><span data-stu-id="fc895-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample8.vb)]

## <a name="summary"></a><span data-ttu-id="fc895-302">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="fc895-302">Summary</span></span>

<span data-ttu-id="fc895-303">Le GridView fournit des fonctionnalités d’édition par ligne intégrées, mais ne prend pas en charge la création d’interfaces entièrement modifiables.</span><span class="sxs-lookup"><span data-stu-id="fc895-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="fc895-304">Comme nous l’avons vu dans ce didacticiel, de telles interfaces sont possibles, mais nécessitent un peu de travail.</span><span class="sxs-lookup"><span data-stu-id="fc895-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="fc895-305">Pour créer un contrôle GridView où chaque ligne est modifiable, nous devons convertir les champs GridView s en TemplateFields et définir l’interface de modification dans le `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="fc895-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="fc895-306">En outre, la mise à jour des contrôles Web des boutons tous les types doit être ajoutée à la page, séparément du contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="fc895-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="fc895-307">Ces boutons `Click` gestionnaires d’événements doivent énumérer la collection de `Rows` GridView s, stocker les modifications dans un `ProductsDataTable`et transmettre les informations mises à jour dans la méthode BLL appropriée.</span><span class="sxs-lookup"><span data-stu-id="fc895-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="fc895-308">Dans le didacticiel suivant, nous allons apprendre à créer une interface pour la suppression par lots.</span><span class="sxs-lookup"><span data-stu-id="fc895-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="fc895-309">En particulier, chaque ligne GridView inclut une case à cocher et, au lieu de mettre à jour tous les boutons de type, les boutons supprimer les lignes sélectionnées s’affichent.</span><span class="sxs-lookup"><span data-stu-id="fc895-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="fc895-310">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="fc895-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="fc895-311">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="fc895-311">About the Author</span></span>

<span data-ttu-id="fc895-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="fc895-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fc895-313">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="fc895-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fc895-314">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="fc895-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="fc895-315">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fc895-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="fc895-316">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="fc895-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="fc895-317">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="fc895-317">Special Thanks To</span></span>

<span data-ttu-id="fc895-318">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="fc895-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fc895-319">Les réviseurs de leads pour ce didacticiel étaient Teresa Murphy et David SURU.</span><span class="sxs-lookup"><span data-stu-id="fc895-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="fc895-320">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="fc895-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fc895-321">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fc895-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="fc895-322">[Précédent](wrapping-database-modifications-within-a-transaction-vb.md)
> [Suivant](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="fc895-322">[Previous](wrapping-database-modifications-within-a-transaction-vb.md)
[Next](batch-deleting-vb.md)</span></span>
