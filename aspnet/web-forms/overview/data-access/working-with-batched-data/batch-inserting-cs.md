---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: Insertion par lotsC#() | Microsoft Docs
author: rick-anderson
description: Apprenez à insérer plusieurs enregistrements de base de données en une seule opération. Dans la couche d’interface utilisateur, nous étendons le contrôle GridView pour permettre à l’utilisateur d’entrer plusieurs n...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 5dc4d0b6ac9bf3aa2baa54fe9f5d4149494e47d2
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74584756"
---
# <a name="batch-inserting-c"></a><span data-ttu-id="5427a-104">Insertion par lots (C#)</span><span class="sxs-lookup"><span data-stu-id="5427a-104">Batch Inserting (C#)</span></span>

<span data-ttu-id="5427a-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5427a-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5427a-106">[Télécharger le code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) ou [Télécharger le PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5427a-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="5427a-107">Apprenez à insérer plusieurs enregistrements de base de données en une seule opération.</span><span class="sxs-lookup"><span data-stu-id="5427a-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="5427a-108">Dans la couche d’interface utilisateur, nous étendons le contrôle GridView pour permettre à l’utilisateur d’entrer plusieurs nouveaux enregistrements.</span><span class="sxs-lookup"><span data-stu-id="5427a-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="5427a-109">Dans la couche d’accès aux données, nous encapsulons les multiples opérations d’insertion dans une transaction pour vous assurer que toutes les insertions ont été effectuées ou que toutes les insertions sont annulées.</span><span class="sxs-lookup"><span data-stu-id="5427a-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="5427a-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="5427a-110">Introduction</span></span>

<span data-ttu-id="5427a-111">Dans le didacticiel de [mise à jour par lot](batch-updating-cs.md) , nous avons examiné la personnalisation du contrôle GridView pour présenter une interface dans laquelle plusieurs enregistrements étaient modifiables.</span><span class="sxs-lookup"><span data-stu-id="5427a-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="5427a-112">L’utilisateur visitant la page peut apporter une série de modifications, puis, avec un seul clic de bouton, effectuer une mise à jour par lot.</span><span class="sxs-lookup"><span data-stu-id="5427a-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="5427a-113">Dans les situations où les utilisateurs mettent généralement à jour un grand nombre d’enregistrements en une seule fois, une telle interface peut réduire les clics et les changements de contexte du clavier à la souris par rapport aux fonctionnalités d’édition par ligne par défaut qui ont été examinées pour la première fois dans le didacticiel sur l' [insertion, la mise à jour et la suppression des données](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="5427a-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="5427a-114">Ce concept peut également être appliqué lors de l’ajout d’enregistrements.</span><span class="sxs-lookup"><span data-stu-id="5427a-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="5427a-115">Imaginez que chez Northwind Traders, nous recevons habituellement des expéditions de fournisseurs qui contiennent un certain nombre de produits pour une catégorie particulière.</span><span class="sxs-lookup"><span data-stu-id="5427a-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="5427a-116">À titre d’exemple, nous pouvons recevoir une livraison de six produits de thé et de café différents de Tokyo Traders.</span><span class="sxs-lookup"><span data-stu-id="5427a-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="5427a-117">Si un utilisateur entre les six produits un par un à l’aide d’un contrôle DetailsView, il devra choisir un grand nombre des mêmes valeurs plusieurs fois : il devra choisir la même catégorie (boissons), le même fournisseur (Tokyo Traders), la même valeur abandonnée ( False) et les mêmes unités sur la valeur de la commande (0).</span><span class="sxs-lookup"><span data-stu-id="5427a-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="5427a-118">Cette entrée de données répétitive n’est pas seulement une opération fastidieuse, mais elle est sujette aux erreurs.</span><span class="sxs-lookup"><span data-stu-id="5427a-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="5427a-119">Avec un peu de travail, nous pouvons créer une interface d’insertion par lot qui permet à l’utilisateur de choisir le fournisseur et la catégorie une seule fois, d’entrer une série de noms de produits et de prix unitaires, puis de cliquer sur un bouton pour ajouter les nouveaux produits à la base de données (voir la figure 1).</span><span class="sxs-lookup"><span data-stu-id="5427a-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="5427a-120">À mesure que chaque produit est ajouté, les valeurs entrées dans les zones de texte `ProductName` et `UnitPrice` sont affectées aux valeurs entrées dans les zones de texte, tandis que les valeurs `CategoryID` et `SupplierID` sont affectées aux valeurs du DropDownList en haut du formulaire.</span><span class="sxs-lookup"><span data-stu-id="5427a-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="5427a-121">Les valeurs `Discontinued` et `UnitsOnOrder` sont définies sur les valeurs codées en dur de `false` et 0, respectivement.</span><span class="sxs-lookup"><span data-stu-id="5427a-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>

<span data-ttu-id="5427a-122">[![l’interface d’insertion de lot](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="5427a-123">**Figure 1**: interface d’insertion de lot ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>

<span data-ttu-id="5427a-124">Dans ce didacticiel, nous allons créer une page qui implémente l’interface d’insertion de lot illustrée à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="5427a-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="5427a-125">Comme pour les deux didacticiels précédents, nous encapsulerons les insertions dans l’étendue d’une transaction pour garantir l’atomicité.</span><span class="sxs-lookup"><span data-stu-id="5427a-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="5427a-126">Commençons !</span><span class="sxs-lookup"><span data-stu-id="5427a-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="5427a-127">Étape 1 : création de l’interface d’affichage</span><span class="sxs-lookup"><span data-stu-id="5427a-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="5427a-128">Ce didacticiel se compose d’une seule page divisée en deux régions : une zone d’affichage et une région d’insertion.</span><span class="sxs-lookup"><span data-stu-id="5427a-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="5427a-129">L’interface d’affichage, que nous allons créer dans cette étape, affiche les produits dans un GridView et comprend un bouton intitulé traiter le produit expédition.</span><span class="sxs-lookup"><span data-stu-id="5427a-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="5427a-130">Lorsque vous cliquez sur ce bouton, l’interface d’affichage est remplacée par l’interface d’insertion, illustrée à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="5427a-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="5427a-131">L’interface d’affichage retourne une fois que vous avez cliqué sur les boutons ajouter des produits à partir de l’expédition ou annuler.</span><span class="sxs-lookup"><span data-stu-id="5427a-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="5427a-132">Nous allons créer l’interface d’insertion à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="5427a-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="5427a-133">Lors de la création d’une page qui a deux interfaces, une seule qui est visible à la fois, chaque interface est généralement placée dans un [contrôle Web Panel](http://www.w3schools.com/aspnet/control_panel.asp), qui sert de conteneur pour d’autres contrôles.</span><span class="sxs-lookup"><span data-stu-id="5427a-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="5427a-134">Par conséquent, notre page disposera de deux contrôles Panel, un pour chaque interface.</span><span class="sxs-lookup"><span data-stu-id="5427a-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="5427a-135">Commencez par ouvrir la page `BatchInsert.aspx` dans le dossier `BatchData` et faites glisser un panneau de la boîte à outils vers le concepteur (voir figure 2).</span><span class="sxs-lookup"><span data-stu-id="5427a-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="5427a-136">Définissez la propriété Panel s `ID` sur `DisplayInterface`.</span><span class="sxs-lookup"><span data-stu-id="5427a-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="5427a-137">Lorsque vous ajoutez le panneau au concepteur, ses propriétés `Height` et `Width` sont définies sur 50px et 125px, respectivement.</span><span class="sxs-lookup"><span data-stu-id="5427a-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="5427a-138">Effacez ces valeurs de propriété de la Fenêtre Propriétés.</span><span class="sxs-lookup"><span data-stu-id="5427a-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="5427a-139">[![faire glisser un panneau de la boîte à outils vers le concepteur](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="5427a-140">**Figure 2**: faire glisser un panneau de la boîte à outils vers le concepteur ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>

<span data-ttu-id="5427a-141">Ensuite, faites glisser un contrôle Button et GridView dans le panneau.</span><span class="sxs-lookup"><span data-stu-id="5427a-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="5427a-142">Affectez à la propriété Button s `ID` la valeur `ProcessShipment` et à sa propriété `Text` pour traiter l’expédition du produit.</span><span class="sxs-lookup"><span data-stu-id="5427a-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="5427a-143">Définissez la propriété GridView s `ID` sur `ProductsGrid` et, à partir de sa balise active, liez-la à un nouvel ObjectDataSource nommé `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5427a-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="5427a-144">Configurez le ObjectDataSource pour extraire ses données de la méthode de `GetProducts` de la classe `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="5427a-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="5427a-145">Étant donné que ce GridView est utilisé uniquement pour afficher des données, définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="5427a-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="5427a-146">Cliquez sur Terminer pour terminer l’Assistant Configuration de la source de données.</span><span class="sxs-lookup"><span data-stu-id="5427a-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="5427a-147">[![afficher les données retournées à partir de la méthode ProductsBLL de la classe s GetProducts](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="5427a-148">**Figure 3**: afficher les données retournées par la méthode `ProductsBLL` classe s `GetProducts` ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>

<span data-ttu-id="5427a-149">[![définir les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="5427a-150">**Figure 4**: définir les listes déroulantes des onglets mettre à jour, insérer et supprimer sur (aucun) ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>

<span data-ttu-id="5427a-151">Une fois l’exécution de l’Assistant ObjectDataSource terminée, Visual Studio ajoute BoundFields et CheckBoxField pour les champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="5427a-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="5427a-152">Supprimez tous les champs sauf les `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`et `Discontinued`.</span><span class="sxs-lookup"><span data-stu-id="5427a-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="5427a-153">N’hésitez pas à effectuer des personnalisations esthétiques.</span><span class="sxs-lookup"><span data-stu-id="5427a-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="5427a-154">J’ai décidé de mettre en forme le champ `UnitPrice` en tant que valeur monétaire, de réorganiser les champs et de renommer plusieurs champs `HeaderText` valeurs.</span><span class="sxs-lookup"><span data-stu-id="5427a-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="5427a-155">Configurez également le contrôle GridView pour inclure la prise en charge de la pagination et du tri en activant les cases à cocher Activer la pagination et activer le tri dans la balise active GridView s.</span><span class="sxs-lookup"><span data-stu-id="5427a-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="5427a-156">Après avoir ajouté les contrôles Panel, Button, GridView et ObjectDataSource et personnalisé les champs GridView s, le balisage déclaratif de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5427a-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="5427a-157">Notez que le balisage du bouton et de GridView apparaissent dans les balises d’ouverture et de fermeture `<asp:Panel>`.</span><span class="sxs-lookup"><span data-stu-id="5427a-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="5427a-158">Étant donné que ces contrôles se trouvent dans le panneau `DisplayInterface`, nous pouvons les masquer en affectant simplement à la propriété Panel s `Visible` la valeur `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="5427a-159">L’étape 3 examine par programmation la modification de la propriété Panel s `Visible` en réponse à un clic sur un bouton pour afficher une interface tout en masquant l’autre.</span><span class="sxs-lookup"><span data-stu-id="5427a-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="5427a-160">Prenez un moment pour voir notre progression dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="5427a-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="5427a-161">Comme le montre la figure 5, vous devez voir un bouton traiter le produit dans un contrôle GridView qui répertorie les produits dix à la fois.</span><span class="sxs-lookup"><span data-stu-id="5427a-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="5427a-162">[![le contrôle GridView répertorie les produits et propose des fonctionnalités de tri et de pagination](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="5427a-163">**Figure 5**: le contrôle GridView répertorie les produits et propose des fonctionnalités de tri et de pagination ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="5427a-164">Étape 2 : création de l’interface d’insertion</span><span class="sxs-lookup"><span data-stu-id="5427a-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="5427a-165">Une fois l’interface d’affichage terminée, nous sommes prêts à créer l’interface d’insertion.</span><span class="sxs-lookup"><span data-stu-id="5427a-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="5427a-166">Pour ce didacticiel, vous pouvez créer une interface d’insertion qui invite à fournir une valeur unique pour le fournisseur et la catégorie, puis permet à l’utilisateur d’entrer jusqu’à cinq noms de produits et des valeurs de prix unitaire.</span><span class="sxs-lookup"><span data-stu-id="5427a-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="5427a-167">Avec cette interface, l’utilisateur peut ajouter un à cinq nouveaux produits qui partagent tous la même catégorie et le même fournisseur, mais qui ont des noms de produits et des prix uniques.</span><span class="sxs-lookup"><span data-stu-id="5427a-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="5427a-168">Commencez par faire glisser un panneau de la boîte à outils vers le concepteur, en le plaçant sous le panneau `DisplayInterface` existant.</span><span class="sxs-lookup"><span data-stu-id="5427a-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="5427a-169">Définissez la propriété `ID` de ce panneau récemment ajouté sur `InsertingInterface` et définissez sa propriété `Visible` sur `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="5427a-170">Nous allons ajouter du code qui définit la propriété `InsertingInterface` du panneau `Visible` sur `true` à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="5427a-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="5427a-171">Désactivez également les valeurs de propriété Panel `Height` et `Width`.</span><span class="sxs-lookup"><span data-stu-id="5427a-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="5427a-172">Ensuite, nous devons créer l’interface d’insertion illustrée à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="5427a-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="5427a-173">Cette interface peut être créée à l’aide de diverses techniques HTML, mais nous allons utiliser une table à quatre colonnes et sept lignes.</span><span class="sxs-lookup"><span data-stu-id="5427a-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="5427a-174">Quand vous entrez le balisage pour les éléments de `<table>` HTML, je préfère utiliser le mode Source.</span><span class="sxs-lookup"><span data-stu-id="5427a-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="5427a-175">Alors que Visual Studio possède des outils permettant d’ajouter des éléments de `<table>` par le biais du concepteur, le concepteur semble être trop disposé à injecter des paramètres de `style` dans le balisage.</span><span class="sxs-lookup"><span data-stu-id="5427a-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="5427a-176">Une fois que j’ai créé le balisage `<table>`, je retourne généralement dans le concepteur pour ajouter les contrôles Web et définir leurs propriétés.</span><span class="sxs-lookup"><span data-stu-id="5427a-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="5427a-177">Lors de la création de tables avec des colonnes et des lignes prédéterminées, je préfère utiliser du code HTML statique plutôt que le [contrôle Web de table](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) , car tous les contrôles Web placés dans un contrôle Web table sont accessibles uniquement à l’aide du modèle `FindControl("controlID")`.</span><span class="sxs-lookup"><span data-stu-id="5427a-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="5427a-178">Toutefois, j’utilise des contrôles Web table pour les tables de taille dynamique (celles dont les lignes ou les colonnes sont basées sur une base de données ou des critères spécifiés par l’utilisateur), étant donné que le contrôle Web table peut être construit par programmation.</span><span class="sxs-lookup"><span data-stu-id="5427a-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="5427a-179">Entrez la balise suivante dans les balises `<asp:Panel>` du panneau `InsertingInterface` :</span><span class="sxs-lookup"><span data-stu-id="5427a-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="5427a-180">Ce balisage `<table>` n’inclut pas encore de contrôles Web, nous les ajouterons momentanément.</span><span class="sxs-lookup"><span data-stu-id="5427a-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="5427a-181">Notez que chaque élément `<tr>` contient un paramètre de classe CSS particulier : `BatchInsertHeaderRow` pour la ligne d’en-tête où le fournisseur et la catégorie DropDownList vont. `BatchInsertFooterRow` de la ligne de pied de page où se trouvent les boutons ajouter des produits à partir de l’expédition et annuler. et en alternant les valeurs `BatchInsertRow` et `BatchInsertAlternatingRow` pour les lignes qui contiendront les contrôles de zone de texte Product et Unit Price.</span><span class="sxs-lookup"><span data-stu-id="5427a-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="5427a-182">J’ai créé des classes CSS correspondantes dans le fichier `Styles.css` pour attribuer à l’interface d’insertion une apparence similaire aux contrôles GridView et DetailsView que nous avons utilisés dans ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="5427a-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="5427a-183">Ces classes CSS sont présentées ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="5427a-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="5427a-184">Une fois cette balise entrée, revenez à la Mode Création.</span><span class="sxs-lookup"><span data-stu-id="5427a-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="5427a-185">Cette `<table>` doit s’afficher sous la forme d’une table de quatre colonnes et sept lignes dans le concepteur, comme illustré dans la figure 6.</span><span class="sxs-lookup"><span data-stu-id="5427a-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="5427a-186">[![l’interface d’insertion est composée d’une table de quatre colonnes, sept lignes](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="5427a-187">**Figure 6**: l’interface d’insertion est composée d’une table de quatre colonnes, sept lignes ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>

<span data-ttu-id="5427a-188">Nous sommes maintenant prêts à ajouter les contrôles Web à l’interface d’insertion.</span><span class="sxs-lookup"><span data-stu-id="5427a-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="5427a-189">Faites glisser deux DropDownList de la boîte à outils vers les cellules appropriées de la table 1 pour le fournisseur et une pour la catégorie.</span><span class="sxs-lookup"><span data-stu-id="5427a-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="5427a-190">Définissez la propriété DropDownList s du fournisseur `ID` sur `Suppliers` et liez-la à un nouvel ObjectDataSource nommé `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5427a-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="5427a-191">Configurez le nouvel ObjectDataSource pour récupérer ses données à partir de la méthode `SuppliersBLL` classe s `GetSuppliers` et définissez la liste déroulante des tabulations de mise à jour sur (aucune).</span><span class="sxs-lookup"><span data-stu-id="5427a-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="5427a-192">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="5427a-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="5427a-193">[![configurer ObjectDataSource pour utiliser la méthode SuppliersBLL de la classe s GetSuppliers](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="5427a-194">**Figure 7**: configurer ObjectDataSource pour utiliser la méthode `SuppliersBLL` classe s `GetSuppliers` ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>

<span data-ttu-id="5427a-195">Faites en sorte que le `Suppliers` DropDownList affiche le champ de données `CompanyName` et utilisez le champ de données `SupplierID` comme valeurs de `ListItem` s.</span><span class="sxs-lookup"><span data-stu-id="5427a-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="5427a-196">[![afficher le champ de données CompanyName et utiliser RéfFournisseur comme valeur](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="5427a-197">**Figure 8**: afficher le champ de données `CompanyName` et utiliser `SupplierID` comme valeur ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>

<span data-ttu-id="5427a-198">Nommez la deuxième `Categories` DropDownList et liez-la à un nouvel ObjectDataSource nommé `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5427a-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="5427a-199">Configurez le `CategoriesDataSource` ObjectDataSource pour utiliser la méthode `GetCategories` de la classe `CategoriesBLL` ; Définissez les listes déroulantes dans les onglets mettre à jour et supprimer sur (aucun), puis cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="5427a-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="5427a-200">Enfin, faites en sorte que le DropDownList affiche le champ de données `CategoryName` et utilisez le `CategoryID` comme valeur.</span><span class="sxs-lookup"><span data-stu-id="5427a-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="5427a-201">Une fois ces deux DropDownList ajoutés et liés à des ObjectDataSources configurés correctement, votre écran doit ressembler à la figure 9.</span><span class="sxs-lookup"><span data-stu-id="5427a-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="5427a-202">[![la ligne d’en-tête contient désormais les fournisseurs et les catégories DropDownList](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="5427a-203">**Figure 9**: la ligne d’en-tête contient maintenant les `Suppliers` et `Categories` DropDownList ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>

<span data-ttu-id="5427a-204">Nous devons maintenant créer les zones de texte pour collecter le nom et le prix de chaque nouveau produit.</span><span class="sxs-lookup"><span data-stu-id="5427a-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="5427a-205">Faites glisser un contrôle TextBox de la boîte à outils vers le concepteur pour chacun des cinq lignes Product Name et Price.</span><span class="sxs-lookup"><span data-stu-id="5427a-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="5427a-206">Définissez les propriétés de `ID` des zones de texte sur `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="5427a-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="5427a-207">Ajoutez un CompareValidator après chaque zone de texte prix unitaire, en affectant à la propriété `ControlToValidate` la `ID`appropriée.</span><span class="sxs-lookup"><span data-stu-id="5427a-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="5427a-208">Définissez également la propriété `Operator` sur `GreaterThanEqual`, `ValueToCompare` sur 0 et `Type` sur `Currency`.</span><span class="sxs-lookup"><span data-stu-id="5427a-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="5427a-209">Ces paramètres indiquent à CompareValidator de s’assurer que le prix, s’il est entré, est une valeur monétaire valide supérieure ou égale à zéro.</span><span class="sxs-lookup"><span data-stu-id="5427a-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="5427a-210">Affectez à la propriété `Text` la valeur \*et `ErrorMessage` au prix doit être supérieur ou égal à zéro.</span><span class="sxs-lookup"><span data-stu-id="5427a-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="5427a-211">Par ailleurs, omettez les symboles monétaires.</span><span class="sxs-lookup"><span data-stu-id="5427a-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="5427a-212">L’interface d’insertion n’inclut pas de contrôles RequiredFieldValidator, même si le champ `ProductName` de la table de base de données `Products` n’autorise pas les valeurs `NULL`.</span><span class="sxs-lookup"><span data-stu-id="5427a-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="5427a-213">Cela est dû au fait que nous souhaitons permettre à l’utilisateur d’entrer jusqu’à cinq produits.</span><span class="sxs-lookup"><span data-stu-id="5427a-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="5427a-214">Par exemple, si l’utilisateur doit fournir le nom de produit et le prix unitaire pour les trois premières lignes, en laissant les deux dernières lignes vides, nous allons simplement ajouter trois nouveaux produits au système.</span><span class="sxs-lookup"><span data-stu-id="5427a-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="5427a-215">Étant donné que `ProductName` est requis, toutefois, nous devons vérifier par programmation si un prix unitaire est entré pour indiquer qu’une valeur de nom de produit correspondante est fournie.</span><span class="sxs-lookup"><span data-stu-id="5427a-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="5427a-216">Nous allons aborder ce contrôle à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="5427a-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="5427a-217">Lors de la validation de l’entrée de l’utilisateur, CompareValidator signale des données non valides si la valeur contient un symbole monétaire.</span><span class="sxs-lookup"><span data-stu-id="5427a-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="5427a-218">Ajoutez un $ devant chaque zone de texte prix unitaire pour servir d’indicateur visuel qui indique à l’utilisateur d’omettre le symbole monétaire lors de la saisie du prix.</span><span class="sxs-lookup"><span data-stu-id="5427a-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="5427a-219">Enfin, ajoutez un contrôle ValidationSummary dans le panneau `InsertingInterface`, paramètre sa propriété `ShowMessageBox` à `true` et sa propriété `ShowSummary` à `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="5427a-220">Avec ces paramètres, si l’utilisateur entre une valeur de prix unitaire non valide, un astérisque apparaît en regard des contrôles de zone de texte incriminés et le contrôle ValidationSummary affiche un MessageBox côté client qui affiche le message d’erreur que nous avons spécifié précédemment.</span><span class="sxs-lookup"><span data-stu-id="5427a-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="5427a-221">À ce stade, votre écran doit ressembler à la figure 10.</span><span class="sxs-lookup"><span data-stu-id="5427a-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="5427a-222">[![l’interface d’insertion comprend désormais des zones de texte pour les noms et les prix des produits](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="5427a-223">**Figure 10**: l’interface d’insertion comprend maintenant des zones de texte pour les noms de produits et les prix ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>

<span data-ttu-id="5427a-224">Ensuite, nous devons ajouter les boutons ajouter des produits à partir de l’expédition et annuler à la ligne de pied de page.</span><span class="sxs-lookup"><span data-stu-id="5427a-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="5427a-225">Faites glisser deux contrôles Button de la boîte à outils vers le pied de page de l’interface d’insertion, en définissant les boutons `ID` propriétés sur `AddProducts` et `CancelButton` et `Text` propriétés pour ajouter des produits à partir de l’expédition et annuler, respectivement.</span><span class="sxs-lookup"><span data-stu-id="5427a-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="5427a-226">En outre, définissez la propriété `CancelButton` contrôle s `CausesValidation` sur `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="5427a-227">Enfin, nous devons ajouter un contrôle Web Label qui affichera les messages d’État pour les deux interfaces.</span><span class="sxs-lookup"><span data-stu-id="5427a-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="5427a-228">Par exemple, lorsqu’un utilisateur ajoute avec succès une nouvelle livraison de produits, nous voulons revenir à l’interface d’affichage et afficher un message de confirmation.</span><span class="sxs-lookup"><span data-stu-id="5427a-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="5427a-229">Toutefois, si l’utilisateur fournit un prix pour un nouveau produit, mais ne quitte pas le nom du produit, nous devons afficher un message d’avertissement dans la mesure où le champ `ProductName` est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="5427a-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="5427a-230">Comme nous avons besoin de ce message pour afficher les deux interfaces, placez-le en haut de la page en dehors des panneaux.</span><span class="sxs-lookup"><span data-stu-id="5427a-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="5427a-231">Faites glisser un contrôle Web label de la boîte à outils vers le haut de la page dans le concepteur.</span><span class="sxs-lookup"><span data-stu-id="5427a-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="5427a-232">Affectez à la propriété `ID` la valeur `StatusLabel`, décochez la propriété `Text` et définissez les propriétés `Visible` et `EnableViewState` sur `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="5427a-233">Comme nous l’avons vu dans les didacticiels précédents, la définition de la propriété `EnableViewState` sur `false` nous permet de modifier par programmation les valeurs des propriétés des étiquettes et de les rétablir automatiquement à leurs valeurs par défaut lors de la publication suivante.</span><span class="sxs-lookup"><span data-stu-id="5427a-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="5427a-234">Cela simplifie le code pour l’indication d’un message d’État en réponse à une action de l’utilisateur qui disparaît lors de la publication (postback) suivante.</span><span class="sxs-lookup"><span data-stu-id="5427a-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="5427a-235">Enfin, définissez la propriété `StatusLabel` Control s `CssClass` sur Warning, qui est le nom d’une classe CSS définie dans `Styles.css` qui affiche du texte dans une police large, en italique, en gras et en rouge.</span><span class="sxs-lookup"><span data-stu-id="5427a-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="5427a-236">La figure 11 montre le concepteur Visual Studio après l’ajout et la configuration de l’étiquette.</span><span class="sxs-lookup"><span data-stu-id="5427a-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="5427a-237">[![placer le contrôle StatusLabel au-dessus des deux contrôles Panel](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="5427a-238">**Figure 11**: placer le contrôle de `StatusLabel` au-dessus des deux contrôles de panneau ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="5427a-239">Étape 3 : basculer entre l’affichage et l’insertion d’interfaces</span><span class="sxs-lookup"><span data-stu-id="5427a-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="5427a-240">À ce stade, nous avons terminé le balisage de nos interfaces d’affichage et d’insertion, mais nous avons conservé les deux tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="5427a-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="5427a-241">Basculement entre l’affichage et l’insertion d’interfaces</span><span class="sxs-lookup"><span data-stu-id="5427a-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="5427a-242">Ajout des produits dans la base de données</span><span class="sxs-lookup"><span data-stu-id="5427a-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="5427a-243">Actuellement, l’interface d’affichage est visible, mais l’interface d’insertion est masquée.</span><span class="sxs-lookup"><span data-stu-id="5427a-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="5427a-244">Cela est dû au fait que la propriété `DisplayInterface` du panneau des `Visible` est définie sur `true` (valeur par défaut), alors que la `Visible` propriété du panneau `InsertingInterface` s est définie sur `false`.</span><span class="sxs-lookup"><span data-stu-id="5427a-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="5427a-245">Pour basculer entre les deux interfaces, il suffit de basculer chaque contrôle s `Visible` valeur de propriété.</span><span class="sxs-lookup"><span data-stu-id="5427a-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="5427a-246">Nous voulons passer de l’interface d’affichage à l’interface d’insertion lorsque l’utilisateur clique sur le bouton expédier le produit.</span><span class="sxs-lookup"><span data-stu-id="5427a-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="5427a-247">Par conséquent, créez un gestionnaire d’événements pour ce bouton `Click` événement qui contient le code suivant :</span><span class="sxs-lookup"><span data-stu-id="5427a-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="5427a-248">Ce code masque simplement le panneau `DisplayInterface` et affiche le panneau `InsertingInterface`.</span><span class="sxs-lookup"><span data-stu-id="5427a-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="5427a-249">Ensuite, créez des gestionnaires d’événements pour les contrôles ajouter des produits à partir de l’expédition et du bouton Annuler dans l’interface d’insertion.</span><span class="sxs-lookup"><span data-stu-id="5427a-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="5427a-250">Lorsque vous cliquez sur l’un de ces boutons, nous devons revenir à l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="5427a-251">Créez `Click` gestionnaires d’événements pour les deux contrôles de bouton afin qu’ils appellent `ReturnToDisplayInterface`, une méthode que nous ajouterons momentanément.</span><span class="sxs-lookup"><span data-stu-id="5427a-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="5427a-252">En plus de masquer le panneau de `InsertingInterface` et d’afficher le panneau de `DisplayInterface`, la méthode `ReturnToDisplayInterface` doit renvoyer les contrôles Web à leur état antérieur à la modification.</span><span class="sxs-lookup"><span data-stu-id="5427a-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="5427a-253">Cela implique la définition des propriétés de `SelectedIndex` DropDownList sur 0 et l’effacement des propriétés `Text` des contrôles TextBox.</span><span class="sxs-lookup"><span data-stu-id="5427a-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="5427a-254">Réfléchissez à ce qui peut se produire si nous n’avons pas renvoyé les contrôles à leur état antérieur à la modification avant de revenir à l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="5427a-255">Un utilisateur peut cliquer sur le bouton traiter l’expédition du produit, entrer les produits de l’expédition, puis cliquer sur Ajouter des produits à partir de l’expédition.</span><span class="sxs-lookup"><span data-stu-id="5427a-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="5427a-256">Cela ajoute les produits et renvoie l’utilisateur à l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="5427a-257">À ce stade, l’utilisateur peut souhaiter ajouter une autre expédition.</span><span class="sxs-lookup"><span data-stu-id="5427a-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="5427a-258">Quand vous cliquez sur le bouton traiter l’expédition du produit, vous revenez à l’interface d’insertion, mais les sélections DropDownList et les valeurs de zone de texte sont toujours remplies avec leurs valeurs précédentes.</span><span class="sxs-lookup"><span data-stu-id="5427a-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="5427a-259">Les deux `Click` gestionnaires d’événements appellent simplement la méthode `ReturnToDisplayInterface`, bien que nous puissions revenir au gestionnaire d’événements ajouter des produits à partir de la livraison `Click` à l’étape 4 et ajouter du code pour enregistrer les produits.</span><span class="sxs-lookup"><span data-stu-id="5427a-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="5427a-260">`ReturnToDisplayInterface` commence par retourner le `Suppliers` et `Categories` DropDownList à leurs premières options.</span><span class="sxs-lookup"><span data-stu-id="5427a-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="5427a-261">Les deux constantes `firstControlID` et `lastControlID` marquer les valeurs d’index de contrôle de début et de fin utilisées pour nommer les zones de texte Nom du produit et prix unitaire dans l’interface d’insertion et sont utilisées dans les limites de la boucle `for` qui définit les propriétés `Text` des contrôles TextBox sur une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="5427a-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="5427a-262">Enfin, les panneaux `Visible` propriétés sont réinitialisés afin que l’interface d’insertion soit masquée et l’interface d’affichage affichée.</span><span class="sxs-lookup"><span data-stu-id="5427a-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="5427a-263">Prenez un moment pour tester cette page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="5427a-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="5427a-264">Lors de la première visite de la page, vous devez voir l’interface d’affichage comme illustré à la figure 5.</span><span class="sxs-lookup"><span data-stu-id="5427a-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="5427a-265">Cliquez sur le bouton traiter l’expédition du produit.</span><span class="sxs-lookup"><span data-stu-id="5427a-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="5427a-266">La page est postback et vous devez maintenant voir l’interface d’insertion, comme illustré à la figure 12.</span><span class="sxs-lookup"><span data-stu-id="5427a-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="5427a-267">Si vous cliquez sur le bouton Ajouter des produits à partir d’un envoi ou d’un bouton Annuler, vous pouvez revenir à l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="5427a-268">Lors de l’affichage de l’interface d’insertion, prenez un moment pour tester le CompareValidators dans les zones de texte Unit Price.</span><span class="sxs-lookup"><span data-stu-id="5427a-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="5427a-269">Vous devez voir un avertissement MessageBox côté client quand vous cliquez sur le bouton Ajouter des produits à partir de l’expédition avec des valeurs monétaires ou des prix non valides avec une valeur inférieure à zéro.</span><span class="sxs-lookup"><span data-stu-id="5427a-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="5427a-270">[![l’interface d’insertion s’affiche après avoir cliqué sur le bouton traiter l’expédition du produit](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="5427a-271">**Figure 12**: l’interface d’insertion s’affiche après avoir cliqué sur le bouton traiter l’expédition du produit ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="5427a-272">Étape 4 : ajout des produits</span><span class="sxs-lookup"><span data-stu-id="5427a-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="5427a-273">Tout ce qui reste dans ce didacticiel consiste à enregistrer les produits dans la base de données dans le gestionnaire d’événements ajouter des produits à partir du bouton d’expédition s `Click`.</span><span class="sxs-lookup"><span data-stu-id="5427a-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="5427a-274">Pour ce faire, vous pouvez créer un `ProductsDataTable` et ajouter une instance `ProductsRow` pour chacun des noms de produits fournis.</span><span class="sxs-lookup"><span data-stu-id="5427a-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="5427a-275">Une fois ces `ProductsRow` s ajoutées, nous allons appeler la méthode `ProductsBLL` classe s `UpdateWithTransaction` passant dans le `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5427a-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="5427a-276">Rappelez-vous que la méthode `UpdateWithTransaction`, qui a été créée dans les [modifications d’encapsulation de la base de données dans un](wrapping-database-modifications-within-a-transaction-cs.md) didacticiel sur les transactions, passe le `ProductsDataTable` à la méthode `UpdateWithTransaction` `ProductsTableAdapter` s.</span><span class="sxs-lookup"><span data-stu-id="5427a-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="5427a-277">À partir de là, une transaction ADO.NET est démarrée et le TableAdapter émet une instruction `INSERT` à la base de données pour chaque `ProductsRow` ajoutée dans le DataTable.</span><span class="sxs-lookup"><span data-stu-id="5427a-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="5427a-278">En supposant que tous les produits sont ajoutés sans erreur, la transaction est validée, sinon elle est restaurée.</span><span class="sxs-lookup"><span data-stu-id="5427a-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="5427a-279">Le code du bouton Ajouter des produits à partir du bouton de livraison `Click` un gestionnaire d’événements doit également effectuer une vérification des erreurs.</span><span class="sxs-lookup"><span data-stu-id="5427a-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="5427a-280">Étant donné qu’il n’y a aucun RequiredFieldValidators utilisé dans l’interface d’insertion, un utilisateur peut entrer un prix pour un produit tout en omettant son nom.</span><span class="sxs-lookup"><span data-stu-id="5427a-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="5427a-281">Étant donné que le nom du produit est obligatoire, si une telle condition est déroulée, nous devons signaler l’utilisateur et ne pas poursuivre les insertions.</span><span class="sxs-lookup"><span data-stu-id="5427a-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="5427a-282">Le code complet du gestionnaire d’événements `Click` suit :</span><span class="sxs-lookup"><span data-stu-id="5427a-282">The complete `Click` event handler code follows:</span></span>

[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="5427a-283">Le gestionnaire d’événements commence par s’assurer que la propriété `Page.IsValid` retourne une valeur de `true`.</span><span class="sxs-lookup"><span data-stu-id="5427a-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="5427a-284">Si elle retourne `false`, cela signifie qu’un ou plusieurs CompareValidators sont en signalant des données non valides ; dans ce cas, nous ne souhaitons pas tenter d’insérer les produits entrés ou nous obtiendrons une exception lors de la tentative d’affectation de la valeur du prix unitaire entré par l’utilisateur à la propriété `ProductsRow` s `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="5427a-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="5427a-285">Ensuite, une nouvelle instance de `ProductsDataTable` est créée (`products`).</span><span class="sxs-lookup"><span data-stu-id="5427a-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="5427a-286">Une boucle `for` est utilisée pour effectuer une itération dans les zones de texte Product Name et Price Unit et les propriétés `Text` sont lues dans les variables locales `productName` et `unitPrice`.</span><span class="sxs-lookup"><span data-stu-id="5427a-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="5427a-287">Si l’utilisateur a entré une valeur pour le prix unitaire mais pas pour le nom du produit correspondant, le `StatusLabel` affiche le message si vous fournissez un prix unitaire, vous devez également inclure le nom du produit et le gestionnaire d’événements est fermé.</span><span class="sxs-lookup"><span data-stu-id="5427a-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="5427a-288">Si un nom de produit a été fourni, une nouvelle instance de `ProductsRow` est créée à l’aide de la méthode `ProductsDataTable` s `NewProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="5427a-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="5427a-289">Cette nouvelle propriété d’instance de `ProductsRow` `ProductName` est définie sur la zone de texte nom de produit actuel, tandis que les propriétés `SupplierID` et `CategoryID` sont affectées aux propriétés de `SelectedValue` de DropDownList dans l’en-tête d’insertion d’interface s.</span><span class="sxs-lookup"><span data-stu-id="5427a-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="5427a-290">Si l’utilisateur a entré une valeur pour le prix du produit, il est affecté à la propriété `ProductsRow` d’instances `UnitPrice` ; dans le cas contraire, la propriété n’est pas assignée, ce qui génère une valeur `NULL` pour `UnitPrice` dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="5427a-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="5427a-291">Enfin, les propriétés `Discontinued` et `UnitsOnOrder` sont affectées aux valeurs codées en dur `false` et à 0, respectivement.</span><span class="sxs-lookup"><span data-stu-id="5427a-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="5427a-292">Une fois les propriétés affectées à l’instance `ProductsRow`, elles sont ajoutées au `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5427a-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="5427a-293">À la fin de la boucle de `for`, nous vérifions si des produits ont été ajoutés.</span><span class="sxs-lookup"><span data-stu-id="5427a-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="5427a-294">L’utilisateur peut, après tout, avoir cliqué sur Ajouter des produits à partir de la livraison avant d’entrer un nom de produit ou un prix.</span><span class="sxs-lookup"><span data-stu-id="5427a-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="5427a-295">S’il existe au moins un produit dans le `ProductsDataTable`, la méthode `ProductsBLL` classe s `UpdateWithTransaction` est appelée.</span><span class="sxs-lookup"><span data-stu-id="5427a-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="5427a-296">Ensuite, les données sont reliées au `ProductsGrid` GridView afin que les produits récemment ajoutés s’affichent dans l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="5427a-297">Le `StatusLabel` est mis à jour pour afficher un message de confirmation et le `ReturnToDisplayInterface` est appelé, en masquant l’interface d’insertion et en affichant l’interface d’affichage.</span><span class="sxs-lookup"><span data-stu-id="5427a-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="5427a-298">Si aucun produit n’a été entré, l’interface d’insertion reste affichée mais le message aucun produit n’a été ajouté.</span><span class="sxs-lookup"><span data-stu-id="5427a-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="5427a-299">Entrez les noms des produits et les prix unitaires dans les zones de texte s’affichent.</span><span class="sxs-lookup"><span data-stu-id="5427a-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="5427a-300">Les figures 13, 14 et 15 montrent les interfaces d’insertion et d’affichage en action.</span><span class="sxs-lookup"><span data-stu-id="5427a-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="5427a-301">Dans la figure 13, l’utilisateur a entré une valeur de prix unitaire sans nom de produit correspondant.</span><span class="sxs-lookup"><span data-stu-id="5427a-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="5427a-302">La figure 14 montre l’interface d’affichage après que trois nouveaux produits ont été ajoutés avec succès, tandis que la figure 15 illustre deux des produits récemment ajoutés dans le GridView (le troisième est sur la page précédente).</span><span class="sxs-lookup"><span data-stu-id="5427a-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="5427a-303">[![un nom de produit est requis lors de l’entrée d’un prix unitaire](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="5427a-304">**Figure 13**: un nom de produit est requis lors de l’entrée d’un prix unitaire ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>

<span data-ttu-id="5427a-305">[![trois nouveaux veggies ont été ajoutés pour le fournisseur Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="5427a-306">**Figure 14**: trois nouveaux veggies ont été ajoutés pour le fournisseur Mayumi s ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>

<span data-ttu-id="5427a-307">[![les nouveaux produits se trouvent dans la dernière page du contrôle GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="5427a-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="5427a-308">**Figure 15**: les nouveaux produits se trouvent dans la dernière page du GridView ([cliquez pour afficher l’image en taille réelle](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="5427a-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="5427a-309">La logique d’insertion de lot utilisée dans ce didacticiel encapsule les insertions dans l’étendue de la transaction.</span><span class="sxs-lookup"><span data-stu-id="5427a-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="5427a-310">Pour vérifier cela, introduisez une erreur au niveau de la base de données de façon intentionnelle.</span><span class="sxs-lookup"><span data-stu-id="5427a-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="5427a-311">Par exemple, au lieu d’assigner la propriété nouvelle `ProductsRow` instance `CategoryID` à la valeur sélectionnée dans le DropDownList `Categories`, affectez-la à une valeur telle que `i * 5`.</span><span class="sxs-lookup"><span data-stu-id="5427a-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="5427a-312">Ici `i` est l’indexeur de boucle et contient des valeurs comprises entre 1 et 5.</span><span class="sxs-lookup"><span data-stu-id="5427a-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="5427a-313">Par conséquent, lors de l’ajout de deux produits ou plus dans le cadre de l’insertion par lot, le premier produit aura une valeur de `CategoryID` valide (5), mais les produits suivants auront des valeurs `CategoryID` qui ne correspondent pas à `CategoryID` valeurs de la table `Categories`.</span><span class="sxs-lookup"><span data-stu-id="5427a-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="5427a-314">L’effet net est que, pendant que la première `INSERT` réussit, les suivantes échouent avec une violation de contrainte de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="5427a-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="5427a-315">Étant donné que l’insertion de lot est atomique, la première `INSERT` est restaurée, ce qui ramène la base de données à son état avant le début du processus d’insertion de lot.</span><span class="sxs-lookup"><span data-stu-id="5427a-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="5427a-316">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="5427a-316">Summary</span></span>

<span data-ttu-id="5427a-317">Au-delà de ces deux didacticiels, nous avons créé des interfaces qui permettent de mettre à jour, de supprimer et d’insérer des lots de données, qui utilisaient tous la prise en charge des transactions que nous avons ajoutée à la couche d’accès aux données dans le didacticiel sur les [modifications de la base de données d’encapsulation dans une transaction](wrapping-database-modifications-within-a-transaction-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="5427a-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="5427a-318">Pour certains scénarios, ces interfaces utilisateur de traitement par lots améliorent nettement l’efficacité des utilisateurs finaux en réduisant le nombre de clics, de publications et de commutateurs de contexte clavier à souris, tout en maintenant l’intégrité des données sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="5427a-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="5427a-319">Ce didacticiel termine notre examen de l’utilisation des données par lot.</span><span class="sxs-lookup"><span data-stu-id="5427a-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="5427a-320">L’ensemble suivant de didacticiels explore un large éventail de scénarios avancés de couche d’accès aux données, notamment l’utilisation de procédures stockées dans les méthodes de TableAdapter s, la configuration des paramètres de connexion et de niveau de commande dans la couche DAL, le chiffrement des chaînes de connexion et bien plus encore.</span><span class="sxs-lookup"><span data-stu-id="5427a-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="5427a-321">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="5427a-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5427a-322">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="5427a-322">About the Author</span></span>

<span data-ttu-id="5427a-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="5427a-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5427a-324">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="5427a-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5427a-325">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5427a-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5427a-326">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5427a-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5427a-327">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5427a-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5427a-328">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="5427a-328">Special Thanks To</span></span>

<span data-ttu-id="5427a-329">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="5427a-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5427a-330">Les réviseurs de leads pour ce didacticiel étaient Hilton Giesenow et S Ren Jacob Lauritsen.</span><span class="sxs-lookup"><span data-stu-id="5427a-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="5427a-331">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="5427a-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5427a-332">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5427a-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5427a-333">[Précédent](batch-deleting-cs.md)
> [Suivant](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5427a-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
