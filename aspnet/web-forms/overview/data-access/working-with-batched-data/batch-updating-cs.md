---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
title: Traitement par lots de la mise à jour (c#) | Microsoft Docs
author: rick-anderson
description: Découvrez comment mettre à jour plusieurs enregistrements de base de données en une seule opération. Dans la couche d’Interface utilisateur, nous créons un GridView où chaque ligne est modifiable. Dans les données...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 4e849bcc-c557-4bc3-937e-f7453ee87265
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
msc.type: authoredcontent
ms.openlocfilehash: 07b85751dee9b9d00710c90a8dc2b7e250422fff
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65108958"
---
# <a name="batch-updating-c"></a><span data-ttu-id="5f9e1-105">Mise à jour par lots (C#)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-105">Batch Updating (C#)</span></span>

<span data-ttu-id="5f9e1-106">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5f9e1-107">[Télécharger le Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) ou [télécharger le PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) or [Download PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span></span>

> <span data-ttu-id="5f9e1-108">Découvrez comment mettre à jour plusieurs enregistrements de base de données en une seule opération.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="5f9e1-109">Dans la couche d’Interface utilisateur, nous créons un GridView où chaque ligne est modifiable.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="5f9e1-110">Dans la couche d’accès aux données nous encapsuler toutes les opérations de mise à jour dans une transaction pour vous assurer que toutes les mises à jour réussissent ou que toutes les mises à jour sont restaurées.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="5f9e1-111">Introduction</span><span class="sxs-lookup"><span data-stu-id="5f9e1-111">Introduction</span></span>

<span data-ttu-id="5f9e1-112">Dans le [didacticiel précédent](wrapping-database-modifications-within-a-transaction-cs.md) nous avons vu comment étendre la couche d’accès aux données pour ajouter la prise en charge des transactions de base de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="5f9e1-113">Les transactions de base de données garantissent qu’une série d’instructions de modification de données sera considérée comme une seule opération atomique, ce qui garantit que toutes les modifications échoue ou réussiront tous.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="5f9e1-114">Avec cette couche DAL fonctionnalités de bas niveau disparaître, nous re prêts à porter notre attention à la création d’interfaces de modification de données par lots.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="5f9e1-115">Dans ce didacticiel, nous allons créer un GridView où chaque ligne est modifiable (voir Figure 1).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="5f9e1-116">Dans la mesure où chaque ligne n’est rendue dans son interface de modification, cet emplacement s aucun nécessaire pour une colonne de la modifier, mettre à jour et les boutons d’annulation.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="5f9e1-117">Au lieu de cela, il existe deux boutons de mettre à jour des produits sur la page qui, lorsque vous cliquez dessus, énumérer les lignes de GridView et mettre à jour de la base de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="5f9e1-118">[![Chaque ligne dans le contrôle GridView est modifiable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-118">[![Each Row in the GridView is Editable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span></span>

<span data-ttu-id="5f9e1-119">**Figure 1**: Chaque ligne dans le contrôle GridView est modifiable ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-cs/_static/image2.png))</span></span>

<span data-ttu-id="5f9e1-120">Laissez s commencer !</span><span class="sxs-lookup"><span data-stu-id="5f9e1-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="5f9e1-121">Dans le [effectuant des mises à jour par lots](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) didacticiel, nous avons créé une modification de l’interface à l’aide du contrôle DataList.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="5f9e1-122">Ce didacticiel diffère du précédent dans qui est utilise un GridView et la mise à jour par lots est effectuée dans l’étendue d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="5f9e1-123">Après avoir terminé ce didacticiel je vous encourage à revenir au didacticiel antérieures et mettre à jour pour utiliser les fonctionnalités liées aux transactions de base de données ajoutées dans le didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="5f9e1-124">Examiner les étapes pour effectuer toutes les lignes de GridView modifiable</span><span class="sxs-lookup"><span data-stu-id="5f9e1-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="5f9e1-125">Comme indiqué dans le [une vue d’ensemble d’insertion, mise à jour et suppression des données](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) didacticiel, le contrôle GridView offre une prise en charge intégrée pour la modification de ses données sous-jacentes sur une ligne par ligne.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="5f9e1-126">En interne, le contrôle GridView notes quelle ligne est modifiable via son [ `EditIndex` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="5f9e1-127">Comme le contrôle GridView est lié à sa source de données, il vérifie chaque ligne pour voir si l’index de la ligne est égale à la valeur de `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="5f9e1-128">Dans ce cas, cette ligne s champs sont rendus à l’aide de la modification de leurs interfaces.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="5f9e1-129">Pour BoundFields, l’interface de modification est une zone de texte dont `Text` propriété est affectée à la valeur du champ de données spécifié par le s BoundField `DataField` propriété.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="5f9e1-130">Pour TemplateFields, le `EditItemTemplate` est utilisé à la place de la `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="5f9e1-131">Rappelez-vous que l’édition du workflow démarre lorsqu’un utilisateur clique sur un bouton de modification de ligne s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="5f9e1-132">Cela entraîne une publication, définit les opérations de mappage GridView `EditIndex` propriété à l’index de ligne utilisateur a cliqué dessus s et Reliaisons les données à la grille.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="5f9e1-133">Quand une ligne s bouton Cancel, lors de la publication la `EditIndex` est défini sur une valeur de `-1` avant les données à la grille de reliaison.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="5f9e1-134">Étant donné que les lignes de s GridView démarrer l’indexation à zéro, le paramètre `EditIndex` à `-1` a pour effet d’afficher le contrôle GridView en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="5f9e1-135">Le `EditIndex` propriété fonctionne bien pour modification par ligne, mais n’est pas conçue pour l’édition de lot.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="5f9e1-136">Pour rendre le contrôle GridView entière modifiables, que nous devons disposer à chaque ligne de rendus à l’aide de son interface de modification.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="5f9e1-137">Le moyen le plus simple pour y parvenir consiste à créer dans lequel chaque champ modifiable est implémenté comme un TemplateField avec son interface de modification est défini dans le `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="5f9e1-138">Le prochain plusieurs étapes nous créerons un GridView complètement modifiable.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="5f9e1-139">À l’étape 1 nous commençons par créer le contrôle GridView et son ObjectDataSource et convertir son BoundFields et du CheckBoxField TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="5f9e1-140">Dans les étapes 2 et 3, nous allons déplacer les interfaces de modifications à partir de la TemplateFields `EditItemTemplate` s pour leurs `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="5f9e1-141">Étape 1 : Affichage des informations de produit</span><span class="sxs-lookup"><span data-stu-id="5f9e1-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="5f9e1-142">Avant de nous soucier de la création d’un GridView où des lignes sont modifiables, permettent de s commencent par simplement afficher les informations de produit.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="5f9e1-143">Ouvrez le `BatchUpdate.aspx` page dans le `BatchData` dossier et faites glisser un GridView à partir de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="5f9e1-144">Définir les opérations de mappage GridView `ID` à `ProductsGrid` et, à partir de sa balise active, choisir de lier à un nouveau ObjectDataSource nommé `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="5f9e1-145">Configurer l’ObjectDataSource pour récupérer ses données à partir de la `ProductsBLL` classe s `GetProducts` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="5f9e1-146">[![Configurer pour utiliser la classe ProductsBLL ObjectDataSource](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span></span>

<span data-ttu-id="5f9e1-147">**Figure 2**: Configurer l’ObjectDataSource à utiliser le `ProductsBLL` classe ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image4.png))</span></span>

<span data-ttu-id="5f9e1-148">[![Récupérer les données de produit à l’aide de la méthode GetProducts](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span></span>

<span data-ttu-id="5f9e1-149">**Figure 3**: Récupérer les données de produit à l’aide de la `GetProducts` (méthode) ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-cs/_static/image6.png))</span></span>

<span data-ttu-id="5f9e1-150">Comme le contrôle GridView, les fonctionnalités de modification ObjectDataSource s sont conçues pour fonctionner sur une ligne par ligne.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="5f9e1-151">Pour mettre à jour un jeu d’enregistrements, nous allons devoir écrire un peu de code dans la classe code-behind de pages ASP.NET qui regroupe les données et la transmet à la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="5f9e1-152">Par conséquent, définir les listes déroulantes dans le s ObjectDataSource onglets UPDATE, INSERT et DELETE (None).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="5f9e1-153">Cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="5f9e1-154">[![Définir les listes déroulantes dans la mise à jour, insertion et supprimer des onglets à (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span></span>

<span data-ttu-id="5f9e1-155">**Figure 4**: La valeur est la liste déroulante répertorie dans la mise à jour, insertion et supprimer des onglets (aucun) ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image8.png))</span></span>

<span data-ttu-id="5f9e1-156">À l’issue de l’Assistant Configurer la Source de données, le balisage déclaratif de s ObjectDataSource doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample1.aspx)]

<span data-ttu-id="5f9e1-157">Fin de l’Assistant Configurer la Source de données entraîne également Visual Studio créer BoundFields et un CheckBoxField pour les champs de données de produit dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="5f9e1-158">Pour ce didacticiel, permettent d’autoriser uniquement l’utilisateur afficher et modifier le nom du produit s, catégorie, prix et état abandonné s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="5f9e1-159">Supprimer tout sauf la `ProductName`, `CategoryName`, `UnitPrice`, et `Discontinued` champs et renommez le `HeaderText` des trois premières propriétés de champs à catégorie, les produits et les prix, respectivement.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="5f9e1-160">Finalement, activez les cases à cocher Activer la pagination et activer le tri dans la balise active de s GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="5f9e1-161">À ce stade le contrôle GridView présente trois BoundFields (`ProductName`, `CategoryName`, et `UnitPrice`) et un CheckBoxField (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="5f9e1-162">Nous avons besoin convertir ces quatre champs TemplateField, puis déplacez l’interface de modification à partir de la s TemplateField `EditItemTemplate` à son `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="5f9e1-163">Nous avons exploré création et personnalisation de TemplateFields dans le [personnalisation de l’Interface de Modification de données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) didacticiel.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span> <span data-ttu-id="5f9e1-164">Nous allons étudier les étapes de conversion de la BoundFields et CheckBoxField en TemplateField et définir leur modification des interfaces dans leurs `ItemTemplate` s, mais si vous êtes bloqué ou avez besoin de rafraîchir la mémoire, don t hésitez pas à vous référer à ce didacticiel antérieures.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="5f9e1-165">À partir de la balise active de s GridView, cliquez sur le lien Modifier les colonnes pour ouvrir la boîte de dialogue champs.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="5f9e1-166">Ensuite, sélectionnez chaque champ et cliquez sur la convertir ce champ en TemplateField lien.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Convertir le BoundFields existant et CheckBoxField TemplateField](batch-updating-cs/_static/image5.gif)

<span data-ttu-id="5f9e1-168">**Figure 5**: Convertir le BoundFields existant et CheckBoxField TemplateField</span><span class="sxs-lookup"><span data-stu-id="5f9e1-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateField</span></span>

<span data-ttu-id="5f9e1-169">Maintenant que chaque champ est un TemplateField, nous vous êtes prêt à passer à la modification d’interface à partir de la `EditItemTemplate` s pour le `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="5f9e1-170">Étape 2 : Création de la`ProductName`,`UnitPrice`, et`Discontinued`modification des Interfaces</span><span class="sxs-lookup"><span data-stu-id="5f9e1-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="5f9e1-171">Création de la `ProductName`, `UnitPrice`, et `Discontinued` modification des interfaces sont la rubrique de cette étape et sont relativement simple, tel que chaque interface est déjà défini dans le s TemplateField `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="5f9e1-172">Création de la `CategoryName` modification d’interface est un peu plus complexe, car nous devons créer un contrôle DropDownList des catégories applicables.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="5f9e1-173">Cela `CategoryName` modification d’interface est abordé à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="5f9e1-174">S permettent de démarrer avec le `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="5f9e1-175">Cliquez sur le lien Modifier les modèles à partir de la balise active de s GridView et explorez pour le `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="5f9e1-176">Sélectionnez la zone de texte, copiez-le dans le Presse-papiers, puis collez-le dans le `ProductName` TemplateField s `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="5f9e1-177">Modifier la zone de texte s `ID` propriété `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="5f9e1-178">Ensuite, ajoutez un contrôle RequiredFieldValidator à la `ItemTemplate` pour vous assurer que l’utilisateur fournit une valeur pour chaque nom de produit s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="5f9e1-179">Définir le `ControlToValidate` propriété ProductName, le `ErrorMessage` propriété, vous devez fournir le nom du produit.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="5f9e1-180">et le `Text` propriété \*.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-180">and the `Text` property to \*.</span></span> <span data-ttu-id="5f9e1-181">Après avoir apporté ces ajouts à la `ItemTemplate`, votre écran doit ressembler à la Figure 6.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="5f9e1-182">[![Le présent TemplateField ProductName inclut une zone de texte et un contrôle RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span></span>

<span data-ttu-id="5f9e1-183">**Figure 6**: Le `ProductName` TemplateField inclut désormais une zone de texte et un contrôle RequiredFieldValidator ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-cs/_static/image10.png))</span></span>

<span data-ttu-id="5f9e1-184">Pour le `UnitPrice` modification d’interface, commencez par copie de la zone de texte à partir de la `EditItemTemplate` à la `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="5f9e1-185">Ensuite, placez un $ devant la zone de texte et un ensemble son `ID` propriété UnitPrice et son `Columns` propriété à 8.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="5f9e1-186">Ajoutez également un CompareValidator pour les `UnitPrice` s `ItemTemplate` pour vous assurer que la valeur entrée par l’utilisateur est une valeur de devise valide supérieure ou égale à 0,00 $.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="5f9e1-187">Définir les opérations de mappage du programme de validation `ControlToValidate` propriété UnitPrice, son `ErrorMessage` propriété, vous devez entrer une valeur de devise valide.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="5f9e1-188">Veuillez omettre les symboles de devise., son `Text` propriété \*, ses `Type` propriété `Currency`, ses `Operator` propriété `GreaterThanEqual`et son `ValueToCompare` 0 à la propriété.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="5f9e1-189">[![Ajouter un CompareValidator pour garantir le prix entré est une valeur de devise Non négative](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span></span>

<span data-ttu-id="5f9e1-190">**Figure 7**: Ajouter un CompareValidator pour garantir le prix entré est une valeur de devise Non négative ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-cs/_static/image12.png))</span></span>

<span data-ttu-id="5f9e1-191">Pour le `Discontinued` TemplateField, vous pouvez utiliser la case à cocher déjà définie dans le `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="5f9e1-192">Il suffit de définir son `ID` à abandonné et son `Enabled` propriété `true`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-192">Simply set its `ID` to Discontinued and its `Enabled` property to `true`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="5f9e1-193">Étape 3 : Création de la`CategoryName`modification d’Interface</span><span class="sxs-lookup"><span data-stu-id="5f9e1-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="5f9e1-194">L’interface de modification dans le `CategoryName` TemplateField s `EditItemTemplate` contient une zone de texte qui affiche la valeur de la `CategoryName` champ de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="5f9e1-195">Nous avons besoin de le remplacer par un contrôle DropDownList qui répertorie les catégories possibles.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="5f9e1-196">Le [personnalisation de l’Interface de Modification de données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) didacticiel contient une discussion plus approfondie et complète sur la personnalisation d’un modèle pour inclure un contrôle DropDownList par opposition à une zone de texte.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="5f9e1-197">Bien que les étapes décrites ici sont terminées, elles sont présentées tersely.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="5f9e1-198">Pour une présentation plus détaillée à créer et configurer les catégories DropDownList, faire référence à la [personnalisation de l’Interface de Modification de données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) didacticiel.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span>

<span data-ttu-id="5f9e1-199">Faites glisser un contrôle DropDownList à partir de la boîte à outils vers le `CategoryName` TemplateField s `ItemTemplate`, ce qui affecte ses `ID` à `Categories`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="5f9e1-200">À ce stade nous généralement définirait la source de données s DropDownList via sa balise active, création d’un nouveau ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="5f9e1-201">Toutefois, cela ajoutera ObjectDataSource dans le `ItemTemplate`, ce qui entraînera une instance de l’ObjectDataSource créée pour chaque ligne GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="5f9e1-202">Au lieu de cela, permettre de s ObjectDataSource en dehors de la s GridView TemplateField.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="5f9e1-203">Fin de la modification de modèle et faites glisser un ObjectDataSource à partir de la boîte à outils vers le concepteur sous la `ProductsDataSource` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="5f9e1-204">Nommez le nouveau ObjectDataSource `CategoriesDataSource` et configurez-le pour utiliser le `CategoriesBLL` classe s `GetCategories` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="5f9e1-205">[![Configurer pour utiliser la classe CategoriesBLL ObjectDataSource](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span></span>

<span data-ttu-id="5f9e1-206">**Figure 8**: Configurer l’ObjectDataSource à utiliser le `CategoriesBLL` classe ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image14.png))</span></span>

<span data-ttu-id="5f9e1-207">[![Récupérer les données de catégorie à l’aide de la méthode GetCategories](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span></span>

<span data-ttu-id="5f9e1-208">**Figure 9**: Récupérer les données de catégorie à l’aide de la `GetCategories` (méthode) ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-cs/_static/image16.png))</span></span>

<span data-ttu-id="5f9e1-209">Dans la mesure où cette ObjectDataSource est utilisé simplement pour récupérer des données, définissez les listes déroulantes dans les onglets UPDATE et DELETE (None).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="5f9e1-210">Cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="5f9e1-211">[![Définir les listes déroulantes dans la mise à jour et supprimer les tabulations à (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span></span>

<span data-ttu-id="5f9e1-212">**Figure 10**: La valeur est la liste déroulante répertorie dans la mise à jour et supprimer des onglets (aucun) ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image18.png))</span></span>

<span data-ttu-id="5f9e1-213">Après la fin de l’Assistant, le `CategoriesDataSource` balisage déclaratif s doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample2.aspx)]

<span data-ttu-id="5f9e1-214">Avec le `CategoriesDataSource` créé et configuré, revenir à la `CategoryName` TemplateField s `ItemTemplate` et, à partir de la balise active de s DropDownList, cliquez sur le lien de choisir la Source de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="5f9e1-215">Dans l’Assistant Configuration de Source de données, sélectionnez le `CategoriesDataSource` option dans la première liste déroulante et choisissez les `CategoryName` utilisé pour l’affichage et `CategoryID` comme valeur.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="5f9e1-216">[![Lier l’objet DropDownList pour la CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span></span>

<span data-ttu-id="5f9e1-217">**Figure 11**: Lier l’objet DropDownList pour la `CategoriesDataSource` ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-cs/_static/image20.png))</span></span>

<span data-ttu-id="5f9e1-218">À ce stade le `Categories` DropDownList répertorie toutes les catégories, mais il ne pas encore automatiquement sélectionne la catégorie appropriée pour le produit lié à la ligne GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="5f9e1-219">Pour cela nous devons définir la `Categories` DropDownList s `SelectedValue` au produit s `CategoryID` valeur.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="5f9e1-220">Cliquez sur le lien Modifier les DataBindings DropDownList s smart tag et associer le `SelectedValue` propriété avec le `CategoryID` de champ de données comme indiqué dans la Figure 12.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Lier la valeur de CategoryID produit s à la propriété SelectedValue de s DropDownList](batch-updating-cs/_static/image12.gif)

<span data-ttu-id="5f9e1-222">**Figure 12**: Lier le produit s `CategoryID` valeur au s DropDownList `SelectedValue` propriété</span><span class="sxs-lookup"><span data-stu-id="5f9e1-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="5f9e1-223">Une dernière reste de problème : si le produit n’a un `CategoryID` valeur spécifiée puis l’instruction de liaison de données sur `SelectedValue` provoquera une exception.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="5f9e1-224">Il s’agit, car l’objet DropDownList contient uniquement les éléments pour les catégories et n’offre pas une option pour les produits qui ont un `NULL` valeur pour la base de données `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="5f9e1-225">Pour résoudre ce problème, définissez le s DropDownList `AppendDataBoundItems` propriété `true` et ajouter un nouvel élément à la liste DropDownList, en omettant le `Value` propriété à partir de la syntaxe déclarative.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `true` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="5f9e1-226">Autrement dit, assurez-vous que le `Categories` syntaxe déclarative des s DropDownList ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample3.aspx)]

<span data-ttu-id="5f9e1-227">Notez comment la `<asp:ListItem Value="">` --sélectionner 1--présente ses `Value` attribut défini explicitement sur une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="5f9e1-228">Faire référence à la [personnalisation de l’Interface de Modification de données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) didacticiel pour une discussion plus détaillée sur la raison pour laquelle cet élément DropDownList supplémentaire est nécessaire pour gérer le `NULL` cas et pourquoi affectation de la `Value` propriété à une chaîne vide est essentielle.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="5f9e1-229">Il existe une performance et évolutivité problème potentiel ici qui est intéressant de mentionner.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="5f9e1-230">Dans la mesure où chaque ligne comporte un DropDownList qui utilise le `CategoriesDataSource` comme source de données, le `CategoriesBLL` classe s `GetCategories` méthode sera appelée *n* visitent de fois par page, où *n* est le nombre de lignes dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="5f9e1-231">Ces *n* appelle à `GetCategories` entraîne *n* requêtes à la base de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="5f9e1-232">Cet impact sur la base de données peut être atténué en mettant en cache les catégories retournés dans un cache par requête ou via la couche de mise en cache à l’aide d’une mise en cache de la dépendance ou à une expiration très courte temporelle de SQL.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="5f9e1-233">Pour plus d’informations sur la demande par la mise en cache option, consultez [ `HttpContext.Items` un Store de Cache par requête](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="5f9e1-234">Étape 4 : Fin de l’Interface de modification</span><span class="sxs-lookup"><span data-stu-id="5f9e1-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="5f9e1-235">Nous sauter quelques modifications apportées aux modèles s GridView sans marquer de pause pour afficher notre progression.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="5f9e1-236">Prenez un moment pour consulter notre progression via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="5f9e1-237">Comme le montre la Figure 13, chaque ligne est restitué à l’aide de son `ItemTemplate`, qui contient le s cellule modification d’interface.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="5f9e1-238">[![Chaque ligne GridView est modifiable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-238">[![Each GridView Row is Editable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span></span>

<span data-ttu-id="5f9e1-239">**Figure 13**: Chaque ligne GridView est modifiable ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-cs/_static/image22.png))</span></span>

<span data-ttu-id="5f9e1-240">Il existe quelques problèmes mineurs mise en forme qui nous devrions prendre en charge à ce stade.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="5f9e1-241">Tout d’abord, notez que le `UnitPrice` valeur contient quatre décimales.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="5f9e1-242">Pour résoudre ce problème, revenez à la `UnitPrice` TemplateField s `ItemTemplate` et, à partir de la balise active s de zone de texte, cliquez sur le lien Modifier les DataBindings.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="5f9e1-243">Ensuite, spécifiez que le `Text` propriété doit être sous forme de nombre.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Mettre en forme la propriété de texte sous forme de nombre](batch-updating-cs/_static/image14.gif)

<span data-ttu-id="5f9e1-245">**Figure 14**: Format du `Text` propriété sous forme de nombre</span><span class="sxs-lookup"><span data-stu-id="5f9e1-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="5f9e1-246">En second lieu, let s centre de la case à cocher dans la `Discontinued` colonne (plutôt que de sorte qu’il est aligné à gauche).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="5f9e1-247">Cliquez sur Modifier les colonnes à partir de la balise active de s GridView et sélectionnez le `Discontinued` TemplateField dans la liste des champs dans le coin inférieur gauche.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="5f9e1-248">Explorez `ItemStyle` et définir le `HorizontalAlign` propriété Center, comme illustré dans la Figure 15.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Centre de la case à cocher supprimée](batch-updating-cs/_static/image15.gif)

<span data-ttu-id="5f9e1-250">**Figure 15**: Centre le `Discontinued` case à cocher</span><span class="sxs-lookup"><span data-stu-id="5f9e1-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="5f9e1-251">Ensuite, ajoutez un contrôle ValidationSummary à la page et définissez son `ShowMessageBox` propriété `true` et son `ShowSummary` propriété `false`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="5f9e1-252">Également ajouter que le bouton Web des contrôles qui, lorsque vous cliquez sur, met à jour l’utilisateur change de s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="5f9e1-253">Plus précisément, ajoutez deux contrôles de bouton Web, un au-dessus de la GridView et celui ci-dessous, en définissant les deux contrôles `Text` propriétés aux produits de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="5f9e1-254">Depuis le s GridView modification d’interface est définie dans ses TemplateField `ItemTemplate` s, le `EditItemTemplate` s sont superflus et peuvent être supprimées.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="5f9e1-255">Une fois que ce qui précède mentionné modifications de mise en forme, ajouter les contrôles de bouton et suppression superflu `EditItemTemplate` s, votre syntaxe déclarative s de page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample4.aspx)]

<span data-ttu-id="5f9e1-256">Figure 16 illustre cette page lorsqu’ils sont affichés via un navigateur une fois que les contrôles bouton Web ont été ajoutées et les modifications de mise en forme.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="5f9e1-257">[![La Page maintenant inclut deux boutons de produits de mise à jour](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span></span>

<span data-ttu-id="5f9e1-258">**Figure 16**: La Page maintenant inclut deux mises à jour produits boutons ([cliquez pour afficher l’image en taille réelle](batch-updating-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="5f9e1-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-cs/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="5f9e1-259">Étape 5 : La mise à jour de produits</span><span class="sxs-lookup"><span data-stu-id="5f9e1-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="5f9e1-260">Lorsqu’un utilisateur visite cette page, ils apportent leurs modifications et puis cliquez sur une des deux boutons de produits de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="5f9e1-261">À ce stade, nous avons besoin d’une certaine manière enregistrer les valeurs entrées par l’utilisateur pour chaque ligne dans un `ProductsDataTable` d’instance et puis passez-le à une méthode de couche de logique métier qui transmet ensuite qui `ProductsDataTable` instance à la couche DAL s `UpdateWithTransaction` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="5f9e1-262">Le `UpdateWithTransaction` (méthode), que nous avons créée dans le [didacticiel précédent](wrapping-database-modifications-within-a-transaction-cs.md), garantit que le lot de modifications sera mis à jour comme une opération atomique.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="5f9e1-263">Créez une méthode nommée `BatchUpdate` dans `BatchUpdate.aspx.cs` et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.cs` and add the following code:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample5.cs)]

<span data-ttu-id="5f9e1-264">Cette méthode commence par l’obtention de tous les produits dans un `ProductsDataTable` via un appel à la couche BLL s `GetProducts` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="5f9e1-265">Il énumère ensuite les `ProductGrid` GridView s [ `Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="5f9e1-266">Le `Rows` collection contient un [ `GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) pour chaque ligne affichée dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="5f9e1-267">Étant donné que nous vous montrons au plus dix lignes par page, les opérations de mappage GridView `Rows` collection aura pas plus de dix éléments.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="5f9e1-268">Pour chaque ligne le `ProductID` est retiré de la `DataKeys` approprié et collection `ProductsRow` est sélectionné dans le `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="5f9e1-269">Les quatre contrôles d’entrée TemplateField sont référencés par programmation et leurs valeurs assignées à la `ProductsRow` s propriétés de l’instance.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="5f9e1-270">Après chaque GridView les valeurs de ligne s ont été utilisées pour mettre à jour le `ProductsDataTable`, il s passé à la couche BLL s `UpdateWithTransaction` méthode qui, comme nous l’avons vu dans le didacticiel précédent, appelle simplement vers le bas dans la couche DAL s `UpdateWithTransaction` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="5f9e1-271">L’algorithme de mise à jour de lot utilisé pour ce didacticiel met à jour chaque ligne dans le `ProductsDataTable` qui correspond à une ligne dans le contrôle GridView, indépendamment de si les informations de produit s a été modifiées.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="5f9e1-272">Bien que ces mises à jour aveugle ne sont pas généralement un problème de performances, elles peuvent entraîner des enregistrements superflus si vous faites l’audit change à la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="5f9e1-273">Dans le [effectuant des mises à jour par lots](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) didacticiel, nous avons exploré un lot de mise à jour d’interface avec le contrôle DataList et ajouté du code uniquement mise à jour les enregistrements qui ont été réellement modifiés par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="5f9e1-274">N’hésitez pas à utiliser les techniques de [effectuant des mises à jour par lots](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) pour mettre à jour le code dans ce didacticiel, si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="5f9e1-275">Lors de la liaison de la source de données pour le contrôle GridView via sa balise active, Visual Studio affecte automatiquement les valeurs de clé primaire données source s au GridView s `DataKeyNames` propriété.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="5f9e1-276">Si vous n’avez pas lié à ObjectDataSource au GridView via la balise active de GridView s comme indiqué à l’étape 1, vous devez définir manuellement le s GridView `DataKeyNames` propriété ProductID afin d’accéder à la `ProductID` valeur pour chaque ligne via le `DataKeys` collection.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="5f9e1-277">Le code utilisé dans `BatchUpdate` est similaire à celle utilisée dans la couche BLL s `UpdateProduct` méthodes, la principale différence est que, dans le `UpdateProduct` méthodes qu’un seul `ProductRow` instance est récupérée à partir de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="5f9e1-278">Le code qui affecte les propriétés de la `ProductRow` est le même entre le `UpdateProducts` méthodes et le code dans le `foreach` boucle dans la `BatchUpdate`, comme est le modèle global.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `foreach` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="5f9e1-279">Pour suivre ce didacticiel, nous devons disposer le `BatchUpdate` méthode appelée lorsque vous cliquez sur un des boutons de produits de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="5f9e1-280">Créer des gestionnaires d’événements pour le `Click` événements de ces deux contrôles de bouton et ajoutez le code suivant dans les gestionnaires d’événements :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample6.cs)]

<span data-ttu-id="5f9e1-281">Tout d’abord un appel est fait pour `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="5f9e1-282">Ensuite, le `ClientScript property` est utilisé pour injecter du code JavaScript qui affiche un messagebox qui lit les produits ont été mis à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-282">Next, the `ClientScript property` is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="5f9e1-283">Prenez une minute pour tester ce code.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-283">Take a minute to test out this code.</span></span> <span data-ttu-id="5f9e1-284">Visitez `BatchUpdate.aspx` via un navigateur, modifier un nombre de lignes, puis cliquez sur un des boutons de produits de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="5f9e1-285">En supposant qu’il n’y a aucune erreur de validation d’entrée, vous devez voir une messagebox qui lit que les produits ont été mis à jour.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="5f9e1-286">Pour vérifier la cohérence de la mise à jour, vous pouvez envisager un aléatoire `CHECK` contrainte, comme un qui n’autorise pas `UnitPrice` valeurs de 1234.56 en.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="5f9e1-287">Ensuite, dans `BatchUpdate.aspx`, modifier un nombre d’enregistrements, en veillant à définir un des produit s `UnitPrice` valeur à la valeur interdite (1234.56 en).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="5f9e1-288">Cela doit entraîner une erreur lors de l’en cliquant sur les produits de mise à jour avec les autres modifications au cours de cette opération de traitement par lots restaurée à leurs valeurs d’origine.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="5f9e1-289">Une Alternative`BatchUpdate`(méthode)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="5f9e1-290">Le `BatchUpdate` méthode on exagère un peu examiné récupère *tous les* des produits à partir de la couche BLL s `GetProducts` méthode puis met à jour uniquement les enregistrements qui s’affichent dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="5f9e1-291">Cette approche est idéale si le contrôle GridView n’utilise pas la pagination, mais le cas échéant, il peut être des centaines, des milliers ou des dizaines de milliers de produits, mais seulement dix lignes dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="5f9e1-292">Dans ce cas, l’obtention de tous les produits à partir de la base de données uniquement pour modifier les 10 d'entre eux est loin d’être idéal.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="5f9e1-293">Pour ces types de situations, envisagez d’utiliser les éléments suivants `BatchUpdateAlternate` méthode à la place :</span><span class="sxs-lookup"><span data-stu-id="5f9e1-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample7.cs)]

<span data-ttu-id="5f9e1-294">`BatchMethodAlternate` démarre en créant un nouveau vide `ProductsDataTable` nommé `products`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="5f9e1-295">Il puis parcourt le s GridView `Rows` collection et, pour chaque ligne Obtient les informations de produit spécifique à l’aide de la couche BLL s `GetProductByProductID(productID)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="5f9e1-296">Récupérées `ProductsRow` instance a ses propriétés mis à jour dans la même manière que `BatchUpdate`, mais après la mise à jour de la ligne, il est importé dans le `products``ProductsDataTable` via le s DataTable [ `ImportRow(DataRow)` méthode](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products``ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="5f9e1-297">Après le `foreach` boucle se termine, `products` contient un `ProductsRow` instance pour chaque ligne dans le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-297">After the `foreach` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="5f9e1-298">Étant donné que chaque du `ProductsRow` instances ont été ajoutées à la `products` (au lieu de mise à jour), si nous transmettons à aveuglément le `UpdateWithTransaction` (méthode) le `ProductsTableAdapter` tente d’insérer les enregistrements de la base de données.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="5f9e1-299">Au lieu de cela, nous devons spécifier que chacune de ces lignes ont été modifiée (ne pas ajouté).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="5f9e1-300">Cela est possible en ajoutant une nouvelle méthode à la couche BLL nommée `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="5f9e1-301">`UpdateProductsWithTransaction`, jeux illustré ci-dessous, le `RowState` de chacune de la `ProductsRow` instances dans le `ProductsDataTable` à `Modified` , puis transmet le `ProductsDataTable` à la couche DAL s `UpdateWithTransaction` (méthode).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample8.cs)]

## <a name="summary"></a><span data-ttu-id="5f9e1-302">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="5f9e1-302">Summary</span></span>

<span data-ttu-id="5f9e1-303">Le contrôle GridView fournit des fonctionnalités de modification de ligne intégré, mais ne dispose pas de prise en charge pour la création d’interfaces entièrement modifiables.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="5f9e1-304">Comme nous l’avons vu dans ce didacticiel, ces interfaces sont possibles, mais nécessitent un peu de travail.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="5f9e1-305">Pour créer un GridView où chaque ligne est modifiable, nous devons convertir les champs de s GridView en TemplateField et définir l’interface de modification dans le `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="5f9e1-306">En outre, mettre à jour tous les - type de contrôle de bouton Web doit être ajouté à la page, distincte de GridView.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="5f9e1-307">Ces boutons `Click` gestionnaires d’événements doivent énumérer le s GridView `Rows` collecte, stocke les modifications dans un `ProductsDataTable`et transmettre les informations mises à jour dans la méthode appropriée de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="5f9e1-308">Dans le didacticiel suivant, nous allons voir comment créer une interface pour la suppression par lots.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="5f9e1-309">En particulier, chaque ligne GridView inclut une case à cocher et à la place de tout mettre à jour-tapez boutons, nous aurons des boutons de supprimer les lignes sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="5f9e1-310">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="5f9e1-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5f9e1-311">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="5f9e1-311">About the Author</span></span>

<span data-ttu-id="5f9e1-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept les livres sur ASP/ASP.NET et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5f9e1-313">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5f9e1-314">Son dernier ouvrage est [*SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5f9e1-315">Il peut être contacté à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="5f9e1-316">ou via son blog, qui se trouve à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="5f9e1-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5f9e1-317">Remerciements</span><span class="sxs-lookup"><span data-stu-id="5f9e1-317">Special Thanks To</span></span>

<span data-ttu-id="5f9e1-318">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5f9e1-319">Les réviseurs tête pour ce didacticiel ont été Teresa Murphy et David Suru.</span><span class="sxs-lookup"><span data-stu-id="5f9e1-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="5f9e1-320">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="5f9e1-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5f9e1-321">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5f9e1-322">[Précédent](wrapping-database-modifications-within-a-transaction-cs.md)
> [Suivant](batch-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="5f9e1-322">[Previous](wrapping-database-modifications-within-a-transaction-cs.md)
[Next](batch-deleting-cs.md)</span></span>
