---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
title: Création d’un fournisseur de plan de Site personnalisé piloté sur la base de données (VB) | Microsoft Docs
author: rick-anderson
description: Le fournisseur de plan de site par défaut dans ASP.NET 2.0 récupère ses données à partir d’un fichier XML statique. Tandis que le fournisseur basé sur XML est adapté à de nombreuses petites et moyennes-siz...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: f904cd2c-a408-4484-9324-8b8d7fe33893
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-vb
msc.type: authoredcontent
ms.openlocfilehash: 0883750f00c81b831b2c178d187b6ba518607152
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65109078"
---
# <a name="building-a-custom-database-driven-site-map-provider-vb"></a><span data-ttu-id="ac2f5-104">Création d’un fournisseur de plan de site personnalisé piloté par une base de données (VB)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-104">Building a Custom Database-Driven Site Map Provider (VB)</span></span>

<span data-ttu-id="ac2f5-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ac2f5-106">[Télécharger le Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) ou [télécharger le PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_VB.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-vb/_static/datatutorial62vb1.pdf)</span></span>

> <span data-ttu-id="ac2f5-107">Le fournisseur de plan de site par défaut dans ASP.NET 2.0 récupère ses données à partir d’un fichier XML statique.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="ac2f5-108">Tandis que le fournisseur basé sur XML est adapté à de nombreux sites Web de petites et moyennes, les applications Web plus importantes nécessitent un plan de site plus dynamique.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="ac2f5-109">Dans ce didacticiel, que nous allons créer un fournisseur de plan de site personnalisé qui récupère ses données à partir de la couche de logique métier, qui à son tour récupère les données à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="ac2f5-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="ac2f5-110">Introduction</span></span>

<span data-ttu-id="ac2f5-111">ASP.NET 2.0 caractéristique de carte de site s permet à un développeur de page définir un plan de site web application s dans un support permanent, comme dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="ac2f5-112">Une fois défini, les données de plan de site sont accessible par programme via le [ `SiteMap` classe](https://msdn.microsoft.com/library/system.web.sitemap.aspx) dans le [ `System.Web` espace de noms](https://msdn.microsoft.com/library/system.web.aspx) ou via un large éventail de navigation Web contrôles, tels que le Contrôles SiteMapPath, un Menu et TreeView.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="ac2f5-113">Le système de mappage de site utilise le [modèle de fournisseur](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) afin que les implémentations de sérialisation de plan de site différent peuvent être créées et connectées à une application web.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="ac2f5-114">Le fournisseur de plan de site par défaut qui est fourni avec ASP.NET 2.0 conserve la structure de plan de site dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="ac2f5-115">Dans le [Pages maîtres et Navigation dans les sites](../introduction/master-pages-and-site-navigation-vb.md) didacticiel, nous avons créé un fichier nommé `Web.sitemap` qui contenues de cette structure et avoir été mise à jour son XML avec chaque nouvelle section du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="ac2f5-116">Le fournisseur de plan de site basé sur XML par défaut fonctionne bien si la structure de s de plan de site est relativement statique, comme pour ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="ac2f5-117">Toutefois, dans de nombreux scénarios, un plan de site plus dynamique est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="ac2f5-118">Envisagez le plan de site illustré à la Figure 1, où chaque catégorie et chaque produit s’affichent sous forme de sections dans la structure du site Web s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="ac2f5-119">Avec ce plan de site, visitez la page web correspondant au nœud racine peut répertorier toutes les catégories, tandis que de visiter une page web de catégorie particulière s répertorie ce produit est s catégorie et affichage d’une page web de produit particulier s serait afficher ce produit s Détails.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="ac2f5-120">[![Les catégories et les produits composition la Structure du plan s Site](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-vb/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image1.png)</span></span>

<span data-ttu-id="ac2f5-121">**Figure 1**: Les catégories et la composition de produits de la Structure de s plan du Site ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image2.png))</span></span>

<span data-ttu-id="ac2f5-122">Bien que cette structure en fonction de catégorie et de produit peut être codée en dur dans le `Web.sitemap` fichier, le fichier doit mettre à jour chaque fois qu’une catégorie ou un produit a été ajouté, supprimé ou renommé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="ac2f5-123">Par conséquent, la maintenance de plan de site est considérablement simplifiée si sa structure a été récupérée à partir de la base de données ou, dans l’idéal, à partir de la couche de logique métier de l’architecture d’application s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="ac2f5-124">De cette façon, comme les produits et les catégories ont été ajoutés, renommés ou supprimés, le plan de site est automatiquement mise à jour pour refléter ces modifications.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="ac2f5-125">Étant donné que la sérialisation de carte de site de s ASP.NET 2.0 est construite sur le modèle de fournisseur, nous pouvons créer notre propre fournisseur de plan de site personnalisé qui extrait ses données à partir d’un magasin de données alternatifs, tels que la base de données ou l’architecture.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="ac2f5-126">Dans ce didacticiel, nous allons créer un fournisseur personnalisé qui récupère ses données à partir de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="ac2f5-127">Laissez s commencer !</span><span class="sxs-lookup"><span data-stu-id="ac2f5-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="ac2f5-128">Le fournisseur de plan de site personnalisé créé dans ce didacticiel est étroitement lié au modèle d’application s architecture et données.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="ac2f5-129">Jeff Prosise s [stocker les plans de Site dans SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) et [le fournisseur de plan de Site SQL ve vous attendiez](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examiner une approche généralisée au stockage des données de plan de site dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="ac2f5-130">Étape 1 : Création de Pages Web Site personnalisé carte fournisseur</span><span class="sxs-lookup"><span data-stu-id="ac2f5-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="ac2f5-131">Avant de commencer la création d’un fournisseur de plan de site personnalisé, permettent de s tout d’abord ajouter les pages ASP.NET que nous avons besoin pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="ac2f5-132">Commencez par ajouter un nouveau dossier nommé `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="ac2f5-133">Ensuite, ajoutez les pages ASP.NET suivantes à ce dossier, en veillant à associer chaque page avec le `Site.master` page maître :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="ac2f5-134">Ajoutez également un `CustomProviders` sous-dossier pour le `App_Code` dossier.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Ajouter les Pages ASP.NET pour les didacticiels liée au fournisseur de plan de Site](building-a-custom-database-driven-site-map-provider-vb/_static/image2.gif)

<span data-ttu-id="ac2f5-136">**Figure 2**: Ajouter les Pages ASP.NET pour les didacticiels liée au fournisseur de plan de Site</span><span class="sxs-lookup"><span data-stu-id="ac2f5-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="ac2f5-137">Dans la mesure où il n'existe qu’un didacticiel pour cette section, nous n’avez pas besoin `Default.aspx` pour répertorier les didacticiels de section s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="ac2f5-138">Au lieu de cela, `Default.aspx` affichera les catégories dans un contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="ac2f5-139">Nous les aborderons cela à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="ac2f5-140">Ensuite, mettez à jour `Web.sitemap` à inclure une référence à la `Default.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="ac2f5-141">Plus précisément, ajoutez le balisage suivant après la mise en cache `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="ac2f5-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample1.xml)]

<span data-ttu-id="ac2f5-142">Après la mise à jour `Web.sitemap`, prenez un moment pour afficher le site Web de didacticiels via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="ac2f5-143">Le menu de gauche inclut désormais un élément pour le didacticiel de fournisseur de carte de site unique.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Le plan de Site comprend désormais une entrée pour le didacticiel de fournisseur de plan de Site](building-a-custom-database-driven-site-map-provider-vb/_static/image3.gif)

<span data-ttu-id="ac2f5-145">**Figure 3**: Le plan de Site comprend désormais une entrée pour le didacticiel de fournisseur de plan de Site</span><span class="sxs-lookup"><span data-stu-id="ac2f5-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="ac2f5-146">Ce didacticiel s principal objectif est d’illustrer la création d’un fournisseur de plan de site personnalisé et la configuration d’une application web pour utiliser ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="ac2f5-147">En particulier, nous allons créer un fournisseur qui retourne un plan de site qui inclut un nœud racine, ainsi que d’un nœud pour chaque catégorie et chaque produit, comme illustré dans la Figure 1.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="ac2f5-148">En général, chaque nœud dans le plan de site peut spécifier une URL.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="ac2f5-149">Pour notre plan de site, l’URL racine du nœud s sera `~/SiteMapProvider/Default.aspx`, qui répertorie toutes les catégories dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="ac2f5-150">Chaque nœud de catégorie dans le plan de site aura une URL qui pointe vers `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, qui répertorie tous les produits spécifié *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="ac2f5-151">Enfin, chaque nœud de plan de site de produit pointera vers `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, qui affiche les détails de produit spécifique s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="ac2f5-152">Pour démarrer nous devons créer la `Default.aspx`, `ProductsByCategory.aspx`, et `ProductDetails.aspx` pages.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="ac2f5-153">Ces pages sont terminées dans les étapes 2, 3 et 4, respectivement.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="ac2f5-154">Étant donné que le sujet de ce didacticiel est de fournisseurs de plan de site, et étant donné que les derniers didacticiels ont couvert création ces sortes de plusieurs page maître/détail rapports, nous sera Dépêchez-vous via les étapes 2 à 4.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="ac2f5-155">Si vous ne savez plus sur la création de rapports maître/détail qui s’étendent sur plusieurs pages, revenir à la [filtrage de maître/détail sur deux Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-vb.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="ac2f5-156">Étape 2 : Affiche la liste des catégories</span><span class="sxs-lookup"><span data-stu-id="ac2f5-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="ac2f5-157">Ouvrir le `Default.aspx` page dans le `SiteMapProvider` dossier et faites glisser un GridView à partir de la boîte à outils vers le concepteur, en définissant son `ID` à `Categories`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="ac2f5-158">À partir de la balise active de s GridView, liez-le à une nouvelle ObjectDataSource nommé `CategoriesDataSource` et configurez-la afin qu’il récupère ses données à l’aide de la `CategoriesBLL` classe s `GetCategories` (méthode).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="ac2f5-159">Dans la mesure où ce GridView affiche les catégories uniquement et ne fournit pas de fonctionnalités de modification de données, définissez les listes déroulantes dans la mise à jour, insertion et supprimer des onglets à (None).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="ac2f5-160">[![Configurer l’ObjectDataSource pour retourner des catégories à l’aide de la méthode GetCategories](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-vb/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image3.png)</span></span>

<span data-ttu-id="ac2f5-161">**Figure 4**: Configurer l’ObjectDataSource à retourner de catégories à l’aide du `GetCategories` (méthode) ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image4.png))</span></span>

<span data-ttu-id="ac2f5-162">[![Définir les listes déroulantes dans la mise à jour, insertion et supprimer des onglets à (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image5.png)</span></span>

<span data-ttu-id="ac2f5-163">**Figure 5**: La valeur est la liste déroulante répertorie dans la mise à jour, insertion et supprimer des onglets (aucun) ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image6.png))</span></span>

<span data-ttu-id="ac2f5-164">À l’issue de l’Assistant Configurer la Source de données, Visual Studio ajoute un BoundField pour `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, et `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="ac2f5-165">Modifier le contrôle GridView pour qu’il contienne uniquement les `CategoryName` et `Description` BoundFields et mettre à jour le `CategoryName` BoundField s `HeaderText` propriété à la catégorie.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="ac2f5-166">Ensuite, ajoutez un HyperLinkField et placez-le donc qu’il s le champ le plus à gauche.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="ac2f5-167">Définir le `DataNavigateUrlFields` propriété `CategoryID` et `DataNavigateUrlFormatString` propriété `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="ac2f5-168">Définir le `Text` propriété pour afficher les produits.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-168">Set the `Text` property to View Products .</span></span>

![Ajouter un HyperLinkField au GridView catégories](building-a-custom-database-driven-site-map-provider-vb/_static/image6.gif)

<span data-ttu-id="ac2f5-170">**Figure 6**: Ajouter un HyperLinkField à la `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="ac2f5-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="ac2f5-171">Après avoir créé les ObjectDataSource et personnaliser les champs de s GridView, le balisage déclaratif de deux contrôles se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample2.aspx)]

<span data-ttu-id="ac2f5-172">La figure 7 illustre `Default.aspx` lorsqu’ils sont affichés via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="ac2f5-173">Une catégorie s afficher les produits lien vous amène à `ProductsByCategory.aspx?CategoryID=categoryID`, ce qui nous allons créer à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="ac2f5-174">[![Chaque catégorie est répertorié avec un lien de produits d’affichage](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-vb/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image7.png)</span></span>

<span data-ttu-id="ac2f5-175">**Figure 7**: Chaque catégorie est répertorié avec un lien de produits de vue ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="ac2f5-176">Étape 3 : Répertorier les produits de s catégorie sélectionnée</span><span class="sxs-lookup"><span data-stu-id="ac2f5-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="ac2f5-177">Ouvrez le `ProductsByCategory.aspx` page et ajoutez un GridView, nommez-le `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="ac2f5-178">À partir de sa balise active, lier le contrôle GridView à une nouvelle ObjectDataSource nommé `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="ac2f5-179">Configurer l’ObjectDataSource à utiliser le `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` (méthode) et définissez la liste déroulante répertorie à (None) dans les onglets UPDATE, INSERT et DELETE.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="ac2f5-180">[![Utilisez la méthode de GetProductsByCategoryID(categoryID) ProductsBLL classe s](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image9.png)</span></span>

<span data-ttu-id="ac2f5-181">**Figure 8**: Utilisez le `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` (méthode) ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image10.png))</span></span>

<span data-ttu-id="ac2f5-182">L’étape finale de l’Assistant Configurer la Source de données vous invite à entrer pour une source de paramètre pour *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="ac2f5-183">Dans la mesure où ces informations sont passées via le champ de chaîne de requête `CategoryID`, sélectionnez la chaîne de requête dans la liste déroulante et entrez CategoryID dans la zone de texte QueryStringField, comme illustré à la Figure 9.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="ac2f5-184">Cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="ac2f5-185">[![Utilisez le champ de chaîne de requête de CategoryID pour la paramètre categoryID](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-vb/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image11.png)</span></span>

<span data-ttu-id="ac2f5-186">**Figure 9**: Utilisez le `CategoryID` Querystring Field pour le *categoryID* paramètre ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image12.png))</span></span>

<span data-ttu-id="ac2f5-187">À l’issue de l’Assistant, Visual Studio ajoutera BoundFields correspondante et un CheckBoxField au GridView pour les champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="ac2f5-188">Supprimer tout sauf la `ProductName`, `UnitPrice`, et `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="ac2f5-189">Personnaliser ces trois BoundFields `HeaderText` propriétés pour lire des produits, les prix et les fournisseurs, respectivement.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="ac2f5-190">Format du `UnitPrice` BoundField sous forme de devise.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="ac2f5-191">Ensuite, ajoutez un HyperLinkField et déplacez-le vers la position la plus à gauche.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="ac2f5-192">Définir son `Text` propriété pour afficher des détails, son `DataNavigateUrlFields` propriété `ProductID`et son `DataNavigateUrlFormatString` propriété `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Ajouter un HyperLinkField de détails de vue qui pointe vers ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image10.gif)

<span data-ttu-id="ac2f5-194">**Figure 10**: Ajouter un HyperLinkField de détails de vue qui pointe vers `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="ac2f5-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="ac2f5-195">Après avoir apporté ces personnalisations, le balisage déclaratif s GridView et ObjectDataSource doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample3.aspx)]

<span data-ttu-id="ac2f5-196">Retourner à l’affichage `Default.aspx` via un navigateur et d’un clic sur les produits de la vue de lier le correspondant aux boissons.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="ac2f5-197">Ceci vous dirigera vers `ProductsByCategory.aspx?CategoryID=1`, affichant les noms, les prix et les fournisseurs des produits dans la base de données Northwind qui appartiennent à la catégorie des boissons (voir Figure 11).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="ac2f5-198">N’hésitez pas à améliorer cette page pour inclure un lien pour retourner les utilisateurs à la page de liste de catégorie (`Default.aspx`) et un contrôle DetailsView ou FormView qui affiche le nom de la catégorie sélectionnée s et la description.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="ac2f5-199">[![Les noms des boissons, les prix et les fournisseurs sont affichés.](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image13.png)</span></span>

<span data-ttu-id="ac2f5-200">**Figure 11**: Les noms des boissons, les prix et les fournisseurs sont affichés ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="ac2f5-201">Étape 4 : Affiche une description du produit s</span><span class="sxs-lookup"><span data-stu-id="ac2f5-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="ac2f5-202">La dernière page, `ProductDetails.aspx`, affiche les détails des produits sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="ac2f5-203">Ouvrez `ProductDetails.aspx` et faites glisser un contrôle DetailsView à partir de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="ac2f5-204">Définir le contrôle DetailsView s `ID` propriété `ProductInfo` et d’effacer les sa `Height` et `Width` les valeurs de propriété.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="ac2f5-205">À partir de sa balise active, lier le contrôle DetailsView à une nouvelle ObjectDataSource nommé `ProductDataSource`, configuration ObjectDataSource afin d’extraire ses données à partir de la `ProductsBLL` classe s `GetProductByProductID(productID)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="ac2f5-206">Comme avec les pages web créées dans les étapes 2 et 3, définir les listes déroulantes dans la mise à jour, insertion et supprimer des onglets à (None).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="ac2f5-207">[![Configurer pour utiliser la méthode GetProductByProductID(productID) ObjectDataSource](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-vb/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.png)</span></span>

<span data-ttu-id="ac2f5-208">**Figure 12**: Configurer l’ObjectDataSource à utiliser le `GetProductByProductID(productID)` (méthode) ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image16.png))</span></span>

<span data-ttu-id="ac2f5-209">La dernière étape de l’Assistant Configurer la Source de données vous invite à entrer pour la source de la *productID* paramètre.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="ac2f5-210">Dans la mesure où ces données sont affichées via le champ de chaîne de requête `ProductID`, la valeur de la liste déroulante chaîne de requête et de la zone de texte QueryStringField ProductID.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="ac2f5-211">Enfin, cliquez sur le bouton Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="ac2f5-212">[![Configurer le paramètre pour extraire sa valeur à partir du champ de chaîne de requête ProductID productID](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-vb/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image17.png)</span></span>

<span data-ttu-id="ac2f5-213">**Figure 13**: Configurer le *productID* paramètre pour extraire sa valeur à partir de la `ProductID` Querystring Field ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image18.png))</span></span>

<span data-ttu-id="ac2f5-214">À l’issue de l’Assistant Configurer la Source de données, Visual Studio créera BoundFields correspondante et un CheckBoxField dans le contrôle DetailsView pour les champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="ac2f5-215">Supprimer le `ProductID`, `SupplierID`, et `CategoryID` BoundFields et configurer les champs restants, comme vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="ac2f5-216">Après un certain nombre de configurations esthétiques, mon balisage déclaratif s DetailsView et ObjectDataSource ressemblait à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample4.aspx)]

<span data-ttu-id="ac2f5-217">Pour tester cette page, revenez à `Default.aspx` , puis cliquez sur Afficher les produits pour la catégorie des boissons.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="ac2f5-218">Dans la liste de produits de boissons, cliquez sur le lien Afficher les détails pour Chai thé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="ac2f5-219">Ceci vous dirigera vers `ProductDetails.aspx?ProductID=1`, qui montre un s Chai thé détails (voir Figure 14).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="ac2f5-220">[![Thé Chai s fournisseur, catégorie, prix et autres informations s’affiche.](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-vb/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image19.png)</span></span>

<span data-ttu-id="ac2f5-221">**Figure 14**: Thé Chai s fournisseur, catégorie, prix et autres informations s’affiche ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="ac2f5-222">Étape 5 : Présentation du fonctionnement interne d’un fournisseur de plan de Site</span><span class="sxs-lookup"><span data-stu-id="ac2f5-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="ac2f5-223">Le plan de site est représenté dans la mémoire du serveur s web comme une collection de `SiteMapNode` instances qui forment une hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="ac2f5-224">Il doit y avoir exactement une seule racine, tous les nœuds non racine doivent avoir exactement un nœud parent et tous les nœuds peuvent avoir un nombre arbitraire d’enfants.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="ac2f5-225">Chaque `SiteMapNode` objet représente une section dans la structure du site Web s ; ces sections comportent généralement une page web correspondante.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="ac2f5-226">Par conséquent, le [ `SiteMapNode` classe](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) possède des propriétés comme `Title`, `Url`, et `Description`, qui fournissent des informations de la section la `SiteMapNode` représente.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="ac2f5-227">Il existe également un `Key` propriété qui identifie de façon unique chaque `SiteMapNode` dans la hiérarchie, ainsi que les propriétés utilisées pour établir cette hiérarchie `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="ac2f5-228">Figure 15 illustre la structure du plan général du site à partir de la Figure 1, mais avec les détails d’implémentation décrit en détail.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="ac2f5-229">[![Chaque noeud SiteMapNode a des propriétés telles que titre, Url, clé et ainsi de suite](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-vb/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image15.gif)</span></span>

<span data-ttu-id="ac2f5-230">**Figure 15**: Chaque `SiteMapNode` a des propriétés telles que `Title`, `Url`, `Key`, et ainsi de suite ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image17.gif))</span></span>

<span data-ttu-id="ac2f5-231">Le plan de site est accessible via la [ `SiteMap` classe](https://msdn.microsoft.com/library/system.web.sitemap.aspx) dans le [ `System.Web` espace de noms](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="ac2f5-232">Cette classe s `RootNode` propriété retourne la racine du site carte s `SiteMapNode` instance ; `CurrentNode` retourne le `SiteMapNode` dont `Url` propriété correspond à l’URL de la page actuellement demandée.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="ac2f5-233">Cette classe est utilisée en interne par les contrôles ASP.NET 2.0 s navigation Web.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="ac2f5-234">Lorsque le `SiteMap` des propriétés de la classe s sont accessibles, il doit sérialiser la structure de plan de site à partir d’un support persistant dans la mémoire.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="ac2f5-235">Toutefois, la logique de sérialisation de carte de site n'est pas codé en dur dans le `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="ac2f5-236">Au lieu de cela, lors de l’exécution le `SiteMap` classe détermine quel plan de site *fournisseur* à utiliser pour la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="ac2f5-237">Par défaut, le [ `XmlSiteMapProvider` classe](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) est utilisé, qui lit la structure du plan s site à partir d’un fichier XML correctement mis en forme.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="ac2f5-238">Toutefois, avec un peu de travail, nous pouvons créer notre propre fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="ac2f5-239">Tous les fournisseurs de plan de site doivent être dérivés de la [ `SiteMapProvider` classe](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), qui inclut les méthodes essentielles et les propriétés nécessaires pour le site mapper des fournisseurs, mais omet de nombreux détails de l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="ac2f5-240">Une deuxième classe, [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), étend la `SiteMapProvider` classe et contient une implémentation plus robuste de la fonctionnalité requise.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="ac2f5-241">En interne, le `StaticSiteMapProvider` stocke la `SiteMapNode` mappent les instances du site dans un `Hashtable` et fournit des méthodes telles que `AddNode(child, parent)`, `RemoveNode(siteMapNode),` et `Clear()` qui ajoutent et suppriment `SiteMapNode` s pour le texte interne `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="ac2f5-242">`XmlSiteMapProvider` est dérivé de `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="ac2f5-243">Lorsque la création d’un fournisseur de plan de site personnalisé qui étend `StaticSiteMapProvider`, il existe deux méthodes abstraites qui doivent être remplacées : [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) et [ `GetRootNodeCore` ](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="ac2f5-244">`BuildSiteMap`, comme son nom l’indique, est responsable du chargement de la structure de plan de site à partir d’un stockage persistant et il construction en mémoire.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="ac2f5-245">`GetRootNodeCore` Renvoie le nœud racine dans le plan du site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="ac2f5-246">Avant une web application peut utiliser un fournisseur de plan de site qu'il doit être inscrit dans la configuration d’application s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="ac2f5-247">Par défaut, le `XmlSiteMapProvider` classe est inscrite à l’aide du nom `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="ac2f5-248">Pour inscrire des fournisseurs de plan de site supplémentaires, ajoutez le balisage suivant à `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="ac2f5-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample5.xml)]

<span data-ttu-id="ac2f5-249">Le *nom* valeur assigne un nom explicite pour le fournisseur lors de la *type* Spécifie le nom de type qualifié complet du fournisseur de plan de site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="ac2f5-250">Nous allons explorer des valeurs concrètes pour la *nom* et *type* valeurs à l’étape 7, après nous ve créé notre fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="ac2f5-251">La classe de fournisseur de plan de site est instanciée de la première fois, il est accessible à partir de la `SiteMap` classe et reste en mémoire pour la durée de vie de l’application web.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="ac2f5-252">Étant donné qu’une seule instance du fournisseur de plan de site qui peut-être être appelée à partir de multiples, simultanées aux visiteurs, il est impératif que les méthodes du fournisseur s être *thread-safe*.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="ac2f5-253">Pour des raisons de performances et évolutivité, il s important que nous mettons en cache le site en mémoire mapper la structure et retourner cette mise en cache structure plutôt que de recréer chaque fois que le `BuildSiteMap` méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="ac2f5-254">`BuildSiteMap` peut être appelée plusieurs fois par demande de page par utilisateur, selon les contrôles de navigation en cours d’utilisation sur la page et la profondeur de la structure de plan de site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="ac2f5-255">Dans tous les cas, si nous ne pas mettre en cache la structure de plan de site dans `BuildSiteMap` puis chaque fois qu’elle est appelée que nous devons récupérer de nouveau les informations de produit et la catégorie de l’architecture (ce qui entraînerait une requête à la base de données).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="ac2f5-256">Comme expliqué dans les mise en cache les didacticiels précédents, données mises en cache peuvent devenir obsolètes.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="ac2f5-257">Pour remédier à ce problème, nous pouvons utiliser le temps - ou les expirations de dans le cache basé sur la dépendance SQL.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="ac2f5-258">Un fournisseur de plan de site peut également remplacer le [ `Initialize` méthode](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="ac2f5-259">`Initialize` est appelé lorsque le fournisseur de plan de site est instancié et est transmis à tous les attributs personnalisés affectés au fournisseur dans `Web.config` dans le `<add>` élément tel que : `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="ac2f5-260">Il est utile si vous souhaitez permettre à un développeur de page spécifier les paramètres liée au fournisseur de carte de site différents sans avoir à modifier le code du fournisseur s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="ac2f5-261">Par exemple, si nous étions lire les données de catégorie et produits directement à partir de la base de données, par opposition à l’architecture, nous d probablement souhaitez permettent au développeur de page de spécifier la chaîne de connexion de base de données via `Web.config` au lieu d’utiliser un incrustées valeur dans le code du fournisseur s.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="ac2f5-262">Le fournisseur de plan de site personnalisé que nous allons créer à l’étape 6 ne remplace pas cette `Initialize` (méthode).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="ac2f5-263">Pour obtenir un exemple d’utilisation de la `Initialize` (méthode), reportez-vous à [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [stocker les plans de Site dans SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="ac2f5-264">Étape 6 : Créer le fournisseur de plan de Site personnalisé</span><span class="sxs-lookup"><span data-stu-id="ac2f5-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="ac2f5-265">Pour créer un fournisseur de plan de site personnalisé qui génère le plan de site à partir des catégories et des produits dans la base de données Northwind, nous devons créer une classe qui étend `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="ac2f5-266">À l’étape 1, j’ai demandé vous permet d’ajouter un `CustomProviders` dossier dans le `App_Code` dossier - ajouter une nouvelle classe dans ce dossier nommé `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="ac2f5-267">Ajoutez le code suivant à la classe `NorthwindSiteMapProvider` :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample6.vb)]

<span data-ttu-id="ac2f5-268">Permettent de commencer par Explorer cette classe s s `BuildSiteMap` (méthode), qui commence par un [ `lock` instruction](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="ac2f5-269">La `lock` instruction autorise uniquement un seul thread à la fois à entrer, ainsi accès à son code de sérialisation et empêche l’exécution pas à pas sur eux s moins d’une vingtaine de deux threads simultanés.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="ac2f5-270">Niveau de la classe `SiteMapNode` variable `root` est utilisé pour mettre en cache de la structure de plan de site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="ac2f5-271">Lorsque le plan de site est créée pour la première fois, ou pour la première fois, une fois que les données sous-jacentes a été modifiées, `root` sera `Nothing` et la structure de plan de site sera construite.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `Nothing` and the site map structure will be constructed.</span></span> <span data-ttu-id="ac2f5-272">Le nœud racine de la carte s site est affecté à `root` pendant la construction processus afin que la prochaine fois que cette méthode est appelé, `root` ne sera pas `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `Nothing`.</span></span> <span data-ttu-id="ac2f5-273">Par conséquent, tant que `root` n’est pas `Nothing` la structure de plan de site s’affichera à l’appelant sans avoir à le recréer.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-273">Consequently, so long as `root` is not `Nothing` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="ac2f5-274">Si la racine est `Nothing`, la structure de plan de site est créée à partir des informations produit et la catégorie.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-274">If root is `Nothing`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="ac2f5-275">Le mappage de site est créé en créant le `SiteMapNode` instances et former ensuite la hiérarchie via des appels à la `StaticSiteMapProvider` classe s `AddNode` (méthode).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="ac2f5-276">`AddNode` effectue la comptabilité interne, en stockant l’assorties `SiteMapNode` instances dans un `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="ac2f5-277">Avant de commencer la construction de la hiérarchie, nous commençons en appelant le `Clear` (méthode), ce qui efface les éléments à partir de la liste interne `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="ac2f5-278">Ensuite, le `ProductsBLL` classe s `GetProducts` méthode et résultant `ProductsDataTable` sont stockés dans des variables locales.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="ac2f5-279">La construction d’un mappage s site commence par créer le nœud racine et en l’assignant à `root`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="ac2f5-280">La surcharge de la [ `SiteMapNode` constructeur de s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) utilisé ici et tout au long de ce `BuildSiteMap` est passé les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="ac2f5-281">Une référence au fournisseur de plan de site (`Me`).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-281">A reference to the site map provider (`Me`).</span></span>
- <span data-ttu-id="ac2f5-282">Le `SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="ac2f5-283">Cela nécessaire la valeur doit être unique pour chaque `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="ac2f5-284">Le `SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="ac2f5-285">`Url` est facultatif, mais s’il est fourni, chacun `SiteMapNode` s `Url` valeur doit être unique.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="ac2f5-286">Le `SiteMapNode` s `Title`, ce qui est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="ac2f5-287">Le `AddNode(root)` appel de méthode ajoute la `SiteMapNode` `root` au plan du site comme racine.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="ac2f5-288">Ensuite, chaque `ProductRow` dans le `ProductsDataTable` est énuméré.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="ac2f5-289">S’il existe déjà un `SiteMapNode` pour la catégorie de produit s actuelle, il est référencé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="ac2f5-290">Sinon, un nouveau `SiteMapNode` pour la catégorie est créée et ajoutée en tant qu’enfant de le `SiteMapNode``root` via la `AddNode(categoryNode, root)` appel de méthode.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="ac2f5-291">Après la catégorie appropriée `SiteMapNode` nœud a été trouvé ou créé, un `SiteMapNode` est créé pour le produit actuel et ajouté en tant qu’enfant de la catégorie `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="ac2f5-292">Notez que la catégorie `SiteMapNode` s `Url` valeur de propriété est `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` tandis que le produit `SiteMapNode` s `Url` est affectée à `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="ac2f5-293">Possédant une base de données `NULL` valeur pour leurs `CategoryID` sont regroupés sous une catégorie `SiteMapNode` dont `Title` propriété est définie sur None et dont la propriété `Url` propriété est définie sur une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="ac2f5-294">J’ai décidé de définir `Url` sur une chaîne vide depuis le `ProductBLL` classe s `GetProductsByCategory(categoryID)` méthode ne dispose pas actuellement la fonctionnalité permettant de retourner uniquement les produits avec une `NULL` `CategoryID` valeur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="ac2f5-295">En outre, je souhaitais démontrer comment les contrôles de navigation restituent un `SiteMapNode` auquel il manque une valeur pour son `Url` propriété.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="ac2f5-296">Je vous encourage à étendre ce didacticiel afin qu’aucune `SiteMapNode` s `Url` propriété pointe vers `ProductsByCategory.aspx`, encore affiche uniquement les produits avec `NULL` `CategoryID` valeurs.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="ac2f5-297">Après avoir construit le plan du site, un objet arbitraire est ajouté au cache de données à l’aide d’une dépendance de cache SQL sur le `Categories` et `Products` tables via une `AggregateCacheDependency` objet.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="ac2f5-298">Nous avons explorés à l’aide de dépendances de cache SQL dans le didacticiel précédent, *à l’aide des dépendances de Cache SQL*.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="ac2f5-299">Le fournisseur de plan de site personnalisé, cependant, utilise une surcharge du cache de données s `Insert` méthode que nous avons ve encore à Explorer.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="ac2f5-300">Cette surcharge accepte comme paramètre d’entrée finale un délégué qui est appelé lorsque l’objet est supprimé du cache.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="ac2f5-301">Plus précisément, nous passons dans un nouveau [ `CacheItemRemovedCallback` déléguer](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) qui pointe vers le `OnSiteMapChanged` méthode définies plus bas dans la `NorthwindSiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="ac2f5-302">La représentation en mémoire du plan de site est mis en cache via la variable de niveau classe `root`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="ac2f5-303">Étant donné qu’une seule instance de la classe de fournisseur de plan de site personnalisé, et étant donné que cette instance est partagée entre tous les threads dans l’application web, cette variable de la classe sert un cache.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="ac2f5-304">Le `BuildSiteMap` méthode utilise également le cache de données, mais uniquement comme un moyen de recevoir une notification lorsque les données dans la base de données sous-jacent le `Categories` ou `Products` modifications des tables.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="ac2f5-305">Notez que la valeur placée dans le cache de données est simplement la date et heure actuelles.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="ac2f5-306">Les données de plan de site réel sont *pas* placés dans le cache de données.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="ac2f5-307">Le `BuildSiteMap` méthode se termine en renvoyant le nœud racine du plan de site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="ac2f5-308">Les méthodes restantes sont assez simples.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="ac2f5-309">`GetRootNodeCore` est chargée de retourner le nœud racine.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="ac2f5-310">Dans la mesure où `BuildSiteMap` retourne la racine, `GetRootNodeCore` renvoie simplement `BuildSiteMap` s retourner de valeur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="ac2f5-311">Le `OnSiteMapChanged` méthode jeux `root` à `Nothing` lorsque l’élément de cache est supprimé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-311">The `OnSiteMapChanged` method sets `root` back to `Nothing` when the cache item is removed.</span></span> <span data-ttu-id="ac2f5-312">Avec racine retrouvent `Nothing`, la prochaine fois `BuildSiteMap` est appelé, la structure de plan de site va être régénérée.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-312">With root set back to `Nothing`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="ac2f5-313">Enfin, le `CachedDate` propriété retourne la valeur de date et d’heure stockée dans le cache de données, si cette valeur existe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="ac2f5-314">Cette propriété peut être utilisée par un développeur de pages pour déterminer quand les données de plan de site a été dernière mise en cache.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="ac2f5-315">Étape 7 : L’inscription du`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="ac2f5-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="ac2f5-316">Dans l’ordre de notre application web à utiliser le `NorthwindSiteMapProvider` fournisseur de plan de site créé à l’étape 6, nous avons besoin pour l’inscrire dans le `<siteMap>` section de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="ac2f5-317">Plus précisément, ajoutez le balisage suivant dans le `<system.web>` élément dans `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="ac2f5-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample7.xml)]

<span data-ttu-id="ac2f5-318">Ce balisage effectue deux opérations : tout d’abord, cela indique que l’intégrée `AspNetXmlSiteMapProvider` est le fournisseur de plan de site par défaut ; Deuxièmement, elle enregistre le fournisseur de plan de site personnalisé créé à l’étape 6 avec le nom convivial Northwind.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="ac2f5-319">Pour les fournisseurs de plan de site situés dans l’application s `App_Code` dossier, la valeur de la `type` attribut est simplement le nom de classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="ac2f5-320">Vous pouvez également, le fournisseur de plan de site personnalisé pourrait ont été créé dans un projet de bibliothèque de classes distinct avec l’assembly compilé est placé dans le s d’application web `/Bin` directory.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="ac2f5-321">Dans ce cas, le `type` valeur d’attribut serait *Namespace*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="ac2f5-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="ac2f5-322">Après la mise à jour `Web.config`, prenez un moment pour afficher n’importe quelle page dans les didacticiels dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="ac2f5-323">Notez que l’interface de navigation de gauche affiche toujours les sections et didacticiels défini dans `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="ac2f5-324">Il s’agit, car nous avons laissé `AspNetXmlSiteMapProvider` en tant que le fournisseur par défaut.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="ac2f5-325">Pour créer un élément d’interface utilisateur navigation qui utilise le `NorthwindSiteMapProvider`, nous allons devoir spécifier explicitement que le fournisseur de plan de site de Northwind doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="ac2f5-326">Nous verrons comment procéder à l’étape 8.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="ac2f5-327">Étape 8 : Affichage des informations de plan de Site à l’aide du fournisseur de plan de Site personnalisé</span><span class="sxs-lookup"><span data-stu-id="ac2f5-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="ac2f5-328">Avec le site personnalisé fournisseur de plan créés et enregistrés dans `Web.config`, nous vous êtes prêt à ajouter des contrôles de navigation à la `Default.aspx`, `ProductsByCategory.aspx`, et `ProductDetails.aspx` des pages dans le `SiteMapProvider` dossier.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="ac2f5-329">Commencez par ouvrir le `Default.aspx` page et faites glisser un `SiteMapPath` à partir de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="ac2f5-330">Le contrôle SiteMapPath se trouve dans la section de Navigation de la boîte à outils.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="ac2f5-331">[![Ajouter un SiteMapPath à Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-vb/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image18.gif)</span></span>

<span data-ttu-id="ac2f5-332">**Figure 16**: Ajouter un SiteMapPath à `Default.aspx` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image20.gif))</span></span>

<span data-ttu-id="ac2f5-333">Le contrôle SiteMapPath affiche un fil d’Ariane, indiquant l’emplacement de s de page actuel dans le plan du site.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="ac2f5-334">Nous avons ajouté un SiteMapPath vers le haut de la page maître dans le *Pages maîtres et Navigation du Site* didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="ac2f5-335">Prenez un moment pour afficher cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="ac2f5-336">Le contrôle SiteMapPath ajouté à la Figure 16 utilise le fournisseur de plan de site par défaut, extraction de ses données à partir de `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="ac2f5-337">Par conséquent, la barre de navigation affiche accueil &gt; personnaliser le plan du Site, tout comme la barre de navigation dans le coin supérieur droit.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="ac2f5-338">[![Le plan de site utilise le fournisseur de plan de Site par défaut](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-vb/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.gif)</span></span>

<span data-ttu-id="ac2f5-339">**Figure 17**: Le plan de site utilise le fournisseur de plan de Site par défaut ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image23.gif))</span></span>

<span data-ttu-id="ac2f5-340">Pour que le contrôle SiteMapPath ajouté à la Figure 16 à utiliser le fournisseur de plan de site personnalisé nous avons créé à l’étape 6, définissez son [ `SiteMapProvider` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) à Northwind, le nom que nous avons attribué à la `NorthwindSiteMapProvider` dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="ac2f5-341">Malheureusement, le Concepteur continue d’utiliser le fournisseur de plan de site par défaut, mais si vous visitez la page via un navigateur après avoir apporté cette modification de propriété vous verrez que la barre de navigation utilise désormais le fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="ac2f5-342">[![La barre de navigation utilise désormais le NorthwindSiteMapProvider de fournisseur de carte de Site personnalisé](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image24.gif)</span></span>

<span data-ttu-id="ac2f5-343">**Figure 18**: La barre de navigation utilise désormais le fournisseur de plan de Site personnalisé `NorthwindSiteMapProvider` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image26.gif))</span></span>

<span data-ttu-id="ac2f5-344">Le contrôle SiteMapPath affiche une interface utilisateur plus fonctionnelle dans le `ProductsByCategory.aspx` et `ProductDetails.aspx` pages.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="ac2f5-345">Ajouter un SiteMapPath à ces pages, en définissant le `SiteMapProvider` propriété dans les deux à Northwind.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="ac2f5-346">À partir de `Default.aspx` cliquez sur le lien Afficher les produits correspondant aux boissons, puis sur le lien Afficher les détails pour Chai thé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="ac2f5-347">Comme le montre la Figure 19, la barre de navigation comprend la section de la carte de site en cours (Tea Martin) et ses ancêtres : Beverages et toutes les catégories.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="ac2f5-348">[![La barre de navigation utilise désormais le NorthwindSiteMapProvider de fournisseur de carte de Site personnalisé](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-vb/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image21.png)</span></span>

<span data-ttu-id="ac2f5-349">**Figure 19**: La barre de navigation utilise désormais le fournisseur de plan de Site personnalisé `NorthwindSiteMapProvider` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image22.png))</span></span>

<span data-ttu-id="ac2f5-350">Autres éléments d’interface utilisateur navigation peuvent être utilisés en plus le contrôle SiteMapPath, tels que les contrôles Menu et TreeView.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="ac2f5-351">Le `Default.aspx`, `ProductsByCategory.aspx`, et `ProductDetails.aspx` dans le téléchargement de ce didacticiel, par exemple, les pages incluent toutes les contrôles de Menu (voir la Figure 20).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="ac2f5-352">Consultez [s examinant ASP.NET 2.0 les fonctionnalités de Navigation de Site](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) et le [à l’aide de contrôles de Navigation du Site](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section de la [guides de démarrage rapide ASP.NET 2.0](https://quickstarts.asp.net/QuickStartv20/aspnet/) pour examiner plus approfondie la contrôles de navigation et de système de mappage de site dans ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="ac2f5-353">[![Le contrôle de Menu répertorie chacune des catégories et des produits](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-vb/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-vb/_static/image28.gif)</span></span>

<span data-ttu-id="ac2f5-354">**Figure 20**: Le Menu contrôle répertorie chaque des catégories et des produits ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="ac2f5-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-vb/_static/image30.gif))</span></span>

<span data-ttu-id="ac2f5-355">Comme mentionné précédemment dans ce didacticiel, la structure de plan de site est accessible par programme via le `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="ac2f5-356">Le code suivant retourne la racine `SiteMapNode` du fournisseur par défaut :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample8.vb)]

<span data-ttu-id="ac2f5-357">Dans la mesure où le `AspNetXmlSiteMapProvider` est le fournisseur par défaut pour notre application, le code ci-dessus renvoie le nœud racine défini dans `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="ac2f5-358">Pour faire référence à un fournisseur de plan de site autre que la valeur par défaut, utilisez le `SiteMap` classe s [ `Providers` propriété](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) comme suit :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample9.vb)]

<span data-ttu-id="ac2f5-359">Où *nom* est le nom du fournisseur de plan de site personnalisé (Northwind, pour notre application web).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="ac2f5-360">Pour accéder à un membre spécifique à un fournisseur de plan de site, utilisez `SiteMap.Providers["name"]` pour récupérer l’instance du fournisseur et puis effectuer un cast vers le type approprié.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="ac2f5-361">Par exemple, pour afficher le `NorthwindSiteMapProvider` s `CachedDate` propriété dans une page ASP.NET, utilisez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-vb[Main](building-a-custom-database-driven-site-map-provider-vb/samples/sample10.vb)]

> [!NOTE]
> <span data-ttu-id="ac2f5-362">Veillez à tester la fonctionnalité de dépendance de cache SQL.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="ac2f5-363">Après vous rendant sur le `Default.aspx`, `ProductsByCategory.aspx`, et `ProductDetails.aspx` pages, accédez à un des didacticiels dans l’édition, insertion et suppression de section et modifier le nom d’une catégorie ou un produit.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="ac2f5-364">Puis revenez à une des pages dans le `SiteMapProvider` dossier.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="ac2f5-365">En supposant que suffisamment de temps est écoulé pour le mécanisme d’interrogation de noter la modification apportée à la base de données sous-jacente, le plan de site doit être mis à jour pour afficher le nouveau produit ou le nom de catégorie.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="ac2f5-366">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="ac2f5-366">Summary</span></span>

<span data-ttu-id="ac2f5-367">ASP.NET 2.0 inclut des fonctions de mappage de site s un `SiteMap` (classe), un nombre de fonctionnalités de navigation Web de contrôles, et un fournisseur de plan de site par défaut qui attend les informations de plan de site rendues persistantes dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="ac2f5-368">Pour pouvoir utiliser les informations de plan de site à partir d’une autre source, par exemple à partir d’une base de données, l’architecture d’application s ou un service Web à distance, que nous devons créer un fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="ac2f5-369">Cela implique la création d’une classe qui dérive directement ou indirectement, à partir de la `SiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="ac2f5-370">Dans ce didacticiel, nous avons vu comment créer un fournisseur de plan de site personnalisé qui selon le plan du site les informations de produit et la catégorie éliminées de l’architecture d’application.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="ac2f5-371">Notre fournisseur étendu la `StaticSiteMapProvider` de classe et de création impliquée un `BuildSiteMap` méthode qui extrait les données, construits de la hiérarchie de plan de site et mis en cache de la structure qui en résulte dans une variable de niveau classe.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="ac2f5-372">Nous avons utilisé une dépendance de cache SQL avec une fonction de rappel pour invalider la mise en cache lorsque structure sous-jacent `Categories` ou `Products` de données est modifiée.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="ac2f5-373">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="ac2f5-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="ac2f5-374">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ac2f5-374">Further Reading</span></span>

<span data-ttu-id="ac2f5-375">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="ac2f5-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="ac2f5-376">[Stockage des plans de Site dans SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) et [le fournisseur de plan de Site SQL ve vous attendiez](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="ac2f5-377">Modèle de fournisseur s un coup de œil à ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="ac2f5-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="ac2f5-378">Le Kit de ressources de fournisseur</span><span class="sxs-lookup"><span data-stu-id="ac2f5-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="ac2f5-379">Examen d’ASP.NET 2.0 fonctionnalités de Navigation du Site s</span><span class="sxs-lookup"><span data-stu-id="ac2f5-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="ac2f5-380">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="ac2f5-380">About the Author</span></span>

<span data-ttu-id="ac2f5-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept les livres sur ASP/ASP.NET et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ac2f5-382">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ac2f5-383">Son dernier ouvrage est [*SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ac2f5-384">Il peut être contacté à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ac2f5-385">ou via son blog, qui se trouve à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="ac2f5-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ac2f5-386">Remerciements</span><span class="sxs-lookup"><span data-stu-id="ac2f5-386">Special Thanks To</span></span>

<span data-ttu-id="ac2f5-387">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ac2f5-388">Les réviseurs tête pour ce didacticiel ont été Dave Gardner, Zack Jones, Teresa Murphy et Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="ac2f5-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="ac2f5-389">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="ac2f5-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ac2f5-390">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ac2f5-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="ac2f5-391">Précédent</span><span class="sxs-lookup"><span data-stu-id="ac2f5-391">Previous</span></span>](building-a-custom-database-driven-site-map-provider-cs.md)
