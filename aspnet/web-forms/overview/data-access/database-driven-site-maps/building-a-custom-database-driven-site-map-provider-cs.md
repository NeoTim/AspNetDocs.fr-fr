---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Création d’un fournisseur de plan de site personnalisé baséC#sur une base de données () | Microsoft Docs
author: rick-anderson
description: Le fournisseur de plan de site par défaut dans ASP.NET 2,0 récupère ses données à partir d’un fichier XML statique. Alors que le fournisseur basé sur XML est adapté à de nombreux petits et moyennes SIZ...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e27b37703b12c9796e8516f0d805aef1fdf8d8
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78611985"
---
# <a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="e64da-104">Création d’un fournisseur de plan de site personnalisé piloté par une base de données (C#)</span><span class="sxs-lookup"><span data-stu-id="e64da-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>

<span data-ttu-id="e64da-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e64da-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e64da-106">[Télécharger le code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) ou [Télécharger le PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e64da-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="e64da-107">Le fournisseur de plan de site par défaut dans ASP.NET 2,0 récupère ses données à partir d’un fichier XML statique.</span><span class="sxs-lookup"><span data-stu-id="e64da-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="e64da-108">Bien que le fournisseur basé sur XML soit adapté à de nombreux sites Web de petite et moyenne taille, les applications Web plus volumineuses requièrent un plan de site plus dynamique.</span><span class="sxs-lookup"><span data-stu-id="e64da-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="e64da-109">Dans ce didacticiel, nous allons créer un fournisseur de plan de site personnalisé qui récupère ses données à partir de la couche de logique métier, qui à son tour récupère les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="e64da-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="e64da-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="e64da-110">Introduction</span></span>

<span data-ttu-id="e64da-111">La fonctionnalité de plan de site ASP.NET 2,0 permet à un développeur de pages de définir un plan de site d’application Web dans un support permanent, comme dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="e64da-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="e64da-112">Une fois définis, les données de plan de site sont accessibles par programme par le biais de la [classe`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) dans l' [espace de noms`System.Web`](https://msdn.microsoft.com/library/system.web.aspx) ou par l’intermédiaire de divers contrôles Web de navigation, tels que les contrôles SiteMapPath, menu et TreeView.</span><span class="sxs-lookup"><span data-stu-id="e64da-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="e64da-113">Le système de plan de site utilise le [modèle de fournisseur](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) afin que différentes implémentations de sérialisation de plan de site puissent être créées et connectées à une application Web.</span><span class="sxs-lookup"><span data-stu-id="e64da-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="e64da-114">Le fournisseur de plan de site par défaut fourni avec ASP.NET 2,0 rend persistante la structure de plan de site dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="e64da-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="e64da-115">De retour dans le didacticiel sur les [pages maîtres et la navigation dans les sites,](../introduction/master-pages-and-site-navigation-cs.md) nous avons créé un fichier nommé `Web.sitemap` qui contenait cette structure et mis à jour son code XML avec chaque nouvelle section du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e64da-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="e64da-116">Le fournisseur de plan de site XML par défaut fonctionne bien si la structure du plan du site est relativement statique, par exemple pour ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="e64da-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="e64da-117">Toutefois, dans de nombreux scénarios, un plan de site plus dynamique est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e64da-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="e64da-118">Prenons l’exemple du plan de site illustré dans la figure 1, où chaque catégorie et produit s’affiche sous la forme de sections dans la structure des sites Web.</span><span class="sxs-lookup"><span data-stu-id="e64da-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="e64da-119">Avec ce plan de site, la page Web correspondant au nœud racine peut répertorier toutes les catégories, tandis que la visite d’une page Web de catégorie s particulière répertorie les produits de la catégorie et l’affichage d’une page Web de produit spécifique.</span><span class="sxs-lookup"><span data-stu-id="e64da-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="e64da-120">[![les catégories et les produits qui compensent la structure du plan du site](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="e64da-121">**Figure 1**: catégories et produits qui comportent la structure du plan du site ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>

<span data-ttu-id="e64da-122">Bien que cette structure basée sur le produit et la catégorie puisse être codée en dur dans le fichier `Web.sitemap`, le fichier doit être mis à jour chaque fois qu’une catégorie ou un produit a été ajouté, supprimé ou renommé.</span><span class="sxs-lookup"><span data-stu-id="e64da-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="e64da-123">Par conséquent, la maintenance du plan de site est considérablement simplifiée si sa structure a été extraite de la base de données ou, dans l’idéal, à partir de la couche de logique métier de l’architecture des applications.</span><span class="sxs-lookup"><span data-stu-id="e64da-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="e64da-124">Ainsi, à mesure que des produits et des catégories ont été ajoutés, renommés ou supprimés, le plan de site est automatiquement mis à jour pour refléter ces modifications.</span><span class="sxs-lookup"><span data-stu-id="e64da-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="e64da-125">Étant donné que la sérialisation de plan de site ASP.NET 2,0 s est construite au-dessus du modèle de fournisseur, nous pouvons créer notre propre fournisseur de plan de site personnalisé qui extrait ses données d’un autre magasin de données, tel que la base de données ou l’architecture.</span><span class="sxs-lookup"><span data-stu-id="e64da-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="e64da-126">Dans ce didacticiel, nous allons créer un fournisseur personnalisé qui récupère ses données à partir de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="e64da-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="e64da-127">Commençons !</span><span class="sxs-lookup"><span data-stu-id="e64da-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="e64da-128">Le fournisseur de plan de site personnalisé créé dans ce didacticiel est étroitement couplé à l’architecture et au modèle de données de l’application.</span><span class="sxs-lookup"><span data-stu-id="e64da-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="e64da-129">Jeff Prosise [stocke les plans de site dans SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) et [le fournisseur de plan de site SQL que vous avez attendu pour](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) les articles, en examinant une approche généralisée du stockage des données de plan de site dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e64da-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="e64da-130">Étape 1 : création des pages Web du fournisseur de plan de site personnalisé</span><span class="sxs-lookup"><span data-stu-id="e64da-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="e64da-131">Avant de commencer à créer un fournisseur de plan de site personnalisé, nous allons d’abord ajouter les pages ASP.NET dont nous aurons besoin pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e64da-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="e64da-132">Commencez par ajouter un nouveau dossier nommé `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="e64da-133">Ajoutez ensuite les pages ASP.NET suivantes à ce dossier, en veillant à associer chaque page à la page maître `Site.master` :</span><span class="sxs-lookup"><span data-stu-id="e64da-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="e64da-134">Ajoutez également un sous-dossier `CustomProviders` au dossier `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="e64da-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Ajouter les pages ASP.NET pour les didacticiels relatifs au fournisseur de plan de site](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="e64da-136">**Figure 2**: ajouter les pages ASP.net pour les didacticiels relatifs au fournisseur de plan de site</span><span class="sxs-lookup"><span data-stu-id="e64da-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="e64da-137">Étant donné qu’il n’y a qu’un seul didacticiel pour cette section, nous n’avons pas besoin de `Default.aspx` pour répertorier les didacticiels de la section.</span><span class="sxs-lookup"><span data-stu-id="e64da-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="e64da-138">Au lieu de cela, `Default.aspx` affichera les catégories dans un contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e64da-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="e64da-139">Nous allons l’aborder à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="e64da-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="e64da-140">Ensuite, mettez à jour `Web.sitemap` pour inclure une référence à la page `Default.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e64da-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="e64da-141">Plus précisément, ajoutez le balisage suivant après la `<siteMapNode>`de mise en cache :</span><span class="sxs-lookup"><span data-stu-id="e64da-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="e64da-142">Après avoir mis à jour `Web.sitemap`, prenez un moment pour afficher le site Web des didacticiels via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e64da-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="e64da-143">Le menu sur la gauche comprend désormais un élément pour le seul didacticiel du fournisseur de plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Le plan de site comprend désormais une entrée pour le didacticiel du fournisseur de plan de site](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="e64da-145">**Figure 3**: le plan de site contient désormais une entrée pour le didacticiel du fournisseur de plan de site</span><span class="sxs-lookup"><span data-stu-id="e64da-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="e64da-146">Ce didacticiel s’intéresse principalement à la création d’un fournisseur de plan de site personnalisé et à la configuration d’une application Web pour utiliser ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e64da-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="e64da-147">En particulier, nous allons créer un fournisseur qui retourne un plan de site qui comprend un nœud racine avec un nœud pour chaque catégorie et produit, comme illustré à la figure 1.</span><span class="sxs-lookup"><span data-stu-id="e64da-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="e64da-148">En général, chaque nœud du plan de site peut spécifier une URL.</span><span class="sxs-lookup"><span data-stu-id="e64da-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="e64da-149">Pour notre plan de site, l’URL des nœuds racine est `~/SiteMapProvider/Default.aspx`, qui répertorie toutes les catégories dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="e64da-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="e64da-150">Chaque nœud de catégorie dans le plan de site aura une URL qui pointe vers `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, qui répertorie tous les produits de la *catégorie CategoryID*spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e64da-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="e64da-151">Enfin, chaque nœud de plan de site de produit pointera vers `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, qui affichera les détails spécifiques du produit.</span><span class="sxs-lookup"><span data-stu-id="e64da-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="e64da-152">Pour commencer, nous devons créer les pages `Default.aspx`, `ProductsByCategory.aspx`et `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e64da-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="e64da-153">Ces pages sont remplies aux étapes 2, 3 et 4, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e64da-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="e64da-154">Dans la mesure où la poussée de ce didacticiel est sur les fournisseurs de plan de site, et comme les didacticiels précédents ont abordé la création de ces types de rapports maîtres/détails de plusieurs pages, nous nous contenterons de suivre les étapes 2 à 4.</span><span class="sxs-lookup"><span data-stu-id="e64da-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="e64da-155">Si vous avez besoin d’un actualisateur pour créer des rapports maître/détail qui s’étendent sur plusieurs pages, reportez-vous au didacticiel [maître/détail pour le filtrage dans deux pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="e64da-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="e64da-156">Étape 2 : affichage d’une liste de catégories</span><span class="sxs-lookup"><span data-stu-id="e64da-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="e64da-157">Ouvrez la page `Default.aspx` dans le dossier `SiteMapProvider` et faites glisser un contrôle GridView de la boîte à outils vers le concepteur, en affectant à sa `ID` la valeur `Categories`.</span><span class="sxs-lookup"><span data-stu-id="e64da-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="e64da-158">À partir de la balise active GridView s, liez-le à un nouvel ObjectDataSource nommé `CategoriesDataSource` et configurez-le de sorte qu’il récupère ses données à l’aide de la méthode `CategoriesBLL` classe s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="e64da-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="e64da-159">Étant donné que ce GridView affiche uniquement les catégories et ne fournit pas de fonctionnalités de modification des données, définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="e64da-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="e64da-160">[![configurer ObjectDataSource pour retourner des catégories à l’aide de la méthode GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="e64da-161">**Figure 4**: configurer ObjectDataSource pour retourner des catégories à l’aide de la méthode `GetCategories` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>

<span data-ttu-id="e64da-162">[![définir les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="e64da-163">**Figure 5**: définir les listes déroulantes des onglets mettre à jour, insérer et supprimer sur (aucun) ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>

<span data-ttu-id="e64da-164">À l’issue de l’exécution de l’Assistant Configuration de la source de données, Visual Studio ajoute un BoundField pour `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`et `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="e64da-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="e64da-165">Modifiez le contrôle GridView afin qu’il ne contienne que les `CategoryName` et `Description` BoundFields et mettez à jour la propriété `CategoryName` BoundField s `HeaderText` en Category.</span><span class="sxs-lookup"><span data-stu-id="e64da-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="e64da-166">Ensuite, ajoutez un HyperLinkField et positionnez-le pour qu’il s’agit du champ le plus à gauche.</span><span class="sxs-lookup"><span data-stu-id="e64da-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="e64da-167">Affectez à la propriété `DataNavigateUrlFields` la valeur `CategoryID` et à la propriété `DataNavigateUrlFormatString` la valeur `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="e64da-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="e64da-168">Définissez la propriété `Text` pour afficher les produits.</span><span class="sxs-lookup"><span data-stu-id="e64da-168">Set the `Text` property to View Products .</span></span>

![Ajouter un HyperLinkField à la catégorie GridView](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="e64da-170">**Figure 6**: ajouter un HyperLinkField à la `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="e64da-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="e64da-171">Après avoir créé l’ObjectDataSource et personnalisé les champs GridView s, les deux contrôles de balisage déclaratifs se présentent comme suit :</span><span class="sxs-lookup"><span data-stu-id="e64da-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="e64da-172">La figure 7 illustre `Default.aspx` affichées dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e64da-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="e64da-173">Le fait de cliquer sur un lien Afficher les produits des catégories vous amène à `ProductsByCategory.aspx?CategoryID=categoryID`, que nous allons générer à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="e64da-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="e64da-174">[![chaque catégorie est indiquée avec un lien Afficher les produits](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="e64da-175">**Figure 7**: chaque catégorie est indiquée avec un lien Afficher les produits ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="e64da-176">Étape 3 : affichage des produits des catégories sélectionnées</span><span class="sxs-lookup"><span data-stu-id="e64da-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="e64da-177">Ouvrez la page `ProductsByCategory.aspx` et ajoutez un GridView, en lui attribuant un nom `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="e64da-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="e64da-178">À partir de sa balise active, liez le contrôle GridView à un nouvel ObjectDataSource nommé `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="e64da-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="e64da-179">Configurez le ObjectDataSource pour utiliser la méthode `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` et définissez les listes déroulantes sur (aucune) dans les onglets mettre à jour, insérer et supprimer.</span><span class="sxs-lookup"><span data-stu-id="e64da-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="e64da-180">[![utilisez la méthode ProductsBLL de la classe s GetProductsByCategoryID (categoryID)](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="e64da-181">**Figure 8**: utiliser la méthode `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>

<span data-ttu-id="e64da-182">La dernière étape de l’Assistant Configuration de la source de données vous invite à entrer une source de paramètres pour *CategoryID*.</span><span class="sxs-lookup"><span data-stu-id="e64da-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="e64da-183">Étant donné que ces informations sont transmises via le champ QueryString `CategoryID`, sélectionnez QueryString dans la liste déroulante et entrez CategoryID dans la zone de texte QueryStringField, comme illustré à la figure 9.</span><span class="sxs-lookup"><span data-stu-id="e64da-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="e64da-184">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="e64da-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="e64da-185">[![utiliser le champ CategoryID QueryString pour le paramètre categoryID](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="e64da-186">**Figure 9**: utilisation du champ `CategoryID` QueryString pour le paramètre *CategoryID* ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>

<span data-ttu-id="e64da-187">Une fois l’Assistant terminé, Visual Studio ajoute les BoundFields correspondants et un CheckBoxField au GridView pour les champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="e64da-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="e64da-188">Supprimez tout sauf les `ProductName`, `UnitPrice`et `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="e64da-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="e64da-189">Personnalisez ces trois propriétés de `HeaderText` BoundFields pour lire respectivement le produit, le prix et le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e64da-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="e64da-190">Mettez en forme la `UnitPrice` BoundField comme une devise.</span><span class="sxs-lookup"><span data-stu-id="e64da-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="e64da-191">Ensuite, ajoutez un HyperLinkField et déplacez-le à la position la plus à gauche.</span><span class="sxs-lookup"><span data-stu-id="e64da-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="e64da-192">Définissez sa propriété `Text` pour afficher les détails, sa propriété `DataNavigateUrlFields` à `ProductID`, et sa propriété `DataNavigateUrlFormatString` à `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="e64da-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Ajouter un HyperLinkField détails de la vue qui pointe vers ProductDetails. aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="e64da-194">**Figure 10**: ajouter un HyperLinkField détails de la vue qui pointe vers `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="e64da-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="e64da-195">Après avoir effectué ces personnalisations, les balises déclaratives GridView et ObjectDataSource doivent ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e64da-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="e64da-196">Revenez à l’affichage des `Default.aspx` via un navigateur et cliquez sur le lien Afficher les produits pour les boissons.</span><span class="sxs-lookup"><span data-stu-id="e64da-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="e64da-197">Cela vous permet d’accéder à `ProductsByCategory.aspx?CategoryID=1`, en affichant les noms, les prix et les fournisseurs des produits de la base de données Northwind qui appartiennent à la catégorie boissons (voir figure 11).</span><span class="sxs-lookup"><span data-stu-id="e64da-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="e64da-198">N’hésitez pas à améliorer cette page pour inclure un lien permettant de renvoyer des utilisateurs vers la page de liste de catégories (`Default.aspx`) et un contrôle DetailsView ou FormView qui affiche le nom et la description de la catégorie sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="e64da-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="e64da-199">[![les noms des boissons, les prix et les fournisseurs sont affichés](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="e64da-200">**Figure 11**: affichage des noms des boissons, des prix et des fournisseurs ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="e64da-201">Étape 4 : présentation des détails du produit</span><span class="sxs-lookup"><span data-stu-id="e64da-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="e64da-202">La dernière page, `ProductDetails.aspx`, affiche les détails des produits sélectionnés.</span><span class="sxs-lookup"><span data-stu-id="e64da-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="e64da-203">Ouvrez `ProductDetails.aspx` et faites glisser un DetailsView de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="e64da-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="e64da-204">Affectez à la propriété DetailsView s `ID` la valeur `ProductInfo` et effacez ses valeurs de propriété `Height` et `Width`.</span><span class="sxs-lookup"><span data-stu-id="e64da-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="e64da-205">À partir de sa balise active, liez le DetailsView à un nouvel ObjectDataSource nommé `ProductDataSource`, en configurant ObjectDataSource pour extraire ses données de la méthode de `ProductsBLL` classe s `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="e64da-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="e64da-206">Comme pour les pages Web précédentes créées aux étapes 2 et 3, définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="e64da-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="e64da-207">[![configurer ObjectDataSource pour utiliser la méthode GetProductByProductID (productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="e64da-208">**Figure 12**: configurer ObjectDataSource pour utiliser la méthode `GetProductByProductID(productID)` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>

<span data-ttu-id="e64da-209">La dernière étape de l’Assistant Configuration de la source de données vous invite à entrer la source du paramètre *ProductID* .</span><span class="sxs-lookup"><span data-stu-id="e64da-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="e64da-210">Étant donné que ces données proviennent du champ QueryString `ProductID`, définissez la liste déroulante sur QueryString et la zone de texte QueryStringField sur ProductID.</span><span class="sxs-lookup"><span data-stu-id="e64da-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="e64da-211">Enfin, cliquez sur le bouton Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="e64da-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="e64da-212">[![configurez le paramètre productID pour extraire sa valeur du champ ProductID QueryString](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="e64da-213">**Figure 13**: configurer le paramètre *ProductID* pour extraire sa valeur du champ `ProductID` QueryString ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>

<span data-ttu-id="e64da-214">À l’issue de l’exécution de l’Assistant Configuration de la source de données, Visual Studio crée les BoundFields correspondants et un CheckBoxField dans le DetailsView pour les champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="e64da-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="e64da-215">Supprimez le `ProductID`, `SupplierID`et `CategoryID` BoundFields et configurez les champs restants à votre convenance.</span><span class="sxs-lookup"><span data-stu-id="e64da-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="e64da-216">Après quelques configurations esthétiques, le balisage déclaratif de mes DetailsView et ObjectDataSource ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e64da-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="e64da-217">Pour tester cette page, revenez à `Default.aspx` et cliquez sur Afficher les produits pour la catégorie boissons.</span><span class="sxs-lookup"><span data-stu-id="e64da-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="e64da-218">Dans la liste des produits de boisson, cliquez sur le lien Afficher les détails pour le thé chai.</span><span class="sxs-lookup"><span data-stu-id="e64da-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="e64da-219">Cela vous permet d’accéder à `ProductDetails.aspx?ProductID=1`, qui affiche les détails de la thé chai (voir figure 14).</span><span class="sxs-lookup"><span data-stu-id="e64da-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="e64da-220">[![Chai thé, le fournisseur, la catégorie, le prix et d’autres informations s’affichent](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="e64da-221">**Figure 14**: le fournisseur, la catégorie, le prix et d’autres informations du thé chai sont affichés ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="e64da-222">Étape 5 : comprendre le fonctionnement interne d’un fournisseur de plan de site</span><span class="sxs-lookup"><span data-stu-id="e64da-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="e64da-223">Le plan de site est représenté dans la mémoire du serveur Web sous la forme d’une collection d’instances de `SiteMapNode` formant une hiérarchie.</span><span class="sxs-lookup"><span data-stu-id="e64da-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="e64da-224">Il doit y avoir exactement une racine, tous les nœuds non racine doivent avoir un seul nœud parent, et tous les nœuds peuvent avoir un nombre arbitraire d’enfants.</span><span class="sxs-lookup"><span data-stu-id="e64da-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="e64da-225">Chaque objet `SiteMapNode` représente une section dans la structure du site Web. ces sections comportent généralement une page Web correspondante.</span><span class="sxs-lookup"><span data-stu-id="e64da-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="e64da-226">Par conséquent, la [classe`SiteMapNode`](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) possède des propriétés telles que `Title`, `Url`et `Description`, qui fournissent des informations pour la section que le `SiteMapNode` représente.</span><span class="sxs-lookup"><span data-stu-id="e64da-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="e64da-227">Il existe également une propriété `Key` qui identifie de façon unique chaque `SiteMapNode` dans la hiérarchie, ainsi que les propriétés utilisées pour établir cette hiérarchie `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, etc.</span><span class="sxs-lookup"><span data-stu-id="e64da-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="e64da-228">La figure 15 illustre la structure générale du plan de site de la figure 1, mais avec les détails de l’implémentation esquissés plus en détail.</span><span class="sxs-lookup"><span data-stu-id="e64da-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="e64da-229">[![chaque SiteMapNode a des propriétés telles que titre, URL, clé, etc.](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="e64da-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="e64da-230">**Figure 15**: chaque `SiteMapNode` possède des propriétés comme `Title`, `Url`, `Key`, etc. ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="e64da-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>

<span data-ttu-id="e64da-231">Le plan de site est accessible via la [classe`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) de l' [espace de noms`System.Web`](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="e64da-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="e64da-232">Cette classe s `RootNode` propriété retourne l’instance de `SiteMapNode` racine du plan du site. `CurrentNode` retourne le `SiteMapNode` dont la propriété `Url` correspond à l’URL de la page actuellement demandée.</span><span class="sxs-lookup"><span data-stu-id="e64da-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="e64da-233">Cette classe est utilisée en interne par les contrôles Web de navigation ASP.NET 2,0 s.</span><span class="sxs-lookup"><span data-stu-id="e64da-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="e64da-234">Lors de l’accès aux propriétés de la classe `SiteMap`, elle doit sérialiser la structure du plan de site à partir d’un support persistant en mémoire.</span><span class="sxs-lookup"><span data-stu-id="e64da-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="e64da-235">Toutefois, la logique de sérialisation du plan de site n’est pas codée en dur dans la classe `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="e64da-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="e64da-236">Au moment de l’exécution, la classe `SiteMap` détermine le *fournisseur* de plan de site à utiliser pour la sérialisation.</span><span class="sxs-lookup"><span data-stu-id="e64da-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="e64da-237">Par défaut, la [classe`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) est utilisée, qui lit la structure du plan de site à partir d’un fichier XML correctement mis en forme.</span><span class="sxs-lookup"><span data-stu-id="e64da-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="e64da-238">Toutefois, avec un peu de travail, nous pouvons créer notre propre fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e64da-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="e64da-239">Tous les fournisseurs de plan de site doivent être dérivés de la [classe`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), qui comprend les méthodes et propriétés essentielles requises pour les fournisseurs de plan de site, mais omet un grand nombre des détails d’implémentation.</span><span class="sxs-lookup"><span data-stu-id="e64da-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="e64da-240">Une deuxième classe, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), étend la classe `SiteMapProvider` et contient une implémentation plus robuste des fonctionnalités nécessaires.</span><span class="sxs-lookup"><span data-stu-id="e64da-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="e64da-241">En interne, le `StaticSiteMapProvider` stocke les instances de `SiteMapNode` du plan de site dans un `Hashtable` et fournit des méthodes telles que `AddNode(child, parent)`, `RemoveNode(siteMapNode),` et `Clear()` qui ajoutent et suppriment des `SiteMapNode` dans le `Hashtable`interne.</span><span class="sxs-lookup"><span data-stu-id="e64da-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="e64da-242">`XmlSiteMapProvider` est dérivé de `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="e64da-243">Lors de la création d’un fournisseur de plan de site personnalisé qui étend `StaticSiteMapProvider`, il existe deux méthodes abstraites qui doivent être remplacées : [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) et [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="e64da-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="e64da-244">`BuildSiteMap`, comme son nom l’indique, est responsable du chargement de la structure de plan de site à partir d’un stockage persistant et de sa construction en mémoire.</span><span class="sxs-lookup"><span data-stu-id="e64da-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="e64da-245">`GetRootNodeCore` retourne le nœud racine dans le plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="e64da-246">Pour qu’une application Web puisse utiliser un fournisseur de plan de site, elle doit être inscrite dans la configuration de l’application.</span><span class="sxs-lookup"><span data-stu-id="e64da-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="e64da-247">Par défaut, la classe `XmlSiteMapProvider` est inscrite à l’aide du nom `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="e64da-248">Pour inscrire des fournisseurs de plan de site supplémentaires, ajoutez le balisage suivant à `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="e64da-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="e64da-249">La valeur *Name* assigne un nom explicite au fournisseur tandis que *type* spécifie le nom de type complet du fournisseur de plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="e64da-250">Nous allons explorer les valeurs concrètes pour le *nom* et les valeurs de *type* à l’étape 7, une fois que nous avons créé notre fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e64da-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="e64da-251">La classe du fournisseur de plan de site est instanciée la première fois qu’elle est accessible à partir de la classe `SiteMap` et reste en mémoire pendant toute la durée de vie de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="e64da-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="e64da-252">Étant donné qu’il n’existe qu’une seule instance du fournisseur de plan de site qui peut être appelée à partir de plusieurs visiteurs de sites Web simultanés, il est impératif que les méthodes du fournisseur soient *thread-safe*.</span><span class="sxs-lookup"><span data-stu-id="e64da-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="e64da-253">Pour des raisons de performances et d’évolutivité, il est important de mettre en cache la structure de plan de site en mémoire et de retourner cette structure mise en cache plutôt que de la recréer chaque fois que la méthode `BuildSiteMap` est appelée.</span><span class="sxs-lookup"><span data-stu-id="e64da-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="e64da-254">`BuildSiteMap` peut être appelé plusieurs fois par demande de page par utilisateur, en fonction des contrôles de navigation en cours d’utilisation sur la page et de la profondeur de la structure de plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="e64da-255">Dans tous les cas, si la structure de plan du site n’est pas mise en cache dans `BuildSiteMap`, chaque fois qu’elle est appelée, nous aurions besoin de récupérer à nouveau les informations sur les produits et les catégories à partir de l’architecture (ce qui entraînerait une requête dans la base de données).</span><span class="sxs-lookup"><span data-stu-id="e64da-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="e64da-256">Comme nous l’avons vu dans les didacticiels de mise en cache précédents, les données mises en cache peuvent devenir obsolètes.</span><span class="sxs-lookup"><span data-stu-id="e64da-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="e64da-257">Pour combattre cela, nous pouvons utiliser des expirations basées sur la dépendance de l’heure ou du cache SQL.</span><span class="sxs-lookup"><span data-stu-id="e64da-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="e64da-258">Un fournisseur de plan de site peut éventuellement substituer la [méthode`Initialize`](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="e64da-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="e64da-259">`Initialize` est appelé lorsque le fournisseur de plan de site est instancié pour la première fois et reçoit tous les attributs personnalisés affectés au fournisseur dans `Web.config` dans l’élément `<add>` comme : `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="e64da-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="e64da-260">Cela est utile si vous souhaitez autoriser un développeur de pages à spécifier différents paramètres liés au fournisseur de plan de site sans avoir à modifier le code du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e64da-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="e64da-261">Par exemple, si nous lisons la catégorie et les données des produits directement à partir de la base de données, par opposition à l’architecture, nous voulons que le développeur de la page spécifie la chaîne de connexion de la base de données via `Web.config` plutôt que d’utiliser une valeur codée en dur dans le code du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e64da-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="e64da-262">Le fournisseur de plan de site personnalisé que nous allons générer à l’étape 6 ne remplace pas cette `Initialize` méthode.</span><span class="sxs-lookup"><span data-stu-id="e64da-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="e64da-263">Pour obtenir un exemple d’utilisation de la méthode `Initialize`, reportez-vous à l’article sur le [stockage des cartes de site de](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e64da-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="e64da-264">Étape 6 : création du fournisseur de plan de site personnalisé</span><span class="sxs-lookup"><span data-stu-id="e64da-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="e64da-265">Pour créer un fournisseur de plan de site personnalisé qui génère le plan de site à partir des catégories et produits de la base de données Northwind, nous devons créer une classe qui étend `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="e64da-266">À l’étape 1, j’ai demandé d’ajouter un dossier `CustomProviders` dans le dossier `App_Code` : ajoutez une nouvelle classe à ce dossier nommé `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="e64da-267">Ajoutez le code suivant à la classe `NorthwindSiteMapProvider` :</span><span class="sxs-lookup"><span data-stu-id="e64da-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="e64da-268">Commençons par explorer cette classe s `BuildSiteMap` méthode, qui commence par une [instruction`lock`](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="e64da-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="e64da-269">L’instruction `lock` autorise un seul thread à la fois à entrer, ce qui permet de sérialiser l’accès à son code et d’empêcher deux threads simultanés de s’exécuter pas à pas sur un autre orteils.</span><span class="sxs-lookup"><span data-stu-id="e64da-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="e64da-270">La variable de `SiteMapNode` au niveau de la classe `root` est utilisée pour mettre en cache la structure du plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="e64da-271">Quand le plan de site est construit pour la première fois, ou pour la première fois après la modification des données sous-jacentes, `root` est `null` et la structure de plan de site est construite.</span><span class="sxs-lookup"><span data-stu-id="e64da-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="e64da-272">Le nœud racine des plans de site est affecté à `root` pendant le processus de construction afin que la prochaine fois que cette méthode est appelée, `root` ne soit pas `null`.</span><span class="sxs-lookup"><span data-stu-id="e64da-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="e64da-273">Par conséquent, tant que `root` n’est pas `null` la structure du plan de site est retournée à l’appelant sans avoir à le recréer.</span><span class="sxs-lookup"><span data-stu-id="e64da-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="e64da-274">Si la racine est `null`, la structure du plan de site est créée à partir des informations sur le produit et la catégorie.</span><span class="sxs-lookup"><span data-stu-id="e64da-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="e64da-275">Le plan de site est construit en créant les instances `SiteMapNode`, puis en formant la hiérarchie par le biais d’appels à la méthode de la classe `StaticSiteMapProvider` s `AddNode`.</span><span class="sxs-lookup"><span data-stu-id="e64da-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="e64da-276">`AddNode` effectue la comptabilité interne, en stockant les instances de `SiteMapNode` assorties dans un `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="e64da-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="e64da-277">Avant de commencer à construire la hiérarchie, nous commençons par appeler la méthode `Clear`, qui efface les éléments du `Hashtable`interne.</span><span class="sxs-lookup"><span data-stu-id="e64da-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="e64da-278">Ensuite, la méthode de la classe `ProductsBLL` s `GetProducts` et les `ProductsDataTable` qui en résultent sont stockées dans des variables locales.</span><span class="sxs-lookup"><span data-stu-id="e64da-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="e64da-279">La construction des plans de site commence par la création du nœud racine et son affectation à `root`.</span><span class="sxs-lookup"><span data-stu-id="e64da-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="e64da-280">La surcharge du [constructeur`SiteMapNode` s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) utilisé ici et dans ce `BuildSiteMap` reçoit les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="e64da-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="e64da-281">Référence au fournisseur de plan de site (`this`).</span><span class="sxs-lookup"><span data-stu-id="e64da-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="e64da-282">`Key``SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="e64da-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="e64da-283">Cette valeur obligatoire doit être unique pour chaque `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="e64da-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="e64da-284">`Url``SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="e64da-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="e64da-285">`Url` est facultatif, mais s’il est fourni, chaque valeur `SiteMapNode` s `Url` doit être unique.</span><span class="sxs-lookup"><span data-stu-id="e64da-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="e64da-286">Le `SiteMapNode` s `Title`, qui est requis.</span><span class="sxs-lookup"><span data-stu-id="e64da-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="e64da-287">L’appel de la méthode `AddNode(root)` ajoute la `root` `SiteMapNode` au plan du site en tant que racine.</span><span class="sxs-lookup"><span data-stu-id="e64da-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="e64da-288">Ensuite, chaque `ProductRow` dans le `ProductsDataTable` est énuméré.</span><span class="sxs-lookup"><span data-stu-id="e64da-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="e64da-289">S’il existe déjà un `SiteMapNode` pour la catégorie du produit actuel, il est référencé.</span><span class="sxs-lookup"><span data-stu-id="e64da-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="e64da-290">Dans le cas contraire, une nouvelle `SiteMapNode` pour la catégorie est créée et ajoutée en tant qu’enfant du `SiteMapNode``root` via l’appel de la méthode `AddNode(categoryNode, root)`.</span><span class="sxs-lookup"><span data-stu-id="e64da-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="e64da-291">Une fois que la catégorie appropriée `SiteMapNode` nœud a été trouvée ou créée, un `SiteMapNode` est créé pour le produit actuel et ajouté en tant qu’enfant de la catégorie `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="e64da-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="e64da-292">Notez que la valeur de la propriété Category `SiteMapNode` s `Url` est `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` alors que la propriété Product `SiteMapNode` s `Url` est affectée `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="e64da-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="e64da-293">Les produits qui ont une valeur de `NULL` de base de données pour leur `CategoryID` sont regroupés sous une catégorie `SiteMapNode` dont la propriété `Title` est définie sur None et dont la propriété `Url` est définie sur une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="e64da-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="e64da-294">J’ai décidé de définir `Url` sur une chaîne vide dans la mesure où la méthode `ProductBLL` classe `GetProductsByCategory(categoryID)` s ne dispose pas actuellement de la capacité de retourner uniquement les produits avec une valeur `CategoryID` `NULL`.</span><span class="sxs-lookup"><span data-stu-id="e64da-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="e64da-295">Je voulais également montrer comment les contrôles de navigation affichent une `SiteMapNode` qui n’a pas de valeur pour sa propriété `Url`.</span><span class="sxs-lookup"><span data-stu-id="e64da-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="e64da-296">Je vous encourage à étendre ce didacticiel pour que la propriété None `SiteMapNode` s `Url` pointe vers `ProductsByCategory.aspx`, mais affiche uniquement les produits avec `NULL` valeurs `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="e64da-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="e64da-297">Après avoir construit le plan de site, un objet arbitraire est ajouté au cache de données à l’aide d’une dépendance de cache SQL sur le `Categories` et `Products` tables via un objet `AggregateCacheDependency`.</span><span class="sxs-lookup"><span data-stu-id="e64da-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="e64da-298">Nous avons exploré l’utilisation des dépendances de cache SQL dans le didacticiel précédent, *à l’aide des dépendances de cache SQL*.</span><span class="sxs-lookup"><span data-stu-id="e64da-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="e64da-299">Toutefois, le fournisseur de plan de site personnalisé utilise une surcharge de la méthode `Insert` du cache de données que nous avons encore explorée.</span><span class="sxs-lookup"><span data-stu-id="e64da-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="e64da-300">Cette surcharge accepte comme paramètre d’entrée final un délégué qui est appelé lorsque l’objet est supprimé du cache.</span><span class="sxs-lookup"><span data-stu-id="e64da-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="e64da-301">Plus précisément, nous passons un nouveau [délégué`CacheItemRemovedCallback`](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) qui pointe vers la méthode `OnSiteMapChanged` définie plus loin dans la classe `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="e64da-302">La représentation en mémoire du plan de site est mise en cache via la variable au niveau de la classe `root`.</span><span class="sxs-lookup"><span data-stu-id="e64da-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="e64da-303">Étant donné qu’il n’existe qu’une seule instance de la classe de fournisseur de plan de site personnalisée et que cette instance est partagée entre tous les threads de l’application Web, cette variable de classe sert de cache.</span><span class="sxs-lookup"><span data-stu-id="e64da-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="e64da-304">La méthode `BuildSiteMap` utilise également le cache de données, mais uniquement en tant que moyen de recevoir une notification lorsque les données de la base de données sous-jacente sont modifiées dans les tables `Categories` ou `Products`.</span><span class="sxs-lookup"><span data-stu-id="e64da-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="e64da-305">Notez que la valeur placée dans le cache de données est uniquement la date et l’heure actuelles.</span><span class="sxs-lookup"><span data-stu-id="e64da-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="e64da-306">Les données de plan de site réelles ne sont *pas* placées dans le cache de données.</span><span class="sxs-lookup"><span data-stu-id="e64da-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="e64da-307">La méthode `BuildSiteMap` se termine en retournant le nœud racine du plan de site.</span><span class="sxs-lookup"><span data-stu-id="e64da-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="e64da-308">Les méthodes restantes sont relativement simples.</span><span class="sxs-lookup"><span data-stu-id="e64da-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="e64da-309">`GetRootNodeCore` est chargé de retourner le nœud racine.</span><span class="sxs-lookup"><span data-stu-id="e64da-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="e64da-310">Étant donné que `BuildSiteMap` retourne la racine, `GetRootNodeCore` retourne simplement la valeur de retour de `BuildSiteMap` s.</span><span class="sxs-lookup"><span data-stu-id="e64da-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="e64da-311">La méthode `OnSiteMapChanged` définit `root` à `null` lorsque l’élément du cache est supprimé.</span><span class="sxs-lookup"><span data-stu-id="e64da-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="e64da-312">Avec la racine définie sur `null`, la prochaine fois que `BuildSiteMap` est appelé, la structure de plan de site sera reconstruite.</span><span class="sxs-lookup"><span data-stu-id="e64da-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="e64da-313">Enfin, la propriété `CachedDate` retourne la valeur de date et d’heure stockée dans le cache de données, si une telle valeur existe.</span><span class="sxs-lookup"><span data-stu-id="e64da-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="e64da-314">Cette propriété peut être utilisée par un développeur de pages pour déterminer à quel moment les données de plan de site ont été mises en cache pour la dernière fois.</span><span class="sxs-lookup"><span data-stu-id="e64da-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="e64da-315">Étape 7 : inscription du`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="e64da-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="e64da-316">Pour que notre application Web utilise le fournisseur de plan de site `NorthwindSiteMapProvider` créé à l’étape 6, vous devez l’inscrire dans la section `<siteMap>` de `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="e64da-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="e64da-317">Plus précisément, ajoutez le balisage suivant dans l’élément `<system.web>` dans `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="e64da-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="e64da-318">Ce balisage effectue deux opérations : tout d’abord, il indique que le `AspNetXmlSiteMapProvider` intégré est le fournisseur de plan de site par défaut ; Deuxièmement, il inscrit le fournisseur de plan de site personnalisé créé à l’étape 6 avec le nom convivial Northwind.</span><span class="sxs-lookup"><span data-stu-id="e64da-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="e64da-319">Pour les fournisseurs de plan de site situés dans le dossier application s `App_Code`, la valeur de l’attribut `type` est simplement le nom de la classe.</span><span class="sxs-lookup"><span data-stu-id="e64da-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="e64da-320">Le fournisseur de plan de site personnalisé peut également avoir été créé dans un projet de bibliothèque de classes distinct avec l’assembly compilé placé dans le répertoire de l’application Web s `/Bin`.</span><span class="sxs-lookup"><span data-stu-id="e64da-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="e64da-321">Dans ce cas, la valeur de l’attribut `type` est l' *espace de noms*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="e64da-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="e64da-322">Après avoir mis à jour `Web.config`, prenez un moment pour afficher les pages des didacticiels dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e64da-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="e64da-323">Notez que l’interface de navigation sur la gauche affiche toujours les sections et les didacticiels définis dans `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="e64da-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="e64da-324">Cela est dû au fait que nous n’avons pas `AspNetXmlSiteMapProvider` comme fournisseur par défaut.</span><span class="sxs-lookup"><span data-stu-id="e64da-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="e64da-325">Pour créer un élément d’interface utilisateur de navigation qui utilise la `NorthwindSiteMapProvider`, nous devrons spécifier explicitement que le fournisseur de plan de site Northwind doit être utilisé.</span><span class="sxs-lookup"><span data-stu-id="e64da-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="e64da-326">Nous allons voir comment procéder à l’étape 8.</span><span class="sxs-lookup"><span data-stu-id="e64da-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="e64da-327">Étape 8 : affichage des informations de plan de site à l’aide du fournisseur de plan de site personnalisé</span><span class="sxs-lookup"><span data-stu-id="e64da-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="e64da-328">Une fois le fournisseur de plan de site personnalisé créé et inscrit dans `Web.config`, nous sommes prêts à ajouter des contrôles de navigation aux pages `Default.aspx`, `ProductsByCategory.aspx`et `ProductDetails.aspx` dans le dossier `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="e64da-329">Commencez par ouvrir la page `Default.aspx` et faites glisser un `SiteMapPath` de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="e64da-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="e64da-330">Le contrôle SiteMapPath se trouve dans la section navigation de la boîte à outils.</span><span class="sxs-lookup"><span data-stu-id="e64da-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="e64da-331">[![ajouter un SiteMapPath à default. aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="e64da-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="e64da-332">**Figure 16**: ajouter un SiteMapPath à `Default.aspx` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="e64da-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>

<span data-ttu-id="e64da-333">Le contrôle SiteMapPath affiche un fil d’Ariane indiquant l’emplacement de la page en cours dans le plan du site.</span><span class="sxs-lookup"><span data-stu-id="e64da-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="e64da-334">Nous avons ajouté un SiteMapPath en haut de la page maître dans le didacticiel *pages maîtres et navigation* dans le site.</span><span class="sxs-lookup"><span data-stu-id="e64da-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="e64da-335">Prenez un moment pour afficher cette page par le biais d’un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e64da-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="e64da-336">Le SiteMapPath ajouté à la figure 16 utilise le fournisseur de plan de site par défaut, en extrayant ses données de `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="e64da-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="e64da-337">Par conséquent, le chemin d’exploration affiche la page d’hébergement &gt; la personnalisation du plan de site, tout comme le fil d’Ariane dans le coin supérieur droit.</span><span class="sxs-lookup"><span data-stu-id="e64da-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="e64da-338">[![le fil d’Ariane utilise le fournisseur de plan de site par défaut](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="e64da-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="e64da-339">**Figure 17**: le fil d’Ariane utilise le fournisseur de plan de site par défaut ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="e64da-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>

<span data-ttu-id="e64da-340">Pour ajouter le SiteMapPath à la figure 16, utilisez le fournisseur de plan de site personnalisé que nous avons créé à l’étape 6, définissez sa [propriété`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) sur Northwind, le nom que nous avons affecté à la `NorthwindSiteMapProvider` dans `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="e64da-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="e64da-341">Malheureusement, le concepteur continue d’utiliser le fournisseur de plan de site par défaut, mais si vous accédez à la page via un navigateur après avoir modifié cette propriété, vous verrez que le fil d’Ariane utilise désormais le fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e64da-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="e64da-342">[![le fil d’Ariane utilise désormais le fournisseur de plan de site personnalisé NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="e64da-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="e64da-343">**Figure 18**: le fil d’Ariane utilise désormais le fournisseur de plan de Site personnalisé `NorthwindSiteMapProvider` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="e64da-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>

<span data-ttu-id="e64da-344">Le contrôle SiteMapPath affiche une interface utilisateur plus fonctionnelle dans les pages `ProductsByCategory.aspx` et `ProductDetails.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e64da-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="e64da-345">Ajoutez un SiteMapPath à ces pages, en affectant la valeur Northwind à la propriété `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="e64da-346">Dans `Default.aspx` cliquez sur le lien Afficher les produits pour les boissons, puis sur le lien Afficher les détails pour le thé chai.</span><span class="sxs-lookup"><span data-stu-id="e64da-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="e64da-347">Comme le montre la figure 19, le fil d’Ariane comprend la section du plan de site actuel (Chai thé) et ses ancêtres : boissons et toutes les catégories.</span><span class="sxs-lookup"><span data-stu-id="e64da-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="e64da-348">[![le fil d’Ariane utilise désormais le fournisseur de plan de site personnalisé NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="e64da-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="e64da-349">**Figure 19**: le fil d’Ariane utilise désormais le fournisseur de plan de Site personnalisé `NorthwindSiteMapProvider` ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="e64da-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>

<span data-ttu-id="e64da-350">D’autres éléments de l’interface utilisateur de navigation peuvent être utilisés en plus de l’élément SiteMapPath, tel que les contrôles menu et TreeView.</span><span class="sxs-lookup"><span data-stu-id="e64da-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="e64da-351">Les pages `Default.aspx`, `ProductsByCategory.aspx`et `ProductDetails.aspx` du téléchargement de ce didacticiel, par exemple, incluent toutes les commandes de menu (voir figure 20).</span><span class="sxs-lookup"><span data-stu-id="e64da-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="e64da-352">Pour plus d’informations sur les contrôles de navigation et le système de plan de site dans ASP.NET 2,0, consultez [examiner les fonctionnalités de navigation de site ASP.NET 2,0 s](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) et la section [utilisation des contrôles de navigation de site](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) des [Démarrages rapides ASP.NET 2,0](https://quickstarts.asp.net/QuickStartv20/aspnet/) .</span><span class="sxs-lookup"><span data-stu-id="e64da-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="e64da-353">[![le contrôle Menu répertorie chaque catégorie et chaque produit](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="e64da-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="e64da-354">**Figure 20**: le contrôle de menu répertorie chaque catégorie et chaque produit ([cliquez pour afficher l’image en taille réelle](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="e64da-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>

<span data-ttu-id="e64da-355">Comme mentionné plus haut dans ce didacticiel, la structure de plan de site est accessible par programme par le biais de la classe `SiteMap`.</span><span class="sxs-lookup"><span data-stu-id="e64da-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="e64da-356">Le code suivant retourne le `SiteMapNode` racine du fournisseur par défaut :</span><span class="sxs-lookup"><span data-stu-id="e64da-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="e64da-357">Étant donné que le `AspNetXmlSiteMapProvider` est le fournisseur par défaut pour notre application, le code ci-dessus retourne le nœud racine défini dans `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="e64da-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="e64da-358">Pour faire référence à un fournisseur de plan de site autre que celui par défaut, utilisez la propriété `SiteMap` classe s [`Providers`](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) comme suit :</span><span class="sxs-lookup"><span data-stu-id="e64da-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="e64da-359">Où *nom* est le nom du fournisseur de plan de site personnalisé (Northwind, pour notre application Web).</span><span class="sxs-lookup"><span data-stu-id="e64da-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="e64da-360">Pour accéder à un membre spécifique à un fournisseur de plan de site, utilisez `SiteMap.Providers["name"]` pour récupérer l’instance du fournisseur, puis effectuez un cast de celui-ci vers le type approprié.</span><span class="sxs-lookup"><span data-stu-id="e64da-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="e64da-361">Par exemple, pour afficher la propriété `NorthwindSiteMapProvider` s `CachedDate` dans une page ASP.NET, utilisez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e64da-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="e64da-362">Veillez à tester la fonctionnalité de dépendance de cache SQL.</span><span class="sxs-lookup"><span data-stu-id="e64da-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="e64da-363">Après avoir consulté les pages `Default.aspx`, `ProductsByCategory.aspx`et `ProductDetails.aspx`, accédez à l’un des didacticiels de la section modification, insertion et suppression, puis modifiez le nom d’une catégorie ou d’un produit.</span><span class="sxs-lookup"><span data-stu-id="e64da-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="e64da-364">Revenez ensuite à l’une des pages du dossier `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="e64da-365">En supposant que suffisamment de temps s’est écoulé pour que le mécanisme d’interrogation note la modification apportée à la base de données sous-jacente, le plan de site doit être mis à jour pour afficher le nouveau nom de produit ou de catégorie.</span><span class="sxs-lookup"><span data-stu-id="e64da-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="e64da-366">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="e64da-366">Summary</span></span>

<span data-ttu-id="e64da-367">Les fonctionnalités de plan du site ASP.NET 2,0 s incluent une classe `SiteMap`, un certain nombre de contrôles Web de navigation intégrés et un fournisseur de plan de site par défaut qui attend que les informations de plan de site soient rendues persistantes dans un fichier XML.</span><span class="sxs-lookup"><span data-stu-id="e64da-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="e64da-368">Pour utiliser les informations de plan de site d’une autre source telle que celle d’une base de données, de l’architecture de l’application ou d’un service Web distant, nous devons créer un fournisseur de plan de site personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e64da-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="e64da-369">Cela implique la création d’une classe qui dérive, directement ou indirectement, de la classe `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="e64da-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="e64da-370">Dans ce didacticiel, nous avons vu comment créer un fournisseur de plan de site personnalisé basé sur le plan de site sur le produit et les informations de catégorie tirées de l’architecture de l’application.</span><span class="sxs-lookup"><span data-stu-id="e64da-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="e64da-371">Notre fournisseur a étendu la classe `StaticSiteMapProvider` et a entraîné la création d’une méthode `BuildSiteMap` qui a récupéré les données, construit la hiérarchie du plan du site et mis en cache la structure résultante dans une variable au niveau de la classe.</span><span class="sxs-lookup"><span data-stu-id="e64da-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="e64da-372">Nous avons utilisé une dépendance de cache SQL avec une fonction de rappel pour invalider la structure mise en cache lors de la modification des données `Categories` ou `Products` sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="e64da-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="e64da-373">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="e64da-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="e64da-374">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="e64da-374">Further Reading</span></span>

<span data-ttu-id="e64da-375">Pour plus d’informations sur les sujets abordés dans ce didacticiel, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="e64da-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="e64da-376">[Stockage des plans de site dans SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) et [le fournisseur de plan de site SQL que vous avez attendu](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="e64da-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="e64da-377">Présentation du modèle de fournisseur ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="e64da-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="e64da-378">Boîte à outils du fournisseur</span><span class="sxs-lookup"><span data-stu-id="e64da-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="e64da-379">Examen des fonctionnalités de navigation de site ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="e64da-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="e64da-380">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="e64da-380">About the Author</span></span>

<span data-ttu-id="e64da-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="e64da-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e64da-382">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="e64da-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e64da-383">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="e64da-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e64da-384">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e64da-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e64da-385">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="e64da-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e64da-386">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="e64da-386">Special Thanks To</span></span>

<span data-ttu-id="e64da-387">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="e64da-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e64da-388">Les réviseurs de leads pour ce didacticiel étaient Dave Gardner, Zack Jones, Teresa Murphy et Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="e64da-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="e64da-389">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="e64da-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e64da-390">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e64da-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="e64da-391">Next</span><span class="sxs-lookup"><span data-stu-id="e64da-391">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
