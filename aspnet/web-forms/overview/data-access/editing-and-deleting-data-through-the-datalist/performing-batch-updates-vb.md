---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
title: Exécution des mises à jour par lots (VB) | Microsoft Docs
author: rick-anderson
description: Apprenez à créer un contrôle DataList entièrement modifiable dans lequel tous ses éléments sont en mode édition et dont les valeurs peuvent être enregistrées en cliquant sur le bouton « mettre à jour tout » dans le...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 8dac22a7-91de-4e3b-888f-a4c438b03851
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb
msc.type: authoredcontent
ms.openlocfilehash: e54c9fc12da278492b54164cf657eea142a3dae6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74632603"
---
# <a name="performing-batch-updates-vb"></a><span data-ttu-id="7dd74-103">Réalisation de mises à jour par lots (VB)</span><span class="sxs-lookup"><span data-stu-id="7dd74-103">Performing Batch Updates (VB)</span></span>

<span data-ttu-id="7dd74-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7dd74-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7dd74-105">[Télécharger l’exemple d’application](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) ou [Télécharger le PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7dd74-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_VB.exe) or [Download PDF](performing-batch-updates-vb/_static/datatutorial37vb1.pdf)</span></span>

> <span data-ttu-id="7dd74-106">Apprenez à créer un contrôle DataList entièrement modifiable dans lequel tous ses éléments sont en mode édition et dont les valeurs peuvent être enregistrées en cliquant sur un bouton « mettre à jour tout » sur la page.</span><span class="sxs-lookup"><span data-stu-id="7dd74-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="7dd74-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="7dd74-107">Introduction</span></span>

<span data-ttu-id="7dd74-108">Dans le [didacticiel précédent](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) , nous avons examiné comment créer un contrôle DataList au niveau élément.</span><span class="sxs-lookup"><span data-stu-id="7dd74-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="7dd74-109">À l’instar du contrôle GridView modifiable standard, chaque élément du contrôle DataList comprenait un bouton modifier qui, lorsque vous cliquez dessus, rend l’élément modifiable.</span><span class="sxs-lookup"><span data-stu-id="7dd74-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="7dd74-110">Bien que cette modification au niveau de l’élément fonctionne bien pour les données qui sont uniquement mises à jour occasionnellement, certains scénarios de cas d’usage requièrent que l’utilisateur modifie de nombreux enregistrements.</span><span class="sxs-lookup"><span data-stu-id="7dd74-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="7dd74-111">Si un utilisateur doit modifier des dizaines d’enregistrements et s’il est forcé de cliquer sur modifier, apporter les modifications nécessaires, puis cliquer sur mettre à jour pour chacun d’entre eux, la quantité de clics peut en nuire à la productivité.</span><span class="sxs-lookup"><span data-stu-id="7dd74-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="7dd74-112">Dans ce cas, une meilleure option consiste à fournir un contrôle DataList entièrement modifiable, où *tous* ses éléments sont en mode édition et dont les valeurs peuvent être modifiées en cliquant sur un bouton mettre à jour tout sur la page (voir figure 1).</span><span class="sxs-lookup"><span data-stu-id="7dd74-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="7dd74-113">[![chaque élément d’un contrôle DataList entièrement modifiable peut être modifié](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-vb/_static/image2.png)](performing-batch-updates-vb/_static/image1.png)</span></span>

<span data-ttu-id="7dd74-114">**Figure 1**: chaque élément d’un contrôle DataList entièrement modifiable peut être modifié ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-vb/_static/image3.png))</span></span>

<span data-ttu-id="7dd74-115">Dans ce didacticiel, nous allons examiner comment permettre aux utilisateurs de mettre à jour les informations d’adresse des fournisseurs à l’aide d’un contrôle DataList entièrement modifiable.</span><span class="sxs-lookup"><span data-stu-id="7dd74-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="7dd74-116">Étape 1 : créer l’interface utilisateur modifiable dans le ItemTemplate de DataList</span><span class="sxs-lookup"><span data-stu-id="7dd74-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="7dd74-117">Dans le didacticiel précédent, où nous créons une DataList modifiable standard au niveau élément, nous avons utilisé deux modèles :</span><span class="sxs-lookup"><span data-stu-id="7dd74-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="7dd74-118">`ItemTemplate` contenait l’interface utilisateur en lecture seule (les contrôles Web d’étiquette permettant d’afficher chaque nom et prix du produit).</span><span class="sxs-lookup"><span data-stu-id="7dd74-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="7dd74-119">`EditItemTemplate` contenait l’interface utilisateur du mode édition (les deux contrôles Web TextBox).</span><span class="sxs-lookup"><span data-stu-id="7dd74-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="7dd74-120">La propriété de `EditItemIndex` DataList détermine ce que `DataListItem` (le cas échéant) est restitué à l’aide du `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="7dd74-121">En particulier, le `DataListItem` dont la valeur `ItemIndex` correspond à la propriété DataList s `EditItemIndex` est rendue à l’aide de la `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="7dd74-122">Ce modèle fonctionne bien lorsque vous ne pouvez modifier qu’un seul élément à la fois, mais en cas de création d’un contrôle DataList entièrement modifiable.</span><span class="sxs-lookup"><span data-stu-id="7dd74-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="7dd74-123">Pour un contrôle DataList entièrement modifiable, nous voulons que *tous* les `DataListItem` s s’affichent à l’aide de l’interface modifiable.</span><span class="sxs-lookup"><span data-stu-id="7dd74-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="7dd74-124">La façon la plus simple d’y parvenir consiste à définir l’interface modifiable dans le `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="7dd74-125">Pour modifier les informations d’adresse des fournisseurs, l’interface modifiable contient le nom du fournisseur sous forme de texte, puis les zones de texte pour les valeurs adresse, ville et pays.</span><span class="sxs-lookup"><span data-stu-id="7dd74-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="7dd74-126">Commencez par ouvrir la page `BatchUpdate.aspx`, ajoutez un contrôle DataList et affectez à sa propriété `ID` la valeur `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="7dd74-127">À partir de la balise active de DataList s, choisissez d’ajouter un nouveau contrôle ObjectDataSource nommé `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="7dd74-128">[![créer un ObjectDataSource nommé SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-vb/_static/image5.png)](performing-batch-updates-vb/_static/image4.png)</span></span>

<span data-ttu-id="7dd74-129">**Figure 2**: créer un ObjectDataSource nommé `SuppliersDataSource` ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-vb/_static/image6.png))</span></span>

<span data-ttu-id="7dd74-130">Configurez l’ObjectDataSource pour récupérer des données à l’aide de la méthode de `GetSuppliers()` `SuppliersBLL` classe s (voir figure 3).</span><span class="sxs-lookup"><span data-stu-id="7dd74-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="7dd74-131">Comme dans le didacticiel précédent, au lieu de mettre à jour les informations sur les fournisseurs via ObjectDataSource, nous allons travailler directement avec la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="7dd74-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="7dd74-132">Par conséquent, définissez la liste déroulante sur (aucune) sous l’onglet mise à jour (voir figure 4).</span><span class="sxs-lookup"><span data-stu-id="7dd74-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="7dd74-133">[![récupérer les informations de fournisseur à l’aide de la méthode GetSuppliers ()](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-vb/_static/image8.png)](performing-batch-updates-vb/_static/image7.png)</span></span>

<span data-ttu-id="7dd74-134">**Figure 3**: récupérer les informations de fournisseur à l’aide de la méthode `GetSuppliers()` ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-vb/_static/image9.png))</span></span>

<span data-ttu-id="7dd74-135">[![définir la liste déroulante sur (aucun) dans l’onglet mettre à jour](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-vb/_static/image11.png)](performing-batch-updates-vb/_static/image10.png)</span></span>

<span data-ttu-id="7dd74-136">**Figure 4**: définir la liste déroulante sur (aucune) sous l’onglet mise à jour ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-vb/_static/image12.png))</span></span>

<span data-ttu-id="7dd74-137">Une fois l’Assistant terminé, Visual Studio génère automatiquement les `ItemTemplate` DataList pour afficher chaque champ de données retourné par la source de données dans un contrôle Web étiquette.</span><span class="sxs-lookup"><span data-stu-id="7dd74-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="7dd74-138">Nous devons modifier ce modèle pour qu’il fournisse plutôt l’interface d’édition.</span><span class="sxs-lookup"><span data-stu-id="7dd74-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="7dd74-139">La `ItemTemplate` peut être personnalisée par le biais du concepteur à l’aide de l’option modifier les modèles de la balise active de DataList s ou directement par le biais de la syntaxe déclarative.</span><span class="sxs-lookup"><span data-stu-id="7dd74-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="7dd74-140">Prenez un moment pour créer une interface de modification qui affiche le nom du fournisseur sous forme de texte, mais il comprend des zones de texte pour les valeurs adresse du fournisseur, ville et pays.</span><span class="sxs-lookup"><span data-stu-id="7dd74-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="7dd74-141">Après avoir apporté ces modifications, la syntaxe déclarative de votre page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="7dd74-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="7dd74-142">Comme pour le didacticiel précédent, l’état d’affichage de la DataList dans ce didacticiel doit être activé.</span><span class="sxs-lookup"><span data-stu-id="7dd74-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="7dd74-143">Dans le `ItemTemplate` j’utilise deux nouvelles classes CSS, `SupplierPropertyLabel` et `SupplierPropertyValue`, qui ont été ajoutées à la classe `Styles.css` et configurées pour utiliser les mêmes paramètres de style que les classes CSS `ProductPropertyLabel` et `ProductPropertyValue`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-vb/samples/sample2.css)]

<span data-ttu-id="7dd74-144">Après avoir apporté ces modifications, visitez cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="7dd74-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="7dd74-145">Comme le montre la figure 5, chaque élément DataList affiche le nom du fournisseur sous forme de texte et utilise les zones de texte pour afficher l’adresse, la ville et le pays.</span><span class="sxs-lookup"><span data-stu-id="7dd74-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="7dd74-146">[![chaque fournisseur du contrôle DataList est modifiable](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-vb/_static/image14.png)](performing-batch-updates-vb/_static/image13.png)</span></span>

<span data-ttu-id="7dd74-147">**Figure 5**: chaque fournisseur du contrôle DataList est modifiable ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-vb/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="7dd74-148">Étape 2 : ajout d’un bouton mettre à jour tout</span><span class="sxs-lookup"><span data-stu-id="7dd74-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="7dd74-149">Alors que les champs adresse, ville et pays de chaque fournisseur de la figure 5 sont affichés dans une zone de texte, aucun bouton de mise à jour n’est actuellement disponible.</span><span class="sxs-lookup"><span data-stu-id="7dd74-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="7dd74-150">Au lieu d’avoir un bouton de mise à jour par élément, avec des DataLists entièrement modifiables, il existe généralement un bouton de mise à jour unique sur la page qui, lorsque vous cliquez dessus, met à jour *tous* les enregistrements dans le contrôle DataList.</span><span class="sxs-lookup"><span data-stu-id="7dd74-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="7dd74-151">Pour ce didacticiel, nous allons ajouter deux boutons mettre à jour tous les boutons-l’un en haut de la page et l’autre en bas (bien que le fait de cliquer sur l’un des deux boutons aura le même effet).</span><span class="sxs-lookup"><span data-stu-id="7dd74-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="7dd74-152">Commencez par ajouter un contrôle Web Button au-dessus de DataList et affectez à sa propriété `ID` la valeur `UpdateAll1`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="7dd74-153">Ensuite, ajoutez le deuxième contrôle Web sous le contrôle DataList, en affectant à son `ID` la valeur `UpdateAll2`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="7dd74-154">Définissez les propriétés de `Text` des deux boutons pour mettre à jour tout.</span><span class="sxs-lookup"><span data-stu-id="7dd74-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="7dd74-155">Enfin, créez des gestionnaires d’événements pour les deux boutons `Click` événements.</span><span class="sxs-lookup"><span data-stu-id="7dd74-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="7dd74-156">Au lieu de dupliquer la logique de mise à jour dans chacun des gestionnaires d’événements, vous pouvez Refactoriser cette logique vers une troisième méthode, `UpdateAllSupplierAddresses`, en faisant en sorte que les gestionnaires d’événements appellent simplement cette troisième méthode.</span><span class="sxs-lookup"><span data-stu-id="7dd74-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample3.vb)]

<span data-ttu-id="7dd74-157">La figure 6 affiche la page une fois que les boutons mettre à jour tous ont été ajoutés.</span><span class="sxs-lookup"><span data-stu-id="7dd74-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="7dd74-158">[![deux boutons mettre à jour tous les boutons ont été ajoutés à la page](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7dd74-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-vb/_static/image17.png)](performing-batch-updates-vb/_static/image16.png)</span></span>

<span data-ttu-id="7dd74-159">**Figure 6**: deux boutons mettre à jour tous les boutons ont été ajoutés à la page ([cliquez pour afficher l’image en taille réelle](performing-batch-updates-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7dd74-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-vb/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="7dd74-160">Étape 3 : mise à jour de toutes les informations d’adresse des fournisseurs</span><span class="sxs-lookup"><span data-stu-id="7dd74-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="7dd74-161">Avec tous les éléments de DataList qui affichent l’interface d’édition et avec l’ajout des boutons mettre à jour tout, il est tout à fait l’écriture du code pour effectuer la mise à jour par lot.</span><span class="sxs-lookup"><span data-stu-id="7dd74-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="7dd74-162">Plus précisément, nous devons effectuer une boucle sur les éléments de DataList et appeler la méthode de `SuppliersBLL` classe s `UpdateSupplierAddress` pour chacun d’entre eux.</span><span class="sxs-lookup"><span data-stu-id="7dd74-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="7dd74-163">Vous pouvez accéder à la collection d’instances `DataListItem` qui configurent la DataList via la propriété DataList s [`Items`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span><span class="sxs-lookup"><span data-stu-id="7dd74-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="7dd74-164">Avec une référence à un `DataListItem`, nous pouvons récupérer les `SupplierID` correspondants de la collection `DataKeys` et référencer par programmation les contrôles Web TextBox dans le `ItemTemplate` comme l’illustre le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7dd74-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample4.vb)]

<span data-ttu-id="7dd74-165">Quand l’utilisateur clique sur l’un des boutons mettre à jour tout, la méthode `UpdateAllSupplierAddresses` itère au sein de chaque `DataListItem` de la `Suppliers` DataList et appelle la méthode `SuppliersBLL` classe s `UpdateSupplierAddress`, en passant les valeurs correspondantes.</span><span class="sxs-lookup"><span data-stu-id="7dd74-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="7dd74-166">Une valeur non entrée pour l’adresse, la ville ou le pays passe est une valeur de `Nothing` à `UpdateSupplierAddress` (au lieu d’une chaîne vide), ce qui aboutit à une `NULL` de base de données pour les champs de l’enregistrement sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="7dd74-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="7dd74-167">En guise d’amélioration, vous souhaiterez peut-être ajouter un contrôle Web étiquette d’État à la page qui fournit un message de confirmation après l’exécution de la mise à jour par lot.</span><span class="sxs-lookup"><span data-stu-id="7dd74-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="7dd74-168">Mise à jour uniquement des adresses qui ont été modifiées</span><span class="sxs-lookup"><span data-stu-id="7dd74-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="7dd74-169">L’algorithme de mise à jour par lot utilisé pour ce didacticiel appelle la méthode `UpdateSupplierAddress` pour *chaque* fournisseur du contrôle DataList, que leurs informations d’adresse aient été modifiées ou non.</span><span class="sxs-lookup"><span data-stu-id="7dd74-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="7dd74-170">Bien que ces mises à jour aveugles ne soient généralement pas un problème de performance, elles peuvent entraîner des enregistrements superflus si vous renouvelez l’audit des modifications apportées à la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="7dd74-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="7dd74-171">Par exemple, si vous utilisez des déclencheurs pour enregistrer tous les `UPDATE` s dans la table `Suppliers` dans une table d’audit, chaque fois qu’un utilisateur clique sur le bouton mettre à jour tout, un nouvel enregistrement d’audit est créé pour chaque fournisseur du système, que l’utilisateur ait apporté des modifications ou non.</span><span class="sxs-lookup"><span data-stu-id="7dd74-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="7dd74-172">Les classes DataTable et DataAdapter de ADO.NET sont conçues pour prendre en charge les mises à jour par lot lorsque seuls les enregistrements modifiés, supprimés et nouveaux entraînent la communication entre les bases de données.</span><span class="sxs-lookup"><span data-stu-id="7dd74-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="7dd74-173">Chaque ligne du DataTable a une [propriété`RowState`](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) qui indique si la ligne a été ajoutée au DataTable, si elle a été supprimée, modifiée ou reste inchangée.</span><span class="sxs-lookup"><span data-stu-id="7dd74-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="7dd74-174">Quand un DataTable est initialement rempli, toutes les lignes sont marquées comme inchangées.</span><span class="sxs-lookup"><span data-stu-id="7dd74-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="7dd74-175">La modification de la valeur de l’une des colonnes de la ligne s marque la ligne comme modifiée.</span><span class="sxs-lookup"><span data-stu-id="7dd74-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="7dd74-176">Dans la classe `SuppliersBLL`, nous mettons à jour les informations d’adresse du fournisseur spécifié en lisant d’abord dans l’enregistrement de fournisseur unique dans un `SuppliersDataTable` puis en définissant les valeurs de colonne `Address`, `City`et `Country` à l’aide du code suivant :</span><span class="sxs-lookup"><span data-stu-id="7dd74-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample5.vb)]

<span data-ttu-id="7dd74-177">Ce code naïvement affecte les valeurs de l’adresse, de la ville et du pays passés au `SuppliersRow` dans le `SuppliersDataTable` que les valeurs aient ou non été modifiées.</span><span class="sxs-lookup"><span data-stu-id="7dd74-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="7dd74-178">Ces modifications entraînent le marquage de la propriété `SuppliersRow` s `RowState` comme modifiée.</span><span class="sxs-lookup"><span data-stu-id="7dd74-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="7dd74-179">Lorsque la méthode `Update` de la couche d’accès aux données est appelée, elle constate que le `SupplierRow` a été modifié et envoie donc une commande `UPDATE` à la base de données.</span><span class="sxs-lookup"><span data-stu-id="7dd74-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="7dd74-180">Imaginez, toutefois, que nous avons ajouté du code à cette méthode pour affecter uniquement les valeurs d’adresse, de ville et de pays transmises, si elles diffèrent des valeurs existantes de `SuppliersRow`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="7dd74-181">Dans le cas où l’adresse, la ville et le pays sont les mêmes que les données existantes, aucune modification ne sera apportée et le `SupplierRow` s `RowState` sera marqué comme inchangé.</span><span class="sxs-lookup"><span data-stu-id="7dd74-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="7dd74-182">Le résultat net est que lorsque la méthode `Update` DAL est appelée, aucun appel à la base de données n’est effectué car le `SuppliersRow` n’a pas été modifié.</span><span class="sxs-lookup"><span data-stu-id="7dd74-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="7dd74-183">Pour mettre en œuvre cette modification, remplacez les instructions qui attribuent les valeurs de l’adresse, de la ville et du pays transmises à l’aide du code suivant :</span><span class="sxs-lookup"><span data-stu-id="7dd74-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-vb[Main](performing-batch-updates-vb/samples/sample6.vb)]

<span data-ttu-id="7dd74-184">Avec ce code ajouté, la méthode DAL s `Update` envoie une instruction `UPDATE` à la base de données uniquement pour les enregistrements dont les valeurs relatives à l’adresse ont été modifiées.</span><span class="sxs-lookup"><span data-stu-id="7dd74-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="7dd74-185">En guise d’alternative, nous pourrions savoir s’il existe des différences entre les champs d’adresse transmis et les données de la base de données et, s’il n’y en a pas, contourner simplement l’appel à la méthode `Update` DAL.</span><span class="sxs-lookup"><span data-stu-id="7dd74-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="7dd74-186">Cette approche fonctionne bien si vous utilisez la méthode de base de données directe, car la méthode de base de données directe n’a pas passé une instance de `SuppliersRow` dont les `RowState` peuvent être vérifiées pour déterminer si un appel de base de données est réellement nécessaire.</span><span class="sxs-lookup"><span data-stu-id="7dd74-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="7dd74-187">Chaque fois que la méthode `UpdateSupplierAddress` est appelée, un appel est fait à la base de données pour récupérer des informations sur l’enregistrement mis à jour.</span><span class="sxs-lookup"><span data-stu-id="7dd74-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="7dd74-188">Ensuite, si des modifications sont apportées aux données, un autre appel à la base de données est effectué pour mettre à jour la ligne de la table.</span><span class="sxs-lookup"><span data-stu-id="7dd74-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="7dd74-189">Ce flux de travail peut être optimisé en créant une surcharge de méthode `UpdateSupplierAddress` qui accepte une instance `EmployeesDataTable` qui a *toutes* les modifications de la page `BatchUpdate.aspx`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="7dd74-190">Ensuite, il peut effectuer un appel à la base de données pour récupérer tous les enregistrements de la table `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="7dd74-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="7dd74-191">Les deux jeux de résultats peuvent ensuite être énumérés et seuls les enregistrements pour lesquels des modifications ont été apportées peuvent être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="7dd74-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="7dd74-192">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="7dd74-192">Summary</span></span>

<span data-ttu-id="7dd74-193">Dans ce didacticiel, nous avons vu comment créer un contrôle DataList entièrement modifiable, ce qui permet à un utilisateur de modifier rapidement les informations d’adresse de plusieurs fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="7dd74-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="7dd74-194">Nous avons commencé par définir l’interface de modification dans un contrôle Web TextBox pour les valeurs adresse, ville et pays du fournisseur dans le `ItemTemplate`DataList.</span><span class="sxs-lookup"><span data-stu-id="7dd74-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="7dd74-195">Ensuite, nous avons ajouté la mise à jour de tous les boutons au-dessus et en dessous du contrôle DataList.</span><span class="sxs-lookup"><span data-stu-id="7dd74-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="7dd74-196">Une fois que l’utilisateur a apporté ses modifications et cliqué sur l’un des boutons mettre à jour tout, les `DataListItem` s sont énumérés et un appel à la méthode `SuppliersBLL` classe s `UpdateSupplierAddress` est effectué.</span><span class="sxs-lookup"><span data-stu-id="7dd74-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="7dd74-197">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="7dd74-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7dd74-198">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="7dd74-198">About the Author</span></span>

<span data-ttu-id="7dd74-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="7dd74-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7dd74-200">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="7dd74-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7dd74-201">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="7dd74-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7dd74-202">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7dd74-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7dd74-203">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="7dd74-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7dd74-204">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="7dd74-204">Special Thanks To</span></span>

<span data-ttu-id="7dd74-205">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="7dd74-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7dd74-206">Les réviseurs de leads pour ce didacticiel étaient Zack Jones et Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="7dd74-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="7dd74-207">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="7dd74-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7dd74-208">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7dd74-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7dd74-209">[Précédent](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
> [Suivant](handling-bll-and-dal-level-exceptions-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7dd74-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)
[Next](handling-bll-and-dal-level-exceptions-vb.md)</span></span>
