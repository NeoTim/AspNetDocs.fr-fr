---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Gestion des Exceptions de niveau BLL et DAL (c#) | Microsoft Docs
author: rick-anderson
description: Dans ce didacticiel, nous allons voir comment gérer les exceptions levées au cours de flux de travail mis à jour d’une DataList modifiable tact.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 43a43c95e049acab734fa7d9fdcf2b96f12e78d9
ms.sourcegitcommit: 62db31596a7da029263cf06335aff12236fb3186
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/26/2019
ms.locfileid: "58440272"
---
<a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="b81df-103">Gestion des exceptions de niveau BLL et DAL (C#)</span><span class="sxs-lookup"><span data-stu-id="b81df-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>
====================
<span data-ttu-id="b81df-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b81df-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b81df-105">[Télécharger l’exemple d’application](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) ou [télécharger le PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b81df-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="b81df-106">Dans ce didacticiel, nous allons voir comment gérer les exceptions levées au cours de flux de travail mis à jour d’une DataList modifiable tact.</span><span class="sxs-lookup"><span data-stu-id="b81df-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="b81df-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="b81df-107">Introduction</span></span>

<span data-ttu-id="b81df-108">Dans le [vue d’ensemble de la modification et suppression des données dans le contrôle DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) didacticiel, nous avons créé un contrôle DataList qui proposés simple de modification et de suppression de fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="b81df-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="b81df-109">Bien qu’entièrement fonctionnel, il était tout à fait convivial, comme une erreur s’est produite pendant la modification ou suppression des processus a généré une exception non gérée.</span><span class="sxs-lookup"><span data-stu-id="b81df-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="b81df-110">Par exemple, en omettant le nom du produit s ou lorsque vous modifiez un produit, entrez une valeur du prix de très abordable !, lève une exception.</span><span class="sxs-lookup"><span data-stu-id="b81df-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="b81df-111">Étant donné que cette exception n’est pas interceptée dans le code, il se propage au runtime d’ASP.NET, qui affiche ensuite les détails d’exception s dans la page web.</span><span class="sxs-lookup"><span data-stu-id="b81df-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="b81df-112">Comme nous l’avons vu dans la [BLL - gestion et les Exceptions au niveau de la couche DAL dans une Page ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) didacticiel, si une exception est levée à partir de la profondeur de la logique métier ou les couches d’accès aux données, les détails d’exception sont retournés à ObjectDataSource et puis au GridView.</span><span class="sxs-lookup"><span data-stu-id="b81df-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="b81df-113">Nous avons vu comment gérer correctement ces exceptions en créant `Updated` ou `RowUpdated` gestionnaires d’événements pour l’ObjectDataSource ou GridView, la vérification pour une exception et puis indiquant que l’exception a été gérée.</span><span class="sxs-lookup"><span data-stu-id="b81df-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="b81df-114">Nos didacticiels DataList, toutefois, ne sont pas à l’aide de l’ObjectDataSource pour la mise à jour et suppression de données.</span><span class="sxs-lookup"><span data-stu-id="b81df-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="b81df-115">Au lieu de cela, nous travaillons directement par rapport à la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="b81df-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="b81df-116">Afin de détecter les exceptions provenant de la couche BLL ou DAL, nous devons implémenter le code dans le code-behind de notre page ASP.NET de gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="b81df-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="b81df-117">Dans ce didacticiel, nous allons voir comment gérer les exceptions levées au cours d’un s DataList modifiable, la mise à jour de flux de travail plus tact.</span><span class="sxs-lookup"><span data-stu-id="b81df-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="b81df-118">Dans le *une vue d’ensemble de modification et suppression des données dans le contrôle DataList* didacticiel nous avons abordé les différentes techniques pour la modification et suppression de données dans le contrôle DataList, certaines techniques impliquées à l’aide d’ObjectDataSource pour la mise à jour et la suppression.</span><span class="sxs-lookup"><span data-stu-id="b81df-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="b81df-119">Si vous employez ces techniques, vous pouvez gérer les exceptions à partir de la couche BLL ou DAL via le s ObjectDataSource `Updated` ou `Deleted` gestionnaires d’événements.</span><span class="sxs-lookup"><span data-stu-id="b81df-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="b81df-120">Étape 1 : Création d’un contrôle DataList modifiable</span><span class="sxs-lookup"><span data-stu-id="b81df-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="b81df-121">Avant de nous soucier de la gestion des exceptions qui se produisent pendant le flux de travail de mise à jour, permettent de s tout d’abord créer un contrôle DataList modifiable.</span><span class="sxs-lookup"><span data-stu-id="b81df-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="b81df-122">Ouvrir le `ErrorHandling.aspx` page dans le `EditDeleteDataList` ajouter un contrôle DataList vers le concepteur, un ensemble de dossier, son `ID` propriété `Products`, et ajoutez un nouveau ObjectDataSource nommé `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b81df-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="b81df-123">Configurer l’ObjectDataSource à utiliser le `ProductsBLL` classe s `GetProducts()` méthode de sélection des enregistrements, de définir les listes déroulantes dans l’instruction INSERT, UPDATE et de supprimer des onglets à (None).</span><span class="sxs-lookup"><span data-stu-id="b81df-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="b81df-124">[![Retourner les informations de produit à l’aide de la méthode GetProducts()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b81df-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="b81df-125">**Figure 1**: Retourner les informations de produit en utilisant le `GetProducts()` (méthode) ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b81df-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>


<span data-ttu-id="b81df-126">À l’issue de l’Assistant ObjectDataSource, Visual Studio crée automatiquement un `ItemTemplate` pour le contrôle DataList.</span><span class="sxs-lookup"><span data-stu-id="b81df-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="b81df-127">Remplacez ceci avec un `ItemTemplate` qui affiche chaque nom de produit s et le prix et inclut un bouton Modifier.</span><span class="sxs-lookup"><span data-stu-id="b81df-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="b81df-128">Ensuite, créez un `EditItemTemplate` avec un contrôle TextBox Web pour le nom et les prix et les boutons mise à jour et Annuler.</span><span class="sxs-lookup"><span data-stu-id="b81df-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="b81df-129">Enfin, définissez le contrôle DataList s `RepeatColumns` propriété à 2.</span><span class="sxs-lookup"><span data-stu-id="b81df-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="b81df-130">Après ces modifications, votre balisage déclaratif s de page doit ressembler à ce qui suit.</span><span class="sxs-lookup"><span data-stu-id="b81df-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="b81df-131">Assurez-vous que la modification, Annuler, et les boutons de mise à jour ont leur `CommandName` propriétés définies pour modifier, Annuler et mettre à jour, respectivement.</span><span class="sxs-lookup"><span data-stu-id="b81df-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="b81df-132">Pour ce didacticiel, le contrôle DataList, état d’affichage s doit être activée.</span><span class="sxs-lookup"><span data-stu-id="b81df-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="b81df-133">Prenez un moment pour consulter notre progression via un navigateur (voir Figure 2).</span><span class="sxs-lookup"><span data-stu-id="b81df-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="b81df-134">[![Chaque produit inclut un bouton Modifier](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b81df-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="b81df-135">**Figure 2**: Chaque produit inclut un bouton Modifier ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b81df-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>


<span data-ttu-id="b81df-136">Actuellement, le bouton Modifier entraîne uniquement une publication (postback) qu’il ne rendent encore le produit modifiable.</span><span class="sxs-lookup"><span data-stu-id="b81df-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="b81df-137">Pour activer la modification, nous devons créer des gestionnaires d’événements pour le contrôle DataList s `EditCommand`, `CancelCommand`, et `UpdateCommand` événements.</span><span class="sxs-lookup"><span data-stu-id="b81df-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="b81df-138">Le `EditCommand` et `CancelCommand` événements simplement mettre à jour pour le contrôle DataList s `EditItemIndex` propriété et les données pour le contrôle DataList la reliaison :</span><span class="sxs-lookup"><span data-stu-id="b81df-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="b81df-139">Le `UpdateCommand` Gestionnaire d’événements est un peu plus complexe.</span><span class="sxs-lookup"><span data-stu-id="b81df-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="b81df-140">Il doit lire dans le produit modifié s `ProductID` à partir de la `DataKeys` collection ainsi que le nom de produit s et le prix de zones de texte dans le `EditItemTemplate`, puis appelez le `ProductsBLL` classe s `UpdateProduct` avant de retourner le contrôle DataList (méthode) à son état avant modification.</span><span class="sxs-lookup"><span data-stu-id="b81df-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="b81df-141">Pour l’instant, s permettent d’utiliser simplement le même code à partir de la `UpdateCommand` Gestionnaire d’événements dans le *vue d’ensemble de la modification et suppression des données dans le contrôle DataList* didacticiel.</span><span class="sxs-lookup"><span data-stu-id="b81df-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="b81df-142">Nous allons ajouter le code pour gérer correctement les exceptions à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="b81df-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="b81df-143">En cas d’entrée non valide qui peut être sous la forme d’un prix unitaire incorrectement mis en forme, une valeur du prix unitaire non conforme, telles que-$5.00 ou l’omission du nom de s produit qu'une exception sera levée.</span><span class="sxs-lookup"><span data-stu-id="b81df-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="b81df-144">Dans la mesure où le `UpdateCommand` Gestionnaire d’événements n’inclut pas les exceptions code à ce stade, l’exception se propage jusqu'à l’exécution d’ASP.NET, où il sera affiché à l’utilisateur final (voir Figure 3).</span><span class="sxs-lookup"><span data-stu-id="b81df-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![Lorsqu’une Exception non gérée se produit, l’utilisateur final voit une Page d’erreur](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="b81df-146">**Figure 3**: Lorsqu’une Exception non gérée se produit, l’utilisateur final voit une Page d’erreur</span><span class="sxs-lookup"><span data-stu-id="b81df-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="b81df-147">Étape 2 : Normalement la gestion des Exceptions dans le Gestionnaire d’événements de UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="b81df-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="b81df-148">Pendant le flux de travail mis à jour, les exceptions peuvent se produire dans le `UpdateCommand` Gestionnaire d’événements, la couche BLL ou la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="b81df-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="b81df-149">Par exemple, si un utilisateur entre un prix de trop coûteux, la `Decimal.Parse` instruction dans le `UpdateCommand` Gestionnaire d’événements lève une `FormatException` exception.</span><span class="sxs-lookup"><span data-stu-id="b81df-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="b81df-150">Si l’utilisateur l’omet le nom du s produit ou si le prix a une valeur négative, la couche DAL lève une exception.</span><span class="sxs-lookup"><span data-stu-id="b81df-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="b81df-151">Lorsqu’une exception se produit, nous souhaitons afficher un message d’information au sein de la page elle-même.</span><span class="sxs-lookup"><span data-stu-id="b81df-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="b81df-152">Ajouter un service Web étiquette le contrôle à la page dont la propriété `ID` est défini sur `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="b81df-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="b81df-153">Configurer le texte d’étiquette s pour afficher en rouge, très grande taille, police en gras et italique en attribuant son `CssClass` propriété le `Warning` classe CSS, qui est défini dans le `Styles.css` fichier.</span><span class="sxs-lookup"><span data-stu-id="b81df-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="b81df-154">Lorsqu’une erreur se produit, nous voulons uniquement l’étiquette à afficher une seule fois.</span><span class="sxs-lookup"><span data-stu-id="b81df-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="b81df-155">Autrement dit, sur les publications ultérieures, le message d’avertissement étiquette s doit disparaître.</span><span class="sxs-lookup"><span data-stu-id="b81df-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="b81df-156">Cela est possible en supprimant soit l’étiquette s `Text` propriété ou des paramètres de son `Visible` propriété `False` dans le `Page_Load` Gestionnaire d’événements (comme nous l’avons fait dans le [BLL - gestion et les Exceptions au niveau de la couche DAL dans une page ASP Page .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) didacticiel) ou en désactivant la prise en charge de l’étiquette s vue état.</span><span class="sxs-lookup"><span data-stu-id="b81df-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="b81df-157">Permettent d’utiliser cette dernière option s.</span><span class="sxs-lookup"><span data-stu-id="b81df-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="b81df-158">Lorsqu’une exception est levée, nous attribuons les détails de l’exception pour le `ExceptionDetails` Label, contrôle s `Text` propriété.</span><span class="sxs-lookup"><span data-stu-id="b81df-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="b81df-159">Étant donné que son état d’affichage est désactivé, sur les publications ultérieures le `Text` modifications par programmation la propriété s seront perdues, revenez au texte par défaut (une chaîne vide), masquant ainsi le message d’avertissement.</span><span class="sxs-lookup"><span data-stu-id="b81df-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="b81df-160">Pour déterminer quand une erreur a été déclenchée pour afficher un message utile sur la page, nous devons ajouter un `Try ... Catch` bloquer à la `UpdateCommand` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="b81df-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="b81df-161">Le `Try` partie contient le code qui peut provoquer une exception, tandis que le `Catch` bloc contient du code qui est exécuté en cas d’une exception.</span><span class="sxs-lookup"><span data-stu-id="b81df-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="b81df-162">Découvrez le [notions de base de gestion des exceptions](https://msdn.microsoft.com/library/2w8f0bss.aspx) section dans la documentation .NET Framework pour plus d’informations sur la `Try ... Catch` bloc.</span><span class="sxs-lookup"><span data-stu-id="b81df-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="b81df-163">Quand une exception de n’importe quel type est levée par le code dans le `Try` bloc, le `Catch` code de bloc s commence l’exécution.</span><span class="sxs-lookup"><span data-stu-id="b81df-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="b81df-164">Le type d’exception qui est levée `DbException`, `NoNullAllowedException`, `ArgumentException`et ainsi de suite dépend, exactement, a déclenché l’erreur en premier lieu.</span><span class="sxs-lookup"><span data-stu-id="b81df-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="b81df-165">Si cet emplacement s un problème au niveau de la base de données, un `DbException` sera levée.</span><span class="sxs-lookup"><span data-stu-id="b81df-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="b81df-166">Si une valeur non conforme est entrée pour le `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, ou `ReorderLevel` champs, un `ArgumentException` est levée, comme nous avons ajouté du code pour valider ces valeurs de champ dans le `ProductsDataTable` classe (voir la [ Création d’une couche de logique métier](../introduction/creating-a-business-logic-layer-cs.md) didacticiel).</span><span class="sxs-lookup"><span data-stu-id="b81df-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="b81df-167">Nous pouvons fournir une explication plus utile à l’utilisateur final en le basant le texte du message sur le type d’exception interceptée.</span><span class="sxs-lookup"><span data-stu-id="b81df-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="b81df-168">Le code suivant qui a été utilisé dans un formulaire quasiment identique dans le [BLL - gestion et les Exceptions au niveau de la couche DAL dans une Page ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) didacticiel fournit ce niveau de détail :</span><span class="sxs-lookup"><span data-stu-id="b81df-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="b81df-169">Pour suivre ce didacticiel, appelez simplement la `DisplayExceptionDetails` méthode à partir de la `Catch` bloc en passant l’interceptée `Exception` instance (`ex`).</span><span class="sxs-lookup"><span data-stu-id="b81df-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="b81df-170">Avec le `Try ... Catch` bloquer en place, les utilisateurs sont présentées avec un message d’erreur plus explicite, comme les Figures 4 et 5 show.</span><span class="sxs-lookup"><span data-stu-id="b81df-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="b81df-171">Notez que, face à une exception, le contrôle DataList, reste dans le mode édition.</span><span class="sxs-lookup"><span data-stu-id="b81df-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="b81df-172">Il s’agit, car une fois l’exception se produit, le flux de contrôle est immédiatement redirigé vers le `Catch` bloc, en ignorant le code qui retourne le contrôle DataList à son état avant modification.</span><span class="sxs-lookup"><span data-stu-id="b81df-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="b81df-173">[![Un Message d’erreur s’affiche si un utilisateur omet un champ requis](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="b81df-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="b81df-174">**Figure 4**: Un Message d’erreur s’affiche si un utilisateur omet un champ requis ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="b81df-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>


<span data-ttu-id="b81df-175">[![Un Message d’erreur est affiché lorsque vous entrez vous un prix négatif](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b81df-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="b81df-176">**Figure 5**: Un Message d’erreur est affiché lorsque vous entrez vous un prix négatif ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="b81df-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="b81df-177">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="b81df-177">Summary</span></span>

<span data-ttu-id="b81df-178">Contrôles GridView et ObjectDataSource fournissent des gestionnaires d’événements post-niveau qui incluent des informations sur les exceptions qui ont été générées pendant le flux de travail de mise à jour et suppression, ainsi que les propriétés qui peuvent être définies pour indiquer si l’exception a été gérée.</span><span class="sxs-lookup"><span data-stu-id="b81df-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="b81df-179">Ces fonctionnalités, cependant, ne sont pas disponibles quand fonctionne avec le contrôle DataList et à l’aide de la couche BLL directement.</span><span class="sxs-lookup"><span data-stu-id="b81df-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="b81df-180">Au lieu de cela, nous sommes responsables de l’implémentation de la gestion des exceptions.</span><span class="sxs-lookup"><span data-stu-id="b81df-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="b81df-181">Dans ce didacticiel, nous avons vu comment ajouter la gestion des exceptions à un s DataList modifiable, la mise à jour de flux de travail en ajoutant un `Try ... Catch` bloquer à la `UpdateCommand` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="b81df-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="b81df-182">Si une exception est levée pendant le flux de travail mis à jour, le `Catch` bloc s code s’exécute, affichage des informations utiles dans le `ExceptionDetails` étiquette.</span><span class="sxs-lookup"><span data-stu-id="b81df-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="b81df-183">À ce stade, le contrôle DataList ne fait rien pour éviter les exceptions de se produire en premier lieu.</span><span class="sxs-lookup"><span data-stu-id="b81df-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="b81df-184">Même si nous savons qu’un prix négatif entraîne une exception, nous n’avons pas encore ajouté toutes les fonctionnalités pour empêcher proactivement un utilisateur d’entrer ce type d’entrée non valide.</span><span class="sxs-lookup"><span data-stu-id="b81df-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="b81df-185">Dans notre didacticiel suivant, nous allons voir comment aider à réduire les exceptions provoquées par l’entrée utilisateur non valide en ajoutant des contrôles de validation dans le `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b81df-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="b81df-186">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="b81df-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="b81df-187">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="b81df-187">Further Reading</span></span>

<span data-ttu-id="b81df-188">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="b81df-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b81df-189">Instructions de conception pour les exceptions</span><span class="sxs-lookup"><span data-stu-id="b81df-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="b81df-190">[Modules de journalisation des erreurs et des gestionnaires (ELMAH)](http://workspaces.gotdotnet.com/elmah) (une bibliothèque open source pour la journalisation des erreurs)</span><span class="sxs-lookup"><span data-stu-id="b81df-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="b81df-191">[Enterprise Library pour .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (inclut le bloc d’Application de gestion des exceptions)</span><span class="sxs-lookup"><span data-stu-id="b81df-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b81df-192">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="b81df-192">About the Author</span></span>

<span data-ttu-id="b81df-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept les livres sur ASP/ASP.NET et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="b81df-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b81df-194">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="b81df-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b81df-195">Son dernier ouvrage est [*SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b81df-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b81df-196">Il peut être contacté à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b81df-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b81df-197">ou via son blog, qui se trouve à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b81df-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b81df-198">Remerciements</span><span class="sxs-lookup"><span data-stu-id="b81df-198">Special Thanks To</span></span>

<span data-ttu-id="b81df-199">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="b81df-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b81df-200">Entraîner un réviseur pour ce didacticiel a été Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="b81df-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="b81df-201">Qui souhaitent consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="b81df-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b81df-202">Dans ce cas, envoyez-moi une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b81df-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b81df-203">[Précédent](performing-batch-updates-cs.md)
> [Suivant](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b81df-203">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
