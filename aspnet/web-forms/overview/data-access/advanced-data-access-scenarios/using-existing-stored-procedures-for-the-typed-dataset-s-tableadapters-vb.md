---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
title: Utilisation de procédures stockées existantes pour les TableAdapters du DataSet typé (VB) | Microsoft Docs
author: rick-anderson
description: Dans le didacticiel précédent, nous avons appris à utiliser l’Assistant TableAdapter pour générer de nouvelles procédures stockées. Dans ce didacticiel, nous allons découvrir comment le même TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 2da25f6a-757e-4e7b-a812-1575288d8f7a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb
msc.type: authoredcontent
ms.openlocfilehash: e35c3d6a98516a07f6119e6cb9dbeb99bc28fe33
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74613511"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-vb"></a><span data-ttu-id="d7aea-104">Utilisation de procédures stockées existantes pour les TableAdapters de dataset typé (VB)</span><span class="sxs-lookup"><span data-stu-id="d7aea-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (VB)</span></span>

<span data-ttu-id="d7aea-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d7aea-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d7aea-106">[Télécharger le code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) ou [Télécharger le PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d7aea-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_VB.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/datatutorial68vb1.pdf)</span></span>

> <span data-ttu-id="d7aea-107">Dans le didacticiel précédent, nous avons appris à utiliser l’Assistant TableAdapter pour générer de nouvelles procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="d7aea-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="d7aea-108">Dans ce didacticiel, nous allons découvrir comment le même Assistant TableAdapter peut fonctionner avec les procédures stockées existantes.</span><span class="sxs-lookup"><span data-stu-id="d7aea-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="d7aea-109">Nous apprenons également à ajouter manuellement de nouvelles procédures stockées à notre base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="d7aea-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="d7aea-110">Introduction</span></span>

<span data-ttu-id="d7aea-111">Dans le [didacticiel précédent](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) , nous avons vu comment les TableAdapters des datasets typés pouvaient être configurés pour utiliser des procédures stockées pour accéder aux données plutôt qu’à des instructions SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="d7aea-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="d7aea-112">Nous avons notamment examiné comment faire en sorte que l’Assistant TableAdapter crée automatiquement ces procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="d7aea-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="d7aea-113">Lors du Portage d’une application héritée vers ASP.NET 2,0 ou lors de la création d’un site Web ASP.NET 2,0 autour d’un modèle de données existant, il est probable que la base de données contienne déjà les procédures stockées dont nous avons besoin.</span><span class="sxs-lookup"><span data-stu-id="d7aea-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="d7aea-114">Vous pouvez également créer vos procédures stockées manuellement ou à l’aide d’un autre outil que l’Assistant TableAdapter qui génère automatiquement vos procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="d7aea-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="d7aea-115">Dans ce didacticiel, nous allons examiner comment configurer le TableAdapter pour utiliser des procédures stockées existantes.</span><span class="sxs-lookup"><span data-stu-id="d7aea-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="d7aea-116">Étant donné que la base de données Northwind ne possède qu’un petit ensemble de procédures stockées intégrées, nous examinerons également les étapes nécessaires pour ajouter manuellement de nouvelles procédures stockées à la base de données par le biais de l’environnement Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d7aea-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="d7aea-117">Commençons !</span><span class="sxs-lookup"><span data-stu-id="d7aea-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-118">Dans le didacticiel sur les [modifications de base de données encapsulées dans une transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) , nous avons ajouté des méthodes au TableAdapter pour prendre en charge les transactions (`BeginTransaction`, `CommitTransaction`, etc.).</span><span class="sxs-lookup"><span data-stu-id="d7aea-118">In the [Wrapping Database Modifications within a Transaction](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="d7aea-119">Les transactions peuvent également être entièrement gérées dans une procédure stockée, ce qui ne nécessite aucune modification du code de la couche d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="d7aea-120">Dans ce didacticiel, nous allons explorer les commandes T-SQL utilisées pour exécuter les instructions des procédures stockées dans l’étendue d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="d7aea-121">Étape 1 : ajout de procédures stockées à la base de données Northwind</span><span class="sxs-lookup"><span data-stu-id="d7aea-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="d7aea-122">Visual Studio facilite l’ajout de nouvelles procédures stockées à une base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="d7aea-123">Ajoutez une nouvelle procédure stockée à la base de données Northwind qui retourne toutes les colonnes de la table `Products` pour celles qui ont une valeur de `CategoryID` particulière.</span><span class="sxs-lookup"><span data-stu-id="d7aea-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="d7aea-124">Dans la fenêtre Explorateur de serveurs, développez la base de données Northwind afin d’afficher ses dossiers (schémas de base de données, tables, vues, etc.).</span><span class="sxs-lookup"><span data-stu-id="d7aea-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="d7aea-125">Comme nous l’avons vu dans le didacticiel précédent, le dossier procédures stockées contient les procédures stockées existantes de la base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="d7aea-126">Pour ajouter une nouvelle procédure stockée, il vous suffit de cliquer avec le bouton droit sur le dossier procédures stockées et de choisir l’option Ajouter une nouvelle procédure stockée dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="d7aea-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="d7aea-127">[![cliquez avec le bouton droit sur le dossier procédures stockées et ajoutez une nouvelle procédure stockée](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image1.png)</span></span>

<span data-ttu-id="d7aea-128">**Figure 1**: cliquez avec le bouton droit sur le dossier procédures stockées et ajoutez une nouvelle procédure stockée ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image3.png))</span></span>

<span data-ttu-id="d7aea-129">Comme le montre la figure 1, la sélection de l’option Ajouter une nouvelle procédure stockée ouvre une fenêtre de script dans Visual Studio avec le contour du script SQL nécessaire à la création de la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="d7aea-130">Nous sommes notre tâche de étoffer ce script et de l’exécuter, à partir de laquelle la procédure stockée sera ajoutée à la base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="d7aea-131">Entrez le script suivant :</span><span class="sxs-lookup"><span data-stu-id="d7aea-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample1.sql)]

<span data-ttu-id="d7aea-132">Ce script, lorsqu’il est exécuté, ajoute une nouvelle procédure stockée à la base de données Northwind nommée `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="d7aea-133">Cette procédure stockée accepte un paramètre d’entrée unique (`@CategoryID`, de type `int`) et retourne tous les champs pour ces produits avec une valeur de `CategoryID` correspondante.</span><span class="sxs-lookup"><span data-stu-id="d7aea-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="d7aea-134">Pour exécuter cette `CREATE PROCEDURE` script et ajouter la procédure stockée à la base de données, cliquez sur l’icône Enregistrer dans la barre d’outils ou appuyez sur CTRL + S.</span><span class="sxs-lookup"><span data-stu-id="d7aea-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="d7aea-135">Après cela, le dossier procédures stockées est actualisé, en présentant la procédure stockée nouvellement créée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="d7aea-136">En outre, le script dans la fenêtre change la subtilité de `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` à `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="d7aea-137">`CREATE PROCEDURE` ajoute une nouvelle procédure stockée à la base de données, tandis que `ALTER PROCEDURE` met à jour une procédure existante.</span><span class="sxs-lookup"><span data-stu-id="d7aea-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="d7aea-138">Étant donné que le début du script est passé à `ALTER PROCEDURE`, la modification des paramètres d’entrée des procédures stockées ou des instructions SQL et le fait de cliquer sur l’icône Enregistrer met à jour la procédure stockée avec ces modifications.</span><span class="sxs-lookup"><span data-stu-id="d7aea-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="d7aea-139">La figure 2 montre Visual Studio après l’enregistrement de la procédure stockée `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="d7aea-140">[![la Products_SelectByCategoryID de la procédure stockée a été ajoutée à la base de données](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image4.png)</span></span>

<span data-ttu-id="d7aea-141">**Figure 2**: la procédure stockée `Products_SelectByCategoryID` a été ajoutée à la base de données ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="d7aea-142">Étape 2 : configuration du TableAdapter pour utiliser une procédure stockée existante</span><span class="sxs-lookup"><span data-stu-id="d7aea-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="d7aea-143">Maintenant que la procédure stockée `Products_SelectByCategoryID` a été ajoutée à la base de données, nous pouvons configurer notre couche d’accès aux données de façon à ce qu’elle utilise cette procédure stockée lorsque l’une de ses méthodes est appelée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="d7aea-144">En particulier, nous allons ajouter une méthode de `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` à la `ProductsTableAdapter` dans le DataSet typé `NorthwindWithSprocs` qui appelle la procédure stockée `Products_SelectByCategoryID` que nous venons de créer.</span><span class="sxs-lookup"><span data-stu-id="d7aea-144">In particular, we will add a `GetProductsByCategoryID(<_i22_>categoryID)<!--_i22_-->` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="d7aea-145">Commencez par ouvrir le jeu de données `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="d7aea-146">Cliquez avec le bouton droit sur le `ProductsTableAdapter`, puis choisissez Ajouter une requête pour lancer l’Assistant Configuration de requêtes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="d7aea-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="d7aea-147">Dans le [didacticiel précédent](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) , nous avons choisi que le TableAdapter crée une nouvelle procédure stockée pour nous.</span><span class="sxs-lookup"><span data-stu-id="d7aea-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="d7aea-148">Pour ce didacticiel, toutefois, nous voulons connecter la nouvelle méthode TableAdapter à la procédure stockée `Products_SelectByCategoryID` existante.</span><span class="sxs-lookup"><span data-stu-id="d7aea-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="d7aea-149">Par conséquent, choisissez l’option utiliser une procédure stockée existante dans la première étape de l’Assistant, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="d7aea-150">[![choisissez l’option utiliser une procédure stockée existante](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image7.png)</span></span>

<span data-ttu-id="d7aea-151">**Figure 3**: choisir l’option utiliser une procédure stockée existante ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image9.png))</span></span>

<span data-ttu-id="d7aea-152">L’écran suivant fournit une liste déroulante remplie avec les procédures stockées de la base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="d7aea-153">La sélection d’une procédure stockée répertorie ses paramètres d’entrée à gauche et les champs de données retournés (le cas échéant) à droite.</span><span class="sxs-lookup"><span data-stu-id="d7aea-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="d7aea-154">Sélectionnez la procédure stockée `Products_SelectByCategoryID` dans la liste et cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="d7aea-155">[![choisir la procédure stockée Products_SelectByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image10.png)</span></span>

<span data-ttu-id="d7aea-156">**Figure 4**: sélectionner la procédure stockée `Products_SelectByCategoryID` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image12.png))</span></span>

<span data-ttu-id="d7aea-157">L’écran suivant nous demande quel type de données est retourné par la procédure stockée, et notre réponse ici détermine le type retourné par la méthode du TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="d7aea-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="d7aea-158">Par exemple, si nous indiquons que les données tabulaires sont retournées, la méthode retourne une instance `ProductsDataTable` remplie avec les enregistrements retournés par la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="d7aea-159">En revanche, si nous indiquons que cette procédure stockée retourne une valeur unique, le TableAdapter retourne une `Object` à laquelle la valeur de la première colonne du premier enregistrement retourné par la procédure stockée est affectée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `Object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="d7aea-160">Étant donné que la procédure stockée `Products_SelectByCategoryID` retourne tous les produits appartenant à une catégorie particulière, choisissez la première réponse-données tabulaires, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="d7aea-161">[![indiquer que la procédure stockée retourne des données tabulaires](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image13.png)</span></span>

<span data-ttu-id="d7aea-162">**Figure 5**: indiquer que la procédure stockée retourne des données tabulaires ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image15.png))</span></span>

<span data-ttu-id="d7aea-163">Il ne reste plus qu’à indiquer les modèles de méthode à utiliser, suivis des noms de ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="d7aea-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="d7aea-164">Laissez les options remplir un DataTable et retourner un DataTable activée, mais renommez les méthodes en `FillByCategoryID` et `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="d7aea-165">Cliquez ensuite sur suivant pour consulter un résumé des tâches que l’Assistant va effectuer.</span><span class="sxs-lookup"><span data-stu-id="d7aea-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="d7aea-166">Si tout semble correct, cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="d7aea-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="d7aea-167">[![nommez les méthodes FillByCategoryID et GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image16.png)</span></span>

<span data-ttu-id="d7aea-168">**Figure 6**: nommer les méthodes `FillByCategoryID` et `GetProductsByCategoryID` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-169">Les méthodes TableAdapter que nous venons de créer, `FillByCategoryID` et `GetProductsByCategoryID`, attendent un paramètre d’entrée de type `Integer`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `Integer`.</span></span> <span data-ttu-id="d7aea-170">Cette valeur de paramètre d’entrée est transmise à la procédure stockée via son paramètre `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="d7aea-171">Si vous modifiez les paramètres de la procédure stockée `Products_SelectByCategory`, vous devrez également mettre à jour les paramètres de ces méthodes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="d7aea-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="d7aea-172">Comme indiqué dans le [didacticiel précédent](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), cette opération peut être effectuée de deux manières : en ajoutant ou en supprimant manuellement des paramètres dans la collection Parameters ou en réexécutant l’Assistant TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="d7aea-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="d7aea-173">Étape 3 : ajout d’une méthode`GetProductsByCategoryID(categoryID)`à la couche BLL</span><span class="sxs-lookup"><span data-stu-id="d7aea-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="d7aea-174">Une fois la méthode `GetProductsByCategoryID` DAL terminée, l’étape suivante consiste à fournir l’accès à cette méthode dans la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="d7aea-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="d7aea-175">Ouvrez le fichier de classe `ProductsBLLWithSprocs` et ajoutez la méthode suivante :</span><span class="sxs-lookup"><span data-stu-id="d7aea-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-vb[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample2.vb)]

<span data-ttu-id="d7aea-176">Cette méthode BLL retourne simplement le `ProductsDataTable` retourné par la méthode `GetProductsByCategoryID` `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="d7aea-177">L’attribut `DataObjectMethodAttribute` fournit les métadonnées utilisées par l’Assistant Configuration de la source de données ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="d7aea-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="d7aea-178">En particulier, cette méthode apparaît dans la liste déroulante Sélectionner les onglets.</span><span class="sxs-lookup"><span data-stu-id="d7aea-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="d7aea-179">Étape 4 : affichage des produits par catégorie</span><span class="sxs-lookup"><span data-stu-id="d7aea-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="d7aea-180">Pour tester la procédure stockée `Products_SelectByCategoryID` nouvellement ajoutée et les méthodes DAL et BLL correspondantes, créez une page ASP.NET contenant un DropDownList et un GridView.</span><span class="sxs-lookup"><span data-stu-id="d7aea-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="d7aea-181">Le DropDownList répertorie toutes les catégories dans la base de données, tandis que le contrôle GridView affiche les produits appartenant à la catégorie sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-182">Nous avons créé des interfaces maître/détail à l’aide de DropDownList dans les didacticiels précédents.</span><span class="sxs-lookup"><span data-stu-id="d7aea-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="d7aea-183">Pour plus d’informations sur l’implémentation d’un rapport maître/détail, reportez-vous au didacticiel sur le [filtrage maître/détail avec un contrôle DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="d7aea-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial.</span></span>

<span data-ttu-id="d7aea-184">Ouvrez la page `ExistingSprocs.aspx` dans le dossier `AdvancedDAL` et faites glisser un contrôle DropDownList de la boîte à outils vers le concepteur.</span><span class="sxs-lookup"><span data-stu-id="d7aea-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="d7aea-185">Affectez à la propriété DropDownList s `ID` la valeur `Categories` et à sa propriété `AutoPostBack` la valeur `True`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `True`.</span></span> <span data-ttu-id="d7aea-186">Ensuite, à partir de sa balise active, liez le DropDownList à un nouvel ObjectDataSource nommé `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="d7aea-187">Configurez le ObjectDataSource afin qu’il récupère ses données à partir de la méthode de la classe `CategoriesBLL` s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="d7aea-188">Définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="d7aea-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="d7aea-189">[![récupérer des données de la méthode GetCategories de la classe CategoriesBLL s](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image19.png)</span></span>

<span data-ttu-id="d7aea-190">**Figure 7**: récupérer des données à partir de la méthode de la classe `CategoriesBLL` s `GetCategories` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image21.png))</span></span>

<span data-ttu-id="d7aea-191">[![définir les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image22.png)</span></span>

<span data-ttu-id="d7aea-192">**Figure 8**: définir les listes déroulantes des onglets mettre à jour, insérer et supprimer sur (aucun) ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image24.png))</span></span>

<span data-ttu-id="d7aea-193">Une fois l’exécution de l’Assistant ObjectDataSource terminée, configurez le DropDownList pour afficher le champ de données `CategoryName` et utiliser le champ `CategoryID` comme `Value` pour chaque `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="d7aea-194">À ce stade, les balises déclaratives DropDownList et ObjectDataSource s doivent ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="d7aea-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample3.aspx)]

<span data-ttu-id="d7aea-195">Ensuite, faites glisser un contrôle GridView sur le concepteur, en le plaçant sous le DropDownList.</span><span class="sxs-lookup"><span data-stu-id="d7aea-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="d7aea-196">Définissez le `ID` GridView s sur `ProductsByCategory` et, à partir de sa balise active, liez-le à un nouvel ObjectDataSource nommé `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="d7aea-197">Configurez le `ProductsByCategoryDataSource` ObjectDataSource pour utiliser la classe `ProductsBLLWithSprocs`, en le faisant récupérer ses données à l’aide de la méthode `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="d7aea-198">Étant donné que ce GridView sera utilisé uniquement pour afficher des données, définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun), puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="d7aea-199">[![configurer ObjectDataSource pour utiliser la classe ProductsBLLWithSprocs](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image25.png)</span></span>

<span data-ttu-id="d7aea-200">**Figure 9**: configurer ObjectDataSource pour utiliser la classe `ProductsBLLWithSprocs` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image27.png))</span></span>

<span data-ttu-id="d7aea-201">[![récupérer des données à partir de la méthode GetProductsByCategoryID (categoryID)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image28.png)</span></span>

<span data-ttu-id="d7aea-202">**Figure 10**: récupérer des données à partir de la méthode `GetProductsByCategoryID(categoryID)` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image30.png))</span></span>

<span data-ttu-id="d7aea-203">La méthode choisie dans l’onglet sélectionner attend un paramètre. par conséquent, la dernière étape de l’Assistant nous invite à spécifier la source du paramètre.</span><span class="sxs-lookup"><span data-stu-id="d7aea-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="d7aea-204">Définissez la liste déroulante source du paramètre sur Control et choisissez le contrôle `Categories` dans la liste déroulante ControlID.</span><span class="sxs-lookup"><span data-stu-id="d7aea-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="d7aea-205">Cliquez sur Terminer pour terminer l'Assistant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="d7aea-206">[![utiliser les catégories DropDownList comme source du paramètre categoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image31.png)</span></span>

<span data-ttu-id="d7aea-207">**Figure 11**: utiliser le `Categories` DropDownList comme source du paramètre `categoryID` ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image33.png))</span></span>

<span data-ttu-id="d7aea-208">Une fois l’exécution de l’Assistant ObjectDataSource terminée, Visual Studio ajoute BoundFields et CheckBoxField pour chacun des champs de données de produit.</span><span class="sxs-lookup"><span data-stu-id="d7aea-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="d7aea-209">N’hésitez pas à personnaliser ces champs comme vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="d7aea-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="d7aea-210">Accédez à la page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="d7aea-210">Visit the page through a browser.</span></span> <span data-ttu-id="d7aea-211">Lorsque vous accédez à la page, la catégorie boissons est sélectionnée et les produits correspondants sont listés dans la grille.</span><span class="sxs-lookup"><span data-stu-id="d7aea-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="d7aea-212">La modification de la liste déroulante en une catégorie alternative, comme illustré à la figure 12, provoque une publication (postback) et recharge la grille avec les produits de la catégorie nouvellement sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="d7aea-213">[![les produits de la catégorie production sont affichés](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image34.png)</span></span>

<span data-ttu-id="d7aea-214">**Figure 12**: affichage des produits de la catégorie production ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="d7aea-215">Étape 5 : encapsulation d’une instruction de procédure stockée dans l’étendue d’une transaction</span><span class="sxs-lookup"><span data-stu-id="d7aea-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="d7aea-216">Dans le didacticiel sur les [modifications de base de données encapsulées dans une transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) , nous avons abordé les techniques permettant d’effectuer une série d’instructions de modification de base de données dans l’étendue d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-vb.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="d7aea-217">Rappelez-vous que les modifications effectuées dans le cadre d’une transaction réussissent ou échouent, garantissant l’atomicité.</span><span class="sxs-lookup"><span data-stu-id="d7aea-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="d7aea-218">Les techniques d’utilisation des transactions sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="d7aea-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="d7aea-219">À l’aide des classes de l’espace de noms `System.Transactions`,</span><span class="sxs-lookup"><span data-stu-id="d7aea-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="d7aea-220">Faire en sorte que la couche d’accès aux données utilise des classes ADO.NET comme `SqlTransaction`, et</span><span class="sxs-lookup"><span data-stu-id="d7aea-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="d7aea-221">Ajout des commandes de transaction T-SQL directement dans la procédure stockée</span><span class="sxs-lookup"><span data-stu-id="d7aea-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="d7aea-222">Les *modifications de la base de données d’encapsulation dans un didacticiel de transaction* utilisaient les classes ADO.net dans la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="d7aea-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="d7aea-223">Le reste de ce didacticiel explique comment gérer une transaction à l’aide de commandes T-SQL à partir d’une procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="d7aea-224">Les trois commandes SQL clés pour démarrer, valider et restaurer manuellement une transaction sont `BEGIN TRANSACTION`, `COMMIT TRANSACTION`et `ROLLBACK TRANSACTION`, respectivement.</span><span class="sxs-lookup"><span data-stu-id="d7aea-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="d7aea-225">Comme avec l’approche ADO.NET, lorsque vous utilisez des transactions à partir d’une procédure stockée, nous devons appliquer le modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="d7aea-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="d7aea-226">Indique le début d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="d7aea-227">Exécutez les instructions SQL qui composent la transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="d7aea-228">En cas d’erreur dans l’une des instructions de l’étape 2, restaurez la transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-228">If there is an error in any one of the statements from Step 2, rollback the transaction.</span></span>
4. <span data-ttu-id="d7aea-229">Si toutes les instructions de l’étape 2 s’exécutent sans erreur, validez la transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="d7aea-230">Ce modèle peut être implémenté dans la syntaxe T-SQL à l’aide du modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="d7aea-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample4.sql)]

<span data-ttu-id="d7aea-231">Le modèle commence par définir un bloc `TRY...CATCH`, une construction nouvelle pour SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="d7aea-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="d7aea-232">Comme avec les blocs `Try...Catch` dans Visual Basic, le bloc `TRY...CATCH` SQL exécute les instructions dans le bloc `TRY`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-232">Like with `Try...Catch` blocks in Visual Basic, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="d7aea-233">Si une instruction génère une erreur, le contrôle est immédiatement transféré au bloc `CATCH`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="d7aea-234">S’il n’y a pas d’erreurs lors de l’exécution des instructions SQL qui composent la transaction, l’instruction `COMMIT TRANSACTION` valide les modifications et termine la transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="d7aea-235">Toutefois, si l’une des instructions génère une erreur, le `ROLLBACK TRANSACTION` dans le bloc `CATCH` retourne la base de données à son état avant le début de la transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="d7aea-236">La procédure stockée génère également une erreur à l’aide de la [commande RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), ce qui entraîne le déclenchement d’une `SqlException` dans l’application.</span><span class="sxs-lookup"><span data-stu-id="d7aea-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-237">Étant donné que le bloc `TRY...CATCH` est nouveau dans SQL Server 2005, le modèle ci-dessus ne fonctionnera pas si vous utilisez des versions antérieures de Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d7aea-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="d7aea-238">Si vous n’utilisez pas SQL Server 2005, consultez [gestion des transactions dans des procédures stockées SQL Server](http://www.4guysfromrolla.com/webtech/080305-1.shtml) pour un modèle qui fonctionne avec d’autres versions de SQL Server.</span><span class="sxs-lookup"><span data-stu-id="d7aea-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="d7aea-239">Observons un exemple concret.</span><span class="sxs-lookup"><span data-stu-id="d7aea-239">Let s look at a concrete example.</span></span> <span data-ttu-id="d7aea-240">Une contrainte de clé étrangère existe entre les tables `Categories` et `Products`, ce qui signifie que chaque champ `CategoryID` dans la table `Products` doit être mappé à une valeur `CategoryID` dans la table `Categories`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="d7aea-241">Toute action qui violerait cette contrainte, telle que la tentative de suppression d’une catégorie associée à des produits, entraîne une violation de contrainte de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="d7aea-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="d7aea-242">Pour vérifier cela, consultez à présent l’exemple mise à jour et suppression de données binaires existantes dans la section utilisation des données binaires (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="d7aea-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="d7aea-243">Cette page répertorie chaque catégorie du système, ainsi que les boutons modifier et supprimer (voir figure 13), mais si vous tentez de supprimer une catégorie associée à des produits (tels que boissons), la suppression échoue en raison d’une violation de contrainte de clé étrangère (voir figure 14).</span><span class="sxs-lookup"><span data-stu-id="d7aea-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="d7aea-244">[![chaque catégorie est affichée dans un GridView avec les boutons modifier et supprimer](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image37.png)</span></span>

<span data-ttu-id="d7aea-245">**Figure 13**: chaque catégorie est affichée dans un GridView avec les boutons modifier et supprimer ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image39.png))</span></span>

<span data-ttu-id="d7aea-246">[![vous ne pouvez pas supprimer une catégorie contenant des produits existants](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="d7aea-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image40.png)</span></span>

<span data-ttu-id="d7aea-247">**Figure 14**: vous ne pouvez pas supprimer une catégorie qui contient des produits existants ([cliquez pour afficher l’image en taille réelle](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="d7aea-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image42.png))</span></span>

<span data-ttu-id="d7aea-248">Imaginez, cependant, que nous souhaitons autoriser la suppression des catégories, qu’elles aient ou non des produits associés.</span><span class="sxs-lookup"><span data-stu-id="d7aea-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="d7aea-249">En cas de suppression d’une catégorie avec des produits, imaginez que nous voulons également supprimer ses produits existants (bien qu’une autre option consiste à définir simplement ses produits `CategoryID` valeurs sur `NULL`).</span><span class="sxs-lookup"><span data-stu-id="d7aea-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="d7aea-250">Cette fonctionnalité peut être implémentée à l’aide des règles de cascade de la contrainte de clé étrangère.</span><span class="sxs-lookup"><span data-stu-id="d7aea-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="d7aea-251">Vous pouvez également créer une procédure stockée qui accepte un paramètre d’entrée `@CategoryID` et, lorsqu’elle est appelée, supprime explicitement tous les produits associés, puis la catégorie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="d7aea-252">Notre première tentative dans une telle procédure stockée peut se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="d7aea-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample5.sql)]

<span data-ttu-id="d7aea-253">Bien que cette opération supprime définitivement les produits et la catégorie associés, elle ne le fait pas dans le cadre d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="d7aea-254">Imaginez qu’il existe une autre contrainte de clé étrangère sur `Categories` qui empêche la suppression d’une valeur de `@CategoryID` particulière.</span><span class="sxs-lookup"><span data-stu-id="d7aea-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="d7aea-255">Le problème est que, dans ce cas, tous les produits seront supprimés avant d’essayer de supprimer la catégorie.</span><span class="sxs-lookup"><span data-stu-id="d7aea-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="d7aea-256">Le résultat net est que pour une telle catégorie, cette procédure stockée supprime tous ses produits pendant que la catégorie est restée, car elle contient toujours des enregistrements associés dans une autre table.</span><span class="sxs-lookup"><span data-stu-id="d7aea-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="d7aea-257">Toutefois, si la procédure stockée a été encapsulée dans l’étendue d’une transaction, les suppressions de la table `Products` seraient annulées en cas d’échec de la suppression sur `Categories`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="d7aea-258">Le script de procédure stockée suivant utilise une transaction pour garantir l’atomicité entre les deux instructions `DELETE` :</span><span class="sxs-lookup"><span data-stu-id="d7aea-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/samples/sample6.sql)]

<span data-ttu-id="d7aea-259">Prenez un moment pour ajouter la procédure stockée `Categories_Delete` à la base de données Northwind.</span><span class="sxs-lookup"><span data-stu-id="d7aea-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="d7aea-260">Reportez-vous à l’étape 1 pour obtenir des instructions sur l’ajout de procédures stockées à une base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="d7aea-261">Étape 6 : mise à jour du`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="d7aea-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="d7aea-262">Pendant que nous avons ajouté la procédure stockée `Categories_Delete` à la base de données, la couche DAL est actuellement configurée pour utiliser des instructions SQL ad hoc pour effectuer la suppression.</span><span class="sxs-lookup"><span data-stu-id="d7aea-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="d7aea-263">Nous devons mettre à jour le `CategoriesTableAdapter` et lui demander d’utiliser la procédure stockée `Categories_Delete` à la place.</span><span class="sxs-lookup"><span data-stu-id="d7aea-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-264">Plus haut dans ce didacticiel, nous travaillons avec le jeu de données `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="d7aea-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="d7aea-265">Toutefois, ce jeu de données n’a qu’une seule entité, `ProductsDataTable`et nous devons travailler avec des catégories.</span><span class="sxs-lookup"><span data-stu-id="d7aea-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="d7aea-266">Par conséquent, pour le reste de ce didacticiel, lorsque je parle de la couche d’accès aux données, j’ai fait référence au jeu de données `Northwind`, celui que nous avons créé dans le didacticiel sur la [création d’une couche d’accès aux données](../introduction/creating-a-data-access-layer-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="d7aea-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial.</span></span>

<span data-ttu-id="d7aea-267">Ouvrez le jeu de données Northwind, sélectionnez la `CategoriesTableAdapter`, puis accédez à la Fenêtre Propriétés.</span><span class="sxs-lookup"><span data-stu-id="d7aea-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="d7aea-268">Le Fenêtre Propriétés répertorie les `InsertCommand`, `UpdateCommand`, `DeleteCommand`et `SelectCommand` utilisés par le TableAdapter, ainsi que son nom et les informations de connexion.</span><span class="sxs-lookup"><span data-stu-id="d7aea-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="d7aea-269">Développez la propriété `DeleteCommand` pour afficher ses détails.</span><span class="sxs-lookup"><span data-stu-id="d7aea-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="d7aea-270">Comme le montre la figure 15, la propriété `DeleteCommand` s `CommandType` est définie sur Text, ce qui lui indique d’envoyer le texte de la propriété `CommandText` en tant que requête SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="d7aea-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![Sélectionnez le CategoriesTableAdapter dans le concepteur pour afficher ses propriétés dans la fenêtre Propriétés.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image43.png)

<span data-ttu-id="d7aea-272">**Figure 15**: sélectionner l' `CategoriesTableAdapter` dans le concepteur pour afficher ses propriétés dans la fenêtre Propriétés</span><span class="sxs-lookup"><span data-stu-id="d7aea-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="d7aea-273">Pour modifier ces paramètres, sélectionnez le texte (DeleteCommand) dans le Fenêtre Propriétés et choisissez (nouveau) dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="d7aea-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="d7aea-274">Les paramètres des propriétés `CommandText`, `CommandType`et `Parameters` sont effacés.</span><span class="sxs-lookup"><span data-stu-id="d7aea-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="d7aea-275">Ensuite, affectez à la propriété `CommandType` la valeur `StoredProcedure`, puis tapez le nom de la procédure stockée pour le `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="d7aea-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="d7aea-276">Si vous veillez à entrer les propriétés dans cet ordre, en premier lieu, le `CommandType` puis le `CommandText`-Visual Studio remplira automatiquement la collection de paramètres.</span><span class="sxs-lookup"><span data-stu-id="d7aea-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="d7aea-277">Si vous n’entrez pas ces propriétés dans cet ordre, vous devez ajouter manuellement les paramètres par le biais de l’éditeur de collections Parameters.</span><span class="sxs-lookup"><span data-stu-id="d7aea-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="d7aea-278">Dans les deux cas, il est prudent de cliquer sur les points de suspension dans la propriété Parameters pour afficher l’éditeur de collections Parameters afin de vérifier que les modifications des paramètres corrects ont été apportées (voir figure 16).</span><span class="sxs-lookup"><span data-stu-id="d7aea-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="d7aea-279">Si vous ne voyez pas de paramètres dans la boîte de dialogue, ajoutez manuellement le paramètre `@CategoryID` (vous n’avez pas besoin d’ajouter le paramètre `@RETURN_VALUE`).</span><span class="sxs-lookup"><span data-stu-id="d7aea-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![Vérifier que les paramètres des paramètres sont corrects](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb/_static/image44.png)

<span data-ttu-id="d7aea-281">**Figure 16**: vérifier que les paramètres des paramètres sont corrects</span><span class="sxs-lookup"><span data-stu-id="d7aea-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="d7aea-282">Une fois la couche DAL mise à jour, la suppression d’une catégorie entraîne la suppression automatique de tous ses produits associés et le fait sous le cadre d’une transaction.</span><span class="sxs-lookup"><span data-stu-id="d7aea-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="d7aea-283">Pour vérifier cela, revenez à la page mise à jour et suppression de données binaires existantes, puis cliquez sur le bouton Supprimer pour l’une des catégories.</span><span class="sxs-lookup"><span data-stu-id="d7aea-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="d7aea-284">En un seul clic de souris, la catégorie et tous les produits associés sont supprimés.</span><span class="sxs-lookup"><span data-stu-id="d7aea-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="d7aea-285">Avant de tester la procédure stockée `Categories_Delete`, qui supprimera un certain nombre de produits, ainsi que la catégorie sélectionnée, il peut être prudent de faire une copie de sauvegarde de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="d7aea-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="d7aea-286">Si vous utilisez la base de données `NORTHWND.MDF` dans `App_Data`, fermez simplement Visual Studio et copiez les fichiers MDF et LDF dans `App_Data` dans un autre dossier.</span><span class="sxs-lookup"><span data-stu-id="d7aea-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="d7aea-287">Après avoir testé la fonctionnalité, vous pouvez restaurer la base de données en fermant Visual Studio et en remplaçant les fichiers MDF et LDF actuels dans `App_Data` par les copies de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d7aea-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="d7aea-288">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="d7aea-288">Summary</span></span>

<span data-ttu-id="d7aea-289">Tandis que l’Assistant TableAdapter s génère automatiquement des procédures stockées pour nous, il arrive que nous ayons déjà créé ces procédures stockées ou que vous souhaitiez les créer manuellement ou à l’aide d’autres outils.</span><span class="sxs-lookup"><span data-stu-id="d7aea-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="d7aea-290">Pour prendre en charge de tels scénarios, le TableAdapter peut également être configuré pour pointer vers une procédure stockée existante.</span><span class="sxs-lookup"><span data-stu-id="d7aea-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="d7aea-291">Dans ce didacticiel, nous avons vu comment ajouter manuellement des procédures stockées à une base de données par le biais de l’environnement Visual Studio et comment connecter les méthodes TableAdapter s à ces procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="d7aea-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="d7aea-292">Nous avons également examiné les commandes T-SQL et le modèle de script utilisés pour démarrer, valider et restaurer des transactions à partir d’une procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="d7aea-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="d7aea-293">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="d7aea-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="d7aea-294">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="d7aea-294">About the Author</span></span>

<span data-ttu-id="d7aea-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="d7aea-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d7aea-296">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="d7aea-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d7aea-297">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="d7aea-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d7aea-298">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d7aea-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="d7aea-299">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="d7aea-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d7aea-300">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="d7aea-300">Special Thanks To</span></span>

<span data-ttu-id="d7aea-301">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="d7aea-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d7aea-302">Les réviseurs de leads pour ce didacticiel étaient Hilton Geisenow, S Ren Jacob Lauritsen et Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="d7aea-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="d7aea-303">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="d7aea-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d7aea-304">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d7aea-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d7aea-305">[Précédent](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
> [Suivant](updating-the-tableadapter-to-use-joins-vb.md)</span><span class="sxs-lookup"><span data-stu-id="d7aea-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md)
[Next](updating-the-tableadapter-to-use-joins-vb.md)</span></span>
