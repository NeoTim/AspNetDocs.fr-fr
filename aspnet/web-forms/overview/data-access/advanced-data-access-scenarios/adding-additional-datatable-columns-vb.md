---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
title: Ajout de colonnes de DataTable supplémentaires (VB) | Microsoft Docs
author: rick-anderson
description: Lorsque vous utilisez l’Assistant TableAdapter pour créer un DataSet typé, le DataTable correspondant contient les colonnes retournées par la requête de base de données principale. Mais ici...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 1e8e65f9-fe3e-4250-810b-c90227786bed
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/adding-additional-datatable-columns-vb
msc.type: authoredcontent
ms.openlocfilehash: 3a55f8bc4d3508387927ca81674073a001867de7
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78534103"
---
# <a name="adding-additional-datatable-columns-vb"></a><span data-ttu-id="beb33-104">Ajout de colonnes de DataTable supplémentaires (VB)</span><span class="sxs-lookup"><span data-stu-id="beb33-104">Adding Additional DataTable Columns (VB)</span></span>

<span data-ttu-id="beb33-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="beb33-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="beb33-106">[Télécharger le code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip) ou [Télécharger le PDF](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="beb33-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_70_VB.zip) or [Download PDF](adding-additional-datatable-columns-vb/_static/datatutorial70vb1.pdf)</span></span>

> <span data-ttu-id="beb33-107">Lorsque vous utilisez l’Assistant TableAdapter pour créer un DataSet typé, le DataTable correspondant contient les colonnes retournées par la requête de base de données principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-107">When using the TableAdapter Wizard to create a Typed DataSet, the corresponding DataTable contains the columns returned by the main database query.</span></span> <span data-ttu-id="beb33-108">Toutefois, il existe des occasions où le DataTable doit inclure des colonnes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="beb33-108">But there are occasions when the DataTable needs to include additional columns.</span></span> <span data-ttu-id="beb33-109">Dans ce didacticiel, nous expliquons pourquoi des procédures stockées sont recommandées lorsque nous avons besoin de colonnes DataTable supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="beb33-109">In this tutorial we learn why stored procedures are recommended when we need additional DataTable columns.</span></span>

## <a name="introduction"></a><span data-ttu-id="beb33-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="beb33-110">Introduction</span></span>

<span data-ttu-id="beb33-111">Quand vous ajoutez un TableAdapter à un DataSet typé, le schéma du DataTable s correspondant est déterminé par la requête principale du TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="beb33-111">When adding a TableAdapter to a Typed DataSet, the corresponding DataTable s schema is determined by the TableAdapter s main query.</span></span> <span data-ttu-id="beb33-112">Par exemple, si la requête principale retourne les champs *de données a*, *b*et *c*, le DataTable aura trois colonnes correspondantes nommées *a*, *b*et *c*. En plus de sa requête principale, un TableAdapter peut inclure des requêtes supplémentaires qui retournent, éventuellement, un sous-ensemble de données basé sur un paramètre.</span><span class="sxs-lookup"><span data-stu-id="beb33-112">For example, if the main query returns data fields *A*, *B*, and *C*, the DataTable will have three corresponding columns named *A*, *B*, and *C*. In addition to its main query, a TableAdapter can include additional queries that return, perhaps, a subset of the data based on some parameter.</span></span> <span data-ttu-id="beb33-113">Par exemple, en plus de la requête principale de `ProductsTableAdapter` s, qui retourne des informations sur tous les produits, elle contient également des méthodes comme `GetProductsByCategoryID(categoryID)` et `GetProductByProductID(productID)`, qui retournent des informations spécifiques sur les produits en fonction d’un paramètre fourni.</span><span class="sxs-lookup"><span data-stu-id="beb33-113">For instance, in addition to the `ProductsTableAdapter` s main query, which returns information about all products, it also contains methods like `GetProductsByCategoryID(categoryID)` and `GetProductByProductID(productID)`, which return specific product information based on a supplied parameter.</span></span>

<span data-ttu-id="beb33-114">Le modèle d’utilisation du schéma de la table de données reflète bien la requête principale de TableAdapter si toutes les méthodes de TableAdapter retournent le même nombre de champs de données ou moins que ceux spécifiés dans la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-114">The model of having the DataTable s schema reflect the TableAdapter s main query works well if all of the TableAdapter s methods return the same or fewer data fields than those specified in the main query.</span></span> <span data-ttu-id="beb33-115">Si une méthode TableAdapter doit retourner des champs de données supplémentaires, nous devons développer le schéma DataTable s en conséquence.</span><span class="sxs-lookup"><span data-stu-id="beb33-115">If a TableAdapter method needs to return additional data fields, then we should expand the DataTable s schema accordingly.</span></span> <span data-ttu-id="beb33-116">Dans le [maître/détail à l’aide d’une liste à puces d’enregistrements maîtres avec un didacticiel détails sur DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) , nous avons ajouté une méthode au `CategoriesTableAdapter` qui a renvoyé les champs de données `CategoryID`, `CategoryName`et `Description` définis dans la requête principale plus `NumberOfProducts`, un champ de données supplémentaire qui a signalé le nombre de produits associés à chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="beb33-116">In the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that returned the `CategoryID`, `CategoryName`, and `Description` data fields defined in the main query plus `NumberOfProducts`, an additional data field that reported the number of products associated with each category.</span></span> <span data-ttu-id="beb33-117">Nous avons ajouté manuellement une nouvelle colonne au `CategoriesDataTable` afin de capturer la valeur du champ de données `NumberOfProducts` à partir de cette nouvelle méthode.</span><span class="sxs-lookup"><span data-stu-id="beb33-117">We manually added a new column to the `CategoriesDataTable` in order to capture the `NumberOfProducts` data field value from this new method.</span></span>

<span data-ttu-id="beb33-118">Comme indiqué dans le didacticiel sur le [téléchargement de fichiers](../working-with-binary-files/uploading-files-vb.md) , il est important de bien comprendre les TableAdapters qui utilisent des instructions SQL ad hoc et les méthodes dont les champs de données ne correspondent pas exactement à la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-118">As discussed in the [Uploading Files](../working-with-binary-files/uploading-files-vb.md) tutorial, great care must be taken with TableAdapters that use ad-hoc SQL statements and have methods whose data fields do not precisely match the main query.</span></span> <span data-ttu-id="beb33-119">Si l’Assistant Configuration de TableAdapter est réexécuté, il met à jour toutes les méthodes de TableAdapter pour que la liste des champs de données corresponde à la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-119">If the TableAdapter Configuration wizard is re-run, it will update all of the TableAdapter s methods so that their data field list matches the main query.</span></span> <span data-ttu-id="beb33-120">Par conséquent, toutes les méthodes avec des listes de colonnes personnalisées sont restaurées dans la liste des colonnes de la requête principale et ne retournent pas les données attendues.</span><span class="sxs-lookup"><span data-stu-id="beb33-120">Consequently, any methods with customized column lists will revert to the main query s column list and not return the expected data.</span></span> <span data-ttu-id="beb33-121">Ce problème ne se pose pas lors de l’utilisation de procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="beb33-121">This issue does not arise when using stored procedures.</span></span>

<span data-ttu-id="beb33-122">Dans ce didacticiel, nous allons examiner comment étendre un schéma DataTable s pour inclure des colonnes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="beb33-122">In this tutorial we will look at how to extend a DataTable s schema to include additional columns.</span></span> <span data-ttu-id="beb33-123">En raison de la fragilité du TableAdapter lors de l’utilisation d’instructions SQL ad hoc, dans ce didacticiel, nous allons utiliser des procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="beb33-123">Due to the brittleness of the TableAdapter when using ad-hoc SQL statements, in this tutorial we will use stored procedures.</span></span> <span data-ttu-id="beb33-124">Pour plus d’informations sur la configuration d’un TableAdapter pour l’utilisation de procédures stockées, consultez [création de procédures stockées pour les TableAdapters de DataSet typés](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) et [utilisation de procédures stockées existantes pour les didacticiels de TableAdapters de datasets typés](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) .</span><span class="sxs-lookup"><span data-stu-id="beb33-124">Refer to the [Creating New Stored Procedures for the Typed DataSet s TableAdapters](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) and [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-vb.md) tutorials for more information on configuring a TableAdapter to use stored procedures.</span></span>

## <a name="step-1-adding-apricequartilecolumn-to-theproductsdatatable"></a><span data-ttu-id="beb33-125">Étape 1 : ajout d’une colonne`PriceQuartile`à la`ProductsDataTable`</span><span class="sxs-lookup"><span data-stu-id="beb33-125">Step 1: Adding a`PriceQuartile`Column to the`ProductsDataTable`</span></span>

<span data-ttu-id="beb33-126">Dans le didacticiel *création de nouvelles procédures stockées pour les TableAdapters de DataSet typé* , nous avons créé un DataSet typé nommé `NorthwindWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="beb33-126">In the *Creating New Stored Procedures for the Typed DataSet s TableAdapters* tutorial we created a Typed DataSet named `NorthwindWithSprocs`.</span></span> <span data-ttu-id="beb33-127">Ce jeu de données contient actuellement deux DataTables : `ProductsDataTable` et `EmployeesDataTable`.</span><span class="sxs-lookup"><span data-stu-id="beb33-127">This DataSet currently contains two DataTables: `ProductsDataTable` and `EmployeesDataTable`.</span></span> <span data-ttu-id="beb33-128">L' `ProductsTableAdapter` présente les trois méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="beb33-128">The `ProductsTableAdapter` has the following three methods:</span></span>

- <span data-ttu-id="beb33-129">`GetProducts`-la requête principale, qui retourne tous les enregistrements de la table `Products`</span><span class="sxs-lookup"><span data-stu-id="beb33-129">`GetProducts` - the main query, which returns all records from the `Products` table</span></span>
- <span data-ttu-id="beb33-130">`GetProductsByCategoryID(categoryID)`-retourne tous les produits avec la *CategoryID*spécifiée.</span><span class="sxs-lookup"><span data-stu-id="beb33-130">`GetProductsByCategoryID(categoryID)` - returns all products with the specified *categoryID*.</span></span>
- <span data-ttu-id="beb33-131">`GetProductByProductID(productID)` : renvoie le produit spécifique avec le *ProductID*spécifié.</span><span class="sxs-lookup"><span data-stu-id="beb33-131">`GetProductByProductID(productID)` - returns the particular product with the specified *productID*.</span></span>

<span data-ttu-id="beb33-132">La requête principale et les deux autres méthodes retournent toutes le même jeu de champs de données, à savoir toutes les colonnes de la table `Products`.</span><span class="sxs-lookup"><span data-stu-id="beb33-132">The main query and the two additional methods all return the same set of data fields, namely all of the columns from the `Products` table.</span></span> <span data-ttu-id="beb33-133">Il n’y a pas de sous-requêtes corrélées, ni de `JOIN` qui extraient les données associées des tables `Categories` ou `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="beb33-133">There are no correlated subqueries or `JOIN` s pulling related data from the `Categories` or `Suppliers` tables.</span></span> <span data-ttu-id="beb33-134">Par conséquent, la `ProductsDataTable` a une colonne correspondante pour chaque champ de la table `Products`.</span><span class="sxs-lookup"><span data-stu-id="beb33-134">Therefore, the `ProductsDataTable` has a corresponding column for each field in the `Products` table.</span></span>

<span data-ttu-id="beb33-135">Pour ce didacticiel, nous allons ajouter une méthode au `ProductsTableAdapter` nommé `GetProductsWithPriceQuartile` qui retourne tous les produits.</span><span class="sxs-lookup"><span data-stu-id="beb33-135">For this tutorial, let s add a method to the `ProductsTableAdapter` named `GetProductsWithPriceQuartile` that returns all of the products.</span></span> <span data-ttu-id="beb33-136">En plus des champs de données de produit standard, `GetProductsWithPriceQuartile` inclura également un champ de données `PriceQuartile` qui indique le niveau d’activité du quartile du prix du produit.</span><span class="sxs-lookup"><span data-stu-id="beb33-136">In addition to the standard product data fields, `GetProductsWithPriceQuartile` will also include a `PriceQuartile` data field that indicates under which quartile the product s price falls.</span></span> <span data-ttu-id="beb33-137">Par exemple, les produits dont le prix est inférieur ou supérieur à 25% auront une valeur `PriceQuartile` de 1, tandis que ceux dont les prix tombent dans les 25% inférieurs auront la valeur 4.</span><span class="sxs-lookup"><span data-stu-id="beb33-137">For example, those products whose prices are in the most expensive 25% will have a `PriceQuartile` value of 1, while those whose prices fall in the bottom 25% will have a value of 4.</span></span> <span data-ttu-id="beb33-138">Avant de nous soucier de la création de la procédure stockée pour retourner ces informations, nous devons tout d’abord mettre à jour le `ProductsDataTable` pour inclure une colonne qui contiendra le `PriceQuartile` résultats lorsque la méthode `GetProductsWithPriceQuartile` est utilisée.</span><span class="sxs-lookup"><span data-stu-id="beb33-138">Before we worry about creating the stored procedure to return this information, however, we first need to update the `ProductsDataTable` to include a column to hold the `PriceQuartile` results when the `GetProductsWithPriceQuartile` method is used.</span></span>

<span data-ttu-id="beb33-139">Ouvrez le jeu de données `NorthwindWithSprocs`, puis cliquez avec le bouton droit sur l' `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="beb33-139">Open the `NorthwindWithSprocs` DataSet and right-click on the `ProductsDataTable`.</span></span> <span data-ttu-id="beb33-140">Choisissez Ajouter dans le menu contextuel, puis choisissez colonne.</span><span class="sxs-lookup"><span data-stu-id="beb33-140">Choose Add from the context-menu and then pick Column.</span></span>

<span data-ttu-id="beb33-141">[![ajouter une nouvelle colonne au ProductsDataTable](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-141">[![Add a New Column to the ProductsDataTable](adding-additional-datatable-columns-vb/_static/image2.png)](adding-additional-datatable-columns-vb/_static/image1.png)</span></span>

<span data-ttu-id="beb33-142">**Figure 1**: ajouter une nouvelle colonne au `ProductsDataTable` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-142">**Figure 1**: Add a New Column to the `ProductsDataTable` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image3.png))</span></span>

<span data-ttu-id="beb33-143">Cette opération ajoute une nouvelle colonne au DataTable nommé Column1 de type `System.String`.</span><span class="sxs-lookup"><span data-stu-id="beb33-143">This will add a new column to the DataTable named Column1 of type `System.String`.</span></span> <span data-ttu-id="beb33-144">Nous devons mettre à jour ce nom de colonne s en PriceQuartile et son type à `System.Int32`, car il sera utilisé pour contenir un nombre compris entre 1 et 4.</span><span class="sxs-lookup"><span data-stu-id="beb33-144">We need to update this column s name to PriceQuartile and its type to `System.Int32` since it will be used to hold a number between 1 and 4.</span></span> <span data-ttu-id="beb33-145">Sélectionnez la colonne qui vient d’être ajoutée dans le `ProductsDataTable` et, dans la Fenêtre Propriétés, affectez à la propriété `Name` la valeur PriceQuartile et à la propriété `DataType` la valeur `System.Int32`.</span><span class="sxs-lookup"><span data-stu-id="beb33-145">Select the newly-added column in the `ProductsDataTable` and, from the Properties window, set the `Name` property to PriceQuartile and the `DataType` property to `System.Int32`.</span></span>

<span data-ttu-id="beb33-146">[![définir les propriétés de nom et de type de données de la nouvelle colonne](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-146">[![Set the New Column s Name and DataType Properties](adding-additional-datatable-columns-vb/_static/image5.png)](adding-additional-datatable-columns-vb/_static/image4.png)</span></span>

<span data-ttu-id="beb33-147">**Figure 2**: définir les propriétés des nouvelles colonnes `Name` et `DataType` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-147">**Figure 2**: Set the New Column s `Name` and `DataType` Properties ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image6.png))</span></span>

<span data-ttu-id="beb33-148">Comme le montre la figure 2, il existe des propriétés supplémentaires qui peuvent être définies, par exemple si les valeurs de la colonne doivent être uniques, si la colonne est une colonne à incrémentation automatique, si les valeurs `NULL` de la base de données sont autorisées ou non, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="beb33-148">As Figure 2 shows, there are additional properties that can be set, such as whether the values in the column must be unique, if the column is an auto-increment column, whether or not database `NULL` values are allowed, and so on.</span></span> <span data-ttu-id="beb33-149">Laissez ces valeurs définies sur leurs valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="beb33-149">Leave these values set to their defaults.</span></span>

## <a name="step-2-creating-thegetproductswithpricequartilemethod"></a><span data-ttu-id="beb33-150">Étape 2 : création de la méthode`GetProductsWithPriceQuartile`</span><span class="sxs-lookup"><span data-stu-id="beb33-150">Step 2: Creating the`GetProductsWithPriceQuartile`Method</span></span>

<span data-ttu-id="beb33-151">Maintenant que la `ProductsDataTable` a été mise à jour pour inclure la colonne `PriceQuartile`, nous sommes prêts à créer la méthode `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-151">Now that the `ProductsDataTable` has been updated to include the `PriceQuartile` column, we are ready to create the `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="beb33-152">Commencez par cliquer avec le bouton droit sur le TableAdapter et choisissez Ajouter une requête dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="beb33-152">Start by right-clicking on the TableAdapter and choosing Add Query from the context-menu.</span></span> <span data-ttu-id="beb33-153">L’Assistant Configuration de requêtes TableAdapter s’affiche pour la première fois, qui nous invite à indiquer si vous souhaitez utiliser des instructions SQL ad hoc ou une procédure stockée nouvelle ou existante.</span><span class="sxs-lookup"><span data-stu-id="beb33-153">This brings up the TableAdapter Query Configuration wizard, which first prompts us as to whether we want to use ad-hoc SQL statements or a new or existing stored procedure.</span></span> <span data-ttu-id="beb33-154">Étant donné que nous ne disposons pas encore d’une procédure stockée qui retourne les données du prix du quartile, autorisez le TableAdapter à créer cette procédure stockée pour nous.</span><span class="sxs-lookup"><span data-stu-id="beb33-154">Since we don t yet have a stored procedure that returns the price quartile data, let s allow the TableAdapter to create this stored procedure for us.</span></span> <span data-ttu-id="beb33-155">Sélectionnez l’option créer une nouvelle procédure stockée, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="beb33-155">Select the Create new stored procedure option and click Next.</span></span>

<span data-ttu-id="beb33-156">[![demander à l’Assistant TableAdapter de créer la procédure stockée pour nous](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-156">[![Instruct the TableAdapter Wizard to Create the Stored Procedure For Us](adding-additional-datatable-columns-vb/_static/image8.png)](adding-additional-datatable-columns-vb/_static/image7.png)</span></span>

<span data-ttu-id="beb33-157">**Figure 3**: demander à l’Assistant TableAdapter de créer la procédure stockée pour nous ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-157">**Figure 3**: Instruct the TableAdapter Wizard to Create the Stored Procedure For Us ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image9.png))</span></span>

<span data-ttu-id="beb33-158">Dans l’écran suivant, illustré à la figure 4, l’Assistant nous demande le type de requête à ajouter.</span><span class="sxs-lookup"><span data-stu-id="beb33-158">In the subsequent screen, shown in Figure 4, the wizard asks us what type of query to add.</span></span> <span data-ttu-id="beb33-159">Étant donné que la méthode `GetProductsWithPriceQuartile` retourne toutes les colonnes et tous les enregistrements de la table `Products`, sélectionnez l’option SELECT qui retourne des lignes, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="beb33-159">Since the `GetProductsWithPriceQuartile` method will return all columns and records from the `Products` table, select the SELECT which returns rows option and click Next.</span></span>

<span data-ttu-id="beb33-160">[![notre requête sera une instruction SELECT qui retourne plusieurs lignes](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-160">[![Our Query will be a SELECT Statement that Returns Multiple Rows](adding-additional-datatable-columns-vb/_static/image11.png)](adding-additional-datatable-columns-vb/_static/image10.png)</span></span>

<span data-ttu-id="beb33-161">**Figure 4**: notre requête sera une instruction `SELECT` qui retourne plusieurs lignes ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-161">**Figure 4**: Our Query will be a `SELECT` Statement that Returns Multiple Rows ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image12.png))</span></span>

<span data-ttu-id="beb33-162">Nous sommes ensuite invités à entrer la requête `SELECT`.</span><span class="sxs-lookup"><span data-stu-id="beb33-162">Next we are prompted for the `SELECT` query.</span></span> <span data-ttu-id="beb33-163">Entrez la requête suivante dans l’Assistant :</span><span class="sxs-lookup"><span data-stu-id="beb33-163">Enter the following query into the wizard:</span></span>

[!code-sql[Main](adding-additional-datatable-columns-vb/samples/sample1.sql)]

<span data-ttu-id="beb33-164">La requête ci-dessus utilise la nouvelle [fonction`NTILE`](https://msdn.microsoft.com/library/ms175126.aspx) de SQL Server 2005 s pour diviser les résultats en quatre groupes, où les groupes sont déterminés par les valeurs de `UnitPrice` triées dans l’ordre décroissant.</span><span class="sxs-lookup"><span data-stu-id="beb33-164">The above query uses SQL Server 2005 s new [`NTILE` function](https://msdn.microsoft.com/library/ms175126.aspx) to divide the results into four groups where the groups are determined by the `UnitPrice` values sorted in descending order.</span></span>

<span data-ttu-id="beb33-165">Malheureusement, le Générateur de requêtes ne sait pas comment analyser le mot clé `OVER` et affiche une erreur lors de l’analyse de la requête ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="beb33-165">Unfortunately, the Query Builder does not know how to parse the `OVER` keyword and will display an error when parsing the above query.</span></span> <span data-ttu-id="beb33-166">Par conséquent, entrez la requête ci-dessus directement dans la zone de texte de l’Assistant sans utiliser l’Générateur de requêtes.</span><span class="sxs-lookup"><span data-stu-id="beb33-166">Therefore, enter the above query directly in the textbox in the wizard without using the Query Builder.</span></span>

> [!NOTE]
> <span data-ttu-id="beb33-167">Pour plus d’informations sur les autres fonctions de classement de NTILE et SQL Server 2005, consultez [renvoi de résultats classés avec Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) et la [section fonctions de classement](https://msdn.microsoft.com/library/ms189798.aspx) de la [documentation en ligne de SQL Server 2005](https://msdn.microsoft.com/library/ms189798.aspx).</span><span class="sxs-lookup"><span data-stu-id="beb33-167">For more information on NTILE and SQL Server 2005 s other ranking functions, see [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml) and the [Ranking Functions section](https://msdn.microsoft.com/library/ms189798.aspx) from the [SQL Server 2005 Books Online](https://msdn.microsoft.com/library/ms189798.aspx).</span></span>

<span data-ttu-id="beb33-168">Après avoir entré la requête `SELECT` et cliqué sur suivant, l’Assistant nous invite à fournir un nom pour la procédure stockée qu’il va créer.</span><span class="sxs-lookup"><span data-stu-id="beb33-168">After entering the `SELECT` query and clicking Next, the wizard asks us to provide a name for the stored procedure it will create.</span></span> <span data-ttu-id="beb33-169">Nommez la nouvelle procédure stockée `Products_SelectWithPriceQuartile`, puis cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="beb33-169">Name the new stored procedure `Products_SelectWithPriceQuartile` and click Next.</span></span>

<span data-ttu-id="beb33-170">[![nom de la procédure stockée Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-170">[![Name the Stored Procedure Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image14.png)](adding-additional-datatable-columns-vb/_static/image13.png)</span></span>

<span data-ttu-id="beb33-171">**Figure 5**: nommer la procédure stockée `Products_SelectWithPriceQuartile` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-171">**Figure 5**: Name the Stored Procedure `Products_SelectWithPriceQuartile` ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image15.png))</span></span>

<span data-ttu-id="beb33-172">Enfin, nous sommes invités à nommer les méthodes TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="beb33-172">Lastly, we are prompted to name the TableAdapter methods.</span></span> <span data-ttu-id="beb33-173">Laissez les cases à cocher remplir un DataTable et retourner un DataTable activée, puis nommez les méthodes `FillWithPriceQuartile` et `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-173">Leave both the Fill a DataTable and Return a DataTable checkboxes checked and name the methods `FillWithPriceQuartile` and `GetProductsWithPriceQuartile`.</span></span>

<span data-ttu-id="beb33-174">[![nommez les méthodes TableAdapter s et cliquez sur terminer](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-174">[![Name the TableAdapter s Methods and Click Finish](adding-additional-datatable-columns-vb/_static/image17.png)](adding-additional-datatable-columns-vb/_static/image16.png)</span></span>

<span data-ttu-id="beb33-175">**Figure 6**: nommer les méthodes des TableAdapter s et cliquer sur Terminer ([Cliquer pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-175">**Figure 6**: Name the TableAdapter s Methods and Click Finish ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image18.png))</span></span>

<span data-ttu-id="beb33-176">Avec la requête `SELECT` spécifiée et la procédure stockée et les méthodes TableAdapter nommées, cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="beb33-176">With the `SELECT` query specified and the stored procedure and TableAdapter methods named, click Finish to complete the wizard.</span></span> <span data-ttu-id="beb33-177">À ce stade, vous pouvez recevoir un avertissement ou deux de l’Assistant, indiquant que la construction ou l’instruction SQL `OVER` n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="beb33-177">At this point you may get a warning or two from the wizard saying that The `OVER` SQL construct or statement is not supported.</span></span> <span data-ttu-id="beb33-178">Ces avertissements peuvent être ignorés.</span><span class="sxs-lookup"><span data-stu-id="beb33-178">These warnings can be ignored.</span></span>

<span data-ttu-id="beb33-179">Une fois l’Assistant terminé, le TableAdapter doit inclure les méthodes `FillWithPriceQuartile` et `GetProductsWithPriceQuartile` et la base de données doit inclure une procédure stockée nommée `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-179">After completing the wizard, the TableAdapter should include the `FillWithPriceQuartile` and `GetProductsWithPriceQuartile` methods and the database should include a stored procedure named `Products_SelectWithPriceQuartile`.</span></span> <span data-ttu-id="beb33-180">Prenez un moment pour vérifier que le TableAdapter contient effectivement cette nouvelle méthode et que la procédure stockée a été correctement ajoutée à la base de données.</span><span class="sxs-lookup"><span data-stu-id="beb33-180">Take a moment to verify that the TableAdapter does indeed contain this new method and that the stored procedure has been correctly added to the database.</span></span> <span data-ttu-id="beb33-181">Lorsque vous vérifiez la base de données, si vous ne voyez pas la procédure stockée, essayez de cliquer avec le bouton droit sur le dossier procédures stockées, puis choisissez actualiser.</span><span class="sxs-lookup"><span data-stu-id="beb33-181">When checking the database, if you do not see the stored procedure try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>

![Vérifier qu’une nouvelle méthode a été ajoutée au TableAdapter](adding-additional-datatable-columns-vb/_static/image19.png)

<span data-ttu-id="beb33-183">**Figure 7**: vérifier qu’une nouvelle méthode a été ajoutée au TableAdapter</span><span class="sxs-lookup"><span data-stu-id="beb33-183">**Figure 7**: Verify that a New Method Has Been Added to the TableAdapter</span></span>

<span data-ttu-id="beb33-184">[![vérifier que la base de données contient la procédure stockée Products_SelectWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-184">[![Ensure that the Database Contains the Products_SelectWithPriceQuartile Stored Procedure](adding-additional-datatable-columns-vb/_static/image21.png)](adding-additional-datatable-columns-vb/_static/image20.png)</span></span>

<span data-ttu-id="beb33-185">**Figure 8**: vérifier que la base de données contient la procédure stockée `Products_SelectWithPriceQuartile` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-185">**Figure 8**: Ensure that the Database Contains the `Products_SelectWithPriceQuartile` Stored Procedure ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image22.png))</span></span>

> [!NOTE]
> <span data-ttu-id="beb33-186">L’un des avantages de l’utilisation des procédures stockées au lieu des instructions SQL ad hoc est que la réexécution de l’Assistant Configuration de TableAdapter ne modifiera pas les listes de colonnes de procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="beb33-186">One of the benefits of using stored procedures instead of ad-hoc SQL statements is that re-running the TableAdapter Configuration wizard will not modify the stored procedures column lists.</span></span> <span data-ttu-id="beb33-187">Pour vérifier cela, cliquez avec le bouton droit sur le TableAdapter, choisissez l’option configurer dans le menu contextuel pour démarrer l’Assistant, puis cliquez sur Terminer pour le terminer.</span><span class="sxs-lookup"><span data-stu-id="beb33-187">Verify this by right-clicking on the TableAdapter, choosing the Configure option from the context-menu to start the wizard, and then clicking Finish to complete it.</span></span> <span data-ttu-id="beb33-188">Ensuite, accédez à la base de données et affichez la procédure stockée `Products_SelectWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-188">Next, go to the database and view the `Products_SelectWithPriceQuartile` stored procedure.</span></span> <span data-ttu-id="beb33-189">Notez que la liste des colonnes n’a pas été modifiée.</span><span class="sxs-lookup"><span data-stu-id="beb33-189">Note that its column list has not been modified.</span></span> <span data-ttu-id="beb33-190">Si nous avions utilisé des instructions SQL ad hoc, la réexécution de l’Assistant Configuration de TableAdapter aurait rétabli la liste des colonnes de cette requête pour qu’elle corresponde à la liste des colonnes de requête principale, supprimant ainsi l’instruction NTILE de la requête utilisée par la méthode `GetProductsWithPriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-190">Had we been using ad-hoc SQL statements, re-running the TableAdapter Configuration wizard would have reverted this query s column list to match the main query column list, thereby removing the NTILE statement from the query used by the `GetProductsWithPriceQuartile` method.</span></span>

<span data-ttu-id="beb33-191">Lorsque la méthode `GetProductsWithPriceQuartile` de la couche d’accès aux données est appelée, le TableAdapter exécute la procédure stockée `Products_SelectWithPriceQuartile` et ajoute une ligne au `ProductsDataTable` pour chaque enregistrement retourné.</span><span class="sxs-lookup"><span data-stu-id="beb33-191">When the Data Access Layer s `GetProductsWithPriceQuartile` method is invoked, the TableAdapter executes the `Products_SelectWithPriceQuartile` stored procedure and adds a row to the `ProductsDataTable` for each returned record.</span></span> <span data-ttu-id="beb33-192">Les champs de données retournés par la procédure stockée sont mappés aux colonnes `ProductsDataTable` s.</span><span class="sxs-lookup"><span data-stu-id="beb33-192">The data fields returned by the stored procedure are mapped to the `ProductsDataTable` s columns.</span></span> <span data-ttu-id="beb33-193">Comme il existe un champ de données `PriceQuartile` renvoyé par la procédure stockée, sa valeur est assignée à la colonne `ProductsDataTable` s `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-193">Since there is a `PriceQuartile` data field returned from the stored procedure, its value is assigned to the `ProductsDataTable` s `PriceQuartile` column.</span></span>

<span data-ttu-id="beb33-194">Pour les méthodes TableAdapter dont les requêtes ne retournent pas de champ de données `PriceQuartile`, la valeur de `PriceQuartile` colonne s est la valeur spécifiée par sa propriété `DefaultValue`.</span><span class="sxs-lookup"><span data-stu-id="beb33-194">For those TableAdapter methods whose queries do not return a `PriceQuartile` data field, the `PriceQuartile` column s value is the value specified by its `DefaultValue` property.</span></span> <span data-ttu-id="beb33-195">Comme le montre la figure 2, cette valeur est définie sur `DBNull`, la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="beb33-195">As Figure 2 shows, this value is set to `DBNull`, the default.</span></span> <span data-ttu-id="beb33-196">Si vous préférez une autre valeur par défaut, il vous suffit de définir la propriété `DefaultValue` en conséquence.</span><span class="sxs-lookup"><span data-stu-id="beb33-196">If you would prefer a different default value, simply set the `DefaultValue` property accordingly.</span></span> <span data-ttu-id="beb33-197">Assurez-vous simplement que la valeur `DefaultValue` est valide étant donné la colonne s `DataType` (c’est-à-dire, `System.Int32` pour la colonne `PriceQuartile`).</span><span class="sxs-lookup"><span data-stu-id="beb33-197">Just make sure that the `DefaultValue` value is valid given the column s `DataType` (i.e., `System.Int32` for the `PriceQuartile` column).</span></span>

<span data-ttu-id="beb33-198">À ce stade, nous avons effectué les étapes nécessaires pour ajouter une colonne supplémentaire à un DataTable.</span><span class="sxs-lookup"><span data-stu-id="beb33-198">At this point we have performed the necessary steps for adding an additional column to a DataTable.</span></span> <span data-ttu-id="beb33-199">Pour vérifier que cette colonne supplémentaire fonctionne comme prévu, créez une page ASP.NET qui affiche chaque nom de produit, Price et Price quartile.</span><span class="sxs-lookup"><span data-stu-id="beb33-199">To verify that this additional column works as expected, let s create an ASP.NET page that displays each product s name, price, and price quartile.</span></span> <span data-ttu-id="beb33-200">Avant cela, cependant, nous devons tout d’abord mettre à jour la couche de logique métier pour inclure une méthode qui appelle la méthode de `GetProductsWithPriceQuartile` DAL.</span><span class="sxs-lookup"><span data-stu-id="beb33-200">Before we do that, though, we first need to update the Business Logic Layer to include a method that calls down to the DAL s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="beb33-201">Nous allons mettre à jour la couche BLL suivant, à l’étape 3, puis créer la page ASP.NET à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="beb33-201">We will update the BLL next, in Step 3, and then create the ASP.NET page in Step 4.</span></span>

## <a name="step-3-augmenting-the-business-logic-layer"></a><span data-ttu-id="beb33-202">Étape 3 : augmentation de la couche de logique métier</span><span class="sxs-lookup"><span data-stu-id="beb33-202">Step 3: Augmenting the Business Logic Layer</span></span>

<span data-ttu-id="beb33-203">Avant d’utiliser la nouvelle méthode `GetProductsWithPriceQuartile` de la couche de présentation, nous devons d’abord ajouter une méthode correspondante à la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="beb33-203">Before we use the new `GetProductsWithPriceQuartile` method from the Presentation Layer, we should first add a corresponding method to the BLL.</span></span> <span data-ttu-id="beb33-204">Ouvrez le fichier de classe `ProductsBLLWithSprocs` et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="beb33-204">Open the `ProductsBLLWithSprocs` class file and add the following code:</span></span>

[!code-vb[Main](adding-additional-datatable-columns-vb/samples/sample2.vb)]

<span data-ttu-id="beb33-205">À l’instar des autres méthodes de récupération de données dans `ProductsBLLWithSprocs`, la méthode `GetProductsWithPriceQuartile` appelle simplement la couche DAL correspondant `GetProductsWithPriceQuartile` méthode et retourne ses résultats.</span><span class="sxs-lookup"><span data-stu-id="beb33-205">Like the other data retrieval methods in `ProductsBLLWithSprocs`, the `GetProductsWithPriceQuartile` method simply calls the DAL s corresponding `GetProductsWithPriceQuartile` method and returns its results.</span></span>

## <a name="step-4-displaying-the-price-quartile-information-in-an-aspnet-web-page"></a><span data-ttu-id="beb33-206">Étape 4 : affichage des informations sur le prix du quartile dans une page Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="beb33-206">Step 4: Displaying the Price Quartile Information in an ASP.NET Web Page</span></span>

<span data-ttu-id="beb33-207">À l’aide de l’ajout de la couche BLL, nous sommes prêts à créer une page ASP.NET qui indique le quartile tarifaire pour chaque produit.</span><span class="sxs-lookup"><span data-stu-id="beb33-207">With the BLL addition complete we re ready to create an ASP.NET page that shows the price quartile for each product.</span></span> <span data-ttu-id="beb33-208">Ouvrez la page `AddingColumns.aspx` dans le dossier `AdvancedDAL` et faites glisser un contrôle GridView de la boîte à outils vers le concepteur, en affectant à sa propriété `ID` la valeur `Products`.</span><span class="sxs-lookup"><span data-stu-id="beb33-208">Open the `AddingColumns.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="beb33-209">À partir de la balise active GridView s, liez-le à un nouvel ObjectDataSource nommé `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="beb33-209">From the GridView s smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="beb33-210">Configurez le ObjectDataSource pour utiliser la méthode de `GetProductsWithPriceQuartile` de la classe `ProductsBLLWithSprocs`.</span><span class="sxs-lookup"><span data-stu-id="beb33-210">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class s `GetProductsWithPriceQuartile` method.</span></span> <span data-ttu-id="beb33-211">Étant donné qu’il s’agit d’une grille en lecture seule, définissez les listes déroulantes dans les onglets mettre à jour, insérer et supprimer sur (aucun).</span><span class="sxs-lookup"><span data-stu-id="beb33-211">Since this will be a read-only grid, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="beb33-212">[![configurer ObjectDataSource pour utiliser la classe ProductsBLLWithSprocs](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-212">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](adding-additional-datatable-columns-vb/_static/image24.png)](adding-additional-datatable-columns-vb/_static/image23.png)</span></span>

<span data-ttu-id="beb33-213">**Figure 9**: configurer ObjectDataSource pour utiliser la classe `ProductsBLLWithSprocs` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-213">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image25.png))</span></span>

<span data-ttu-id="beb33-214">[![récupérer les informations sur le produit à partir de la méthode GetProductsWithPriceQuartile](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-214">[![Retrieve Product Information from the GetProductsWithPriceQuartile Method](adding-additional-datatable-columns-vb/_static/image27.png)](adding-additional-datatable-columns-vb/_static/image26.png)</span></span>

<span data-ttu-id="beb33-215">**Figure 10**: récupérer des informations sur le produit à partir de la méthode `GetProductsWithPriceQuartile` ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-215">**Figure 10**: Retrieve Product Information from the `GetProductsWithPriceQuartile` Method ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image28.png))</span></span>

<span data-ttu-id="beb33-216">À l’issue de l’exécution de l’Assistant Configuration de la source de données, Visual Studio ajoute automatiquement un BoundField ou un CheckBoxField au GridView pour chacun des champs de données retournés par la méthode.</span><span class="sxs-lookup"><span data-stu-id="beb33-216">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField or CheckBoxField to the GridView for each of the data fields returned by the method.</span></span> <span data-ttu-id="beb33-217">L’un de ces champs de données est `PriceQuartile`, qui est la colonne que nous avons ajoutée au `ProductsDataTable` à l’étape 1.</span><span class="sxs-lookup"><span data-stu-id="beb33-217">One of these data fields is `PriceQuartile`, which is the column we added to the `ProductsDataTable` in Step 1.</span></span>

<span data-ttu-id="beb33-218">Modifiez les champs GridView s, en supprimant tous les `ProductName`, `UnitPrice`et `PriceQuartile` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="beb33-218">Edit the GridView s fields, removing all but the `ProductName`, `UnitPrice`, and `PriceQuartile` BoundFields.</span></span> <span data-ttu-id="beb33-219">Configurez l' `UnitPrice` BoundField pour mettre en forme sa valeur en tant que devise et pour que les `UnitPrice` et `PriceQuartile` BoundFields alignés à droite et au centre, respectivement.</span><span class="sxs-lookup"><span data-stu-id="beb33-219">Configure the `UnitPrice` BoundField to format its value as a currency and have the `UnitPrice` and `PriceQuartile` BoundFields right- and center-aligned, respectively.</span></span> <span data-ttu-id="beb33-220">Enfin, mettez à jour les propriétés de `HeaderText` BoundFields restantes en, Price et Price quartile, respectivement.</span><span class="sxs-lookup"><span data-stu-id="beb33-220">Finally, update the remaining BoundFields `HeaderText` properties to Product, Price, and Price Quartile, respectively.</span></span> <span data-ttu-id="beb33-221">Activez également la case à cocher Activer le tri à partir de la balise active GridView s.</span><span class="sxs-lookup"><span data-stu-id="beb33-221">Also, check the Enable Sorting checkbox from the GridView s smart tag.</span></span>

<span data-ttu-id="beb33-222">Une fois ces modifications effectuées, les balises déclaratives GridView et ObjectDataSource doivent ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="beb33-222">After these modifications, the GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-additional-datatable-columns-vb/samples/sample3.aspx)]

<span data-ttu-id="beb33-223">La figure 11 illustre cette page lorsqu’elle est visitée via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="beb33-223">Figure 11 shows this page when visited through a browser.</span></span> <span data-ttu-id="beb33-224">Notez que, initialement, les produits sont classés par prix dans l’ordre décroissant, avec chaque produit affecté à une valeur de `PriceQuartile` appropriée.</span><span class="sxs-lookup"><span data-stu-id="beb33-224">Note that, initially, the products are ordered by their price in descending order with each product assigned an appropriate `PriceQuartile` value.</span></span> <span data-ttu-id="beb33-225">Bien entendu, ces données peuvent être triées en fonction d’autres critères avec la valeur de la colonne du quartile tarifaire qui reflète toujours le classement du produit en ce qui concerne le prix (voir figure 12).</span><span class="sxs-lookup"><span data-stu-id="beb33-225">Of course this data can be sorted by other criteria with the Price Quartile column value still reflecting the product s ranking with respect to price (see Figure 12).</span></span>

<span data-ttu-id="beb33-226">[![les produits sont classés par prix](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-226">[![The Products are Ordered by their Prices](adding-additional-datatable-columns-vb/_static/image30.png)](adding-additional-datatable-columns-vb/_static/image29.png)</span></span>

<span data-ttu-id="beb33-227">**Figure 11**: les produits sont classés par prix ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-227">**Figure 11**: The Products are Ordered by their Prices ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image31.png))</span></span>

<span data-ttu-id="beb33-228">[![les produits sont classés en fonction de leur nom](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="beb33-228">[![The Products are Ordered by their Names](adding-additional-datatable-columns-vb/_static/image33.png)](adding-additional-datatable-columns-vb/_static/image32.png)</span></span>

<span data-ttu-id="beb33-229">**Figure 12**: les produits sont classés selon leur nom ([cliquez pour afficher l’image en taille réelle](adding-additional-datatable-columns-vb/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="beb33-229">**Figure 12**: The Products are Ordered by their Names ([Click to view full-size image](adding-additional-datatable-columns-vb/_static/image34.png))</span></span>

> [!NOTE]
> <span data-ttu-id="beb33-230">Avec quelques lignes de code, nous pourrions augmenter le GridView afin qu’il colore les lignes de produits en fonction de leur valeur de `PriceQuartile`.</span><span class="sxs-lookup"><span data-stu-id="beb33-230">With a few lines of code we could augment the GridView so that it colored the product rows based on their `PriceQuartile` value.</span></span> <span data-ttu-id="beb33-231">Il est possible que les produits soient colorés dans le premier quartile en vert clair, dans le second quartile en jaune clair, etc.</span><span class="sxs-lookup"><span data-stu-id="beb33-231">We might color those products in the first quartile a light green, those in the second quartile a light yellow, and so forth.</span></span> <span data-ttu-id="beb33-232">Je vous encourage à prendre un moment pour ajouter cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="beb33-232">I encourage you to take a moment to add this functionality.</span></span> <span data-ttu-id="beb33-233">Si vous avez besoin d’un actualisateur pour la mise en forme d’un GridView, consultez le didacticiel sur la [mise en forme personnalisée basée](../custom-formatting/custom-formatting-based-upon-data-vb.md) sur les données.</span><span class="sxs-lookup"><span data-stu-id="beb33-233">If you need a refresher on formatting a GridView, consult the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-vb.md) tutorial.</span></span>

## <a name="an-alternative-approach---creating-another-tableadapter"></a><span data-ttu-id="beb33-234">Une autre approche : création d’un autre TableAdapter</span><span class="sxs-lookup"><span data-stu-id="beb33-234">An Alternative Approach - Creating Another TableAdapter</span></span>

<span data-ttu-id="beb33-235">Comme nous l’avons vu dans ce didacticiel, lors de l’ajout d’une méthode à un TableAdapter qui retourne des champs de données autres que ceux de la requête principale, nous pouvons ajouter des colonnes correspondantes au DataTable.</span><span class="sxs-lookup"><span data-stu-id="beb33-235">As we saw in this tutorial, when adding a method to a TableAdapter that returns data fields other than those spelled out by the main query, we can add corresponding columns to the DataTable.</span></span> <span data-ttu-id="beb33-236">Toutefois, une telle approche fonctionne bien uniquement s’il existe un petit nombre de méthodes dans le TableAdapter qui retournent des champs de données différents et si ces champs de données de remplacement ne varient pas trop de la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-236">Such an approach, however, works well only if there are a small number of methods in the TableAdapter that return different data fields and if those alternate data fields do not vary too much from the main query.</span></span>

<span data-ttu-id="beb33-237">Au lieu d’ajouter des colonnes au DataTable, vous pouvez ajouter un autre TableAdapter au DataSet qui contient les méthodes du premier TableAdapter qui retournent des champs de données différents.</span><span class="sxs-lookup"><span data-stu-id="beb33-237">Rather than adding columns to the DataTable, you can instead add another TableAdapter to the DataSet that contains the methods from the first TableAdapter that return different data fields.</span></span> <span data-ttu-id="beb33-238">Pour ce didacticiel, au lieu d’ajouter la colonne `PriceQuartile` à la `ProductsDataTable` (où elle est utilisée uniquement par la méthode `GetProductsWithPriceQuartile`), nous aurions pu ajouter un TableAdapter supplémentaire au DataSet nommé `ProductsWithPriceQuartileTableAdapter` qui utilisait la procédure stockée `Products_SelectWithPriceQuartile` comme requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-238">For this tutorial, rather than add the `PriceQuartile` column to the `ProductsDataTable` (where it is only used by the `GetProductsWithPriceQuartile` method), we could have added an additional TableAdapter to the DataSet named `ProductsWithPriceQuartileTableAdapter` that used the `Products_SelectWithPriceQuartile` stored procedure as its main query.</span></span> <span data-ttu-id="beb33-239">Les pages ASP.NET qui devaient recevoir des informations sur le produit avec le quartile Price utilisent la `ProductsWithPriceQuartileTableAdapter`, tandis que celles qui ne pouvaient pas continuer à utiliser le `ProductsTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="beb33-239">ASP.NET pages that needed to get product information with the price quartile would use the `ProductsWithPriceQuartileTableAdapter`, while those that did not could continue to use the `ProductsTableAdapter`.</span></span>

<span data-ttu-id="beb33-240">En ajoutant un nouveau TableAdapter, les DataTables restent internis et leurs colonnes reflètent précisément les champs de données retournés par leurs méthodes TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="beb33-240">By adding a new TableAdapter, the DataTables remain untarnished and their columns precisely mirror the data fields returned by their TableAdapter s methods.</span></span> <span data-ttu-id="beb33-241">Toutefois, des TableAdapters supplémentaires peuvent introduire des tâches et des fonctionnalités répétitives.</span><span class="sxs-lookup"><span data-stu-id="beb33-241">However, additional TableAdapters can introduce repetitive tasks and functionality.</span></span> <span data-ttu-id="beb33-242">Par exemple, si les pages ASP.NET qui affichaient la colonne `PriceQuartile` étaient également nécessaires pour assurer la prise en charge de l’insertion, de la mise à jour et de la suppression, les propriétés `InsertCommand`, `UpdateCommand`et `DeleteCommand` de la `ProductsWithPriceQuartileTableAdapter` doivent être correctement configurées.</span><span class="sxs-lookup"><span data-stu-id="beb33-242">For example, if those ASP.NET pages that displayed the `PriceQuartile` column also needed to provide insert, update, and delete support, the `ProductsWithPriceQuartileTableAdapter` would need to have its `InsertCommand`, `UpdateCommand`, and `DeleteCommand` properties properly configured.</span></span> <span data-ttu-id="beb33-243">Bien que ces propriétés reflètent le `ProductsTableAdapter` s, cette configuration introduit une étape supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="beb33-243">While these properties would mirror the `ProductsTableAdapter` s, this configuration introduces an extra step.</span></span> <span data-ttu-id="beb33-244">En outre, il existe deux façons de mettre à jour, de supprimer ou d’ajouter un produit à la base de données, par le biais des classes `ProductsTableAdapter` et `ProductsWithPriceQuartileTableAdapter`.</span><span class="sxs-lookup"><span data-stu-id="beb33-244">Moreover, there are now two ways to update, delete, or add a product to the database - through the `ProductsTableAdapter` and `ProductsWithPriceQuartileTableAdapter` classes.</span></span>

<span data-ttu-id="beb33-245">Le téléchargement de ce didacticiel comprend une classe `ProductsWithPriceQuartileTableAdapter` dans le jeu de données `NorthwindWithSprocs` qui illustre cette approche alternative.</span><span class="sxs-lookup"><span data-stu-id="beb33-245">The download for this tutorial includes a `ProductsWithPriceQuartileTableAdapter` class in the `NorthwindWithSprocs` DataSet that illustrates this alternative approach.</span></span>

## <a name="summary"></a><span data-ttu-id="beb33-246">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="beb33-246">Summary</span></span>

<span data-ttu-id="beb33-247">Dans la plupart des scénarios, toutes les méthodes d’un TableAdapter retournent le même jeu de champs de données, mais il peut arriver qu’une méthode particulière ou deux doive retourner un champ supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="beb33-247">In most scenarios, all of the methods in a TableAdapter will return the same set of data fields, but there are times when a particular method or two may need to return an additional field.</span></span> <span data-ttu-id="beb33-248">Par exemple, dans le [maître/détail à l’aide d’une liste à puces d’enregistrements maîtres avec un didacticiel détails sur DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) , nous avons ajouté une méthode au `CategoriesTableAdapter` qui, en plus des champs de données de la requête principale, a retourné un champ `NumberOfProducts` qui a signalé le nombre de produits associés à chaque catégorie.</span><span class="sxs-lookup"><span data-stu-id="beb33-248">For example, in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial we added a method to the `CategoriesTableAdapter` that, in addition to the main query s data fields, returned a `NumberOfProducts` field that reported the number of products associated with each category.</span></span> <span data-ttu-id="beb33-249">Dans ce didacticiel, nous avons examiné l’ajout d’une méthode dans la `ProductsTableAdapter` qui a retourné un champ `PriceQuartile` en plus des champs de données de la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-249">In this tutorial we looked at adding a method in the `ProductsTableAdapter` that returned a `PriceQuartile` field in addition to the main query s data fields.</span></span> <span data-ttu-id="beb33-250">Pour capturer des champs de données supplémentaires retournés par les méthodes TableAdapter s, nous devons ajouter des colonnes correspondantes au DataTable.</span><span class="sxs-lookup"><span data-stu-id="beb33-250">To capture additional data fields returned by the TableAdapter s methods we need to add corresponding columns to the DataTable.</span></span>

<span data-ttu-id="beb33-251">Si vous prévoyez d’ajouter manuellement des colonnes au DataTable, il est recommandé que le TableAdapter utilise des procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="beb33-251">If you plan on manually adding columns to the DataTable, it is recommended that the TableAdapter use stored procedures.</span></span> <span data-ttu-id="beb33-252">Si le TableAdapter utilise des instructions SQL ad hoc, chaque fois que l’Assistant Configuration de TableAdapter est exécuté, toutes les listes de champs de données de méthode reprennent les champs de données retournés par la requête principale.</span><span class="sxs-lookup"><span data-stu-id="beb33-252">If the TableAdapter uses ad-hoc SQL statements, any time the TableAdapter Configuration wizard is run all of the methods data field lists revert to the data fields returned by the main query.</span></span> <span data-ttu-id="beb33-253">Ce problème ne s’étend pas aux procédures stockées, c’est pourquoi il est recommandé et utilisé dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="beb33-253">This problem does not extend to stored procedures, which is why they are recommended and were used in this tutorial.</span></span>

<span data-ttu-id="beb33-254">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="beb33-254">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="beb33-255">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="beb33-255">About the Author</span></span>

<span data-ttu-id="beb33-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="beb33-256">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="beb33-257">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="beb33-257">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="beb33-258">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="beb33-258">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="beb33-259">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="beb33-259">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="beb33-260">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="beb33-260">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="beb33-261">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="beb33-261">Special Thanks To</span></span>

<span data-ttu-id="beb33-262">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="beb33-262">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="beb33-263">Les réviseurs de leads pour ce didacticiel étaient Randy Schmidt, Jacky Goor, Bernadette Leigh et Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="beb33-263">Lead reviewers for this tutorial were Randy Schmidt, Jacky Goor, Bernadette Leigh, and Hilton Giesenow.</span></span> <span data-ttu-id="beb33-264">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="beb33-264">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="beb33-265">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="beb33-265">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="beb33-266">[Précédent](updating-the-tableadapter-to-use-joins-vb.md)
> [Suivant](working-with-computed-columns-vb.md)</span><span class="sxs-lookup"><span data-stu-id="beb33-266">[Previous](updating-the-tableadapter-to-use-joins-vb.md)
[Next](working-with-computed-columns-vb.md)</span></span>
