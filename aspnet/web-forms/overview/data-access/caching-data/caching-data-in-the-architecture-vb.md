---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: Mise en cache de données dans l’architecture (VB) | Microsoft Docs
author: rick-anderson
description: Dans le didacticiel précédent, nous avons appris à appliquer la mise en cache au niveau de la couche de présentation. Dans ce didacticiel, nous allons apprendre à tirer parti de notre architecte superposé...
ms.author: riande
ms.date: 05/30/2007
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: dc991a205fa7e61f604bc0f26e9b24b3faefd3d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78551008"
---
# <a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="a7984-104">Mise en cache de données dans l’architecture (VB)</span><span class="sxs-lookup"><span data-stu-id="a7984-104">Caching Data in the Architecture (VB)</span></span>

<span data-ttu-id="a7984-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a7984-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a7984-106">[Télécharger l’exemple d’application](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) ou [Télécharger le PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a7984-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="a7984-107">Dans le didacticiel précédent, nous avons appris à appliquer la mise en cache au niveau de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="a7984-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="a7984-108">Dans ce didacticiel, nous allons apprendre à tirer parti de notre architecture en couches pour mettre en cache des données au niveau de la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="a7984-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="a7984-109">Pour ce faire, nous étendons l’architecture de façon à inclure une couche de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-109">We do this by extending the architecture to include a Caching Layer.</span></span>

## <a name="introduction"></a><span data-ttu-id="a7984-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="a7984-110">Introduction</span></span>

<span data-ttu-id="a7984-111">Comme nous l’avons vu dans le didacticiel précédent, la mise en cache des données ObjectDataSource s est aussi simple que la définition de deux propriétés.</span><span class="sxs-lookup"><span data-stu-id="a7984-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="a7984-112">Malheureusement, ObjectDataSource applique la mise en cache au niveau de la couche de présentation, ce qui couple étroitement les stratégies de mise en cache à la page ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a7984-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="a7984-113">L’une des raisons justifiant la création d’une architecture en couches est de permettre la rupture de ces couplages.</span><span class="sxs-lookup"><span data-stu-id="a7984-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="a7984-114">La couche de logique métier, par exemple, dissocie la logique métier des pages ASP.NET, tandis que la couche d’accès aux données dissocie les détails d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="a7984-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="a7984-115">Ce découplage de la logique métier et des détails d’accès aux données est préféré, en partie, car il rend le système plus lisible, plus facile à gérer et plus flexible à modifier.</span><span class="sxs-lookup"><span data-stu-id="a7984-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="a7984-116">Il permet également la connaissance du domaine et la Division du travail qu’un développeur travaillant sur la couche de présentation n’a pas besoin de connaître les détails de la base de données pour effectuer son travail.</span><span class="sxs-lookup"><span data-stu-id="a7984-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="a7984-117">Le découplage de la stratégie de mise en cache de la couche présentation présente des avantages similaires.</span><span class="sxs-lookup"><span data-stu-id="a7984-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="a7984-118">Dans ce didacticiel, nous allons augmenter notre architecture pour inclure une *couche de mise en cache* (ou CL pour Short) qui utilise notre stratégie de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="a7984-119">La couche de mise en cache inclut une classe `ProductsCL` qui fournit l’accès aux informations sur les produits avec des méthodes comme `GetProducts()`, `GetProductsByCategoryID(categoryID)`, etc., qui, lorsqu’elles sont appelées, tentent d’abord de récupérer les données à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="a7984-120">Si le cache est vide, ces méthodes appellent la méthode `ProductsBLL` appropriée dans la couche BLL, qui, à son tour, obtient les données de la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="a7984-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="a7984-121">La méthode `ProductsCL` met en cache les données récupérées à partir de la couche BLL avant de la retourner.</span><span class="sxs-lookup"><span data-stu-id="a7984-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="a7984-122">Comme le montre la figure 1, le CL réside entre les couches de la présentation et de la logique métier.</span><span class="sxs-lookup"><span data-stu-id="a7984-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>

![La couche de mise en cache (CL) est une autre couche de notre architecture](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="a7984-124">**Figure 1**: la couche de mise en cache (CL) est une autre couche dans notre architecture</span><span class="sxs-lookup"><span data-stu-id="a7984-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>

## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="a7984-125">Étape 1 : création des classes de couche de mise en cache</span><span class="sxs-lookup"><span data-stu-id="a7984-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="a7984-126">Dans ce didacticiel, nous allons créer un CL très simple avec une seule classe `ProductsCL` qui n’a que quelques méthodes.</span><span class="sxs-lookup"><span data-stu-id="a7984-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="a7984-127">La création d’une couche de mise en cache complète pour l’application entière nécessiterait la création de classes `CategoriesCL`, `EmployeesCL`et `SuppliersCL`, et la fourniture d’une méthode dans ces classes de couche de mise en cache pour chaque méthode d’accès aux données ou de modification dans la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="a7984-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="a7984-128">Comme avec les couches BLL et DAL, la couche de mise en cache doit idéalement être implémentée en tant que projet de bibliothèque de classes distinct ; Toutefois, nous l’implémenterons en tant que classe dans le dossier `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="a7984-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="a7984-129">Pour séparer plus correctement les classes CL des classes DAL et BLL, créez un sous-dossier dans le dossier `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="a7984-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="a7984-130">Cliquez avec le bouton droit sur le dossier `App_Code` dans le Explorateur de solutions, choisissez nouveau dossier, puis nommez le nouveau dossier `CL`.</span><span class="sxs-lookup"><span data-stu-id="a7984-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="a7984-131">Après avoir créé ce dossier, ajoutez-y une nouvelle classe nommée `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="a7984-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>

![Ajoutez un nouveau dossier nommé CL et une classe nommée ProductsCL. vb](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="a7984-133">**Figure 2**: ajouter un nouveau dossier nommé `CL` et une classe nommée `ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="a7984-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>

<span data-ttu-id="a7984-134">La classe `ProductsCL` doit inclure le même jeu de méthodes d’accès aux données et de modification que dans sa classe de couche de logique métier correspondante (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="a7984-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="a7984-135">Au lieu de créer toutes ces méthodes, n’hésitez pas à créer un couple ici pour avoir une idée des modèles utilisés par le CL.</span><span class="sxs-lookup"><span data-stu-id="a7984-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="a7984-136">En particulier, nous allons ajouter les méthodes `GetProducts()` et `GetProductsByCategoryID(categoryID)` à l’étape 3 et une surcharge `UpdateProduct` à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="a7984-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="a7984-137">Vous pouvez ajouter les autres méthodes de `ProductsCL` et les classes `CategoriesCL`, `EmployeesCL`et `SuppliersCL` à votre convenance.</span><span class="sxs-lookup"><span data-stu-id="a7984-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="a7984-138">Étape 2 : lecture et écriture dans le cache de données</span><span class="sxs-lookup"><span data-stu-id="a7984-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="a7984-139">La fonctionnalité de mise en cache ObjectDataSource explorée dans le didacticiel précédent utilise en interne le cache de données ASP.NET pour stocker les données extraites de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="a7984-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="a7984-140">Le cache de données est également accessible par programme à partir des classes code-behind ASP.NET pages ou des classes dans l’architecture de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="a7984-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="a7984-141">Pour lire et écrire dans le cache de données à partir d’une classe code-behind de page ASP.NET, utilisez le modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="a7984-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="a7984-142">La méthode de la [classe`Cache`](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert`](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) a un nombre de surcharges.</span><span class="sxs-lookup"><span data-stu-id="a7984-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="a7984-143">`Cache("key") = value` et `Cache.Insert(key, value)` sont synonymes et les deux ajoutent un élément au cache à l’aide de la clé spécifiée sans expiration définie.</span><span class="sxs-lookup"><span data-stu-id="a7984-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="a7984-144">En règle générale, nous souhaitons spécifier un délai d’expiration lors de l’ajout d’un élément au cache, en tant que dépendance, expiration de temps ou les deux.</span><span class="sxs-lookup"><span data-stu-id="a7984-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="a7984-145">Utilisez l’une des autres surcharges de la méthode `Insert` pour fournir des informations d’expiration basées sur la dépendance ou le temps.</span><span class="sxs-lookup"><span data-stu-id="a7984-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="a7984-146">Les méthodes de la couche s de mise en cache doivent d’abord vérifier si les données demandées se trouvent dans le cache et, le cas échéant, les retourner à partir de là.</span><span class="sxs-lookup"><span data-stu-id="a7984-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="a7984-147">Si les données demandées ne se trouvent pas dans le cache, la méthode BLL appropriée doit être appelée.</span><span class="sxs-lookup"><span data-stu-id="a7984-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="a7984-148">Sa valeur de retour doit être mise en cache puis retournée, comme le montre le diagramme de séquence suivant.</span><span class="sxs-lookup"><span data-stu-id="a7984-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>

![Les méthodes de la couche de mise en cache s retournent des données du cache si elles sont disponibles](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="a7984-150">**Figure 3**: les méthodes de la couche de mise en cache retournent des données du cache si elles sont disponibles</span><span class="sxs-lookup"><span data-stu-id="a7984-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>

<span data-ttu-id="a7984-151">La séquence illustrée à la figure 3 s’effectue dans les classes CL à l’aide du modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="a7984-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="a7984-152">Ici, *type* est le type de données stockées dans le cache `Northwind.ProductsDataTable`, par exemple, la *clé* est la clé qui identifie de façon unique l’élément de cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="a7984-153">Si l’élément avec la *clé* spécifiée n’est pas dans le cache, l' *instance* est `Nothing` et les données sont récupérées à partir de la méthode BLL appropriée et ajoutées au cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="a7984-154">Au moment où `Return instance` est atteint, l' *instance* contient une référence aux données, soit à partir du cache, soit extraites de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="a7984-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="a7984-155">Veillez à utiliser le modèle ci-dessus lors de l’accès aux données à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="a7984-156">Le modèle suivant, qui, à première vue, semble équivalent, contient une différence subtile qui introduit une condition de concurrence.</span><span class="sxs-lookup"><span data-stu-id="a7984-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="a7984-157">Les conditions de concurrence sont difficiles à déboguer, car elles se révèlent sporadiques et difficiles à reproduire.</span><span class="sxs-lookup"><span data-stu-id="a7984-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="a7984-158">La différence dans cette seconde, extrait de code incorrect, est qu’au lieu de stocker une référence à l’élément mis en cache dans une variable locale, le cache de données est accessible directement dans l’instruction conditionnelle *et* dans le `Return`.</span><span class="sxs-lookup"><span data-stu-id="a7984-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="a7984-159">Imaginez que lorsque ce code est atteint, `Cache("key")` n’est pas `Nothing`, mais avant que l’instruction `Return` soit atteinte, le système supprime la *clé* du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="a7984-160">Dans ce cas rare, le code retourne `Nothing` plutôt qu’un objet du type attendu.</span><span class="sxs-lookup"><span data-stu-id="a7984-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="a7984-161">Le cache de données étant thread-safe, vous n’avez pas besoin de synchroniser l’accès du thread pour les lectures ou écritures simples.</span><span class="sxs-lookup"><span data-stu-id="a7984-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="a7984-162">Toutefois, si vous devez effectuer plusieurs opérations sur les données du cache qui doivent être atomiques, vous êtes responsable de l’implémentation d’un verrou ou d’un autre mécanisme pour garantir la sécurité des threads.</span><span class="sxs-lookup"><span data-stu-id="a7984-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="a7984-163">Pour plus d’informations, consultez [synchronisation de l’accès au Cache ASP.net](http://www.ddj.com/184406369) .</span><span class="sxs-lookup"><span data-stu-id="a7984-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>

<span data-ttu-id="a7984-164">Un élément peut être supprimé par programme du cache de données à l’aide de la [méthode`Remove`](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) comme suit :</span><span class="sxs-lookup"><span data-stu-id="a7984-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="a7984-165">Étape 3 : retour des informations sur le produit à partir de la classe`ProductsCL`</span><span class="sxs-lookup"><span data-stu-id="a7984-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="a7984-166">Pour ce didacticiel, vous allez implémenter deux méthodes pour retourner les informations sur les produits à partir de la classe `ProductsCL` : `GetProducts()` et `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="a7984-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="a7984-167">À l’instar de la classe `ProductsBL` dans la couche de logique métier, la méthode `GetProducts()` dans CL retourne des informations sur tous les produits sous la forme d’un objet `Northwind.ProductsDataTable`, tandis que `GetProductsByCategoryID(categoryID)` retourne tous les produits d’une catégorie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="a7984-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="a7984-168">Le code suivant montre une partie des méthodes de la classe `ProductsCL` :</span><span class="sxs-lookup"><span data-stu-id="a7984-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="a7984-169">Tout d’abord, notez les attributs `DataObject` et `DataObjectMethodAttribute` appliqués à la classe et aux méthodes.</span><span class="sxs-lookup"><span data-stu-id="a7984-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="a7984-170">Ces attributs fournissent des informations à l’Assistant ObjectDataSource s, indiquant quelles classes et méthodes doivent apparaître dans les étapes de l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="a7984-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="a7984-171">Étant donné que les classes et les méthodes CL sont accessibles à partir d’un ObjectDataSource dans la couche de présentation, j’ai ajouté ces attributs pour améliorer l’expérience au moment de la conception.</span><span class="sxs-lookup"><span data-stu-id="a7984-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="a7984-172">Reportez-vous au didacticiel [création d’une couche de logique métier](../introduction/creating-a-business-logic-layer-vb.md) pour obtenir une description plus complète de ces attributs et de leurs effets.</span><span class="sxs-lookup"><span data-stu-id="a7984-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="a7984-173">Dans les méthodes `GetProducts()` et `GetProductsByCategoryID(categoryID)`, les données retournées à partir de la méthode `GetCacheItem(key)` sont assignées à une variable locale.</span><span class="sxs-lookup"><span data-stu-id="a7984-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="a7984-174">La méthode `GetCacheItem(key)`, que nous examinerons bientôt, retourne un élément particulier du cache en fonction de la *clé*spécifiée.</span><span class="sxs-lookup"><span data-stu-id="a7984-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="a7984-175">Si ces données sont introuvables dans le cache, elles sont récupérées à partir de la méthode de la classe `ProductsBLL` correspondante, puis ajoutées au cache à l’aide de la méthode `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="a7984-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="a7984-176">Les méthodes `GetCacheItem(key)` et `AddCacheItem(key, value)` interface avec le cache de données, en lisant et en écrivant des valeurs, respectivement.</span><span class="sxs-lookup"><span data-stu-id="a7984-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="a7984-177">La méthode `GetCacheItem(key)` est la plus simple des deux.</span><span class="sxs-lookup"><span data-stu-id="a7984-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="a7984-178">Elle retourne simplement la valeur de la classe cache à l’aide de la *clé*passée :</span><span class="sxs-lookup"><span data-stu-id="a7984-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="a7984-179">`GetCacheItem(key)` n’utilise pas la valeur de *clé* fournie, mais appelle à la place la méthode `GetCacheKey(key)`, qui retourne la *clé* ajoutée avec ProductsCache-.</span><span class="sxs-lookup"><span data-stu-id="a7984-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="a7984-180">Le `MasterCacheKeyArray`, qui contient la chaîne ProductsCache, est également utilisé par la méthode `AddCacheItem(key, value)`, comme nous le verrons momentanément.</span><span class="sxs-lookup"><span data-stu-id="a7984-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="a7984-181">À partir d’une classe code-behind de la page ASP.NET, le cache de données est accessible à l’aide de la propriété `Page` Class s [`Cache`](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)et permet une syntaxe comme `Cache("key") = value`, comme indiqué à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="a7984-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="a7984-182">À partir d’une classe dans l’architecture, le cache de données est accessible à l’aide de `HttpRuntime.Cache` ou `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="a7984-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="a7984-183">L’entrée de blog de [Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx) [httpRuntime. cache et HttpContext. Current. cache présente](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) les légères avantages en matière de performances lors de l’utilisation de `HttpRuntime` au lieu de `HttpContext.Current`; par conséquent, `ProductsCL` utilise `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="a7984-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="a7984-184">Si votre architecture est implémentée à l’aide de projets de bibliothèque de classes, vous devrez ajouter une référence à l’assembly `System.Web` pour pouvoir utiliser les classes [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) et [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) .</span><span class="sxs-lookup"><span data-stu-id="a7984-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>

<span data-ttu-id="a7984-185">Si l’élément est introuvable dans le cache, les méthodes de la classe `ProductsCL` obtiennent les données de la couche BLL et les ajoutent au cache à l’aide de la méthode `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="a7984-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="a7984-186">Pour ajouter de la *valeur* au cache, nous pourrions utiliser le code suivant, qui utilise un délai d’expiration de 60 seconde :</span><span class="sxs-lookup"><span data-stu-id="a7984-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="a7984-187">`DateTime.Now.AddSeconds(CacheDuration)` spécifie la durée d’expiration à partir de 60 secondes dans le futur, alors que [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indique qu’il n’y a pas d’expiration décalée.</span><span class="sxs-lookup"><span data-stu-id="a7984-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="a7984-188">Bien que cette `Insert` surcharge de méthode ait des paramètres d’entrée pour une expiration absolue et décalée, vous ne pouvez fournir qu’une seule des deux.</span><span class="sxs-lookup"><span data-stu-id="a7984-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="a7984-189">Si vous tentez de spécifier à la fois une heure absolue et un intervalle de temps, la méthode `Insert` lèvera une exception `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="a7984-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="a7984-190">Cette implémentation de la méthode `AddCacheItem(key, value)` présente actuellement des lacunes.</span><span class="sxs-lookup"><span data-stu-id="a7984-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="a7984-191">Nous allons résoudre ces problèmes à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="a7984-191">We'll address and overcome these issues in Step 4.</span></span>

## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="a7984-192">Étape 4 : invalidation du cache lorsque les données sont modifiées via l’architecture</span><span class="sxs-lookup"><span data-stu-id="a7984-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="a7984-193">Outre les méthodes de récupération des données, la couche de mise en cache doit fournir les mêmes méthodes que la couche BLL pour l’insertion, la mise à jour et la suppression des données.</span><span class="sxs-lookup"><span data-stu-id="a7984-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="a7984-194">Les méthodes de modification des données CL ne modifient pas les données mises en cache, mais appellent plutôt la méthode de modification de données BLL s correspondante, puis invalident le cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="a7984-195">Comme nous l’avons vu dans le didacticiel précédent, il s’agit du même comportement que l’ObjectDataSource s’applique lorsque ses fonctionnalités de mise en cache sont activées et que ses méthodes `Insert`, `Update`ou `Delete` sont appelées.</span><span class="sxs-lookup"><span data-stu-id="a7984-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="a7984-196">La surcharge de `UpdateProduct` suivante montre comment implémenter les méthodes de modification des données dans le CL :</span><span class="sxs-lookup"><span data-stu-id="a7984-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="a7984-197">La méthode de couche de logique métier de modification de données appropriée est appelée, mais avant que sa réponse soit renvoyée, nous devons invalider le cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="a7984-198">Malheureusement, l’invalidation du cache n’est pas simple, car les méthodes de `ProductsCL` classe s `GetProducts()` et de `GetProductsByCategoryID(categoryID)` ajoutent des éléments au cache avec des clés différentes, et la méthode `GetProductsByCategoryID(categoryID)` ajoute un élément de cache différent pour chaque *CategoryID*unique.</span><span class="sxs-lookup"><span data-stu-id="a7984-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="a7984-199">Lors de l’invalidation du cache, nous devons supprimer *tous* les éléments qui ont pu être ajoutés par la classe `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="a7984-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="a7984-200">Pour ce faire, vous pouvez associer une *dépendance de cache* à chaque élément ajouté au cache dans la méthode `AddCacheItem(key, value)`.</span><span class="sxs-lookup"><span data-stu-id="a7984-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="a7984-201">En général, une dépendance de cache peut être un autre élément dans le cache, un fichier sur le système de fichiers ou des données d’une base de données Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a7984-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="a7984-202">Lorsque la dépendance change ou est supprimée du cache, les éléments du cache auquel elle est associée sont supprimés automatiquement du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="a7984-203">Pour ce didacticiel, nous voulons créer un élément supplémentaire dans le cache qui sert de dépendance de cache pour tous les éléments ajoutés via la classe `ProductsCL`.</span><span class="sxs-lookup"><span data-stu-id="a7984-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="a7984-204">De cette façon, tous ces éléments peuvent être supprimés du cache en supprimant simplement la dépendance du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="a7984-205">Nous allons mettre à jour la méthode `AddCacheItem(key, value)` pour que chaque élément ajouté au cache par le biais de cette méthode soit associé à une seule dépendance de cache :</span><span class="sxs-lookup"><span data-stu-id="a7984-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="a7984-206">`MasterCacheKeyArray` est un tableau de chaînes qui contient une valeur unique, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="a7984-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="a7984-207">Tout d’abord, un élément de cache est ajouté au cache et affecté la date et l’heure actuelles.</span><span class="sxs-lookup"><span data-stu-id="a7984-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="a7984-208">Si l’élément de cache existe déjà, il est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="a7984-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="a7984-209">Une dépendance de cache est ensuite créée.</span><span class="sxs-lookup"><span data-stu-id="a7984-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="a7984-210">Le constructeur de la [classe`CacheDependency`](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) a un nombre de surcharges, mais celui qui est utilisé ici attend deux entrées de tableau `String`.</span><span class="sxs-lookup"><span data-stu-id="a7984-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="a7984-211">La première spécifie le jeu de fichiers à utiliser comme dépendances.</span><span class="sxs-lookup"><span data-stu-id="a7984-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="a7984-212">Étant donné que nous ne souhaitons pas utiliser de dépendances basées sur des fichiers, la valeur `Nothing` est utilisée pour le premier paramètre d’entrée.</span><span class="sxs-lookup"><span data-stu-id="a7984-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="a7984-213">Le deuxième paramètre d’entrée spécifie le jeu de clés de cache à utiliser comme dépendances.</span><span class="sxs-lookup"><span data-stu-id="a7984-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="a7984-214">Ici, nous spécifions notre seule dépendance, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="a7984-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="a7984-215">La `CacheDependency` est ensuite transmise à la méthode `Insert`.</span><span class="sxs-lookup"><span data-stu-id="a7984-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="a7984-216">Une fois cette modification apportée à `AddCacheItem(key, value)`, l’invalidation du cache est aussi simple que la suppression de la dépendance.</span><span class="sxs-lookup"><span data-stu-id="a7984-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>

[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="a7984-217">Étape 5 : appel de la couche de mise en cache à partir de la couche de présentation</span><span class="sxs-lookup"><span data-stu-id="a7984-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="a7984-218">Les classes et les méthodes de la couche de mise en cache peuvent être utilisées pour travailler avec des données à l’aide des techniques que nous avons examinées dans ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="a7984-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="a7984-219">Pour illustrer l’utilisation des données mises en cache, enregistrez vos modifications dans la classe `ProductsCL`, puis ouvrez la page `FromTheArchitecture.aspx` dans le dossier `Caching` et ajoutez un contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="a7984-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="a7984-220">À partir de la balise active GridView s, créez un nouvel ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="a7984-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="a7984-221">Dans la première étape de l’Assistant, vous devriez voir la classe `ProductsCL` comme l’une des options de la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="a7984-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>

<span data-ttu-id="a7984-222">[![la classe ProductsCL est incluse dans la liste déroulante des objets métier](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a7984-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="a7984-223">**Figure 4**: la classe `ProductsCL` est incluse dans la liste déroulante objet métier ([cliquez pour afficher l’image en taille réelle](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a7984-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>

<span data-ttu-id="a7984-224">Après avoir sélectionné `ProductsCL`, cliquez sur suivant.</span><span class="sxs-lookup"><span data-stu-id="a7984-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="a7984-225">La liste déroulante de l’onglet sélectionner comporte deux éléments : `GetProducts()` et `GetProductsByCategoryID(categoryID)` et l’onglet mettre à jour a la seule surcharge de `UpdateProduct`.</span><span class="sxs-lookup"><span data-stu-id="a7984-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="a7984-226">Choisissez la méthode `GetProducts()` dans l’onglet sélectionner et la méthode `UpdateProducts` sous l’onglet mettre à jour, puis cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="a7984-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>

<span data-ttu-id="a7984-227">[![les méthodes de la classe ProductsCL s sont répertoriées dans les listes déroulantes](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a7984-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="a7984-228">**Figure 5**: les méthodes de la classe `ProductsCL` s sont répertoriées dans les listes déroulantes ([cliquez pour afficher l’image en taille réelle](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a7984-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>

<span data-ttu-id="a7984-229">Une fois l’Assistant terminé, Visual Studio définit la propriété ObjectDataSource s `OldValuesParameterFormatString` sur `original_{0}` et ajoute les champs appropriés au GridView.</span><span class="sxs-lookup"><span data-stu-id="a7984-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="a7984-230">Remplacez la valeur par défaut de la propriété `OldValuesParameterFormatString`, `{0}`et configurez le contrôle GridView pour prendre en charge la pagination, le tri et la modification.</span><span class="sxs-lookup"><span data-stu-id="a7984-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="a7984-231">Étant donné que la surcharge `UploadProducts` utilisée par le CL accepte uniquement le nom et le prix du produit modifié, limitez le GridView afin que seuls ces champs soient modifiables.</span><span class="sxs-lookup"><span data-stu-id="a7984-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="a7984-232">Dans le didacticiel précédent, nous avons défini un GridView pour inclure des champs pour les champs `ProductName`, `CategoryName`et `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="a7984-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="a7984-233">N’hésitez pas à répliquer cette mise en forme et cette structure. dans ce cas, vos balises déclaratives GridView et ObjectDataSource doivent ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="a7984-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="a7984-234">À ce stade, nous disposons d’une page qui utilise la couche de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="a7984-235">Pour voir le cache en action, définissez des points d’arrêt dans la `ProductsCL` classe s `GetProducts()` et `UpdateProduct` méthodes.</span><span class="sxs-lookup"><span data-stu-id="a7984-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="a7984-236">Accédez à la page dans un navigateur et parcourez le code lors du tri et de la pagination pour voir les données extraites du cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="a7984-237">Ensuite, mettez à jour un enregistrement et notez que le cache est invalidé et, par conséquent, il est récupéré de la couche BLL lorsque les données sont reliées au contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="a7984-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="a7984-238">La couche de mise en cache fournie dans le téléchargement accompagnant cet article n’est pas complète.</span><span class="sxs-lookup"><span data-stu-id="a7984-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="a7984-239">Il ne contient qu’une seule classe, `ProductsCL`, qui arbore uniquement un petit nombre de méthodes.</span><span class="sxs-lookup"><span data-stu-id="a7984-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="a7984-240">En outre, une seule page ASP.NET utilise la CL (`~/Caching/FromTheArchitecture.aspx`). toutes les autres font toujours référence à la couche BLL directement.</span><span class="sxs-lookup"><span data-stu-id="a7984-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="a7984-241">Si vous envisagez d’utiliser un CL dans votre application, tous les appels de la couche de présentation doivent accéder à la CL, ce qui nécessiterait que les classes et méthodes CL décrivaient ces classes et méthodes dans la couche BLL actuellement utilisée par la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="a7984-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>

## <a name="summary"></a><span data-ttu-id="a7984-242">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="a7984-242">Summary</span></span>

<span data-ttu-id="a7984-243">Si la mise en cache peut être appliquée au niveau de la couche de présentation avec les contrôles SqlDataSource et ObjectDataSource de ASP.NET 2,0 s, les responsabilités de mise en cache dans l’idéal sont déléguées à une couche distincte dans l’architecture.</span><span class="sxs-lookup"><span data-stu-id="a7984-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="a7984-244">Dans ce didacticiel, nous avons créé une couche de mise en cache qui réside entre la couche de présentation et la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="a7984-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="a7984-245">La couche de mise en cache doit fournir le même ensemble de classes et de méthodes qui existent dans la couche BLL et sont appelées à partir de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="a7984-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="a7984-246">Les exemples de couche de mise en cache que nous avons explorés dans cet exemple et les didacticiels précédents présentent le *chargement réactif*.</span><span class="sxs-lookup"><span data-stu-id="a7984-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="a7984-247">Avec le chargement réactif, les données sont chargées dans le cache uniquement lorsqu’une demande de données est effectuée et que des données sont manquantes dans le cache.</span><span class="sxs-lookup"><span data-stu-id="a7984-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="a7984-248">Les données peuvent également être *chargées de manière proactive* dans le cache, une technique qui charge les données dans le cache avant qu’elles ne soient réellement nécessaires.</span><span class="sxs-lookup"><span data-stu-id="a7984-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="a7984-249">Dans le didacticiel suivant, nous verrons un exemple de chargement proactif lorsque nous examinerons comment stocker des valeurs statiques dans le cache au démarrage de l’application.</span><span class="sxs-lookup"><span data-stu-id="a7984-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="a7984-250">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="a7984-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a7984-251">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="a7984-251">About the Author</span></span>

<span data-ttu-id="a7984-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept livres ASP/ASP. net et fondateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec des technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="a7984-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a7984-253">Scott travaille en tant que consultant, formateur et auteur indépendant.</span><span class="sxs-lookup"><span data-stu-id="a7984-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a7984-254">Son dernier livre est [*Sams vous apprend vous-même ASP.NET 2,0 en 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a7984-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a7984-255">Il peut être contacté à [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a7984-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a7984-256">ou via son blog, qui se trouve sur [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a7984-256">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a7984-257">Remerciements à</span><span class="sxs-lookup"><span data-stu-id="a7984-257">Special Thanks To</span></span>

<span data-ttu-id="a7984-258">Cette série de didacticiels a été examinée par de nombreux réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="a7984-258">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a7984-259">Le réviseur de leads pour ce didacticiel était Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="a7984-259">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="a7984-260">Vous souhaitez revoir mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="a7984-260">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a7984-261">Si c’est le cas, insérez une ligne sur [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a7984-261">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a7984-262">[Précédent](caching-data-with-the-objectdatasource-vb.md)
> [Suivant](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a7984-262">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
