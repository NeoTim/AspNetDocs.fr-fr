---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
title: Validation et paiement avec PayPal | Microsoft Docs
author: Erikre
description: Cette série de didacticiels vous apprend les bases de la création d’une application ASP.NET Web Forms à l’aide de ASP.NET 4,5 et Microsoft Visual Studio Express 2013 pour nous...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 664ec95e-b0c9-4f43-a39f-798d0f2a7e08
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
msc.type: authoredcontent
ms.openlocfilehash: 62d00a86c6c5845fb894896df65002c7086d039f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74615149"
---
# <a name="checkout-and-payment-with-paypal"></a><span data-ttu-id="016d1-103">Commande et paiement avec PayPal</span><span class="sxs-lookup"><span data-stu-id="016d1-103">Checkout and Payment with PayPal</span></span>

<span data-ttu-id="016d1-104">par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="016d1-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="016d1-105">[Télécharger l’exemple de projet WingtipC#Toys ()](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [Télécharger le livre électronique (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="016d1-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="016d1-106">Cette série de didacticiels vous apprend les bases de la création d’une application ASP.NET Web Forms à l’aide de ASP.NET 4,5 et Microsoft Visual Studio Express 2013 pour le Web.</span><span class="sxs-lookup"><span data-stu-id="016d1-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="016d1-107">Un [projet Visual Studio 2013 avec C# le code source](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) est disponible pour accompagner cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="016d1-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="016d1-108">Ce didacticiel explique comment modifier l’exemple d’application Wingtip Toys pour inclure l’autorisation de l’utilisateur, l’inscription et le paiement à l’aide de PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-108">This tutorial describes how to modify the Wingtip Toys sample application to include user authorization, registration, and payment using PayPal.</span></span> <span data-ttu-id="016d1-109">Seuls les utilisateurs qui sont connectés auront l’autorisation d’acheter des produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-109">Only users who are logged in will have authorization to purchase products.</span></span> <span data-ttu-id="016d1-110">La fonctionnalité d’inscription des utilisateurs intégrée du modèle de projet ASP.NET 4,5 Web Forms contient déjà la plupart des éléments dont vous avez besoin.</span><span class="sxs-lookup"><span data-stu-id="016d1-110">The ASP.NET 4.5 Web Forms project template's built-in user registration functionality already includes much of what you need.</span></span> <span data-ttu-id="016d1-111">Vous allez ajouter la fonctionnalité de validation PayPal Express.</span><span class="sxs-lookup"><span data-stu-id="016d1-111">You will add PayPal Express Checkout functionality.</span></span> <span data-ttu-id="016d1-112">Dans ce didacticiel, vous allez utiliser l’environnement de test de développeur PayPal, afin de ne pas transférer de fonds réels.</span><span class="sxs-lookup"><span data-stu-id="016d1-112">In this tutorial you be using the PayPal developer testing environment, so no actual funds will be transferred.</span></span> <span data-ttu-id="016d1-113">À la fin du didacticiel, vous allez tester l’application en sélectionnant les produits à ajouter au panier, en cliquant sur le bouton Checkout et en transférant les données vers le site Web de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-113">At the end of the tutorial, you will test the application by selecting products to add to the shopping cart, clicking the checkout button, and transferring data to the PayPal testing web site.</span></span> <span data-ttu-id="016d1-114">Sur le site Web de test PayPal, vous allez confirmer vos informations d’expédition et de paiement, puis revenir à l’exemple d’application local Wingtip Toys pour confirmer et terminer l’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-114">On the PayPal testing web site, you will confirm your shipping and payment information and then return to the local Wingtip Toys sample application to confirm and complete the purchase.</span></span>

<span data-ttu-id="016d1-115">Plusieurs processeurs de paiement tiers expérimentés sont spécialisés dans les achats en ligne qui répondent à l’évolutivité et à la sécurité.</span><span class="sxs-lookup"><span data-stu-id="016d1-115">There are several experienced third-party payment processors that specialize in online shopping that address scalability and security.</span></span> <span data-ttu-id="016d1-116">Les développeurs ASP.NET doivent prendre en compte les avantages de l’utilisation d’une solution de paiement tierce avant d’implémenter une solution d’achat et d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-116">ASP.NET developers should consider the advantages of utilizing a third party payment solution before implementing a shopping and purchasing solution.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="016d1-117">L’exemple d’application Wingtip Toys a été conçu pour illustrer des concepts et des fonctionnalités ASP.NET spécifiques disponibles pour les développeurs Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="016d1-117">The Wingtip Toys sample application was designed to shown specific ASP.NET concepts and features available to ASP.NET web developers.</span></span> <span data-ttu-id="016d1-118">Cet exemple d’application n’a pas été optimisé pour toutes les circonstances possibles en ce qui concerne l’évolutivité et la sécurité.</span><span class="sxs-lookup"><span data-stu-id="016d1-118">This sample application was not optimized for all possible circumstances in regard to scalability and security.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="016d1-119">Ce que vous allez apprendre :</span><span class="sxs-lookup"><span data-stu-id="016d1-119">What you'll learn:</span></span>

- <span data-ttu-id="016d1-120">Comment restreindre l’accès à des pages spécifiques dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="016d1-120">How to restrict access to specific pages in a folder.</span></span>
- <span data-ttu-id="016d1-121">Comment créer un panier d’achat connu à partir d’un panier d’achat anonyme.</span><span class="sxs-lookup"><span data-stu-id="016d1-121">How to create a known shopping cart from an anonymous shopping cart.</span></span>
- <span data-ttu-id="016d1-122">Comment activer SSL pour le projet.</span><span class="sxs-lookup"><span data-stu-id="016d1-122">How to enable SSL for the project.</span></span>
- <span data-ttu-id="016d1-123">Comment ajouter un fournisseur OAuth au projet.</span><span class="sxs-lookup"><span data-stu-id="016d1-123">How to add an OAuth provider to the project.</span></span>
- <span data-ttu-id="016d1-124">Comment utiliser PayPal pour acheter des produits à l’aide de l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-124">How to use PayPal to purchase products using the PayPal testing environment.</span></span>
- <span data-ttu-id="016d1-125">Comment afficher les détails d’un compte PayPal dans un contrôle **DetailsView** .</span><span class="sxs-lookup"><span data-stu-id="016d1-125">How to display details from PayPal in a **DetailsView** control.</span></span>
- <span data-ttu-id="016d1-126">Comment mettre à jour la base de données de l’application Wingtip Toys avec les détails obtenus à partir de PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-126">How to update the database of the Wingtip Toys application with details obtained from PayPal.</span></span>

## <a name="adding-order-tracking"></a><span data-ttu-id="016d1-127">Ajout du suivi des commandes</span><span class="sxs-lookup"><span data-stu-id="016d1-127">Adding Order Tracking</span></span>

<span data-ttu-id="016d1-128">Dans ce didacticiel, vous allez créer deux nouvelles classes pour suivre les données de la commande qu’un utilisateur a créée.</span><span class="sxs-lookup"><span data-stu-id="016d1-128">In this tutorial, you'll create two new classes to track data from the order a user has created.</span></span> <span data-ttu-id="016d1-129">Les classes effectuent le suivi des données relatives aux informations d’expédition, au total des achats et à la confirmation du paiement.</span><span class="sxs-lookup"><span data-stu-id="016d1-129">The classes will track data regarding shipping information, purchase total, and payment confirmation.</span></span>

### <a name="add-the-order-and-orderdetail-model-classes"></a><span data-ttu-id="016d1-130">Ajouter les classes de modèle Order et OrderDetail</span><span class="sxs-lookup"><span data-stu-id="016d1-130">Add the Order and OrderDetail Model Classes</span></span>

<span data-ttu-id="016d1-131">Plus haut dans cette série de didacticiels, vous avez défini le schéma pour les catégories, les produits et les éléments de panier d’achat en créant les classes `Category`, `Product`et `CartItem` dans le dossier *modèles* .</span><span class="sxs-lookup"><span data-stu-id="016d1-131">Earlier in this tutorial series, you defined the schema for categories, products, and shopping cart items by creating the `Category`, `Product`, and `CartItem` classes in the *Models* folder.</span></span> <span data-ttu-id="016d1-132">À présent, vous allez ajouter deux nouvelles classes pour définir le schéma de l’ordre des produits et les détails de la commande.</span><span class="sxs-lookup"><span data-stu-id="016d1-132">Now you will add two new classes to define the schema for the product order and the details of the order.</span></span>

1. <span data-ttu-id="016d1-133">Dans le dossier **Models** , ajoutez une nouvelle classe nommée *Order.cs*.</span><span class="sxs-lookup"><span data-stu-id="016d1-133">In the **Models** folder, add a new class named *Order.cs*.</span></span>   
   <span data-ttu-id="016d1-134">Le nouveau fichier de classe s’affiche dans l’éditeur.</span><span class="sxs-lookup"><span data-stu-id="016d1-134">The new class file is displayed in the editor.</span></span>
2. <span data-ttu-id="016d1-135">Remplacez le code par défaut par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-135">Replace the default code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample1.cs)]
3. <span data-ttu-id="016d1-136">Ajoutez une classe *OrderDetail.cs* au dossier *Models* .</span><span class="sxs-lookup"><span data-stu-id="016d1-136">Add an *OrderDetail.cs* class to the *Models* folder.</span></span>
4. <span data-ttu-id="016d1-137">Remplacez le code par défaut par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-137">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample2.cs)]

<span data-ttu-id="016d1-138">Les classes `Order` et `OrderDetail` contiennent le schéma permettant de définir les informations de commande utilisées pour l’achat et l’expédition.</span><span class="sxs-lookup"><span data-stu-id="016d1-138">The `Order` and `OrderDetail` classes contain the schema to define the order information used for purchasing and shipping.</span></span>

<span data-ttu-id="016d1-139">En outre, vous devrez mettre à jour la classe de contexte de base de données qui gère les classes d’entité et qui fournit l’accès aux données à la base de données.</span><span class="sxs-lookup"><span data-stu-id="016d1-139">In addition, you will need to update the database context class that manages the entity classes and that provides data access to the database.</span></span> <span data-ttu-id="016d1-140">Pour ce faire, vous allez ajouter la commande et `OrderDetail` classes de modèle nouvellement créées à `ProductContext` classe.</span><span class="sxs-lookup"><span data-stu-id="016d1-140">To do this, you will add the newly created Order and `OrderDetail` model classes to `ProductContext` class.</span></span>

1. <span data-ttu-id="016d1-141">Dans **Explorateur de solutions**, recherchez et ouvrez le fichier *ProductContext.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-141">In **Solution Explorer**, find and open the *ProductContext.cs* file.</span></span>
2. <span data-ttu-id="016d1-142">Ajoutez le code en surbrillance au fichier *ProductContext.cs* comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="016d1-142">Add the highlighted code to the *ProductContext.cs* file as shown below:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample3.cs?highlight=14-15)]

<span data-ttu-id="016d1-143">Comme mentionné précédemment dans cette série de didacticiels, le code du fichier *ProductContext.cs* ajoute l’espace de noms `System.Data.Entity` afin que vous ayez accès à toutes les fonctionnalités principales du Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="016d1-143">As mentioned previously in this tutorial series, the code in the *ProductContext.cs* file adds the `System.Data.Entity` namespace so that you have access to all the core functionality of the Entity Framework.</span></span> <span data-ttu-id="016d1-144">Cette fonctionnalité offre la possibilité d’interroger, d’insérer, de mettre à jour et de supprimer des données en utilisant des objets fortement typés.</span><span class="sxs-lookup"><span data-stu-id="016d1-144">This functionality includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span> <span data-ttu-id="016d1-145">Le code ci-dessus dans la classe `ProductContext` ajoute Entity Framework accès aux classes `Order` et `OrderDetail` récemment ajoutées.</span><span class="sxs-lookup"><span data-stu-id="016d1-145">The above code in the `ProductContext` class adds Entity Framework access to the newly added `Order` and `OrderDetail` classes.</span></span>

## <a name="adding-checkout-access"></a><span data-ttu-id="016d1-146">Ajout d’un accès d’extraction</span><span class="sxs-lookup"><span data-stu-id="016d1-146">Adding Checkout Access</span></span>

<span data-ttu-id="016d1-147">L’exemple d’application Wingtip Toys permet aux utilisateurs anonymes d’examiner et d’ajouter des produits à un panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-147">The Wingtip Toys sample application allows anonymous users to review and add products to a shopping cart.</span></span> <span data-ttu-id="016d1-148">Toutefois, lorsque des utilisateurs anonymes choisissent d’acheter les produits qu’ils ont ajoutés au panier d’achat, ils doivent se connecter au site.</span><span class="sxs-lookup"><span data-stu-id="016d1-148">However, when anonymous users choose to purchase the products they added to the shopping cart, they must log on to the site.</span></span> <span data-ttu-id="016d1-149">Une fois qu’ils sont connectés, ils peuvent accéder aux pages réservées de l’application Web qui gèrent l’extraction et le processus d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-149">Once they have logged on, they can access the restricted pages of the Web application that handle the checkout and purchase process.</span></span> <span data-ttu-id="016d1-150">Ces pages restreintes sont contenues dans le dossier d' *extraction* de l’application.</span><span class="sxs-lookup"><span data-stu-id="016d1-150">These restricted pages are contained in the *Checkout* folder of the application.</span></span>

### <a name="add-a-checkout-folder-and-pages"></a><span data-ttu-id="016d1-151">Ajouter un dossier et des pages d’extraction</span><span class="sxs-lookup"><span data-stu-id="016d1-151">Add a Checkout Folder and Pages</span></span>

<span data-ttu-id="016d1-152">Vous allez maintenant créer le dossier d' *extraction* et les pages qu’il verra dans le processus de validation.</span><span class="sxs-lookup"><span data-stu-id="016d1-152">You will now create the *Checkout* folder and the pages in it that the customer will see during the checkout process.</span></span> <span data-ttu-id="016d1-153">Vous allez mettre à jour ces pages plus loin dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-153">You will update these pages later in this tutorial.</span></span>

1. <span data-ttu-id="016d1-154">Cliquez avec le bouton droit sur le nom du projet (**Wingtip Toys**) dans **Explorateur de solutions** , puis sélectionnez **Ajouter un nouveau dossier**.</span><span class="sxs-lookup"><span data-stu-id="016d1-154">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add a New Folder**.</span></span> 

    ![Valider et payer avec PayPal-nouveau dossier](checkout-and-payment-with-paypal/_static/image1.png)
2. <span data-ttu-id="016d1-156">Nommez l' *extraction*du nouveau dossier.</span><span class="sxs-lookup"><span data-stu-id="016d1-156">Name the new folder *Checkout*.</span></span>
3. <span data-ttu-id="016d1-157">Cliquez avec le bouton droit sur le dossier d' *extraction* , puis sélectionnez **Ajouter**-&gt;**nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="016d1-157">Right-click the *Checkout* folder and then select **Add**-&gt;**New Item**.</span></span> 

    ![Valider et payer avec PayPal-nouvel élément](checkout-and-payment-with-paypal/_static/image2.png)
4. <span data-ttu-id="016d1-159">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-159">The **Add New Item** dialog box is displayed.</span></span>
5. <span data-ttu-id="016d1-160">Sélectionnez le **groupe C# Visual** -&gt; des modèles **Web** sur la gauche.</span><span class="sxs-lookup"><span data-stu-id="016d1-160">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="016d1-161">Ensuite, dans le volet central, sélectionnez **Web Form avec page maître**et nommez-le *CheckoutStart. aspx*.</span><span class="sxs-lookup"><span data-stu-id="016d1-161">Then, from the middle pane, select **Web Form with Master Page**and name it *CheckoutStart.aspx*.</span></span> 

    ![Récupération et paiement avec PayPal-boîte de dialogue Ajouter un nouvel élément](checkout-and-payment-with-paypal/_static/image3.png)
6. <span data-ttu-id="016d1-163">Comme précédemment, sélectionnez le fichier *site. Master* comme page maître.</span><span class="sxs-lookup"><span data-stu-id="016d1-163">As before, select the *Site.Master* file as the master page.</span></span>
7. <span data-ttu-id="016d1-164">Ajoutez les pages supplémentaires suivantes au dossier *Checkout* en procédant de la même façon que ci-dessus :</span><span class="sxs-lookup"><span data-stu-id="016d1-164">Add the following additional pages to the *Checkout* folder using the same steps above:</span></span>   

    - <span data-ttu-id="016d1-165">CheckoutReview. aspx</span><span class="sxs-lookup"><span data-stu-id="016d1-165">CheckoutReview.aspx</span></span>
    - <span data-ttu-id="016d1-166">CheckoutComplete. aspx</span><span class="sxs-lookup"><span data-stu-id="016d1-166">CheckoutComplete.aspx</span></span>
    - <span data-ttu-id="016d1-167">CheckoutCancel. aspx</span><span class="sxs-lookup"><span data-stu-id="016d1-167">CheckoutCancel.aspx</span></span>
    - <span data-ttu-id="016d1-168">CheckoutError. aspx</span><span class="sxs-lookup"><span data-stu-id="016d1-168">CheckoutError.aspx</span></span>

### <a name="add-a-webconfig-file"></a><span data-ttu-id="016d1-169">Ajouter un fichier Web. config</span><span class="sxs-lookup"><span data-stu-id="016d1-169">Add a Web.config File</span></span>

<span data-ttu-id="016d1-170">En ajoutant un nouveau fichier *Web. config* au dossier d' *extraction* , vous pourrez restreindre l’accès à toutes les pages contenues dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="016d1-170">By adding a new *Web.config* file to the *Checkout* folder, you will be able to restrict access to all the pages contained in the folder.</span></span>

1. <span data-ttu-id="016d1-171">Cliquez avec le bouton droit sur le dossier *Checkout* , puis sélectionnez **Ajouter** -&gt; **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="016d1-171">Right-click the *Checkout* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="016d1-172">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-172">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="016d1-173">Sélectionnez le **groupe C# Visual** -&gt; des modèles **Web** sur la gauche.</span><span class="sxs-lookup"><span data-stu-id="016d1-173">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="016d1-174">Ensuite, dans le volet central, sélectionnez **fichier de configuration Web**, acceptez le nom par défaut de *Web. config*, puis sélectionnez **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="016d1-174">Then, from the middle pane, select **Web Configuration File**, accept the default name of *Web.config*, and then select **Add**.</span></span>
3. <span data-ttu-id="016d1-175">Remplacez le contenu XML existant dans le fichier *Web. config* par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-175">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample4.xml)]
4. <span data-ttu-id="016d1-176">Enregistrez le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="016d1-176">Save the *Web.config* file.</span></span>

<span data-ttu-id="016d1-177">Le fichier *Web. config* spécifie que tous les utilisateurs inconnus de l’application Web doivent se voir refuser l’accès aux pages contenues dans le dossier d' *extraction* .</span><span class="sxs-lookup"><span data-stu-id="016d1-177">The *Web.config* file specifies that all unknown users of the Web application must be denied access to the pages contained in the *Checkout* folder.</span></span> <span data-ttu-id="016d1-178">Toutefois, si l’utilisateur a inscrit un compte et qu’il a ouvert une session, il s’agit d’un utilisateur connu qui aura accès aux pages du dossier d' *extraction* .</span><span class="sxs-lookup"><span data-stu-id="016d1-178">However, if the user has registered an account and is logged on, they will be a known user and will have access to the pages in the *Checkout* folder.</span></span>

<span data-ttu-id="016d1-179">Il est important de noter que la configuration ASP.NET suit une hiérarchie, où chaque fichier *Web. config* applique des paramètres de configuration au dossier dans lequel il se trouve et à tous les répertoires enfants situés sous celui-ci.</span><span class="sxs-lookup"><span data-stu-id="016d1-179">It's important to note that ASP.NET configuration follows a hierarchy, where each *Web.config* file applies configuration settings to the folder that it is in and to all of the child directories below it.</span></span>

<a id="SSLWebForms"></a>
## <a name="enable-ssl-for-the-project"></a><span data-ttu-id="016d1-180">Activer SSL pour le projet</span><span class="sxs-lookup"><span data-stu-id="016d1-180">Enable SSL for the Project</span></span>

 <span data-ttu-id="016d1-181">Protocole SSL (SSL) est un protocole défini pour permettre aux serveurs Web et aux clients Web de communiquer plus en toute sécurité via l’utilisation du chiffrement.</span><span class="sxs-lookup"><span data-stu-id="016d1-181">Secure Sockets Layer (SSL) is a protocol defined to allow Web servers and Web clients to communicate more securely through the use of encryption.</span></span> <span data-ttu-id="016d1-182">Lorsque SSL n’est pas utilisé, les données envoyées entre le client et le serveur sont ouvertes à la détection de paquets par quiconque disposant d’un accès physique au réseau.</span><span class="sxs-lookup"><span data-stu-id="016d1-182">When SSL is not used, data sent between the client and server is open to packet sniffing by anyone with physical access to the network.</span></span> <span data-ttu-id="016d1-183">En outre, plusieurs schémas d’authentification courants ne sont pas sécurisés via un HTTP simple.</span><span class="sxs-lookup"><span data-stu-id="016d1-183">Additionally, several common authentication schemes are not secure over plain HTTP.</span></span> <span data-ttu-id="016d1-184">En particulier, l’authentification de base et l’authentification par formulaire envoient des informations d’identification non chiffrées.</span><span class="sxs-lookup"><span data-stu-id="016d1-184">In particular, Basic authentication and forms authentication send unencrypted credentials.</span></span> <span data-ttu-id="016d1-185">Pour être sécurisés, ces schémas d’authentification doivent utiliser SSL.</span><span class="sxs-lookup"><span data-stu-id="016d1-185">To be secure, these authentication schemes must use SSL.</span></span> 

1. <span data-ttu-id="016d1-186">Dans **Explorateur de solutions**, cliquez sur le projet **WingtipToys** , puis appuyez sur **F4** pour afficher la fenêtre **Propriétés** .</span><span class="sxs-lookup"><span data-stu-id="016d1-186">In **Solution Explorer**, click the **WingtipToys** project, then press **F4** to display the **Properties** window.</span></span>
2. <span data-ttu-id="016d1-187">Remplacez **SSL activé** par `true`.</span><span class="sxs-lookup"><span data-stu-id="016d1-187">Change **SSL Enabled** to `true`.</span></span>
3. <span data-ttu-id="016d1-188">Copiez l' **URL SSL** afin de pouvoir l’utiliser ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="016d1-188">Copy the **SSL URL** so you can use it later.</span></span>   
 <span data-ttu-id="016d1-189">L’URL SSL sera `https://localhost:44300/`, sauf si vous avez déjà créé des sites Web SSL (comme indiqué ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="016d1-189">The SSL URL will be `https://localhost:44300/` unless you've previously created SSL Web Sites (as shown below).</span></span>   
    <span data-ttu-id="016d1-190">![Propriétés de projet](checkout-and-payment-with-paypal/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-190">![Project Properties](checkout-and-payment-with-paypal/_static/image4.png)</span></span>
4. <span data-ttu-id="016d1-191">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet **WingtipToys** , puis cliquez sur **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="016d1-191">In **Solution Explorer**, right click the **WingtipToys** project and click **Properties**.</span></span>
5. <span data-ttu-id="016d1-192">Dans l’onglet de gauche, cliquez sur **Web**.</span><span class="sxs-lookup"><span data-stu-id="016d1-192">In the left tab, click **Web**.</span></span>
6. <span data-ttu-id="016d1-193">Modifiez l' **URL du projet** pour utiliser l' **URL SSL** que vous avez enregistrée précédemment.</span><span class="sxs-lookup"><span data-stu-id="016d1-193">Change the **Project Url** to use the **SSL URL** that you saved earlier.</span></span>   
    <span data-ttu-id="016d1-194">![les propriétés Web du projet](checkout-and-payment-with-paypal/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-194">![Project Web Properties](checkout-and-payment-with-paypal/_static/image5.png)</span></span>
7. <span data-ttu-id="016d1-195">Enregistrez la page en appuyant sur **CTRL + S**.</span><span class="sxs-lookup"><span data-stu-id="016d1-195">Save the page by pressing **CTRL+S**.</span></span>
8. <span data-ttu-id="016d1-196">Appuyez sur **Ctrl+F5** pour exécuter l’application.</span><span class="sxs-lookup"><span data-stu-id="016d1-196">Press **Ctrl+F5** to run the application.</span></span> <span data-ttu-id="016d1-197">Visual Studio affiche une option qui vous permet d’éviter les avertissements SSL.</span><span class="sxs-lookup"><span data-stu-id="016d1-197">Visual Studio will display an option to allow you to avoid SSL warnings.</span></span>
9. <span data-ttu-id="016d1-198">Cliquez sur **Oui** pour approuver le certificat SSL IIS Express et continuer.</span><span class="sxs-lookup"><span data-stu-id="016d1-198">Click **Yes** to trust the IIS Express SSL certificate and continue.</span></span>   
    <span data-ttu-id="016d1-199">![IIS Express les détails du certificat SSL](checkout-and-payment-with-paypal/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-199">![IIS Express SSL certificate details](checkout-and-payment-with-paypal/_static/image6.png)</span></span>  
 <span data-ttu-id="016d1-200">Un avertissement de sécurité s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-200">A Security Warning is displayed.</span></span>
10. <span data-ttu-id="016d1-201">Cliquez sur **Oui** pour installer le certificat sur votre localhost.</span><span class="sxs-lookup"><span data-stu-id="016d1-201">Click **Yes** to install the certificate to your localhost.</span></span>   
    <span data-ttu-id="016d1-202">![boîte de dialogue Avertissement de sécurité](checkout-and-payment-with-paypal/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-202">![Security Warning dialog box](checkout-and-payment-with-paypal/_static/image7.png)</span></span>  
 <span data-ttu-id="016d1-203">La fenêtre du navigateur s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-203">The browser window will be displayed.</span></span>

<span data-ttu-id="016d1-204">Vous pouvez maintenant tester facilement votre application Web localement à l’aide de SSL.</span><span class="sxs-lookup"><span data-stu-id="016d1-204">You can now easily test your Web application locally using SSL.</span></span>

<a id="OAuthWebForms"></a>
## <a name="add-an-oauth-20-provider"></a><span data-ttu-id="016d1-205">Ajouter un fournisseur OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="016d1-205">Add an OAuth 2.0 Provider</span></span>

<span data-ttu-id="016d1-206">ASP.NET Web Forms fournit des options améliorées pour l’appartenance et l’authentification.</span><span class="sxs-lookup"><span data-stu-id="016d1-206">ASP.NET Web Forms provides enhanced options for membership and authentication.</span></span> <span data-ttu-id="016d1-207">Ces améliorations incluent OAuth.</span><span class="sxs-lookup"><span data-stu-id="016d1-207">These enhancements include OAuth.</span></span> <span data-ttu-id="016d1-208">OAuth est un protocole ouvert qui permet une autorisation sécurisée dans une méthode simple et standard à partir d’applications Web, mobiles et de bureau.</span><span class="sxs-lookup"><span data-stu-id="016d1-208">OAuth is an open protocol that allows secure authorization in a simple and standard method from web, mobile, and desktop applications.</span></span> <span data-ttu-id="016d1-209">Le modèle de Web Forms ASP.NET utilise OAuth pour exposer Facebook, Twitter, Google et Microsoft en tant que fournisseurs d’authentification.</span><span class="sxs-lookup"><span data-stu-id="016d1-209">The ASP.NET Web Forms template uses OAuth to expose Facebook, Twitter, Google and Microsoft as authentication providers.</span></span> <span data-ttu-id="016d1-210">Bien que ce didacticiel utilise uniquement Google comme fournisseur d’authentification, vous pouvez facilement modifier le code pour utiliser l’un des fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="016d1-210">Although this tutorial uses only Google as the authentication provider, you can easily modify the code to use any of the providers.</span></span> <span data-ttu-id="016d1-211">Les étapes à suivre pour implémenter d’autres fournisseurs sont très similaires à celles que vous verrez dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-211">The steps to implement other providers are very similar to the steps you will see in this tutorial.</span></span>

<span data-ttu-id="016d1-212">Outre l’authentification, le didacticiel utilise également des rôles pour implémenter l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="016d1-212">In addition to authentication, the tutorial will also use roles to implement authorization.</span></span> <span data-ttu-id="016d1-213">Seuls les utilisateurs que vous ajoutez au rôle `canEdit` seront en mesure de modifier les données (créer, modifier ou supprimer des contacts).</span><span class="sxs-lookup"><span data-stu-id="016d1-213">Only those users you add to the `canEdit` role will be able to change data (create, edit, or delete contacts).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="016d1-214">Les applications Windows Live acceptent uniquement une URL dynamique pour un site Web de travail. vous ne pouvez donc pas utiliser une URL de site Web locale pour tester les connexions.</span><span class="sxs-lookup"><span data-stu-id="016d1-214">Windows Live applications only accept a live URL for a working website, so you cannot use a local website URL for testing logins.</span></span>

<span data-ttu-id="016d1-215">Les étapes suivantes vous permettront d’ajouter un fournisseur d’authentification Google.</span><span class="sxs-lookup"><span data-stu-id="016d1-215">The following steps will allow you to add a Google authentication provider.</span></span>

1. <span data-ttu-id="016d1-216">Ouvrez le fichier *App\_Start\Startup.auth.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-216">Open the *App\_Start\Startup.Auth.cs* file.</span></span>
2. <span data-ttu-id="016d1-217">Supprimez les caractères de commentaire de la méthode `app.UseGoogleAuthentication()` pour que la méthode apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-217">Remove the comment characters from the `app.UseGoogleAuthentication()` method so that the method appears as follows:</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample5.cs)]
3. <span data-ttu-id="016d1-218">Accédez à la [console des développeurs Google](https://console.developers.google.com/).</span><span class="sxs-lookup"><span data-stu-id="016d1-218">Navigate to the [Google Developers Console](https://console.developers.google.com/).</span></span> <span data-ttu-id="016d1-219">Vous devrez également vous connecter avec votre compte de messagerie Google Developer (gmail.com).</span><span class="sxs-lookup"><span data-stu-id="016d1-219">You will also need to sign-in with your Google developer email account (gmail.com).</span></span> <span data-ttu-id="016d1-220">Si vous n’avez pas de compte Google, sélectionnez le lien **créer un compte** .</span><span class="sxs-lookup"><span data-stu-id="016d1-220">If you do not have a Google account, select the **Create an account** link.</span></span>   
   <span data-ttu-id="016d1-221">Vous verrez ensuite la **console des développeurs Google**.</span><span class="sxs-lookup"><span data-stu-id="016d1-221">Next, you'll see the **Google Developers Console**.</span></span>   
    <span data-ttu-id="016d1-222">![](checkout-and-payment-with-paypal/_static/image8.png) de la console des développeurs Google</span><span class="sxs-lookup"><span data-stu-id="016d1-222">![Google Developers Console](checkout-and-payment-with-paypal/_static/image8.png)</span></span>
4. <span data-ttu-id="016d1-223">Cliquez sur le bouton **créer un projet** et entrez un nom de projet et un ID (vous pouvez utiliser les valeurs par défaut).</span><span class="sxs-lookup"><span data-stu-id="016d1-223">Click the **Create Project** button and enter a project name and ID (you can use the default values).</span></span> <span data-ttu-id="016d1-224">Ensuite, cliquez sur la **case à cocher accord** et sur le bouton **créer** .</span><span class="sxs-lookup"><span data-stu-id="016d1-224">Then, click the **agreement checkbox** and the **Create** button.</span></span>  

    ![Google-nouveau projet](checkout-and-payment-with-paypal/_static/image9.png)

   <span data-ttu-id="016d1-226">En quelques secondes, le nouveau projet sera créé et votre navigateur affichera la page nouveaux projets.</span><span class="sxs-lookup"><span data-stu-id="016d1-226">In a few seconds the new project will be created and your browser will display the new projects page.</span></span>
5. <span data-ttu-id="016d1-227">Dans l’onglet de gauche, cliquez sur **api &amp; auth**, puis cliquez sur **informations d’identification**.</span><span class="sxs-lookup"><span data-stu-id="016d1-227">In the left tab, click **APIs &amp; auth**, and then click **Credentials**.</span></span>
6. <span data-ttu-id="016d1-228">Cliquez sur **créer un nouvel ID client** sous **OAuth**.</span><span class="sxs-lookup"><span data-stu-id="016d1-228">Click the **Create New Client ID** under **OAuth**.</span></span>   
   <span data-ttu-id="016d1-229">La boîte de dialogue **créer un ID client** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-229">The **Create Client ID** dialog will be displayed.</span></span>   
    <span data-ttu-id="016d1-230">![Google-Create client ID](checkout-and-payment-with-paypal/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-230">![Google - Create Client ID](checkout-and-payment-with-paypal/_static/image10.png)</span></span>
7. <span data-ttu-id="016d1-231">Dans la boîte de dialogue **créer un ID client** , conservez l' **application Web** par défaut pour le type d’application.</span><span class="sxs-lookup"><span data-stu-id="016d1-231">In the **Create Client ID** dialog, keep the default **Web application** for the application type.</span></span>
8. <span data-ttu-id="016d1-232">Définissez les **origines de JavaScript autorisées** sur l’URL SSL que vous avez utilisée précédemment dans ce didacticiel (`https://localhost:44300/`, sauf si vous avez créé d’autres projets SSL).</span><span class="sxs-lookup"><span data-stu-id="016d1-232">Set the **Authorized JavaScript Origins** to the SSL URL you used earlier in this tutorial (`https://localhost:44300/` unless you've created other SSL projects).</span></span>   
   <span data-ttu-id="016d1-233">Cette URL est l’origine de votre application.</span><span class="sxs-lookup"><span data-stu-id="016d1-233">This URL is the origin for your application.</span></span> <span data-ttu-id="016d1-234">Pour cet exemple, vous allez uniquement entrer l’URL du test localhost.</span><span class="sxs-lookup"><span data-stu-id="016d1-234">For this sample, you will only enter the localhost test URL.</span></span> <span data-ttu-id="016d1-235">Toutefois, vous pouvez entrer plusieurs URL pour tenir compte de localhost et de production.</span><span class="sxs-lookup"><span data-stu-id="016d1-235">However, you can enter multiple URLs to account for localhost and production.</span></span>
9. <span data-ttu-id="016d1-236">Définissez l' **URI de redirection autorisée** sur ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-236">Set the **Authorized Redirect URI** to the following:</span></span> 

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample6.html)]

   <span data-ttu-id="016d1-237">Cette valeur correspond à l’URI utilisé par les utilisateurs OAuth ASP.NET pour communiquer avec le serveur de Google OAuth.</span><span class="sxs-lookup"><span data-stu-id="016d1-237">This value is the URI that ASP.NET OAuth users to communicate with the google OAuth server.</span></span> <span data-ttu-id="016d1-238">Souvenez-vous de l’URL SSL que vous avez utilisée précédemment (`https://localhost:44300/`, sauf si vous avez créé d’autres projets SSL).</span><span class="sxs-lookup"><span data-stu-id="016d1-238">Remember the SSL URL you used above (    `https://localhost:44300/` unless you've created other SSL projects).</span></span>
10. <span data-ttu-id="016d1-239">Cliquez sur le bouton **créer un ID client** .</span><span class="sxs-lookup"><span data-stu-id="016d1-239">Click the **Create Client ID** button.</span></span>
11. <span data-ttu-id="016d1-240">Dans le menu de gauche de la console des développeurs Google, cliquez sur l’élément de menu de l' **écran de consentement** , puis définissez votre adresse de messagerie et le nom de votre produit.</span><span class="sxs-lookup"><span data-stu-id="016d1-240">On the left menu of the Google Developers Console, click the **Consent screen** menu item, then set your email address and product name.</span></span> <span data-ttu-id="016d1-241">Une fois le formulaire rempli, cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="016d1-241">When you have completed the form, click **Save**.</span></span>
12. <span data-ttu-id="016d1-242">Cliquez sur l’élément de menu **API** , faites défiler la liste et cliquez sur le bouton **désactivé** en regard de **Google + API**.</span><span class="sxs-lookup"><span data-stu-id="016d1-242">Click the **APIs** menu item, scroll down and click the **off** button next to **Google+ API**.</span></span>   
    <span data-ttu-id="016d1-243">L’acceptation de cette option active l’API Google +.</span><span class="sxs-lookup"><span data-stu-id="016d1-243">Accepting this option will enable the Google+ API.</span></span>
13. <span data-ttu-id="016d1-244">Vous devez également mettre à jour le package NuGet **Microsoft. Owin** vers la version 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="016d1-244">You must also update the **Microsoft.Owin** NuGet package to version 3.0.0.</span></span>   
    <span data-ttu-id="016d1-245">Dans le menu **Outils** , sélectionnez **Gestionnaire de package NuGet** , puis sélectionnez **gérer les packages NuGet pour la solution**.</span><span class="sxs-lookup"><span data-stu-id="016d1-245">From the **Tools** menu, select **NuGet Package Manager** and then select **Manage NuGet Packages for Solution**.</span></span>  
    <span data-ttu-id="016d1-246">Dans la fenêtre **gérer les packages NuGet** , recherchez et mettez à jour le package **Microsoft. Owin** vers la version 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="016d1-246">From the **Manage NuGet Packages** window, find and update the **Microsoft.Owin** package to version 3.0.0.</span></span>
14. <span data-ttu-id="016d1-247">Dans Visual Studio, mettez à jour la méthode `UseGoogleAuthentication` de la page *Startup.auth.cs* en copiant et en collant l' **ID client** et la **clé secrète client** dans la méthode.</span><span class="sxs-lookup"><span data-stu-id="016d1-247">In Visual Studio, update the `UseGoogleAuthentication` method of the *Startup.Auth.cs* page by copying and pasting the **Client ID** and **Client Secret** into the method.</span></span> <span data-ttu-id="016d1-248">Les valeurs **ID client** et **clé secrète client** présentées ci-dessous sont des exemples et ne fonctionnent pas.</span><span class="sxs-lookup"><span data-stu-id="016d1-248">The **Client ID** and **Client Secret** values shown below are samples and will not work.</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample7.cs?highlight=64-65)]
15. <span data-ttu-id="016d1-249">Appuyez sur **CTRL + F5** pour générer et exécuter l’application.</span><span class="sxs-lookup"><span data-stu-id="016d1-249">Press **CTRL+F5** to build and run the application.</span></span> <span data-ttu-id="016d1-250">Cliquez sur le lien **se connecter** .</span><span class="sxs-lookup"><span data-stu-id="016d1-250">Click the **Log in** link.</span></span>
16. <span data-ttu-id="016d1-251">Sous **utiliser un autre service pour se connecter**, cliquez sur **Google**.</span><span class="sxs-lookup"><span data-stu-id="016d1-251">Under **Use another service to log in**, click **Google**.</span></span>  
    <span data-ttu-id="016d1-252">Connectez-vous ![](checkout-and-payment-with-paypal/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-252">![Log in](checkout-and-payment-with-paypal/_static/image11.png)</span></span>
17. <span data-ttu-id="016d1-253">Si vous devez entrer vos informations d’identification, vous êtes redirigé vers le site Google sur lequel vous allez entrer vos informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="016d1-253">If you need to enter your credentials, you will be redirected to the google site where you will enter your credentials.</span></span>  
    ![Google-se connecter](checkout-and-payment-with-paypal/_static/image12.png)
18. <span data-ttu-id="016d1-255">Une fois que vous avez entré vos informations d’identification, vous êtes invité à accorder des autorisations d’accès à l’application Web que vous venez de créer.</span><span class="sxs-lookup"><span data-stu-id="016d1-255">After you enter your credentials, you will be prompted to give permissions to the web application you just created.</span></span>  
    ![Compte de service par défaut du projet](checkout-and-payment-with-paypal/_static/image13.png)
19. <span data-ttu-id="016d1-257">Cliquez sur **accepter**.</span><span class="sxs-lookup"><span data-stu-id="016d1-257">Click **Accept**.</span></span> <span data-ttu-id="016d1-258">Vous êtes alors redirigé vers la page de **Registre** de l’application **WingtipToys** dans laquelle vous pouvez inscrire votre compte Google.</span><span class="sxs-lookup"><span data-stu-id="016d1-258">You will now be redirected back to the **Register** page of the **WingtipToys** application where you can register your Google account.</span></span>  
    <span data-ttu-id="016d1-259">![vous inscrire auprès de votre compte Google](checkout-and-payment-with-paypal/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="016d1-259">![Register with your Google Account](checkout-and-payment-with-paypal/_static/image14.png)</span></span>
20. <span data-ttu-id="016d1-260">Vous avez la possibilité de modifier le nom d’enregistrement de courrier électronique local utilisé pour votre compte Gmail, mais vous souhaitez généralement conserver l’alias de messagerie par défaut (autrement dit, celui que vous avez utilisé pour l’authentification).</span><span class="sxs-lookup"><span data-stu-id="016d1-260">You have the option of changing the local email registration name used for your Gmail account, but you generally want to keep the default email alias (that is, the one you used for authentication).</span></span> <span data-ttu-id="016d1-261">Cliquez sur **se connecter** comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="016d1-261">Click **Log in** as shown above.</span></span>

### <a name="modifying-login-functionality"></a><span data-ttu-id="016d1-262">Modification de la fonctionnalité de connexion</span><span class="sxs-lookup"><span data-stu-id="016d1-262">Modifying Login Functionality</span></span>

<span data-ttu-id="016d1-263">Comme mentionné précédemment dans cette série de didacticiels, la plupart des fonctionnalités d’inscription de l’utilisateur ont été incluses dans le modèle ASP.NET Web Forms par défaut.</span><span class="sxs-lookup"><span data-stu-id="016d1-263">As previously mentioned in this tutorial series, much of the user registration functionality has been included in the ASP.NET Web Forms template by default.</span></span> <span data-ttu-id="016d1-264">À présent, vous allez modifier les pages *login. aspx* et *Register. aspx* par défaut pour appeler la méthode `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="016d1-264">Now you will modify the default *Login.aspx* and *Register.aspx* pages to call the `MigrateCart` method.</span></span> <span data-ttu-id="016d1-265">La méthode `MigrateCart` associe un utilisateur qui vient d’être connecté à un panier d’achat anonyme.</span><span class="sxs-lookup"><span data-stu-id="016d1-265">The `MigrateCart` method associates a newly logged in user with an anonymous shopping cart.</span></span> <span data-ttu-id="016d1-266">En associant l’utilisateur et le panier d’achat, l’exemple d’application Wingtip Toys peut conserver le panier d’achat de l’utilisateur entre les visites.</span><span class="sxs-lookup"><span data-stu-id="016d1-266">By associating the user and shopping cart, the Wingtip Toys sample application will be able to maintain the shopping cart of the user between visits.</span></span>

1. <span data-ttu-id="016d1-267">Dans **Explorateur de solutions**, recherchez et ouvrez le dossier *Account* .</span><span class="sxs-lookup"><span data-stu-id="016d1-267">In **Solution Explorer**, find and open the *Account* folder.</span></span>
2. <span data-ttu-id="016d1-268">Modifiez la page code-behind nommée *login.aspx.cs* pour inclure le code mis en surbrillance en jaune, afin qu’elle apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-268">Modify the code-behind page named *Login.aspx.cs* to include the code highlighted in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample8.cs?highlight=41-43)]
3. <span data-ttu-id="016d1-269">Enregistrez le fichier *login.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-269">Save the *Login.aspx.cs* file.</span></span>

<span data-ttu-id="016d1-270">Pour le moment, vous pouvez ignorer l’avertissement indiquant qu’il n’existe aucune définition pour la méthode `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="016d1-270">For now, you can ignore the warning that there is no definition for the `MigrateCart` method.</span></span> <span data-ttu-id="016d1-271">Vous l’ajouterez un peu plus tard dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-271">You will be adding it a bit later in this tutorial.</span></span>

<span data-ttu-id="016d1-272">Le fichier code-behind *login.aspx.cs* prend en charge une méthode de connexion.</span><span class="sxs-lookup"><span data-stu-id="016d1-272">The *Login.aspx.cs* code-behind file supports a LogIn method.</span></span> <span data-ttu-id="016d1-273">En examinant la page Login. aspx, vous verrez que cette page comprend un bouton « se connecter » qui, lorsque vous cliquez sur, déclenche le gestionnaire de `LogIn` sur le code-behind.</span><span class="sxs-lookup"><span data-stu-id="016d1-273">By inspecting the Login.aspx page, you'll see that this page includes a "Log in" button that when click triggers the `LogIn` handler on the code-behind.</span></span>

<span data-ttu-id="016d1-274">Lorsque la méthode `Login` sur *login.aspx.cs* est appelée, une nouvelle instance du panier d’achat nommé `usersShoppingCart` est créée.</span><span class="sxs-lookup"><span data-stu-id="016d1-274">When the `Login` method on the *Login.aspx.cs* is called, a new instance of the shopping cart named `usersShoppingCart` is created.</span></span> <span data-ttu-id="016d1-275">L’ID du panier d’achat (GUID) est récupéré et défini sur la variable `cartId`.</span><span class="sxs-lookup"><span data-stu-id="016d1-275">The ID of the shopping cart (a GUID) is retrieved and set to the `cartId` variable.</span></span> <span data-ttu-id="016d1-276">Ensuite, la méthode `MigrateCart` est appelée, passant la `cartId` et le nom de l’utilisateur connecté à cette méthode.</span><span class="sxs-lookup"><span data-stu-id="016d1-276">Then, the `MigrateCart` method is called, passing both the `cartId` and the name of the logged-in user to this method.</span></span> <span data-ttu-id="016d1-277">Lors de la migration du panier d’achat, le GUID utilisé pour identifier le panier d’achat anonyme est remplacé par le nom d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="016d1-277">When the shopping cart is migrated, the GUID used to identify the anonymous shopping cart is replaced with the user name.</span></span>

<span data-ttu-id="016d1-278">En plus de modifier le fichier code-behind *login.aspx.cs* pour migrer le panier d’achat lorsque l’utilisateur se connecte, vous devez également modifier le *fichier code-behind Register.aspx.cs* pour migrer le panier lorsque l’utilisateur crée un nouveau compte et se connecte.</span><span class="sxs-lookup"><span data-stu-id="016d1-278">In addition to modifying the *Login.aspx.cs* code-behind file to migrate the shopping cart when the user logs in, you must also modify the *Register.aspx.cs code-behind file* to migrate the shopping cart when the user creates a new account and logs in.</span></span>

1. <span data-ttu-id="016d1-279">Dans le dossier *Account* , ouvrez le fichier code-behind nommé *Register.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="016d1-279">In the *Account* folder, open the code-behind file named *Register.aspx.cs*.</span></span>
2. <span data-ttu-id="016d1-280">Modifiez le fichier code-behind en incluant le code en jaune, afin qu’il apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-280">Modify the code-behind file by including the code in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample9.cs?highlight=28-32)]
3. <span data-ttu-id="016d1-281">Enregistrez le fichier *Register.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-281">Save the *Register.aspx.cs* file.</span></span> <span data-ttu-id="016d1-282">Une fois encore, ignorez l’avertissement concernant la méthode `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="016d1-282">Once again, ignore the warning about the `MigrateCart` method.</span></span>

<span data-ttu-id="016d1-283">Notez que le code que vous avez utilisé dans le gestionnaire d’événements `CreateUser_Click` est très similaire au code que vous avez utilisé dans la méthode `LogIn`.</span><span class="sxs-lookup"><span data-stu-id="016d1-283">Notice that the code you used in the `CreateUser_Click` event handler is very similar to the code you used in the `LogIn` method.</span></span> <span data-ttu-id="016d1-284">Lorsque l’utilisateur s’inscrit ou se connecte au site, un appel à la méthode `MigrateCart` est effectué.</span><span class="sxs-lookup"><span data-stu-id="016d1-284">When the user registers or logs in to the site, a call to the `MigrateCart` method will be made.</span></span>

## <a name="migrating-the-shopping-cart"></a><span data-ttu-id="016d1-285">Migration du panier d’achat</span><span class="sxs-lookup"><span data-stu-id="016d1-285">Migrating the Shopping Cart</span></span>

<span data-ttu-id="016d1-286">Maintenant que vous avez mis à jour le processus de connexion et d’inscription, vous pouvez ajouter le code pour migrer le panier d’achat à l’aide de la méthode `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="016d1-286">Now that you have the log-in and registration process updated, you can add the code to migrate the shopping cart using the `MigrateCart` method.</span></span>

1. <span data-ttu-id="016d1-287">Dans **Explorateur de solutions**, recherchez le dossier *logique* et ouvrez le fichier de classe *ShoppingCartActions.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-287">In **Solution Explorer**, find the *Logic* folder and open the *ShoppingCartActions.cs* class file.</span></span>
2. <span data-ttu-id="016d1-288">Ajoutez le code mis en surbrillance en jaune au code existant dans le fichier *ShoppingCartActions.cs* , afin que le code du fichier *ShoppingCartActions.cs* apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-288">Add the code highlighted in yellow to the existing code in the *ShoppingCartActions.cs* file, so that the code in the *ShoppingCartActions.cs* file appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample10.cs?highlight=215-224)]

<span data-ttu-id="016d1-289">La méthode `MigrateCart` utilise le cartId existant pour rechercher le panier d’achat de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="016d1-289">The `MigrateCart` method uses the existing cartId to find the shopping cart of the user.</span></span> <span data-ttu-id="016d1-290">Ensuite, le code parcourt tous les éléments du panier d’achat et remplace la propriété `CartId` (telle que spécifiée par le schéma `CartItem`) par le nom d’utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="016d1-290">Next, the code loops through all the shopping cart items and replaces the `CartId` property (as specified by the `CartItem` schema) with the logged-in user name.</span></span>

### <a name="updating-the-database-connection"></a><span data-ttu-id="016d1-291">Mise à jour de la connexion de base de données</span><span class="sxs-lookup"><span data-stu-id="016d1-291">Updating the Database Connection</span></span>

<span data-ttu-id="016d1-292">Si vous suivez ce didacticiel à l’aide de l’exemple d’application Wingtip Toys **prédéfini** , vous devez recréer la base de données d’appartenance par défaut.</span><span class="sxs-lookup"><span data-stu-id="016d1-292">If you are following this tutorial using the **prebuilt** Wingtip Toys sample application, you must recreate the default membership database.</span></span> <span data-ttu-id="016d1-293">En modifiant la chaîne de connexion par défaut, la base de données d’appartenance sera créée lors de la prochaine exécution de l’application.</span><span class="sxs-lookup"><span data-stu-id="016d1-293">By modifying the default connection string, the membership database will be created the next time the application runs.</span></span>

1. <span data-ttu-id="016d1-294">Ouvrez le fichier *Web. config* à la racine du projet.</span><span class="sxs-lookup"><span data-stu-id="016d1-294">Open the *Web.config* file at the root of the project.</span></span>
2. <span data-ttu-id="016d1-295">Mettez à jour la chaîne de connexion par défaut afin qu’elle apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-295">Update the default connection string so that it appears as follows:</span></span>   

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample11.xml)]

<a id="PayPalWebForms"></a>
## <a name="integrating-paypal"></a><span data-ttu-id="016d1-296">Intégration de PayPal</span><span class="sxs-lookup"><span data-stu-id="016d1-296">Integrating PayPal</span></span>

<span data-ttu-id="016d1-297">PayPal est une plateforme de facturation basée sur le Web qui accepte les paiements effectués par les commerçants en ligne.</span><span class="sxs-lookup"><span data-stu-id="016d1-297">PayPal is a web-based billing platform that accepts payments by online merchants.</span></span> <span data-ttu-id="016d1-298">Ce didacticiel explique ensuite comment intégrer la fonctionnalité d’extraction Express de PayPal à votre application.</span><span class="sxs-lookup"><span data-stu-id="016d1-298">This tutorial next explains how to integrate PayPal's Express Checkout functionality into your application.</span></span> <span data-ttu-id="016d1-299">L’extraction Express permet à vos clients d’utiliser PayPal pour payer les articles qu’ils ont ajoutés à leur panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-299">Express Checkout allows your customers to use PayPal to pay for the items they have added to their shopping cart.</span></span>

### <a name="create-paypal-test-accounts"></a><span data-ttu-id="016d1-300">Créer des comptes de test PayPal</span><span class="sxs-lookup"><span data-stu-id="016d1-300">Create PayPal Test Accounts</span></span>

<span data-ttu-id="016d1-301">Pour utiliser l’environnement de test PayPal, vous devez créer et vérifier un compte de test de développeur.</span><span class="sxs-lookup"><span data-stu-id="016d1-301">To use the PayPal testing environment, you must create and verify a developer test account.</span></span> <span data-ttu-id="016d1-302">Vous allez utiliser le compte test des développeurs pour créer un compte test de l’acheteur et un compte test de vendeur.</span><span class="sxs-lookup"><span data-stu-id="016d1-302">You will use the developer test account to create a buyer test account and a seller test account.</span></span> <span data-ttu-id="016d1-303">Les informations d’identification du compte test de développeur permettront également à l’exemple d’application Wingtip Toys d’accéder à l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-303">The developer test account credentials also will allow the Wingtip Toys sample application to access the PayPal testing environment.</span></span>

1. <span data-ttu-id="016d1-304">Dans un navigateur, accédez au site de test des développeurs PayPal :</span><span class="sxs-lookup"><span data-stu-id="016d1-304">In a browser, navigate to the PayPal developer testing site:</span></span>   
    [https://developer.paypal.com](https://developer.paypal.com/)
2. <span data-ttu-id="016d1-305">Si vous n’avez pas de compte de développeur PayPal, créez un nouveau compte en cliquant sur s' **inscrire**et suivez les étapes d’inscription.</span><span class="sxs-lookup"><span data-stu-id="016d1-305">If you don't have a PayPal developer account, create a new account by clicking **Sign Up**and following the sign up steps.</span></span> <span data-ttu-id="016d1-306">Si vous disposez déjà d’un compte de développeur PayPal, connectez-vous en cliquant sur **se connecter**.</span><span class="sxs-lookup"><span data-stu-id="016d1-306">If you have an existing PayPal developer account, sign in by clicking **Log In**.</span></span> <span data-ttu-id="016d1-307">Vous aurez besoin de votre compte de développeur PayPal pour tester l’exemple d’application Wingtip Toys plus loin dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-307">You will need your PayPal developer account to test the Wingtip Toys sample application later in this tutorial.</span></span>
3. <span data-ttu-id="016d1-308">Si vous venez de vous inscrire à votre compte de développeur PayPal, vous devrez peut-être vérifier votre compte de développeur PayPal avec PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-308">If you have just signed up for your PayPal developer account, you may need to verify your PayPal developer account with PayPal.</span></span> <span data-ttu-id="016d1-309">Vous pouvez vérifier votre compte en suivant les étapes que PayPal a envoyées à votre compte de messagerie.</span><span class="sxs-lookup"><span data-stu-id="016d1-309">You can verify your account by following the steps that PayPal sent to your email account.</span></span> <span data-ttu-id="016d1-310">Une fois que vous avez vérifié votre compte de développeur PayPal, reconnectez-vous au site de test des développeurs PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-310">Once you have verified your PayPal developer account, log back into the PayPal developer testing site.</span></span>
4. <span data-ttu-id="016d1-311">Une fois que vous êtes connecté au site de développement PayPal avec votre compte de développeur PayPal, vous devez créer un compte de test PayPal Buyer si vous n’en avez pas déjà un.</span><span class="sxs-lookup"><span data-stu-id="016d1-311">After you are logged in to the PayPal developer site with your PayPal developer account you need to create a PayPal buyer test account if you don't already have one.</span></span> <span data-ttu-id="016d1-312">Pour créer un compte test de l’acheteur, sur le site PayPal, cliquez sur l’onglet **applications** , puis sur **comptes sandbox**.</span><span class="sxs-lookup"><span data-stu-id="016d1-312">To create a buyer test account, on the PayPal site click the **Applications** tab and then click **Sandbox accounts**.</span></span>   
 <span data-ttu-id="016d1-313">La page **comptes de test bac à sable (sandbox)** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-313">The **Sandbox test accounts** page is shown.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="016d1-314">Le site de développement PayPal fournit déjà un compte de test commerçant.</span><span class="sxs-lookup"><span data-stu-id="016d1-314">The PayPal Developer site already provides a merchant test account.</span></span>

    ![Validation et paiement avec les comptes de test PayPal-sandbox](checkout-and-payment-with-paypal/_static/image15.png)
5. <span data-ttu-id="016d1-316">Dans la page comptes de test sandbox, cliquez sur **créer un compte**.</span><span class="sxs-lookup"><span data-stu-id="016d1-316">On the Sandbox test accounts page, click **Create Account**.</span></span>
6. <span data-ttu-id="016d1-317">Sur la page **créer un compte de test** , choisissez un e-mail et un mot de passe de compte test de l’acheteur de votre choix.</span><span class="sxs-lookup"><span data-stu-id="016d1-317">On the **Create test account** page choose a buyer test account email and password of your choice.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="016d1-318">À la fin de ce didacticiel, vous aurez besoin des adresses e-mail et du mot de passe de l’acheteur pour tester l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-318">You will need the buyer email addresses and password to test the Wingtip Toys sample application at the end of this tutorial.</span></span>

    ![Validation et paiement avec les comptes de test PayPal-sandbox](checkout-and-payment-with-paypal/_static/image16.png)
7. <span data-ttu-id="016d1-320">Créez le compte test de l’acheteur en cliquant sur le bouton **créer un compte** .</span><span class="sxs-lookup"><span data-stu-id="016d1-320">Create the buyer test account by clicking the **Create Account** button.</span></span>  
 <span data-ttu-id="016d1-321">La page **comptes de test bac à sable (sandbox)** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-321">The **Sandbox Test accounts** page is displayed.</span></span> 

    ![Validation et paiement avec les comptes PayPal-PayPal](checkout-and-payment-with-paypal/_static/image17.png)
8. <span data-ttu-id="016d1-323">Dans la page **comptes de test sandbox** , cliquez sur le compte de messagerie **facilitateur** .</span><span class="sxs-lookup"><span data-stu-id="016d1-323">On the **Sandbox test accounts** page, click the **facilitator** email account.</span></span>  
    <span data-ttu-id="016d1-324">Les options de **Profil** et de **notification** s’affichent.</span><span class="sxs-lookup"><span data-stu-id="016d1-324">**Profile** and **Notification** options appear.</span></span>
9. <span data-ttu-id="016d1-325">Sélectionnez l’option **Profil** , puis cliquez sur **informations d’identification** de l’API pour afficher les informations d’identification de votre API pour le compte de test commerçant.</span><span class="sxs-lookup"><span data-stu-id="016d1-325">Select the **Profile** option, then click **API credentials** to view your API credentials for the merchant test account.</span></span>
10. <span data-ttu-id="016d1-326">Copiez les informations d’identification de l’API de TEST dans le bloc-notes.</span><span class="sxs-lookup"><span data-stu-id="016d1-326">Copy the TEST API credentials to notepad.</span></span>

<span data-ttu-id="016d1-327">Vous aurez besoin de vos informations d’identification d’API de TEST Classic (nom d’utilisateur, mot de passe et signature) pour effectuer des appels d’API à partir de l’exemple d’application Wingtip Toys vers l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-327">You will need your displayed Classic TEST API credentials (Username, Password, and Signature) to make API calls from the Wingtip Toys sample application to the PayPal testing environment.</span></span> <span data-ttu-id="016d1-328">Vous allez ajouter les informations d’identification à l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="016d1-328">You will add the credentials in the next step.</span></span>

### <a name="add-paypal-class-and-api-credentials"></a><span data-ttu-id="016d1-329">Ajouter la classe PayPal et les informations d’identification de l’API</span><span class="sxs-lookup"><span data-stu-id="016d1-329">Add PayPal Class and API Credentials</span></span>

<span data-ttu-id="016d1-330">Vous allez placer la majorité du code PayPal dans une seule et même classe.</span><span class="sxs-lookup"><span data-stu-id="016d1-330">You will place the majority of the PayPal code into a single class.</span></span> <span data-ttu-id="016d1-331">Cette classe contient les méthodes utilisées pour communiquer avec PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-331">This class contains the methods used to communicate with PayPal.</span></span> <span data-ttu-id="016d1-332">Vous allez également ajouter vos informations d’identification PayPal à cette classe.</span><span class="sxs-lookup"><span data-stu-id="016d1-332">Also, you will add your PayPal credentials to this class.</span></span>

1. <span data-ttu-id="016d1-333">Dans l’exemple d’application Wingtip Toys dans Visual Studio, cliquez avec le bouton droit sur le dossier **logique** , puis sélectionnez **Ajouter** -&gt; **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="016d1-333">In the Wingtip Toys sample application within Visual Studio, right-click the **Logic** folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="016d1-334">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-334">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="016d1-335">Sous **Visual C#**  dans le volet **installé** sur la gauche, sélectionnez **code**.</span><span class="sxs-lookup"><span data-stu-id="016d1-335">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span>
3. <span data-ttu-id="016d1-336">Dans le volet central, sélectionnez **classe**.</span><span class="sxs-lookup"><span data-stu-id="016d1-336">From the middle pane, select **Class**.</span></span> <span data-ttu-id="016d1-337">Nommez cette nouvelle classe **PayPalFunctions.cs**.</span><span class="sxs-lookup"><span data-stu-id="016d1-337">Name this new class **PayPalFunctions.cs**.</span></span>
4. <span data-ttu-id="016d1-338">Cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="016d1-338">Click **Add**.</span></span>  
   <span data-ttu-id="016d1-339">Le nouveau fichier de classe s’affiche dans l’éditeur.</span><span class="sxs-lookup"><span data-stu-id="016d1-339">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="016d1-340">Remplacez le code par défaut par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-340">Replace the default code with the following code:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample12.cs)]
6. <span data-ttu-id="016d1-341">Ajoutez les informations d’identification de l’API Merchant (nom d’utilisateur, mot de passe et signature) que vous avez affichées précédemment dans ce didacticiel afin de pouvoir effectuer des appels de fonction vers l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-341">Add the Merchant API credentials (Username, Password, and Signature) that you displayed earlier in this tutorial so that you can make function calls to the PayPal testing environment.</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample13.cs)]

> [!NOTE] 
> 
> <span data-ttu-id="016d1-342">Dans cet exemple d’application, vous ajoutez simplement des informations d' C# identification à un fichier (. cs).</span><span class="sxs-lookup"><span data-stu-id="016d1-342">In this sample application you are simply adding credentials to a C# file (.cs).</span></span> <span data-ttu-id="016d1-343">Toutefois, dans une solution implémentée, envisagez de chiffrer vos informations d’identification dans un fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="016d1-343">However, in a implemented solution, you should consider encrypting your credentials in a configuration file.</span></span>

<span data-ttu-id="016d1-344">La classe NVPAPICaller contient la majorité des fonctionnalités PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-344">The NVPAPICaller class contains the majority of the PayPal functionality.</span></span> <span data-ttu-id="016d1-345">Le code de la classe fournit les méthodes nécessaires pour effectuer un test d’achat à partir de l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-345">The code in the class provides the methods needed to make a test purchase from the PayPal testing environment.</span></span> <span data-ttu-id="016d1-346">Les trois fonctions PayPal suivantes sont utilisées pour effectuer des achats :</span><span class="sxs-lookup"><span data-stu-id="016d1-346">The following three PayPal functions are used to make purchases:</span></span>

- <span data-ttu-id="016d1-347">`SetExpressCheckout` fonction)</span><span class="sxs-lookup"><span data-stu-id="016d1-347">`SetExpressCheckout` function</span></span>
- <span data-ttu-id="016d1-348">`GetExpressCheckoutDetails` fonction)</span><span class="sxs-lookup"><span data-stu-id="016d1-348">`GetExpressCheckoutDetails` function</span></span>
- <span data-ttu-id="016d1-349">`DoExpressCheckoutPayment` fonction)</span><span class="sxs-lookup"><span data-stu-id="016d1-349">`DoExpressCheckoutPayment` function</span></span>

<span data-ttu-id="016d1-350">La méthode `ShortcutExpressCheckout` collecte les informations sur les achats de test et les détails du produit à partir du panier d’achat, puis appelle la fonction `SetExpressCheckout` PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-350">The `ShortcutExpressCheckout` method collects the test purchase information and product details from the shopping cart and calls the `SetExpressCheckout` PayPal function.</span></span> <span data-ttu-id="016d1-351">La méthode `GetCheckoutDetails` confirme les détails de l’achat et appelle la fonction `GetExpressCheckoutDetails` PayPal avant d’effectuer le test.</span><span class="sxs-lookup"><span data-stu-id="016d1-351">The `GetCheckoutDetails` method confirms purchase details and calls the `GetExpressCheckoutDetails` PayPal function before making the test purchase.</span></span> <span data-ttu-id="016d1-352">La méthode `DoCheckoutPayment` termine l’achat de test à partir de l’environnement de test en appelant la fonction `DoExpressCheckoutPayment` PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-352">The `DoCheckoutPayment` method completes the test purchase from the testing environment by calling the `DoExpressCheckoutPayment` PayPal function.</span></span> <span data-ttu-id="016d1-353">Le code restant prend en charge les méthodes et processus PayPal, tels que l’encodage de chaînes, le décodage de chaînes, le traitement des tableaux et la détermination des informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="016d1-353">The remaining code supports the PayPal methods and process, such as encoding strings, decoding strings, processing arrays, and determining credentials.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="016d1-354">PayPal vous permet d’inclure des informations d’achat facultatives basées sur [la spécification de l’API PayPal](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span><span class="sxs-lookup"><span data-stu-id="016d1-354">PayPal allows you to include optional purchase details based on [PayPal's API specification](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span></span> <span data-ttu-id="016d1-355">En étendant le code de l’exemple d’application Wingtip Toys, vous pouvez inclure des informations de localisation, des descriptions de produits, des taxes, un numéro de service client, ainsi que de nombreux autres champs facultatifs.</span><span class="sxs-lookup"><span data-stu-id="016d1-355">By extending the code in the Wingtip Toys sample application, you can include localization details, product descriptions, tax, a customer service number, as well as many other optional fields.</span></span>

<span data-ttu-id="016d1-356">Notez que les URL de retour et d’annulation spécifiées dans la méthode **ShortcutExpressCheckout** utilisent un numéro de port.</span><span class="sxs-lookup"><span data-stu-id="016d1-356">Notice that the return and cancel URLs that are specified in the **ShortcutExpressCheckout** method use a port number.</span></span>

[!code-html[Main](checkout-and-payment-with-paypal/samples/sample14.html)]

<span data-ttu-id="016d1-357">Lorsque Visual Web Developer exécute un projet Web à l’aide de SSL, le port 44300 est généralement utilisé pour le serveur Web.</span><span class="sxs-lookup"><span data-stu-id="016d1-357">When Visual Web Developer runs a web project using SSL, commonly the port 44300 is used for the web server.</span></span> <span data-ttu-id="016d1-358">Comme indiqué ci-dessus, le numéro de port est 44300.</span><span class="sxs-lookup"><span data-stu-id="016d1-358">As shown above, the port number is 44300.</span></span> <span data-ttu-id="016d1-359">Lorsque vous exécutez l’application, vous pouvez voir un numéro de port différent.</span><span class="sxs-lookup"><span data-stu-id="016d1-359">When you run the application, you could see a different port number.</span></span> <span data-ttu-id="016d1-360">Votre numéro de port doit être correctement défini dans le code afin que vous puissiez exécuter l’exemple d’application Wingtip Toys à la fin de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-360">Your port number needs to be correctly set in the code so that you can successful run the Wingtip Toys sample application at the end of this tutorial.</span></span> <span data-ttu-id="016d1-361">La section suivante de ce didacticiel explique comment récupérer le numéro de port de l’hôte local et mettre à jour la classe PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-361">The next section of this tutorial explains how to retrieve the local host port number and update the PayPal class.</span></span>

### <a name="update-the-localhost-port-number-in-the-paypal-class"></a><span data-ttu-id="016d1-362">Mettre à jour le numéro de port LocalHost dans la classe PayPal</span><span class="sxs-lookup"><span data-stu-id="016d1-362">Update the LocalHost Port Number in the PayPal Class</span></span>

<span data-ttu-id="016d1-363">L’exemple d’application Wingtip Toys achète des produits en accédant au site de test PayPal et en revenant à votre instance locale de l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-363">The Wingtip Toys sample application purchases products by navigating to the PayPal testing site and returning to your local instance of the Wingtip Toys sample application.</span></span> <span data-ttu-id="016d1-364">Pour que PayPal retourne à l’URL correcte, vous devez spécifier le numéro de port de l’exemple d’application en cours d’exécution dans le code PayPal mentionné ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="016d1-364">In order to have PayPal return to the correct URL, you need to specify the port number of the locally running sample application in the PayPal code mentioned above.</span></span>

1. <span data-ttu-id="016d1-365">Dans **Explorateur de solutions** , cliquez avec le bouton droit sur le nom du projet (**WingtipToys**) et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="016d1-365">Right-click the project name (**WingtipToys**) in **Solution Explorer** and select **Properties**.</span></span>
2. <span data-ttu-id="016d1-366">Dans la colonne de gauche, sélectionnez l’onglet **Web** .</span><span class="sxs-lookup"><span data-stu-id="016d1-366">In the left column, select the **Web** tab.</span></span>
3. <span data-ttu-id="016d1-367">Récupérez le numéro de port dans la zone **URL du projet** .</span><span class="sxs-lookup"><span data-stu-id="016d1-367">Retrieve the port number from the **Project Url** box.</span></span>
4. <span data-ttu-id="016d1-368">Si nécessaire, mettez à jour les `returnURL` et `cancelURL` de la classe PayPal (`NVPAPICaller`) dans le fichier *PayPalFunctions.cs* pour utiliser le numéro de port de votre application Web :</span><span class="sxs-lookup"><span data-stu-id="016d1-368">If needed, update the `returnURL` and `cancelURL` in the PayPal class (`NVPAPICaller`) in the *PayPalFunctions.cs* file to use the port number of your web application:</span></span>   

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample15.html?highlight=1-2)]

<span data-ttu-id="016d1-369">À présent, le code que vous avez ajouté correspond au port attendu pour votre application Web locale.</span><span class="sxs-lookup"><span data-stu-id="016d1-369">Now the code that you added will match the expected port for your local Web application.</span></span> <span data-ttu-id="016d1-370">PayPal sera en mesure de retourner à l’URL correcte sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="016d1-370">PayPal will be able to return to the correct URL on your local machine.</span></span>

### <a name="add-the-paypal-checkout-button"></a><span data-ttu-id="016d1-371">Ajouter le bouton PayPal Checkout</span><span class="sxs-lookup"><span data-stu-id="016d1-371">Add the PayPal Checkout Button</span></span>

<span data-ttu-id="016d1-372">Maintenant que les fonctions principales PayPal ont été ajoutées à l’exemple d’application, vous pouvez commencer à ajouter le balisage et le code nécessaires à l’appel de ces fonctions.</span><span class="sxs-lookup"><span data-stu-id="016d1-372">Now that the primary PayPal functions have been added to the sample application, you can begin adding the markup and code needed to call these functions.</span></span> <span data-ttu-id="016d1-373">Tout d’abord, vous devez ajouter le bouton d’extraction que l’utilisateur verra sur la page du panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-373">First, you must add the checkout button that the user will see on the shopping cart page.</span></span>

1. <span data-ttu-id="016d1-374">Ouvrez le fichier *ShoppingCart. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-374">Open the *ShoppingCart.aspx* file.</span></span>
2. <span data-ttu-id="016d1-375">Faites défiler le fichier jusqu’en bas et recherchez le `<!--Checkout Placeholder -->` commentaire.</span><span class="sxs-lookup"><span data-stu-id="016d1-375">Scroll to the bottom of the file and find the `<!--Checkout Placeholder -->` comment.</span></span>
3. <span data-ttu-id="016d1-376">Remplacez le commentaire par un contrôle `ImageButton` afin que le marquage soit remplacé comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-376">Replace the comment with an `ImageButton` control so that the mark up is replaced as follows:</span></span>  

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample16.aspx)]
4. <span data-ttu-id="016d1-377">Dans le fichier *ShoppingCart.aspx.cs* , après l' `UpdateBtn_Click` gestionnaire d’événements près de la fin du fichier, ajoutez le gestionnaire d’événements `CheckOutBtn_Click` :</span><span class="sxs-lookup"><span data-stu-id="016d1-377">In the *ShoppingCart.aspx.cs* file, after the `UpdateBtn_Click` event handler near the end of the file, add the `CheckOutBtn_Click` event handler:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample17.cs)]
5. <span data-ttu-id="016d1-378">Dans le fichier *ShoppingCart.aspx.cs* , ajoutez également une référence au `CheckoutBtn`, afin que le bouton New image soit référencé comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-378">Also in the *ShoppingCart.aspx.cs* file, add a reference to the `CheckoutBtn`, so that the new image button is referenced as follows:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample18.cs?highlight=18)]
6. <span data-ttu-id="016d1-379">Enregistrez les modifications apportées au fichier *ShoppingCart. aspx* et au fichier *ShoppingCart.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="016d1-379">Save your changes to both the *ShoppingCart.aspx* file and the *ShoppingCart.aspx.cs* file.</span></span>
7. <span data-ttu-id="016d1-380">Dans le menu, sélectionnez **Déboguer**-&gt;**générer WingtipToys**.</span><span class="sxs-lookup"><span data-stu-id="016d1-380">From the menu, select **Debug**-&gt;**Build WingtipToys**.</span></span>  
   <span data-ttu-id="016d1-381">Le projet sera régénéré avec le contrôle **ImageButton** qui vient d’être ajouté.</span><span class="sxs-lookup"><span data-stu-id="016d1-381">The project will be rebuilt with the newly added **ImageButton** control.</span></span>

### <a name="send-purchase-details-to-paypal"></a><span data-ttu-id="016d1-382">Envoyer les détails de l’achat à PayPal</span><span class="sxs-lookup"><span data-stu-id="016d1-382">Send Purchase Details to PayPal</span></span>

<span data-ttu-id="016d1-383">Quand l’utilisateur clique sur le bouton **Checkout** sur la page du panier d’achat (*ShoppingCart. aspx*), il commence le processus d’achat.</span><span class="sxs-lookup"><span data-stu-id="016d1-383">When the user clicks the **Checkout** button on the shopping cart page (*ShoppingCart.aspx*), they'll begin the purchase process.</span></span> <span data-ttu-id="016d1-384">Le code suivant appelle la première fonction PayPal nécessaire pour acheter des produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-384">The following code calls the first PayPal function needed to purchase products.</span></span>

1. <span data-ttu-id="016d1-385">Dans le dossier *Checkout* , ouvrez le fichier code-behind nommé *CheckoutStart.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="016d1-385">From the *Checkout* folder, open the code-behind file named *CheckoutStart.aspx.cs*.</span></span>   
   <span data-ttu-id="016d1-386">Veillez à ouvrir le fichier code-behind.</span><span class="sxs-lookup"><span data-stu-id="016d1-386">Be sure to open the code-behind file.</span></span>
2. <span data-ttu-id="016d1-387">Remplacez le code existant par le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="016d1-387">Replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample19.cs)]

<span data-ttu-id="016d1-388">Lorsque l’utilisateur de l’application clique sur le bouton **Checkout** sur la page du panier d’achat, le navigateur accède à la page *CheckoutStart. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-388">When the user of the application clicks the **Checkout** button on the shopping cart page, the browser will navigate to the *CheckoutStart.aspx* page.</span></span> <span data-ttu-id="016d1-389">Lors du chargement de la page *CheckoutStart. aspx* , la méthode `ShortcutExpressCheckout` est appelée.</span><span class="sxs-lookup"><span data-stu-id="016d1-389">When the *CheckoutStart.aspx* page loads, the `ShortcutExpressCheckout` method is called.</span></span> <span data-ttu-id="016d1-390">À ce stade, l’utilisateur est transféré vers le site Web de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-390">At this point, the user is transferred to the PayPal testing web site.</span></span> <span data-ttu-id="016d1-391">Sur le site PayPal, l’utilisateur entre ses informations d’identification PayPal, passe en revue les détails de l’achat, accepte le contrat PayPal et retourne à l’exemple d’application Wingtip Toys où se termine la méthode de `ShortcutExpressCheckout`.</span><span class="sxs-lookup"><span data-stu-id="016d1-391">On the PayPal site, the user enters their PayPal credentials, reviews the purchase details, accepts the PayPal agreement and returns to the Wingtip Toys sample application where the `ShortcutExpressCheckout` method completes.</span></span> <span data-ttu-id="016d1-392">Lorsque la méthode `ShortcutExpressCheckout` est terminée, elle redirige l’utilisateur vers la page *CheckoutReview. aspx* spécifiée dans la méthode `ShortcutExpressCheckout`.</span><span class="sxs-lookup"><span data-stu-id="016d1-392">When the `ShortcutExpressCheckout` method is complete, it will redirect the user to the *CheckoutReview.aspx* page specified in the `ShortcutExpressCheckout` method.</span></span> <span data-ttu-id="016d1-393">Cela permet à l’utilisateur de passer en revue les détails de la commande à partir de l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-393">This allows the user to review the order details from within the Wingtip Toys sample application.</span></span>

### <a name="review-order-details"></a><span data-ttu-id="016d1-394">Consulter les détails de la commande</span><span class="sxs-lookup"><span data-stu-id="016d1-394">Review Order Details</span></span>

<span data-ttu-id="016d1-395">Après avoir renvoyé à partir de PayPal, la page *CheckoutReview. aspx* de l’exemple d’application Wingtip Toys affiche les détails de la commande.</span><span class="sxs-lookup"><span data-stu-id="016d1-395">After returning from PayPal, the *CheckoutReview.aspx* page of the Wingtip Toys sample application displays the order details.</span></span> <span data-ttu-id="016d1-396">Cette page permet à l’utilisateur de passer en revue les détails de la commande avant d’acheter les produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-396">This page allows the user to review the order details before purchasing the products.</span></span> <span data-ttu-id="016d1-397">La page *CheckoutReview. aspx* doit être créée comme suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-397">The *CheckoutReview.aspx* page must be created as follows:</span></span>

1. <span data-ttu-id="016d1-398">Dans le dossier *Checkout* , ouvrez la page nommée *CheckoutReview. aspx*.</span><span class="sxs-lookup"><span data-stu-id="016d1-398">In the *Checkout* folder, open the page named *CheckoutReview.aspx*.</span></span>
2. <span data-ttu-id="016d1-399">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-399">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample20.aspx)]
3. <span data-ttu-id="016d1-400">Ouvrez la page code-behind nommée *CheckoutReview.aspx.cs* et remplacez le code existant par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-400">Open the code-behind page named *CheckoutReview.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample21.cs)]

<span data-ttu-id="016d1-401">Le contrôle **DetailsView** est utilisé pour afficher les détails des commandes qui ont été retournés par Paypal.</span><span class="sxs-lookup"><span data-stu-id="016d1-401">The **DetailsView** control is used to display the order details that have been returned from PayPal.</span></span> <span data-ttu-id="016d1-402">En outre, le code ci-dessus enregistre les détails de la commande dans la base de données Wingtip Toys sous la forme d’un objet `OrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="016d1-402">Also, the above code saves the order details to the Wingtip Toys database as an `OrderDetail` object.</span></span> <span data-ttu-id="016d1-403">Quand l’utilisateur clique sur le bouton **terminer l’ordre** , il est redirigé vers la page *CheckoutComplete. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-403">When the user clicks on the **Complete Order** button, they are redirected to the *CheckoutComplete.aspx* page.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="016d1-404">**Accélératrice**</span><span class="sxs-lookup"><span data-stu-id="016d1-404">**Tip**</span></span>
> 
> <span data-ttu-id="016d1-405">Dans le balisage de la page *CheckoutReview. aspx* , Notez que la balise `<ItemStyle>` est utilisée pour modifier le style des éléments dans le contrôle **DetailsView** près du bas de la page.</span><span class="sxs-lookup"><span data-stu-id="016d1-405">In the markup of the *CheckoutReview.aspx* page, notice that the `<ItemStyle>` tag is used to change the style of the items within the **DetailsView** control near the bottom of the page.</span></span> <span data-ttu-id="016d1-406">En affichant la page en **mode Design** (en sélectionnant **conception** dans l’angle inférieur gauche de Visual Studio), puis en sélectionnant le contrôle **DetailsView** et en sélectionnant la **balise active** (l’icône représentant une flèche en haut à droite du contrôle), vous pouvez voir les **Tâches DetailsView**.</span><span class="sxs-lookup"><span data-stu-id="016d1-406">By viewing the page in **Design View** (by selecting **Design** at the lower left corner of Visual Studio), then selecting the **DetailsView** control, and selecting the **Smart Tag** (the arrow icon at the top right of the control), you will be able to see the **DetailsView Tasks**.</span></span>
> 
> ![Valider et payer avec PayPal-modifier les champs](checkout-and-payment-with-paypal/_static/image18.png)
> 
> <span data-ttu-id="016d1-408">En sélectionnant **modifier les champs**, la boîte de dialogue **champs** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-408">By selecting **Edit Fields**, the **Fields** dialog box will appear.</span></span> <span data-ttu-id="016d1-409">Dans cette boîte de dialogue, vous pouvez facilement contrôler les propriétés visuelles, telles que **ItemStyle**, du contrôle **DetailsView** .</span><span class="sxs-lookup"><span data-stu-id="016d1-409">In this dialog box you can easily control the visual properties, such as **ItemStyle**, of the **DetailsView** control.</span></span>
> 
> ![Boîte de dialogue valider et payer avec PayPal-Fields](checkout-and-payment-with-paypal/_static/image19.png)

### <a name="complete-purchase"></a><span data-ttu-id="016d1-411">Terminer l’achat</span><span class="sxs-lookup"><span data-stu-id="016d1-411">Complete Purchase</span></span>

<span data-ttu-id="016d1-412">La page *CheckoutComplete. aspx* effectue l’achat auprès de Paypal.</span><span class="sxs-lookup"><span data-stu-id="016d1-412">*CheckoutComplete.aspx* page makes the purchase from PayPal.</span></span> <span data-ttu-id="016d1-413">Comme indiqué ci-dessus, l’utilisateur doit cliquer sur le bouton **terminer l’ordre** pour que l’application accède à la page *CheckoutComplete. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-413">As mentioned above, the user must click on the **Complete Order** button before the application will navigate to the *CheckoutComplete.aspx* page.</span></span>

1. <span data-ttu-id="016d1-414">Dans le dossier *Checkout* , ouvrez la page nommée *CheckoutComplete. aspx*.</span><span class="sxs-lookup"><span data-stu-id="016d1-414">In the *Checkout* folder, open the page named *CheckoutComplete.aspx*.</span></span>
2. <span data-ttu-id="016d1-415">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-415">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample22.aspx)]
3. <span data-ttu-id="016d1-416">Ouvrez la page code-behind nommée *CheckoutComplete.aspx.cs* et remplacez le code existant par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="016d1-416">Open the code-behind page named *CheckoutComplete.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample23.cs)]

<span data-ttu-id="016d1-417">Lorsque la page *CheckoutComplete. aspx* est chargée, la méthode `DoCheckoutPayment` est appelée.</span><span class="sxs-lookup"><span data-stu-id="016d1-417">When the *CheckoutComplete.aspx* page is loaded, the `DoCheckoutPayment` method is called.</span></span> <span data-ttu-id="016d1-418">Comme indiqué précédemment, la méthode `DoCheckoutPayment` termine l’achat à partir de l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-418">As mentioned earlier, the `DoCheckoutPayment` method completes the purchase from the PayPal testing environment.</span></span> <span data-ttu-id="016d1-419">Une fois que PayPal a terminé l’achat de la commande, la page *CheckoutComplete. aspx* affiche une transaction de paiement `ID` à l’acheteur.</span><span class="sxs-lookup"><span data-stu-id="016d1-419">Once PayPal has completed the purchase of the order, the *CheckoutComplete.aspx* page displays a payment transaction `ID` to the purchaser.</span></span>

### <a name="handle-cancel-purchase"></a><span data-ttu-id="016d1-420">Gérer annuler l’achat</span><span class="sxs-lookup"><span data-stu-id="016d1-420">Handle Cancel Purchase</span></span>

<span data-ttu-id="016d1-421">Si l’utilisateur décide d’annuler l’achat, il est dirigé vers la page *CheckoutCancel. aspx* , où il verra que son ordre a été annulé.</span><span class="sxs-lookup"><span data-stu-id="016d1-421">If the user decides to cancel the purchase, they will be directed to the *CheckoutCancel.aspx* page where they will see that their order has been cancelled.</span></span>

1. <span data-ttu-id="016d1-422">Ouvrez la page nommée *CheckoutCancel. aspx* dans le dossier *Checkout* .</span><span class="sxs-lookup"><span data-stu-id="016d1-422">Open the page named *CheckoutCancel.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="016d1-423">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-423">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample24.aspx)]

### <a name="handle-purchase-errors"></a><span data-ttu-id="016d1-424">Gérer les erreurs d’achat</span><span class="sxs-lookup"><span data-stu-id="016d1-424">Handle Purchase Errors</span></span>

<span data-ttu-id="016d1-425">Les erreurs survenues pendant le processus d’achat sont gérées par la page *CheckoutError. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-425">Errors during the purchase process will be handled by the *CheckoutError.aspx* page.</span></span> <span data-ttu-id="016d1-426">Le code-behind de la page *CheckoutStart. aspx* , la page *CheckoutReview. aspx* et la page *CheckoutComplete. aspx* redirigent chacun vers la page *CheckoutError. aspx* si une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="016d1-426">The code-behind of the *CheckoutStart.aspx* page, the *CheckoutReview.aspx* page, and the *CheckoutComplete.aspx* page will each redirect to the *CheckoutError.aspx* page if an error occurs.</span></span>

1. <span data-ttu-id="016d1-427">Ouvrez la page nommée *CheckoutError. aspx* dans le dossier *Checkout* .</span><span class="sxs-lookup"><span data-stu-id="016d1-427">Open the page named *CheckoutError.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="016d1-428">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="016d1-428">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample25.aspx)]

<span data-ttu-id="016d1-429">La page *CheckoutError. aspx* s’affiche avec les détails de l’erreur lorsqu’une erreur se produit pendant le processus d’extraction.</span><span class="sxs-lookup"><span data-stu-id="016d1-429">The *CheckoutError.aspx* page is displayed with the error details when an error occurs during the checkout process.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="016d1-430">Exécution de l'application</span><span class="sxs-lookup"><span data-stu-id="016d1-430">Running the Application</span></span>

<span data-ttu-id="016d1-431">Exécutez l’application pour voir comment acheter des produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-431">Run the application to see how to purchase products.</span></span> <span data-ttu-id="016d1-432">Notez que vous allez exécuter dans l’environnement de test PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-432">Note that you will be running in the PayPal testing environment.</span></span> <span data-ttu-id="016d1-433">Aucun argent réel n’est échangé.</span><span class="sxs-lookup"><span data-stu-id="016d1-433">No actual money is being exchanged.</span></span>

1. <span data-ttu-id="016d1-434">Assurez-vous que tous vos fichiers sont enregistrés dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="016d1-434">Make sure all your files are saved in Visual Studio.</span></span>
2. <span data-ttu-id="016d1-435">Ouvrez un navigateur Web et accédez à [https://developer.paypal.com](https://developer.paypal.com/).</span><span class="sxs-lookup"><span data-stu-id="016d1-435">Open a Web browser and navigate to [https://developer.paypal.com](https://developer.paypal.com/).</span></span>
3. <span data-ttu-id="016d1-436">Connectez-vous avec votre compte de développeur PayPal que vous avez créé précédemment dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="016d1-436">Login with your PayPal developer account that you created earlier in this tutorial.</span></span>  
   <span data-ttu-id="016d1-437">Pour le sandbox de développement PayPal, vous devez être connecté à [https://developer.paypal.com](https://developer.paypal.com/) pour tester l’extraction Express.</span><span class="sxs-lookup"><span data-stu-id="016d1-437">For PayPal's developer sandbox, you need to be logged in at [https://developer.paypal.com](https://developer.paypal.com/) to test express checkout.</span></span> <span data-ttu-id="016d1-438">Cela s’applique uniquement aux tests du bac à sable (sandbox) PayPal, et non à l’environnement Live de PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-438">This only applies to PayPal's sandbox testing, not to PayPal's live environment.</span></span>
4. <span data-ttu-id="016d1-439">Dans Visual Studio, appuyez sur **F5** pour exécuter l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-439">In Visual Studio, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="016d1-440">Une fois la base de données reconstruite, le navigateur s’ouvre et affiche la page *default. aspx* .</span><span class="sxs-lookup"><span data-stu-id="016d1-440">After the database rebuilds, the browser will open and show the *Default.aspx* page.</span></span>
5. <span data-ttu-id="016d1-441">Ajoutez trois produits différents au panier d’achat en sélectionnant la catégorie de produit, par exemple « cars », puis en cliquant sur **Ajouter au panier** en regard de chaque produit.</span><span class="sxs-lookup"><span data-stu-id="016d1-441">Add three different products to the shopping cart by selecting the product category, such as "Cars" and then clicking **Add to Cart** next to each product.</span></span>  
   <span data-ttu-id="016d1-442">Le panier affiche le produit que vous avez sélectionné.</span><span class="sxs-lookup"><span data-stu-id="016d1-442">The shopping cart will display the product you have selected.</span></span>
6. <span data-ttu-id="016d1-443">Cliquez sur le bouton **PayPal** pour valider.</span><span class="sxs-lookup"><span data-stu-id="016d1-443">Click the **PayPal** button to checkout.</span></span> 

    ![Validation et paiement avec PayPal-cart](checkout-and-payment-with-paypal/_static/image20.png)

   <span data-ttu-id="016d1-445">L’extraction nécessite que vous disposiez d’un compte d’utilisateur pour l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-445">Checking out will require that you have a user account for the Wingtip Toys sample application.</span></span>
7. <span data-ttu-id="016d1-446">Cliquez sur le lien **Google** à droite de la page pour vous connecter avec un compte de messagerie Gmail.com existant.</span><span class="sxs-lookup"><span data-stu-id="016d1-446">Click the **Google** link on the right of the page to log in with an existing gmail.com email account.</span></span>  
   <span data-ttu-id="016d1-447">Si vous n’avez pas de compte gmail.com, vous pouvez en créer un à des fins de test sur [www.gmail.com](https://www.gmail.com/).</span><span class="sxs-lookup"><span data-stu-id="016d1-447">If you do not have a gmail.com account, you can create one for testing purposes at [www.gmail.com](https://www.gmail.com/).</span></span> <span data-ttu-id="016d1-448">Vous pouvez également utiliser un compte local standard en cliquant sur « s’inscrire ».</span><span class="sxs-lookup"><span data-stu-id="016d1-448">You can also use a standard local account by clicking "Register".</span></span> 

    ![Valider et payer avec PayPal-log in](checkout-and-payment-with-paypal/_static/image21.png)
8. <span data-ttu-id="016d1-450">Connectez-vous avec votre compte et votre mot de passe Gmail.</span><span class="sxs-lookup"><span data-stu-id="016d1-450">Sign in with your gmail account and password.</span></span> 

    ![Valider et payer avec la connexion PayPal-gmail](checkout-and-payment-with-paypal/_static/image22.png)
9. <span data-ttu-id="016d1-452">Cliquez sur le bouton **se connecter** pour inscrire votre compte Gmail auprès du nom d’utilisateur de l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-452">Click the **Log in** button to register your gmail account with your Wingtip Toys sample application user name.</span></span> 

    ![Validation et paiement avec PayPal-inscrire un compte](checkout-and-payment-with-paypal/_static/image23.png)
10. <span data-ttu-id="016d1-454">Sur le site de test PayPal, ajoutez l’adresse de messagerie et le mot de passe de l' **acheteur** que vous avez créés précédemment dans ce didacticiel, puis cliquez sur le bouton **se connecter** .</span><span class="sxs-lookup"><span data-stu-id="016d1-454">On the PayPal test site, add your **buyer** email address and password that you created earlier in this tutorial, then click the **Log In** button.</span></span> 

    ![Validation et paiement avec PayPal-connexion PayPal](checkout-and-payment-with-paypal/_static/image24.png)
11. <span data-ttu-id="016d1-456">Acceptez la stratégie PayPal, puis cliquez sur le bouton **accepter et continuer** .</span><span class="sxs-lookup"><span data-stu-id="016d1-456">Agree to the PayPal policy and click the **Agree and Continue** button.</span></span>  
    <span data-ttu-id="016d1-457">Notez que cette page s’affiche uniquement la première fois que vous utilisez ce compte PayPal.</span><span class="sxs-lookup"><span data-stu-id="016d1-457">Note that this page is only displayed the first time you use this PayPal account.</span></span> <span data-ttu-id="016d1-458">Notez à nouveau qu’il s’agit d’un compte de test, aucun argent n’est échangé.</span><span class="sxs-lookup"><span data-stu-id="016d1-458">Again note that this is a test account, no real money is exchanged.</span></span> 

    ![Validation et paiement avec la stratégie PayPal-PayPal](checkout-and-payment-with-paypal/_static/image25.png)
12. <span data-ttu-id="016d1-460">Passez en revue les informations de commande sur la page de vérification de l’environnement de test PayPal, puis cliquez sur **Continuer**.</span><span class="sxs-lookup"><span data-stu-id="016d1-460">Review the order information on the PayPal testing environment review page and click **Continue**.</span></span> 

    ![Validation et paiement avec PayPal-informations de vérification](checkout-and-payment-with-paypal/_static/image26.png)
13. <span data-ttu-id="016d1-462">Sur la page *CheckoutReview. aspx* , vérifiez le montant de la commande et affichez l’adresse de livraison générée.</span><span class="sxs-lookup"><span data-stu-id="016d1-462">On the *CheckoutReview.aspx* page, verify the order amount and view the generated shipping address.</span></span> <span data-ttu-id="016d1-463">Ensuite, cliquez sur le bouton **terminer l’ordre** .</span><span class="sxs-lookup"><span data-stu-id="016d1-463">Then, click the **Complete Order** button.</span></span> 

    ![Validation et paiement avec l’évaluation de l’ordre PayPal](checkout-and-payment-with-paypal/_static/image27.png)
14. <span data-ttu-id="016d1-465">La page **CheckoutComplete. aspx** s’affiche avec un ID de transaction de paiement.</span><span class="sxs-lookup"><span data-stu-id="016d1-465">The **CheckoutComplete.aspx** page is displayed with a payment transaction ID.</span></span> 

    ![Validation et paiement avec PayPal-Checkout terminé](checkout-and-payment-with-paypal/_static/image28.png)

<a id="ReviewDBWebForms"></a>
## <a name="reviewing-the-database"></a><span data-ttu-id="016d1-467">Vérification de la base de données</span><span class="sxs-lookup"><span data-stu-id="016d1-467">Reviewing the Database</span></span>

<span data-ttu-id="016d1-468">En passant en revue les données mises à jour dans l’exemple de base de données d’application Wingtip Toys après l’exécution de l’application, vous pouvez voir que l’application a correctement enregistré l’achat des produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-468">By reviewing the updated data in the Wingtip Toys sample application database after running the application, you can see that the application successfully recorded the purchase of the products.</span></span>

<span data-ttu-id="016d1-469">Vous pouvez inspecter les données contenues dans le fichier de base de données *wingtiptoys. mdf* à l’aide de la fenêtre de **Explorateur de base de données** (**Explorateur de serveurs** fenêtre dans Visual Studio) comme vous l’avez fait précédemment dans cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="016d1-469">You can inspect the data contained in the *Wingtiptoys.mdf* database file by using the **Database Explorer** window (**Server Explorer** window in Visual Studio) as you did earlier in this tutorial series.</span></span>

1. <span data-ttu-id="016d1-470">Fermez la fenêtre du navigateur si elle est toujours ouverte.</span><span class="sxs-lookup"><span data-stu-id="016d1-470">Close the browser window if it is still open.</span></span>
2. <span data-ttu-id="016d1-471">Dans Visual Studio, sélectionnez l’icône **Afficher tous les fichiers** en haut de **Explorateur de solutions** pour vous permettre de développer le dossier de données de l' **application\_** .</span><span class="sxs-lookup"><span data-stu-id="016d1-471">In Visual Studio, select the **Show All Files** icon at the top of **Solution Explorer** to allow you to expand the **App\_Data** folder.</span></span>
3. <span data-ttu-id="016d1-472">Développez le dossier données de l' **application\_** .</span><span class="sxs-lookup"><span data-stu-id="016d1-472">Expand the **App\_Data** folder.</span></span>  
 <span data-ttu-id="016d1-473">Vous devrez peut-être sélectionner l’icône **Afficher tous les fichiers** du dossier.</span><span class="sxs-lookup"><span data-stu-id="016d1-473">You may need to select the **Show All Files** icon for the folder.</span></span>
4. <span data-ttu-id="016d1-474">Cliquez avec le bouton droit sur le fichier de base de données *wingtiptoys. mdf* , puis sélectionnez **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="016d1-474">Right-click the *Wingtiptoys.mdf* database file and select **Open**.</span></span>  
    <span data-ttu-id="016d1-475">**Explorateur de serveurs** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-475">**Server Explorer** is displayed.</span></span>
5. <span data-ttu-id="016d1-476">Développez le dossier **tables** .</span><span class="sxs-lookup"><span data-stu-id="016d1-476">Expand the **Tables** folder.</span></span>
6. <span data-ttu-id="016d1-477">Cliquez avec le bouton droit sur la table **Orders**, puis sélectionnez **afficher les données**de la table.</span><span class="sxs-lookup"><span data-stu-id="016d1-477">Right-click the **Orders**table and select **Show Table Data**.</span></span>  
 <span data-ttu-id="016d1-478">La table **Orders** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="016d1-478">The **Orders** table is displayed.</span></span>
7. <span data-ttu-id="016d1-479">Passez en revue la colonne **PaymentTransactionID** pour confirmer la réussite des transactions.</span><span class="sxs-lookup"><span data-stu-id="016d1-479">Review the **PaymentTransactionID** column to confirm successful transactions.</span></span> 

    ![Valider et payer avec la base de données de vérification PayPal](checkout-and-payment-with-paypal/_static/image29.png)
8. <span data-ttu-id="016d1-481">Fermez la fenêtre table **Orders** .</span><span class="sxs-lookup"><span data-stu-id="016d1-481">Close the **Orders** table window.</span></span>
9. <span data-ttu-id="016d1-482">Dans la Explorateur de serveurs, cliquez avec le bouton droit sur la table **OrderDetails** et sélectionnez **afficher les données**de la table.</span><span class="sxs-lookup"><span data-stu-id="016d1-482">In the Server Explorer, right-click the **OrderDetails** table and select **Show Table Data**.</span></span>
10. <span data-ttu-id="016d1-483">Passez en revue les valeurs `OrderId` et `Username` dans la table **OrderDetails** .</span><span class="sxs-lookup"><span data-stu-id="016d1-483">Review the `OrderId` and `Username` values in the **OrderDetails** table.</span></span> <span data-ttu-id="016d1-484">Notez que ces valeurs correspondent aux valeurs `OrderId` et `Username` incluses dans la table **Orders** .</span><span class="sxs-lookup"><span data-stu-id="016d1-484">Note that these values match the `OrderId` and `Username` values included in the **Orders** table.</span></span>
11. <span data-ttu-id="016d1-485">Fermez la fenêtre table **OrderDetails** .</span><span class="sxs-lookup"><span data-stu-id="016d1-485">Close the **OrderDetails** table window.</span></span>
12. <span data-ttu-id="016d1-486">Cliquez avec le bouton droit sur le fichier de base de données Wingtip Toys (*wingtiptoys. mdf*), puis sélectionnez **Fermer la connexion**.</span><span class="sxs-lookup"><span data-stu-id="016d1-486">Right-click the Wingtip Toys database file (*Wingtiptoys.mdf*) and select **Close Connection**.</span></span>
13. <span data-ttu-id="016d1-487">Si vous ne voyez pas la fenêtre de **Explorateur de solutions** , cliquez sur **Explorateur de solutions** en bas de la fenêtre de **Explorateur de serveurs** pour afficher à nouveau le **Explorateur de solutions** .</span><span class="sxs-lookup"><span data-stu-id="016d1-487">If you do not see the **Solution Explorer** window, click **Solution Explorer** at the bottom of the **Server Explorer** window to show the **Solution Explorer** again.</span></span>

## <a name="summary"></a><span data-ttu-id="016d1-488">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="016d1-488">Summary</span></span>

<span data-ttu-id="016d1-489">Dans ce didacticiel, vous avez ajouté des schémas de commande et de détail de commande pour effectuer le suivi de l’achat de produits.</span><span class="sxs-lookup"><span data-stu-id="016d1-489">In this tutorial you added order and order detail schemas to track the purchase of products.</span></span> <span data-ttu-id="016d1-490">Vous avez également intégré la fonctionnalité PayPal à l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="016d1-490">You also integrated PayPal functionality into the Wingtip Toys sample application.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="016d1-491">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="016d1-491">Additional Resources</span></span>

<span data-ttu-id="016d1-492">[Présentation de la configuration ASP.NET](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="016d1-492">[ASP.NET Configuration Overview](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="016d1-493">Déployer une application ASP.NET Web Forms sécurisée avec appartenance, OAuth et SQL Database à Azure App Service</span><span class="sxs-lookup"><span data-stu-id="016d1-493">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="016d1-494">Microsoft Azure-essai gratuit</span><span class="sxs-lookup"><span data-stu-id="016d1-494">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

## <a name="disclaimer"></a><span data-ttu-id="016d1-495">Exclusion de responsabilité</span><span class="sxs-lookup"><span data-stu-id="016d1-495">Disclaimer</span></span>

<span data-ttu-id="016d1-496">Ce didacticiel contient un exemple de code.</span><span class="sxs-lookup"><span data-stu-id="016d1-496">This tutorial contains sample code.</span></span> <span data-ttu-id="016d1-497">Ces exemples de code sont fournis « en l’État » sans garantie d’aucune sorte.</span><span class="sxs-lookup"><span data-stu-id="016d1-497">Such sample code is provided "as is" without warranty of any kind.</span></span> <span data-ttu-id="016d1-498">En conséquence, Microsoft ne garantit pas la précision, l’intégrité ou la qualité de l’exemple de code.</span><span class="sxs-lookup"><span data-stu-id="016d1-498">Accordingly, Microsoft does not guarantee the accuracy, integrity, or quality of the sample code.</span></span> <span data-ttu-id="016d1-499">Vous acceptez d’utiliser l’exemple de code à vos propres risques.</span><span class="sxs-lookup"><span data-stu-id="016d1-499">You agree to use the sample code at your own risk.</span></span> <span data-ttu-id="016d1-500">En aucun cas, Microsoft ne pourra être tenu responsable d’un exemple de code, de contenu, y compris mais non limité à, d’erreurs ou d’omissions dans un exemple de code, de contenu ou de toute perte ou détérioration d’un type résultant de l’utilisation d’un exemple de code.</span><span class="sxs-lookup"><span data-stu-id="016d1-500">Under no circumstances will Microsoft be liable to you in any way for any sample code, content, including but not limited to, any errors or omissions in any sample code, content, or any loss or damage of any kind incurred as a result of the use of any sample code.</span></span> <span data-ttu-id="016d1-501">Vous en êtes informé et vous acceptez d’indemniser, d’enregistrer et de détenir les personnes qui ne sont pas inoffensives de toute perte, réclamation de perte, blessure ou dommage de quelque nature que ce soit, y compris, sans limitation, celles provoquées par le matériel que vous publiez, transmettez, utilisez ou recourez à, mais sans s’y limiter, les vues qui y sont exprimées.</span><span class="sxs-lookup"><span data-stu-id="016d1-501">You are hereby notified and do hereby agree to indemnify, save and hold Microsoft harmless from and against any and all loss, claims of loss, injury or damage of any kind including, without limitation, those occasioned by or arising from material that you post, transmit, use or rely on including, but not limited to, the views expressed therein.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="016d1-502">[Précédent](shopping-cart.md)
> [Suivant](membership-and-administration.md)</span><span class="sxs-lookup"><span data-stu-id="016d1-502">[Previous](shopping-cart.md)
[Next](membership-and-administration.md)</span></span>
