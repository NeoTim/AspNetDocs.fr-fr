---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
title: Créer la couche Data Access | Microsoft Docs
author: Erikre
description: Cette série de didacticiels vous apprend les notions de base de la création d’une application Web Forms ASP.NET à l’aide de ASP.NET 4.5 et Microsoft Visual Studio Express 2013 pour nous...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 0bbf7a6e-d7eb-4091-91e4-fff892777f32
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/create_the_data_access_layer
msc.type: authoredcontent
ms.openlocfilehash: 61a9dae22efed9cb7e8957a8c131396cbdeea3c9
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131353"
---
# <a name="create-the-data-access-layer"></a><span data-ttu-id="ed9c3-103">Créer la couche d’accès aux données</span><span class="sxs-lookup"><span data-stu-id="ed9c3-103">Create the Data Access Layer</span></span>

<span data-ttu-id="ed9c3-104">par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="ed9c3-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="ed9c3-105">[Télécharger le projet de Wingtip Toys exemple (c#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [télécharger l’E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="ed9c3-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="ed9c3-106">Cette série de didacticiels vous apprend les notions de base de la création d’une application Web Forms ASP.NET à l’aide de ASP.NET 4.5 et Microsoft Visual Studio Express 2013 pour le Web.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="ed9c3-107">Un Visual Studio 2013 [projet avec du code source c#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) est disponible pour accompagner cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="ed9c3-108">Ce didacticiel explique comment créer, accéder à et passez en revue les données à partir d’une base de données à l’aide de Web Forms ASP.NET et Entity Framework Code First.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-108">This tutorial describes how to create, access, and review data from a database using ASP.NET Web Forms and Entity Framework Code First.</span></span> <span data-ttu-id="ed9c3-109">Ce didacticiel s’appuie sur le didacticiel précédent, « Créer le projet » et fait partie de la série de didacticiels Wingtip Toys Store.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-109">This tutorial builds on the previous tutorial "Create the Project" and is part of the Wingtip Toy Store tutorial series.</span></span> <span data-ttu-id="ed9c3-110">Lorsque vous avez terminé ce didacticiel, vous aurez créé un groupe de classes d’accès aux données qui se trouvent dans le *modèles* dossier du projet.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-110">When you've completed this tutorial, you will have built a group of data-access classes that are in the *Models* folder of the project.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="ed9c3-111">Ce que vous allez apprendre :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-111">What you'll learn:</span></span>

- <span data-ttu-id="ed9c3-112">Comment créer les modèles de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-112">How to create the data models.</span></span>
- <span data-ttu-id="ed9c3-113">Comment initialiser et amorcer la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-113">How to initialize and seed the database.</span></span>
- <span data-ttu-id="ed9c3-114">Comment mettre à jour et configurer l’application pour prendre en charge de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-114">How to update and configure the application to support the database.</span></span>

### <a name="these-are-the-features-introduced-in-the-tutorial"></a><span data-ttu-id="ed9c3-115">Voici les fonctionnalités introduites dans le didacticiel :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-115">These are the features introduced in the tutorial:</span></span>

- <span data-ttu-id="ed9c3-116">Entity Framework Code First</span><span class="sxs-lookup"><span data-stu-id="ed9c3-116">Entity Framework Code First</span></span>
- <span data-ttu-id="ed9c3-117">LocalDB</span><span class="sxs-lookup"><span data-stu-id="ed9c3-117">LocalDB</span></span>
- <span data-ttu-id="ed9c3-118">Annotations de données</span><span class="sxs-lookup"><span data-stu-id="ed9c3-118">Data Annotations</span></span>

## <a name="creating-the-data-models"></a><span data-ttu-id="ed9c3-119">Création des modèles de données</span><span class="sxs-lookup"><span data-stu-id="ed9c3-119">Creating the Data Models</span></span>

<span data-ttu-id="ed9c3-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) est une infrastructure de mappage objet-relationnel (ORM).</span><span class="sxs-lookup"><span data-stu-id="ed9c3-120">[Entity Framework](https://msdn.microsoft.com/data/aa937723) is an object-relational mapping (ORM) framework.</span></span> <span data-ttu-id="ed9c3-121">Il vous permet de travailler avec des données relationnelles en tant qu’objets, éliminant la plupart du code d’accès aux données que vous devrez généralement écrire.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-121">It lets you work with relational data as objects, eliminating most of the data-access code that you'd usually need to write.</span></span> <span data-ttu-id="ed9c3-122">À l’aide d’Entity Framework, vous pouvez émettre des requêtes à l’aide de [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), puis extraire et manipuler les données en tant qu’objets fortement typés.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-122">Using Entity Framework, you can issue queries using [LINQ](https://msdn.microsoft.com/library/bb397926.aspx), then retrieve and manipulate data as strongly typed objects.</span></span> <span data-ttu-id="ed9c3-123">LINQ fournit des modèles pour l’interrogation et la mise à jour des données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-123">LINQ provides patterns for querying and updating data.</span></span> <span data-ttu-id="ed9c3-124">À l’aide d’Entity Framework vous permet de se concentrer sur la création du reste de votre application, plutôt que de se concentrer sur les données de principes de base de l’accès.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-124">Using Entity Framework allows you to focus on creating the rest of your application, rather than focusing on the data access fundamentals.</span></span> <span data-ttu-id="ed9c3-125">Plus loin dans cette série de didacticiels, nous allons vous montrer comment utiliser les données pour remplir les requêtes de navigation et de produit.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-125">Later in this tutorial series, we'll show you how to use the data to populate navigation and product queries.</span></span>

<span data-ttu-id="ed9c3-126">Entity Framework prend en charge un paradigme de développement appelé *Code First*.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-126">Entity Framework supports a development paradigm called *Code First*.</span></span> <span data-ttu-id="ed9c3-127">Code First vous permet de définir vos modèles de données à l’aide de classes.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-127">Code First lets you define your data models using classes.</span></span> <span data-ttu-id="ed9c3-128">Une classe est une construction qui vous permet de créer vos propres types personnalisés en regroupant des variables d’autres types, méthodes et des événements.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-128">A class is a construct that enables you to create your own custom types by grouping together variables of other types, methods and events.</span></span> <span data-ttu-id="ed9c3-129">Vous pouvez mapper des classes à une base de données existante ou les utiliser pour générer une base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-129">You can map classes to an existing database or use them to generate a database.</span></span> <span data-ttu-id="ed9c3-130">Dans ce didacticiel, vous allez créer les modèles de données en écrivant des classes de modèle de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-130">In this tutorial, you'll create the data models by writing data model classes.</span></span> <span data-ttu-id="ed9c3-131">Ensuite, vous laissez Entity Framework créer la base de données à la volée à partir de ces nouvelles classes.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-131">Then, you'll let Entity Framework create the database on the fly from these new classes.</span></span>

<span data-ttu-id="ed9c3-132">Vous allez commencer par créer les classes d’entité qui définissent les modèles de données pour l’application Web Forms.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-132">You will begin by creating the entity classes that define the data models for the Web Forms application.</span></span> <span data-ttu-id="ed9c3-133">Ensuite, vous allez créer une classe de contexte qui gère les classes d’entité et fournit l’accès à la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-133">Then you will create a context class that manages the entity classes and provides data access to the database.</span></span> <span data-ttu-id="ed9c3-134">Vous allez également créer une classe d’initialiseur que vous allez utiliser pour remplir la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-134">You will also create an initializer class that you will use to populate the database.</span></span>

### <a name="entity-framework-and-references"></a><span data-ttu-id="ed9c3-135">Références et entity Framework</span><span class="sxs-lookup"><span data-stu-id="ed9c3-135">Entity Framework and References</span></span>

<span data-ttu-id="ed9c3-136">Par défaut, Entity Framework est inclus lorsque vous créez un nouveau **Application Web ASP.NET** à l’aide de la **Web Forms** modèle.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-136">By default, Entity Framework is included when you create a new **ASP.NET Web Application** using the **Web Forms** template.</span></span> <span data-ttu-id="ed9c3-137">Entity Framework peut être installée, désinstallée et mis à jour sous forme de package NuGet.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-137">Entity Framework can be installed, uninstalled, and updated as a NuGet package.</span></span>

<span data-ttu-id="ed9c3-138">Ce package NuGet inclut les éléments suivants **runtime** assemblys au sein de votre projet :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-138">This NuGet package includes the following **runtime** assemblies within your project:</span></span>

- <span data-ttu-id="ed9c3-139">EntityFramework.dll – tout le code runtime courantes utilisé par Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ed9c3-139">EntityFramework.dll – All the common runtime code used by Entity Framework</span></span>
- <span data-ttu-id="ed9c3-140">EntityFramework.SqlServer.dll : le fournisseur de Microsoft SQL Server pour Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ed9c3-140">EntityFramework.SqlServer.dll – The Microsoft SQL Server provider for Entity Framework</span></span>

### <a name="entity-classes"></a><span data-ttu-id="ed9c3-141">Classes d’entité</span><span class="sxs-lookup"><span data-stu-id="ed9c3-141">Entity Classes</span></span>

<span data-ttu-id="ed9c3-142">Les classes que vous créez pour définir le schéma des données sont appelées classes d’entité.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-142">The classes you create to define the schema of the data are called entity classes.</span></span> <span data-ttu-id="ed9c3-143">Si vous débutez avec la conception de base de données, considérez les classes d’entité comme des définitions de table de base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-143">If you're new to database design, think of the entity classes as table definitions of a database.</span></span> <span data-ttu-id="ed9c3-144">Chaque propriété de la classe spécifie une colonne dans la table de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-144">Each property in the class specifies a column in the table of the database.</span></span> <span data-ttu-id="ed9c3-145">Ces classes fournissent une interface légère, objet-relationnel entre code orienté objet et de la structure de table relationnelle de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-145">These classes provide a lightweight, object-relational interface between object-oriented code and the relational table structure of the database.</span></span>

<span data-ttu-id="ed9c3-146">Dans ce didacticiel, vous commencerez en ajoutant des classes d’entité simple qui représentent les schémas pour les produits et les catégories.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-146">In this tutorial, you'll start out by adding simple entity classes representing the schemas for products and categories.</span></span> <span data-ttu-id="ed9c3-147">La classe products contient les définitions de chaque produit.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-147">The products class will contain definitions for each product.</span></span> <span data-ttu-id="ed9c3-148">Le nom de chacun des membres de la classe de produit sera `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, et `Category`.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-148">The name of each of the members of the product class will be `ProductID`, `ProductName`, `Description`, `ImagePath`, `UnitPrice`, `CategoryID`, and `Category`.</span></span> <span data-ttu-id="ed9c3-149">La classe de catégorie contient les définitions de chaque catégorie d’un produit peut appartenir à, telles que la voiture, bateau ou plan.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-149">The category class will contain definitions for each category that a product can belong to, such as Car, Boat, or Plane.</span></span> <span data-ttu-id="ed9c3-150">Le nom de chacun des membres de la classe de catégorie sera `CategoryID`, `CategoryName`, `Description`, et `Products`.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-150">The name of each of the members of the category class will be `CategoryID`, `CategoryName`, `Description`, and `Products`.</span></span> <span data-ttu-id="ed9c3-151">Chaque produit appartient à une des catégories.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-151">Each product will belong to one of the categories.</span></span> <span data-ttu-id="ed9c3-152">Ces classes d’entité seront ajoutés à un élément du projet existant *modèles* dossier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-152">These entity classes will be added to the project's existing *Models* folder.</span></span>

1. <span data-ttu-id="ed9c3-153">Dans **l’Explorateur de solutions**, avec le bouton droit le *modèles* dossier, puis sélectionnez **ajouter**  - &gt; **un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-153">In **Solution Explorer**, right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span> 

    ![Créer la couche d’accès aux données - Menu nouvel élément](create_the_data_access_layer/_static/image1.png)

   <span data-ttu-id="ed9c3-155">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-155">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="ed9c3-156">Sous **Visual C#** à partir de la **installé** volet de gauche, sélectionnez **Code**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-156">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span> 

    ![Créer la couche d’accès aux données - Menu nouvel élément](create_the_data_access_layer/_static/image2.png)
3. <span data-ttu-id="ed9c3-158">Sélectionnez **classe** dans le volet central et nommez cette nouvelle classe *Product.cs*.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-158">Select **Class** from the middle pane and name this new class *Product.cs*.</span></span>
4. <span data-ttu-id="ed9c3-159">Cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-159">Click **Add**.</span></span>  
   <span data-ttu-id="ed9c3-160">Le nouveau fichier de classe s’affiche dans l’éditeur.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-160">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="ed9c3-161">Remplacez le code par défaut par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-161">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample1.cs)]
6. <span data-ttu-id="ed9c3-162">Créer une autre classe en répétant les étapes 1 à 4, toutefois, nom de la nouvelle classe *Category.cs* et remplacez le code par défaut par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-162">Create another class by repeating steps 1 through 4, however, name the new class *Category.cs* and replace the default code with the following code:</span></span>  

    [!code-csharp[Main](create_the_data_access_layer/samples/sample2.cs)]

<span data-ttu-id="ed9c3-163">Comme mentionné précédemment, le `Category` classe représente le type de produit que l’application est conçue pour vendre (tel que <a id="a"> </a> &quot;voitures&quot;, &quot;bateaux&quot;, &quot;Roquettes&quot;, et ainsi de suite) et le `Product` classe représente les produits individuels (toys) dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-163">As previously mentioned, the `Category` class represents the type of product that the application is designed to sell (such as <a id="a"></a>&quot;Cars&quot;, &quot;Boats&quot;, &quot;Rockets&quot;, and so on), and the `Product` class represents the individual products (toys) in the database.</span></span> <span data-ttu-id="ed9c3-164">Chaque instance d’un `Product` objet correspond à une ligne dans une table de base de données relationnelle, et chaque propriété de la classe de produit doit être mappée à une colonne dans la table de base de données relationnelle.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-164">Each instance of a `Product` object will correspond to a row within a relational database table, and each property of the Product class will map to a column in the relational database table.</span></span> <span data-ttu-id="ed9c3-165">Plus loin dans ce didacticiel, vous allez consulter les données de produit contenues dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-165">Later in this tutorial, you'll review the product data contained in the database.</span></span>

### <a name="data-annotations"></a><span data-ttu-id="ed9c3-166">Annotations de données</span><span class="sxs-lookup"><span data-stu-id="ed9c3-166">Data Annotations</span></span>

<span data-ttu-id="ed9c3-167">Vous avez peut-être remarqué que certains membres des classes ont des attributs en spécifiant des détails sur le membre, tel que `[ScaffoldColumn(false)]`.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-167">You may have noticed that certain members of the classes have attributes specifying details about the member, such as `[ScaffoldColumn(false)]`.</span></span> <span data-ttu-id="ed9c3-168">Il s’agit de *annotations de données*.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-168">These are *data annotations*.</span></span> <span data-ttu-id="ed9c3-169">Les attributs d’annotation de données peuvent décrire comment valider l’entrée utilisateur pour ce membre, pour spécifier la mise en forme pour celle-ci et pour spécifier la façon dont elle est modélisée lors de la création de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-169">The data annotation attributes can describe how to validate user input for that member, to specify formatting for it, and to specify how it is modeled when the database is created.</span></span>

### <a name="context-class"></a><span data-ttu-id="ed9c3-170">Context, classe</span><span class="sxs-lookup"><span data-stu-id="ed9c3-170">Context Class</span></span>

<span data-ttu-id="ed9c3-171">Pour commencer à utiliser les classes pour accéder aux données, vous devez définir une classe de contexte.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-171">To start using the classes for data access, you must define a context class.</span></span> <span data-ttu-id="ed9c3-172">Comme mentionné précédemment, la classe de contexte gère les classes d’entité (tels que le `Product` classe et la `Category` classe) et fournit l’accès aux données à la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-172">As mentioned previously, the context class manages the entity classes (such as the `Product` class and the `Category` class) and provides data access to the database.</span></span>

<span data-ttu-id="ed9c3-173">Cette procédure ajoute une nouveau contexte classe c# à le *modèles* dossier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-173">This procedure adds a new C# context class to the *Models* folder.</span></span>

1. <span data-ttu-id="ed9c3-174">Cliquez sur le *modèles* dossier, puis sélectionnez **ajouter**  - &gt; **un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-174">Right-click the *Models* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="ed9c3-175">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-175">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="ed9c3-176">Sélectionnez **classe** dans le volet central, nommez-le *ProductContext.cs* et cliquez sur **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-176">Select **Class** from the middle pane, name it *ProductContext.cs* and click **Add**.</span></span>
3. <span data-ttu-id="ed9c3-177">Remplacez le code par défaut contenu dans la classe par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-177">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample3.cs)]

<span data-ttu-id="ed9c3-178">Ce code ajoute la `System.Data.Entity` espace de noms afin que vous avez accès à toutes les fonctionnalités principales d’Entity Framework, qui inclut la capacité à interroger, insérer, mettre à jour et supprimer des données en travaillant avec des objets fortement typés.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-178">This code adds the `System.Data.Entity` namespace so that you have access to all the core functionality of Entity Framework, which includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span>

<span data-ttu-id="ed9c3-179">Le `ProductContext` classe représente le contexte de base de données produit Entity Framework, qui gère l’extraction, le stockage et la mise à jour `Product` instances dans la base de données de la classe.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-179">The `ProductContext` class represents Entity Framework product database context, which handles fetching, storing, and updating `Product` class instances in the database.</span></span> <span data-ttu-id="ed9c3-180">Le `ProductContext` classe dérive le `DbContext` fourni par Entity Framework de classe de base.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-180">The `ProductContext` class derives from the `DbContext` base class provided by Entity Framework.</span></span>

### <a name="initializer-class"></a><span data-ttu-id="ed9c3-181">Classe d’initialiseur</span><span class="sxs-lookup"><span data-stu-id="ed9c3-181">Initializer Class</span></span>

<span data-ttu-id="ed9c3-182">Vous devrez exécuter une logique personnalisée pour initialiser la base de données la première utilisation le contexte.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-182">You will need to run some custom logic to initialize the database the first time the context is used.</span></span> <span data-ttu-id="ed9c3-183">Ainsi, les données d’amorçage à ajouter à la base de données afin que vous pouvez afficher immédiatement les produits et des catégories.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-183">This will allow seed data to be added to the database so that you can immediately display products and categories.</span></span>

<span data-ttu-id="ed9c3-184">Cette procédure ajoute une nouvel initialiseur classe c# à le *modèles* dossier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-184">This procedure adds a new C# initializer class to the *Models* folder.</span></span>

1. <span data-ttu-id="ed9c3-185">Créer un autre `Class` dans le *modèles* dossier et nommez-le *ProductDatabaseInitializer.cs*.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-185">Create another `Class` in the *Models* folder and name it *ProductDatabaseInitializer.cs*.</span></span>
2. <span data-ttu-id="ed9c3-186">Remplacez le code par défaut contenu dans la classe par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-186">Replace the default code contained in the class with the following code:</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample4.cs)]

<span data-ttu-id="ed9c3-187">Comme vous pouvez le voir dans le code ci-dessus, lors de la base de données est créé et initialisé, le `Seed` substitution et de set de propriété.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-187">As you can see from the above code, when the database is created and initialized, the `Seed` property is overridden and set.</span></span> <span data-ttu-id="ed9c3-188">Lorsque le `Seed` propriété est définie, les valeurs de catégories et des produits sont utilisées pour remplir la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-188">When the `Seed` property is set, the values from the categories and products are used to populate the database.</span></span> <span data-ttu-id="ed9c3-189">Si vous tentez de mettre à jour les données d’amorçage en modifiant le code ci-dessus, une fois que la base de données a été créé, vous ne voyez aucune mise à jour lorsque vous exécutez l’application Web.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-189">If you attempt to update the seed data by modifying the above code after the database has been created, you won't see any updates when you run the Web application.</span></span> <span data-ttu-id="ed9c3-190">La raison est que le code ci-dessus utilise une implémentation de la `DropCreateDatabaseIfModelChanges` classe reconnaître si le modèle (schéma) a changé avant de réinitialiser les données d’amorçage.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-190">The reason is the above code uses an implementation of the `DropCreateDatabaseIfModelChanges` class to recognize if the model (schema) has changed before resetting the seed data.</span></span> <span data-ttu-id="ed9c3-191">Si aucune modification n’est apportée à la `Category` et `Product` classes d’entité, la base de données ne seront pas réinitialisés avec les données d’amorçage.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-191">If no changes are made to the `Category` and `Product` entity classes, the database will not be reinitialized with the seed data.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ed9c3-192">Si vous souhaitez que la base de données des recréés chaque fois que vous avez exécuté l’application, vous pouvez utiliser la `DropCreateDatabaseAlways` classe au lieu du `DropCreateDatabaseIfModelChanges` classe.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-192">If you wanted the database to be recreated every time you ran the application, you could use the `DropCreateDatabaseAlways` class instead of the `DropCreateDatabaseIfModelChanges` class.</span></span> <span data-ttu-id="ed9c3-193">Toutefois, pour cette série de didacticiels, utilisez la `DropCreateDatabaseIfModelChanges` classe.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-193">However for this tutorial series, use the `DropCreateDatabaseIfModelChanges` class.</span></span>

<span data-ttu-id="ed9c3-194">À ce stade dans ce didacticiel, vous aurez un *modèles* dossier avec quatre nouvelles classes et une classe par défaut :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-194">At this point in this tutorial, you will have a *Models* folder with four new classes and one default class:</span></span>

![Créer la couche Data Access - dossier de modèles](create_the_data_access_layer/_static/image3.png)

### <a name="configuring-the-application-to-use-the-data-model"></a><span data-ttu-id="ed9c3-196">Configuration de l’Application à utiliser le modèle de données</span><span class="sxs-lookup"><span data-stu-id="ed9c3-196">Configuring the Application to Use the Data Model</span></span>

<span data-ttu-id="ed9c3-197">Maintenant que vous avez créé les classes qui représentent les données, vous devez configurer l’application pour utiliser les classes.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-197">Now that you've created the classes that represent the data, you must configure the application to use the classes.</span></span> <span data-ttu-id="ed9c3-198">Dans le *Global.asax* fichier, vous ajoutez le code qui initialise le modèle.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-198">In the *Global.asax* file, you add code that initializes the model.</span></span> <span data-ttu-id="ed9c3-199">Dans le *Web.config* fichier que vous ajoutez les informations qui indique à l’application de base de données que vous utiliserez pour stocker les données qui sont représentées par les nouvelles classes de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-199">In the *Web.config* file you add information that tells the application what database you'll use to store the data that's represented by the new data classes.</span></span> <span data-ttu-id="ed9c3-200">Le *Global.asax* fichier peut être utilisé pour gérer les événements d’application ou de méthodes.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-200">The *Global.asax* file can be used to handle application events or methods.</span></span> <span data-ttu-id="ed9c3-201">Le *Web.config* fichier vous permet de contrôler la configuration de votre application web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-201">The *Web.config* file allows you to control the configuration of your ASP.NET web application.</span></span>

#### <a name="updating-the-globalasax-file"></a><span data-ttu-id="ed9c3-202">La mise à jour le fichier Global.asax</span><span class="sxs-lookup"><span data-stu-id="ed9c3-202">Updating the Global.asax file</span></span>

<span data-ttu-id="ed9c3-203">Pour initialiser les modèles de données lorsque l’application démarre, vous mettrez à jour la `Application_Start` gestionnaire dans le *Global.asax.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-203">To initialize the data models when the application starts, you will update the `Application_Start` handler in the *Global.asax.cs* file.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="ed9c3-204">Dans l’Explorateur de solutions, vous pouvez sélectionner le *Global.asax* fichier ou le *Global.asax.cs* fichier pour modifier le *Global.asax.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-204">In Solution Explorer, you can select either the *Global.asax* file or the *Global.asax.cs* file to edit the *Global.asax.cs* file.</span></span>

1. <span data-ttu-id="ed9c3-205">Ajoutez le code suivant mis en surbrillance en jaune pour le `Application_Start` méthode dans le *Global.asax.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-205">Add the following code highlighted in yellow to the `Application_Start` method in the *Global.asax.cs* file.</span></span>   

    [!code-csharp[Main](create_the_data_access_layer/samples/sample5.cs?highlight=9-10,22-23)]

> [!NOTE] 
> 
> <span data-ttu-id="ed9c3-206">Votre navigateur doit prendre en charge HTML5 pour afficher le code mis en surbrillance en jaune, lors de l’affichage de cette série de didacticiels dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-206">Your browser must support HTML5 to view the code highlighted in yellow when viewing this tutorial series in a browser.</span></span>

<span data-ttu-id="ed9c3-207">Comme indiqué dans le code ci-dessus, lorsque l’application démarre, l’application spécifie l’initialiseur qui s’exécute pendant la première fois les données est accessible.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-207">As shown in the above code, when the application starts, the application specifies the initializer that will run during the first time the data is accessed.</span></span> <span data-ttu-id="ed9c3-208">Les deux espaces de noms supplémentaires sont nécessaires pour accéder à la `Database` objet et le `ProductDatabaseInitializer` objet.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-208">The two additional namespaces are required to access the `Database` object and the `ProductDatabaseInitializer` object.</span></span>

 <span data-ttu-id="ed9c3-209">Modification du fichier Web.Config</span><span class="sxs-lookup"><span data-stu-id="ed9c3-209">Modifying the Web.Config File</span></span> 

<span data-ttu-id="ed9c3-210">Bien que de Entity Framework Code First génère une base de données pour vous dans un emplacement par défaut lorsque la base de données est remplie avec les données d’amorçage, l’ajout de vos propres informations de connexion à votre application vous donne le contrôle de l’emplacement de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-210">Although Entity Framework Code First will generate a database for you in a default location when the database is populated with seed data, adding your own connection information to your application gives you control of the database location.</span></span> <span data-ttu-id="ed9c3-211">Vous spécifiez cette connexion de base de données à l’aide d’une chaîne de connexion dans l’application *Web.config* fichier à la racine du projet.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-211">You specify this database connection using a connection string in the application's *Web.config* file at the root of the project.</span></span> <span data-ttu-id="ed9c3-212">En ajoutant une nouvelle chaîne de connexion, vous pouvez diriger l’emplacement de la base de données (*wingtiptoys.mdf*) à générer dans le répertoire de données de l’application (*application\_données*), plutôt que sa valeur par défaut emplacement.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-212">By adding a new connection string, you can direct the location of the database (*wingtiptoys.mdf*) to be built in the application's data directory (*App\_Data*), rather than its default location.</span></span> <span data-ttu-id="ed9c3-213">Cette modification vous permettra de trouver et d’inspecter le fichier de base de données plus loin dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-213">Making this change will allow you to find and inspect the database file later in this tutorial.</span></span>

1. <span data-ttu-id="ed9c3-214">Dans **l’Explorateur de solutions**, recherchez et ouvrez le *Web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-214">In **Solution Explorer**, find and open the *Web.config* file.</span></span>
2. <span data-ttu-id="ed9c3-215">Ajoutez la chaîne de connexion mises en surbrillance en jaune pour le `<connectionStrings>` section de la *Web.config* fichier comme suit :</span><span class="sxs-lookup"><span data-stu-id="ed9c3-215">Add the connection string highlighted in yellow to the `<connectionStrings>` section of the *Web.config* file as follows:</span></span>  

    [!code-xml[Main](create_the_data_access_layer/samples/sample6.xml?highlight=4-7)]

<span data-ttu-id="ed9c3-216">Lorsque l’application est exécutée pour la première fois, qu’il va générer la base de données à l’emplacement spécifié par la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-216">When the application is run for the first time, it will build the database at the location specified by the connection string.</span></span> <span data-ttu-id="ed9c3-217">Mais avant d’exécuter l’application, nous allons générer en premier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-217">But before running the application, let's build it first.</span></span>

## <a name="building-the-application"></a><span data-ttu-id="ed9c3-218">Génération de l'application</span><span class="sxs-lookup"><span data-stu-id="ed9c3-218">Building the Application</span></span>

<span data-ttu-id="ed9c3-219">Pour vous assurer que toutes les classes et les modifications apportées à votre application Web fonctionnent, vous devez créer l’application.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-219">To make sure that all the classes and changes to your Web application work, you should build the application.</span></span>

1. <span data-ttu-id="ed9c3-220">À partir de la **déboguer** menu, sélectionnez **WingtipToys Build**.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-220">From the **Debug** menu, select **Build WingtipToys**.</span></span>  
 <span data-ttu-id="ed9c3-221">Le **sortie** fenêtre s’affiche, et si tout va bien, vous voyez un *a réussi* message.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-221">The **Output** window is displayed, and if all went well, you see a *succeeded* message.</span></span>  

    ![Créer la couche Data Access - sortie Windows](create_the_data_access_layer/_static/image4.png)

<span data-ttu-id="ed9c3-223">Si vous rencontrez une erreur, vérifiez à nouveau les étapes ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-223">If you run into an error, re-check the above steps.</span></span> <span data-ttu-id="ed9c3-224">Les informations contenues dans le **sortie** fenêtre indique le fichier qui a un problème et où une modification est nécessaire dans le fichier.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-224">The information in the **Output** window will indicate which file has a problem and where in the file a change is required.</span></span> <span data-ttu-id="ed9c3-225">Ces informations permettent de déterminer quelle partie de la procédure ci-dessus doivent être examinés et corrigés dans votre projet.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-225">This information will enable you to determine what part of the above steps need to be reviewed and fixed in your project.</span></span>

## <a name="summary"></a><span data-ttu-id="ed9c3-226">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="ed9c3-226">Summary</span></span>

<span data-ttu-id="ed9c3-227">Dans ce didacticiel de la série vous avez créé le modèle de données, mais aussi, ajouté le code qui sera utilisé pour initialiser et amorcer la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-227">In this tutorial of the series you have created the data model, as well as, added the code that will be used to initialize and seed the database.</span></span> <span data-ttu-id="ed9c3-228">Vous avez également configuré l’application pour utiliser les modèles de données lorsque l’application est exécutée.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-228">You have also configured the application to use the data models when the application is run.</span></span>

<span data-ttu-id="ed9c3-229">Dans le didacticiel suivant, vous allez mettre à jour de l’interface utilisateur, ajouter la navigation et récupérer des données à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-229">In the next tutorial, you'll update the UI, add navigation, and retrieve data from the database.</span></span> <span data-ttu-id="ed9c3-230">Ainsi, la base de données créée automatiquement selon les classes d’entité que vous avez créé dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ed9c3-230">This will result in the database being automatically created based on the entity classes that you created in this tutorial.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ed9c3-231">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ed9c3-231">Additional Resources</span></span>

<span data-ttu-id="ed9c3-232">[Présentation d’Entity Framework](https://msdn.microsoft.com/library/bb399567.aspx) </span><span class="sxs-lookup"><span data-stu-id="ed9c3-232">[Entity Framework Overview](https://msdn.microsoft.com/library/bb399567.aspx) </span></span>  
<span data-ttu-id="ed9c3-233">[Guide du débutant pour ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907) </span><span class="sxs-lookup"><span data-stu-id="ed9c3-233">[Beginner's Guide to the ADO.NET Entity Framework](https://msdn.microsoft.com/data/ee712907) </span></span>  
<span data-ttu-id="ed9c3-234">[Code premier développement avec Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (vidéo)</span><span class="sxs-lookup"><span data-stu-id="ed9c3-234">[Code First Development with Entity Framework](http://www.msteched.com/2010/Europe/DEV212) (video)</span></span>   
<span data-ttu-id="ed9c3-235">[API Fluent Code First relations](https://msdn.microsoft.com/data/hh134698) </span><span class="sxs-lookup"><span data-stu-id="ed9c3-235">[Code First Relationships Fluent API](https://msdn.microsoft.com/data/hh134698) </span></span>  
[<span data-ttu-id="ed9c3-236">Annotations de données Code First</span><span class="sxs-lookup"><span data-stu-id="ed9c3-236">Code First Data Annotations</span></span>](https://msdn.microsoft.com/data/gg193958)  
[<span data-ttu-id="ed9c3-237">Améliorations de productivité pour Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ed9c3-237">Productivity Improvements for the Entity Framework</span></span>](https://blogs.msdn.com/b/efdesign/archive/2010/06/21/productivity-improvements-for-the-entity-framework.aspx?wa=wsignin1.0)

> [!div class="step-by-step"]
> <span data-ttu-id="ed9c3-238">[Précédent](create-the-project.md)
> [Suivant](ui_and_navigation.md)</span><span class="sxs-lookup"><span data-stu-id="ed9c3-238">[Previous](create-the-project.md)
[Next](ui_and_navigation.md)</span></span>
