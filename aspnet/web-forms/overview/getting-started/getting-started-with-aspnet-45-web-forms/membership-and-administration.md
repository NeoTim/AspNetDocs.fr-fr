---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
title: Appartenance et administration | Microsoft Docs
author: Erikre
description: Cette série de didacticiels vous apprend les bases de la création d’une application ASP.NET Web Forms à l’aide de ASP.NET 4,5 et Microsoft Visual Studio Express 2013 pour nous...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 732a2316-e49f-4f72-becd-0cd72f14457e
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/membership-and-administration
msc.type: authoredcontent
ms.openlocfilehash: ab00bc90bfc767d06e747be6dfb973245b5aae88
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/28/2019
ms.locfileid: "74615468"
---
# <a name="membership-and-administration"></a><span data-ttu-id="39c07-103">Appartenance et administration</span><span class="sxs-lookup"><span data-stu-id="39c07-103">Membership and Administration</span></span>

<span data-ttu-id="39c07-104">par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="39c07-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="39c07-105">[Télécharger l’exemple de projet WingtipC#Toys ()](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) ou [Télécharger le livre électronique (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="39c07-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="39c07-106">Cette série de didacticiels vous apprend les bases de la création d’une application ASP.NET Web Forms à l’aide de ASP.NET 4,5 et Microsoft Visual Studio Express 2013 pour le Web.</span><span class="sxs-lookup"><span data-stu-id="39c07-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="39c07-107">Un [projet Visual Studio 2013 avec C# le code source](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) est disponible pour accompagner cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="39c07-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="39c07-108">Ce didacticiel vous montre comment mettre à jour l’exemple d’application Wingtip Toys pour ajouter un rôle personnalisé et utiliser ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="39c07-108">This tutorial shows you how to update the Wingtip Toys sample application to add a custom role and use ASP.NET Identity.</span></span> <span data-ttu-id="39c07-109">Elle vous montre également comment implémenter une page d’administration à partir de laquelle l’utilisateur doté d’un rôle personnalisé peut ajouter et supprimer des produits sur le site Web.</span><span class="sxs-lookup"><span data-stu-id="39c07-109">It also shows you how to implement an administration page from which the user with a custom role can add and remove products from the website.</span></span>

<span data-ttu-id="39c07-110">[ASP.net Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) est le système d’appartenance utilisé pour créer l’application Web ASP.net et est disponible dans ASP.net 4,5.</span><span class="sxs-lookup"><span data-stu-id="39c07-110">[ASP.NET Identity](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md) is the membership system used to build ASP.NET web application and is available in ASP.NET 4.5.</span></span> <span data-ttu-id="39c07-111">ASP.NET Identity est utilisé dans le modèle de projet Visual Studio 2013 Web Forms, ainsi que les modèles pour [ASP.NET MVC](../../../../mvc/index.md), [API Web ASP.net](../../../../web-api/index.md)et [ASP.net application à page unique](../../../../single-page-application/index.md).</span><span class="sxs-lookup"><span data-stu-id="39c07-111">ASP.NET Identity is used in the Visual Studio 2013 Web Forms project template, as well as the templates for [ASP.NET MVC](../../../../mvc/index.md), [ASP.NET Web API](../../../../web-api/index.md), and [ASP.NET Single Page Application](../../../../single-page-application/index.md).</span></span> <span data-ttu-id="39c07-112">Vous pouvez également installer spécifiquement le système ASP.NET Identity à l’aide de NuGet lorsque vous démarrez avec une application Web vide.</span><span class="sxs-lookup"><span data-stu-id="39c07-112">You can also specifically install the ASP.NET Identity system using NuGet when you start with an empty Web application.</span></span> <span data-ttu-id="39c07-113">Toutefois, dans cette série de didacticiels, vous utilisez le **Web Forms**ProjectTemplate, qui comprend le système ASP.net Identity.</span><span class="sxs-lookup"><span data-stu-id="39c07-113">However, in this tutorial series you use the **Web Forms**projecttemplate, which includes the ASP.NET Identity system.</span></span> <span data-ttu-id="39c07-114">ASP.NET Identity facilite l’intégration des données de profil spécifiques à l’utilisateur avec les données d’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-114">ASP.NET Identity makes it easy to integrate user-specific profile data with application data.</span></span> <span data-ttu-id="39c07-115">De plus, ASP.NET Identity vous permet de choisir le modèle de persistance pour les profils utilisateur dans votre application.</span><span class="sxs-lookup"><span data-stu-id="39c07-115">Also, ASP.NET Identity allows you to choose the persistence model for user profiles in your application.</span></span> <span data-ttu-id="39c07-116">Vous pouvez stocker les données dans une base de données SQL Server ou dans un autre magasin de données, y compris des magasins de données *NoSQL* tels que des tables de stockage Windows Azure.</span><span class="sxs-lookup"><span data-stu-id="39c07-116">You can store the data in a SQL Server database or another data store, including *NoSQL* data stores such as Windows Azure Storage Tables.</span></span>

<span data-ttu-id="39c07-117">Ce didacticiel s’appuie sur le didacticiel précédent intitulé « Checkout and Payment with PayPal » dans la série de didacticiels Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="39c07-117">This tutorial builds on the previous tutorial titled "Checkout and Payment with PayPal" in the Wingtip Toys tutorial series.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="39c07-118">Ce que vous allez apprendre :</span><span class="sxs-lookup"><span data-stu-id="39c07-118">What you'll learn:</span></span>

- <span data-ttu-id="39c07-119">Comment utiliser du code pour ajouter un rôle personnalisé et un utilisateur à l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-119">How to use code to add a custom role and a user to the application.</span></span>
- <span data-ttu-id="39c07-120">Comment restreindre l’accès au dossier et à la page d’administration.</span><span class="sxs-lookup"><span data-stu-id="39c07-120">How to restrict access to the administration folder and page.</span></span>
- <span data-ttu-id="39c07-121">Comment fournir une navigation pour l’utilisateur qui appartient au rôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="39c07-121">How to provide navigation for the user that belongs to the custom role.</span></span>
- <span data-ttu-id="39c07-122">Comment utiliser la liaison de modèle pour remplir un contrôle [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) avec des catégories de produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-122">How to use model binding to populate a [DropDownList](https://msdn.microsoft.com/library/system.web.ui.webcontrols.dropdownlist(v=vs.110).aspx) control with product categories.</span></span>
- <span data-ttu-id="39c07-123">Téléchargement d’un fichier vers l’application Web à l’aide du contrôle [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="39c07-123">How to upload a file to the web application using the [FileUpload](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload(v=vs.110).aspx) control.</span></span>
- <span data-ttu-id="39c07-124">Comment utiliser les contrôles de validation pour implémenter la validation des entrées.</span><span class="sxs-lookup"><span data-stu-id="39c07-124">How to use validation controls to implement input validation.</span></span>
- <span data-ttu-id="39c07-125">Comment ajouter et supprimer des produits dans l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-125">How to add and remove products from the application.</span></span>

## <a name="these-features-are-included-in-the-tutorial"></a><span data-ttu-id="39c07-126">Ces fonctionnalités sont incluses dans le didacticiel :</span><span class="sxs-lookup"><span data-stu-id="39c07-126">These features are included in the tutorial:</span></span>

- <span data-ttu-id="39c07-127">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="39c07-127">ASP.NET Identity</span></span>
- <span data-ttu-id="39c07-128">Configuration et autorisation</span><span class="sxs-lookup"><span data-stu-id="39c07-128">Configuration and Authorization</span></span>
- <span data-ttu-id="39c07-129">Liaison de modèle</span><span class="sxs-lookup"><span data-stu-id="39c07-129">Model Binding</span></span>
- <span data-ttu-id="39c07-130">Validation discrète</span><span class="sxs-lookup"><span data-stu-id="39c07-130">Unobtrusive Validation</span></span>

<span data-ttu-id="39c07-131">ASP.NET Web Forms fournit des fonctionnalités d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="39c07-131">ASP.NET Web Forms provides membership capabilities.</span></span> <span data-ttu-id="39c07-132">En utilisant le modèle par défaut, vous disposez d’une fonctionnalité d’appartenance intégrée que vous pouvez utiliser immédiatement lorsque l’application s’exécute.</span><span class="sxs-lookup"><span data-stu-id="39c07-132">By using the default template, you have built-in membership functionality that you can immediately use when the application runs.</span></span> <span data-ttu-id="39c07-133">Ce didacticiel vous montre comment utiliser ASP.NET Identity pour ajouter un rôle personnalisé et affecter un utilisateur à ce rôle.</span><span class="sxs-lookup"><span data-stu-id="39c07-133">This tutorial shows you how to use ASP.NET Identity to add a custom role and assign a user to that role.</span></span> <span data-ttu-id="39c07-134">Vous allez apprendre à restreindre l’accès au dossier d’administration.</span><span class="sxs-lookup"><span data-stu-id="39c07-134">You will learn how to restrict access to the administration folder.</span></span> <span data-ttu-id="39c07-135">Vous allez ajouter une page au dossier d’administration qui permet à un utilisateur disposant d’un rôle personnalisé d’ajouter et de supprimer des produits, et d’afficher un aperçu d’un produit une fois qu’il a été ajouté.</span><span class="sxs-lookup"><span data-stu-id="39c07-135">You'll add a page to the administration folder that allows a user with a custom role to add and remove products, and to preview a product after it has been added.</span></span>

## <a name="adding-a-custom-role"></a><span data-ttu-id="39c07-136">Ajout d’un rôle personnalisé</span><span class="sxs-lookup"><span data-stu-id="39c07-136">Adding a Custom Role</span></span>

<span data-ttu-id="39c07-137">À l’aide de ASP.NET Identity, vous pouvez ajouter un rôle personnalisé et affecter un utilisateur à ce rôle à l’aide de code.</span><span class="sxs-lookup"><span data-stu-id="39c07-137">Using ASP.NET Identity, you can add a custom role and assign a user to that role using code.</span></span>

1. <span data-ttu-id="39c07-138">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le dossier *logique* et créez une nouvelle classe.</span><span class="sxs-lookup"><span data-stu-id="39c07-138">In **Solution Explorer**, right-click on the *Logic* folder and create a new class.</span></span>
2. <span data-ttu-id="39c07-139">Nommez la nouvelle classe *RoleActions.cs*.</span><span class="sxs-lookup"><span data-stu-id="39c07-139">Name the new class *RoleActions.cs*.</span></span>
3. <span data-ttu-id="39c07-140">Modifiez le code pour qu’il apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-140">Modify the code so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample1.cs?highlight=8)]
4. <span data-ttu-id="39c07-141">Dans **Explorateur de solutions**, ouvrez le fichier *global.asax.cs* .</span><span class="sxs-lookup"><span data-stu-id="39c07-141">In **Solution Explorer**, open the *Global.asax.cs* file.</span></span>
5. <span data-ttu-id="39c07-142">Modifiez le fichier *global.asax.cs* en ajoutant le code mis en surbrillance en jaune afin qu’il apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-142">Modify the *Global.asax.cs* file by adding the code highlighted in yellow so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample2.cs?highlight=11,26-28)]
6. <span data-ttu-id="39c07-143">Notez que `AddUserAndRole` est souligné en rouge.</span><span class="sxs-lookup"><span data-stu-id="39c07-143">Notice that `AddUserAndRole` is underlined in red.</span></span> <span data-ttu-id="39c07-144">Double-cliquez sur le code AddUserAndRole.</span><span class="sxs-lookup"><span data-stu-id="39c07-144">Double-click the AddUserAndRole code.</span></span>  
   <span data-ttu-id="39c07-145">La lettre « A » au début de la méthode mise en surbrillance est soulignée.</span><span class="sxs-lookup"><span data-stu-id="39c07-145">The letter "A" at the beginning of the highlighted method will be underlined.</span></span>
7. <span data-ttu-id="39c07-146">Pointez sur la lettre « A », puis cliquez sur l’interface utilisateur qui vous permet de générer un stub de méthode pour la méthode `AddUserAndRole`.</span><span class="sxs-lookup"><span data-stu-id="39c07-146">Hover over the letter "A" and click the UI that allows you to generate a method stub for the `AddUserAndRole` method.</span></span> 

    ![Appartenance et administration-générer un stub de méthode](membership-and-administration/_static/image1.png)
8. <span data-ttu-id="39c07-148">Cliquez sur l’option intitulée :</span><span class="sxs-lookup"><span data-stu-id="39c07-148">Click the option titled:</span></span>  
    `Generate method stub for "AddUserAndRole" in "WingtipToys.Logic.RoleActions"`
9. <span data-ttu-id="39c07-149">Ouvrez le fichier *RoleActions.cs* à partir du dossier *logique* .</span><span class="sxs-lookup"><span data-stu-id="39c07-149">Open the *RoleActions.cs* file from the *Logic* folder.</span></span>  
   <span data-ttu-id="39c07-150">La méthode `AddUserAndRole` a été ajoutée au fichier de classe.</span><span class="sxs-lookup"><span data-stu-id="39c07-150">The `AddUserAndRole` method has been added to the class file.</span></span>
10. <span data-ttu-id="39c07-151">Modifiez le fichier *RoleActions.cs* en supprimant le `NotImplementedException` et en ajoutant le code mis en surbrillance en jaune, afin qu’il apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-151">Modify the *RoleActions.cs* file by removing the `NotImplementedException` and adding the code highlighted in yellow, so that it appears as follows:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample3.cs?highlight=5-7,15-51)]

<span data-ttu-id="39c07-152">Le code ci-dessus établit tout d’abord un contexte de base de données pour la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="39c07-152">The above code first establishes a database context for the membership database.</span></span> <span data-ttu-id="39c07-153">La base de données d’appartenance est également stockée sous la forme d’un fichier *. mdf* dans le dossier de données de l' *application\_* .</span><span class="sxs-lookup"><span data-stu-id="39c07-153">The membership database is also stored as an *.mdf* file in the *App\_Data* folder.</span></span> <span data-ttu-id="39c07-154">Vous serez en mesure d’afficher cette base de données une fois que le premier utilisateur s’est connecté à cette application Web.</span><span class="sxs-lookup"><span data-stu-id="39c07-154">You will be able to view this database once the first user has signed in to this web application.</span></span> 

> [!NOTE] 
> 
> <span data-ttu-id="39c07-155">Si vous souhaitez stocker les données d’appartenance avec les données du produit, vous pouvez envisager d’utiliser le **DbContext** que vous avez utilisé pour stocker les données du produit dans le code ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="39c07-155">If you wish to store the membership data along with the product data, you can consider using the same **DbContext** that you used to store the product data in the above code.</span></span>

 <span data-ttu-id="39c07-156">Le mot clé *Internal* est un modificateur d’accès pour les types (tels que les classes) et les membres de type (tels que les méthodes ou les propriétés).</span><span class="sxs-lookup"><span data-stu-id="39c07-156">The *internal* keyword is an access modifier for types (such as classes) and type members (such as methods or properties).</span></span> <span data-ttu-id="39c07-157">Les types ou membres internes sont accessibles uniquement dans les fichiers contenus dans le même assembly *(fichier. dll* ).</span><span class="sxs-lookup"><span data-stu-id="39c07-157">Internal types or members are accessible only within files contained in the same assembly *(.dll* file).</span></span> <span data-ttu-id="39c07-158">Quand vous générez votre application, un fichier d’assembly *(. dll*) est créé et contient le code qui est exécuté lors de l’exécution de votre application.</span><span class="sxs-lookup"><span data-stu-id="39c07-158">When you build your application, an assembly file *(.dll*) is created that contains the code that is executed when you run your application.</span></span> 

<span data-ttu-id="39c07-159">Un objet `RoleStore`, qui assure la gestion des rôles, est créé en fonction du contexte de la base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-159">A `RoleStore` object, which provides role management, is created based on the database context.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="39c07-160">Notez que lorsque l’objet `RoleStore` est créé, il utilise un type de `IdentityRole` générique.</span><span class="sxs-lookup"><span data-stu-id="39c07-160">Notice that when the `RoleStore` object is created it uses a Generic `IdentityRole` type.</span></span> <span data-ttu-id="39c07-161">Cela signifie que la `RoleStore` est autorisée uniquement à contenir des objets `IdentityRole`.</span><span class="sxs-lookup"><span data-stu-id="39c07-161">This means that the `RoleStore` is only allowed to contain `IdentityRole` objects.</span></span> <span data-ttu-id="39c07-162">En outre, à l’aide de génériques, les ressources en mémoire sont mieux gérées.</span><span class="sxs-lookup"><span data-stu-id="39c07-162">Also by using Generics, resources in memory are handled better.</span></span>

<span data-ttu-id="39c07-163">Ensuite, l’objet `RoleManager` est créé en fonction de l’objet `RoleStore` que vous venez de créer.</span><span class="sxs-lookup"><span data-stu-id="39c07-163">Next, the `RoleManager` object, is created based on the `RoleStore` object that you just created.</span></span> <span data-ttu-id="39c07-164">l’objet `RoleManager` expose l’API associée au rôle qui peut être utilisée pour enregistrer automatiquement les modifications apportées au `RoleStore`.</span><span class="sxs-lookup"><span data-stu-id="39c07-164">the `RoleManager` object exposes role related API which can be used to automatically save changes to the `RoleStore`.</span></span> <span data-ttu-id="39c07-165">Le `RoleManager` est uniquement autorisé à contenir des objets `IdentityRole`, car le code utilise le type générique `<IdentityRole>`.</span><span class="sxs-lookup"><span data-stu-id="39c07-165">The `RoleManager` is only allowed to contain `IdentityRole` objects because the code uses the `<IdentityRole>` Generic type.</span></span>

<span data-ttu-id="39c07-166">Vous appelez la méthode `RoleExists` pour déterminer si le rôle « canEdit » est présent dans la base de données d’appartenance.</span><span class="sxs-lookup"><span data-stu-id="39c07-166">You call the `RoleExists` method to determine if the "canEdit" role is present in the membership database.</span></span> <span data-ttu-id="39c07-167">Si ce n’est pas le cas, vous créez le rôle.</span><span class="sxs-lookup"><span data-stu-id="39c07-167">If it is not, you create the role.</span></span>

<span data-ttu-id="39c07-168">La création de l’objet `UserManager` semble plus complexe que le contrôle `RoleManager`, mais il est quasiment identique.</span><span class="sxs-lookup"><span data-stu-id="39c07-168">Creating the `UserManager` object appears to be more complicated than the `RoleManager` control, however it is nearly the same.</span></span> <span data-ttu-id="39c07-169">Il est simplement codé sur une seule ligne plutôt que sur plusieurs.</span><span class="sxs-lookup"><span data-stu-id="39c07-169">It is just coded on one line rather than several.</span></span> <span data-ttu-id="39c07-170">Ici, le paramètre que vous passez est instancié en tant que nouvel objet contenu dans la parenthèse.</span><span class="sxs-lookup"><span data-stu-id="39c07-170">Here, the parameter that you are passing is instantiating as a new object contained in the parenthesis.</span></span>

<span data-ttu-id="39c07-171">Ensuite, vous créez l’utilisateur « canEditUser » en créant un objet de `ApplicationUser`.</span><span class="sxs-lookup"><span data-stu-id="39c07-171">Next you create the "canEditUser" user by creating a new `ApplicationUser` object.</span></span> <span data-ttu-id="39c07-172">Ensuite, si vous avez correctement créé l’utilisateur, vous ajoutez l’utilisateur au nouveau rôle.</span><span class="sxs-lookup"><span data-stu-id="39c07-172">Then, if you successfully create the user, you add the user to the new role.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="39c07-173">La gestion des erreurs sera mise à jour au cours du didacticiel « gestion des erreurs ASP.NET » plus loin dans cette série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="39c07-173">The error handling will be updated during the "ASP.NET Error Handling" tutorial later in this tutorial series.</span></span>

<span data-ttu-id="39c07-174">La prochaine fois que l’application démarre, l’utilisateur nommé « canEditUser » sera ajouté en tant que rôle nommé « canEdit » de l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-174">The next time the application starts, the user named "canEditUser" will be added as the role named "canEdit" of the application.</span></span> <span data-ttu-id="39c07-175">Plus loin dans ce didacticiel, vous allez vous connecter en tant qu’utilisateur « canEditUser » pour afficher les fonctionnalités supplémentaires que vous ajouterez au cours de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="39c07-175">Later in this tutorial, you will login as the "canEditUser" user to display additional capabilities that you will added during this tutorial.</span></span> <span data-ttu-id="39c07-176">Pour plus d’informations sur les API relatives aux ASP.NET Identity, consultez l' [espace de noms Microsoft. Aspnet. Identity](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="39c07-176">For API details about ASP.NET Identity, see the [Microsoft.AspNet.Identity Namespace](https://msdn.microsoft.com/library/microsoft.aspnet.identity(v=vs.111).aspx).</span></span> <span data-ttu-id="39c07-177">Pour plus d’informations sur l’initialisation du système de ASP.NET Identity, consultez [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span><span class="sxs-lookup"><span data-stu-id="39c07-177">For additional details about initializing the ASP.NET Identity system, see the [AspnetIdentitySample](https://github.com/rustd/AspnetIdentitySample/blob/master/AspnetIdentitySample/App_Start/IdentityConfig.cs).</span></span>

### <a name="restricting-access-to-the-administration-page"></a><span data-ttu-id="39c07-178">Restriction de l’accès à la page d’administration</span><span class="sxs-lookup"><span data-stu-id="39c07-178">Restricting Access to the Administration Page</span></span>

<span data-ttu-id="39c07-179">L’exemple d’application Wingtip Toys permet aux utilisateurs anonymes et aux utilisateurs connectés d’afficher et d’acheter des produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-179">The Wingtip Toys sample application allows both anonymous users and logged-in users to view and purchase products.</span></span> <span data-ttu-id="39c07-180">Toutefois, l’utilisateur connecté disposant du rôle « canEdit » personnalisé peut accéder à une page restreinte afin d’ajouter et de supprimer des produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-180">However, the logged-in user that has the custom "canEdit" role can access a restricted page in order to add and remove products.</span></span>

#### <a name="add-an-administration-folder-and-page"></a><span data-ttu-id="39c07-181">Ajouter un dossier et une page d’administration</span><span class="sxs-lookup"><span data-stu-id="39c07-181">Add an Administration Folder and Page</span></span>

<span data-ttu-id="39c07-182">Ensuite, vous allez créer un dossier nommé *admin* pour l’utilisateur « canEditUser » appartenant au rôle personnalisé de l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="39c07-182">Next, you will create a folder named *Admin* for the "canEditUser" user belonging to the custom role of the Wingtip Toys sample application.</span></span>

1. <span data-ttu-id="39c07-183">Cliquez avec le bouton droit sur le nom du projet (**Wingtip Toys**) dans **Explorateur de solutions** , puis sélectionnez **Ajouter** -&gt; **nouveau dossier**.</span><span class="sxs-lookup"><span data-stu-id="39c07-183">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add** -&gt; **New Folder**.</span></span>
2. <span data-ttu-id="39c07-184">Nommez le nouveau dossier *admin*.</span><span class="sxs-lookup"><span data-stu-id="39c07-184">Name the new folder *Admin*.</span></span>
3. <span data-ttu-id="39c07-185">Cliquez avec le bouton droit sur le dossier *admin* , puis sélectionnez **Ajouter** -&gt; **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="39c07-185">Right-click the *Admin* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="39c07-186">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="39c07-186">The **Add New Item** dialog box is displayed.</span></span>
4. <span data-ttu-id="39c07-187">Sélectionnez le <strong>groupe C# Visual</strong>-&gt; des modèles <strong>Web</strong> sur la gauche.</span><span class="sxs-lookup"><span data-stu-id="39c07-187">Select the <strong>Visual C#</strong>-&gt; <strong>Web</strong> templates group on the left.</span></span> <span data-ttu-id="39c07-188">Dans la liste du milieu, sélectionnez <strong>Web Form avec page maître</strong>, nommez-le <em>AdminPage. aspx</em><strong>,</strong> puis sélectionnez <strong>Ajouter</strong>.</span><span class="sxs-lookup"><span data-stu-id="39c07-188">From the middle list, select <strong>Web Form with Master Page</strong>,name it <em>AdminPage.aspx</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
5. <span data-ttu-id="39c07-189">Sélectionnez le fichier *site. Master* comme page maître, puis choisissez **OK**.</span><span class="sxs-lookup"><span data-stu-id="39c07-189">Select the *Site.Master* file as the master page, and then choose **OK**.</span></span>

#### <a name="add-a-webconfig-file"></a><span data-ttu-id="39c07-190">Ajouter un fichier Web. config</span><span class="sxs-lookup"><span data-stu-id="39c07-190">Add a Web.config File</span></span>

<span data-ttu-id="39c07-191">En ajoutant un fichier *Web. config* au dossier *admin* , vous pouvez restreindre l’accès à la page contenue dans le dossier.</span><span class="sxs-lookup"><span data-stu-id="39c07-191">By adding a *Web.config* file to the *Admin* folder, you can restrict access to the page contained in the folder.</span></span>

1. <span data-ttu-id="39c07-192">Cliquez avec le bouton droit sur le dossier *admin* et sélectionnez **Ajouter** -&gt; **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="39c07-192">Right-click the *Admin* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="39c07-193">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="39c07-193">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="39c07-194">Dans la liste des modèles C# Web visuels, sélectionnez <strong>fichier de configuration Web</strong>dans la liste du milieu, acceptez le nom par défaut de <em>Web. config</em><strong>,</strong> puis sélectionnez <strong>Ajouter</strong>.</span><span class="sxs-lookup"><span data-stu-id="39c07-194">From the list of Visual C# web templates, select <strong>Web Configuration File</strong>from the middle list, accept the default name of <em>Web.config</em><strong>,</strong> and then select <strong>Add</strong>.</span></span>
3. <span data-ttu-id="39c07-195">Remplacez le contenu XML existant dans le fichier *Web. config* par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-195">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](membership-and-administration/samples/sample4.xml)]

<span data-ttu-id="39c07-196">Enregistrez le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="39c07-196">Save the *Web.config* file.</span></span> <span data-ttu-id="39c07-197">Le fichier *Web. config* spécifie que seul l’utilisateur appartenant au rôle « canEdit » de l’application peut accéder à la page contenue dans le dossier *admin* .</span><span class="sxs-lookup"><span data-stu-id="39c07-197">The *Web.config* file specifies that only user belonging to the "canEdit" role of the application can access the page contained in the *Admin* folder.</span></span>

### <a name="including-custom-role-navigation"></a><span data-ttu-id="39c07-198">Inclusion de la navigation dans les rôles personnalisés</span><span class="sxs-lookup"><span data-stu-id="39c07-198">Including Custom Role Navigation</span></span>

<span data-ttu-id="39c07-199">Pour permettre à l’utilisateur du rôle « canEdit » personnalisé d’accéder à la section d’administration de l’application, vous devez ajouter un lien vers la page *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="39c07-199">To enable the user of the custom "canEdit" role to navigate to the administration section of the application, you must add a link to the *Site.Master* page.</span></span> <span data-ttu-id="39c07-200">Seuls les utilisateurs qui appartiennent au rôle « canEdit » seront en mesure de voir le lien d' **administration** et d’accéder à la section Administration.</span><span class="sxs-lookup"><span data-stu-id="39c07-200">Only users that belong to the "canEdit" role will be able to see the **Admin** link and access the administration section.</span></span>

1. <span data-ttu-id="39c07-201">Dans Explorateur de solutions, recherchez et ouvrez la page *site. Master* .</span><span class="sxs-lookup"><span data-stu-id="39c07-201">In Solution Explorer, find and open the *Site.Master* page.</span></span>
2. <span data-ttu-id="39c07-202">Pour créer un lien pour l’utilisateur du rôle « canEdit », ajoutez la balise mise en surbrillance en jaune à la liste non triée `<ul>` élément suivant afin que la liste apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-202">To create a link for the user of the "canEdit" role, add the markup highlighted in yellow to the following unordered list `<ul>` element so that the list appears as follows:</span></span>  

    [!code-html[Main](membership-and-administration/samples/sample5.html?highlight=2-3)]
3. <span data-ttu-id="39c07-203">Ouvrez le fichier *site.Master.cs* .</span><span class="sxs-lookup"><span data-stu-id="39c07-203">Open the *Site.Master.cs* file.</span></span> <span data-ttu-id="39c07-204">Rendez le lien d' **administration** visible uniquement pour l’utilisateur « canEditUser » en ajoutant le code mis en surbrillance en jaune au gestionnaire de `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="39c07-204">Make the **Admin** link visible only to the "canEditUser" user by adding the code highlighted in yellow to the `Page_Load` handler.</span></span> <span data-ttu-id="39c07-205">Le gestionnaire de `Page_Load` s’affiche comme suit :</span><span class="sxs-lookup"><span data-stu-id="39c07-205">The `Page_Load` handler will appear as follows:</span></span>   

    [!code-csharp[Main](membership-and-administration/samples/sample6.cs?highlight=3-6)]

<span data-ttu-id="39c07-206">Lors du chargement de la page, le code vérifie si l’utilisateur connecté a le rôle « canEdit ».</span><span class="sxs-lookup"><span data-stu-id="39c07-206">When the page loads, the code checks whether the logged-in user has the role of "canEdit".</span></span> <span data-ttu-id="39c07-207">Si l’utilisateur appartient au rôle « canEdit », l’élément span contenant le lien vers la page *AdminPage. aspx* (et, par conséquent, le lien à l’intérieur de l’étendue) est rendu visible.</span><span class="sxs-lookup"><span data-stu-id="39c07-207">If the user belongs to the "canEdit" role, the span element containing the link to the *AdminPage.aspx* page (and consequently the link inside the span) is made visible.</span></span>

### <a name="enabling-product-administration"></a><span data-ttu-id="39c07-208">Activation de l’administration du produit</span><span class="sxs-lookup"><span data-stu-id="39c07-208">Enabling Product Administration</span></span>

<span data-ttu-id="39c07-209">Jusqu’à présent, vous avez créé le rôle « canEdit » et ajouté un utilisateur « canEditUser », un dossier d’administration et une page d’administration.</span><span class="sxs-lookup"><span data-stu-id="39c07-209">So far, you have created the "canEdit" role and added an "canEditUser" user, an administration folder, and an administration page.</span></span> <span data-ttu-id="39c07-210">Vous avez défini des droits d’accès pour le dossier et la page d’administration et vous avez ajouté un lien de navigation pour l’utilisateur du rôle « canEdit » à l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-210">You have set access rights for the administration folder and page, and have added a navigation link for the user of the "canEdit" role to the application.</span></span> <span data-ttu-id="39c07-211">Ensuite, vous allez ajouter le balisage à la page *AdminPage. aspx* et le code au fichier code-behind *AdminPage.aspx.cs* qui permettra à l’utilisateur disposant du rôle « canEdit » d’ajouter et de supprimer des produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-211">Next, you will add markup to the *AdminPage.aspx* page and code to the *AdminPage.aspx.cs* code-behind file that will enable the user with the "canEdit" role to add and remove products.</span></span>

1. <span data-ttu-id="39c07-212">Dans **Explorateur de solutions**, ouvrez le fichier *AdminPage. aspx* à partir du dossier *admin* .</span><span class="sxs-lookup"><span data-stu-id="39c07-212">In **Solution Explorer**, open the *AdminPage.aspx* file from the *Admin* folder.</span></span>
2. <span data-ttu-id="39c07-213">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="39c07-213">Replace the existing markup with the following:</span></span>  

    [!code-aspx[Main](membership-and-administration/samples/sample7.aspx)]
3. <span data-ttu-id="39c07-214">Ensuite, ouvrez le fichier code-behind *AdminPage.aspx.cs* en cliquant avec le bouton droit sur *AdminPage. aspx* et en cliquant sur **afficher le code**.</span><span class="sxs-lookup"><span data-stu-id="39c07-214">Next, open the *AdminPage.aspx.cs* code-behind file by right-clicking the *AdminPage.aspx* and clicking **View Code**.</span></span>
4. <span data-ttu-id="39c07-215">Remplacez le code existant dans le fichier code-behind *AdminPage.aspx.cs* par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="39c07-215">Replace the existing code in the *AdminPage.aspx.cs* code-behind file with the following code:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample8.cs)]

<span data-ttu-id="39c07-216">Dans le code que vous avez entré pour le fichier code-behind *AdminPage.aspx.cs* , une classe appelée `AddProducts` effectue le travail réel d’ajout de produits à la base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-216">In the code that you entered for the *AdminPage.aspx.cs* code-behind file, a class called `AddProducts` does the actual work of adding products to the database.</span></span> <span data-ttu-id="39c07-217">Cette classe n’existe pas encore. vous allez donc la créer maintenant.</span><span class="sxs-lookup"><span data-stu-id="39c07-217">This class doesn't exist yet, so you will create it now.</span></span>

1. <span data-ttu-id="39c07-218">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le dossier *logique* , puis sélectionnez **Ajouter** -&gt; **nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="39c07-218">In **Solution Explorer**, right-click the *Logic* folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="39c07-219">La boîte de dialogue **Ajouter un nouvel élément** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="39c07-219">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="39c07-220">Sélectionnez le **groupe C# Visual** -&gt; de modèles de **code** sur la gauche.</span><span class="sxs-lookup"><span data-stu-id="39c07-220">Select the **Visual C#** -&gt; **Code** templates group on the left.</span></span> <span data-ttu-id="39c07-221">Ensuite, sélectionnez **classe**dans la liste du milieu, puis nommez-la *AddProducts.cs*.</span><span class="sxs-lookup"><span data-stu-id="39c07-221">Then, select **Class**from the middle list and name it *AddProducts.cs*.</span></span>   
   <span data-ttu-id="39c07-222">Le nouveau fichier de classe s’affiche.</span><span class="sxs-lookup"><span data-stu-id="39c07-222">The new class file is displayed.</span></span>
3. <span data-ttu-id="39c07-223">Remplacez le code existant par le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="39c07-223">Replace the existing code with the following:</span></span>  

    [!code-csharp[Main](membership-and-administration/samples/sample9.cs)]

<span data-ttu-id="39c07-224">La page *AdminPage. aspx* permet à l’utilisateur appartenant au rôle « canEdit » d’ajouter et de supprimer des produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-224">The *AdminPage.aspx* page allows the user belonging to the "canEdit" role to add and remove products.</span></span> <span data-ttu-id="39c07-225">Quand un nouveau produit est ajouté, les détails sur le produit sont validés, puis entrés dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-225">When a new product is added, the details about the product are validated and then entered into the database.</span></span> <span data-ttu-id="39c07-226">Le nouveau produit est immédiatement disponible pour tous les utilisateurs de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="39c07-226">The new product is immediately available to all users of the web application.</span></span>

#### <a name="unobtrusive-validation"></a><span data-ttu-id="39c07-227">Validation discrète</span><span class="sxs-lookup"><span data-stu-id="39c07-227">Unobtrusive Validation</span></span>

<span data-ttu-id="39c07-228">Les détails du produit que l’utilisateur fournit sur la page *AdminPage. aspx* sont validés à l’aide des contrôles de validation (`RequiredFieldValidator` et `RegularExpressionValidator`).</span><span class="sxs-lookup"><span data-stu-id="39c07-228">The product details that the user provides on the *AdminPage.aspx* page are validated using validation controls (`RequiredFieldValidator` and `RegularExpressionValidator`).</span></span> <span data-ttu-id="39c07-229">Ces contrôles utilisent automatiquement la validation discrète.</span><span class="sxs-lookup"><span data-stu-id="39c07-229">These controls automatically use unobtrusive validation.</span></span> <span data-ttu-id="39c07-230">Une validation discrète permet aux contrôles de validation d’utiliser JavaScript pour la logique de validation côté client, ce qui signifie que la page ne nécessite pas de trajet vers le serveur à valider.</span><span class="sxs-lookup"><span data-stu-id="39c07-230">Unobtrusive validation allows the validation controls to use JavaScript for client-side validation logic, which means the page does not require a trip to the server to be validated.</span></span> <span data-ttu-id="39c07-231">Par défaut, la validation discrète est incluse dans le fichier *Web. config* en fonction du paramètre de configuration suivant :</span><span class="sxs-lookup"><span data-stu-id="39c07-231">By default, unobtrusive validation is included in the *Web.config* file based on the following configuration setting:</span></span>

[!code-xml[Main](membership-and-administration/samples/sample10.xml)]

#### <a name="regular-expressions"></a><span data-ttu-id="39c07-232">Expressions régulières</span><span class="sxs-lookup"><span data-stu-id="39c07-232">Regular Expressions</span></span>

<span data-ttu-id="39c07-233">Le prix du produit sur la page *AdminPage. aspx* est validé à l’aide d’un contrôle **RegularExpressionValidator** .</span><span class="sxs-lookup"><span data-stu-id="39c07-233">The product price on the *AdminPage.aspx* page is validated using a **RegularExpressionValidator** control.</span></span> <span data-ttu-id="39c07-234">Ce contrôle vérifie si la valeur du contrôle d’entrée associé (zone de texte « AddProductPrice ») correspond au modèle spécifié par l’expression régulière.</span><span class="sxs-lookup"><span data-stu-id="39c07-234">This control validates whether the value of the associated input control (the "AddProductPrice" TextBox) matches the pattern specified by the regular expression.</span></span> <span data-ttu-id="39c07-235">Une expression régulière est une notation de critères spéciaux qui vous permet de rechercher et de faire correspondre rapidement des modèles de caractères spécifiques.</span><span class="sxs-lookup"><span data-stu-id="39c07-235">A regular expression is a pattern-matching notation that enables you to quickly find and match specific character patterns.</span></span> <span data-ttu-id="39c07-236">Le contrôle **RegularExpressionValidator** inclut une propriété nommée `ValidationExpression` qui contient l’expression régulière utilisée pour valider l’entrée de prix, comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="39c07-236">The **RegularExpressionValidator** control includes a property named `ValidationExpression` that contains the regular expression used to validate price input, as shown below:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample11.aspx)]

#### <a name="fileupload-control"></a><span data-ttu-id="39c07-237">FileUpload, contrôle</span><span class="sxs-lookup"><span data-stu-id="39c07-237">FileUpload Control</span></span>

<span data-ttu-id="39c07-238">En plus des contrôles d’entrée et de validation, vous avez ajouté le contrôle **FileUpload** à la page *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="39c07-238">In addition to the input and validation controls, you added the **FileUpload** control to the *AdminPage.aspx* page.</span></span> <span data-ttu-id="39c07-239">Ce contrôle permet de télécharger des fichiers.</span><span class="sxs-lookup"><span data-stu-id="39c07-239">This control provides the capability to upload files.</span></span> <span data-ttu-id="39c07-240">Dans ce cas, vous autorisez uniquement le téléchargement des fichiers image.</span><span class="sxs-lookup"><span data-stu-id="39c07-240">In this case, you are only allowing image files to be uploaded.</span></span> <span data-ttu-id="39c07-241">Dans le fichier code-behind (*AdminPage.aspx.cs*), quand l’utilisateur clique sur le `AddProductButton`, le code vérifie la propriété `HasFile` du contrôle **FileUpload** .</span><span class="sxs-lookup"><span data-stu-id="39c07-241">In the code-behind file (*AdminPage.aspx.cs*), when the `AddProductButton` is clicked, the code checks the `HasFile` property of the **FileUpload** control.</span></span> <span data-ttu-id="39c07-242">Si le contrôle a un fichier et que le type de fichier (basé sur l’extension de fichier) est autorisé, l’image est enregistrée dans le dossier *images* et le dossier *images/thumbs* de l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-242">If the control has a file and if the file type (based on file extension) is allowed, the image is saved to the *Images* folder and the *Images/Thumbs* folder of the application.</span></span>

#### <a name="model-binding"></a><span data-ttu-id="39c07-243">Liaison de modèle</span><span class="sxs-lookup"><span data-stu-id="39c07-243">Model Binding</span></span>

<span data-ttu-id="39c07-244">Plus haut dans cette série de didacticiels, vous avez utilisé la liaison de modèle pour remplir un contrôle **ListView** , un contrôle **FormsView** , un contrôle **GridView** et un contrôle **DetailView** .</span><span class="sxs-lookup"><span data-stu-id="39c07-244">Earlier in this tutorial series you used model binding to populate a **ListView** control, a **FormsView** control, a **GridView** control, and a **DetailView** control.</span></span> <span data-ttu-id="39c07-245">Dans ce didacticiel, vous utilisez la liaison de modèle pour remplir un contrôle **DropDownList** avec une liste de catégories de produits.</span><span class="sxs-lookup"><span data-stu-id="39c07-245">In this tutorial, you use model binding to populate a **DropDownList** control with a list of product categories.</span></span>

<span data-ttu-id="39c07-246">Le balisage que vous avez ajouté au fichier *AdminPage. aspx* contient un contrôle **DropDownList** appelé `DropDownAddCategory`:</span><span class="sxs-lookup"><span data-stu-id="39c07-246">The markup that you added to the *AdminPage.aspx* file contains a **DropDownList** control called `DropDownAddCategory`:</span></span>

[!code-aspx[Main](membership-and-administration/samples/sample12.aspx)]

<span data-ttu-id="39c07-247">Vous utilisez la liaison de modèle pour remplir ce **DropDownList** en définissant l’attribut `ItemType` et l’attribut `SelectMethod`.</span><span class="sxs-lookup"><span data-stu-id="39c07-247">You use model binding to populate this **DropDownList** by setting the `ItemType` attribute and the `SelectMethod` attribute.</span></span> <span data-ttu-id="39c07-248">L’attribut `ItemType` spécifie que vous utilisez le type `WingtipToys.Models.Category` lors du remplissage du contrôle.</span><span class="sxs-lookup"><span data-stu-id="39c07-248">The `ItemType` attribute specifies that you use the `WingtipToys.Models.Category` type when populating the control.</span></span> <span data-ttu-id="39c07-249">Vous avez défini ce type au début de cette série de didacticiels en créant la classe `Category` (illustrée ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="39c07-249">You defined this type at the beginning of this tutorial series by creating the `Category` class (shown below).</span></span> <span data-ttu-id="39c07-250">La classe `Category` se trouve dans le dossier *Models* à l’intérieur du fichier *Category.cs* .</span><span class="sxs-lookup"><span data-stu-id="39c07-250">The `Category` class is in the *Models* folder inside the *Category.cs* file.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample13.cs)]

<span data-ttu-id="39c07-251">L’attribut `SelectMethod` du contrôle **DropDownList** spécifie que vous utilisez la méthode `GetCategories` (illustrée ci-dessous) qui est incluse dans le fichier code-behind (*AdminPage.aspx.cs*).</span><span class="sxs-lookup"><span data-stu-id="39c07-251">The `SelectMethod` attribute of the **DropDownList** control specifies that you use the `GetCategories` method (shown below) that is included in the code-behind file (*AdminPage.aspx.cs*).</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample14.cs)]

<span data-ttu-id="39c07-252">Cette méthode spécifie qu’une interface `IQueryable` est utilisée pour évaluer une requête sur un type `Category`.</span><span class="sxs-lookup"><span data-stu-id="39c07-252">This method specifies that an `IQueryable` interface is used to evaluate a query against a `Category` type.</span></span> <span data-ttu-id="39c07-253">La valeur retournée est utilisée pour remplir le **DropDownList** dans le balisage de la page (*AdminPage. aspx*).</span><span class="sxs-lookup"><span data-stu-id="39c07-253">The returned value is used to populate the **DropDownList** in the markup of the page (*AdminPage.aspx*).</span></span>

<span data-ttu-id="39c07-254">Le texte affiché pour chaque élément de la liste est spécifié en définissant l’attribut `DataTextField`.</span><span class="sxs-lookup"><span data-stu-id="39c07-254">The text displayed for each item in the list is specified by setting the `DataTextField` attribute.</span></span> <span data-ttu-id="39c07-255">L’attribut `DataTextField` utilise la `CategoryName` de la classe `Category` (illustrée ci-dessus) pour afficher chaque catégorie dans le contrôle **DropDownList** .</span><span class="sxs-lookup"><span data-stu-id="39c07-255">The `DataTextField` attribute uses the `CategoryName` of the `Category` class (shown above) to display each category in the **DropDownList** control.</span></span> <span data-ttu-id="39c07-256">La valeur réelle qui est passée lorsqu’un élément est sélectionné dans le contrôle **DropDownList** est basée sur l’attribut `DataValueField`.</span><span class="sxs-lookup"><span data-stu-id="39c07-256">The actual value that is passed when an item is selected in the **DropDownList** control is based on the `DataValueField` attribute.</span></span> <span data-ttu-id="39c07-257">L’attribut `DataValueField` est défini sur le `CategoryID` comme défini dans la classe `Category` (voir ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="39c07-257">The `DataValueField` attribute is set to the `CategoryID` as define in the `Category` class (shown above).</span></span>

### <a name="how-the-application-will-work"></a><span data-ttu-id="39c07-258">Fonctionnement de l’application</span><span class="sxs-lookup"><span data-stu-id="39c07-258">How the Application Will Work</span></span>

<span data-ttu-id="39c07-259">Lorsque l’utilisateur qui appartient au rôle « canEdit » accède à la page pour la première fois, le contrôle `DropDownAddCategory`**DropDownList** est rempli comme décrit ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="39c07-259">When the user belonging to the "canEdit" role navigates to the page for the first time, the `DropDownAddCategory`**DropDownList** control is populated as described above.</span></span> <span data-ttu-id="39c07-260">Le contrôle `DropDownRemoveProduct`**DropDownList** est également rempli avec les produits qui utilisent la même approche.</span><span class="sxs-lookup"><span data-stu-id="39c07-260">The `DropDownRemoveProduct`**DropDownList** control is also populated with products using the same approach.</span></span> <span data-ttu-id="39c07-261">L’utilisateur qui appartient au rôle « canEdit » sélectionne le type de catégorie et ajoute des détails sur le produit (**nom**, **Description**, **prix**et **fichier image**).</span><span class="sxs-lookup"><span data-stu-id="39c07-261">The user belonging to the "canEdit" role selects the category type and adds product details (**Name**, **Description**, **Price**, and **Image File**).</span></span> <span data-ttu-id="39c07-262">Lorsque l’utilisateur qui appartient au rôle « canEdit » clique sur le bouton **Add Product** , le gestionnaire d’événements `AddProductButton_Click` est déclenché.</span><span class="sxs-lookup"><span data-stu-id="39c07-262">When the user belonging to the "canEdit" role clicks the **Add Product** button, the `AddProductButton_Click` event handler is triggered.</span></span> <span data-ttu-id="39c07-263">Le gestionnaire d’événements `AddProductButton_Click` situé dans le fichier code-behind (*AdminPage.aspx.cs*) vérifie le fichier image pour s’assurer qu’il correspond aux types de fichiers autorisés *(. gif*, *. png*, *. jpeg*ou *. jpg*).</span><span class="sxs-lookup"><span data-stu-id="39c07-263">The `AddProductButton_Click` event handler located in the code-behind file (*AdminPage.aspx.cs*) checks the image file to make sure it matches the allowed file types *(.gif*, *.png*, *.jpeg*, or *.jpg*).</span></span> <span data-ttu-id="39c07-264">Ensuite, le fichier image est enregistré dans un dossier de l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="39c07-264">Then, the image file is saved into a folder of the Wingtip Toys sample application.</span></span> <span data-ttu-id="39c07-265">Le nouveau produit est ensuite ajouté à la base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-265">Next, the new product is added to the database.</span></span> <span data-ttu-id="39c07-266">Pour ajouter un nouveau produit, une nouvelle instance de la classe `AddProducts` est créée et nommée Products.</span><span class="sxs-lookup"><span data-stu-id="39c07-266">To accomplish adding a new product, a new instance of the `AddProducts` class is created and named products.</span></span> <span data-ttu-id="39c07-267">La classe `AddProducts` a une méthode nommée `AddProduct`, et l’objet Products appelle cette méthode pour ajouter des produits à la base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-267">The `AddProducts` class has a method named `AddProduct`, and the products object calls this method to add products to the database.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample15.cs)]

<span data-ttu-id="39c07-268">Si le code ajoute correctement le nouveau produit à la base de données, la page est rechargée avec la valeur de chaîne de requête `ProductAction=add`.</span><span class="sxs-lookup"><span data-stu-id="39c07-268">If the code successfully adds the new product to the database, the page is reloaded with the query string value `ProductAction=add`.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample16.cs)]

<span data-ttu-id="39c07-269">Lors du rechargement de la page, la chaîne de requête est incluse dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="39c07-269">When the page reloads, the query string is included in the URL.</span></span> <span data-ttu-id="39c07-270">En rechargeant la page, l’utilisateur qui appartient au rôle « canEdit » peut immédiatement voir les mises à jour dans les contrôles **DropDownList** sur la page *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="39c07-270">By reloading the page, the user belonging to the "canEdit" role can immediately see the updates in the **DropDownList** controls on the *AdminPage.aspx* page.</span></span> <span data-ttu-id="39c07-271">En outre, en incluant la chaîne de requête avec l’URL, la page peut afficher un message de réussite à l’utilisateur appartenant au rôle « canEdit ».</span><span class="sxs-lookup"><span data-stu-id="39c07-271">Also, by including the query string with the URL, the page can display a success message to the user belonging to the "canEdit" role.</span></span>

<span data-ttu-id="39c07-272">Lors du rechargement de la page *AdminPage. aspx* , l’événement `Page_Load` est appelé.</span><span class="sxs-lookup"><span data-stu-id="39c07-272">When the *AdminPage.aspx* page reloads, the `Page_Load` event is called.</span></span>

[!code-csharp[Main](membership-and-administration/samples/sample17.cs)]

<span data-ttu-id="39c07-273">Le gestionnaire d’événements `Page_Load` vérifie la valeur de chaîne de requête et détermine s’il faut afficher un message de réussite.</span><span class="sxs-lookup"><span data-stu-id="39c07-273">The `Page_Load` event handler checks the query string value and determines whether to show a success message.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="39c07-274">Exécution de l'application</span><span class="sxs-lookup"><span data-stu-id="39c07-274">Running the Application</span></span>

<span data-ttu-id="39c07-275">Vous pouvez exécuter l’application maintenant pour voir comment vous pouvez ajouter, supprimer et mettre à jour des éléments dans le panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="39c07-275">You can run the application now to see how you can add, delete, and update items in the shopping cart.</span></span> <span data-ttu-id="39c07-276">Le total du panier d’achat reflète le coût total de tous les articles dans le panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="39c07-276">The shopping cart total will reflect the total cost of all items in the shopping cart.</span></span>

1. <span data-ttu-id="39c07-277">Dans Explorateur de solutions, appuyez sur **F5** pour exécuter l’exemple d’application Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="39c07-277">In Solution Explorer, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="39c07-278">Le navigateur s’ouvre et affiche la page *default. aspx* .</span><span class="sxs-lookup"><span data-stu-id="39c07-278">The browser opens and shows the *Default.aspx* page.</span></span>
2. <span data-ttu-id="39c07-279">Cliquez sur le lien **se connecter en** haut de la page.</span><span class="sxs-lookup"><span data-stu-id="39c07-279">Click the **Log in** link at the top of the page.</span></span> 

    ![Appartenance et administration-lien de connexion](membership-and-administration/_static/image2.png)

   <span data-ttu-id="39c07-281">La page *login. aspx* s’affiche.</span><span class="sxs-lookup"><span data-stu-id="39c07-281">The *Login.aspx* page is displayed.</span></span>
3. <span data-ttu-id="39c07-282">Utilisez le nom d’utilisateur et le mot de passe suivants :</span><span class="sxs-lookup"><span data-stu-id="39c07-282">Use the following user name and password:</span></span>  
   <span data-ttu-id="39c07-283">Nom d’utilisateur : canEditUser@wingtiptoys.com</span><span class="sxs-lookup"><span data-stu-id="39c07-283">User name: canEditUser@wingtiptoys.com</span></span>  
   <span data-ttu-id="39c07-284">Mot de passe : PA $ $word 1</span><span class="sxs-lookup"><span data-stu-id="39c07-284">Password: Pa$$word1</span></span> 

    ![Appartenance et administration-page de connexion](membership-and-administration/_static/image3.png)
4. <span data-ttu-id="39c07-286">Cliquez sur le bouton **se connecter dans** la partie inférieure de la page.</span><span class="sxs-lookup"><span data-stu-id="39c07-286">Click the **Log in** button near the bottom of the page.</span></span>
5. <span data-ttu-id="39c07-287">En haut de la page suivante, sélectionnez le lien **administrateur** pour accéder à la page *AdminPage. aspx* .</span><span class="sxs-lookup"><span data-stu-id="39c07-287">At the top of the next page, select the **Admin** link to navigate to the *AdminPage.aspx* page.</span></span> 

    ![Appartenance et administration-lien d’administration](membership-and-administration/_static/image4.png)
6. <span data-ttu-id="39c07-289">Pour tester la validation d’entrée, cliquez sur le bouton **Ajouter un produit** sans ajouter de détails sur le produit.</span><span class="sxs-lookup"><span data-stu-id="39c07-289">To test the input validation, click the **Add Product** button without adding any product details.</span></span> 

    ![Appartenance et administration-page d’administration](membership-and-administration/_static/image5.png)

   <span data-ttu-id="39c07-291">Notez que les messages de champ requis s’affichent.</span><span class="sxs-lookup"><span data-stu-id="39c07-291">Notice that the required field messages are displayed.</span></span>
7. <span data-ttu-id="39c07-292">Ajoutez les détails d’un nouveau produit, puis cliquez sur le bouton **Ajouter un produit** .</span><span class="sxs-lookup"><span data-stu-id="39c07-292">Add the details for a new product, and then click the **Add Product** button.</span></span> 

    ![Appartenance et administration-ajouter un produit](membership-and-administration/_static/image6.png)
8. <span data-ttu-id="39c07-294">Sélectionnez **produits** dans le menu de navigation supérieur pour afficher le nouveau produit que vous avez ajouté.</span><span class="sxs-lookup"><span data-stu-id="39c07-294">Select **Products** from the top navigation menu to view the new product you added.</span></span> 

    ![Appartenance et administration-afficher le nouveau produit](membership-and-administration/_static/image7.png)
9. <span data-ttu-id="39c07-296">Cliquez sur le lien **administrateur** pour revenir à la page d’administration.</span><span class="sxs-lookup"><span data-stu-id="39c07-296">Click the **Admin** link to return to the administration page.</span></span>
10. <span data-ttu-id="39c07-297">Dans la section **supprimer le produit** de la page, sélectionnez le nouveau produit que vous avez ajouté dans le **DropDownListBox**.</span><span class="sxs-lookup"><span data-stu-id="39c07-297">In the **Remove Product** section of the page, select the new product you added in the **DropDownListBox**.</span></span>
11. <span data-ttu-id="39c07-298">Cliquez sur le bouton **supprimer le produit** pour supprimer le nouveau produit de l’application.</span><span class="sxs-lookup"><span data-stu-id="39c07-298">Click the **Remove Product** button to remove the new product from the application.</span></span> 

    ![Appartenance et administration-supprimer le produit](membership-and-administration/_static/image8.png)
12. <span data-ttu-id="39c07-300">Sélectionnez **produits** dans le menu de navigation supérieur pour confirmer que le produit a été supprimé.</span><span class="sxs-lookup"><span data-stu-id="39c07-300">Select **Products** from the top navigation menu to confirm that the product has been removed.</span></span>
13. <span data-ttu-id="39c07-301">Cliquez sur Fermer la **session** pour le mode d’administration existant.</span><span class="sxs-lookup"><span data-stu-id="39c07-301">Click **Log off** to exist administration mode.</span></span>   
    <span data-ttu-id="39c07-302">Notez que le volet de navigation supérieur n’affiche plus l’élément de menu **admin** .</span><span class="sxs-lookup"><span data-stu-id="39c07-302">Notice that the top navigation pane no longer shows the **Admin** menu item.</span></span>

## <a name="summary"></a><span data-ttu-id="39c07-303">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="39c07-303">Summary</span></span>

<span data-ttu-id="39c07-304">Dans ce didacticiel, vous avez ajouté un rôle personnalisé et un utilisateur appartenant au rôle personnalisé, limité l’accès au dossier et à la page d’administration et fourni la navigation pour l’utilisateur appartenant au rôle personnalisé.</span><span class="sxs-lookup"><span data-stu-id="39c07-304">In this tutorial, you added a custom role and a user belonging to the custom role, restricted access to the administration folder and page, and provided navigation for the user belonging to the custom role.</span></span> <span data-ttu-id="39c07-305">Vous avez utilisé la liaison de modèle pour remplir un contrôle **DropDownList** avec des données.</span><span class="sxs-lookup"><span data-stu-id="39c07-305">You used model binding to populate a **DropDownList** control with data.</span></span> <span data-ttu-id="39c07-306">Vous avez implémenté le contrôle **FileUpload** et les contrôles de validation.</span><span class="sxs-lookup"><span data-stu-id="39c07-306">You implemented the **FileUpload** control and validation controls.</span></span> <span data-ttu-id="39c07-307">En outre, vous avez appris à ajouter et à supprimer des produits d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="39c07-307">Also, you have learned how to add and remove products from a database.</span></span> <span data-ttu-id="39c07-308">Dans le didacticiel suivant, vous apprendrez à implémenter le routage ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="39c07-308">In the next tutorial, you'll learn how to implement ASP.NET routing.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="39c07-309">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="39c07-309">Additional Resources</span></span>

<span data-ttu-id="39c07-310">[Élément Web. config-Authorization](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="39c07-310">[Web.config - authorization Element](https://msdn.microsoft.com/library/8d82143t(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="39c07-311">ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="39c07-311">ASP.NET Identity</span></span>](../../../../identity/overview/getting-started/introduction-to-aspnet-identity.md)  
[<span data-ttu-id="39c07-312">Déployer une application ASP.NET Web Forms sécurisée avec appartenance, OAuth et SQL Database à un site Web Azure</span><span class="sxs-lookup"><span data-stu-id="39c07-312">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to an Azure Web Site</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="39c07-313">Microsoft Azure-essai gratuit</span><span class="sxs-lookup"><span data-stu-id="39c07-313">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

> [!div class="step-by-step"]
> <span data-ttu-id="39c07-314">[Précédent](checkout-and-payment-with-paypal.md)
> [Suivant](url-routing.md)</span><span class="sxs-lookup"><span data-stu-id="39c07-314">[Previous](checkout-and-payment-with-paypal.md)
[Next](url-routing.md)</span></span>
