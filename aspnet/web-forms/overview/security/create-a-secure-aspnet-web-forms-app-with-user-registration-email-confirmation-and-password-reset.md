---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Créer une application Web Forms ASP.NET sécurisée avec inscription des utilisateurs, par e-mail de réinitialisation de mot de passe et de confirmation (c#) | Microsoft Docs
author: Erikre
description: Ce didacticiel vous montre comment créer une application Web Forms ASP.NET avec inscription utilisateur, confirmation par courrier électronique et mot de passe réinitialisé à l’aide du membre de l’identité ASP.NET...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 3df728891103de9c8e461ab9507237c9b14e8251
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59390686"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="fde7b-103">Créer une application Web Forms ASP.NET sécurisée avec inscription de l’utilisateur, confirmation par e-mail et réinitialisation du mot de passe (C#)</span><span class="sxs-lookup"><span data-stu-id="fde7b-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="fde7b-104">par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="fde7b-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="fde7b-105">Ce didacticiel vous montre comment créer une application Web Forms ASP.NET avec inscription de l’utilisateur, confirmation par courrier électronique et mot de passe réinitialisé à l’aide du système d’appartenance ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="fde7b-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="fde7b-106">Ce didacticiel a été basé sur de Rick Anderson [didacticiel MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="fde7b-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>


## <a name="introduction"></a><span data-ttu-id="fde7b-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="fde7b-107">Introduction</span></span>

<span data-ttu-id="fde7b-108">Ce didacticiel vous guide à travers les étapes requises pour créer une application Web Forms ASP.NET à l’aide de Visual Studio et ASP.NET 4.5 pour créer une application Web Forms sécurisée avec inscription des utilisateurs, envoyer par courrier électronique de confirmation et le mot de passe de la réinitialisation.</span><span class="sxs-lookup"><span data-stu-id="fde7b-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="fde7b-109">Tâches de didacticiel et les informations sur :</span><span class="sxs-lookup"><span data-stu-id="fde7b-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="fde7b-110">Créer un site Web ASP.NET application Forms</span><span class="sxs-lookup"><span data-stu-id="fde7b-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="fde7b-111">Raccorder SendGrid</span><span class="sxs-lookup"><span data-stu-id="fde7b-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="fde7b-112">Demander Confirmation de l’E-mail avant de journal dans</span><span class="sxs-lookup"><span data-stu-id="fde7b-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="fde7b-113">Réinitialisation et la récupération de mot de passe</span><span class="sxs-lookup"><span data-stu-id="fde7b-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="fde7b-114">Renvoyer le lien de Confirmation de courrier électronique</span><span class="sxs-lookup"><span data-stu-id="fde7b-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="fde7b-115">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="fde7b-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="fde7b-116">Ressources supplémentaires pour MSBuild</span><span class="sxs-lookup"><span data-stu-id="fde7b-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="fde7b-117">Créer une application Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="fde7b-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="fde7b-118">Démarrez en installant et en cours d’exécution [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="fde7b-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="fde7b-119">Installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure ainsi.</span><span class="sxs-lookup"><span data-stu-id="fde7b-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="fde7b-120">Avertissement : Vous devez installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure pour suivre ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="fde7b-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="fde7b-121">Créez un projet (**fichier**  - &gt; **nouveau projet**) et sélectionnez le **Application Web ASP.NET** modèle et la plus récente du .NET Framework version à partir de la **nouveau projet** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="fde7b-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="fde7b-122">À partir de la **nouveau projet ASP.NET** boîte de dialogue, sélectionnez le **Web Forms** modèle.</span><span class="sxs-lookup"><span data-stu-id="fde7b-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="fde7b-123">Laissez l’authentification par défaut à **Comptes d’utilisateur individuels**.</span><span class="sxs-lookup"><span data-stu-id="fde7b-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="fde7b-124">Si vous souhaitez héberger l’application dans Azure, laissez le **hôte dans le cloud** case est cochée.</span><span class="sxs-lookup"><span data-stu-id="fde7b-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="fde7b-125">Ensuite, cliquez sur **OK** pour créer le nouveau projet.</span><span class="sxs-lookup"><span data-stu-id="fde7b-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="fde7b-126">![Boîte de dialogue Nouveau projet ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fde7b-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="fde7b-127">Activer Secure Sockets Layer (SSL) pour le projet.</span><span class="sxs-lookup"><span data-stu-id="fde7b-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="fde7b-128">Suivez les étapes disponibles dans le **activer SSL pour le projet** section de la [mise en route de la série de didacticiels de Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="fde7b-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="fde7b-129">Exécutez l’application, cliquez sur le **inscrire** lier et inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="fde7b-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="fde7b-130">À ce stade, la seule validation de l’e-mail est basée sur le [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribut pour garantir l’adresse e-mail est bien formé.</span><span class="sxs-lookup"><span data-stu-id="fde7b-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="fde7b-131">Vous allez modifier le code pour ajouter l’e-mail de confirmation.</span><span class="sxs-lookup"><span data-stu-id="fde7b-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="fde7b-132">Fermez la fenêtre du navigateur.</span><span class="sxs-lookup"><span data-stu-id="fde7b-132">Close the browser window.</span></span>
5. <span data-ttu-id="fde7b-133">Dans **Explorateur de serveurs** de Visual Studio (**vue**  - &gt; **Explorateur de serveurs**), accédez à **données\ de données DefaultConnection\Tables\AspNetUsers**, avec le bouton droit cliquez et sélectionnez **ouvrir la définition de la table**.</span><span class="sxs-lookup"><span data-stu-id="fde7b-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="fde7b-134">L’illustration suivante montre le `AspNetUsers` schéma de table :</span><span class="sxs-lookup"><span data-stu-id="fde7b-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schéma de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="fde7b-136">Dans **Explorateur de serveurs**, avec le bouton droit sur le **AspNetUsers** de table et sélectionnez **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="fde7b-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Données de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="fde7b-138">À ce stade le courrier électronique pour l’utilisateur inscrit n’a pas été confirmé.</span><span class="sxs-lookup"><span data-stu-id="fde7b-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="fde7b-139">Cliquez sur la ligne, puis sélectionnez Supprimer pour supprimer l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="fde7b-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="fde7b-140">Vous ajoutez de nouveau ce courrier électronique à l’étape suivante et envoyer un message de confirmation à l’adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fde7b-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="fde7b-141">E-mail de Confirmation</span><span class="sxs-lookup"><span data-stu-id="fde7b-141">Email Confirmation</span></span>

<span data-ttu-id="fde7b-142">Il est recommandé de confirmer l’adresse de messagerie lors de l’inscription d’un nouvel utilisateur pour vérifier qu’ils ne sont pas emprunter l’identité d’une autre personne (autrement dit, ils n’ont pas inscrit auprès de quelqu'un d’autre e-mail).</span><span class="sxs-lookup"><span data-stu-id="fde7b-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="fde7b-143">Supposons que vous ayez un forum de discussion : vous voudriez empêcher `"bob@cpandl.com"` de s'inscrire en tant que `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="fde7b-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="fde7b-144">ans la confirmation par courrier électronique, `"joe@contoso.com"` pourrait recevoir du courrier indésirable à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="fde7b-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="fde7b-145">Supposons que Bob accidentellement inscrit en tant que `"bib@cpandl.com"` et vous l’auriez pas remarqué, il ne serait pas en mesure d’utiliser la récupération de mot de passe, car l’application n’a pas son adresse de messagerie correcte.</span><span class="sxs-lookup"><span data-stu-id="fde7b-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="fde7b-146">E-mail de confirmation fournit uniquement une protection limitée des robots et ne fournit pas une protection à partir des expéditeurs de courrier indésirable déterminés.</span><span class="sxs-lookup"><span data-stu-id="fde7b-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="fde7b-147">En règle générale, vous souhaitez empêcher les nouveaux utilisateurs à partir de la validation des données à votre site Web avant qu’ils ont été confirmés par un message électronique, un SMS ou un autre mécanisme.</span><span class="sxs-lookup"><span data-stu-id="fde7b-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="fde7b-148">Dans les sections ci-dessous, nous activer la confirmation de courrier électronique et modifier le code pour empêcher les utilisateurs qui vient d’être inscrits de se connecter jusqu'à ce que leur adresse de messagerie a été confirmée.</span><span class="sxs-lookup"><span data-stu-id="fde7b-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="fde7b-149">Vous allez utiliser le service de messagerie SendGrid dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="fde7b-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="fde7b-150">Se connecter à SendGrid</span><span class="sxs-lookup"><span data-stu-id="fde7b-150">Hook up SendGrid</span></span>

<span data-ttu-id="fde7b-151">SendGrid a changé son API depuis la rédaction de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="fde7b-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="fde7b-152">Pour obtenir des instructions en cours de SendGrid, consultez [SendGrid](http://sendgrid.com/) ou [activer la récupération de confirmation et le mot de passe du compte](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="fde7b-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="fde7b-153">Bien que ce didacticiel montre uniquement comment ajouter la notification par courrier électronique via [SendGrid](http://sendgrid.com/), vous pouvez envoyer un e-mail à l’aide de SMTP et d'autres mécanismes (consultez [les ressources additionnelles](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="fde7b-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="fde7b-154">Dans Visual Studio, ouvrez le **Console du Gestionnaire de Package** (**outils**  - &gt; **Gestionnaire de Package NuGet**  - &gt; **Console du Gestionnaire de package**), puis entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="fde7b-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="fde7b-155">Accédez à la [page d’inscription Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) et vous inscrire gratuitement compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="fde7b-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="fde7b-156">Vous pouvez également vous inscrire pour un compte SendGrid gratuit directement sur [site de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="fde7b-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="fde7b-157">À partir de **l’Explorateur de solutions** ouvrir le *IdentityConfig.cs* de fichiers dans le *application\_Démarrer* dossier et ajoutez le code suivant mis en surbrillance en jaune pour le `EmailService` classe permettant de configurer **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="fde7b-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="fde7b-158">En outre, ajoutez le code suivant `using` instructions au début de la *IdentityConfig.cs* fichier :</span><span class="sxs-lookup"><span data-stu-id="fde7b-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="fde7b-159">Pour simplifier cet exemple, vous allez stocker les valeurs de compte de service de messagerie dans le `appSettings` section de la *web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="fde7b-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="fde7b-160">Ajoutez le code XML suivant mis en surbrillance en jaune pour le *web.config* fichier à la racine de votre projet :</span><span class="sxs-lookup"><span data-stu-id="fde7b-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="fde7b-161">Sécurité - Ne jamais stocker de données sensibles dans votre code source.</span><span class="sxs-lookup"><span data-stu-id="fde7b-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="fde7b-162">Dans cet exemple, le compte et les informations d’identification sont stockées dans le **appSetting** section de la *Web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="fde7b-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="fde7b-163"> Sur Azure, vous pouvez stocker en toute sécurité ces valeurs sur l'onglet **[Configurer](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="fde7b-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="fde7b-164">Pour plus d’informations, consultez rubrique de Rick Anderson [meilleures pratiques pour le déploiement des mots de passe et autres données sensibles sur ASP.NET et Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="fde7b-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="fde7b-165">Ajoutez les valeurs de service de messagerie pour refléter vos valeurs de l’authentification SendGrid (nom d’utilisateur et mot de passe) pour que vous puissiez réussie Envoyer e-mail à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="fde7b-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="fde7b-166">Veillez à utiliser le nom de votre compte SendGrid plutôt que l’adresse de messagerie que vous avez fourni SendGrid.</span><span class="sxs-lookup"><span data-stu-id="fde7b-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="fde7b-167">Activer la Confirmation de courrier électronique</span><span class="sxs-lookup"><span data-stu-id="fde7b-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="fde7b-168">Pour activer la confirmation par courrier électronique, vous allez modifier le code d’inscription en procédant comme suit.</span><span class="sxs-lookup"><span data-stu-id="fde7b-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  
 

1. <span data-ttu-id="fde7b-169">Dans le *compte* dossier, ouvrez le *Register.aspx.cs* code-behind et mettre à jour le `CreateUser_Click` méthode pour permettre les modifications suivantes :</span><span class="sxs-lookup"><span data-stu-id="fde7b-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="fde7b-170">Dans **l’Explorateur de solutions**, avec le bouton droit *Default.aspx* et sélectionnez **définir comme Page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="fde7b-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="fde7b-171">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="fde7b-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="fde7b-172">Une fois la page s’affiche, cliquez sur le **inscrire** lien pour afficher la page d’inscription.</span><span class="sxs-lookup"><span data-stu-id="fde7b-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="fde7b-173">Entrez votre adresse électronique et le mot de passe, puis cliquez sur le **inscrire** bouton pour envoyer un e-mail via SendGrid.</span><span class="sxs-lookup"><span data-stu-id="fde7b-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="fde7b-174">L’état actuel de votre projet et de code permet à l’utilisateur pour se connecter une fois qu’elles terminent le formulaire d’inscription, même si elles ne l’avez pas confirmé son compte.</span><span class="sxs-lookup"><span data-stu-id="fde7b-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="fde7b-175">Vérifiez votre compte de messagerie, puis cliquez sur le lien pour confirmer votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fde7b-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="fde7b-176">Une fois que vous envoyez le formulaire d’inscription, vous serez connecté.</span><span class="sxs-lookup"><span data-stu-id="fde7b-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Exemple de site Web - connecté](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="fde7b-178">Demander Confirmation de l’E-mail avant de journal dans</span><span class="sxs-lookup"><span data-stu-id="fde7b-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="fde7b-179">Bien que vous avez confirmé que le compte de messagerie, à ce stade vous serait inutile de cliquer sur le lien contenu dans l’e-mail de vérification pour être entièrement connectés.</span><span class="sxs-lookup"><span data-stu-id="fde7b-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="fde7b-180">Dans la section suivante, vous allez modifier le code exigeant que les nouveaux utilisateurs pour avoir un e-mail de confirmation avant d’être enregistrées (authentifié).</span><span class="sxs-lookup"><span data-stu-id="fde7b-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="fde7b-181">Dans **l’Explorateur de solutions** de Visual Studio, mettre à jour le `CreateUser_Click` événement dans le *Register.aspx.cs* code-behind contenue dans le *comptes* dossier avec le modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="fde7b-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="fde7b-182">Mise à jour le `LogIn` méthode dans le *Login.aspx.cs* code-behind avec les modifications suivantes :</span><span class="sxs-lookup"><span data-stu-id="fde7b-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="fde7b-183">Exécution de l'application</span><span class="sxs-lookup"><span data-stu-id="fde7b-183">Run the Application</span></span>

 <span data-ttu-id="fde7b-184">Maintenant que vous avez implémenté le code pour vérifier si l’adresse de messagerie d’un utilisateur a été confirmé, vous pouvez vérifier les fonctionnalités à la fois sur le **inscrire** et **connexion** pages.</span><span class="sxs-lookup"><span data-stu-id="fde7b-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="fde7b-185">Supprimez tous les comptes dans le **AspNetUsers** table qui contient l’alias de messagerie que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="fde7b-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="fde7b-186">Exécutez l’application (**F5**) et vérifiez que vous ne pouvez pas inscrire en tant qu’utilisateur jusqu'à ce que vous avez confirmé votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fde7b-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="fde7b-187">Avant de confirmer votre nouveau compte via le courrier électronique qui a été envoyé uniquement, tentent de se connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="fde7b-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="fde7b-188">Vous verrez que vous ne parvenez pas à se connecter et que vous devez avoir un compte de messagerie confirmée.</span><span class="sxs-lookup"><span data-stu-id="fde7b-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="fde7b-189">Après avoir confirmé votre adresse de messagerie, ouvrez une session l’application.</span><span class="sxs-lookup"><span data-stu-id="fde7b-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="fde7b-190">Réinitialisation et la récupération de mot de passe</span><span class="sxs-lookup"><span data-stu-id="fde7b-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="fde7b-191">Dans Visual Studio, supprimez les caractères de commentaire de la `Forgot` méthode dans le *Forgot.aspx.cs* code-behind contenue dans le *compte* dossier, afin que la méthode apparaît comme suit :</span><span class="sxs-lookup"><span data-stu-id="fde7b-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="fde7b-192">Ouvrez le *Login.aspx* page.</span><span class="sxs-lookup"><span data-stu-id="fde7b-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="fde7b-193">Remplacez le balisage à la fin de la **loginForm** section comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="fde7b-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="fde7b-194">Ouvrez le *Login.aspx.cs* code-behind et supprimez les commentaires de la ligne suivante de code mis en surbrillance en jaune à partir de la `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="fde7b-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="fde7b-195">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="fde7b-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="fde7b-196">Une fois la page s’affiche, cliquez sur le **connectez-vous** lien.</span><span class="sxs-lookup"><span data-stu-id="fde7b-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="fde7b-197">Cliquez sur le **votre mot de passe oublié ?** lien pour afficher le **mot de passe oublié** page.</span><span class="sxs-lookup"><span data-stu-id="fde7b-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="fde7b-198">Entrez votre adresse e-mail et cliquez sur le **envoyer** bouton pour envoyer un e-mail à votre adresse de ce qui vous permettra de réinitialiser votre mot de passe.</span><span class="sxs-lookup"><span data-stu-id="fde7b-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="fde7b-199">Vérifiez votre compte de messagerie, puis cliquez sur le lien pour afficher le **réinitialiser le mot de passe** page.</span><span class="sxs-lookup"><span data-stu-id="fde7b-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="fde7b-200">Sur le **réinitialiser le mot de passe** , entrez votre e-mail, le mot de passe et le mot de passe confirmé.</span><span class="sxs-lookup"><span data-stu-id="fde7b-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="fde7b-201">Ensuite, appuyez sur la **réinitialiser** bouton.</span><span class="sxs-lookup"><span data-stu-id="fde7b-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="fde7b-202">Lorsque vous a correctement réinitialisez votre mot de passe, le **mot de passe modifié** page s’affichera.</span><span class="sxs-lookup"><span data-stu-id="fde7b-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="fde7b-203">Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.</span><span class="sxs-lookup"><span data-stu-id="fde7b-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="fde7b-204">Renvoyer le lien de Confirmation de courrier électronique</span><span class="sxs-lookup"><span data-stu-id="fde7b-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="fde7b-205">Une fois qu’un utilisateur crée un compte local, un lien de confirmation lui est envoyé par e-mail, qu’il doit utiliser avant de pouvoir se connecter.</span><span class="sxs-lookup"><span data-stu-id="fde7b-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="fde7b-206">Si l’utilisateur supprime accidentellement l’e-mail de confirmation ou l’e-mail n’arrive jamais, ils doivent le lien de confirmation envoyé à nouveau.</span><span class="sxs-lookup"><span data-stu-id="fde7b-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="fde7b-207">Les modifications suivantes du code montrent comment faire cela.
</span><span class="sxs-lookup"><span data-stu-id="fde7b-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="fde7b-208">Dans Visual Studio, ouvrez le **Login.aspx.cs** code-behind et ajoutez le Gestionnaire d’événements suivant après le `LogIn` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="fde7b-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="fde7b-209">Modifier le `LogIn` Gestionnaire d’événements dans le *Login.aspx.cs* code-behind en modifiant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="fde7b-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="fde7b-210">Mise à jour le *Login.aspx* page en ajoutant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="fde7b-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="fde7b-211">Supprimez tous les comptes dans le **AspNetUsers** table qui contient l’alias de messagerie que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="fde7b-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="fde7b-212">Exécutez l’application (**F5**) et inscrire votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fde7b-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="fde7b-213">Avant de confirmer votre nouveau compte via le courrier électronique qui a été envoyé uniquement, tentent de se connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="fde7b-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="fde7b-214">Vous verrez que vous ne parvenez pas à se connecter et que vous devez avoir un compte de messagerie confirmée.</span><span class="sxs-lookup"><span data-stu-id="fde7b-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="fde7b-215">En outre, vous pouvez désormais renvoyer un message de confirmation à votre compte de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fde7b-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="fde7b-216">Entrez votre adresse de messagerie et le mot de passe, puis appuyez sur la **renvoyer confirmation** bouton.</span><span class="sxs-lookup"><span data-stu-id="fde7b-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="fde7b-217">Après avoir confirmé votre adresse de messagerie basée sur le message électronique qui vient d’être envoyé, connectez-vous à l’application.</span><span class="sxs-lookup"><span data-stu-id="fde7b-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="fde7b-218">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="fde7b-218">Troubleshooting the App</span></span>

<span data-ttu-id="fde7b-219">Si vous ne recevez un e-mail contenant le lien pour vérifier vos informations d’identification :</span><span class="sxs-lookup"><span data-stu-id="fde7b-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="fde7b-220">Vérifiez votre dossier des courriers indésirables.</span><span class="sxs-lookup"><span data-stu-id="fde7b-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="fde7b-221">Connectez-vous à votre compte SendGrid, puis cliquez sur le [lien activité de messagerie](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="fde7b-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="fde7b-222">Être certain que vous avez utilisé le nom de votre compte d’utilisateur SendGrid comme un *Web.config* valeur plutôt que votre adresse de messagerie du compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="fde7b-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="fde7b-223">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fde7b-223">Additional Resources</span></span>

- [<span data-ttu-id="fde7b-224">Des liens vers les ressources recommandées sur ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="fde7b-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="fde7b-225">Confirmation de compte et de récupération de mot de passe avec ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="fde7b-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="fde7b-226">Série de didacticiels ASP.NET Web Forms - ajouter le fournisseur OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="fde7b-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="fde7b-227">Déployer une application de formulaires Web ASP.NET sécurisée avec appartenance, OAuth et base de données SQL dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="fde7b-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="fde7b-228">Série de didacticiels Web Forms ASP.NET - activer SSL pour le projet</span><span class="sxs-lookup"><span data-stu-id="fde7b-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
