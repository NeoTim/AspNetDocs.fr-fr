---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Créer une application ASP.NET Web Forms sécurisée avec inscription de l’utilisateur, confirmation par e-mailC#et réinitialisation du mot de passe () | Microsoft Docs
author: Erikre
description: Ce didacticiel vous montre comment créer une application ASP.NET Web Forms avec l’inscription de l’utilisateur, la confirmation par courrier électronique et la réinitialisation du mot de passe à l’aide du membre ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78625152"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="be1be-103">Créer une application Web Forms ASP.NET sécurisée avec inscription de l’utilisateur, confirmation par e-mail et réinitialisation du mot de passe (C#)</span><span class="sxs-lookup"><span data-stu-id="be1be-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="be1be-104">par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="be1be-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="be1be-105">Ce didacticiel vous montre comment créer une application ASP.NET Web Forms avec l’inscription de l’utilisateur, la confirmation par courrier électronique et la réinitialisation du mot de passe à l’aide du système d’appartenance ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="be1be-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="be1be-106">Ce didacticiel est basé sur le [didacticiel MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)de Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="be1be-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="be1be-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="be1be-107">Introduction</span></span>

<span data-ttu-id="be1be-108">Ce didacticiel vous guide tout au long des étapes nécessaires à la création d’une application ASP.NET Web Forms à l’aide de Visual Studio et ASP.NET 4,5 pour créer une application Web Forms sécurisée avec l’inscription de l’utilisateur, la confirmation par e-mail et la réinitialisation du mot de passe.</span><span class="sxs-lookup"><span data-stu-id="be1be-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="be1be-109">Tâches et informations sur le didacticiel :</span><span class="sxs-lookup"><span data-stu-id="be1be-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="be1be-110">Créer une application de Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="be1be-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="be1be-111">Raccorder SendGrid</span><span class="sxs-lookup"><span data-stu-id="be1be-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="be1be-112">Exiger une confirmation par courrier électronique avant la connexion</span><span class="sxs-lookup"><span data-stu-id="be1be-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="be1be-113">Récupération et réinitialisation du mot de passe</span><span class="sxs-lookup"><span data-stu-id="be1be-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="be1be-114">Renvoyer le lien de confirmation par E-mail</span><span class="sxs-lookup"><span data-stu-id="be1be-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="be1be-115">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="be1be-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="be1be-116">Ressources supplémentaires pour MSBuild</span><span class="sxs-lookup"><span data-stu-id="be1be-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="be1be-117">Créer une application de Web Forms ASP.NET</span><span class="sxs-lookup"><span data-stu-id="be1be-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="be1be-118">Commencez par installer et exécuter [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="be1be-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="be1be-119">Installez [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="be1be-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="be1be-120">AVERTISSEMENT : vous devez installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou version ultérieure pour suivre ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="be1be-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="be1be-121">Créez un projet (**fichier** -&gt; **nouveau projet**), puis sélectionnez le modèle d' **application Web ASP.net** et la dernière version de .NET Framework dans la boîte de dialogue **nouveau projet** .</span><span class="sxs-lookup"><span data-stu-id="be1be-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="be1be-122">Dans la boîte de dialogue **nouveau projet ASP.net** , sélectionnez le modèle **Web Forms** .</span><span class="sxs-lookup"><span data-stu-id="be1be-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="be1be-123">Laissez l’authentification par défaut en tant que **comptes d’utilisateur individuels**.</span><span class="sxs-lookup"><span data-stu-id="be1be-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="be1be-124">Si vous souhaitez héberger l’application dans Azure, activez la case à cocher **hôte dans le Cloud** .</span><span class="sxs-lookup"><span data-stu-id="be1be-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="be1be-125">Cliquez ensuite sur **OK** pour créer le nouveau projet.</span><span class="sxs-lookup"><span data-stu-id="be1be-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="be1be-126">![Boîte de dialogue New ASP.NET Project](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="be1be-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="be1be-127">Activez protocole SSL (SSL) pour le projet.</span><span class="sxs-lookup"><span data-stu-id="be1be-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="be1be-128">Suivez les étapes disponibles dans la section **activer SSL pour le projet** de la [série prise en main avec Web Forms didacticiel](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="be1be-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="be1be-129">Exécutez l’application, cliquez sur le lien **Register** et inscrivez un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="be1be-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="be1be-130">À ce stade, la seule validation sur l’e-mail est basée sur l’attribut [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) pour garantir que l’adresse de messagerie est bien formée.</span><span class="sxs-lookup"><span data-stu-id="be1be-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="be1be-131">Vous allez modifier le code pour ajouter une confirmation par courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="be1be-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="be1be-132">Fermez la fenêtre du navigateur.</span><span class="sxs-lookup"><span data-stu-id="be1be-132">Close the browser window.</span></span>
5. <span data-ttu-id="be1be-133">Dans **Explorateur de serveurs** de Visual Studio (**afficher** -&gt; **Explorateur de serveurs**), accédez à **Data Connections\DefaultConnection\Tables\AspNetUsers**, cliquez avec le bouton droit et sélectionnez **ouvrir la définition de table**.</span><span class="sxs-lookup"><span data-stu-id="be1be-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="be1be-134">L’illustration suivante montre le schéma de la table `AspNetUsers` :</span><span class="sxs-lookup"><span data-stu-id="be1be-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schéma de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="be1be-136">Dans **Explorateur de serveurs**, cliquez avec le bouton droit sur la table **AspNetUsers** et sélectionnez **afficher les données**de la table.</span><span class="sxs-lookup"><span data-stu-id="be1be-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Données de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="be1be-138">À ce stade, l’e-mail de l’utilisateur inscrit n’a pas été confirmé.</span><span class="sxs-lookup"><span data-stu-id="be1be-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="be1be-139">Cliquez sur la ligne et sélectionnez Supprimer pour supprimer l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="be1be-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="be1be-140">Vous ajouterez à nouveau cet e-mail à l’étape suivante et envoyerez un message de confirmation à l’adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="be1be-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="be1be-141">Confirmation par e-mail</span><span class="sxs-lookup"><span data-stu-id="be1be-141">Email Confirmation</span></span>

<span data-ttu-id="be1be-142">Il est recommandé de confirmer l’e-mail lors de l’inscription d’un nouvel utilisateur afin de vérifier qu’il n’emprunte pas l’identité d’un autre utilisateur (autrement dit, s’il ne s’est pas inscrit auprès de l’e-mail de quelqu’un d’autre).</span><span class="sxs-lookup"><span data-stu-id="be1be-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="be1be-143">Supposons que vous disposiez d’un forum de discussion, vous souhaitiez empêcher `"bob@cpandl.com"` de vous inscrire en tant que `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="be1be-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="be1be-144">Sans confirmation par courrier électronique, `"joe@contoso.com"` pouvez obtenir un courrier indésirable à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="be1be-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="be1be-145">Supposons que Bob s’est inscrit accidentellement comme `"bib@cpandl.com"` et n’avait pas remarqué qu’il ne serait pas en mesure d’utiliser la récupération de mot de passe parce que l’application n’a pas son adresse e-mail correcte.</span><span class="sxs-lookup"><span data-stu-id="be1be-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="be1be-146">La confirmation par courrier électronique fournit uniquement une protection limitée des robots et ne fournit pas de protection contre les spammeurs déterminés.</span><span class="sxs-lookup"><span data-stu-id="be1be-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="be1be-147">En général, vous souhaitez empêcher les nouveaux utilisateurs de publier des données sur votre site Web avant qu’ils n’aient été confirmés par e-mail, par courrier électronique ou par un autre mécanisme.</span><span class="sxs-lookup"><span data-stu-id="be1be-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="be1be-148">Dans les sections ci-dessous, nous allons activer la confirmation par courrier électronique et modifier le code pour empêcher les utilisateurs nouvellement inscrits de se connecter jusqu’à ce que leur adresse de messagerie soit confirmée.</span><span class="sxs-lookup"><span data-stu-id="be1be-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="be1be-149">Vous utiliserez le service de messagerie SendGrid dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="be1be-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="be1be-150">Se connecter à SendGrid</span><span class="sxs-lookup"><span data-stu-id="be1be-150">Hook up SendGrid</span></span>

<span data-ttu-id="be1be-151">SendGrid a changé son API depuis que ce didacticiel a été écrit.</span><span class="sxs-lookup"><span data-stu-id="be1be-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="be1be-152">Pour obtenir les instructions SendGrid actuelles, consultez [SendGrid](http://sendgrid.com/) ou [activer la confirmation de compte et la récupération de mot de passe](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="be1be-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="be1be-153">Bien que ce didacticiel montre uniquement comment ajouter des notifications par courrier électronique via [SendGrid](http://sendgrid.com/), vous pouvez envoyer des e-mails à l’aide de SMTP et d’autres mécanismes (voir [ressources supplémentaires](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="be1be-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="be1be-154">Dans Visual Studio, ouvrez la **console du gestionnaire de package** (**Outils** -&gt; gestionnaire de **package NuGet** -&gt; **console du gestionnaire de package**), puis entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="be1be-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="be1be-155">Accédez à la [page d’inscription à Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) et inscrivez-vous pour obtenir un compte SendGrid gratuit.</span><span class="sxs-lookup"><span data-stu-id="be1be-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="be1be-156">Vous pouvez également vous inscrire pour obtenir un compte SendGrid gratuit directement sur le [site de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="be1be-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="be1be-157">À partir de **Explorateur de solutions** Ouvrez le fichier *IdentityConfig.cs* dans le dossier de démarrage de l' *application\_* et ajoutez le code suivant mis en surbrillance en jaune à la classe `EmailService` pour configurer **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="be1be-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="be1be-158">Ajoutez également les instructions `using` suivantes au début du fichier *IdentityConfig.cs* :</span><span class="sxs-lookup"><span data-stu-id="be1be-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="be1be-159">Pour simplifier cet exemple, vous allez stocker les valeurs du compte de service de messagerie dans la section `appSettings` du fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="be1be-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="be1be-160">Ajoutez le code XML suivant mis en surbrillance en jaune au fichier *Web. config* à la racine de votre projet :</span><span class="sxs-lookup"><span data-stu-id="be1be-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="be1be-161">Sécurité - Ne jamais stocker de données sensibles dans votre code source.</span><span class="sxs-lookup"><span data-stu-id="be1be-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="be1be-162">Dans cet exemple, le compte et les informations d’identification sont stockés dans la section **appSetting** du fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="be1be-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="be1be-163">Sur Azure, vous pouvez stocker ces valeurs en toute sécurité sous l’onglet **[configurer](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** de la portail Azure.</span><span class="sxs-lookup"><span data-stu-id="be1be-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="be1be-164">Pour obtenir des informations connexes, consultez la rubrique de Rick Anderson intitulée [meilleures pratiques pour le déploiement de mots de passe et d’autres données sensibles dans ASP.net et Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="be1be-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="be1be-165">Ajoutez les valeurs du service de messagerie pour refléter vos valeurs d’authentification SendGrid (nom d’utilisateur et mot de passe) afin de pouvoir envoyer des messages électroniques à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="be1be-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="be1be-166">Veillez à utiliser le nom de votre compte SendGrid plutôt que l’adresse de messagerie que vous avez fournie SendGrid.</span><span class="sxs-lookup"><span data-stu-id="be1be-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="be1be-167">Activer la confirmation par courrier électronique</span><span class="sxs-lookup"><span data-stu-id="be1be-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="be1be-168">Pour activer la confirmation par courrier électronique, vous allez modifier le code d’inscription en procédant comme suit.</span><span class="sxs-lookup"><span data-stu-id="be1be-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="be1be-169">Dans le dossier *Account* , ouvrez le code-behind *Register.aspx.cs* et mettez à jour la méthode `CreateUser_Click` pour activer les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="be1be-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="be1be-170">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur *default. aspx* , puis sélectionnez **définir comme page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="be1be-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="be1be-171">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="be1be-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="be1be-172">Une fois la page affichée, cliquez sur le lien **Register** pour afficher la page Register.</span><span class="sxs-lookup"><span data-stu-id="be1be-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="be1be-173">Entrez votre adresse de messagerie et votre mot de passe, puis cliquez sur le bouton **Register** pour envoyer un message électronique via SendGrid.</span><span class="sxs-lookup"><span data-stu-id="be1be-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="be1be-174">L’état actuel de votre projet et du code permettra à l’utilisateur de se connecter une fois qu’il aura terminé le formulaire d’inscription, même s’il n’a pas confirmé son compte.</span><span class="sxs-lookup"><span data-stu-id="be1be-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="be1be-175">Vérifiez votre compte de messagerie et cliquez sur le lien pour confirmer votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="be1be-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="be1be-176">Une fois que vous avez envoyé le formulaire d’inscription, vous êtes connecté.</span><span class="sxs-lookup"><span data-stu-id="be1be-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Exemple de site Web connecté](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="be1be-178">Exiger une confirmation par courrier électronique avant la connexion</span><span class="sxs-lookup"><span data-stu-id="be1be-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="be1be-179">Bien que vous ayez confirmé le compte de messagerie, à ce stade, il n’est pas nécessaire de cliquer sur le lien contenu dans l’e-mail de vérification pour être entièrement connecté.</span><span class="sxs-lookup"><span data-stu-id="be1be-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="be1be-180">Dans la section suivante, vous allez modifier le code nécessitant que les nouveaux utilisateurs disposent d’un e-mail confirmé avant qu’ils ne soient connectés (authentifié).</span><span class="sxs-lookup"><span data-stu-id="be1be-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="be1be-181">Dans **Explorateur de solutions** de Visual Studio, mettez à jour l’événement `CreateUser_Click` dans le code-behind *Register.aspx.cs* contenu dans le dossier *Accounts* avec les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="be1be-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="be1be-182">Mettez à jour la méthode `LogIn` dans le code-behind *login.aspx.cs* avec les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="be1be-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="be1be-183">Exécution de l'application</span><span class="sxs-lookup"><span data-stu-id="be1be-183">Run the Application</span></span>

 <span data-ttu-id="be1be-184">Maintenant que vous avez implémenté le code pour vérifier si l’adresse de messagerie d’un utilisateur a été confirmée, vous pouvez vérifier la fonctionnalité à la fois dans les pages **Register** et **login** .</span><span class="sxs-lookup"><span data-stu-id="be1be-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="be1be-185">Supprimez les comptes de la table **AspNetUsers** qui contiennent l’alias de messagerie que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="be1be-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="be1be-186">Exécutez l’application (**F5**) et vérifiez que vous ne pouvez pas vous inscrire en tant qu’utilisateur tant que vous n’avez pas confirmé votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="be1be-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="be1be-187">Avant de confirmer votre nouveau compte via l’e-mail qui vient d’être envoyé, essayez de vous connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="be1be-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="be1be-188">Vous verrez que vous ne pouvez pas vous connecter et que vous devez disposer d’un compte de messagerie confirmé.</span><span class="sxs-lookup"><span data-stu-id="be1be-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="be1be-189">Une fois que vous avez confirmé votre adresse de messagerie, connectez-vous à l’application.</span><span class="sxs-lookup"><span data-stu-id="be1be-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="be1be-190">Récupération et réinitialisation du mot de passe</span><span class="sxs-lookup"><span data-stu-id="be1be-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="be1be-191">Dans Visual Studio, supprimez les caractères de commentaire de la méthode `Forgot` dans le code-behind *Forgot.aspx.cs* contenu dans le dossier *Account* , afin que la méthode apparaisse comme suit :</span><span class="sxs-lookup"><span data-stu-id="be1be-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="be1be-192">Ouvrez la page *login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="be1be-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="be1be-193">Remplacez le balisage près de la fin de la section **loginForm** comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="be1be-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="be1be-194">Ouvrez le code-behind *login.aspx.cs* et supprimez les marques de commentaire de la ligne de code suivante mise en surbrillance en jaune à partir du gestionnaire d’événements `Page_Load` :</span><span class="sxs-lookup"><span data-stu-id="be1be-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="be1be-195">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="be1be-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="be1be-196">Une fois la page affichée, cliquez sur le lien **se connecter** .</span><span class="sxs-lookup"><span data-stu-id="be1be-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="be1be-197">Cliquez sur le lien **vous avez oublié votre mot de passe ?** pour afficher la page **mot de passe oublié** .</span><span class="sxs-lookup"><span data-stu-id="be1be-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="be1be-198">Entrez votre adresse de messagerie, puis cliquez sur le bouton **Envoyer** pour envoyer un e-mail à votre adresse, ce qui vous permettra de réinitialiser votre mot de passe.</span><span class="sxs-lookup"><span data-stu-id="be1be-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="be1be-199">Vérifiez votre compte de messagerie et cliquez sur le lien pour afficher la page **Réinitialiser le mot de passe** .</span><span class="sxs-lookup"><span data-stu-id="be1be-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="be1be-200">Dans la page **Réinitialiser le mot de passe** , entrez votre adresse e-mail, le mot de passe et le mot de passe confirmé.</span><span class="sxs-lookup"><span data-stu-id="be1be-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="be1be-201">Ensuite, appuyez sur le bouton **Réinitialiser** .</span><span class="sxs-lookup"><span data-stu-id="be1be-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="be1be-202">Lorsque vous avez correctement réinitialisé votre mot de passe, la page **modification du mot de passe** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="be1be-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="be1be-203">Vous pouvez maintenant vous connecter avec votre nouveau mot de passe.</span><span class="sxs-lookup"><span data-stu-id="be1be-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="be1be-204">Renvoyer le lien de confirmation par E-mail</span><span class="sxs-lookup"><span data-stu-id="be1be-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="be1be-205">Une fois qu’un utilisateur crée un compte local, un lien de confirmation lui est envoyé par e-mail, qu’il doit utiliser avant de pouvoir se connecter.</span><span class="sxs-lookup"><span data-stu-id="be1be-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="be1be-206">Si l’utilisateur supprime accidentellement l’e-mail de confirmation ou si l’e-mail n’arrive jamais, il a besoin du lien de confirmation renvoyé.</span><span class="sxs-lookup"><span data-stu-id="be1be-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="be1be-207">Les modifications suivantes du code montrent comment faire cela.</span><span class="sxs-lookup"><span data-stu-id="be1be-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="be1be-208">Dans Visual Studio, ouvrez le code-behind **login.aspx.cs** et ajoutez le gestionnaire d’événements suivant après le `LogIn` gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="be1be-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="be1be-209">Modifiez le gestionnaire d’événements `LogIn` dans le code-behind *login.aspx.cs* en modifiant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="be1be-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="be1be-210">Mettez à jour la page *login. aspx* en ajoutant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="be1be-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="be1be-211">Supprimez les comptes de la table **AspNetUsers** qui contiennent l’alias de messagerie que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="be1be-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="be1be-212">Exécutez l’application (**F5**) et inscrivez votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="be1be-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="be1be-213">Avant de confirmer votre nouveau compte via l’e-mail qui vient d’être envoyé, essayez de vous connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="be1be-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="be1be-214">Vous verrez que vous ne pouvez pas vous connecter et que vous devez disposer d’un compte de messagerie confirmé.</span><span class="sxs-lookup"><span data-stu-id="be1be-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="be1be-215">En outre, vous pouvez à présent renvoyer un message de confirmation à votre compte de messagerie.</span><span class="sxs-lookup"><span data-stu-id="be1be-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="be1be-216">Entrez votre adresse de messagerie et votre mot de passe, puis appuyez sur le bouton de **confirmation de renvoi** .</span><span class="sxs-lookup"><span data-stu-id="be1be-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="be1be-217">Une fois que vous avez confirmé votre adresse de messagerie en fonction du message électronique que vous venez d’envoyer, connectez-vous à l’application.</span><span class="sxs-lookup"><span data-stu-id="be1be-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="be1be-218">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="be1be-218">Troubleshooting the App</span></span>

<span data-ttu-id="be1be-219">Si vous ne recevez pas de courrier électronique contenant le lien permettant de vérifier vos informations d’identification :</span><span class="sxs-lookup"><span data-stu-id="be1be-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="be1be-220">Vérifiez votre dossier des courriers indésirables.</span><span class="sxs-lookup"><span data-stu-id="be1be-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="be1be-221">Connectez-vous à votre compte SendGrid et cliquez sur le [lien activité de messagerie](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="be1be-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="be1be-222">Assurez-vous que vous avez utilisé le nom de votre compte d’utilisateur SendGrid en tant que valeur *Web. config* plutôt que votre adresse de messagerie de compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="be1be-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="be1be-223">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="be1be-223">Additional Resources</span></span>

- [<span data-ttu-id="be1be-224">Liens vers les ressources ASP.NET Identity recommandées</span><span class="sxs-lookup"><span data-stu-id="be1be-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="be1be-225">Confirmation de compte et récupération de mot de passe avec ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="be1be-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="be1be-226">Série de didacticiels Web Forms ASP.NET-ajouter un fournisseur OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="be1be-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="be1be-227">Déployer une application ASP.NET Web Forms sécurisée avec appartenance, OAuth et SQL Database à Azure App Service</span><span class="sxs-lookup"><span data-stu-id="be1be-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="be1be-228">Série de didacticiels ASP.NET Web Forms-activer SSL pour le projet</span><span class="sxs-lookup"><span data-stu-id="be1be-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
