---
uid: web-api/overview/security/authentication-and-authorization-in-aspnet-web-api
title: Authentification et autorisation dans ASP.NET’API Web (en anglais seulement) Microsoft Docs
author: MikeWasson
description: Donne un aperçu général de l’authentification et de l’autorisation dans ASP.NET’API Web.
ms.author: riande
ms.date: 11/27/2012
ms.assetid: 6dfb51ea-9f4d-4e70-916c-8ef8344a88d6
msc.legacyurl: /web-api/overview/security/authentication-and-authorization-in-aspnet-web-api
msc.type: authoredcontent
ms.openlocfilehash: 368d2b9456d12b2bb4063a23333e5c8837faa3b8
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80676257"
---
# <a name="authentication-and-authorization-in-aspnet-web-api"></a><span data-ttu-id="eacfd-103">Authentication and Authorization in ASP.NET Web API (Authentification et autorisation dans l’API Web ASP.NET)</span><span class="sxs-lookup"><span data-stu-id="eacfd-103">Authentication and Authorization in ASP.NET Web API</span></span>

<span data-ttu-id="eacfd-104">par [Mike Wasson](https://github.com/MikeWasson)</span><span class="sxs-lookup"><span data-stu-id="eacfd-104">by [Mike Wasson](https://github.com/MikeWasson)</span></span>

<span data-ttu-id="eacfd-105">Vous avez créé une API Web, mais maintenant vous souhaitez contrôler l’accès à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="eacfd-105">You've created a web API, but now you want to control access to it.</span></span> <span data-ttu-id="eacfd-106">Dans cette série d’articles, nous examinerons certaines options pour sécuriser une API Web auprès d’utilisateurs non autorisés.</span><span class="sxs-lookup"><span data-stu-id="eacfd-106">In this series of articles, we'll look at some options for securing a web API from unauthorized users.</span></span> <span data-ttu-id="eacfd-107">Cette série couvrira à la fois l’authentification et l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="eacfd-107">This series will cover both authentication and authorization.</span></span>

- <span data-ttu-id="eacfd-108">*L’authentification* est de connaître l’identité de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-108">*Authentication* is knowing the identity of the user.</span></span> <span data-ttu-id="eacfd-109">Par exemple, Alice se connecte avec son nom d’utilisateur et son mot de passe, et le serveur utilise le mot de passe pour authentifier Alice.</span><span class="sxs-lookup"><span data-stu-id="eacfd-109">For example, Alice logs in with her username and password, and the server uses the password to authenticate Alice.</span></span>
- <span data-ttu-id="eacfd-110">*L’autorisation* est de décider si un utilisateur est autorisé à effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="eacfd-110">*Authorization* is deciding whether a user is allowed to perform an action.</span></span> <span data-ttu-id="eacfd-111">Par exemple, Alice a la permission d’obtenir une ressource, mais pas de créer une ressource.</span><span class="sxs-lookup"><span data-stu-id="eacfd-111">For example, Alice has permission to get a resource but not create a resource.</span></span>

<span data-ttu-id="eacfd-112">Le premier article de la série donne un aperçu général de l’authentification et de l’autorisation dans ASP.NET’API Web.</span><span class="sxs-lookup"><span data-stu-id="eacfd-112">The first article in the series gives a general overview of authentication and authorization in ASP.NET Web API.</span></span> <span data-ttu-id="eacfd-113">D’autres sujets décrivent des scénarios d’authentification courants pour l’API Web.</span><span class="sxs-lookup"><span data-stu-id="eacfd-113">Other topics describe common authentication scenarios for Web API.</span></span>

> [!NOTE]
> <span data-ttu-id="eacfd-114">Merci aux personnes qui ont passé en revue cette série et fourni des commentaires précieux: Rick Anderson, Levi Broderick, Barry Dorrans, Tom Dykstra, Hongmei Ge, David Matson, Daniel Roth, Tim Teebken.</span><span class="sxs-lookup"><span data-stu-id="eacfd-114">Thanks to the people who reviewed this series and provided valuable feedback: Rick Anderson, Levi Broderick, Barry Dorrans, Tom Dykstra, Hongmei Ge, David Matson, Daniel Roth, Tim Teebken.</span></span>

## <a name="authentication"></a><span data-ttu-id="eacfd-115">Authentification</span><span class="sxs-lookup"><span data-stu-id="eacfd-115">Authentication</span></span>

<span data-ttu-id="eacfd-116">L’API Web suppose que l’authentification se produit dans l’hôte.</span><span class="sxs-lookup"><span data-stu-id="eacfd-116">Web API assumes that authentication happens in the host.</span></span> <span data-ttu-id="eacfd-117">Pour l’hébergement web, l’hôte est IIS, qui utilise des modules HTTP pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="eacfd-117">For web-hosting, the host is IIS, which uses HTTP modules for authentication.</span></span> <span data-ttu-id="eacfd-118">Vous pouvez configurer votre projet pour utiliser l’un des modules d’authentification intégrés à l’IIS ou à ASP.NET, ou écrire votre propre module HTTP pour effectuer une authentification personnalisée.</span><span class="sxs-lookup"><span data-stu-id="eacfd-118">You can configure your project to use any of the authentication modules built in to IIS or ASP.NET, or write your own HTTP module to perform custom authentication.</span></span>

<span data-ttu-id="eacfd-119">Lorsque l’hôte authentifie l’utilisateur, il crée un *principal*, qui est un objet [IPrincipal](https://msdn.microsoft.com/library/System.Security.Principal.IPrincipal.aspx) qui représente le contexte de sécurité dans lequel le code est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="eacfd-119">When the host authenticates the user, it creates a *principal*, which is an [IPrincipal](https://msdn.microsoft.com/library/System.Security.Principal.IPrincipal.aspx) object that represents the security context under which code is running.</span></span> <span data-ttu-id="eacfd-120">L’hôte attache le principal au fil actuel en définissant **Thread.CurrentPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-120">The host attaches the principal to the current thread by setting **Thread.CurrentPrincipal**.</span></span> <span data-ttu-id="eacfd-121">Le principal contient un objet **d’identité** associé qui contient des informations sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-121">The principal contains an associated **Identity** object that contains information about the user.</span></span> <span data-ttu-id="eacfd-122">Si l’utilisateur est authentifié, la propriété **Identity.IsAuthenticated** retourne **vrai**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-122">If the user is authenticated, the **Identity.IsAuthenticated** property returns **true**.</span></span> <span data-ttu-id="eacfd-123">Pour les demandes anonymes, **IsAuthenticated** renvoie **faux**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-123">For anonymous requests, **IsAuthenticated** returns **false**.</span></span> <span data-ttu-id="eacfd-124">Pour plus d’informations sur les directeurs d’école, voir [Sécurité basée sur les rôles](https://msdn.microsoft.com/library/shz8h065.aspx).</span><span class="sxs-lookup"><span data-stu-id="eacfd-124">For more information about principals, see [Role-Based Security](https://msdn.microsoft.com/library/shz8h065.aspx).</span></span>

### <a name="http-message-handlers-for-authentication"></a><span data-ttu-id="eacfd-125">HTTP Message Handlers pour l’authentification</span><span class="sxs-lookup"><span data-stu-id="eacfd-125">HTTP Message Handlers for Authentication</span></span>

<span data-ttu-id="eacfd-126">Au lieu d’utiliser l’hôte pour l’authentification, vous pouvez mettre la logique d’authentification dans un [gestionnaire de message HTTP](../advanced/http-message-handlers.md).</span><span class="sxs-lookup"><span data-stu-id="eacfd-126">Instead of using the host for authentication, you can put authentication logic into an [HTTP message handler](../advanced/http-message-handlers.md).</span></span> <span data-ttu-id="eacfd-127">Dans ce cas, le gestionnaire de message examine la demande HTTP et fixe le directeur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-127">In that case, the message handler examines the HTTP request and sets the principal.</span></span>

<span data-ttu-id="eacfd-128">Quand devriez-vous utiliser des gestionnaires de messages pour l’authentification?</span><span class="sxs-lookup"><span data-stu-id="eacfd-128">When should you use message handlers for authentication?</span></span> <span data-ttu-id="eacfd-129">Voici quelques compromis :</span><span class="sxs-lookup"><span data-stu-id="eacfd-129">Here are some tradeoffs:</span></span>

- <span data-ttu-id="eacfd-130">Un module HTTP voit toutes les demandes qui passent par le pipeline ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="eacfd-130">An HTTP module sees all requests that go through the ASP.NET pipeline.</span></span> <span data-ttu-id="eacfd-131">Un gestionnaire de message ne voit que les demandes qui sont acheminées vers l’API Web.</span><span class="sxs-lookup"><span data-stu-id="eacfd-131">A message handler only sees requests that are routed to Web API.</span></span>
- <span data-ttu-id="eacfd-132">Vous pouvez définir des gestionnaires de messages par itinéraire, ce qui vous permet d’appliquer un schéma d’authentification à un itinéraire spécifique.</span><span class="sxs-lookup"><span data-stu-id="eacfd-132">You can set per-route message handlers, which lets you apply an authentication scheme to a specific route.</span></span>
- <span data-ttu-id="eacfd-133">Les modules HTTP sont spécifiques à l’IIS.</span><span class="sxs-lookup"><span data-stu-id="eacfd-133">HTTP modules are specific to IIS.</span></span> <span data-ttu-id="eacfd-134">Les gestionnaires de messages sont agnostiques, de sorte qu’ils peuvent être utilisés à la fois avec l’hébergement Web et l’auto-hébergement.</span><span class="sxs-lookup"><span data-stu-id="eacfd-134">Message handlers are host-agnostic, so they can be used with both web-hosting and self-hosting.</span></span>
- <span data-ttu-id="eacfd-135">Les modules HTTP participent à l’enregistrement, à l’audit de l’IIS, etc.</span><span class="sxs-lookup"><span data-stu-id="eacfd-135">HTTP modules participate in IIS logging, auditing, and so on.</span></span>
- <span data-ttu-id="eacfd-136">Les modules HTTP s’exécutent plus tôt dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="eacfd-136">HTTP modules run earlier in the pipeline.</span></span> <span data-ttu-id="eacfd-137">Si vous gérez l’authentification dans un gestionnaire de message, le directeur ne se configure pas tant que le gestionnaire ne s’exécute pas.</span><span class="sxs-lookup"><span data-stu-id="eacfd-137">If you handle authentication in a message handler, the principal does not get set until the handler runs.</span></span> <span data-ttu-id="eacfd-138">De plus, le directeur revient au principal précédent lorsque la réponse quitte le gestionnaire de message.</span><span class="sxs-lookup"><span data-stu-id="eacfd-138">Moreover, the principal reverts back to the previous principal when the response leaves the message handler.</span></span>

<span data-ttu-id="eacfd-139">En général, si vous n’avez pas besoin de prendre en charge l’auto-hébergement, un module HTTP est une meilleure option.</span><span class="sxs-lookup"><span data-stu-id="eacfd-139">Generally, if you don't need to support self-hosting, an HTTP module is a better option.</span></span> <span data-ttu-id="eacfd-140">Si vous avez besoin de prendre en charge l’auto-hébergement, considérez un gestionnaire de message.</span><span class="sxs-lookup"><span data-stu-id="eacfd-140">If you need to support self-hosting, consider a message handler.</span></span>

### <a name="setting-the-principal"></a><span data-ttu-id="eacfd-141">Définir le principal</span><span class="sxs-lookup"><span data-stu-id="eacfd-141">Setting the Principal</span></span>

<span data-ttu-id="eacfd-142">Si votre application exécute une logique d’authentification personnalisée, vous devez définir le principe sur deux endroits :</span><span class="sxs-lookup"><span data-stu-id="eacfd-142">If your application performs any custom authentication logic, you must set the principal on two places:</span></span>

- <span data-ttu-id="eacfd-143">**Thread.CurrentPrincipal**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-143">**Thread.CurrentPrincipal**.</span></span> <span data-ttu-id="eacfd-144">Cette propriété est le moyen standard de définir le principal du thread en .NET.</span><span class="sxs-lookup"><span data-stu-id="eacfd-144">This property is the standard way to set the thread's principal in .NET.</span></span>
- <span data-ttu-id="eacfd-145">**HttpContext.Current.User**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-145">**HttpContext.Current.User**.</span></span> <span data-ttu-id="eacfd-146">Cette propriété est spécifique à ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="eacfd-146">This property is specific to ASP.NET.</span></span>

<span data-ttu-id="eacfd-147">Le code suivant montre comment définir le principe :</span><span class="sxs-lookup"><span data-stu-id="eacfd-147">The following code shows how to set the principal:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample1.cs)]

<span data-ttu-id="eacfd-148">Pour l’hébergement web, vous devez définir le directeur dans les deux endroits; sinon, le contexte de la sécurité peut devenir incohérent.</span><span class="sxs-lookup"><span data-stu-id="eacfd-148">For web-hosting, you must set the principal in both places; otherwise the security context may become inconsistent.</span></span> <span data-ttu-id="eacfd-149">Pour l’auto-hébergement, cependant, **HttpContext.Current** est nul.</span><span class="sxs-lookup"><span data-stu-id="eacfd-149">For self-hosting, however, **HttpContext.Current** is null.</span></span> <span data-ttu-id="eacfd-150">Pour vous assurer que votre code est hôte-agnostique, par conséquent, vérifiez l’annulation avant d’être affecté à **HttpContext.Current**, comme indiqué.</span><span class="sxs-lookup"><span data-stu-id="eacfd-150">To ensure your code is host-agnostic, therefore, check for null before assigning to **HttpContext.Current**, as shown.</span></span>

## <a name="authorization"></a><span data-ttu-id="eacfd-151">Autorisation</span><span class="sxs-lookup"><span data-stu-id="eacfd-151">Authorization</span></span>

<span data-ttu-id="eacfd-152">L’autorisation se fait plus tard dans le pipeline, plus près du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-152">Authorization happens later in the pipeline, closer to the controller.</span></span> <span data-ttu-id="eacfd-153">Cela vous permet de faire des choix plus granulaires lorsque vous accordez l’accès aux ressources.</span><span class="sxs-lookup"><span data-stu-id="eacfd-153">That lets you make more granular choices when you grant access to resources.</span></span>

- <span data-ttu-id="eacfd-154">*Les filtres d’autorisation* s’exécutent avant l’action du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-154">*Authorization filters* run before the controller action.</span></span> <span data-ttu-id="eacfd-155">Si la demande n’est pas autorisée, le filtre renvoie une réponse d’erreur, et l’action n’est pas invoquée.</span><span class="sxs-lookup"><span data-stu-id="eacfd-155">If the request is not authorized, the filter returns an error response, and the action is not invoked.</span></span>
- <span data-ttu-id="eacfd-156">Dans le cadre d’une action de contrôleur, vous pouvez obtenir le principal actuel de la propriété **ApiController.User.**</span><span class="sxs-lookup"><span data-stu-id="eacfd-156">Within a controller action, you can get the current principal from the **ApiController.User** property.</span></span> <span data-ttu-id="eacfd-157">Par exemple, vous pouvez filtrer une liste de ressources en fonction du nom d’utilisateur, en ne retournant que les ressources qui appartiennent à cet utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-157">For example, you might filter a list of resources based on the user name, returning only those resources that belong to that user.</span></span>

![](authentication-and-authorization-in-aspnet-web-api/_static/image1.png)

<a id="auth3"></a>
### <a name="using-the-authorize-attribute"></a><span data-ttu-id="eacfd-158">Utilisation de l’attribut [Autoriser]</span><span class="sxs-lookup"><span data-stu-id="eacfd-158">Using the [Authorize] Attribute</span></span>

<span data-ttu-id="eacfd-159">L’API Web fournit un filtre d’autorisation intégré, [AutoriserAttribute](https://msdn.microsoft.com/library/system.web.http.authorizeattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="eacfd-159">Web API provides a built-in authorization filter, [AuthorizeAttribute](https://msdn.microsoft.com/library/system.web.http.authorizeattribute.aspx).</span></span> <span data-ttu-id="eacfd-160">Ce filtre vérifie si l’utilisateur est authentifié.</span><span class="sxs-lookup"><span data-stu-id="eacfd-160">This filter checks whether the user is authenticated.</span></span> <span data-ttu-id="eacfd-161">Si ce n’est pas le cas, il renvoie le code d’état HTTP 401 (non autorisé), sans invoquer l’action.</span><span class="sxs-lookup"><span data-stu-id="eacfd-161">If not, it returns HTTP status code 401 (Unauthorized), without invoking the action.</span></span>

<span data-ttu-id="eacfd-162">Vous pouvez appliquer le filtre à l’échelle mondiale, au niveau du contrôleur ou au niveau des actions individuelles.</span><span class="sxs-lookup"><span data-stu-id="eacfd-162">You can apply the filter globally, at the controller level, or at the level of individual actions.</span></span>

<span data-ttu-id="eacfd-163">**Globalement**: Pour restreindre l’accès pour chaque contrôleur d’API Web, ajoutez le filtre Autoriser à la liste des **filtres** globaux :</span><span class="sxs-lookup"><span data-stu-id="eacfd-163">**Globally**: To restrict access for every Web API controller, add the **AuthorizeAttribute** filter to the global filter list:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample2.cs)]

<span data-ttu-id="eacfd-164">**Contrôleur**: Pour restreindre l’accès d’un contrôleur spécifique, ajoutez le filtre comme attribut au contrôleur :</span><span class="sxs-lookup"><span data-stu-id="eacfd-164">**Controller**: To restrict access for a specific controller, add the filter as an attribute to the controller:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample3.cs)]

<span data-ttu-id="eacfd-165">**Action**: Pour restreindre l’accès à des actions spécifiques, ajoutez l’attribut à la méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="eacfd-165">**Action**: To restrict access for specific actions, add the attribute to the action method:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample4.cs)]

<span data-ttu-id="eacfd-166">Alternativement, vous pouvez restreindre le contrôleur et ensuite autoriser `[AllowAnonymous]` un accès anonyme à des actions spécifiques, en utilisant l’attribut.</span><span class="sxs-lookup"><span data-stu-id="eacfd-166">Alternatively, you can restrict the controller and then allow anonymous access to specific actions, by using the `[AllowAnonymous]` attribute.</span></span> <span data-ttu-id="eacfd-167">Dans l’exemple `Post` suivant, la méthode `Get` est limitée, mais la méthode permet un accès anonyme.</span><span class="sxs-lookup"><span data-stu-id="eacfd-167">In the following example, the `Post` method is restricted, but the `Get` method allows anonymous access.</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample5.cs)]

<span data-ttu-id="eacfd-168">Dans les exemples précédents, le filtre permet à tout utilisateur authentifié d’accéder aux méthodes restreintes; seuls les utilisateurs anonymes sont tenus à l’écart. Vous pouvez également limiter l’accès à des utilisateurs spécifiques ou aux utilisateurs dans des rôles spécifiques :</span><span class="sxs-lookup"><span data-stu-id="eacfd-168">In the previous examples, the filter allows any authenticated user to access the restricted methods; only anonymous users are kept out. You can also limit access to specific users or to users in specific roles:</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample6.cs)]

> [!NOTE]
> <span data-ttu-id="eacfd-169">Le filtre **Autoriserattribute** pour les contrôleurs Web API est situé dans l’espace de nom **System.Web.Http.**</span><span class="sxs-lookup"><span data-stu-id="eacfd-169">The **AuthorizeAttribute** filter for Web API controllers is located in the **System.Web.Http** namespace.</span></span> <span data-ttu-id="eacfd-170">Il existe un filtre similaire pour les contrôleurs MVC dans l’espace de nom **System.Web.Mvc,** qui n’est pas compatible avec les contrôleurs Web API.</span><span class="sxs-lookup"><span data-stu-id="eacfd-170">There is a similar filter for MVC controllers in the **System.Web.Mvc** namespace, which is not compatible with Web API controllers.</span></span>

### <a name="custom-authorization-filters"></a><span data-ttu-id="eacfd-171">Filtres d’autorisation personnalisés</span><span class="sxs-lookup"><span data-stu-id="eacfd-171">Custom Authorization Filters</span></span>

<span data-ttu-id="eacfd-172">Pour écrire un filtre d’autorisation personnalisé, dérivez de l’un de ces types :</span><span class="sxs-lookup"><span data-stu-id="eacfd-172">To write a custom authorization filter, derive from one of these types:</span></span>

- <span data-ttu-id="eacfd-173">**AutoriserAttribute**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-173">**AuthorizeAttribute**.</span></span> <span data-ttu-id="eacfd-174">Étendre cette classe pour effectuer la logique d’autorisation basée sur l’utilisateur actuel et les rôles de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-174">Extend this class to perform authorization logic based on the current user and the user's roles.</span></span>
- <span data-ttu-id="eacfd-175">**AutorisationFilterAttribute**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-175">**AuthorizationFilterAttribute**.</span></span> <span data-ttu-id="eacfd-176">Étendre cette classe pour effectuer une logique d’autorisation synchrone qui n’est pas nécessairement basée sur l’utilisateur ou le rôle actuel.</span><span class="sxs-lookup"><span data-stu-id="eacfd-176">Extend this class to perform synchronous authorization logic that is not necessarily based on the current user or role.</span></span>
- <span data-ttu-id="eacfd-177">**IAuthorizationFilter**.</span><span class="sxs-lookup"><span data-stu-id="eacfd-177">**IAuthorizationFilter**.</span></span> <span data-ttu-id="eacfd-178">Implémentez cette interface pour effectuer une logique d’autorisation asynchrone ; par exemple, si votre logique d’autorisation fait des appels asynchrones I/O ou réseau.</span><span class="sxs-lookup"><span data-stu-id="eacfd-178">Implement this interface to perform asynchronous authorization logic; for example, if your authorization logic makes asynchronous I/O or network calls.</span></span> <span data-ttu-id="eacfd-179">(Si votre logique d’autorisation est liée au processeur, il est plus simple de dériver de **AuthorizationFilterAttribute**, parce que vous n’avez pas besoin d’écrire une méthode asynchrone.)</span><span class="sxs-lookup"><span data-stu-id="eacfd-179">(If your authorization logic is CPU-bound, it is simpler to derive from **AuthorizationFilterAttribute**, because then you don't need to write an asynchronous method.)</span></span>

<span data-ttu-id="eacfd-180">Le diagramme suivant montre la hiérarchie de classe pour la classe **Autoriser.**</span><span class="sxs-lookup"><span data-stu-id="eacfd-180">The following diagram shows the class hierarchy for the **AuthorizeAttribute** class.</span></span>

![](authentication-and-authorization-in-aspnet-web-api/_static/image2.png)

### <a name="authorization-inside-a-controller-action"></a><span data-ttu-id="eacfd-181">Autorisation à l’intérieur d’une action de contrôleur</span><span class="sxs-lookup"><span data-stu-id="eacfd-181">Authorization Inside a Controller Action</span></span>

<span data-ttu-id="eacfd-182">Dans certains cas, vous pouvez autoriser une demande de procéder, mais changer le comportement en fonction du principal.</span><span class="sxs-lookup"><span data-stu-id="eacfd-182">In some cases, you might allow a request to proceed, but change the behavior based on the principal.</span></span> <span data-ttu-id="eacfd-183">Par exemple, les informations que vous retournez peuvent changer en fonction du rôle de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eacfd-183">For example, the information that you return might change depending on the user's role.</span></span> <span data-ttu-id="eacfd-184">Dans le cadre d’une méthode de contrôleur, vous pouvez obtenir le principal actuel de la propriété **ApiController.User.**</span><span class="sxs-lookup"><span data-stu-id="eacfd-184">Within a controller method, you can get the current principal from the **ApiController.User** property.</span></span>

[!code-csharp[Main](authentication-and-authorization-in-aspnet-web-api/samples/sample7.cs)]
