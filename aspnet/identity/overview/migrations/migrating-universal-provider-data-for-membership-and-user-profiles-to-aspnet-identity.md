---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migration des données du fournisseur universel pour les profils d’appartenance etC#utilisateur vers ASP.net Identity ()-ASP.net 4. x
author: rustd
description: Ce didacticiel décrit les étapes nécessaires à la migration des données d’utilisateur et de rôle, ainsi que des données de profil utilisateur créées à l’aide de Fournisseurs universels d’une application existante...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 31f02a0cec3c531c45c37b7aad8456e01e80b5ea
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456112"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="69b90-103">Migration des données du fournisseur universel pour l’appartenance et les profils utilisateur vers ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="69b90-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="69b90-104">par [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="69b90-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="69b90-105">Ce didacticiel décrit les étapes nécessaires à la migration des données d’utilisateur et de rôle, ainsi que des données de profil utilisateur créées à l’aide de Fournisseurs universels d’une application existante vers le modèle de ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="69b90-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="69b90-106">L’approche mentionnée ici pour migrer les données de profil utilisateur peut également être utilisée dans une application avec l’appartenance SQL.</span><span class="sxs-lookup"><span data-stu-id="69b90-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="69b90-107">Avec la publication de Visual Studio 2013, l’équipe ASP.NET a introduit un nouveau système ASP.NET Identity, et vous pouvez en savoir plus sur cette version [ici](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="69b90-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="69b90-108">À la suite de l’article pour migrer des applications Web de l' [appartenance SQL vers le nouveau système d’identité](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), cet article décrit les étapes de migration des applications existantes qui suivent le modèle de fournisseurs pour la gestion des utilisateurs et des rôles vers le nouveau modèle d’identité.</span><span class="sxs-lookup"><span data-stu-id="69b90-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="69b90-109">Ce didacticiel se concentre principalement sur la migration des données de profil utilisateur pour les raccorder en toute transparence au nouveau système.</span><span class="sxs-lookup"><span data-stu-id="69b90-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="69b90-110">La migration des informations d’utilisateur et de rôle est similaire pour l’appartenance SQL.</span><span class="sxs-lookup"><span data-stu-id="69b90-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="69b90-111">L’approche suivie pour migrer des données de profil peut également être utilisée dans une application avec l’appartenance SQL.</span><span class="sxs-lookup"><span data-stu-id="69b90-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="69b90-112">Par exemple, nous allons commencer par une application Web créée à l’aide de Visual Studio 2012 qui utilise le modèle de fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="69b90-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="69b90-113">Nous allons ensuite ajouter du code pour la gestion des profils, inscrire un utilisateur, ajouter des données de profil pour les utilisateurs, migrer le schéma de base de données, puis modifier l’application pour utiliser le système d’identité pour la gestion des utilisateurs et des rôles.</span><span class="sxs-lookup"><span data-stu-id="69b90-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="69b90-114">En guise de test de migration, les utilisateurs créés à l’aide de Fournisseurs universels doivent pouvoir se connecter et de nouveaux utilisateurs doivent être en mesure de s’inscrire.</span><span class="sxs-lookup"><span data-stu-id="69b90-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="69b90-115">Vous trouverez l’exemple complet sur [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="69b90-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>

## <a name="profile-data-migration-summary"></a><span data-ttu-id="69b90-116">Résumé de la migration des données de profil</span><span class="sxs-lookup"><span data-stu-id="69b90-116">Profile data migration summary</span></span>

<span data-ttu-id="69b90-117">Avant de commencer avec les migrations, penchons-nous sur l’expérience de stockage des données de profil dans le modèle fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="69b90-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="69b90-118">Les données de profil pour les utilisateurs d’application peuvent être stockées de plusieurs façons, les plus fréquentes parmi celles qui utilisent les fournisseurs de profils intégrés fournis avec l’Fournisseurs universels.</span><span class="sxs-lookup"><span data-stu-id="69b90-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="69b90-119">Les étapes sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="69b90-119">The steps would include</span></span>

1. <span data-ttu-id="69b90-120">Ajoutez une classe qui possède des propriétés utilisées pour stocker des données de profil.</span><span class="sxs-lookup"><span data-stu-id="69b90-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="69b90-121">Ajoutez une classe qui étend « ProfileBase » et implémente des méthodes pour obtenir les données de profil ci-dessus pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="69b90-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="69b90-122">Activez l’utilisation des fournisseurs de profils par défaut dans le fichier *Web. config* et définissez la classe déclarée dans l’étape #2 à utiliser pour accéder aux informations de profil.</span><span class="sxs-lookup"><span data-stu-id="69b90-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="69b90-123">Les informations de profil sont stockées sous forme de données XML et binaires sérialisées dans la table « profiles » de la base de données.</span><span class="sxs-lookup"><span data-stu-id="69b90-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="69b90-124">Après la migration de l’application pour utiliser le nouveau système de ASP.NET Identity, les informations de profil sont désérialisées et stockées sous forme de propriétés sur la classe utilisateur.</span><span class="sxs-lookup"><span data-stu-id="69b90-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="69b90-125">Chaque propriété peut ensuite être mappée sur les colonnes de la table utilisateur.</span><span class="sxs-lookup"><span data-stu-id="69b90-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="69b90-126">L’avantage ici est que les propriétés peuvent être utilisées directement à l’aide de la classe utilisateur, en plus de ne pas avoir à sérialiser/désérialiser les informations de données à chaque fois qu’elle y accède.</span><span class="sxs-lookup"><span data-stu-id="69b90-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="69b90-127">Mise en route</span><span class="sxs-lookup"><span data-stu-id="69b90-127">Getting Started</span></span>

1. <span data-ttu-id="69b90-128">Créez une nouvelle application ASP.NET 4,5 Web Forms dans Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="69b90-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="69b90-129">L’exemple actuel utilise le modèle Web Forms, mais vous pouvez également utiliser l’application MVC.</span><span class="sxs-lookup"><span data-stu-id="69b90-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="69b90-130">Créer un nouveau dossier « Models » pour stocker les informations de profil</span><span class="sxs-lookup"><span data-stu-id="69b90-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="69b90-131">À titre d’exemple, laissez-nous stocker la date de naissance, la ville, la hauteur et le poids de l’utilisateur dans le profil.</span><span class="sxs-lookup"><span data-stu-id="69b90-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="69b90-132">La hauteur et la pondération sont stockées sous la forme d’une classe personnalisée appelée « PersonalStats ».</span><span class="sxs-lookup"><span data-stu-id="69b90-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="69b90-133">Pour stocker et récupérer le profil, nous avons besoin d’une classe qui étend’ProfileBase'.</span><span class="sxs-lookup"><span data-stu-id="69b90-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="69b90-134">Créons une nouvelle classe « AppProfile » pour obtenir et stocker les informations de profil.</span><span class="sxs-lookup"><span data-stu-id="69b90-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="69b90-135">Activez le profil dans le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="69b90-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="69b90-136">Entrez le nom de la classe à utiliser pour stocker/récupérer les informations utilisateur créées à l’étape #3.</span><span class="sxs-lookup"><span data-stu-id="69b90-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="69b90-137">Ajoutez une page Web Forms dans le dossier « Account » pour obtenir les données de profil de l’utilisateur et les stocker.</span><span class="sxs-lookup"><span data-stu-id="69b90-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="69b90-138">Cliquez avec le bouton droit sur le projet, puis sélectionnez Ajouter un nouvel élément.</span><span class="sxs-lookup"><span data-stu-id="69b90-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="69b90-139">Ajoutez une nouvelle page Web Forms avec la page maître « AddProfileData. aspx ».</span><span class="sxs-lookup"><span data-stu-id="69b90-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="69b90-140">Copiez ce qui suit dans la section « MainContent » :</span><span class="sxs-lookup"><span data-stu-id="69b90-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="69b90-141">Ajoutez le code suivant dans le code-behind :</span><span class="sxs-lookup"><span data-stu-id="69b90-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="69b90-142">Ajoutez l’espace de noms sous lequel la classe AppProfile est définie pour supprimer les erreurs de compilation.</span><span class="sxs-lookup"><span data-stu-id="69b90-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="69b90-143">Exécutez l’application et créez un nouvel utilisateur avec le nom d’utilisateur «**Olduser ».**</span><span class="sxs-lookup"><span data-stu-id="69b90-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="69b90-144">Accédez à la page « AddProfileData » et ajoutez des informations de profil pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="69b90-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="69b90-145">Vous pouvez vérifier que les données sont stockées en tant que code XML sérialisé dans la table « profils » à l’aide de la fenêtre Explorateur de serveurs.</span><span class="sxs-lookup"><span data-stu-id="69b90-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="69b90-146">Dans Visual Studio, dans le menu Affichage, choisissez « Explorateur de serveurs ».</span><span class="sxs-lookup"><span data-stu-id="69b90-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="69b90-147">Il doit y avoir une connexion de données pour la base de données définie dans le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="69b90-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="69b90-148">En cliquant sur la connexion de données, vous affichez différentes sous-catégories.</span><span class="sxs-lookup"><span data-stu-id="69b90-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="69b90-149">Développez « tables » pour afficher les différentes tables de votre base de données, cliquez avec le bouton droit sur « profils », puis choisissez « afficher les données de la table » pour afficher les données de profil stockées dans la table profils.</span><span class="sxs-lookup"><span data-stu-id="69b90-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="69b90-150">Migration du schéma de base de données</span><span class="sxs-lookup"><span data-stu-id="69b90-150">Migrating database schema</span></span>

<span data-ttu-id="69b90-151">Pour que la base de données existante fonctionne avec le système d’identité, nous devons mettre à jour le schéma dans la base de données d’identité afin de prendre en charge les champs que vous avez ajoutés à la base de données d’origine.</span><span class="sxs-lookup"><span data-stu-id="69b90-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="69b90-152">Pour ce faire, vous pouvez utiliser des scripts SQL pour créer des tables et copier les informations existantes.</span><span class="sxs-lookup"><span data-stu-id="69b90-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="69b90-153">Dans la fenêtre’Explorateur de serveurs', développez « DefaultConnection » pour afficher les tables.</span><span class="sxs-lookup"><span data-stu-id="69b90-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="69b90-154">Cliquez avec le bouton droit sur tables, puis sélectionnez nouvelle requête.</span><span class="sxs-lookup"><span data-stu-id="69b90-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="69b90-155">Collez le script SQL de [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) et exécutez-le.</span><span class="sxs-lookup"><span data-stu-id="69b90-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="69b90-156">Si « DefaultConnection » est actualisé, nous pouvons voir que les nouvelles tables sont ajoutées.</span><span class="sxs-lookup"><span data-stu-id="69b90-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="69b90-157">Vous pouvez vérifier les données dans les tables pour voir que les informations ont été migrées.</span><span class="sxs-lookup"><span data-stu-id="69b90-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="69b90-158">Migration de l’application pour qu’elle utilise ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="69b90-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="69b90-159">Installez les packages NuGet nécessaires pour ASP.NET Identity :</span><span class="sxs-lookup"><span data-stu-id="69b90-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="69b90-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="69b90-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="69b90-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="69b90-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="69b90-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="69b90-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="69b90-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="69b90-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="69b90-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="69b90-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="69b90-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="69b90-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="69b90-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="69b90-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="69b90-167">Vous trouverez plus d’informations sur la gestion des packages NuGet [ici](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog) .</span><span class="sxs-lookup"><span data-stu-id="69b90-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="69b90-168">Pour travailler avec des données existantes dans la table, nous devons créer des classes de modèle qui mappent aux tables et les raccordent dans le système d’identité.</span><span class="sxs-lookup"><span data-stu-id="69b90-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="69b90-169">Dans le cadre du contrat d’identité, les classes de modèle doivent implémenter les interfaces définies dans la dll Identity. Core ou étendre l’implémentation existante de ces interfaces disponibles dans Microsoft. AspNet. Identity. EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="69b90-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="69b90-170">Nous utiliserons les classes existantes pour le rôle, les connexions utilisateur et les revendications d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="69b90-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="69b90-171">Nous devons utiliser un utilisateur personnalisé pour notre exemple.</span><span class="sxs-lookup"><span data-stu-id="69b90-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="69b90-172">Cliquez avec le bouton droit sur le projet et créez un dossier « IdentityModels ».</span><span class="sxs-lookup"><span data-stu-id="69b90-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="69b90-173">Ajoutez une nouvelle classe « User » comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="69b90-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="69b90-174">Notez que « ProfileInfo » est désormais une propriété de la classe User.</span><span class="sxs-lookup"><span data-stu-id="69b90-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="69b90-175">Par conséquent, nous pouvons utiliser la classe d’utilisateur pour travailler directement avec les données de profil.</span><span class="sxs-lookup"><span data-stu-id="69b90-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="69b90-176">Copiez les fichiers dans les dossiers **IdentityModels** et **IdentityAccount** à partir de la source de téléchargement ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="69b90-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="69b90-177">Il s’agit des classes de modèle restantes et des nouvelles pages nécessaires à la gestion des utilisateurs et des rôles à l’aide des API ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="69b90-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="69b90-178">L’approche utilisée est similaire à l’appartenance SQL et l’explication détaillée est disponible [ici](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="69b90-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="69b90-179">Copie des données de profil dans les nouvelles tables</span><span class="sxs-lookup"><span data-stu-id="69b90-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="69b90-180">Comme mentionné précédemment, nous devons désérialiser les données XML dans les tables de profils et les stocker dans les colonnes de la table AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="69b90-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="69b90-181">Les nouvelles colonnes ont été créées dans le tableau utilisateurs à l’étape précédente, de sorte que tout ce qui reste est de remplir ces colonnes avec les données nécessaires.</span><span class="sxs-lookup"><span data-stu-id="69b90-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="69b90-182">Pour ce faire, nous allons utiliser une application console qui est exécutée une fois pour remplir les colonnes nouvellement créées dans la table users.</span><span class="sxs-lookup"><span data-stu-id="69b90-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="69b90-183">Créez une nouvelle application console dans la solution de sortie.</span><span class="sxs-lookup"><span data-stu-id="69b90-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="69b90-184">Installez la dernière version du package Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="69b90-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="69b90-185">Ajoutez l’application Web créée ci-dessus en tant que référence à l’application console.</span><span class="sxs-lookup"><span data-stu-id="69b90-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="69b90-186">Pour ce faire, cliquez avec le bouton droit sur projet, ajoutez « ajouter des références », puis sur solution, cliquez sur le projet et cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="69b90-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="69b90-187">Copiez le code ci-dessous dans la classe Program.cs.</span><span class="sxs-lookup"><span data-stu-id="69b90-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="69b90-188">Cette logique lit les données de profil pour chaque utilisateur, les sérialise en tant qu’objet « ProfileInfo » et les stocke dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="69b90-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="69b90-189">Certains des modèles utilisés sont définis dans le dossier’IdentityModels’du projet d’application Web. vous devez donc inclure les espaces de noms correspondants.</span><span class="sxs-lookup"><span data-stu-id="69b90-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="69b90-190">Le code ci-dessus fonctionne sur le fichier de base de données dans le dossier application\_Data du projet d’application Web créé au cours des étapes précédentes.</span><span class="sxs-lookup"><span data-stu-id="69b90-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="69b90-191">Pour référencer cela, mettez à jour la chaîne de connexion dans le fichier app. config de l’application console avec la chaîne de connexion dans le fichier Web. config de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="69b90-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="69b90-192">Fournissez également le chemin d’accès physique complet dans la propriété « AttachDbFilename ».</span><span class="sxs-lookup"><span data-stu-id="69b90-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="69b90-193">Ouvrez une invite de commandes et accédez au dossier bin de l’application console ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="69b90-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="69b90-194">Exécutez le fichier exécutable et passez en revue la sortie du journal, comme indiqué dans l’image suivante.</span><span class="sxs-lookup"><span data-stu-id="69b90-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="69b90-195">Ouvrez la table « AspNetUsers » dans la Explorateur de serveurs et vérifiez les données dans les nouvelles colonnes qui contiennent les propriétés.</span><span class="sxs-lookup"><span data-stu-id="69b90-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="69b90-196">Ils doivent être mis à jour avec les valeurs de propriété correspondantes.</span><span class="sxs-lookup"><span data-stu-id="69b90-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="69b90-197">Vérifier la fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="69b90-197">Verify functionality</span></span>

<span data-ttu-id="69b90-198">Utilisez les pages d’appartenance nouvellement ajoutées qui sont implémentées à l’aide de ASP.NET Identity pour se connecter à un utilisateur à partir de l’ancienne base de données.</span><span class="sxs-lookup"><span data-stu-id="69b90-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="69b90-199">L’utilisateur doit pouvoir se connecter à l’aide des mêmes informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="69b90-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="69b90-200">Essayez les autres fonctionnalités telles que l’ajout d’OAuth, la création d’un utilisateur, la modification d’un mot de passe, l’ajout de rôles, l’ajout d’utilisateurs à des rôles, etc.</span><span class="sxs-lookup"><span data-stu-id="69b90-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="69b90-201">Les données de profil de l’ancien utilisateur et des nouveaux utilisateurs doivent être extraites et stockées dans la table utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="69b90-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="69b90-202">L’ancienne table ne doit plus être référencée.</span><span class="sxs-lookup"><span data-stu-id="69b90-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="69b90-203">Conclusion</span><span class="sxs-lookup"><span data-stu-id="69b90-203">Conclusion</span></span>

<span data-ttu-id="69b90-204">L’article a décrit le processus de migration d’applications Web qui utilisaient le modèle de fournisseur pour l’appartenance à ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="69b90-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="69b90-205">L’article a également décrit la migration des données de profil pour que les utilisateurs soient connectés au système d’identité.</span><span class="sxs-lookup"><span data-stu-id="69b90-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="69b90-206">Laissez les commentaires ci-dessous pour les questions et les problèmes rencontrés lors de la migration de votre application.</span><span class="sxs-lookup"><span data-stu-id="69b90-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="69b90-207">*Merci à Rick Anderson et Robert McMurray de passer en revue l’article.*</span><span class="sxs-lookup"><span data-stu-id="69b90-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
