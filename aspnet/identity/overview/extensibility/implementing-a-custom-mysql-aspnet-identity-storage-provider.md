---
uid: identity/overview/extensibility/implementing-a-custom-mysql-aspnet-identity-storage-provider
title: Implémentation d’un fournisseur de stockage ASP.NET Identity MySQL personnalisé-ASP.NET 4. x
author: raquelsa
description: ASP.NET Identity est un système extensible qui vous permet de créer votre propre fournisseur de stockage et de l’intégrer à votre application sans avoir à réutiliser l’applicateur...
ms.author: riande
ms.date: 05/22/2015
ms.assetid: 248f5fe7-39ba-40ea-ab1e-71a69b0bd649
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/extensibility/implementing-a-custom-mysql-aspnet-identity-storage-provider
msc.type: authoredcontent
ms.openlocfilehash: 2f0b47d45bce82c71d1864536309f9e2ffed2d63
ms.sourcegitcommit: 88fc80e3f65aebdf61ec9414810ddbc31c543f04
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/22/2020
ms.locfileid: "76519126"
---
# <a name="implementing-a-custom-mysql-aspnet-identity-storage-provider"></a><span data-ttu-id="667b9-103">Implémentation d’un fournisseur de stockage ASP.NET Identity MySQL personnalisé</span><span class="sxs-lookup"><span data-stu-id="667b9-103">Implementing a Custom MySQL ASP.NET Identity Storage Provider</span></span>

<span data-ttu-id="667b9-104">par [Raquel Soares de Almeida](https://github.com/raquelsa), [Suhas Joshi](https://github.com/suhasj), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="667b9-104">by [Raquel Soares De Almeida](https://github.com/raquelsa), [Suhas Joshi](https://github.com/suhasj), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="667b9-105">ASP.NET Identity est un système extensible qui vous permet de créer votre propre fournisseur de stockage et de l’intégrer à votre application sans avoir à retravailler l’application.</span><span class="sxs-lookup"><span data-stu-id="667b9-105">ASP.NET Identity is an extensible system which enables you to create your own storage provider and plug it into your application without re-working the application.</span></span> <span data-ttu-id="667b9-106">Cette rubrique explique comment créer un fournisseur de stockage MySQL pour ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="667b9-106">This topic describes how to create a MySQL storage provider for ASP.NET Identity.</span></span> <span data-ttu-id="667b9-107">Pour obtenir une vue d’ensemble de la création de fournisseurs de stockage personnalisés, consultez [vue d’ensemble des fournisseurs de stockage personnalisés pour ASP.net Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="667b9-107">For an overview of creating custom storage providers, see [Overview of Custom Storage Providers for ASP.NET Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span></span>
> 
> <span data-ttu-id="667b9-108">Pour suivre ce didacticiel, vous devez disposer d’Visual Studio 2013 avec Update 2.</span><span class="sxs-lookup"><span data-stu-id="667b9-108">To complete this tutorial, you must have Visual Studio 2013 with Update 2.</span></span>
> 
> <span data-ttu-id="667b9-109">Ce didacticiel vous permet d’effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="667b9-109">This tutorial will:</span></span>
> 
> - <span data-ttu-id="667b9-110">Montre comment créer une instance de base de données MySQL sur Azure.</span><span class="sxs-lookup"><span data-stu-id="667b9-110">Show how to create a MySQL database instance on Azure.</span></span>
> - <span data-ttu-id="667b9-111">Montrez comment utiliser un outil client MySQL (MySQL Workbench) pour créer des tables et gérer votre base de données distante sur Azure.</span><span class="sxs-lookup"><span data-stu-id="667b9-111">Show how to use a MySQL client tool (MySQL Workbench) to create tables and manage your remote database on Azure.</span></span>
> - <span data-ttu-id="667b9-112">Montre comment remplacer la valeur par défaut de l’implémentation de stockage ASP.NET Identity par notre implémentation personnalisée sur un projet d’application MVC.</span><span class="sxs-lookup"><span data-stu-id="667b9-112">Show how to replace the default ASP.NET Identity storage implementation with our custom implementation on a MVC application project.</span></span>
> 
> <span data-ttu-id="667b9-113">Ce didacticiel a été écrit à l’origine par Raquel Soares de Almeida et Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="667b9-113">This tutorial was originally written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span> <span data-ttu-id="667b9-114">L’exemple de projet a été mis à jour pour l’identité 2,0 par Suhas Joshi.</span><span class="sxs-lookup"><span data-stu-id="667b9-114">The sample project was updated for Identity 2.0 by Suhas Joshi.</span></span> <span data-ttu-id="667b9-115">La rubrique a été mise à jour pour l’identité 2,0 de Tom FitzMacken.</span><span class="sxs-lookup"><span data-stu-id="667b9-115">The topic was updated for Identity 2.0 by Tom FitzMacken.</span></span>

## <a name="download-completed-project"></a><span data-ttu-id="667b9-116">Télécharger le projet terminé</span><span class="sxs-lookup"><span data-stu-id="667b9-116">Download completed project</span></span>

<span data-ttu-id="667b9-117">À la fin de ce didacticiel, vous disposerez d’un projet d’application MVC avec ASP.NET Identity utilisant une base de données MySQL hébergée sur Azure.</span><span class="sxs-lookup"><span data-stu-id="667b9-117">At the end of this tutorial, you will have an MVC application project with ASP.NET Identity working with a MySQL database hosted on Azure.</span></span>

<span data-ttu-id="667b9-118">Vous pouvez télécharger le fournisseur de stockage MySQL complet sur [Aspnet. Identity. MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL).</span><span class="sxs-lookup"><span data-stu-id="667b9-118">You can download the completed MySQL storage provider at [AspNet.Identity.MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL).</span></span>

## <a name="the-steps-you-will-perform"></a><span data-ttu-id="667b9-119">Les étapes à effectuer</span><span class="sxs-lookup"><span data-stu-id="667b9-119">The steps you will perform</span></span>

<span data-ttu-id="667b9-120">Dans ce tutoriel vous allez :</span><span class="sxs-lookup"><span data-stu-id="667b9-120">In this tutorial you will:</span></span>

1. <span data-ttu-id="667b9-121">Créer une base de données MySQL sur Azure</span><span class="sxs-lookup"><span data-stu-id="667b9-121">Create a MySQL database on Azure</span></span>
2. <span data-ttu-id="667b9-122">Créer les tables ASP.NET Identity dans MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-122">Create the ASP.NET Identity tables in MySQL</span></span>
3. <span data-ttu-id="667b9-123">Créer une application MVC et la configurer pour utiliser le fournisseur MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-123">Create an MVC application and configure it to use the MySQL provider</span></span>
4. <span data-ttu-id="667b9-124">Exécuter l'application</span><span class="sxs-lookup"><span data-stu-id="667b9-124">Run the app</span></span>

<span data-ttu-id="667b9-125">Cette rubrique ne couvre pas l’architecture de ASP.NET Identity et les décisions que vous devez prendre lors de l’implémentation d’un fournisseur de stockage client.</span><span class="sxs-lookup"><span data-stu-id="667b9-125">This topic does not cover the architecture of ASP.NET Identity and the decisions you must make when implementing a customer storage provider.</span></span> <span data-ttu-id="667b9-126">Pour plus d’informations, consultez [vue d’ensemble des fournisseurs de stockage personnalisés pour ASP.net Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="667b9-126">For that information, see [Overview of Custom Storage Providers for ASP.NET Identity](overview-of-custom-storage-providers-for-aspnet-identity.md).</span></span>

## <a name="review-mysql-storage-provider-classes"></a><span data-ttu-id="667b9-127">Examiner les classes du fournisseur de stockage MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-127">Review MySQL storage provider classes</span></span>

<span data-ttu-id="667b9-128">Avant de passer aux étapes de création du fournisseur de stockage MySQL, observons les classes qui composent le fournisseur de stockage.</span><span class="sxs-lookup"><span data-stu-id="667b9-128">Before jumping into the steps to create the MySQL storage provider, let's look at the classes that make up the storage provider.</span></span> <span data-ttu-id="667b9-129">Vous aurez besoin de classes qui gèrent les opérations et les classes de base de données qui sont appelées à partir de l’application pour gérer les utilisateurs et les rôles.</span><span class="sxs-lookup"><span data-stu-id="667b9-129">You will need classes that manage the database operations and classes that are called from the application to manage users and roles.</span></span>

### <a name="storage-classes"></a><span data-ttu-id="667b9-130">Classes de stockage</span><span class="sxs-lookup"><span data-stu-id="667b9-130">Storage classes</span></span>

- <span data-ttu-id="667b9-131">[IdentityUser](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityUser.cs) : contient les propriétés de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="667b9-131">[IdentityUser](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityUser.cs) - contains properties for the user.</span></span>
- <span data-ttu-id="667b9-132">[UserStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserStore.cs) : contient les opérations d’ajout, de mise à jour ou de récupération des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="667b9-132">[UserStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserStore.cs) - contains operations for adding, updating or retrieving users.</span></span>
- <span data-ttu-id="667b9-133">[IdentityRole](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityRole.cs) : contient les propriétés des rôles.</span><span class="sxs-lookup"><span data-stu-id="667b9-133">[IdentityRole](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/IdentityRole.cs) - contains properties for roles.</span></span>
- <span data-ttu-id="667b9-134">[Au rolestore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleStore.cs) : contient les opérations d’ajout, de suppression, de mise à jour et de récupération des rôles.</span><span class="sxs-lookup"><span data-stu-id="667b9-134">[RoleStore](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleStore.cs) - contains operations for adding, deleting, updating and retrieving roles.</span></span>

### <a name="data-access-layer-classes"></a><span data-ttu-id="667b9-135">Classes de couche d’accès aux données</span><span class="sxs-lookup"><span data-stu-id="667b9-135">Data access layer classes</span></span>

<span data-ttu-id="667b9-136">Pour cet exemple, les classes de la couche d’accès aux données contiennent des instructions SQL pour l’utilisation des tables. Toutefois, dans votre code, vous souhaiterez peut-être utiliser le mappage objet/relationnel (ORM), tel que Entity Framework ou NHibernate.</span><span class="sxs-lookup"><span data-stu-id="667b9-136">For this example, the data access layer classes contain SQL statements for working with the tables; however, in your code you might want to use object-relational mapping (ORM) such as Entity Framework or NHibernate.</span></span> <span data-ttu-id="667b9-137">En particulier, votre application peut présenter des performances médiocres sans un ORM qui comprend le chargement différé et la mise en cache d’objets.</span><span class="sxs-lookup"><span data-stu-id="667b9-137">In particular, your application may experience poor performance without an ORM that includes lazy loading and object caching.</span></span> <span data-ttu-id="667b9-138">Pour plus d’informations, consultez [ASP.NET Identity 2,0 sans Entity Framework ?](https://aspnetidentity.codeplex.com/discussions/561828)</span><span class="sxs-lookup"><span data-stu-id="667b9-138">For more information, see [ASP.NET Identity 2.0 without Entity Framework?](https://aspnetidentity.codeplex.com/discussions/561828)</span></span>

- <span data-ttu-id="667b9-139">[MySQLDatabase](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLDatabase.cs) : contient la connexion de base de données MySQL et les méthodes permettant d’effectuer des opérations de base de données.</span><span class="sxs-lookup"><span data-stu-id="667b9-139">[MySQLDatabase](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLDatabase.cs) - contains the MySQL database connection and methods for performing database operations.</span></span> <span data-ttu-id="667b9-140">UserStore et au rolestore sont instanciés avec une instance de cette classe.</span><span class="sxs-lookup"><span data-stu-id="667b9-140">UserStore and RoleStore are both instantiated with an instance of this class.</span></span>
- <span data-ttu-id="667b9-141">[RoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleTable.cs) : contient des opérations de base de données pour la table qui stocke des rôles.</span><span class="sxs-lookup"><span data-stu-id="667b9-141">[RoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/RoleTable.cs) - contains database operations for the table that stores roles.</span></span>
- <span data-ttu-id="667b9-142">[UserClaimsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserClaimsTable.cs) : contient les opérations de base de données pour la table qui stocke les revendications de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="667b9-142">[UserClaimsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserClaimsTable.cs) - contains database operations for the table that stores user claims.</span></span>
- <span data-ttu-id="667b9-143">[UserLoginsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserLoginsTable.cs) : contient les opérations de base de données pour la table qui stocke les informations de connexion de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="667b9-143">[UserLoginsTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserLoginsTable.cs) - contains database operations for the table that stores user login information.</span></span>
- <span data-ttu-id="667b9-144">[UserRoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserRoleTable.cs) : contient les opérations de base de données pour la table qui stocke les utilisateurs qui sont affectés à quels rôles.</span><span class="sxs-lookup"><span data-stu-id="667b9-144">[UserRoleTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserRoleTable.cs) - contains database operations for the table that stores which users are assigned to which roles.</span></span>
- <span data-ttu-id="667b9-145">[UserTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserTable.cs) : contient les opérations de base de données pour la table qui stocke les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="667b9-145">[UserTable](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/UserTable.cs) - contains database operations for the table that stores users.</span></span>

## <a name="create-a-mysql-database-instance-on-azure"></a><span data-ttu-id="667b9-146">Créer une instance de base de données MySQL sur Azure</span><span class="sxs-lookup"><span data-stu-id="667b9-146">Create a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="667b9-147">Connectez-vous au [portail Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="667b9-147">Log in to the [Azure Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="667b9-148">Cliquez sur **+ nouveau** en bas de la page, puis sélectionnez **Store**.</span><span class="sxs-lookup"><span data-stu-id="667b9-148">Click **+NEW** at the bottom of the page, and then select **STORE**.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image1.png)
3. <span data-ttu-id="667b9-149">Dans l’Assistant **Choose and Add-on** , sélectionnez **ClearDB MySQL Database** , puis cliquez sur la flèche suivant en bas à droite de la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="667b9-149">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database** and click on the next arrow at the bottom right of the dialog.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image2.png)
4. <span data-ttu-id="667b9-150">Conservez le plan **gratuit** par défaut et remplacez le **nom** par **IdentityMySQLDatabase**.</span><span class="sxs-lookup"><span data-stu-id="667b9-150">Keep the default **Free** plan and change the **Name** to **IdentityMySQLDatabase**.</span></span> <span data-ttu-id="667b9-151">Sélectionnez la région la plus proche de vous, puis cliquez sur la flèche suivant.</span><span class="sxs-lookup"><span data-stu-id="667b9-151">Select the region nearest you and then click the next arrow.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.png)
5. <span data-ttu-id="667b9-152">Cliquez sur la coche pour terminer la création de la base de données.</span><span class="sxs-lookup"><span data-stu-id="667b9-152">Click the checkmark to complete the database creation.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image4.png)
6. <span data-ttu-id="667b9-153">Une fois la base de données créée, vous pouvez la gérer à partir de l’onglet **ADD-ONS** du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="667b9-153">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span>   
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image5.png)
7. <span data-ttu-id="667b9-154">Vous pouvez accéder aux informations de connexion à la base de données en cliquant sur **informations de connexion** en bas de la page.</span><span class="sxs-lookup"><span data-stu-id="667b9-154">You can get the database connection information by clicking on **CONNECTION INFO** at the bottom of the page.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image6.png)
8. <span data-ttu-id="667b9-155">Copiez la chaîne de connexion en cliquant sur le bouton Copier, puis enregistrez-la afin de pouvoir l’utiliser ultérieurement dans votre application MVC.</span><span class="sxs-lookup"><span data-stu-id="667b9-155">Copy the connection string by clicking on the copy button and save it so you can use later in your MVC application.</span></span>   
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image7.png)

## <a name="create-the-aspnet-identity-tables-in-a-mysql-database"></a><span data-ttu-id="667b9-156">Créer les tables ASP.NET Identity dans une base de données MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-156">Create the ASP.NET Identity tables in a MySQL database</span></span>

### <a name="install-mysql-workbench-tool-to-connect-and-manage-mysql-database"></a><span data-ttu-id="667b9-157">Installer l’outil MySQL Workbench pour la connexion et la gestion de la base de données MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-157">Install MySQL Workbench tool to connect and manage MySQL database</span></span>

1. <span data-ttu-id="667b9-158">Installer l’outil **MySQL Workbench** à partir de la [page téléchargements MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="667b9-158">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="667b9-159">Lancez l’application et ajoutez cliquez sur le bouton **MySQLConnections +** pour ajouter une nouvelle connexion.</span><span class="sxs-lookup"><span data-stu-id="667b9-159">Launch the app and add click on the **MySQLConnections +** button to add a new connection.</span></span> <span data-ttu-id="667b9-160">Utilisez les données de chaîne de connexion que vous avez copiées à partir de la base de données Azure MySQL que vous avez créée précédemment dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="667b9-160">Use the connection string data you copied from the Azure MySQL database you created earlier in this tutorial.</span></span>
3. <span data-ttu-id="667b9-161">Après avoir établi la connexion, ouvrez un nouvel onglet de **requête** . collez les commandes de [MySQLIdentity. SQL](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLIdentity.sql) dans la requête et exécutez-les pour créer les tables de base de données.</span><span class="sxs-lookup"><span data-stu-id="667b9-161">After establishing the connection, open a new **Query** tab; paste the commands from [MySQLIdentity.sql](https://github.com/aspnet/samples/blob/master/samples/aspnet/Identity/AspNet.Identity.MySQL/MySQLIdentity.sql) into the query and execute it in order to create the database tables.</span></span>
4. <span data-ttu-id="667b9-162">Vous disposez maintenant de toutes les tables ASP.NET Identity nécessaires créées sur une base de données MySQL hébergée sur Azure, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="667b9-162">You now have all the ASP.NET Identity necessary tables created on a MySQL database hosted on Azure as shown below.</span></span>  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image1.jpg)

## <a name="create-an-mvc-application-project-from-template-and-configure-it-to-use-mysql-provider"></a><span data-ttu-id="667b9-163">Créer un projet d’application MVC à partir du modèle et le configurer pour utiliser le fournisseur MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-163">Create an MVC application project from template and configure it to use MySQL provider</span></span>

<span data-ttu-id="667b9-164">Si nécessaire, installez [Visual Studio Express 2013 pour Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566) avec Update 2.</span><span class="sxs-lookup"><span data-stu-id="667b9-164">If needed, install either [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566) with Update 2.</span></span>

### <a name="download-the-aspnetidentitymysql-project-from-github"></a><span data-ttu-id="667b9-165">Téléchargez le projet ASP. NET. Identity. MySQL à partir de GitHub</span><span class="sxs-lookup"><span data-stu-id="667b9-165">Download the ASP.NET.Identity.MySQL project from GitHub</span></span>

1. <span data-ttu-id="667b9-166">Accédez à l’URL du référentiel sur [Aspnet. Identity. MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL/).</span><span class="sxs-lookup"><span data-stu-id="667b9-166">Browse to the repository URL at [AspNet.Identity.MySQL (GitHub)](https://github.com/aspnet/samples/tree/master/samples/aspnet/Identity/AspNet.Identity.MySQL/).</span></span>
2. <span data-ttu-id="667b9-167">Téléchargez le code source.</span><span class="sxs-lookup"><span data-stu-id="667b9-167">Download the source code.</span></span>
3. <span data-ttu-id="667b9-168">Extrayez le fichier. zip dans un dossier local.</span><span class="sxs-lookup"><span data-stu-id="667b9-168">Extract the .zip file into a local folder.</span></span>
4. <span data-ttu-id="667b9-169">Ouvrez la solution AspNet. Identity. MySQL et générez-la.</span><span class="sxs-lookup"><span data-stu-id="667b9-169">Open the AspNet.Identity.MySQL solution and build it.</span></span>

### <a name="create-a-new-mvc-application-project-from-template"></a><span data-ttu-id="667b9-170">Créer un projet d’application MVC à partir d’un modèle</span><span class="sxs-lookup"><span data-stu-id="667b9-170">Create a new MVC application project from template</span></span>

1. <span data-ttu-id="667b9-171">Cliquez avec le bouton droit sur la solution **Aspnet. Identity. MySQL** et **Ajoutez**, **nouveau projet**</span><span class="sxs-lookup"><span data-stu-id="667b9-171">Right click the **AspNet.Identity.MySQL** solution and **Add**, **New Project**</span></span>
2. <span data-ttu-id="667b9-172">Dans la boîte de dialogue **Ajouter un nouveau projet** , sélectionnez **visuel C#**  à gauche, puis **Web** , puis sélectionnez **application Web ASP.net**.</span><span class="sxs-lookup"><span data-stu-id="667b9-172">In the **Add New Project** Dialog select **Visual C#** on the left, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="667b9-173">Nommez votre projet **IdentityMySQLDemo**; puis cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="667b9-173">Name your project **IdentityMySQLDemo**; and then click OK.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image2.jpg)
3. <span data-ttu-id="667b9-174">Dans la boîte de dialogue **nouveau projet ASP.net** , sélectionnez le modèle MVC avec les options par défaut (qui incluent les **comptes d’utilisateur individuels** comme méthode d’authentification), puis cliquez sur **OK**.![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="667b9-174">In the **New ASP.NET Project** dialog, select the MVC template with the default options (that includes **Individual User Accounts** as authentication method) and click **OK**.![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image3.jpg)</span></span>
4. <span data-ttu-id="667b9-175">Dans Explorateur de solutions, cliquez avec le bouton droit sur votre projet IdentityMySQLDemo, puis sélectionnez **gérer les packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="667b9-175">In Solution Explorer, right-click your IdentityMySQLDemo project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="667b9-176">Dans la boîte de dialogue zone de texte de recherche, tapez **Identity. EntityFramework**.</span><span class="sxs-lookup"><span data-stu-id="667b9-176">In the search text box dialog, type **Identity.EntityFramework**.</span></span> <span data-ttu-id="667b9-177">Sélectionnez ce package dans la liste des résultats, puis cliquez sur **désinstaller**.</span><span class="sxs-lookup"><span data-stu-id="667b9-177">Select this package in the list of results and click **Uninstall**.</span></span> <span data-ttu-id="667b9-178">Vous serez invité à désinstaller le package de dépendances EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="667b9-178">You will be prompted to uninstall the dependency package EntityFramework.</span></span> <span data-ttu-id="667b9-179">Cliquez sur Oui, car ce package ne sera plus présent sur cette application.</span><span class="sxs-lookup"><span data-stu-id="667b9-179">Click on Yes as we will no longer this package on this application.</span></span>
5. <span data-ttu-id="667b9-180">Cliquez avec le bouton droit sur le projet IdentityMySQLDemo, sélectionnez **Ajouter**, **référence, solution, projets,** sélectionnez le projet Aspnet. Identity. MySQL, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="667b9-180">Right click the IdentityMySQLDemo project, select **Add**, **Reference, Solution, Projects;** select the AspNet.Identity.MySQL project and click **OK**.</span></span>
6. <span data-ttu-id="667b9-181">Dans le projet IdentityMySQLDemo, remplacez toutes les références à</span><span class="sxs-lookup"><span data-stu-id="667b9-181">In the IdentityMySQLDemo project, replace all references to</span></span>  
    `using Microsoft.AspNet.Identity.EntityFramework;`  
   <span data-ttu-id="667b9-182">avec</span><span class="sxs-lookup"><span data-stu-id="667b9-182">with</span></span>  
     `using AspNet.Identity.MySQL;`
7. <span data-ttu-id="667b9-183">Dans IdentityModels.cs, définissez **ApplicationDbContext** pour qu’elle dérive de **MySqlDatabase** et incluez un constructeur qui prend un seul paramètre avec le nom de la connexion.</span><span class="sxs-lookup"><span data-stu-id="667b9-183">In IdentityModels.cs, set **ApplicationDbContext** to derive from **MySqlDatabase** and include a constructor that take a single parameter with the connection name.</span></span>  

    [!code-csharp[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample1.cs)]
8. <span data-ttu-id="667b9-184">Ouvrez le fichier IdentityConfig.cs.</span><span class="sxs-lookup"><span data-stu-id="667b9-184">Open the IdentityConfig.cs file.</span></span> <span data-ttu-id="667b9-185">Dans la méthode **ApplicationUserManager. Create** , remplacez instanciing usermanager par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="667b9-185">In the **ApplicationUserManager.Create** method, replace instantiating UserManager with the following code:</span></span>  

    [!code-csharp[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample2.cs)]
9. <span data-ttu-id="667b9-186">Ouvrez le fichier Web. config et remplacez la chaîne DefaultConnection par cette entrée, en remplaçant les valeurs en surbrillance par la chaîne de connexion de la base de données MySQL que vous avez créée lors des étapes précédentes :</span><span class="sxs-lookup"><span data-stu-id="667b9-186">Open the web.config file and replace the DefaultConnection string with this entry replacing the highlighted values with the connection string of the MySQL database you created on previous steps:</span></span>  

    [!code-xml[Main](implementing-a-custom-mysql-aspnet-identity-storage-provider/samples/sample3.xml?highlight=2)]

## <a name="run-the-app-and-connect-to-the-mysql-db"></a><span data-ttu-id="667b9-187">Exécuter l’application et se connecter à la base de BDD MySQL</span><span class="sxs-lookup"><span data-stu-id="667b9-187">Run the app and connect to the MySQL DB</span></span>

1. <span data-ttu-id="667b9-188">Cliquez avec le bouton droit sur le projet **IdentityMySQLDemo** et sélectionnez **définir comme projet de démarrage** .</span><span class="sxs-lookup"><span data-stu-id="667b9-188">Right click the **IdentityMySQLDemo** project and select **Set as Startup Project**</span></span>
2. <span data-ttu-id="667b9-189">Appuyez sur **CTRL + F5** pour générer et exécuter l’application.</span><span class="sxs-lookup"><span data-stu-id="667b9-189">Press **Ctrl + F5** to build and run the app.</span></span>
3. <span data-ttu-id="667b9-190">Cliquez sur l’onglet **Register** en haut de la page.</span><span class="sxs-lookup"><span data-stu-id="667b9-190">Click on **Register** tab on the top of the page.</span></span>
4. <span data-ttu-id="667b9-191">Entrez un nouveau nom d’utilisateur et un nouveau mot de passe, puis cliquez sur **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="667b9-191">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image8.png)
5. <span data-ttu-id="667b9-192">Le nouvel utilisateur est maintenant inscrit et connecté.</span><span class="sxs-lookup"><span data-stu-id="667b9-192">The new user is now registered and logged in.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image9.png)
6. <span data-ttu-id="667b9-193">Revenez à l’outil MySQL Workbench et examinez le contenu de la table **IdentityMySQLDatabase** .</span><span class="sxs-lookup"><span data-stu-id="667b9-193">Go back to the MySQL Workbench tool and inspect the **IdentityMySQLDatabase** table's contents.</span></span> <span data-ttu-id="667b9-194">Examinez la table users pour les entrées lorsque vous inscrivez de nouveaux utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="667b9-194">Inspect the users table for the entries as you register new users.</span></span>  
  
    ![](implementing-a-custom-mysql-aspnet-identity-storage-provider/_static/image10.png)

## <a name="next-steps"></a><span data-ttu-id="667b9-195">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="667b9-195">Next Steps</span></span>

<span data-ttu-id="667b9-196">Pour plus d’informations sur la façon d’activer d’autres méthodes d’authentification sur cette application, consultez [créer une application ASP.NET MVC 5 avec Facebook et Google OAuth2 et authentification OpenID](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="667b9-196">For more information on how to enable other authentication methods on this app, refer to [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>

<span data-ttu-id="667b9-197">Pour savoir comment intégrer votre base de connaissances avec OAuth et configurer des rôles pour limiter l’accès des utilisateurs à votre application, consultez [déployer une application secure ASP.NET MVC 5 avec appartenance, OAuth et SQL Database sur Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="667b9-197">To learn how to integrate your DB with OAuth and to set up roles to limit users access to your app, see [Deploy a Secure ASP.NET MVC 5 app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span>
