---
uid: identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
title: 'ASP.NET Identity : utilisation du stockage MySQL avec un fournisseur d’EntityFrameworkC#MySQL ()-ASP.net 4. x'
author: maumar
description: Ce didacticiel vous montre comment remplacer le mécanisme de stockage de données par défaut pour ASP.NET Identity avec EntityFramework (fournisseur SQL client) avec un provid MySQL...
ms.author: riande
ms.date: 12/10/2013
ms.assetid: 15253312-a92c-43ba-908e-b5dacd3d08b8
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
msc.type: authoredcontent
ms.openlocfilehash: e89ed139657c5ce9ddcc56879946c62038919483
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584006"
---
# <a name="aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider-c"></a><span data-ttu-id="4836f-103">ASP.NET Identity : utilisation du stockage MySQL avec un fournisseur MySQL d'C#EntityFramework ()</span><span class="sxs-lookup"><span data-stu-id="4836f-103">ASP.NET Identity: Using MySQL Storage with an EntityFramework MySQL Provider (C#)</span></span>

<span data-ttu-id="4836f-104">par [Maurycy Markowski](https://github.com/maumar), [Raquel Soares de Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span><span class="sxs-lookup"><span data-stu-id="4836f-104">by [Maurycy Markowski](https://github.com/maumar), [Raquel Soares De Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span></span>

> <span data-ttu-id="4836f-105">Ce didacticiel vous montre comment remplacer le mécanisme de stockage de données par défaut pour [**ASP.net Identity**](introduction-to-aspnet-identity.md) avec EntityFramework (fournisseur SQL client) avec un fournisseur MySQL.</span><span class="sxs-lookup"><span data-stu-id="4836f-105">This tutorial shows you how to replace the default data storage mechanism for [**ASP.NET Identity**](introduction-to-aspnet-identity.md) with EntityFramework (SQL client provider) with a MySQL provider.</span></span>

<span data-ttu-id="4836f-106">Les rubriques suivantes sont traitées dans ce didacticiel :</span><span class="sxs-lookup"><span data-stu-id="4836f-106">The following topics will be covered in this tutorial:</span></span>

- <span data-ttu-id="4836f-107">Création d’une base de données MySQL sur Azure</span><span class="sxs-lookup"><span data-stu-id="4836f-107">Creating a MySQL database on Azure</span></span>
- <span data-ttu-id="4836f-108">Création d’une application MVC à l’aide d’Visual Studio 2013 modèle MVC</span><span class="sxs-lookup"><span data-stu-id="4836f-108">Creating an MVC application using Visual Studio 2013 MVC template</span></span>
- <span data-ttu-id="4836f-109">Configuration d’EntityFramework pour fonctionner avec un fournisseur de base de données MySQL</span><span class="sxs-lookup"><span data-stu-id="4836f-109">Configuring EntityFramework to work with a MySQL database provider</span></span>
- <span data-ttu-id="4836f-110">Exécution de l’application pour vérifier les résultats</span><span class="sxs-lookup"><span data-stu-id="4836f-110">Running the application to verify the results</span></span>

<span data-ttu-id="4836f-111">À la fin de ce didacticiel, vous disposerez d’une application MVC avec le magasin de ASP.NET Identity qui utilise une base de données MySQL hébergée dans Azure.</span><span class="sxs-lookup"><span data-stu-id="4836f-111">At the end of this tutorial, you will have an MVC application with the ASP.NET Identity store that is using a MySQL database that is hosted in Azure.</span></span>

## <a name="creating-a-mysql-database-instance-on-azure"></a><span data-ttu-id="4836f-112">Création d’une instance de base de données MySQL sur Azure</span><span class="sxs-lookup"><span data-stu-id="4836f-112">Creating a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="4836f-113">Connectez-vous au [portail Azure](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="4836f-113">Log in to the [Azure Portal](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span></span>
2. <span data-ttu-id="4836f-114">Cliquez sur **nouveau** en bas de la page, puis sélectionnez **stocker**:</span><span class="sxs-lookup"><span data-stu-id="4836f-114">Click **NEW** at the bottom of the page, and then select **STORE**:</span></span>

    [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.png)
3. <span data-ttu-id="4836f-115">Dans l’Assistant **choisir et ajouter** , sélectionnez **base de données ClearDB MySQL**, puis cliquez sur la flèche **suivant** en bas du cadre :</span><span class="sxs-lookup"><span data-stu-id="4836f-115">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database**, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="4836f-116">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-116">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span></span>
4. <span data-ttu-id="4836f-118">Conservez le plan **gratuit** par défaut, changez le **nom** en **IdentityMySQLDatabase**, sélectionnez la région la plus proche de vous, puis cliquez sur la flèche **suivant** en bas du cadre :</span><span class="sxs-lookup"><span data-stu-id="4836f-118">Keep the default **Free** plan, change the **NAME** to **IdentityMySQLDatabase**, select the region that is nearest to you, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="4836f-119">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-119">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span></span>
5. <span data-ttu-id="4836f-121">Cliquez sur la coche d' **achat** pour terminer la création de la base de données.</span><span class="sxs-lookup"><span data-stu-id="4836f-121">Click the **PURCHASE** checkmark to complete the database creation.</span></span>

   <span data-ttu-id="4836f-122">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-122">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span></span>
6. <span data-ttu-id="4836f-124">Une fois la base de données créée, vous pouvez la gérer à partir de l’onglet **ADD-ONS** du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="4836f-124">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span> <span data-ttu-id="4836f-125">Pour récupérer les informations de connexion de votre base de données, cliquez sur **informations de connexion** en bas de la page :</span><span class="sxs-lookup"><span data-stu-id="4836f-125">To retrieve the connection information for your database, click **CONNECTION INFO** at the bottom of the page:</span></span>

   <span data-ttu-id="4836f-126">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-126">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span></span>
7. <span data-ttu-id="4836f-128">Copiez la chaîne de connexion en cliquant sur le bouton Copier dans le champ **CONNECTIONSTRING** et enregistrez-la. vous utiliserez ces informations plus loin dans ce didacticiel pour votre application MVC :</span><span class="sxs-lookup"><span data-stu-id="4836f-128">Copy the connection string by clicking on the copy button by the **CONNECTIONSTRING** field and save it; you will use this information later in this tutorial for your MVC application:</span></span>

   <span data-ttu-id="4836f-129">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-129">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span></span>

## <a name="creating-an-mvc-application-project"></a><span data-ttu-id="4836f-131">Création d’un projet d’application MVC</span><span class="sxs-lookup"><span data-stu-id="4836f-131">Creating an MVC application project</span></span>

<span data-ttu-id="4836f-132">Pour effectuer les étapes de cette section du didacticiel, vous devez d’abord installer [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou le [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="4836f-132">To complete the steps in this section of the tutorial, you will first need to install [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="4836f-133">Une fois Visual Studio installé, procédez comme suit pour créer un projet d’application MVC :</span><span class="sxs-lookup"><span data-stu-id="4836f-133">Once Visual Studio has been installed, use the following steps to create a new MVC application project:</span></span>

1. <span data-ttu-id="4836f-134">Ouvrez Visual Studio 2103.</span><span class="sxs-lookup"><span data-stu-id="4836f-134">Open Visual Studio 2103.</span></span>
2. <span data-ttu-id="4836f-135">Cliquez sur **nouveau projet** dans la page de **démarrage** , ou cliquez sur le menu **fichier** , puis sur **nouveau projet**:</span><span class="sxs-lookup"><span data-stu-id="4836f-135">Click **New Project** from the **Start** page, or you can click the **File** menu and then **New Project**:</span></span>

   <span data-ttu-id="4836f-136">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-136">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="4836f-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span></span>
3. <span data-ttu-id="4836f-138">Quand la boîte de dialogue **nouveau projet** s’affiche, développez **visuel C#**  dans la liste des modèles, cliquez sur **Web**, puis sélectionnez **application Web ASP.net**.</span><span class="sxs-lookup"><span data-stu-id="4836f-138">When the **New Project** dialog box is displayed, expand **Visual C#** in the list of templates, then click **Web**, and select **ASP.NET Web Application**.</span></span> <span data-ttu-id="4836f-139">Nommez votre projet **IdentityMySQLDemo** , puis cliquez sur **OK**:</span><span class="sxs-lookup"><span data-stu-id="4836f-139">Name your project **IdentityMySQLDemo** and then click **OK**:</span></span>

   <span data-ttu-id="4836f-140">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-140">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span></span>
4. <span data-ttu-id="4836f-142">Dans la boîte de dialogue **nouveau projet ASP.net** , sélectionnez **MVC** templatewith les options par défaut. Cela permet de configurer **des comptes d’utilisateur individuels** comme méthode d’authentification.</span><span class="sxs-lookup"><span data-stu-id="4836f-142">In the **New ASP.NET Project** dialog, select the **MVC** templatewith the default options; this will configure **Individual User Accounts** as the authentication method.</span></span> <span data-ttu-id="4836f-143">Cliquez sur **OK** :</span><span class="sxs-lookup"><span data-stu-id="4836f-143">Click **OK**:</span></span>

   <span data-ttu-id="4836f-144">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-144">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span></span>

## <a name="configure-entityframework-to-work-with-a-mysql-database"></a><span data-ttu-id="4836f-146">Configurer EntityFramework pour utiliser une base de données MySQL</span><span class="sxs-lookup"><span data-stu-id="4836f-146">Configure EntityFramework to work with a MySQL database</span></span>

### <a name="update-the-entity-framework-assembly-for-your-project"></a><span data-ttu-id="4836f-147">Mettre à jour l’assembly Entity Framework pour votre projet</span><span class="sxs-lookup"><span data-stu-id="4836f-147">Update the Entity Framework assembly for your project</span></span>

<span data-ttu-id="4836f-148">L’application MVC créée à partir du modèle Visual Studio 2013 contient une référence au package [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) , mais des mises à jour ont été apportées à cet assembly depuis sa publication, ce qui inclut des améliorations significatives en matière de performances.</span><span class="sxs-lookup"><span data-stu-id="4836f-148">The MVC application that was created from the Visual Studio 2013 template contains a reference to the [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) package, but there have been updates to that assembly since its release which contain significant performance improvements.</span></span> <span data-ttu-id="4836f-149">Pour pouvoir utiliser ces dernières mises à jour dans votre application, procédez comme suit.</span><span class="sxs-lookup"><span data-stu-id="4836f-149">In order to use these latest updates in your application, use the following steps.</span></span>

1. <span data-ttu-id="4836f-150">Ouvrez votre projet MVC dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4836f-150">Open your MVC project in Visual Studio.</span></span>
2. <span data-ttu-id="4836f-151">Cliquez sur **Outils**, puis sur **Gestionnaire de package NuGet**, puis sur **console du gestionnaire de package**:</span><span class="sxs-lookup"><span data-stu-id="4836f-151">Click **Tools**, then click **NuGet Package Manager**, and then click **Package Manager Console**:</span></span>

   <span data-ttu-id="4836f-152">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-152">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span></span>
3. <span data-ttu-id="4836f-154">La **console du gestionnaire de package** s’affiche dans la partie inférieure de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4836f-154">The **Package Manager Console** will appear in the bottom section of Visual Studio.</span></span> <span data-ttu-id="4836f-155">Tapez &quot;**Update-Package EntityFramework**&quot; et appuyez sur entrée :</span><span class="sxs-lookup"><span data-stu-id="4836f-155">Type &quot;**Update-Package EntityFramework**&quot; and press Enter:</span></span>

   <span data-ttu-id="4836f-156">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-156">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span></span>

### <a name="install-the-mysql-provider-for-entityframework"></a><span data-ttu-id="4836f-158">Installer le fournisseur MySQL pour EntityFramework</span><span class="sxs-lookup"><span data-stu-id="4836f-158">Install the MySQL provider for EntityFramework</span></span>

<span data-ttu-id="4836f-159">Pour permettre à EntityFramework de se connecter à la base de données MySQL, vous devez installer un fournisseur MySQL.</span><span class="sxs-lookup"><span data-stu-id="4836f-159">In order for EntityFramework to connect to MySQL database, you need to install a MySQL provider.</span></span> <span data-ttu-id="4836f-160">Pour ce faire, ouvrez la **console du gestionnaire de package** et tapez &quot;**Install-Package MySQL. Data. Entity-pre**&quot;, puis appuyez sur entrée.</span><span class="sxs-lookup"><span data-stu-id="4836f-160">To do so, open the **Package Manager Console** and type &quot;**Install-Package MySql.Data.Entity -Pre**&quot;, and then press Enter.</span></span>

> [!NOTE]
> <span data-ttu-id="4836f-161">Il s’agit d’une version préliminaire de l’assembly et, par conséquent, peut contenir des bogues.</span><span class="sxs-lookup"><span data-stu-id="4836f-161">This is a pre-release version of the assembly, and as such it may contain bugs.</span></span> <span data-ttu-id="4836f-162">Vous ne devez pas utiliser une version préliminaire du fournisseur en production.</span><span class="sxs-lookup"><span data-stu-id="4836f-162">You should not use a pre-release version of the provider in production.</span></span>

<span data-ttu-id="4836f-163">[Cliquez sur l’image suivante pour la développer.]</span><span class="sxs-lookup"><span data-stu-id="4836f-163">[Click the following image to expand it.]</span></span>

[![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image22.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image21.png)

### <a name="making-project-configuration-changes-to-the-webconfig-file-for-your-application"></a><span data-ttu-id="4836f-164">Modification de la configuration du projet dans le fichier Web. config de votre application</span><span class="sxs-lookup"><span data-stu-id="4836f-164">Making project configuration changes to the Web.config file for your application</span></span>

<span data-ttu-id="4836f-165">Dans cette section, vous allez configurer le Entity Framework pour utiliser le fournisseur MySQL que vous venez d’installer, inscrire la fabrique de fournisseurs MySQL et ajouter votre chaîne de connexion à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="4836f-165">In this section you will configure the Entity Framework to use the MySQL provider that you just installed, register the MySQL provider factory, and add your connection string from Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="4836f-166">Les exemples suivants contiennent une version d’assembly spécifique pour MySql. Data. dll.</span><span class="sxs-lookup"><span data-stu-id="4836f-166">The following examples contain a specific assembly version for MySql.Data.dll.</span></span> <span data-ttu-id="4836f-167">Si la version de l’assembly change, vous devrez modifier les paramètres de configuration appropriés avec la version correcte.</span><span class="sxs-lookup"><span data-stu-id="4836f-167">If the assembly version changes, you will need to modify the appropriate configuration settings with the correct version.</span></span>

1. <span data-ttu-id="4836f-168">Ouvrez le fichier Web. config de votre projet dans Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="4836f-168">Open the Web.config file for your project in Visual Studio 2013.</span></span>
2. <span data-ttu-id="4836f-169">Recherchez les paramètres de configuration suivants, qui définissent le fournisseur de base de données par défaut et la fabrique pour l’Entity Framework :</span><span class="sxs-lookup"><span data-stu-id="4836f-169">Locate the following configuration settings, which define the default database provider and factory for the Entity Framework:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample1.xml)]
3. <span data-ttu-id="4836f-170">Remplacez ces paramètres de configuration par le code suivant, qui configurera les Entity Framework pour utiliser le fournisseur MySQL :</span><span class="sxs-lookup"><span data-stu-id="4836f-170">Replace those configuration settings with the following, which will configure the Entity Framework to use the MySQL provider:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample2.xml)]
4. <span data-ttu-id="4836f-171">Recherchez la section &lt;connectionStrings&gt; et remplacez-la par le code suivant, qui définit la chaîne de connexion pour votre base de données MySQL hébergée sur Azure (Notez que la valeur providerName a également été modifiée par rapport à l’original) :</span><span class="sxs-lookup"><span data-stu-id="4836f-171">Locate the &lt;connectionStrings&gt; section and replace it with the following code, which will define the connection string for your MySQL database that is hosted on Azure (note that providerName value has also been changed from the original):</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample3.xml?highlight=3-4)]

### <a name="adding-custom-migrationhistory-context"></a><span data-ttu-id="4836f-172">Ajout d’un contexte MigrationHistory personnalisé</span><span class="sxs-lookup"><span data-stu-id="4836f-172">Adding custom MigrationHistory context</span></span>

<span data-ttu-id="4836f-173">Entity Framework Code First utilise une table **MigrationHistory** pour effectuer le suivi des modifications de modèle et garantir la cohérence entre le schéma de base de données et le schéma conceptuel.</span><span class="sxs-lookup"><span data-stu-id="4836f-173">Entity Framework Code First uses a **MigrationHistory** table to keep track of model changes and to ensure the consistency between the database schema and conceptual schema.</span></span> <span data-ttu-id="4836f-174">Toutefois, cette table ne fonctionne pas pour MySQL par défaut, car la clé primaire est trop volumineuse.</span><span class="sxs-lookup"><span data-stu-id="4836f-174">However, this table does not work for MySQL by default because the primary key is too large.</span></span> <span data-ttu-id="4836f-175">Pour remédier à cette situation, vous devrez réduire la taille de la clé pour cette table.</span><span class="sxs-lookup"><span data-stu-id="4836f-175">To remedy this situation, you will need to shrink the key size for that table.</span></span> <span data-ttu-id="4836f-176">Pour ce faire, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="4836f-176">To do so, use the following steps:</span></span>

1. <span data-ttu-id="4836f-177">Les informations de schéma de cette table sont capturées dans un **HistoryContext**, qui peut être modifié comme n’importe quel autre **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="4836f-177">The schema information for this table is captured in a **HistoryContext**, which can be modified as any other **DbContext**.</span></span> <span data-ttu-id="4836f-178">Pour ce faire, ajoutez un nouveau fichier de classe nommé **MySqlHistoryContext.cs** au projet, puis remplacez son contenu par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="4836f-178">To do so, add a new class file named **MySqlHistoryContext.cs** to the project, and replace its contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample4.cs)]
2. <span data-ttu-id="4836f-179">Ensuite, vous devez configurer Entity Framework pour utiliser le **HistoryContext**modifié, plutôt que celui par défaut.</span><span class="sxs-lookup"><span data-stu-id="4836f-179">Next you will need to configure Entity Framework to use the modified **HistoryContext**, rather than default one.</span></span> <span data-ttu-id="4836f-180">Pour ce faire, vous pouvez tirer parti des fonctionnalités de configuration basées sur le code.</span><span class="sxs-lookup"><span data-stu-id="4836f-180">This can be done by leveraging code-based configuration features.</span></span> <span data-ttu-id="4836f-181">Pour ce faire, ajoutez un nouveau fichier de classe nommé **MySqlConfiguration.cs** à votre projet et remplacez son contenu par :</span><span class="sxs-lookup"><span data-stu-id="4836f-181">To do so, add new class file named **MySqlConfiguration.cs** to your project and replace its contents with:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample5.cs)]

### <a name="creating-a-custom-entityframework-initializer-for-applicationdbcontext"></a><span data-ttu-id="4836f-182">Création d’un initialiseur EntityFramework personnalisé pour ApplicationDbContext</span><span class="sxs-lookup"><span data-stu-id="4836f-182">Creating a custom EntityFramework initializer for ApplicationDbContext</span></span>

<span data-ttu-id="4836f-183">Le fournisseur MySQL qui est proposé dans ce didacticiel ne prend pas actuellement en charge les migrations de Entity Framework. vous devrez donc utiliser des initialiseurs de modèle pour vous connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="4836f-183">The MySQL provider that is featured in this tutorial does not currently support Entity Framework migrations, so you will need to use model initializers in order to connect to the database.</span></span> <span data-ttu-id="4836f-184">Étant donné que ce didacticiel utilise une instance MySQL sur Azure, vous devrez créer un initialiseur de Entity Framework personnalisé.</span><span class="sxs-lookup"><span data-stu-id="4836f-184">Because this tutorial is using a MySQL instance on Azure, you will need to create a custom Entity Framework initializer.</span></span>

> [!NOTE]
> <span data-ttu-id="4836f-185">Cette étape n’est pas requise si vous vous connectez à une instance de SQL Server sur Azure ou si vous utilisez une base de données hébergée localement.</span><span class="sxs-lookup"><span data-stu-id="4836f-185">This step is not required if you are connecting to a SQL Server instance on Azure or if you are using a database that is hosted on premises.</span></span>

<span data-ttu-id="4836f-186">Pour créer un initialiseur de Entity Framework personnalisé pour MySQL, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="4836f-186">To create a custom Entity Framework initializer for MySQL, use the following steps:</span></span>

1. <span data-ttu-id="4836f-187">Ajoutez un nouveau fichier de classe nommé **MySqlInitializer.cs** au projet, puis remplacez son contenu par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="4836f-187">Add a new class file named **MySqlInitializer.cs** to the project, and replace it's contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample6.cs?highlight=23)]
2. <span data-ttu-id="4836f-188">Ouvrez le fichier **IdentityModels.cs** de votre projet, qui se trouve dans le répertoire **Models** et remplacez son contenu par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="4836f-188">Open the **IdentityModels.cs** file for your project, which is located in the **Models** directory, and replace it's contents with the following:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample7.cs)]

## <a name="running-the-application-and-verifying-the-database"></a><span data-ttu-id="4836f-189">Exécution de l’application et vérification de la base de données</span><span class="sxs-lookup"><span data-stu-id="4836f-189">Running the application and verifying the database</span></span>

<span data-ttu-id="4836f-190">Une fois que vous avez effectué les étapes décrites dans les sections précédentes, vous devez tester votre base de données.</span><span class="sxs-lookup"><span data-stu-id="4836f-190">Once you have completed the steps in the preceding sections, you should test your database.</span></span> <span data-ttu-id="4836f-191">Pour ce faire, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="4836f-191">To do so, use the following steps:</span></span>

1. <span data-ttu-id="4836f-192">Appuyez sur **CTRL + F5** pour générer et exécuter l’application Web.</span><span class="sxs-lookup"><span data-stu-id="4836f-192">Press **Ctrl + F5** to build and run the web application.</span></span>
2. <span data-ttu-id="4836f-193">Cliquez sur l’onglet **inscrire** en haut de la page :</span><span class="sxs-lookup"><span data-stu-id="4836f-193">Click the **Register** tab on the top of the page:</span></span>

   <span data-ttu-id="4836f-194">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-194">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="4836f-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span></span>
3. <span data-ttu-id="4836f-196">Entrez un nouveau nom d’utilisateur et un nouveau mot de passe, puis cliquez sur **s’inscrire**:</span><span class="sxs-lookup"><span data-stu-id="4836f-196">Enter a new user name and password, and then click **Register**:</span></span>

   <span data-ttu-id="4836f-197">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-197">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span></span>
4. <span data-ttu-id="4836f-199">À ce stade, les tables de ASP.NET Identity sont créées sur la base de données MySQL, et l’utilisateur est inscrit et connecté à l’application :</span><span class="sxs-lookup"><span data-stu-id="4836f-199">At this point the ASP.NET Identity tables are created on the MySQL Database, and the user is registered and logged into the application:</span></span>

   <span data-ttu-id="4836f-200">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-200">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span><span class="sxs-lookup"><span data-stu-id="4836f-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span></span>

### <a name="installing-mysql-workbench-tool-to-verify-the-data"></a><span data-ttu-id="4836f-202">Installation de MySQL Workbench Tool pour vérifier les données</span><span class="sxs-lookup"><span data-stu-id="4836f-202">Installing MySQL Workbench tool to verify the data</span></span>

1. <span data-ttu-id="4836f-203">Installer l’outil **MySQL Workbench** à partir de la [page téléchargements MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="4836f-203">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="4836f-204">Dans l’Assistant Installation : onglet **sélection des fonctionnalités** , sélectionnez **MySQL Workbench** sous la section **applications** .</span><span class="sxs-lookup"><span data-stu-id="4836f-204">In the installation wizard: **Feature Selection** tab, select **MySQL Workbench** under **applications** section.</span></span>
3. <span data-ttu-id="4836f-205">Lancez l’application et ajoutez une nouvelle connexion à l’aide des données de chaîne de connexion de la base de données Azure MySQL que vous avez créée à l’bâton de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="4836f-205">Launch the app and add a new connection using the connection string data from the Azure MySQL database you created at the begging of this tutorial.</span></span>
4. <span data-ttu-id="4836f-206">Après avoir établi la connexion, examinez les tables de **ASP.net Identity** créées sur le **IdentityMySQLDatabase.**</span><span class="sxs-lookup"><span data-stu-id="4836f-206">After establishing the connection, inspect the **ASP.NET Identity** tables created on the **IdentityMySQLDatabase.**</span></span>
5. <span data-ttu-id="4836f-207">Vous verrez que toutes les ASP.NET Identity tables requises sont créées comme indiqué dans l’image ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="4836f-207">You will see that all ASP.NET Identity required tables are created as shown in the image below:</span></span>

   <span data-ttu-id="4836f-208">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-208">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="4836f-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span></span>
6. <span data-ttu-id="4836f-210">Inspectez la table **aspnetusers** pour rechercher des entrées lorsque vous inscrivez de nouveaux utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4836f-210">Inspect the **aspnetusers** table for instance to check for the entries as you register new users.</span></span>

   <span data-ttu-id="4836f-211">[Cliquez sur l’image suivante pour la développer.</span><span class="sxs-lookup"><span data-stu-id="4836f-211">[Click the following image to expand it.</span></span> <span data-ttu-id="4836f-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="4836f-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span></span>
