---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Ajout d’ASP.NET Identity à un site Web vide ou existant constitue le projet - ASP.NET 4.x
author: raquelsa
description: Ce didacticiel vous montre comment ajouter ASP.NET Identity (le système d’appartenance ASP.NET) à une application ASP.NET. Lorsque vous créez un nouveau Web Forms ou MVC...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8f66cdb46e4cd02509092ea3bdcb7af9c292eb8f
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59394313"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="7f9bb-104">Ajout d’ASP.NET Identity à un projet Web Forms vide ou existant</span><span class="sxs-lookup"><span data-stu-id="7f9bb-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>


> <span data-ttu-id="7f9bb-105">Ce didacticiel vous montre comment ajouter [ASP.NET Identity](introduction-to-aspnet-identity.md) (le nouveau système d’appartenance pour ASP.NET) à une application ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="7f9bb-106">Lorsque vous créez un nouveau projet Web Forms ou MVC dans Visual Studio 2017 RTM avec des comptes individuels, Visual Studio installera tous les packages requis et ajouter toutes les classes nécessaires pour vous.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="7f9bb-107">Ce didacticiel illustre les étapes pour ajouter la prise en charge ASP.NET Identity à votre projet Web Forms existant ou un nouveau projet vide.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="7f9bb-108">J’ai décrit tous les packages NuGet que vous devez installer et vous devez ajouter des classes.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="7f9bb-109">Je passe en revue les exemples de formulaires Web pour l’inscription de nouveaux utilisateurs et la journalisation lors de la mise en surbrillance toutes les API de point d’entrée principal pour l’authentification et de gestion des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="7f9bb-110">Cet exemple utilise l’implémentation par défaut de ASP.NET Identity pour le stockage de données SQL qui est basé sur Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="7f9bb-111">Ce didacticiel, nous allons utiliser la base de données locale pour la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="7f9bb-112">Bien démarrer avec ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="7f9bb-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="7f9bb-113">Démarrez en installant et en cours d’exécution [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="7f9bb-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="7f9bb-114">Sélectionnez **nouveau projet** à partir du début page, ou vous pouvez utiliser le menu et sélectionnez **fichier**, puis **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="7f9bb-115">Dans le volet gauche, développez **Visual C#** , puis sélectionnez **Web**, puis **Application Web ASP.NET (.Net Framework)**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="7f9bb-116">Nommez votre projet « WebFormsIdentity » et sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="7f9bb-117">Dans le **nouveau projet ASP.NET** boîte de dialogue, sélectionnez le **vide** modèle.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="7f9bb-118">Notez que le **modifier l’authentification** bouton est désactivé et aucune prise en charge l’authentification n’est fourni dans ce modèle.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="7f9bb-119">Les modèles Web Forms, MVC et API Web permettent de sélectionner l’approche de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="7f9bb-120">Ajouter des packages de l’identité à votre application</span><span class="sxs-lookup"><span data-stu-id="7f9bb-120">Add Identity packages to your app</span></span>

<span data-ttu-id="7f9bb-121">Dans l’Explorateur de solutions, cliquez sur votre projet et sélectionnez **gérer les Packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="7f9bb-122">Recherchez et installez le **Microsoft.AspNet.Identity.EntityFramework** package.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="7f9bb-123">Notez que ce package installe les packages de dépendance : **EntityFramework** et **identité Microsoft ASP.NET Core**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="7f9bb-124">Ajoutez un formulaire web pour inscrire des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="7f9bb-124">Add a web form to register users</span></span>

1. <span data-ttu-id="7f9bb-125">Dans **l’Explorateur de solutions**, cliquez sur votre projet et sélectionnez **ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="7f9bb-126">Dans le **spécifier le nom de l’élément** boîte de dialogue, le nom du nouveau formulaire web **inscrire**, puis sélectionnez **OK**</span><span class="sxs-lookup"><span data-stu-id="7f9bb-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="7f9bb-127">Remplacez le balisage dans le texte généré *Register.aspx* fichier par le code ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="7f9bb-128">Les modifications du code apparaissent en surbrillance.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="7f9bb-129">Il s’agit simplement d’une version simplifiée de la *Register.aspx* fichier est créé lorsque vous créez un nouveau projet ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="7f9bb-130">Le balisage ci-dessus ajoute des champs de formulaire et un bouton pour inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="7f9bb-131">Ouvrez le *Register.aspx.cs* fichier et remplacez le contenu du fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7f9bb-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="7f9bb-132">Le code ci-dessus est une version simplifiée de la *Register.aspx.cs* fichier est créé lorsque vous créez un nouveau projet ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="7f9bb-133">Le *IdentityUser* classe est l’implémentation EntityFramework par défaut de la *IUser* interface.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="7f9bb-134">*IUser* interface est l’interface minimale pour un utilisateur sur l’identité de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="7f9bb-135">Le *UserStore* classe est l’implémentation d’Entity Framework par défaut d’un magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="7f9bb-136">Cette classe implémente les interfaces minimales de l’identité d’ASP.NET Core : *IUserStore*, *IUserLoginStore*, *IUserClaimStore* et *IUserRoleStore*.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="7f9bb-137">Le *UserManager* classe expose l’API qui enregistrement automatiquement les modifications associées à la *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="7f9bb-138">Le *IdentityResult* classe représente le résultat d’une opération d’identité.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="7f9bb-139">Dans **l’Explorateur de solutions**, cliquez sur votre projet et sélectionnez **ajouter**, **ajouter le dossier ASP.NET** , puis **application\_données**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="7f9bb-140">Ouvrez le *Web.config* fichier, puis ajoutez une entrée de chaîne de connexion pour la base de données que nous utiliserons pour stocker les informations utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="7f9bb-141">La base de données est créé lors de l’exécution par Entity Framework pour les entités d’identité.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="7f9bb-142">La chaîne de connexion est similaire à celui créé pour vous lorsque vous créez un nouveau projet Web Forms.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="7f9bb-143">Le code en surbrillance montre le balisage que vous devez ajouter :</span><span class="sxs-lookup"><span data-stu-id="7f9bb-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="7f9bb-144">Pour Visual Studio 2015 ou version ultérieure, remplacez `(localdb)\v11.0` avec `(localdb)\MSSQLLocalDB` dans votre chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="7f9bb-145">Cliquez avec le bouton droit sur fichier *Register.aspx* dans votre projet, puis sélectionnez **définir comme Page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="7f9bb-146">Appuyez sur Ctrl + F5 pour générer et exécuter l’application web.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="7f9bb-147">Entrez un nouveau nom d’utilisateur et le mot de passe, puis sélectionnez **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="7f9bb-148">ASP.NET Identity a prise en charge pour la validation et dans cet exemple, vous pouvez vérifier le comportement par défaut sur l’utilisateur et mot de passe validateurs sont fournis à partir du package de base de l’identité.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="7f9bb-149">Le validateur par défaut pour l’utilisateur (`UserValidator`) possède une propriété `AllowOnlyAlphanumericUserNames` qui a la valeur par défaut est définie sur `true`.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="7f9bb-150">Le validateur par défaut pour le mot de passe (`MinimumLengthValidator`) garantit que ce mot de passe a au moins 6 caractères.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="7f9bb-151">Ces validateurs sont des propriétés sur `UserManager` qui peut être substituée si vous souhaitez que la validation personnalisée,</span><span class="sxs-lookup"><span data-stu-id="7f9bb-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="7f9bb-152">Vérifiez que la base de données de l’identité de la base de données locale et les tables générées par Entity Framework</span><span class="sxs-lookup"><span data-stu-id="7f9bb-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="7f9bb-153">Dans le **vue** menu, sélectionnez **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="7f9bb-154">Développez **DefaultConnection (WebFormsIdentity)**, développez **Tables**, avec le bouton droit **AspNetUsers** , puis sélectionnez **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="7f9bb-155">Configurer l’application pour l’authentification OWIN</span><span class="sxs-lookup"><span data-stu-id="7f9bb-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="7f9bb-156">À ce stade nous avons seulement ajouté la prise en charge pour la création d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="7f9bb-157">Nous allons maintenant, pour illustrer la façon dont nous pouvons ajouter l’authentification pour vous connecter un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="7f9bb-158">ASP.NET Identity utilise l’intergiciel d’authentification OWIN de Microsoft pour l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="7f9bb-159">L’authentification de Cookie OWIN est un cookie et le mécanisme d’authentification basé sur qui peut être utilisée par n’importe quelle infrastructure hébergée sur des revendications [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) ou IIS.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="7f9bb-160">Avec ce modèle, les packages de l’authentification même peuvent être utilisés sur plusieurs infrastructures, notamment ASP.NET MVC et Web Forms.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="7f9bb-161">Pour plus d’informations sur le projet Katana et comment exécuter l’intergiciel (middleware) dans un consultez agnostique hôte [mise en route avec le projet Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="7f9bb-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="7f9bb-162">Installer les packages d’authentification à votre application</span><span class="sxs-lookup"><span data-stu-id="7f9bb-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="7f9bb-163">Dans l’Explorateur de solutions, cliquez sur votre projet et sélectionnez **gérer les Packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="7f9bb-164">Recherchez et installez le ***Microsoft.AspNet.Identity.Owin*** package.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="7f9bb-165">Recherchez et installez le ***Microsoft.Owin.Host.SystemWeb*** package.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="7f9bb-166">Le **Microsoft.Aspnet.Identity.Owin** package contient un ensemble de classes d’extension OWIN pour gérer et configurer l’intergiciel (middleware) OWIN d’authentification pour être consommés par les packages de base d’identité ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="7f9bb-167">Le **Microsoft.Owin.Host.SystemWeb** package contient un serveur OWIN qui permet aux applications basées sur OWIN s’exécutent sur IIS à l’aide du pipeline de demande ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="7f9bb-168">Pour plus d’informations, consultez [intergiciel (middleware) OWIN dans IIS intégré pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="7f9bb-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="7f9bb-169">Ajouter des classes de configuration de démarrage et d’authentification OWIN</span><span class="sxs-lookup"><span data-stu-id="7f9bb-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="7f9bb-170">Dans **l’Explorateur de solutions**, cliquez sur votre projet, sélectionnez **ajouter**, puis **ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="7f9bb-171">Dans la boîte de dialogue zone de texte de recherche, tapez «*owin*».</span><span class="sxs-lookup"><span data-stu-id="7f9bb-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="7f9bb-172">Nommez la classe «*démarrage*» et sélectionnez **ajouter**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="7f9bb-173">Dans le fichier Startup.cs, ajoutez le code en surbrillance ci-dessous pour configurer l’authentification des cookies OWIN.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="7f9bb-174">Cette classe contient le `OwinStartup` attribut pour spécifier la classe de démarrage OWIN.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="7f9bb-175">Chaque application OWIN a une classe de démarrage où vous spécifiez des composants pour le pipeline d’application.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="7f9bb-176">Consultez [détection de classe de démarrage OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) pour plus d’informations sur ce modèle.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="7f9bb-177">Ajouter des formulaires web pour l’inscription et la signature des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="7f9bb-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="7f9bb-178">Ouvrez le *Register.aspx.cs* fichier, puis ajoutez le code suivant qui connecte l’utilisateur lors de l’inscription réussit.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="7f9bb-179">Dans la mesure où ASP.NET Identity et l’authentification des cookies OWIN sont du système basée sur les revendications, le framework exige que le développeur d’application générer un [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="7f9bb-180">ClaimsIdentity comporte des informations sur toutes les revendications pour l’utilisateur telles que les rôles de l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="7f9bb-181">Vous pouvez également ajouter plusieurs revendications de l’utilisateur à ce stade.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="7f9bb-182">Vous pouvez connecter l’utilisateur à l’aide de la classe AuthenticationManager d’OWIN et en appelant `SignIn` et en transmettant le ClaimsIdentity comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="7f9bb-183">Ce code connecte l’utilisateur et générer ainsi un cookie.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="7f9bb-184">Cet appel est analogue à [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="7f9bb-185">Dans **l’Explorateur de solutions**, cliquez sur votre projet, sélectionnez **ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="7f9bb-186">Nommez le formulaire web **connexion**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="7f9bb-187">Remplacez le contenu de la *Login.aspx* fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7f9bb-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="7f9bb-188">Remplacez le contenu de la *Login.aspx.cs* fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7f9bb-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="7f9bb-189">Le `Page_Load` maintenant vérifie l’état de l’utilisateur actuel et prend des mesures en fonction de son `Context.User.Identity.IsAuthenticated` état.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="7f9bb-190">**Affichage enregistré dans le nom d’utilisateur** : L’infrastructure d’identité Microsoft ASP.NET a ajouté des méthodes d’extension sur [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) qui permet d’obtenir le `UserName` et `UserId` pour l’utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="7f9bb-191">Ces méthodes d’extension sont définies dans le `Microsoft.AspNet.Identity.Core` assembly.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="7f9bb-192">Ces méthodes d’extension sont le remplacement pour [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="7f9bb-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="7f9bb-193">Méthode de connexion : `This` méthode remplace la précédente `CreateUser_Click` méthode dans cet exemple et cette maintenant se connecte l’utilisateur après avoir créé l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="7f9bb-194">L’infrastructure OWIN de Microsoft a ajouté des méthodes d’extension sur `System.Web.HttpContext` qui vous permet d’obtenir une référence à un `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="7f9bb-195">Ces méthodes d’extension sont définies dans `Microsoft.Owin.Host.SystemWeb` assembly.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="7f9bb-196">Le `OwinContext` classe expose un `IAuthenticationManager` propriété qui représente les fonctionnalités d’intergiciel (middleware) d’authentification disponibles sur la requête actuelle.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="7f9bb-197">Vous pouvez connecter l’utilisateur à l’aide de la `AuthenticationManager` de OWIN et l’appel `SignIn` et en passant le `ClaimsIdentity` comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="7f9bb-198">Identité ASP.NET et l’authentification des cookies OWIN étant système basé sur les revendications, l’infrastructure requiert l’application pour générer un `ClaimsIdentity` pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="7f9bb-199">Le `ClaimsIdentity` contient des informations sur toutes les revendications pour l’utilisateur, telles que les rôles de l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="7f9bb-200">Vous pouvez également ajouter plusieurs revendications de l’utilisateur à ce stade, ce code connecte l’utilisateur et générer ainsi un cookie.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="7f9bb-201">Cet appel est analogue à [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="7f9bb-202">`SignOut` méthode : Obtient une référence à la `AuthenticationManager` de OWIN et appelle `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="7f9bb-203">Ce comportement est analogue à [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) méthode utilisée par le [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="7f9bb-204">Appuyez sur **Ctrl + F5** pour générer et exécuter l’application web.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="7f9bb-205">Entrez un nouveau nom d’utilisateur et le mot de passe, puis sélectionnez **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="7f9bb-206">Remarque : À ce stade, le nouvel utilisateur est créé et connecté.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="7f9bb-207">Sélectionnez le **déconnecter** bouton.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-207">Select the **Log out** button.</span></span> <span data-ttu-id="7f9bb-208">Vous êtes redirigé vers le journal dans le formulaire.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="7f9bb-209">Entrez un nom d’utilisateur non valide ou le mot de passe, puis sélectionnez le **connectez-vous** bouton.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="7f9bb-210">Le `UserManager.Find` méthode retournera null et le message d’erreur : " *Nom d’utilisateur non valide ou le mot de passe* « s’affichera.</span><span class="sxs-lookup"><span data-stu-id="7f9bb-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
