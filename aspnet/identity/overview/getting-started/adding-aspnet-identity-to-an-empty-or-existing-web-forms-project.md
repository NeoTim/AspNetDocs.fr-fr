---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Ajout d’ASP.NET Identity à un projet Web Forms vide ou existant-ASP.NET 4. x
author: raquelsa
description: Ce didacticiel vous montre comment ajouter ASP.NET Identity (le système d’appartenance pour ASP.NET) à une application ASP.NET. Quand vous créez une nouvelle Web Forms ou MVC...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8e82951d57f0b8052ee3f6530a7470be7d030206
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584125"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="aa82f-104">Ajout d’ASP.NET Identity à un projet Web Forms vide ou existant</span><span class="sxs-lookup"><span data-stu-id="aa82f-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>

> <span data-ttu-id="aa82f-105">Ce didacticiel vous montre comment ajouter des [ASP.net Identity](introduction-to-aspnet-identity.md) (le nouveau système d’appartenance pour ASP.net) à une application ASP.net.</span><span class="sxs-lookup"><span data-stu-id="aa82f-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="aa82f-106">Lorsque vous créez un nouveau Web Forms ou un projet MVC dans Visual Studio 2017 RTM avec des comptes individuels, Visual Studio installe tous les packages requis et ajoute toutes les classes nécessaires pour vous.</span><span class="sxs-lookup"><span data-stu-id="aa82f-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="aa82f-107">Ce didacticiel illustre les étapes permettant d’ajouter ASP.NET Identity la prise en charge de votre projet de Web Forms existant ou d’un nouveau projet vide.</span><span class="sxs-lookup"><span data-stu-id="aa82f-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="aa82f-108">Je vais présenter tous les packages NuGet que vous devez installer, ainsi que les classes que vous devez ajouter.</span><span class="sxs-lookup"><span data-stu-id="aa82f-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="aa82f-109">Je vais passer en revue les exemples de Web Forms pour l’inscription de nouveaux utilisateurs et la connexion, tout en mettant en surbrillance toutes les API de point d’entrée principales pour la gestion et l’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="aa82f-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="aa82f-110">Cet exemple utilise l’implémentation par défaut ASP.NET Identity pour le stockage de données SQL qui repose sur Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="aa82f-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="aa82f-111">Dans ce didacticiel, nous allons utiliser la base de données locale pour SQL Database.</span><span class="sxs-lookup"><span data-stu-id="aa82f-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="aa82f-112">Prise en main de ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="aa82f-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="aa82f-113">Commencez par installer et exécuter [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="aa82f-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="aa82f-114">Sélectionnez **nouveau projet** dans la page de démarrage, ou utilisez le menu et sélectionnez **fichier**, puis **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="aa82f-115">Dans le volet gauche, développez **visuel C#** , puis sélectionnez **Web**, puis **application Web ASP.net (.NET Framework)** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="aa82f-116">Nommez votre projet « WebFormsIdentity » et sélectionnez **OK**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="aa82f-117">Dans la boîte de dialogue **nouveau projet ASP.net** , sélectionnez le modèle **vide** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="aa82f-118">Notez que le bouton **modifier l’authentification** est désactivé et qu’aucune prise en charge de l’authentification n’est fournie dans ce modèle.</span><span class="sxs-lookup"><span data-stu-id="aa82f-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="aa82f-119">Les modèles Web Forms, MVC et API Web vous permettent de sélectionner l’approche d’authentification.</span><span class="sxs-lookup"><span data-stu-id="aa82f-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="aa82f-120">Ajouter des packages d’identité à votre application</span><span class="sxs-lookup"><span data-stu-id="aa82f-120">Add Identity packages to your app</span></span>

<span data-ttu-id="aa82f-121">Dans Explorateur de solutions, cliquez avec le bouton droit sur votre projet et sélectionnez **gérer les packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="aa82f-122">Recherchez et installez le package **Microsoft. Aspnet. Identity. EntityFramework** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="aa82f-123">Notez que ce package installe les packages de dépendances : **EntityFramework** et **Microsoft ASP.net principal d’identité**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="aa82f-124">Ajouter un formulaire Web pour inscrire des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="aa82f-124">Add a web form to register users</span></span>

1. <span data-ttu-id="aa82f-125">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur votre projet et sélectionnez **Ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="aa82f-126">Dans la boîte de dialogue **spécifier le nom de l’élément** , nommez le nouveau **registre**Web Form, puis sélectionnez **OK** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="aa82f-127">Remplacez le balisage dans le fichier *Register. aspx* généré par le code ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="aa82f-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="aa82f-128">Les modifications du code apparaissent en surbrillance.</span><span class="sxs-lookup"><span data-stu-id="aa82f-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="aa82f-129">Il s’agit simplement d’une version simplifiée du fichier *Register. aspx* créé lorsque vous créez un projet de Web Forms ASP.net.</span><span class="sxs-lookup"><span data-stu-id="aa82f-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="aa82f-130">Le balisage ci-dessus ajoute des champs de formulaire et un bouton pour inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="aa82f-131">Ouvrez le fichier *Register.aspx.cs* et remplacez le contenu du fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="aa82f-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="aa82f-132">Le code ci-dessus est une version simplifiée du fichier *Register.aspx.cs* créé lorsque vous créez un projet de Web Forms ASP.net.</span><span class="sxs-lookup"><span data-stu-id="aa82f-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="aa82f-133">La classe *IdentityUser* est l’implémentation d’EntityFramework par défaut de l’interface *IUser* .</span><span class="sxs-lookup"><span data-stu-id="aa82f-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="aa82f-134">L’interface *IUser* est l’interface minimale pour un utilisateur sur ASP.net Identity noyau.</span><span class="sxs-lookup"><span data-stu-id="aa82f-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="aa82f-135">La classe *UserStore* est l’implémentation d’EntityFramework par défaut d’un magasin d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="aa82f-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="aa82f-136">Cette classe implémente les interfaces minimales du ASP.NET Identity Core : *IUserStore*, *IUserLoginStore*, *IUserClaimStore* et *IUserRoleStore*.</span><span class="sxs-lookup"><span data-stu-id="aa82f-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="aa82f-137">La classe *usermanager* expose les API associées à l’utilisateur, qui enregistre automatiquement les modifications apportées au *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="aa82f-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="aa82f-138">La classe *IdentityResult* représente le résultat d’une opération d’identité.</span><span class="sxs-lookup"><span data-stu-id="aa82f-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="aa82f-139">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur votre projet et sélectionnez **Ajouter**, **Ajoutez le dossier ASP.net** , puis **application\_données**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="aa82f-140">Ouvrez le fichier *Web. config* et ajoutez une entrée de chaîne de connexion pour la base de données que nous utiliserons pour stocker les informations utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="aa82f-141">La base de données sera créée au moment de l’exécution par EntityFramework pour les entités d’identité.</span><span class="sxs-lookup"><span data-stu-id="aa82f-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="aa82f-142">La chaîne de connexion est similaire à celle créée pour vous lorsque vous créez un projet de Web Forms.</span><span class="sxs-lookup"><span data-stu-id="aa82f-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="aa82f-143">Le code en surbrillance montre le balisage que vous devez ajouter :</span><span class="sxs-lookup"><span data-stu-id="aa82f-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="aa82f-144">Pour Visual Studio 2015 ou une version ultérieure, remplacez `(localdb)\v11.0` par `(localdb)\MSSQLLocalDB` dans votre chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="aa82f-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="aa82f-145">Cliquez avec le bouton droit sur fichier *Register. aspx* dans votre projet, puis sélectionnez **définir comme page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="aa82f-146">Appuyez sur CTRL + F5 pour générer et exécuter l’application Web.</span><span class="sxs-lookup"><span data-stu-id="aa82f-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="aa82f-147">Entrez un nouveau nom d’utilisateur et un nouveau mot de passe, puis sélectionnez **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="aa82f-148">ASP.NET Identity prend en charge la validation et, dans cet exemple, vous pouvez vérifier le comportement par défaut sur les validateurs d’utilisateur et de mot de passe provenant du package d’identité principal.</span><span class="sxs-lookup"><span data-stu-id="aa82f-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="aa82f-149">Le validateur par défaut de l’utilisateur (`UserValidator`) a une propriété `AllowOnlyAlphanumericUserNames` dont la valeur par défaut est définie sur `true`.</span><span class="sxs-lookup"><span data-stu-id="aa82f-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="aa82f-150">Le validateur par défaut pour le mot de passe (`MinimumLengthValidator`) garantit que le mot de passe comporte au moins 6 caractères.</span><span class="sxs-lookup"><span data-stu-id="aa82f-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="aa82f-151">Ces validateurs sont des propriétés sur `UserManager` qui peuvent être substituées si vous souhaitez avoir une validation personnalisée.</span><span class="sxs-lookup"><span data-stu-id="aa82f-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="aa82f-152">Vérifiez la base de données d’identités de base de données locale et les tables générées par Entity Framework</span><span class="sxs-lookup"><span data-stu-id="aa82f-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="aa82f-153">Dans le menu **affichage** , sélectionnez **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="aa82f-154">Développez **DefaultConnection (WebFormsIdentity)** , développez **tables**, cliquez avec le bouton droit sur **AspNetUsers** , puis sélectionnez **afficher les données**de la table.</span><span class="sxs-lookup"><span data-stu-id="aa82f-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="aa82f-155">Configurer l’application pour l’authentification OWIN</span><span class="sxs-lookup"><span data-stu-id="aa82f-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="aa82f-156">À ce stade, nous avons ajouté uniquement la prise en charge de la création d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="aa82f-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="aa82f-157">Maintenant, nous allons montrer comment nous pouvons ajouter l’authentification pour se connecter à un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="aa82f-158">ASP.NET Identity utilise l’intergiciel (middleware) d’authentification Microsoft OWIN pour l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="aa82f-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="aa82f-159">OWIN cookie Authentication est un mécanisme d’authentification basé sur les cookies et les revendications qui peut être utilisé par n’importe quelle infrastructure hébergée sur [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) ou IIS.</span><span class="sxs-lookup"><span data-stu-id="aa82f-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="aa82f-160">Avec ce modèle, les mêmes packages d’authentification peuvent être utilisés dans plusieurs frameworks, notamment ASP.NET MVC et Web Forms.</span><span class="sxs-lookup"><span data-stu-id="aa82f-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="aa82f-161">Pour plus d’informations sur le projet Katana et sur la façon d’exécuter un intergiciel dans un hôte agnostique, consultez [prise en main avec le projet Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="aa82f-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="aa82f-162">Installer des packages d’authentification dans votre application</span><span class="sxs-lookup"><span data-stu-id="aa82f-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="aa82f-163">Dans Explorateur de solutions, cliquez avec le bouton droit sur votre projet et sélectionnez **gérer les packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="aa82f-164">Recherchez et installez le package ***Microsoft. Aspnet. Identity. Owin*** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="aa82f-165">Recherchez et installez le package ***Microsoft. Owin. Host. SystemWeb*** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="aa82f-166">Le package **Microsoft. Aspnet. Identity. Owin** contient un ensemble de classes d’extension Owin pour gérer et configurer l’intergiciel (middleware) d’authentification Owin à consommer par ASP.net Identity packages principaux.</span><span class="sxs-lookup"><span data-stu-id="aa82f-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="aa82f-167">Le package **Microsoft. Owin. Host. SystemWeb** contient un serveur Owin qui permet aux applications Owin de s’exécuter sur IIS à l’aide du pipeline de demande ASP.net.</span><span class="sxs-lookup"><span data-stu-id="aa82f-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="aa82f-168">Pour plus d’informations [, consultez middleware OWIN dans le pipeline intégré IIS](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="aa82f-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="aa82f-169">Ajouter des classes de configuration de démarrage et d’authentification OWIN</span><span class="sxs-lookup"><span data-stu-id="aa82f-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="aa82f-170">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur votre projet, sélectionnez **Ajouter**, puis **Ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="aa82f-171">Dans la boîte de dialogue zone de texte de recherche, tapez «*Owin*».</span><span class="sxs-lookup"><span data-stu-id="aa82f-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="aa82f-172">Nommez la classe «*Startup*», puis sélectionnez **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="aa82f-173">Dans le fichier Startup.cs, ajoutez le code en surbrillance ci-dessous pour configurer l’authentification de cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="aa82f-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="aa82f-174">Cette classe contient l’attribut `OwinStartup` pour la spécification de la classe de démarrage OWIN.</span><span class="sxs-lookup"><span data-stu-id="aa82f-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="aa82f-175">Chaque application OWIN a une classe Startup dans laquelle vous spécifiez les composants du pipeline d’application.</span><span class="sxs-lookup"><span data-stu-id="aa82f-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="aa82f-176">Pour plus d’informations sur ce modèle, consultez [détection de classe de démarrage OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) .</span><span class="sxs-lookup"><span data-stu-id="aa82f-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="aa82f-177">Ajouter des Web Forms pour l’inscription et la connexion des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="aa82f-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="aa82f-178">Ouvrez le fichier *Register.aspx.cs* et ajoutez le code suivant qui connecte l’utilisateur lorsque l’inscription est réussie.</span><span class="sxs-lookup"><span data-stu-id="aa82f-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="aa82f-179">Étant donné que les ASP.NET Identity et l’authentification des cookies OWIN sont des systèmes basés sur les revendications, l’infrastructure exige que le développeur de l’application génère un [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="aa82f-180">ClaimsIdentity contient des informations sur toutes les revendications pour l’utilisateur, telles que les rôles auxquels l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="aa82f-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="aa82f-181">Vous pouvez également ajouter d’autres revendications pour l’utilisateur à ce niveau.</span><span class="sxs-lookup"><span data-stu-id="aa82f-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="aa82f-182">Vous pouvez connecter l’utilisateur à l’aide du AuthenticationManager à partir de OWIN et en appelant `SignIn` et en passant le ClaimsIdentity comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="aa82f-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="aa82f-183">Ce code permet de connecter l’utilisateur et de générer également un cookie.</span><span class="sxs-lookup"><span data-stu-id="aa82f-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="aa82f-184">Cet appel est analogue à [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le module [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="aa82f-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="aa82f-185">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur votre projet, sélectionnez **Ajouter**, puis **Web Form**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="aa82f-186">Nommez la **connexion**Web Form.</span><span class="sxs-lookup"><span data-stu-id="aa82f-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="aa82f-187">Remplacez le contenu du fichier *login. aspx* par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="aa82f-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="aa82f-188">Remplacez le contenu du fichier *login.aspx.cs* par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="aa82f-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="aa82f-189">Le `Page_Load` vérifie à présent l’état de l’utilisateur actuel et entreprend une action en fonction de son état `Context.User.Identity.IsAuthenticated`.</span><span class="sxs-lookup"><span data-stu-id="aa82f-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="aa82f-190">**Afficher le nom d’utilisateur connecté** : le Framework d’identité Microsoft ASP.net a ajouté des méthodes d’extension sur [System. Security. principal. IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) qui vous permet d’obtenir le `UserName` et `UserId` pour l’utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="aa82f-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="aa82f-191">Ces méthodes d’extension sont définies dans l’assembly `Microsoft.AspNet.Identity.Core`.</span><span class="sxs-lookup"><span data-stu-id="aa82f-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="aa82f-192">Ces méthodes d’extension remplacent [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="aa82f-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="aa82f-193">Méthode de connexion : `This` méthode remplace la méthode `CreateUser_Click` précédente dans cet exemple et connecte désormais l’utilisateur après avoir créé l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="aa82f-194">L’infrastructure Microsoft OWIN a ajouté des méthodes d’extension sur `System.Web.HttpContext` qui vous permettent d’obtenir une référence à une `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="aa82f-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="aa82f-195">Ces méthodes d’extension sont définies dans `Microsoft.Owin.Host.SystemWeb` assembly.</span><span class="sxs-lookup"><span data-stu-id="aa82f-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="aa82f-196">La classe `OwinContext` expose une propriété `IAuthenticationManager` qui représente les fonctionnalités d’intergiciel (middleware) d’authentification disponibles sur la requête actuelle.</span><span class="sxs-lookup"><span data-stu-id="aa82f-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="aa82f-197">Vous pouvez connecter l’utilisateur à l’aide de la `AuthenticationManager` à partir de OWIN et en appelant `SignIn` et en passant le `ClaimsIdentity` comme indiqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="aa82f-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="aa82f-198">Étant donné que ASP.NET Identity et l’authentification des cookies OWIN sont des systèmes basés sur les revendications, l’infrastructure requiert que l’application génère un `ClaimsIdentity` pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="aa82f-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="aa82f-199">Le `ClaimsIdentity` contient des informations sur toutes les revendications pour l’utilisateur, telles que les rôles auxquels l’utilisateur appartient.</span><span class="sxs-lookup"><span data-stu-id="aa82f-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="aa82f-200">Vous pouvez également ajouter d’autres revendications pour l’utilisateur à ce niveau. ce code se connecte à l’utilisateur et génère également un cookie.</span><span class="sxs-lookup"><span data-stu-id="aa82f-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="aa82f-201">Cet appel est analogue à [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) utilisé par le module [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="aa82f-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="aa82f-202">méthode `SignOut` : obtient une référence au `AuthenticationManager` à partir de OWIN et appelle `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="aa82f-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="aa82f-203">Cela est analogue à la méthode [FormsAuthentication. SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) utilisée par le module [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="aa82f-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="aa82f-204">Appuyez sur **CTRL + F5** pour générer et exécuter l’application Web.</span><span class="sxs-lookup"><span data-stu-id="aa82f-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="aa82f-205">Entrez un nouveau nom d’utilisateur et un nouveau mot de passe, puis sélectionnez **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="aa82f-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="aa82f-206">Remarque : à ce stade, le nouvel utilisateur est créé et connecté.</span><span class="sxs-lookup"><span data-stu-id="aa82f-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="aa82f-207">Sélectionnez le bouton **se déconnecter** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-207">Select the **Log out** button.</span></span> <span data-ttu-id="aa82f-208">Vous êtes redirigé vers le formulaire de connexion.</span><span class="sxs-lookup"><span data-stu-id="aa82f-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="aa82f-209">Entrez un nom d’utilisateur ou un mot de passe non valide, puis sélectionnez le bouton **se connecter** .</span><span class="sxs-lookup"><span data-stu-id="aa82f-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="aa82f-210">La méthode `UserManager.Find` retourne la valeur null et le message d’erreur suivant s’affiche : « *nom d’utilisateur ou mot de passe non valide* ».</span><span class="sxs-lookup"><span data-stu-id="aa82f-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
