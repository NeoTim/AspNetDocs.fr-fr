---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Développement d’applications ASP.NET avec Azure Active Directory-ASP.NET 4. x
author: Rick-Anderson
description: Microsoft ASP.NET Tools pour Azure Active Directory facilite l’activation de l’authentification pour les applications Web hébergées sur Azure. Vous pouvez utiliser Azure authenti...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 28425ea8d1312dfc6e14df9677396f2cbcf6f16d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78583852"
---
# <a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="17ac8-104">Développement d’applications ASP.NET avec Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="17ac8-104">Developing ASP.NET Apps with Azure Active Directory</span></span>

<span data-ttu-id="17ac8-105">par [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="17ac8-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="17ac8-106">Microsoft ASP.NET Tools pour Azure Active Directory simplifie l’activation de l’authentification pour les applications Web hébergées sur [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="17ac8-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="17ac8-107">Vous pouvez utiliser l’authentification Azure pour authentifier les utilisateurs Office 365 de votre organisation, les comptes d’entreprise synchronisés à partir de votre Active Directory local ou les utilisateurs créés dans votre propre domaine Azure Active Directory personnalisé.</span><span class="sxs-lookup"><span data-stu-id="17ac8-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="17ac8-108">L’activation de l’authentification Windows Azure configure votre application pour authentifier les utilisateurs à l’aide d’un seul [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) locataire.</span><span class="sxs-lookup"><span data-stu-id="17ac8-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="17ac8-109">Ce didacticiel vous montre comment créer une application ASP.NET qui est configurée pour l’authentification avec [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="17ac8-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="17ac8-110">Vous allez également apprendre à appeler le API Graph pour obtenir des informations sur l’utilisateur actuellement connecté et sur la manière de déployer l’application sur Azure.</span><span class="sxs-lookup"><span data-stu-id="17ac8-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="17ac8-111">Conditions préalables requises</span><span class="sxs-lookup"><span data-stu-id="17ac8-111">Prerequisites</span></span>

1. <span data-ttu-id="17ac8-112">[Visual Studio Express 2013 pour Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) ou [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="17ac8-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="17ac8-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) -Update 3 ou version ultérieure est requis.</span><span class="sxs-lookup"><span data-stu-id="17ac8-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="17ac8-114">Un compte Azure.</span><span class="sxs-lookup"><span data-stu-id="17ac8-114">An Azure account.</span></span> <span data-ttu-id="17ac8-115">[Cliquez ici](https://azure.microsoft.com/pricing/free-trial/) pour obtenir une version d’évaluation gratuite si vous n’avez pas encore de compte.</span><span class="sxs-lookup"><span data-stu-id="17ac8-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="17ac8-116">Ajouter un administrateur général à votre Active Directory</span><span class="sxs-lookup"><span data-stu-id="17ac8-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="17ac8-117">Connectez-vous au [portail de gestion Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="17ac8-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="17ac8-118">Tous les comptes Azure contiennent un **répertoire par défaut** , cliquez dessus, puis cliquez sur l’onglet **utilisateurs** en haut de la page (Voir l’image ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="17ac8-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="17ac8-119">Cliquez sur Ajouter un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="17ac8-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="17ac8-120">Créez un utilisateur avec le rôle d' **administrateur général** .</span><span class="sxs-lookup"><span data-stu-id="17ac8-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="17ac8-121">Cliquez sur **utilisateurs** dans le menu supérieur, puis cliquez sur le bouton **Ajouter un utilisateur** dans la barre de commandes.</span><span class="sxs-lookup"><span data-stu-id="17ac8-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="17ac8-122">Dans la boîte de dialogue **Ajouter un utilisateur** , entrez un nom pour le nouvel utilisateur, puis cliquez sur la flèche droite.</span><span class="sxs-lookup"><span data-stu-id="17ac8-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="17ac8-123">Entrez le nom d’utilisateur et définissez le rôle sur **administrateur général**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="17ac8-124">Les administrateurs généraux requièrent une adresse de messagerie de secours pour la récupération du mot de passe.</span><span class="sxs-lookup"><span data-stu-id="17ac8-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="17ac8-125">Une fois que vous avez terminé, cliquez sur la flèche droite.</span><span class="sxs-lookup"><span data-stu-id="17ac8-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="17ac8-126">Sur la page suivante de la boîte de dialogue, cliquez sur **créer**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="17ac8-127">Un mot de passe temporaire sera créé pour le nouvel utilisateur et affiché dans la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="17ac8-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="17ac8-128">Enregistrez le mot de passe, vous devez modifier le mot de passe après la première connexion.</span><span class="sxs-lookup"><span data-stu-id="17ac8-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="17ac8-129">L’illustration suivante montre le nouveau compte d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="17ac8-129">The following image shows the new admin account.</span></span> <span data-ttu-id="17ac8-130">Vous devez utiliser la Azure Active Directory pour vous connecter à votre application, et non la compte Microsoft également indiquée sur cette page.</span><span class="sxs-lookup"><span data-stu-id="17ac8-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="17ac8-131">Créer une application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="17ac8-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="17ac8-132">Les étapes suivantes utilisent [Visual Studio Express 2013 pour le Web](https://www.microsoft.com/download/details.aspx?id=40747)et nécessitent [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="17ac8-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="17ac8-133">Dans Visual Studio, cliquez sur **fichier** , puis sur **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="17ac8-134">Dans la boîte de dialogue **nouveau projet** , sélectionnez C# le projet Web visuel dans le menu de gauche, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="17ac8-135">Vous pouvez également décocher la case **Ajouter des application Insights au projet** si vous ne souhaitez pas les fonctionnalités de votre application.</span><span class="sxs-lookup"><span data-stu-id="17ac8-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="17ac8-136">Dans la boîte de dialogue **nouveau projet ASP.net** , sélectionnez **MVC**, puis cliquez sur **modifier l’authentification**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="17ac8-137">Dans la boîte de dialogue **modifier l’authentification** , sélectionnez **comptes organisationnels**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="17ac8-138">Ces options peuvent être utilisées pour inscrire automatiquement votre application auprès de Azure AD, ainsi que pour configurer automatiquement votre application pour une intégration à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17ac8-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="17ac8-139">Vous n’êtes pas obligé d’utiliser la boîte de dialogue **modifier l’authentification** pour inscrire et configurer votre application, mais cela facilite grandement la tâche.</span><span class="sxs-lookup"><span data-stu-id="17ac8-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="17ac8-140">Si vous utilisez Visual Studio 2012, par exemple, vous pouvez toujours inscrire manuellement l’application dans le Portail de gestion Azure et mettre à jour sa configuration pour l’intégrer à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17ac8-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="17ac8-141">Dans les menus déroulants, sélectionnez **Cloud-organisation unique** et **authentification unique, lire les données d’annuaire**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="17ac8-142">Entrez le domaine de votre répertoire Azure AD, par exemple (dans les images ci-dessous) *aricka0yahoo.onmicrosoft.com*, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="17ac8-143">Vous pouvez obtenir le nom de domaine à partir de l’onglet domaines pour le répertoire par défaut sur le portail Azure (Voir l’image suivante en dessous).</span><span class="sxs-lookup"><span data-stu-id="17ac8-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="17ac8-144">L’illustration suivante montre le nom de domaine de la Portail Azure.</span><span class="sxs-lookup"><span data-stu-id="17ac8-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="17ac8-145">Vous pouvez éventuellement configurer l’URI d’ID d’application qui sera inscrit dans Azure AD en cliquant sur **plus d’options**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="17ac8-146">L’URI ID d’application est l’identificateur unique d’une application, qui est inscrite dans Azure AD et utilisée par l’application pour s’identifier lorsqu’elle communique avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="17ac8-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="17ac8-147">Pour plus d’informations sur l’URI ID d’application et d’autres propriétés des applications inscrites, consultez [cette rubrique](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="17ac8-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="17ac8-148">En cliquant sur la case à cocher sous le champ URI ID d’application, vous pouvez également choisir de remplacer une inscription existante dans Azure AD qui utilise le même URI d’ID d’application.</span><span class="sxs-lookup"><span data-stu-id="17ac8-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="17ac8-149">Une fois que vous avez cliqué sur **OK**, une boîte de dialogue de connexion s’affiche et vous devez vous connecter à l’aide d’un compte d’administrateur général (et non de la compte Microsoft associée à votre abonnement).</span><span class="sxs-lookup"><span data-stu-id="17ac8-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="17ac8-150">Si vous avez créé un nouveau compte d’administrateur précédemment, vous devez modifier le mot de passe, puis vous reconnecter à l’aide du nouveau mot de passe.</span><span class="sxs-lookup"><span data-stu-id="17ac8-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="17ac8-151">Une fois authentifié, la boîte de dialogue **nouveau projet ASP.net** affiche votre choix d’authentification (**organisation** ) et le répertoire dans lequel la nouvelle application sera inscrite (*aricka0yahoo.onmicrosoft.com* dans l’image ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="17ac8-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="17ac8-152">Sous ces informations, activez la case à cocher **hôte dans le Cloud**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="17ac8-153">Si cette case à cocher est activée, le projet est approvisionné comme une application Web Azure et sera activé pour une publication simplifiée ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="17ac8-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="17ac8-154">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="17ac8-155">La boîte de dialogue **configurer le site Web Azure** s’affiche, à l’aide d’un nom et d’une région de site générés automatiquement.</span><span class="sxs-lookup"><span data-stu-id="17ac8-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="17ac8-156">Notez également le compte auquel vous êtes actuellement connecté dans la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="17ac8-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="17ac8-157">Vous voulez vous assurer que ce compte est celui auquel votre abonnement Azure est attaché, en général un compte Microsoft.</span><span class="sxs-lookup"><span data-stu-id="17ac8-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="17ac8-158">Ce projet nécessite une base de données.</span><span class="sxs-lookup"><span data-stu-id="17ac8-158">This project requires a database.</span></span> <span data-ttu-id="17ac8-159">Vous devez sélectionner l’une de vos bases de données existantes ou en créer une nouvelle.</span><span class="sxs-lookup"><span data-stu-id="17ac8-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="17ac8-160">Une base de données est nécessaire car le projet utilise déjà un fichier de base de données local pour stocker une petite quantité de données de configuration d’authentification.</span><span class="sxs-lookup"><span data-stu-id="17ac8-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="17ac8-161">Lorsque vous déployez l’application sur un site Web Azure, cette base de données n’est pas empaquetée avec le déploiement. vous devez donc en choisir une accessible dans le Cloud.</span><span class="sxs-lookup"><span data-stu-id="17ac8-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="17ac8-162">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="17ac8-163">Le projet sera créé et vos options d’authentification et vos options d’application Web seront automatiquement configurées avec le projet.</span><span class="sxs-lookup"><span data-stu-id="17ac8-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="17ac8-164">Une fois ce processus terminé, exécutez le projet localement en appuyant sur **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="17ac8-165">Vous devez vous connecter à l’aide de votre compte professionnel.</span><span class="sxs-lookup"><span data-stu-id="17ac8-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="17ac8-166">Indiquez le nom d’utilisateur et le mot de passe du compte que vous avez créé précédemment, puis cliquez sur **se connecter**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="17ac8-167">Une fois la connexion établie, le site ASP.NET indique que vous vous êtes authentifié en affichant le nom d’utilisateur dans le coin supérieur droit de la page.</span><span class="sxs-lookup"><span data-stu-id="17ac8-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="17ac8-168">Si vous recevez l’erreur : la valeur ne peut pas être null ou vide.</span><span class="sxs-lookup"><span data-stu-id="17ac8-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="17ac8-169">Nom du paramètre : linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="17ac8-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="17ac8-170">consultez la section [Déboguer](#dbg) à la fin du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="17ac8-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="17ac8-171">Notions de base de l’API Graph</span><span class="sxs-lookup"><span data-stu-id="17ac8-171">Basics of the Graph API</span></span>

<span data-ttu-id="17ac8-172">[Le API Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) est l’interface de programmation utilisée pour effectuer des opérations CRUD et d’autres opérations sur les objets de votre répertoire Azure ad.</span><span class="sxs-lookup"><span data-stu-id="17ac8-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="17ac8-173">Si vous sélectionnez une option de compte professionnel pour l’authentification lors de la création d’un nouveau projet dans Visual Studio 2013, votre application est déjà configurée pour appeler le API Graph.</span><span class="sxs-lookup"><span data-stu-id="17ac8-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="17ac8-174">Cette section vous montre brièvement comment fonctionne le API Graph.</span><span class="sxs-lookup"><span data-stu-id="17ac8-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="17ac8-175">Dans votre application en cours d’exécution, cliquez sur le nom de l’utilisateur connecté en haut à droite de la page.</span><span class="sxs-lookup"><span data-stu-id="17ac8-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="17ac8-176">Cela vous permet de vous connecter à la page de profil utilisateur, qui est une action sur le contrôleur d’hébergement.</span><span class="sxs-lookup"><span data-stu-id="17ac8-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="17ac8-177">Vous remarquerez que la table contient des informations utilisateur sur le compte administrateur que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="17ac8-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="17ac8-178">Ces informations sont stockées dans votre répertoire, et le API Graph est appelé pour récupérer ces informations lors du chargement de la page.</span><span class="sxs-lookup"><span data-stu-id="17ac8-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="17ac8-179">Revenez à Visual Studio et développez le dossier **Controllers** , puis ouvrez le fichier **HomeController.cs** .</span><span class="sxs-lookup"><span data-stu-id="17ac8-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="17ac8-180">Vous verrez une action **UserProfile ()** qui contient du code pour récupérer un jeton, puis appeler l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="17ac8-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="17ac8-181">Ce code est dupliqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="17ac8-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="17ac8-182">Pour appeler le API Graph, vous devez d’abord récupérer un jeton.</span><span class="sxs-lookup"><span data-stu-id="17ac8-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="17ac8-183">Lorsque le jeton est récupéré, sa valeur de chaîne doit être ajoutée à l’en-tête d’autorisation pour toutes les demandes suivantes adressées à l’API Graph.</span><span class="sxs-lookup"><span data-stu-id="17ac8-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="17ac8-184">La majeure partie du code ci-dessus gère les détails de l’authentification auprès de Azure AD pour obtenir un jeton, en utilisant le jeton pour effectuer un appel au API Graph, puis en transformant la réponse afin qu’elle puisse être présentée dans la vue.</span><span class="sxs-lookup"><span data-stu-id="17ac8-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="17ac8-185">La partie la plus pertinente pour la discussion est la ligne en surbrillance suivante : `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="17ac8-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="17ac8-186">Cette ligne représente le nom de l’utilisateur, qui a été désérialisé à partir de la réponse JSON et est présenté dans la vue.</span><span class="sxs-lookup"><span data-stu-id="17ac8-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="17ac8-187">Vous pouvez appeler l’API Graph à l’aide de HttpClient et gérer vous-même les données brutes, mais il est plus facile d’utiliser la [bibliothèque cliente Graph qui est disponible via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="17ac8-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="17ac8-188">La bibliothèque cliente gère les requêtes HTTP brutes et la transformation des données renvoyées pour vous, et facilite grandement l’utilisation de l’API Graph dans un environnement .NET.</span><span class="sxs-lookup"><span data-stu-id="17ac8-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="17ac8-189">Consultez les exemples de code API Graph connexes sur [github.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="17ac8-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="17ac8-190">Déploiement de l'application vers Azure</span><span class="sxs-lookup"><span data-stu-id="17ac8-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="17ac8-191">Les étapes suivantes vous montrent comment déployer l’application sur Azure.</span><span class="sxs-lookup"><span data-stu-id="17ac8-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="17ac8-192">Dans les étapes précédentes, vous avez connecté votre nouveau projet à une application Web sur Azure. il est donc prêt à être publié en seulement quelques étapes.</span><span class="sxs-lookup"><span data-stu-id="17ac8-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="17ac8-193">Dans Visual Studio, cliquez avec le bouton droit sur le projet et sélectionnez **publier**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="17ac8-194">La boîte de dialogue **publier le site Web** s’affiche avec chaque paramètre déjà configuré.</span><span class="sxs-lookup"><span data-stu-id="17ac8-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="17ac8-195">Cliquez sur le bouton **suivant** pour accéder à la page **paramètres** .</span><span class="sxs-lookup"><span data-stu-id="17ac8-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="17ac8-196">Vous pouvez être invité à vous authentifier. Veillez à vous authentifier à l’aide de votre compte d’abonnement Azure (généralement un compte Microsoft) et non du compte professionnel que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="17ac8-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="17ac8-197">Cochez l’option **activer l’authentification organisationnelle** .</span><span class="sxs-lookup"><span data-stu-id="17ac8-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="17ac8-198">Dans le champ **domaine** , entrez le domaine de votre répertoire.</span><span class="sxs-lookup"><span data-stu-id="17ac8-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="17ac8-199">Dans la liste déroulante **niveau d’accès** , sélectionnez **authentification unique, lire les données d’annuaire**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="17ac8-200">Vous remarquerez que la base de données précédente que vous avez utilisée est déjà remplie dans la section **bases de données** .</span><span class="sxs-lookup"><span data-stu-id="17ac8-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="17ac8-201">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="17ac8-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="17ac8-202">Visual Studio va commencer le déploiement de votre site Web, puis une nouvelle fenêtre de navigateur s’affiche.</span><span class="sxs-lookup"><span data-stu-id="17ac8-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="17ac8-203">Vous serez peut-être invité à vous authentifier à nouveau dans votre annuaire.</span><span class="sxs-lookup"><span data-stu-id="17ac8-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="17ac8-204">Une fois que vous vous êtes authentifié, vous êtes redirigé vers votre nouveau site Web publié sur Azure.</span><span class="sxs-lookup"><span data-stu-id="17ac8-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="17ac8-205">Débogage de l’application</span><span class="sxs-lookup"><span data-stu-id="17ac8-205">Debugging the app</span></span>

<span data-ttu-id="17ac8-206">Si vous recevez l’erreur suivante : la valeur ne peut pas être null ou vide.</span><span class="sxs-lookup"><span data-stu-id="17ac8-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="17ac8-207">Nom du paramètre : linkText</span><span class="sxs-lookup"><span data-stu-id="17ac8-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)

<span data-ttu-id="17ac8-208">Remplacez le code du fichier *Views\Shared\\_LoginPartial. cshtml* par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="17ac8-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="17ac8-209">Après avoir exécuté l’application, si l’utilisateur connecté affiche « utilisateur null », déconnectez-vous, puis reconnectez-vous avec le compte Active Directory que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="17ac8-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="17ac8-210">L’un des excellents didacticiels à suivre est l’étude approfondie de Rick Rainey [: sites Web Azure et authentification organisationnelle à l’aide de Azure ad](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="17ac8-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="17ac8-211">Plus d'informations</span><span class="sxs-lookup"><span data-stu-id="17ac8-211">More Information</span></span>

- [<span data-ttu-id="17ac8-212">Approfondissement : sites Web Azure et authentification organisationnelle à l’aide de Azure AD</span><span class="sxs-lookup"><span data-stu-id="17ac8-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="17ac8-213">Présentation de la API Graph Azure AD</span><span class="sxs-lookup"><span data-stu-id="17ac8-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="17ac8-214">Scénarios d’authentification dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="17ac8-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="17ac8-215">Exemples de code Azure AD sur GitHub</span><span class="sxs-lookup"><span data-stu-id="17ac8-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
