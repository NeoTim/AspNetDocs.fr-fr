---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Créer un modèle avec des Validations de règles d’entreprise | Microsoft Docs
author: microsoft
description: Étape 3 montre comment créer un modèle que nous pouvons utiliser pour les deux requêtes et mettre à jour de la base de données pour notre application NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 078614c6e7ba18ac09bbd5e23b90b08c97aee658
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59387293"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="dbc7d-103">Créer un modèle avec des validations de règles d’entreprise</span><span class="sxs-lookup"><span data-stu-id="dbc7d-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="dbc7d-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="dbc7d-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="dbc7d-105">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="dbc7d-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="dbc7d-106">Il s’agit d’étape 3 a gratuit [« « l’application NerdDinner](introducing-the-nerddinner-tutorial.md) qui présente en détail comment créer un petit mais terminé, l’application web à l’aide d’ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="dbc7d-107">Étape 3 montre comment créer un modèle que nous pouvons utiliser pour les deux requêtes et mettre à jour de la base de données pour notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="dbc7d-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre le [mise en route avec MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [Store de musique MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) didacticiels.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="dbc7d-109">NerdDinner étape 3 : Génération du modèle</span><span class="sxs-lookup"><span data-stu-id="dbc7d-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="dbc7d-110">Dans une infrastructure model-view-controller, le terme « modèle » fait référence aux objets qui représentent les données de l’application, ainsi que la logique de domaine correspondante qui s’intègre de validation et des règles d’entreprise avec lui.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="dbc7d-111">Le modèle est à bien des égards « cœur » d’une application basée sur MVC et comme nous le verrons plus tard fondamentalement lecteurs le comportement de celle-ci.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="dbc7d-112">L’infrastructure ASP.NET MVC prend en charge à l’aide de toute technologie d’accès aux données et les développeurs peuvent choisir parmi un éventail de riches options de données .NET pour implémenter leurs modèles, y compris : LINQ aux entités, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, ou simplement brutes ADO.NET DataReaders ou jeux de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="dbc7d-113">Pour notre application NerdDinner, nous allons utiliser LINQ to SQL pour créer un modèle simple qui correspond assez près à notre conception de base de données et ajoute des règles d’entreprise et la logique de validation personnalisée.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="dbc7d-114">Nous sera ensuite implémenter une classe de référentiel qui permet d’abstraite de suite l’implémentation de persistance des données du reste de l’application et vous permet de nous unité facilement le tester.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="dbc7d-115">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="dbc7d-115">LINQ to SQL</span></span>

<span data-ttu-id="dbc7d-116">LINQ to SQL est un ORM (mappeur relationnel objet) qui est fourni avec .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="dbc7d-117">LINQ to SQL fournit un moyen simple pour mapper des tables de base de données aux classes .NET que nous pouvons coder.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="dbc7d-118">Pour notre application NerdDinner nous allons l’utiliser pour mapper les tables dîners et RSVP dans notre base de données aux classes Dinner et RSVP.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="dbc7d-119">Les colonnes des tables dîners et RSVP correspond aux propriétés sur les classes Dinner et RSVP.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="dbc7d-120">Chaque objet dîner et RSVP représente une ligne distincte dans les tables dîners ou RSVP dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="dbc7d-121">LINQ to SQL nous permet à éviter d’avoir à construire des instructions SQL pour récupérer et mettre à jour dîner et RSVP manuellement les objets de base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="dbc7d-122">Au lieu de cela, nous allons définir les classes Dinner et RSVP, comment elles sont mappées vers/à partir de la base de données et les relations entre eux.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="dbc7d-123">LINQ to SQL sera, prend soin de génération de la logique d’exécution SQL appropriée à utiliser lors de l’exécution lorsque nous interagir et que vous les utilisez.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="dbc7d-124">Nous pouvons utiliser la prise en charge du langage LINQ dans Visual Basic et c# pour écrire des requêtes expressives qui récupèrent dîner et RSVP objets à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="dbc7d-125">Cela réduit la quantité de code de données nous devons écrire, et nous permet de créer des applications vraiment soignées.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="dbc7d-126">Ajout Classes LINQ to SQL à notre projet</span><span class="sxs-lookup"><span data-stu-id="dbc7d-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="dbc7d-127">Nous allons commencer en cliquant sur le dossier « Models » au sein de notre projet, puis sélectionnez le **Add -&gt;un nouvel élément** commande de menu :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="dbc7d-128">Cela fera apparaître la boîte de dialogue « Ajouter un nouvel élément ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="dbc7d-129">Nous allons filtrer par la catégorie « Données » et sélectionnez le modèle de « Classes de LINQ à SQL » qu’il contient :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="dbc7d-130">Nous allons nommer l’élément « NerdDinner » et cliquez sur le bouton « Ajouter ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="dbc7d-131">Visual Studio ajoute un fichier NerdDinner.dbml sous notre répertoire \Models et puis ouvrez le concepteur LINQ to SQL objet relationnel :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="dbc7d-132">Création Classes de modèle de données avec LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="dbc7d-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="dbc7d-133">LINQ to SQL vous permet de créer rapidement des classes de modèle de données à partir de schéma de base de données existant.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="dbc7d-134">Action cela nous allons ouvrir la base de données de NerdDinner dans l’Explorateur de serveurs, puis sélectionnez les Tables nous souhaitons modéliser qu’il contient :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="dbc7d-135">Ensuite, nous pouvons faire glisser les tables sur LINQ à l’aire du concepteur SQL.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="dbc7d-136">Quand nous faisons ce LINQ to SQL crée automatiquement dîner et classes RSVP en utilisant le schéma des tables (avec des propriétés de la classe qui mappent aux colonnes de table de base de données) :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="dbc7d-137">Par défaut LINQ to SQL designer automatiquement « Pluralise » les noms de table et de colonne lorsqu’il crée des classes basées sur un schéma de base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="dbc7d-138">Par exemple : la table « Dîners » dans notre exemple ci-dessus a entraîné une classe « Dîner ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="dbc7d-139">Cette classe d’affectation de noms permet de rendre nos modèles cohérent avec les conventions d’affectation de noms .NET, et généralement trouver celui dont la correction du concepteur cela des pratique (en particulier lorsque vous ajoutez un grand nombre de tables).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="dbc7d-140">Si vous n’aimez pas le nom d’une classe ou une propriété généré par le concepteur, bien que vous pouvez toujours remplacer et remplacez-le par le nom de que votre choix.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="dbc7d-141">Faire cela en modifiant la propriété d’entité/nom en ligne dans le concepteur ou en la modifiant par le biais de la grille des propriétés.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="dbc7d-142">Par défaut, le concepteur LINQ to SQL également inspecte les relations de clé étrangère/clé primaire des tables et selon automatiquement crée par défaut « associations relation » entre les classes de modèle différent qu'il crée.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="dbc7d-143">Par exemple, lorsque nous avons fait glisser les dîners et RSVP tables sur le concepteur LINQ to SQL, une association de relation un-à-plusieurs entre les deux a été inférée basé sur le fait que la table RSVP avait une clé étrangère à la table dîners (cela est indiqué par la flèche dans le Concepteur) :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="dbc7d-144">L’association ci-dessus entraîne LINQ to SQL pour ajouter une propriété de « Dîner » fortement typée à la classe RSVP que les développeurs peuvent utiliser pour accéder au dîner associé à un protocole RSVP donné.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="dbc7d-145">Cela entraînera également la classe dîner avoir une propriété de collection « RSVPs » qui permet aux développeurs de récupérer et mettre à jour des objets RSVP associés à un dîner particulier.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="dbc7d-146">Vous trouverez ci-dessous un exemple d’intellisense dans Visual Studio lorsque nous créer un nouvel objet RSVP et l’ajouter à la collection de RSVP d’un dîner.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="dbc7d-147">Notez comment LINQ to SQL ajouté automatiquement une collection de « RSVP » sur l’objet Dinner :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="dbc7d-148">En ajoutant l’objet RSVP pour collection de RSVP du dîner, nous demandons à LINQ to SQL pour associer une relation de clé étrangère entre le dîner et la ligne RSVP dans notre base de données :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="dbc7d-149">Si vous n’aimez pas comment le concepteur a modélisé ou nommée d’une association de table, vous pouvez le remplacer.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="dbc7d-150">Cliquez sur la flèche d’association dans le concepteur et accéder à ses propriétés par le biais de la grille des propriétés à renommer, supprimer ou modifier.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="dbc7d-151">Pour notre application NerdDinner, cependant, les règles d’association par défaut fonctionnent bien pour les classes de modèle de données que nous créons et nous pouvons simplement utiliser le comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="dbc7d-152">Classe de NerdDinnerDataContext</span><span class="sxs-lookup"><span data-stu-id="dbc7d-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="dbc7d-153">Visual Studio crée automatiquement les classes .NET qui représentent les modèles et les relations de base de données définies à l’aide du concepteur LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="dbc7d-154">Une classe LINQ to SQL DataContext est également généré pour chaque fichier LINQ to SQL concepteur ajouté à la solution.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="dbc7d-155">Étant donné que nous avons nommé notre LINQ à l’élément de classe SQL « NerdDinner », la classe DataContext créée sera appelée « NerdDinnerDataContext ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="dbc7d-156">Cette classe NerdDinnerDataContext est le principal moyen de que nous interagissent avec la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="dbc7d-157">Notre classe NerdDinnerDataContext expose deux propriétés - « Dîners » et « RSVPs » - qui représentent les deux tables que nous FAÇONNÉES dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="dbc7d-158">Nous pouvons utiliser c# pour écrire des requêtes LINQ sur ces propriétés dans la requête et la récupération d’objets dîner et RSVP à partir de la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="dbc7d-159">Le code suivant montre comment instancier un objet NerdDinnerDataContext et exécuter une requête LINQ pour obtenir une séquence de dîners qui se produisent dans le futur.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="dbc7d-160">Visual Studio fournit des fonctionnalités intellisense complètes lors de l’écriture de la requête LINQ et les objets retournés à partir de celui-ci sont fortement typées et prennent également en charge intellisense :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="dbc7d-161">En plus de ce qui nous permet d’interroger des objets dîner et RSVP, un NerdDinnerDataContext suit également automatiquement les modifications que nous apportez par la suite aux objets dîner et RSVP que nous récupérons par son intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="dbc7d-162">Nous pouvons utiliser cette fonctionnalité pour facilement enregistrer les modifications apportées à la base de données - sans avoir à écrire de code de mise à jour SQL explicite.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="dbc7d-163">Par exemple, le code ci-dessous montre comment utiliser une requête LINQ pour récupérer un seul objet dîner à partir de la base de données, mettre à jour deux des propriétés dîner et puis enregistrez les modifications apportées à la base de données :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="dbc7d-164">L’objet NerdDinnerDataContext dans le code ci-dessus suivies automatiquement les modifications de propriété apportées à l’objet dîner récupérés à partir de celui-ci.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="dbc7d-165">Lorsque nous avons appelé la méthode « SubmitChanges() », il exécutera une instruction « UPDATE » SQL appropriée pour la base de données pour conserver les valeurs de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="dbc7d-166">Création d’une classe DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="dbc7d-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="dbc7d-167">Pour les petites applications, il est parfois bien d’avoir des contrôleurs de travailler directement sur une classe LINQ to SQL DataContext et incorporer des requêtes LINQ dans les contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="dbc7d-168">Les applications deviennent plus volumineuses, cependant, cette approche devient difficile à maintenir et à tester.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="dbc7d-169">Il peut également entraîner nous dupliquer les mêmes requêtes LINQ à plusieurs endroits.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="dbc7d-170">Une des approches qui peuvent rendre les applications plus faciles à maintenir et à tester sont d’utiliser un modèle de « dépôt ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="dbc7d-171">Une classe de dépôt permet d’encapsuler des données interrogation et logique de persistance et élimine les détails d’implémentation de la persistance des données à partir de l’application.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="dbc7d-172">En plus de rendre le code d’application plus propre, à l’aide d’un modèle de référentiel peut faciliter modifier les implémentations de stockage de données à l’avenir, et elle peut aider à faciliter le test unitaire une application sans nécessiter une véritable base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="dbc7d-173">Pour notre application NerdDinner, nous allons définir une classe DinnerRepository avec les dessous de signature :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="dbc7d-174">*Remarque : Plus loin dans ce chapitre nous allons extraire une interface IDinnerRepository à partir de cette classe et activer l’injection de dépendances avec elle sur nos contrôleurs. Pour commencer, cependant, nous allons démarrer simple et simplement fonctionner directement avec la classe DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="dbc7d-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="dbc7d-175">Pour implémenter cette classe nous avec le bouton droit sur le dossier « Models » et choisissez le **Add -&gt;un nouvel élément** commande de menu.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="dbc7d-176">Dans la boîte de dialogue « Ajouter un nouvel élément », nous allons sélectionner le modèle de « Classe » et nommez le fichier « DinnerRepository.cs » :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="dbc7d-177">Nous pouvons ensuite implémenter notre classe DinnerRepository en utilisant le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="dbc7d-178">Récupération, la mise à jour, insertion et suppression à l’aide de la classe DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="dbc7d-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="dbc7d-179">Maintenant que nous avons créé notre classe DinnerRepository, nous allons examiner quelques exemples de code qui illustrent des tâches courantes, que nous pouvons faire avec celui-ci :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="dbc7d-180">Exemples d’interrogation</span><span class="sxs-lookup"><span data-stu-id="dbc7d-180">Querying Examples</span></span>

<span data-ttu-id="dbc7d-181">Le code ci-dessous récupère un dîner unique à l’aide de la valeur DinnerID :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="dbc7d-182">Le code ci-dessous récupère tous les prochains dîners et boucles au-dessus d’eux :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="dbc7d-183">Insertion et des exemples de mise à jour</span><span class="sxs-lookup"><span data-stu-id="dbc7d-183">Insert and Update Examples</span></span>

<span data-ttu-id="dbc7d-184">Le code ci-dessous illustre l’ajout de deux dîners de nouveau.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="dbc7d-185">Ajouts/modifications au référentiel ne sont pas validées dans la base de données jusqu'à ce que la méthode « Save() » est appelée sur lui.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="dbc7d-186">LINQ to SQL encapsule automatiquement toutes les modifications dans une transaction de base de données : soit toutes les modifications se produisent ou aucun d'entre eux ne lors de notre référentiel enregistre :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="dbc7d-187">Le code ci-dessous récupère un objet dîner existant et modifie les deux propriétés sur celle-ci.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="dbc7d-188">Les modifications sont validées dans la base de données lorsque la méthode « Save() » est appelée sur notre référentiel :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="dbc7d-189">Le code ci-dessous récupère un dîner, puis ajoute un protocole RSVP à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="dbc7d-190">Cela à l’aide de la collection des RSVP sur l’objet dîner que LINQ to SQL est créé pour nous (car il existe une relation de clé/étrangère-clé primaire entre les deux dans la base de données).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="dbc7d-191">Cette modification est rendue persistante dans la base de données en tant qu’une nouvelle ligne de table RSVP lorsque la méthode « Save() » est appelée sur le référentiel :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="dbc7d-192">Exemple de suppression</span><span class="sxs-lookup"><span data-stu-id="dbc7d-192">Delete Example</span></span>

<span data-ttu-id="dbc7d-193">Le code suivant récupère un objet dîner existant et le marque à supprimer.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="dbc7d-194">Lorsque la méthode « Save() » est appelée sur le référentiel il valide la suppression à la base de données :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="dbc7d-195">L’intégration de Validation et une logique métier avec les Classes de modèle</span><span class="sxs-lookup"><span data-stu-id="dbc7d-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="dbc7d-196">L’intégration de validation et la règle d’entreprise logique est une partie essentielle de toute application qui fonctionne avec les données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="dbc7d-197">Validation de schéma</span><span class="sxs-lookup"><span data-stu-id="dbc7d-197">Schema Validation</span></span>

<span data-ttu-id="dbc7d-198">Lorsque les classes de modèle sont définis en utilisant le concepteur LINQ to SQL, les types de données des propriétés dans les classes de modèle de données correspondent pour les types de données de la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="dbc7d-199">Par exemple : si la colonne « EventDate » dans la table dîners est une valeur « datetime », la classe de modèle de données créée par LINQ to SQL sera de type « DateTime » (qui est un type de données .NET intégré).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="dbc7d-200">Cela signifie que vous obtenez des erreurs de compilation si vous tentez d’affecter un entier ou une valeur booléenne à celui-ci à partir du code, et il génère une erreur automatiquement si vous essayez de convertir implicitement un type de chaîne non valide à celui-ci lors de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="dbc7d-201">LINQ to SQL gère également automatiquement les valeurs de séquence d’échappement SQL pour vous lors de l’utilisation de chaînes - qui vous aide à vous protéger contre les attaques par injection SQL lors de son utilisation.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="dbc7d-202">Validation et une logique métier</span><span class="sxs-lookup"><span data-stu-id="dbc7d-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="dbc7d-203">Validation de schéma est utile dans un premier temps, mais il est rarement suffisante.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="dbc7d-204">La plupart des scénarios réels requièrent la capacité de spécifier la logique de validation plus riches qui permettre s’étendre sur plusieurs propriétés, d’exécuter du code et ont souvent une connaissance d’un état de modèle (par exemple : est il créé/mis à jour/supprimées, ou dans un état spécifique à un domaine par exemple « archivés »).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="dbc7d-205">Il existe une variété de différents modèles et des infrastructures qui peuvent être utilisées pour définir et appliquer des règles de validation aux classes de modèle, et il existe plusieurs .NET en infrastructures quasi-certitude qui peut être utilisé pour aider à ce sujet.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="dbc7d-206">Vous pouvez utiliser à peu près un d’eux dans les applications ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="dbc7d-207">Dans le cadre de notre application NerdDinner, nous allons utiliser un modèle relativement simple et directe où nous exposer une propriété IsValid et une méthode GetRuleViolations() sur notre objet de modèle dîner.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="dbc7d-208">La propriété IsValid renvoie true ou false selon que les validation et les règles métier sont tous valides.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="dbc7d-209">La méthode GetRuleViolations() retourne une liste de toutes les erreurs règle.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="dbc7d-210">Nous allons implémenter IsValid et GetRuleViolations() pour notre modèle dîner en ajoutant une « classe partielle » à notre projet.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="dbc7d-211">Classes partielles peuvent être utilisées pour ajouter des méthodes/propriétés/événements aux classes gérées par un concepteur de Visual Studio (par exemple, la classe dîner généré par le concepteur LINQ to SQL) et d’éviter l’outil à partir de se compliquer la vie avec notre code.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="dbc7d-212">Nous pouvons ajouter une nouvelle classe partielle à notre projet en cliquant sur le dossier \Models, puis sélectionnez la commande de menu « Ajouter un nouvel élément ».</span><span class="sxs-lookup"><span data-stu-id="dbc7d-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="dbc7d-213">Nous pouvons ensuite choisir le modèle « Classe » dans la boîte de dialogue « Ajouter un nouvel élément » et nommez-le Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="dbc7d-214">En cliquant sur le bouton « Ajouter » pour ajouter un fichier Dinner.cs à notre projet et ouvrez-le dans l’IDE.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="dbc7d-215">Nous pouvons ensuite implémenter un framework de mise en œuvre de base/validation de la règle à l’aide du code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="dbc7d-216">Quelques remarques concernant le code ci-dessus :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-216">A few notes about the above code:</span></span>

- <span data-ttu-id="dbc7d-217">La classe dîner est précédée d’un mot clé « partiels » – ce qui signifie que le code qu’il contient est combiné avec la classe générée/conservés par le concepteur LINQ to SQL et compilé dans une classe unique.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="dbc7d-218">La classe RuleViolation est une classe d’assistance que nous allons ajouter au projet qui nous permet de fournir plus de détails sur une violation de règle.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="dbc7d-219">La méthode Dinner.GetRuleViolations() provoque nos règles de validation et d’entreprise doit être évaluée (nous allons les implémenter sous peu).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="dbc7d-220">Il renvoie ensuite une séquence d’objets RuleViolation qui fournissent plus de détails sur les erreurs de règle.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="dbc7d-221">La propriété Dinner.IsValid fournit une propriété d’assistance pratiques qui indique si l’objet dîner a tout RuleViolations actives.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="dbc7d-222">Il peut être vérifié de façon proactive par un développeur à l’aide de l’objet dîner à tout moment (et ne lève pas d’exception).</span><span class="sxs-lookup"><span data-stu-id="dbc7d-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="dbc7d-223">La méthode partielle Dinner.OnValidate() est un raccordement par LINQ to SQL qui nous permet d’être averti chaque fois que l’objet dîner est sur le point d’être rendues persistantes dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="dbc7d-224">Notre implémentation OnValidate() ci-dessus garantit que le dîner n’a aucune RuleViolations avant d’être enregistré.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="dbc7d-225">S’il est dans un état non valide, il déclenche une exception, ce qui provoque LINQ to SQL pour abandonner la transaction.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="dbc7d-226">Cette approche fournit une infrastructure simple qui nous pouvons intégrer validation et des règles d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="dbc7d-227">Pour l’instant, nous allons ajouter les règles à notre méthode GetRuleViolations() ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="dbc7d-228">Nous utilisons la fonctionnalité « yield return » de c# pour retourner une séquence de n’importe quel RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="dbc7d-229">La six règle vérifie d’abord ci-dessus applique simplement que les propriétés de chaîne sur notre dîner ne peut pas être null ou vide.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="dbc7d-230">La dernière règle est un peu plus intéressante et appelle une méthode d’assistance de PhoneValidator.IsValidNumber() que nous l’ajoutions à notre projet pour vérifier que le ContactPhone numéro pays de format correspondances le dîner.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="dbc7d-231">Nous pouvons utiliser. Prise en charge des expressions régulières du NET pour implémenter cette prise en charge de validation de téléphone.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="dbc7d-232">Voici une implémentation simple PhoneValidator que nous pouvons ajouter à notre projet qui permet d’ajouter des contrôles de modèle Regex spécifiques à un pays :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="dbc7d-233">Gestion des Violations de logique métier et de Validation</span><span class="sxs-lookup"><span data-stu-id="dbc7d-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="dbc7d-234">Maintenant que nous avons ajouté le code de règle de validation et entreprise ci-dessus, à tout moment que nous essayons de créer ou mettre à jour d’un dîner, nos règles de logique de validation seront évaluées et appliquées.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="dbc7d-235">Les développeurs peuvent écrire de code semblable au suivant pour déterminer de manière proactive si un objet dîner est valide et récupérer une liste de toutes les violations qu’elle contient sans déclencher des exceptions :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="dbc7d-236">Si vous essayez d’enregistrer un dîner dans un état non valide, une exception sera levée lorsque nous appelons la méthode Save() sur le DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="dbc7d-237">Cela se produit, car LINQ to SQL appelle automatiquement notre méthode partielle Dinner.OnValidate() avant elle enregistre les modifications du dîner, et nous avons ajouté le code à Dinner.OnValidate() pour lever une exception si les violations de règle existent dans le dîner.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="dbc7d-238">Nous pouvons intercepter cette exception et récupère une liste des violations de résoudre de manière réactive :</span><span class="sxs-lookup"><span data-stu-id="dbc7d-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="dbc7d-239">Étant donné que notre validation et les règles métier sont implémentées au sein de la couche de notre modèle et non pas dans la couche d’interface utilisateur, ils seront appliqués et utilisés pour tous les scénarios au sein de notre application.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="dbc7d-240">Nous pouvons ultérieurement modifier ou ajouter des règles d’entreprise et avoir tout le code que fonctionne avec nos objets dîner les respecte pas.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="dbc7d-241">Avoir la possibilité de modifier les règles d’entreprise au même endroit, sans avoir à ces modifications ripple tout au long de l’application et la logique d’interface utilisateur, est un signe d’une application bien écrite et un avantage une infrastructure MVC à encourager.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="dbc7d-242">Étape suivante</span><span class="sxs-lookup"><span data-stu-id="dbc7d-242">Next Step</span></span>

<span data-ttu-id="dbc7d-243">Nous avons maintenant un modèle que nous pouvons utiliser pour interroger et de mettre à jour de notre base de données.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="dbc7d-244">Nous allons maintenant ajouter des contrôleurs et des vues au projet que nous pouvons utiliser pour créer une expérience de l’interface utilisateur HTML autour d’elle.</span><span class="sxs-lookup"><span data-stu-id="dbc7d-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dbc7d-245">[Précédent](create-a-database.md)
> [Suivant](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="dbc7d-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
