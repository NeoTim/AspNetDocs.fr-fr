---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Activez les tests d’unités automatisés . Microsoft Docs
author: rick-anderson
description: L’étape 12 montre comment développer une suite de tests unitaires automatisés qui vérifient notre fonctionnalité NerdDinner, et qui nous donnera la confiance nécessaire pour apporter des changements...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: 7fe84efd9e4cc359c19d5ab9e22c579b80207e9c
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541466"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="626e3-103">Activer les tests unitaires automatisés</span><span class="sxs-lookup"><span data-stu-id="626e3-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="626e3-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="626e3-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="626e3-105">Télécharger le PDF</span><span class="sxs-lookup"><span data-stu-id="626e3-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="626e3-106">Il s’agit de l’étape 12 d’un tutoriel gratuit ["NerdDinner" application](introducing-the-nerddinner-tutorial.md) qui marche à travers la façon de construire une petite, mais complète, application web en utilisant ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="626e3-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="626e3-107">L’étape 12 montre comment développer une suite de tests unitaires automatisés qui vérifient notre fonctionnalité NerdDinner, et qui nous donnera la confiance nécessaire pour apporter des modifications et des améliorations à l’application à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="626e3-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="626e3-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre les tutoriels [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="626e3-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="626e3-109">NerdDinner Étape 12: Test unitaire</span><span class="sxs-lookup"><span data-stu-id="626e3-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="626e3-110">Développons une suite de tests unitaires automatisés qui vérifient notre fonctionnalité NerdDinner, et qui nous donnera la confiance nécessaire pour apporter des modifications et des améliorations à l’application à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="626e3-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="626e3-111">Pourquoi l’essai unitaire?</span><span class="sxs-lookup"><span data-stu-id="626e3-111">Why Unit Test?</span></span>

<span data-ttu-id="626e3-112">Sur le lecteur dans le travail un matin, vous avez un éclair soudain d’inspiration sur une application que vous travaillez sur.</span><span class="sxs-lookup"><span data-stu-id="626e3-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="626e3-113">Vous vous rendez compte qu’il y a un changement que vous pouvez mettre en œuvre qui rendra l’application considérablement meilleure.</span><span class="sxs-lookup"><span data-stu-id="626e3-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="626e3-114">Il peut s’agir d’une refonte qui nettoie le code, ajoute une nouvelle fonctionnalité ou corrige un bogue.</span><span class="sxs-lookup"><span data-stu-id="626e3-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="626e3-115">La question qui vous confronte lorsque vous arrivez à votre ordinateur est - "comment est-il sûr de faire cette amélioration?"</span><span class="sxs-lookup"><span data-stu-id="626e3-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="626e3-116">Que se passe-t-il si l’apport du changement a des effets secondaires ou casse quelque chose?</span><span class="sxs-lookup"><span data-stu-id="626e3-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="626e3-117">Le changement peut être simple et ne prendre que quelques minutes à implémenter, mais que faire si elle prend des heures pour tester manuellement tous les scénarios d’application?</span><span class="sxs-lookup"><span data-stu-id="626e3-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="626e3-118">Que faire si vous oubliez de couvrir un scénario et une application cassée entre en production?</span><span class="sxs-lookup"><span data-stu-id="626e3-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="626e3-119">Cette amélioration vaut-elle vraiment tout l’effort?</span><span class="sxs-lookup"><span data-stu-id="626e3-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="626e3-120">Les tests unitaires automatisés peuvent fournir un filet de sécurité qui vous permet d’améliorer continuellement vos applications et d’éviter d’avoir peur du code sur lequel vous travaillez.</span><span class="sxs-lookup"><span data-stu-id="626e3-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="626e3-121">Avoir des tests automatisés qui vérifient rapidement la fonctionnalité vous permet de coder en toute confiance et vous donner les moyens d’apporter des améliorations que vous n’auriez peut-être pas ressenties à l’aise de faire.</span><span class="sxs-lookup"><span data-stu-id="626e3-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="626e3-122">Ils aident également à créer des solutions plus maintenables et qui ont une durée de vie plus longue - ce qui conduit à un retour sur investissement beaucoup plus élevé.</span><span class="sxs-lookup"><span data-stu-id="626e3-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="626e3-123">Le cadre ASP.NET MVC facilite et naturel l’unité des fonctionnalités d’application de test.</span><span class="sxs-lookup"><span data-stu-id="626e3-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="626e3-124">Il permet également un flux de travail de développement piloté par test (TDD) qui permet le développement basé sur le test d’abord.</span><span class="sxs-lookup"><span data-stu-id="626e3-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="626e3-125">Projet NerdDinner.Tests</span><span class="sxs-lookup"><span data-stu-id="626e3-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="626e3-126">Lorsque nous avons créé notre application NerdDinner au début de ce tutoriel, nous avons été invités par un dialogue demandant si nous voulions créer un projet de test unitaire pour aller de pair avec le projet d’application:</span><span class="sxs-lookup"><span data-stu-id="626e3-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="626e3-127">Nous avons gardé le bouton radio « Oui, créer un projet de test unitaire » sélectionné, ce qui a permis d’ajouter un projet « NerdDinner.Tests » à notre solution :</span><span class="sxs-lookup"><span data-stu-id="626e3-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="626e3-128">Le projet NerdDinner.Tests fait référence à l’assemblage du projet d’application NerdDinner et nous permet d’y ajouter facilement des tests automatisés qui vérifient la fonctionnalité de l’application.</span><span class="sxs-lookup"><span data-stu-id="626e3-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="626e3-129">Création de tests unitaires pour notre classe de modèle de dîner</span><span class="sxs-lookup"><span data-stu-id="626e3-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="626e3-130">Ajoutons quelques tests à notre projet NerdDinner.Tests qui vérifient la classe de dîner que nous avons créée lorsque nous avons construit notre couche de modèle.</span><span class="sxs-lookup"><span data-stu-id="626e3-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="626e3-131">Nous allons commencer par créer un nouveau dossier dans notre projet de test appelé "Modèles" où nous allons placer nos tests liés au modèle.</span><span class="sxs-lookup"><span data-stu-id="626e3-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="626e3-132">Nous allons ensuite cliquer à droite sur le dossier et choisir la commande de menu **Add-&gt;New Test.**</span><span class="sxs-lookup"><span data-stu-id="626e3-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="626e3-133">Cela fera ressortir le dialogue "Ajouter un nouveau test".</span><span class="sxs-lookup"><span data-stu-id="626e3-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="626e3-134">Nous choisirons de créer un « test unitaire » et de l’appeler « DinnerTest.cs » :</span><span class="sxs-lookup"><span data-stu-id="626e3-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="626e3-135">Lorsque nous clions sur le bouton "ok" Visual Studio ajouter (et ouvrir) un fichier DinnerTest.cs au projet:</span><span class="sxs-lookup"><span data-stu-id="626e3-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="626e3-136">Le modèle de test d’unité Visual Studio par défaut a un tas de code de plaque de chaudière en elle que je trouve un peu désordonné.</span><span class="sxs-lookup"><span data-stu-id="626e3-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="626e3-137">Nettoyons-le pour simplement contenir le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="626e3-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="626e3-138">L’attribut [TestClass] de la classe DinnerTest ci-dessus l’identifie comme une classe qui contiendra des tests, ainsi que l’initialisation et le code de démontage optionnels.</span><span class="sxs-lookup"><span data-stu-id="626e3-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="626e3-139">Nous pouvons définir les tests en son sein en y ajoutant des méthodes publiques qui ont un attribut [TestMethod] sur eux.</span><span class="sxs-lookup"><span data-stu-id="626e3-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="626e3-140">Voici le premier de deux tests, nous allons ajouter cet exercice de notre classe de dîner.</span><span class="sxs-lookup"><span data-stu-id="626e3-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="626e3-141">Le premier test vérifie que notre dîner est invalide si un nouveau dîner est créé sans que toutes les propriétés soient définies correctement.</span><span class="sxs-lookup"><span data-stu-id="626e3-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="626e3-142">Le deuxième test vérifie que notre dîner est valide lorsqu’un dîner a toutes les propriétés définies avec des valeurs valides:</span><span class="sxs-lookup"><span data-stu-id="626e3-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="626e3-143">Vous remarquerez ci-dessus que nos noms de test sont très explicites (et un peu verbeux).</span><span class="sxs-lookup"><span data-stu-id="626e3-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="626e3-144">Nous le faisons parce que nous pourrions finir par créer des centaines ou des milliers de petits tests, et nous voulons qu’il soit facile de déterminer rapidement l’intention et le comportement de chacun d’eux (surtout lorsque nous regardons à travers une liste d’échecs dans un coureur d’essai).</span><span class="sxs-lookup"><span data-stu-id="626e3-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="626e3-145">Les noms de test doivent être nommés d’après la fonctionnalité qu’ils testent.</span><span class="sxs-lookup"><span data-stu-id="626e3-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="626e3-146">Ci-dessus, nous utilisons\_\_un "Nom should Verb" modèle de nommage.</span><span class="sxs-lookup"><span data-stu-id="626e3-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="626e3-147">Nous structurons les tests à l’aide du modèle de test « AAA » qui signifie « Organiser, agir, affirmer » :</span><span class="sxs-lookup"><span data-stu-id="626e3-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="626e3-148">Arrangement : Configurer l’unité testée</span><span class="sxs-lookup"><span data-stu-id="626e3-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="626e3-149">Loi : Exercez l’unité à l’essai et capturez les résultats</span><span class="sxs-lookup"><span data-stu-id="626e3-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="626e3-150">Assert: Vérifier le comportement</span><span class="sxs-lookup"><span data-stu-id="626e3-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="626e3-151">Lorsque nous écrivons des tests, nous voulons éviter que les tests individuels en fassent trop.</span><span class="sxs-lookup"><span data-stu-id="626e3-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="626e3-152">Au lieu de cela, chaque test ne devrait vérifier qu’un seul concept (ce qui facilitera l’identification de la cause des défaillances).</span><span class="sxs-lookup"><span data-stu-id="626e3-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="626e3-153">Une bonne ligne directrice est d’essayer d’avoir seulement une seule déclaration d’affirmation pour chaque test.</span><span class="sxs-lookup"><span data-stu-id="626e3-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="626e3-154">Si vous avez plus d’une déclaration d’affirmation dans une méthode de test, assurez-vous qu’ils sont tous utilisés pour tester le même concept.</span><span class="sxs-lookup"><span data-stu-id="626e3-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="626e3-155">En cas de doute, faites un autre test.</span><span class="sxs-lookup"><span data-stu-id="626e3-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="626e3-156">Exécution des tests</span><span class="sxs-lookup"><span data-stu-id="626e3-156">Running Tests</span></span>

<span data-ttu-id="626e3-157">Visual Studio 2008 Professional (et éditions supérieures) comprend un coureur d’essai intégré qui peut être utilisé pour exécuter des projets de test d’unité de studio visuel au sein de l’IDE.</span><span class="sxs-lookup"><span data-stu-id="626e3-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="626e3-158">Nous pouvons sélectionner les **tests Test-&gt;Run-&gt;All Tests dans** la commande du menu Solution (ou le type Ctrl R, A) pour exécuter tous nos tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="626e3-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="626e3-159">Ou bien, nous pouvons positionner notre curseur dans une classe de test ou une méthode de test spécifique et utiliser la commande de menu **Test-&gt;Run-&gt;In Current Context** (ou type Ctrl R, T) pour exécuter un sous-ensemble des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="626e3-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="626e3-160">Positionnez notre curseur dans la classe DinnerTest et tapez "Ctrl R, T" pour exécuter les deux tests que nous venons de définir.</span><span class="sxs-lookup"><span data-stu-id="626e3-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="626e3-161">Lorsque nous faisons cela, une fenêtre "Test Results" apparaîtra dans Visual Studio et nous verrons les résultats de notre exécution de test énumérés en elle:</span><span class="sxs-lookup"><span data-stu-id="626e3-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="626e3-162">*Remarque : La fenêtre de résultats des tests VS n’affiche pas la colonne Nom de classe par défaut. Vous pouvez l’ajouter en cliquant à droite dans la fenêtre des résultats de test et en utilisant la commande de menu Add/Remove Columns.*</span><span class="sxs-lookup"><span data-stu-id="626e3-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="626e3-163">Nos deux tests n’ont pris qu’une fraction de seconde à exécuter - et comme vous pouvez le voir, ils ont tous deux passé.</span><span class="sxs-lookup"><span data-stu-id="626e3-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="626e3-164">Nous pouvons maintenant continuer et les augmenter en créant des tests supplémentaires qui vérifient des validations de règles spécifiques, ainsi que couvrir les deux méthodes d’aide - IsUserHost() et IsUserRegistered() - que nous avons ajouté à la classe Dîner.</span><span class="sxs-lookup"><span data-stu-id="626e3-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="626e3-165">Le fait d’avoir tous ces tests en place pour la classe Dîner rendra beaucoup plus facile et plus sûr d’y ajouter de nouvelles règles et validations d’affaires à l’avenir.</span><span class="sxs-lookup"><span data-stu-id="626e3-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="626e3-166">Nous pouvons ajouter notre nouvelle logique de règle à Dîner, puis en quelques secondes vérifier qu’il n’a pas cassé l’une de nos fonctionnalités logiques précédentes.</span><span class="sxs-lookup"><span data-stu-id="626e3-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="626e3-167">Remarquez comment l’utilisation d’un nom de test descriptif permet de comprendre facilement ce que chaque test vérifie.</span><span class="sxs-lookup"><span data-stu-id="626e3-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="626e3-168">Je recommande d’utiliser la commande de menu&gt; **Tools-&gt;Options,** d’ouvrir l’écran de configuration d’exécution de test d’outils de test et de vérifier le « Double-clicking a failed or unconclusive unit test result displays the point of failure in the test » case.</span><span class="sxs-lookup"><span data-stu-id="626e3-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="626e3-169">Cela vous permettra de cliquer deux fois sur un échec dans la fenêtre des résultats des tests et de sauter immédiatement à l’échec d’affirmation.</span><span class="sxs-lookup"><span data-stu-id="626e3-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="626e3-170">Création de tests d’unité DinnersController</span><span class="sxs-lookup"><span data-stu-id="626e3-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="626e3-171">Créons maintenant des tests unitaires qui vérifient notre fonctionnalité DinnersController.</span><span class="sxs-lookup"><span data-stu-id="626e3-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="626e3-172">Nous commencerons par cliquer à droite sur le dossier "Controllers" dans notre projet Test, puis choisirons la commande de menu **Add-&gt;New Test.**</span><span class="sxs-lookup"><span data-stu-id="626e3-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="626e3-173">Nous allons créer un "Test Unitaire" et le nommer "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="626e3-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="626e3-174">Nous allons créer deux méthodes de test qui vérifient la méthode d’action Détails() sur le DinnersController.</span><span class="sxs-lookup"><span data-stu-id="626e3-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="626e3-175">Le premier vérifiera qu’une vue est retournée lorsqu’un dîner existant est demandé.</span><span class="sxs-lookup"><span data-stu-id="626e3-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="626e3-176">Le second vérifiera qu’une vue « Nonfound » est retournée lorsqu’un dîner inexistant est demandé :</span><span class="sxs-lookup"><span data-stu-id="626e3-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="626e3-177">Le code ci-dessus compile propre.</span><span class="sxs-lookup"><span data-stu-id="626e3-177">The above code compiles clean.</span></span> <span data-ttu-id="626e3-178">Lorsque nous passons les tests, cependant, ils échouent tous les deux:</span><span class="sxs-lookup"><span data-stu-id="626e3-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="626e3-179">Si nous regardons les messages d’erreur, nous verrons que la raison pour laquelle les tests ont échoué était parce que notre classe DinnersRepository n’a pas été en mesure de se connecter à une base de données.</span><span class="sxs-lookup"><span data-stu-id="626e3-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="626e3-180">Notre application NerdDinner utilise une chaîne de connexion à un fichier local\_SQL Server Express qui vit sous l’annuaire «App Data» du projet d’application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="626e3-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="626e3-181">Parce que notre projet NerdDinner.Tests compile et fonctionne dans un répertoire différent puis le projet d’application, l’emplacement relatif du chemin de notre chaîne de connexion est incorrect.</span><span class="sxs-lookup"><span data-stu-id="626e3-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="626e3-182">Nous *pourrions* corriger cela en copiant le fichier de base de données SQL Express à notre projet de test, puis y ajouter une chaîne de connexion de test appropriée dans l’App.config de notre projet d’essai.</span><span class="sxs-lookup"><span data-stu-id="626e3-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="626e3-183">Cela permettrait d’obtenir les tests ci-dessus débloqué et en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="626e3-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="626e3-184">Le code de test unitaire à l’aide d’une véritable base de données, cependant, apporte avec lui un certain nombre de défis.</span><span class="sxs-lookup"><span data-stu-id="626e3-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="626e3-185">Plus précisément :</span><span class="sxs-lookup"><span data-stu-id="626e3-185">Specifically:</span></span>

- <span data-ttu-id="626e3-186">Il ralentit considérablement le temps d’exécution des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="626e3-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="626e3-187">Plus il faut de temps pour exécuter des tests, moins vous êtes susceptible de les exécuter fréquemment.</span><span class="sxs-lookup"><span data-stu-id="626e3-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="626e3-188">Idéalement, vous voulez que vos tests unitaires soient en mesure d’être exécutés en quelques secondes - et que ce soit quelque chose que vous faites aussi naturellement que la compilation du projet.</span><span class="sxs-lookup"><span data-stu-id="626e3-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="626e3-189">Il complique la logique de configuration et de nettoyage dans les tests.</span><span class="sxs-lookup"><span data-stu-id="626e3-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="626e3-190">Vous voulez que chaque test unitaire soit isolé et indépendant des autres (sans effets secondaires ni dépendances).</span><span class="sxs-lookup"><span data-stu-id="626e3-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="626e3-191">Lorsque vous travaillez contre une véritable base de données, vous devez être conscient de l’état et la réinitialiser entre les tests.</span><span class="sxs-lookup"><span data-stu-id="626e3-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="626e3-192">Examinons un modèle de conception appelé «injection de dépendance» qui peut nous aider à contourner ces questions et éviter la nécessité d’utiliser une véritable base de données avec nos tests.</span><span class="sxs-lookup"><span data-stu-id="626e3-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="626e3-193">Injection de dépendances</span><span class="sxs-lookup"><span data-stu-id="626e3-193">Dependency Injection</span></span>

<span data-ttu-id="626e3-194">En ce moment DinnersController est étroitement "couplé" à la classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="626e3-195">Le « couplage » désigne une situation où une classe s’appuie explicitement sur une autre classe pour travailler :</span><span class="sxs-lookup"><span data-stu-id="626e3-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="626e3-196">Parce que la classe DinnerRepository nécessite l’accès à une base de données, la dépendance étroitement couplée de la classe DinnersController a sur le DinnerRepository finit par nous obliger à avoir une base de données afin que les méthodes d’action DinnersController à tester.</span><span class="sxs-lookup"><span data-stu-id="626e3-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="626e3-197">Nous pouvons contourner cela en utilisant un modèle de conception appelé « injection de dépendance » - qui est une approche où les dépendances (comme les classes de dépôt qui fournissent l’accès aux données) ne sont plus implicitement créées dans les classes qui les utilisent.</span><span class="sxs-lookup"><span data-stu-id="626e3-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="626e3-198">Au lieu de cela, les dépendances peuvent être explicitement transmises à la classe qui les utilise à l’aide d’arguments constructeurs.</span><span class="sxs-lookup"><span data-stu-id="626e3-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="626e3-199">Si les dépendances sont définies à l’aide d’interfaces, nous avons alors la flexibilité de passer dans les implémentations de dépendance "faux" pour les scénarios de test unitaire.</span><span class="sxs-lookup"><span data-stu-id="626e3-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="626e3-200">Cela nous permet de créer des implémentations de dépendance spécifiques aux tests qui ne nécessitent pas réellement l’accès à une base de données.</span><span class="sxs-lookup"><span data-stu-id="626e3-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="626e3-201">Pour voir cela en action, mettons en œuvre l’injection de dépendance avec nos DînersController.</span><span class="sxs-lookup"><span data-stu-id="626e3-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="626e3-202">Extraction d’une interface IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="626e3-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="626e3-203">Notre première étape sera de créer une nouvelle interface IDinnerRepository qui résume le contrat de dépôt dont nos contrôleurs ont besoin pour récupérer et mettre à jour les dîners.</span><span class="sxs-lookup"><span data-stu-id="626e3-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="626e3-204">Nous pouvons définir ce contrat d’interface manuellement en cliquant à droite sur le dossier «Modèles», puis en choisissant la commande de menu **Add-&gt;New Item** et en créant une nouvelle interface nommée IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="626e3-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="626e3-205">Alternativement, nous pouvons utiliser les outils de refactorisation intégrés dans Visual Studio Professional (et des éditions supérieures) pour extraire et créer une interface pour nous à partir de notre classe existante DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="626e3-206">Pour extraire cette interface à l’aide de VS, il suffit de placer le curseur dans l’éditeur de texte sur la classe DinnerRepository, puis cliquez à droite et choisissez la commande **refactor-&gt;Extract Interface** menu:</span><span class="sxs-lookup"><span data-stu-id="626e3-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="626e3-207">Cela lancera le dialogue "Extract Interface" et nous incitera à créer le nom de l’interface.</span><span class="sxs-lookup"><span data-stu-id="626e3-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="626e3-208">Il sera par défaut à IDinnerRepository et sélectionnera automatiquement toutes les méthodes publiques sur la classe existante DinnerRepository à ajouter à l’interface:</span><span class="sxs-lookup"><span data-stu-id="626e3-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="626e3-209">Lorsque nous cliquez sur le bouton "ok", Visual Studio ajoutera une nouvelle interface IDinnerRepository à notre application :</span><span class="sxs-lookup"><span data-stu-id="626e3-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="626e3-210">Et notre classe DînerRepository existante sera mise à jour afin qu’il implémente l’interface:</span><span class="sxs-lookup"><span data-stu-id="626e3-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="626e3-211">Mise à jour DinnersController pour soutenir l’injection de constructeurs</span><span class="sxs-lookup"><span data-stu-id="626e3-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="626e3-212">Nous allons maintenant mettre à jour la classe DinnersController pour utiliser la nouvelle interface.</span><span class="sxs-lookup"><span data-stu-id="626e3-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="626e3-213">Actuellement DinnersController est hard-coded tel que son "dînerRepository" champ est toujours un cours DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="626e3-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="626e3-214">Nous allons le changer de sorte que le champ "dînerRepository" est de type IDinnerRepository au lieu de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="626e3-215">Nous ajouterons ensuite deux constructeurs publics DinnersController.</span><span class="sxs-lookup"><span data-stu-id="626e3-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="626e3-216">L’un des constructeurs permet de passer un IDinnerRepository comme argument.</span><span class="sxs-lookup"><span data-stu-id="626e3-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="626e3-217">L’autre est un constructeur par défaut qui utilise notre implémentation existante DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="626e3-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="626e3-218">Étant donné que ASP.NET MVC crée par défaut des classes de contrôleurs à l’aide de constructeurs par défaut, notre DinnersController à l’heure d’exécution continuera d’utiliser la classe DinnerRepository pour effectuer l’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="626e3-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="626e3-219">Nous pouvons maintenant mettre à jour nos tests unitaires, cependant, pour passer dans un "faux" rédilitaire de dîner mise en œuvre en utilisant le constructeur de paramètres.</span><span class="sxs-lookup"><span data-stu-id="626e3-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="626e3-220">Ce « faux » dépôt de dîner n’aura pas besoin d’accéder à une véritable base de données, et utilisera plutôt des données d’échantillons en mémoire.</span><span class="sxs-lookup"><span data-stu-id="626e3-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="626e3-221">Création de la classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="626e3-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="626e3-222">Créons un cours FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="626e3-223">Nous allons commencer par créer un répertoire "Fakes" dans notre projet NerdDinner.Tests, puis ajouter une nouvelle classe FakeDinnerRepository à elle (clic droit sur le dossier et choisir **Add-&gt;Nouvelle Classe):**</span><span class="sxs-lookup"><span data-stu-id="626e3-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="626e3-224">Nous mettrons à jour le code afin que la classe FakeDinnerRepository implémente l’interface IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="626e3-225">Nous pouvons alors cliquer à droite sur elle et choisir la commande de menu de contexte "Implement interface IDinnerRepository" :</span><span class="sxs-lookup"><span data-stu-id="626e3-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="626e3-226">Cela amènera Visual Studio à ajouter automatiquement tous les membres de l’interface IDinnerRepository à notre classe FakeDinnerRepository avec par défaut "stub out" implémentations:</span><span class="sxs-lookup"><span data-stu-id="626e3-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="626e3-227">Nous pouvons ensuite mettre à jour la mise en œuvre&lt;&gt; FakeDinnerRepository pour travailler hors d’une collection de dîner liste en mémoire passé à elle comme un argument constructeur:</span><span class="sxs-lookup"><span data-stu-id="626e3-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="626e3-228">Nous avons maintenant une fausse implémentation IDinnerRepository qui ne nécessite pas une base de données, et peut plutôt travailler sur une liste de mémoire des objets Dinner.</span><span class="sxs-lookup"><span data-stu-id="626e3-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="626e3-229">Utilisation du FakeDinnerRepository avec des tests unitaires</span><span class="sxs-lookup"><span data-stu-id="626e3-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="626e3-230">Revenons aux tests de l’unité DinnersController qui ont échoué plus tôt parce que la base de données n’était pas disponible.</span><span class="sxs-lookup"><span data-stu-id="626e3-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="626e3-231">Nous pouvons mettre à jour les méthodes de test pour utiliser un FakeDinnerRepository peuplé de données de dîner en mémoire de l’échantillon De DinnersController en utilisant le code ci-dessous:</span><span class="sxs-lookup"><span data-stu-id="626e3-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="626e3-232">Et maintenant, quand nous passons ces tests, ils réussissent tous les deux:</span><span class="sxs-lookup"><span data-stu-id="626e3-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="626e3-233">Le meilleur de tous, ils ne prennent qu’une fraction de seconde pour courir, et ne nécessitent aucune configuration compliquée / logique de nettoyage.</span><span class="sxs-lookup"><span data-stu-id="626e3-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="626e3-234">Nous pouvons maintenant unir le test de tous nos codes de méthode d’action DinnersController (y compris la liste, le pagination, les détails, créer, mettre à jour et supprimer) sans jamais avoir besoin de se connecter à une véritable base de données.</span><span class="sxs-lookup"><span data-stu-id="626e3-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="626e3-235">**Sujet secondaire : Cadres d’injection de dépendance**</span><span class="sxs-lookup"><span data-stu-id="626e3-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="626e3-236">Effectuer l’injection de dépendance manuelle (comme nous sommes ci-dessus) fonctionne très bien, mais devient plus difficile à maintenir que le nombre de dépendances et de composants dans une application augmente.</span><span class="sxs-lookup"><span data-stu-id="626e3-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="626e3-237">Plusieurs cadres d’injection de dépendance existent pour .NET qui peut aider à fournir encore plus de flexibilité de gestion de la dépendance.</span><span class="sxs-lookup"><span data-stu-id="626e3-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="626e3-238">Ces cadres, aussi parfois appelés contenants « Inversion de contrôle » (IoC), fournissent des mécanismes qui permettent un niveau supplémentaire de prise en charge de configuration pour spécifier et transmettre des dépendances aux objets en cours d’exécution (le plus souvent à l’aide d’injection de constructeurs).</span><span class="sxs-lookup"><span data-stu-id="626e3-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="626e3-239">Parmi les cadres les plus populaires de l’OSS Dependency Injection / IOC dans .NET, mentionnons : AutoFac, Ninject, Spring.NET, StructureMap et Windsor.</span><span class="sxs-lookup"><span data-stu-id="626e3-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="626e3-240">ASP.NET MVC expose les API d’extétabilité qui permettent aux développeurs de participer à la résolution et à l’instantanéisation des contrôleurs, et qui permettent d’intégrer proprement les cadres d’injection de dépendance / IoC dans ce processus.</span><span class="sxs-lookup"><span data-stu-id="626e3-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="626e3-241">L’utilisation d’un cadre DI/CIO nous permettrait également de supprimer le constructeur par défaut de notre DinnersController, ce qui supprimerait complètement le couplage entre lui et le DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="626e3-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="626e3-242">Nous n’utiliserons pas d’injection de dépendance / cadre IOC avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="626e3-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="626e3-243">Mais c’est quelque chose que nous pourrions envisager pour l’avenir si la base de code NerdDinner et les capacités ont augmenté.</span><span class="sxs-lookup"><span data-stu-id="626e3-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="626e3-244">Création de tests d’unités d’action d’édition</span><span class="sxs-lookup"><span data-stu-id="626e3-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="626e3-245">Créons maintenant des tests unitaires qui vérifient la fonctionnalité Edit du DinnersController.</span><span class="sxs-lookup"><span data-stu-id="626e3-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="626e3-246">Nous commencerons par tester la version HTTP-GET de notre action Edit :</span><span class="sxs-lookup"><span data-stu-id="626e3-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="626e3-247">Nous allons créer un test qui vérifie qu’une vue soutenue par un objet DinnerFormViewModel est rendue lorsque un dîner valide est demandé:</span><span class="sxs-lookup"><span data-stu-id="626e3-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="626e3-248">Lorsque nous effectuons le test, cependant, nous constaterons qu’il échoue parce qu’une exception de référence nulle est jetée lorsque la méthode Edit accède à la propriété User.Identity.Name pour effectuer le Dinner.IsHostedBy() vérifier.</span><span class="sxs-lookup"><span data-stu-id="626e3-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="626e3-249">L’objet utilisateur de la classe de base Controller encapsule les détails sur l’utilisateur connecté, et est peuplé de ASP.NET MVC lorsqu’il crée le contrôleur au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="626e3-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="626e3-250">Parce que nous testons le DinnersController en dehors d’un environnement de serveur Web, l’objet utilisateur n’est pas défini (d’où l’exception de référence nulle).</span><span class="sxs-lookup"><span data-stu-id="626e3-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="626e3-251">Mocking la propriété User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="626e3-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="626e3-252">Les cadres moqueurs facilitent les tests en nous permettant de créer dynamiquement de fausses versions d’objets dépendants qui prennent en charge nos tests.</span><span class="sxs-lookup"><span data-stu-id="626e3-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="626e3-253">Par exemple, nous pouvons utiliser un cadre de moquerie dans notre test d’action Edit pour créer dynamiquement un objet utilisateur que notre DinnersController peut utiliser pour rechercher un nom d’utilisateur simulé.</span><span class="sxs-lookup"><span data-stu-id="626e3-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="626e3-254">Cela évitera une référence nulle d’être jeté lorsque nous exécuteons notre test.</span><span class="sxs-lookup"><span data-stu-id="626e3-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="626e3-255">Il existe de nombreux cadres moqueurs .NET qui peuvent être utilisés avec ASP.NET MVC [http://www.mockframeworks.com/](http://www.mockframeworks.com/)(vous pouvez voir une liste d’entre eux ici: ).</span><span class="sxs-lookup"><span data-stu-id="626e3-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="626e3-256">Pour tester notre application NerdDinner, nous allons utiliser un cadre de moquerie open [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq)source appelé "Moq", qui peut être téléchargé gratuitement à partir de .</span><span class="sxs-lookup"><span data-stu-id="626e3-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="626e3-257">Une fois téléchargé, nous ajouterons une référence dans notre projet NerdDinner.Tests à l’assemblage Moq.dll :</span><span class="sxs-lookup"><span data-stu-id="626e3-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="626e3-258">Nous ajouterons ensuite une méthode d’aide "CreateDinnersControllerAs(username)" à notre classe de test qui prend un nom d’utilisateur comme paramètre, et qui "mocks" ensuite la propriété User.Identity.Name sur l’instance DinnersController:</span><span class="sxs-lookup"><span data-stu-id="626e3-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="626e3-259">Ci-dessus, nous utilisons Moq pour créer un objet Mock qui simule un objet ControllerContext (qui est ce que ASP.NET MVC passe aux classes Controller pour exposer des objets en temps d’exécution comme l’utilisateur, la demande, la réponse et la session).</span><span class="sxs-lookup"><span data-stu-id="626e3-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="626e3-260">Nous appelons la méthode "SetupGet" sur le Mock pour indiquer que la propriété HttpContext.User.Identity.Name sur ControllerContext devrait retourner la chaîne de nom d’utilisateur que nous avons passé à la méthode d’aide.</span><span class="sxs-lookup"><span data-stu-id="626e3-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="626e3-261">Nous pouvons nous moquer d’un certain nombre de propriétés et de méthodes ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="626e3-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="626e3-262">Pour illustrer cela, j’ai également ajouté un appel SetupGet () pour la propriété Request.IsAuthenticated (qui n’est pas réellement nécessaire pour les tests ci-dessous - mais qui aide à illustrer comment vous pouvez se moquer des propriétés de la demande).</span><span class="sxs-lookup"><span data-stu-id="626e3-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="626e3-263">Lorsque nous avons terminé, nous assignons un exemple de la maquette ControllerContext au DinnersController notre méthode d’aide retourne.</span><span class="sxs-lookup"><span data-stu-id="626e3-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="626e3-264">Nous pouvons maintenant écrire des tests unitaires qui utilisent cette méthode d’aide pour tester les scénarios d’édition impliquant différents utilisateurs :</span><span class="sxs-lookup"><span data-stu-id="626e3-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="626e3-265">Et maintenant, quand nous passons les tests, ils passent:</span><span class="sxs-lookup"><span data-stu-id="626e3-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="626e3-266">Test updateModel() scénarios</span><span class="sxs-lookup"><span data-stu-id="626e3-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="626e3-267">Nous avons créé des tests qui couvrent la version HTTP-GET de l’action Edit.</span><span class="sxs-lookup"><span data-stu-id="626e3-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="626e3-268">Créons maintenant quelques tests qui vérifient la version HTTP-POST de l’action Edit :</span><span class="sxs-lookup"><span data-stu-id="626e3-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="626e3-269">Le nouveau scénario de test intéressant pour nous de prendre en charge avec cette méthode d’action est son utilisation de la méthode d’aide UpdateModel() sur la classe de base Controller.</span><span class="sxs-lookup"><span data-stu-id="626e3-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="626e3-270">Nous utilisons cette méthode d’aide pour lier les valeurs de formulaire-post à notre instance d’objet de dîner.</span><span class="sxs-lookup"><span data-stu-id="626e3-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="626e3-271">Voici deux tests qui démontrent comment nous pouvons fournir des valeurs affichées de formulaire pour la méthode d’aide UpdateModel() à utiliser.</span><span class="sxs-lookup"><span data-stu-id="626e3-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="626e3-272">Nous le ferons en créant et en remplissant un objet FormCollection, puis en l’assignant à la propriété "ValueProvider" sur le Contrôleur.</span><span class="sxs-lookup"><span data-stu-id="626e3-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="626e3-273">Le premier test vérifie que sur un enregistrement réussi du navigateur est redirigé vers l’action des détails.</span><span class="sxs-lookup"><span data-stu-id="626e3-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="626e3-274">Le deuxième test vérifie que lorsque l’entrée invalide est affichée, l’action redisjoue à nouveau la vue d’édition avec un message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="626e3-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="626e3-275">Résumé des tests</span><span class="sxs-lookup"><span data-stu-id="626e3-275">Testing Wrap-Up</span></span>

<span data-ttu-id="626e3-276">Nous avons couvert les concepts de base impliqués dans les classes de contrôleurs d’essai unitaires.</span><span class="sxs-lookup"><span data-stu-id="626e3-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="626e3-277">Nous pouvons utiliser ces techniques pour créer facilement des centaines de tests simples qui vérifient le comportement de notre application.</span><span class="sxs-lookup"><span data-stu-id="626e3-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="626e3-278">Parce que nos tests de contrôleur et de modèle ne nécessitent pas une véritable base de données, ils sont extrêmement rapides et faciles à exécuter.</span><span class="sxs-lookup"><span data-stu-id="626e3-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="626e3-279">Nous serons en mesure d’exécuter des centaines de tests automatisés en quelques secondes, et immédiatement obtenir des commentaires quant à savoir si un changement que nous avons fait cassé quelque chose.</span><span class="sxs-lookup"><span data-stu-id="626e3-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="626e3-280">Cela nous aidera à nous donner la confiance nécessaire pour améliorer, refactoriser et affiner continuellement notre application.</span><span class="sxs-lookup"><span data-stu-id="626e3-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="626e3-281">Nous avons couvert les tests comme le dernier sujet de ce chapitre - mais pas parce que le test est quelque chose que vous devriez faire à la fin d’un processus de développement!</span><span class="sxs-lookup"><span data-stu-id="626e3-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="626e3-282">Au contraire, vous devriez écrire des tests automatisés le plus tôt possible dans votre processus de développement.</span><span class="sxs-lookup"><span data-stu-id="626e3-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="626e3-283">Cela vous permet d’obtenir des commentaires immédiats au fur et à mesure que vous développez, vous aide à réfléchir aux scénarios de cas d’utilisation de votre application et vous guide pour concevoir votre application avec des superpositions propres et des accouplements à l’esprit.</span><span class="sxs-lookup"><span data-stu-id="626e3-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="626e3-284">Un chapitre ultérieur du livre discutera du développement piloté par les tests (TDD) et de la façon de l’utiliser avec ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="626e3-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="626e3-285">TDD est une pratique de codage itératif où vous écrivez d’abord les tests que votre code résultant satisfera.</span><span class="sxs-lookup"><span data-stu-id="626e3-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="626e3-286">Avec TDD, vous commencez chaque fonctionnalité en créant un test qui vérifie les fonctionnalités que vous êtes sur le point d’implémenter.</span><span class="sxs-lookup"><span data-stu-id="626e3-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="626e3-287">L’écriture du test unitaire permet d’abord de vous assurer que vous comprenez clairement la fonctionnalité et comment elle est censée fonctionner.</span><span class="sxs-lookup"><span data-stu-id="626e3-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="626e3-288">Ce n’est qu’après l’écriture du test (et que vous avez vérifié qu’il échoue) que vous implémentez ensuite la fonctionnalité réelle que le test vérifie.</span><span class="sxs-lookup"><span data-stu-id="626e3-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="626e3-289">Parce que vous avez déjà passé du temps à réfléchir au cas d’utilisation de la façon dont la fonctionnalité est censée fonctionner, vous aurez une meilleure compréhension des exigences et de la meilleure façon de les mettre en œuvre.</span><span class="sxs-lookup"><span data-stu-id="626e3-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="626e3-290">Lorsque vous avez terminé avec la mise en œuvre, vous pouvez ré-exécuter le test et obtenir des commentaires immédiats quant à savoir si la fonctionnalité fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="626e3-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="626e3-291">Nous couvrirons plus de TDD dans le chapitre 10.</span><span class="sxs-lookup"><span data-stu-id="626e3-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="626e3-292">étape suivante</span><span class="sxs-lookup"><span data-stu-id="626e3-292">Next Step</span></span>

<span data-ttu-id="626e3-293">Quelques commentaires de conclusion finale.</span><span class="sxs-lookup"><span data-stu-id="626e3-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="626e3-294">[Suivant précédent](use-ajax-to-implement-mapping-scenarios.md)
> [Next](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="626e3-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
