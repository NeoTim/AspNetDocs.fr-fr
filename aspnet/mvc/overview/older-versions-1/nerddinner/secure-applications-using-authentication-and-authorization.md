---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Sécuriser des Applications à l’aide de l’authentification et autorisation | Microsoft Docs
author: microsoft
description: Étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: d5f1b26312f11fd6d4ab500c7f24a4d89d428e38
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57056336"
---
<a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="216a4-103">Sécuriser des applications avec l’authentification et l’autorisation</span><span class="sxs-lookup"><span data-stu-id="216a4-103">Secure Applications Using Authentication and Authorization</span></span>
====================
<span data-ttu-id="216a4-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="216a4-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="216a4-105">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="216a4-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="216a4-106">Il s’agit d’étape 9 a gratuit [« « l’application NerdDinner](introducing-the-nerddinner-tutorial.md) qui présente en détail comment créer un petit mais terminé, l’application web à l’aide d’ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="216a4-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="216a4-107">Étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer une nouvelle dîners et seul l’utilisateur qui héberge un dîner peut le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="216a4-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="216a4-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre le [mise en route avec MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [Store de musique MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) didacticiels.</span><span class="sxs-lookup"><span data-stu-id="216a4-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="216a4-109">NerdDinner étape 9 : Authentification et autorisation</span><span class="sxs-lookup"><span data-stu-id="216a4-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="216a4-110">Dès maintenant notre NerdDinner application accorde toute personne visitant le site la possibilité de créer et modifier les détails de n’importe quel dîner.</span><span class="sxs-lookup"><span data-stu-id="216a4-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="216a4-111">Nous allons modifier cela afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer nouvelle dîners et ajouter une restriction afin que seul l’utilisateur qui héberge un dîner peut le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="216a4-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="216a4-112">Pour ce faire, nous allons utiliser l’authentification et l’autorisation pour sécuriser notre application.</span><span class="sxs-lookup"><span data-stu-id="216a4-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="216a4-113">Autorisation et la compréhension de l’authentification</span><span class="sxs-lookup"><span data-stu-id="216a4-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="216a4-114">*Authentification* est le processus d’identification et de validation de l’identité d’un client de l’accès à une application.</span><span class="sxs-lookup"><span data-stu-id="216a4-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="216a4-115">Plus simplement, il agit sur l’identification des « qui » est de l’utilisateur final lorsqu’ils visitent un site Web.</span><span class="sxs-lookup"><span data-stu-id="216a4-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="216a4-116">ASP.NET prend en charge plusieurs méthodes d’authentification des utilisateurs du navigateur.</span><span class="sxs-lookup"><span data-stu-id="216a4-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="216a4-117">Pour des applications web Internet, l’approche la plus courante d’authentification utilisée est appelée « Authentification de formulaires ».</span><span class="sxs-lookup"><span data-stu-id="216a4-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="216a4-118">L’authentification par formulaire permet à un développeur créer un formulaire de connexion HTML dans leur application et puis valider le nom d’utilisateur/le mot de passe que l’utilisateur final soumet par rapport à une base de données ou un autre magasin d’informations d’identification de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="216a4-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="216a4-119">Si la combinaison nom d’utilisateur/mot de passe est correcte, le développeur peut demander puis ASP.NET pour émettre un cookie HTTP chiffré pour identifier l’utilisateur entre les demandes futures.</span><span class="sxs-lookup"><span data-stu-id="216a4-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="216a4-120">Nous allons à l’aide de l’authentification par formulaire avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="216a4-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="216a4-121">*Autorisation* est le processus permettant de déterminer si un utilisateur authentifié est autorisé à accéder à une ressource/URL particulière ou d’effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="216a4-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="216a4-122">Par exemple, au sein de notre application NerdDinner nous devrons autoriser que seuls les utilisateurs qui sont connectés peuvent accéder à la */dîners/créer* URL et créer de nouveaux dîners.</span><span class="sxs-lookup"><span data-stu-id="216a4-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="216a4-123">Nous allons également ajouter une logique d’autorisation afin que seul l’utilisateur qui héberge un dîner modification – et de refuser l’accès en modification à tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="216a4-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="216a4-124">L’authentification par formulaire et la nomme AccountController</span><span class="sxs-lookup"><span data-stu-id="216a4-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="216a4-125">Le modèle de projet Visual Studio par défaut pour ASP.NET MVC active automatiquement l’authentification par formulaire lors de la création de nouvelles applications ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="216a4-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="216a4-126">Il ajoute également automatiquement une implémentation de page de connexion de compte prédéfini pour le projet, ce qui le rend très facile à intégrer la sécurité au sein d’un site.</span><span class="sxs-lookup"><span data-stu-id="216a4-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="216a4-127">La page maître Site.master de valeur par défaut affiche un lien « Ouverture de session » dans l’angle supérieur droit du site quand l’utilisateur qui y accède n’est pas authentifiée :</span><span class="sxs-lookup"><span data-stu-id="216a4-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="216a4-128">Cliquant sur le lien « Ouverture de session » amène un utilisateur vers le */compte / d’ouverture de session* URL :</span><span class="sxs-lookup"><span data-stu-id="216a4-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="216a4-129">Les visiteurs qui n’ont pas enregistré peuvent se faire en cliquant sur le lien « S’inscrire » – qui mène à la */compte/Register* URL et leur permettre d’entrer les détails du compte :</span><span class="sxs-lookup"><span data-stu-id="216a4-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="216a4-130">En cliquant sur le bouton « S’inscrire » crée un nouvel utilisateur dans le système d’appartenance d’ASP.NET et authentifier l’utilisateur sur le site à l’aide de l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="216a4-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="216a4-131">Lorsqu’un utilisateur est connecté, la page Site.master change haut à droite de la page pour générer un « Bienvenue [username] ! »</span><span class="sxs-lookup"><span data-stu-id="216a4-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="216a4-132">message et restitue un « fermer la session » lier au lieu d’une « session » un.</span><span class="sxs-lookup"><span data-stu-id="216a4-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="216a4-133">Cliquant sur le lien « Fermer la session » déconnecte l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="216a4-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="216a4-134">La fonctionnalité de connexion, déconnexion et d’inscription ci-dessus est implémentée dans la classe AccountController qui a été ajoutée à notre projet par Visual Studio lors de la création du projet.</span><span class="sxs-lookup"><span data-stu-id="216a4-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="216a4-135">L’interface utilisateur pour le contrôle AccountController est implémentée à l’aide de modèles de vue dans le répertoire \Views\Account :</span><span class="sxs-lookup"><span data-stu-id="216a4-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="216a4-136">La classe AccountController utilise le système d’authentification par formulaire ASP.NET pour émettre des cookies d’authentification chiffré et l’API d’appartenance ASP.NET pour stocker et de valider les noms d’utilisateur/mots de passe.</span><span class="sxs-lookup"><span data-stu-id="216a4-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="216a4-137">L’API d’appartenance ASP.NET est extensible et permet de n’importe quel magasin d’informations d’identification de mot de passe à utiliser.</span><span class="sxs-lookup"><span data-stu-id="216a4-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="216a4-138">ASP.NET est livré avec des implémentations de fournisseur d’appartenances intégré qui stockent le nom d’utilisateur/mots de passe dans une base de données SQL, ou dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="216a4-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="216a4-139">Nous pouvons configurer le fournisseur d’appartenances notre application NerdDinner doit utiliser en ouvrant le fichier « web.config » à la racine du projet et en recherchant le &lt;appartenance&gt; section qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="216a4-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="216a4-140">Inscrit le fournisseur d’appartenances SQL web.config par défaut ajoutée lorsque le projet a été créé et configure pour utiliser une chaîne de connexion nommée « ApplicationServices » pour spécifier l’emplacement de la base de données.</span><span class="sxs-lookup"><span data-stu-id="216a4-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="216a4-141">La chaîne de connexion par défaut « ApplicationServices » (ce qui est spécifié dans le &lt;connectionStrings&gt; section du fichier web.config) est configuré pour utiliser SQL Express.</span><span class="sxs-lookup"><span data-stu-id="216a4-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="216a4-142">Il pointe vers une base de données SQL Express nommée « ASPNETDB. MDF » sous l’application « application\_données « directory.</span><span class="sxs-lookup"><span data-stu-id="216a4-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="216a4-143">Si cette base de données n’existe pas la première fois que l’API d’appartenance est utilisée au sein de l’application, ASP.NET sera automatiquement créer la base de données et approvisionner du schéma de base de données d’appartenance appropriés qu’il contient :</span><span class="sxs-lookup"><span data-stu-id="216a4-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="216a4-144">Si au lieu d’utiliser SQL Express que nous souhaitons utiliser une instance de SQL Server complète (ou se connecter à une base de données distante), tous les nous aurions besoin d’action consiste à mettre à jour la chaîne de connexion « ApplicationServices » dans le fichier web.config et assurez-vous que le schéma d’adhésion appropriées a été ajoutée pour qu’il pointe vers la base de données.</span><span class="sxs-lookup"><span data-stu-id="216a4-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="216a4-145">Vous pouvez exécuter le « aspnet\_regsql.exe « utilitaire dans le répertoire \Windows\Microsoft.NET\Framework\v2.0.50727\ pour ajouter le schéma approprié pour l’appartenance et les autres services d’application ASP.NET à une base de données.</span><span class="sxs-lookup"><span data-stu-id="216a4-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="216a4-146">Autorisation de l’URL dîners/créer en utilisant le filtre [Authorize]</span><span class="sxs-lookup"><span data-stu-id="216a4-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="216a4-147">Nous n’avions pas à écrire du code pour activer une authentification sécurisée et l’implémentation de gestion de compte pour l’application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="216a4-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="216a4-148">Les utilisateurs peuvent inscrire de nouveaux comptes avec notre application et se déconnecter du site.</span><span class="sxs-lookup"><span data-stu-id="216a4-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="216a4-149">Maintenant, nous pouvons ajouter la logique d’autorisation à l’application et permet de contrôler ce qu’ils peuvent et ne peut pas au sein du site l’état de l’authentification et le nom d’utilisateur de visiteurs.</span><span class="sxs-lookup"><span data-stu-id="216a4-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="216a4-150">Commençons par l’ajout d’une logique d’autorisation aux méthodes d’action « Créer » de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="216a4-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="216a4-151">Plus précisément, nous avons besoin que les utilisateurs accédant à la */dîners/créer* URL doit être connectée.</span><span class="sxs-lookup"><span data-stu-id="216a4-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="216a4-152">S’ils ne sont pas connectés nous allons les rediriger vers la page de connexion afin qu’ils peuvent se connecter à le.</span><span class="sxs-lookup"><span data-stu-id="216a4-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="216a4-153">L’implémentation de cette logique est assez facile.</span><span class="sxs-lookup"><span data-stu-id="216a4-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="216a4-154">Il nous suffit d’action consiste à ajouter un attribut de filtre [Authorize] à nos méthodes d’action de créer comme suit :</span><span class="sxs-lookup"><span data-stu-id="216a4-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="216a4-155">ASP.NET MVC prend en charge la possibilité de créer des « filtres d’action » qui peuvent être utilisées pour implémenter une logique réutilisable qui peut être appliquée de manière déclarative aux méthodes d’action.</span><span class="sxs-lookup"><span data-stu-id="216a4-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="216a4-156">Le filtre [Authorize] est un des filtres d’action intégrés fournis par ASP.NET MVC, et il permet à un développeur de façon déclarative appliquer des règles d’autorisation pour les méthodes d’action et les classes de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="216a4-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="216a4-157">Lorsqu’il est appliqué sans paramètres (comme ci-dessus) le filtre [Authorize] impose que l’utilisateur qui effectue la requête de méthode d’action doit être connecté – et il automatiquement redirige le navigateur vers l’URL de connexion si elles ne sont pas.</span><span class="sxs-lookup"><span data-stu-id="216a4-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="216a4-158">Cette redirection de l’URL demandée à l’origine est passée comme un argument de chaîne de requête lors de l’exécution (par exemple : / compte / d’ouverture de session ? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="216a4-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="216a4-159">Contrôle AccountController puis redirigera l’utilisateur vers l’URL demandée à l’origine une fois qu’il se connecte.</span><span class="sxs-lookup"><span data-stu-id="216a4-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="216a4-160">Le filtre [Authorize] éventuellement prend en charge que la possibilité de spécifier une propriété « Utilisateurs » ou « Rôles » qui peut être utilisée pour exiger que l’utilisateur est connecté et dans une liste d’utilisateurs autorisés ou un membre d’un rôle de sécurité autorisé.</span><span class="sxs-lookup"><span data-stu-id="216a4-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="216a4-161">Par exemple, le code ci-dessous autorise uniquement deux des utilisateurs spécifiques, « scottgu » et « billg », pour accéder à l’URL dîners/Create :</span><span class="sxs-lookup"><span data-stu-id="216a4-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="216a4-162">Incorporation des noms d’utilisateur spécifique dans du code tend à être relativement non gérable cependant.</span><span class="sxs-lookup"><span data-stu-id="216a4-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="216a4-163">Une meilleure approche consiste à définir de niveau supérieurs « rôles » que le code vérifie par rapport à, puis de mapper les utilisateurs dans le rôle à l’aide d’une base de données ou le système active directory (l’activation de la liste de mappage utilisateur réelles à stocker en externe à partir du code).</span><span class="sxs-lookup"><span data-stu-id="216a4-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="216a4-164">ASP.NET inclut une API de gestion de rôle intégré, mais aussi un ensemble intégré de fournisseurs de rôles (y compris celles pour SQL et Active Directory) qui peuvent aider à effectuer ce mappage de rôle d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="216a4-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="216a4-165">Nous pourrions ensuite mettre à jour le code pour autoriser uniquement les utilisateurs au sein d’un rôle spécifique « admin » pour accéder à l’URL dîners/Create :</span><span class="sxs-lookup"><span data-stu-id="216a4-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="216a4-166">À l’aide de la propriété User.Identity.Name lors de la création dîners</span><span class="sxs-lookup"><span data-stu-id="216a4-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="216a4-167">Nous pouvons récupérer le nom d’utilisateur de l’utilisateur actuellement connecté d’une demande à l’aide de la propriété User.Identity.Name exposée sur la classe de base du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="216a4-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="216a4-168">Antérieures lorsque nous avons implémenté la version de HTTP-POST de notre méthode d’action Create() nous avions codée en dur la propriété « HostedBy » du dîner à une chaîne statique.</span><span class="sxs-lookup"><span data-stu-id="216a4-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="216a4-169">Nous pouvons maintenant mettre à jour de ce code pour utiliser à la place de la propriété User.Identity.Name, mais aussi ajouter automatiquement une réponse pour l’hôte création le dîner :</span><span class="sxs-lookup"><span data-stu-id="216a4-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="216a4-170">Étant donné que nous avons ajouté un attribut [Authorize] à la méthode Create(), ASP.NET MVC permet de s’assurer que la méthode d’action s’exécute uniquement si l’utilisateur visitant l’URL dîners/créer est connecté sur le site.</span><span class="sxs-lookup"><span data-stu-id="216a4-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="216a4-171">Par conséquent, la valeur de propriété User.Identity.Name contient toujours un nom d’utilisateur valide.</span><span class="sxs-lookup"><span data-stu-id="216a4-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="216a4-172">À l’aide de la propriété User.Identity.Name lors de la modification dîners</span><span class="sxs-lookup"><span data-stu-id="216a4-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="216a4-173">Nous allons maintenant ajouter une logique d’autorisation qui limite les utilisateurs afin qu’ils peuvent uniquement modifier les propriétés de dîners qu'eux-mêmes qui héberge.</span><span class="sxs-lookup"><span data-stu-id="216a4-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="216a4-174">Pour cela, nous allons tout d’abord ajouter une méthode d’assistance de « IsHostedBy(username) » à notre objet dîner (au sein de la classe partielle Dinner.cs que nous avons créé précédemment).</span><span class="sxs-lookup"><span data-stu-id="216a4-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="216a4-175">Cette méthode d’assistance retourne true ou false selon si un nom d’utilisateur fourni correspond à la propriété dîner HostedBy et encapsule la logique nécessaire pour effectuer une comparaison de chaînes respectant la casse d'entre eux :</span><span class="sxs-lookup"><span data-stu-id="216a4-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="216a4-176">Nous allons ensuite ajouter un attribut [Authorize] aux méthodes d’action Edit() au sein de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="216a4-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="216a4-177">Cela garantit que les utilisateurs doivent être connectés à la demande un */Dinners/modification / [id]* URL.</span><span class="sxs-lookup"><span data-stu-id="216a4-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="216a4-178">Nous pouvons ensuite ajouter le code à nos méthodes de modification qui utilise la méthode d’assistance Dinner.IsHostedBy(username) pour vérifier que l’utilisateur connecté correspond à l’hôte dîner.</span><span class="sxs-lookup"><span data-stu-id="216a4-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="216a4-179">Si l’utilisateur n’est pas l’ordinateur hôte, nous afficher une vue « InvalidOwner » et mettre fin à la demande.</span><span class="sxs-lookup"><span data-stu-id="216a4-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="216a4-180">Le code d’implémentation se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="216a4-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="216a4-181">Nous pouvons ensuite avec le bouton droit sur le répertoire \Views\Dinners et choisir Add -&gt;afficher la commande de menu pour créer une nouvelle vue de « InvalidOwner ».</span><span class="sxs-lookup"><span data-stu-id="216a4-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="216a4-182">Nous allons renseignez-le avec le message d’erreur ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="216a4-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="216a4-183">Et maintenant quand un utilisateur tente de modifier un dîner qu’ils ne possèdent, ils obtiendront un message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="216a4-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="216a4-184">Nous pouvons répéter les mêmes étapes pour les méthodes d’action Delete() dans notre contrôleur pour bloquer l’autorisation de supprimer dîners ainsi et vous assurer que seul l’hôte d’un dîner pouvez le supprimer.</span><span class="sxs-lookup"><span data-stu-id="216a4-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="216a4-185">Modification de l’affichage/masquage et des liens de suppression</span><span class="sxs-lookup"><span data-stu-id="216a4-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="216a4-186">Nous sommes liaison à la méthode d’action Edit et Delete de notre classe DinnersController dans notre URL détails :</span><span class="sxs-lookup"><span data-stu-id="216a4-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="216a4-187">Actuellement, nous expliquons les modifier et supprimer des liens d’action que le visiteur à l’URL de détails soit l’hôte du dîner.</span><span class="sxs-lookup"><span data-stu-id="216a4-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="216a4-188">Nous allons modifier afin que les liens sont affichés uniquement si l’utilisateur visite est le propriétaire du dîner.</span><span class="sxs-lookup"><span data-stu-id="216a4-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="216a4-189">La méthode d’action Details() au sein de notre DinnersController récupère un objet dîner et transmet ensuite en tant que l’objet de modèle à notre modèle de vue :</span><span class="sxs-lookup"><span data-stu-id="216a4-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="216a4-190">Nous pouvons mettre à jour de notre modèle de vue pour conditionnellement afficher/masquer les liens Edit et Delete à l’aide de la Dinner.IsHostedBy() méthode d’assistance comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="216a4-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="216a4-191">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="216a4-191">Next Steps</span></span>

<span data-ttu-id="216a4-192">Voyons maintenant comment nous pouvons activer les utilisateurs authentifiés à RSVP pour préparés à l’aide d’AJAX.</span><span class="sxs-lookup"><span data-stu-id="216a4-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="216a4-193">[Précédent](implement-efficient-data-paging.md)
> [Suivant](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="216a4-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
