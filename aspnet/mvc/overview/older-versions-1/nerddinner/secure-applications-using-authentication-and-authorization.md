---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Applications sécurisées à l’aide de l’authentification et de l’autorisation . Microsoft Docs
author: rick-anderson
description: L’étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs doivent s’inscrire et se connecter au site pour créer...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: d96f2763f6e62f9dd599fdb7977a97993d218305
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542571"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="a4b94-103">Sécuriser des applications avec l’authentification et l’autorisation</span><span class="sxs-lookup"><span data-stu-id="a4b94-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="a4b94-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="a4b94-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="a4b94-105">Télécharger le PDF</span><span class="sxs-lookup"><span data-stu-id="a4b94-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="a4b94-106">Il s’agit de l’étape 9 d’un tutoriel gratuit ["NerdDinner" application](introducing-the-nerddinner-tutorial.md) qui marche à travers la façon de construire une petite, mais complète, application web en utilisant ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="a4b94-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="a4b94-107">Étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, de sorte que les utilisateurs doivent s’inscrire et se connecter au site pour créer de nouveaux dîners, et seul l’utilisateur qui héberge un dîner peut le modifier plus tard.</span><span class="sxs-lookup"><span data-stu-id="a4b94-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="a4b94-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre les tutoriels [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="a4b94-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="a4b94-109">NerdDinner Étape 9: Authentification et autorisation</span><span class="sxs-lookup"><span data-stu-id="a4b94-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="a4b94-110">En ce moment, notre application NerdDinner accorde à toute personne visitant le site la possibilité de créer et de modifier les détails de n’importe quel dîner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="a4b94-111">Changeons ceci de sorte que les utilisateurs doivent s’inscrire et se connecter au site pour créer de nouveaux dîners, et ajouter une restriction de sorte que seul l’utilisateur qui héberge un dîner peut le modifier plus tard.</span><span class="sxs-lookup"><span data-stu-id="a4b94-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="a4b94-112">Pour ce faire, nous utiliserons l’authentification et l’autorisation pour sécuriser notre application.</span><span class="sxs-lookup"><span data-stu-id="a4b94-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="a4b94-113">Comprendre l’authentification et l’autorisation</span><span class="sxs-lookup"><span data-stu-id="a4b94-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="a4b94-114">*L’authentification* est le processus d’identification et de validation de l’identité d’un client accédant à une application.</span><span class="sxs-lookup"><span data-stu-id="a4b94-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="a4b94-115">En d’autres termes, il s’agit d’identifier « qui » l’utilisateur final est lorsqu’il visite un site Web.</span><span class="sxs-lookup"><span data-stu-id="a4b94-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="a4b94-116">ASP.NET prend en charge plusieurs façons d’authentifier les utilisateurs du navigateur.</span><span class="sxs-lookup"><span data-stu-id="a4b94-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="a4b94-117">Pour les applications Web Internet, l’approche d’authentification la plus courante utilisée s’appelle « Authentification des formes ».</span><span class="sxs-lookup"><span data-stu-id="a4b94-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="a4b94-118">Forms Authentication permet à un développeur d’écrire un formulaire de connexion HTML dans son application, puis de valider le nom d’utilisateur/mot de passe qu’un utilisateur final soumet à une base de données ou à un autre magasin d’informations de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="a4b94-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="a4b94-119">Si la combinaison nom d’utilisateur/mot de passe est correcte, le développeur peut alors demander à ASP.NET d’émettre un cookie HTTP crypté pour identifier l’utilisateur à travers les futures demandes.</span><span class="sxs-lookup"><span data-stu-id="a4b94-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="a4b94-120">Nous utiliserons des formulaires d’authentification avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="a4b94-121">*L’autorisation* est le processus de déterminer si un utilisateur authentifié a la permission d’accéder à une URL/ressource particulière ou d’effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="a4b94-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="a4b94-122">Par exemple, dans notre application NerdDinner, nous vous autoriserons que seuls les utilisateurs qui sont connectés peuvent accéder à l’URL */Dîners/Créer* et créer de nouveaux dîners.</span><span class="sxs-lookup"><span data-stu-id="a4b94-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="a4b94-123">Nous voulons également ajouter la logique d’autorisation afin que seul l’utilisateur qui héberge un dîner puisse le modifier et refuser l’accès à l’édition à tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="a4b94-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="a4b94-124">Formulaires Authentification et le AccountController</span><span class="sxs-lookup"><span data-stu-id="a4b94-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="a4b94-125">Le modèle de projet Visual Studio par défaut pour ASP.NET MVC permet automatiquement l’authentification des formulaires lors de la création de nouvelles applications ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a4b94-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="a4b94-126">Il ajoute également automatiquement une mise en œuvre de la page de connexion de compte pré-construite au projet, ce qui facilite l’intégration de la sécurité dans un site.</span><span class="sxs-lookup"><span data-stu-id="a4b94-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="a4b94-127">La page principale par défaut de Site.master affiche un lien " Log On " en haut à droite du site lorsque l’utilisateur qui y accède n’est pas authentifié :</span><span class="sxs-lookup"><span data-stu-id="a4b94-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="a4b94-128">En cliquant sur le lien "Log On" emmène un utilisateur vers l’URL */Compte/LogOn:*</span><span class="sxs-lookup"><span data-stu-id="a4b94-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="a4b94-129">Les visiteurs qui ne se sont pas inscrits peuvent le faire en cliquant sur le lien « Registre », qui les mènera à l’URL */Compte/Register* et leur permettra d’entrer les détails du compte :</span><span class="sxs-lookup"><span data-stu-id="a4b94-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="a4b94-130">En cliquant sur le bouton "Register", créer un nouvel utilisateur dans le système d’adhésion ASP.NET et authentifier l’utilisateur sur le site à l’aide de formulaires d’authentification.</span><span class="sxs-lookup"><span data-stu-id="a4b94-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="a4b94-131">Lorsqu’un utilisateur est connecté, le Site.master modifie le haut à droite de la page pour obtenir un « Bienvenue [nom d’utilisateur] ! »</span><span class="sxs-lookup"><span data-stu-id="a4b94-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="a4b94-132">message et rend un lien "Log Off" au lieu d’un "Log On".</span><span class="sxs-lookup"><span data-stu-id="a4b94-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="a4b94-133">En cliquant sur le lien "Log Off" connecte l’utilisateur:</span><span class="sxs-lookup"><span data-stu-id="a4b94-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="a4b94-134">La fonctionnalité de connexion ci-dessus, de logout et d’enregistrement est implémentée au sein de la classe AccountController qui a été ajoutée à notre projet par Visual Studio lorsqu’elle a créé le projet.</span><span class="sxs-lookup"><span data-stu-id="a4b94-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="a4b94-135">L’interface utilisateur du AccountController est implémentée à l’aide de modèles de vue dans l’annuaire « Vues -Compte » :</span><span class="sxs-lookup"><span data-stu-id="a4b94-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="a4b94-136">La classe AccountController utilise le système d’authentification des formulaires ASP.NET pour émettre des cookies d’authentification cryptés, et l’API ASP.NET adhésion pour stocker et valider les noms d’utilisateur/mots de passe.</span><span class="sxs-lookup"><span data-stu-id="a4b94-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="a4b94-137">L’API d’adhésion ASP.NET est extensible et permet d’utiliser n’importe quel magasin d’identification de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="a4b94-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="a4b94-138">ASP.NET navires avec des implémentations intégrées de fournisseur d’adhésion qui stockent le nom d’utilisateur/mots de passe dans une base de données SQL, ou dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a4b94-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="a4b94-139">Nous pouvons configurer quel fournisseur d’adhésion notre application NerdDinner devrait utiliser en ouvrant le &lt;fichier&gt; "web.config" à la racine du projet et en recherchant la section d’adhésion en son sein.</span><span class="sxs-lookup"><span data-stu-id="a4b94-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="a4b94-140">Le web.config par défaut ajouté lors de la création du projet enregistre le fournisseur d’adhésion SQL, et le configure pour utiliser une chaîne de connexion nommée "ApplicationServices" pour spécifier l’emplacement de la base de données.</span><span class="sxs-lookup"><span data-stu-id="a4b94-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="a4b94-141">La chaîne de connexion par défaut "ApplicationServices" (qui est spécifiée dans la &lt;section connectionStrings&gt; du fichier web.config) est configurée pour utiliser SQL Express.</span><span class="sxs-lookup"><span data-stu-id="a4b94-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="a4b94-142">Il indique une base de données SQL Express nommée "ASPNETDB. MDF» dans le cadre\_de l’annuaire «App Data» de l’application.</span><span class="sxs-lookup"><span data-stu-id="a4b94-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="a4b94-143">Si cette base de données n’existe pas la première fois que l’API d’adhésion est utilisée dans l’application, ASP.NET créera automatiquement la base de données et fournira le schéma approprié de base de données d’adhésion en son sein :</span><span class="sxs-lookup"><span data-stu-id="a4b94-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="a4b94-144">Si au lieu d’utiliser SQL Express, nous voulions utiliser une instance complète SQL Server (ou nous connecter à une base de données à distance), tout ce que nous aurions à faire est de mettre à jour la chaîne de connexion "ApplicationServices" dans le fichier web.config et de s’assurer que le schéma d’adhésion approprié a été ajouté à la base de données qu’il pointe.</span><span class="sxs-lookup"><span data-stu-id="a4b94-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="a4b94-145">Vous pouvez exécuter l’utilitaire "aspnet\_regsql.exe" dans l’annuaire "Windows-Microsoft.NET-Framework"v2.0.50727" pour ajouter le schéma approprié pour l’adhésion et les autres services d’application ASP.NET à une base de données.</span><span class="sxs-lookup"><span data-stu-id="a4b94-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="a4b94-146">Autoriser l’URL /Dîners/Créer à l’aide du filtre [Autoriser]</span><span class="sxs-lookup"><span data-stu-id="a4b94-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="a4b94-147">Nous n’avons pas eu à écrire de code pour permettre une authentification sécurisée et la mise en œuvre de la gestion de compte pour l’application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="a4b94-148">Les utilisateurs peuvent enregistrer de nouveaux comptes avec notre application, et se connecter / logout du site.</span><span class="sxs-lookup"><span data-stu-id="a4b94-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="a4b94-149">Maintenant, nous pouvons ajouter la logique d’autorisation à l’application, et utiliser le statut d’authentification et le nom d’utilisateur des visiteurs pour contrôler ce qu’ils peuvent et ne peuvent pas faire dans le site.</span><span class="sxs-lookup"><span data-stu-id="a4b94-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="a4b94-150">Commençons par ajouter la logique d’autorisation aux méthodes d’action « Créer » de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="a4b94-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="a4b94-151">Plus précisément, nous exigerons que les utilisateurs accédant à l’URL */Dîners/Créer* soient connectés.</span><span class="sxs-lookup"><span data-stu-id="a4b94-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="a4b94-152">S’ils ne sont pas connectés, nous les redirigerons vers la page de connexion afin qu’ils puissent se connecter.</span><span class="sxs-lookup"><span data-stu-id="a4b94-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="a4b94-153">La mise en œuvre de cette logique est assez facile.</span><span class="sxs-lookup"><span data-stu-id="a4b94-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="a4b94-154">Tout ce que nous devons faire est d’ajouter un attribut de filtre [Autoriser] à nos méthodes d’action Créer comme ça :</span><span class="sxs-lookup"><span data-stu-id="a4b94-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="a4b94-155">ASP.NET MVC prend en charge la capacité de créer des « filtres d’action » qui peuvent être utilisés pour implémenter une logique ré-utilisable qui peut être appliquée de façon déclarative aux méthodes d’action.</span><span class="sxs-lookup"><span data-stu-id="a4b94-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="a4b94-156">Le filtre [Authorize] est l’un des filtres d’action intégrés fournis par ASP.NET MVC, et il permet à un développeur d’appliquer de façon déclarative les règles d’autorisation aux méthodes d’action et aux classes de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="a4b94-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="a4b94-157">Lorsqu’il est appliqué sans aucun paramètre (comme ci-dessus), le filtre [Autoriser] impose que l’utilisateur qui effectue la demande de méthode d’action doit être connecté et qu’il redirigera automatiquement le navigateur vers l’URL de connexion s’il ne le fait pas.</span><span class="sxs-lookup"><span data-stu-id="a4b94-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="a4b94-158">Lorsque vous effectuez cette redirection, l’URL initialement demandée est passée comme argument de requête (par exemple: /Compte/LogOn? RetourUrl%%2fDinners%2fCreate).</span><span class="sxs-lookup"><span data-stu-id="a4b94-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="a4b94-159">Le AccountController redirigera ensuite l’utilisateur vers l’URL initialement demandée une fois qu’il se connectera.</span><span class="sxs-lookup"><span data-stu-id="a4b94-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="a4b94-160">Le filtre [Autoriser] prend en charge la possibilité de spécifier une propriété « Utilisateurs » ou « Rôles » qui peut être utilisée pour exiger que l’utilisateur soit à la fois connecté et dans une liste d’utilisateurs autorisés ou d’un membre d’un rôle de sécurité autorisé.</span><span class="sxs-lookup"><span data-stu-id="a4b94-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="a4b94-161">Par exemple, le code ci-dessous permet uniquement à deux utilisateurs spécifiques, "scottgu" et "billg", d’accéder à l’URL /Dîners/Créer:</span><span class="sxs-lookup"><span data-stu-id="a4b94-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="a4b94-162">L’intégration de noms d’utilisateur spécifiques dans le code a tendance à être assez in maintainable cependant.</span><span class="sxs-lookup"><span data-stu-id="a4b94-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="a4b94-163">Une meilleure approche consiste à définir les « rôles » de niveau supérieur que le code vérifie, puis à cartographier les utilisateurs dans le rôle à l’aide d’une base de données ou d’un système d’annuaire actif (permettant à la liste de cartographie utilisateur réelle d’être stockée à l’extérieur à partir du code).</span><span class="sxs-lookup"><span data-stu-id="a4b94-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="a4b94-164">ASP.NET comprend une API intégrée de gestion des rôles ainsi qu’un ensemble intégré de fournisseurs de rôles (y compris ceux pour SQL et Active Directory) qui peuvent aider à effectuer cette cartographie utilisateur/rôle.</span><span class="sxs-lookup"><span data-stu-id="a4b94-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="a4b94-165">Nous pourrions alors mettre à jour le code uniquement pour permettre aux utilisateurs dans un rôle spécifique "admin" d’accéder à l’URL /Dîners/Créer:</span><span class="sxs-lookup"><span data-stu-id="a4b94-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="a4b94-166">Utilisation de la propriété User.Identity.Name lors de la création de dîners</span><span class="sxs-lookup"><span data-stu-id="a4b94-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="a4b94-167">Nous pouvons récupérer le nom d’utilisateur de l’utilisateur actuellement connecté d’une demande en utilisant la propriété User.Identity.Name exposée sur la classe de base Controller.</span><span class="sxs-lookup"><span data-stu-id="a4b94-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="a4b94-168">Plus tôt, lorsque nous avons mis en œuvre la version HTTP-POST de notre méthode d’action Create() nous avions codé dur la propriété "HostedBy" du dîner à une chaîne statique.</span><span class="sxs-lookup"><span data-stu-id="a4b94-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="a4b94-169">Nous pouvons maintenant mettre à jour ce code à la place d’utiliser la propriété User.Identity.Name, ainsi que d’ajouter automatiquement un RSVP pour l’hôte de créer le dîner:</span><span class="sxs-lookup"><span data-stu-id="a4b94-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="a4b94-170">Parce que nous avons ajouté un attribut [Autoriser] à la méthode Créer() ASP.NET MVC s’assure que la méthode d’action ne s’exécute que si l’utilisateur visitant l’URL /Dîners/Créer est connecté sur le site.</span><span class="sxs-lookup"><span data-stu-id="a4b94-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="a4b94-171">En tant que tel, la valeur de la propriété User.Identity.Name contiendra toujours un nom d’utilisateur valide.</span><span class="sxs-lookup"><span data-stu-id="a4b94-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="a4b94-172">Utilisation de la propriété User.Identity.Name lors de l’édition des dîners</span><span class="sxs-lookup"><span data-stu-id="a4b94-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="a4b94-173">Ajoutons maintenant une certaine logique d’autorisation qui restreint les utilisateurs afin qu’ils ne puissent modifier que les propriétés des dîners qu’ils hébergent eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="a4b94-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="a4b94-174">Pour aider à cela, nous allons d’abord ajouter un "IsHostedBy (nom d’utilisateur)" méthode d’aide à notre objet Dîner (dans la classe partielle Dinner.cs que nous avons construit plus tôt).</span><span class="sxs-lookup"><span data-stu-id="a4b94-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="a4b94-175">Cette méthode d’aide retourne vraie ou fausse selon qu’un nom d’utilisateur fourni correspond à la propriété Dinner HostedBy, et encapsule la logique nécessaire pour effectuer une comparaison de chaîne insensible cas d’entre eux:</span><span class="sxs-lookup"><span data-stu-id="a4b94-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="a4b94-176">Nous ajouterons ensuite un attribut [Autoriser] aux méthodes d’action Edit () au sein de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="a4b94-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="a4b94-177">Cela permettra de s’assurer que les utilisateurs doivent être connectés pour demander une URL */Dîners/Edit/[id].*</span><span class="sxs-lookup"><span data-stu-id="a4b94-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="a4b94-178">Nous pouvons ensuite ajouter du code à nos méthodes d’édition qui utilise la méthode d’aide Dinner.IsHostedBy (nom d’utilisateur) pour vérifier que l’utilisateur connecté correspond à l’hôte du dîner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="a4b94-179">Si l’utilisateur n’est pas l’hôte, nous afficherons une vue "InvalidOwner" et met fin à la demande.</span><span class="sxs-lookup"><span data-stu-id="a4b94-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="a4b94-180">Le code pour ce faire ressemble ci-dessous:</span><span class="sxs-lookup"><span data-stu-id="a4b94-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="a4b94-181">Nous pouvons ensuite cliquer à droite sur le répertoire «Vues-Dîners» et choisir la commande de menu Add-View&gt;pour créer une nouvelle vue "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="a4b94-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="a4b94-182">Nous allons le remplir avec le message d’erreur ci-dessous:</span><span class="sxs-lookup"><span data-stu-id="a4b94-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="a4b94-183">Et maintenant, quand un utilisateur tente de modifier un dîner qu’il ne possède pas, il recevra un message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="a4b94-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="a4b94-184">Nous pouvons répéter les mêmes étapes pour les méthodes d’action Supprimer () au sein de notre contrôleur pour verrouiller l’autorisation de supprimer les dîners ainsi, et de s’assurer que seul l’hôte d’un dîner peut le supprimer.</span><span class="sxs-lookup"><span data-stu-id="a4b94-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="a4b94-185">Afficher/Cacher modifier et supprimer les liens</span><span class="sxs-lookup"><span data-stu-id="a4b94-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="a4b94-186">Nous sommes en lien avec la méthode d’action Edit and Delete de notre classe DinnersController à partir de notre URL Détails:</span><span class="sxs-lookup"><span data-stu-id="a4b94-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="a4b94-187">Actuellement, nous montrons les liens d’action Edit and Delete indépendamment du fait que le visiteur à l’URL des détails est l’hôte du dîner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="a4b94-188">Changeons cela de sorte que les liens ne sont affichés que si l’utilisateur invité est le propriétaire du dîner.</span><span class="sxs-lookup"><span data-stu-id="a4b94-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="a4b94-189">La méthode d’action Détails () dans notre DinnersController récupère un objet de dîner et le transmet ensuite comme objet modèle à notre modèle de vue :</span><span class="sxs-lookup"><span data-stu-id="a4b94-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="a4b94-190">Nous pouvons mettre à jour notre modèle de vue pour afficher sous condition / cacher les liens Modifier et Supprimer en utilisant la méthode d’aide Dinner.IsHostedBy() comme ci-dessous:</span><span class="sxs-lookup"><span data-stu-id="a4b94-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="a4b94-191">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a4b94-191">Next Steps</span></span>

<span data-ttu-id="a4b94-192">Examinons maintenant comment nous pouvons permettre aux utilisateurs authentifiés de RSVP pour les dîners à l’aide d’AJAX.</span><span class="sxs-lookup"><span data-stu-id="a4b94-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a4b94-193">[Suivant précédent](implement-efficient-data-paging.md)
> [Next](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="a4b94-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
