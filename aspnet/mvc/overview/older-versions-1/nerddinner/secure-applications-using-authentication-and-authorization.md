---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Sécuriser les applications à l’aide de l’authentification et de l’autorisation | Microsoft Docs
author: microsoft
description: L’étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs aient besoin de s’inscrire et de se connecter au site pour créer...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78600981"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="bd489-103">Sécuriser des applications avec l’authentification et l’autorisation</span><span class="sxs-lookup"><span data-stu-id="bd489-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="bd489-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="bd489-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="bd489-105">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="bd489-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="bd489-106">Il s’agit de l’étape 9 d’un [didacticiel d’application « NerdDinner »](introducing-the-nerddinner-tutorial.md) gratuit qui vous guide dans la création d’une application Web de petite taille, mais complète, à l’aide de ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="bd489-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="bd489-107">L’étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, de sorte que les utilisateurs doivent s’inscrire et se connecter au site pour créer de nouveaux dîners, et que seul l’utilisateur qui héberge un dîner peut le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="bd489-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="bd489-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre les [prise en main avec](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) les didacticiels du [magasin de musique](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) MVC 3 ou Mvc.</span><span class="sxs-lookup"><span data-stu-id="bd489-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="bd489-109">NerdDinner étape 9 : authentification et autorisation</span><span class="sxs-lookup"><span data-stu-id="bd489-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="bd489-110">À l’heure actuelle, notre application NerdDinner accorde à toute personne visitant le site la possibilité de créer et de modifier les détails d’un dîner.</span><span class="sxs-lookup"><span data-stu-id="bd489-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="bd489-111">Nous allons modifier cela afin que les utilisateurs aient besoin de s’inscrire et de se connecter au site pour créer de nouveaux dîners, et ajouter une restriction afin que seul l’utilisateur qui héberge un dîner puisse le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="bd489-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="bd489-112">Pour ce faire, nous allons utiliser l’authentification et l’autorisation pour sécuriser notre application.</span><span class="sxs-lookup"><span data-stu-id="bd489-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="bd489-113">Fonctionnement de l’authentification et de l’autorisation</span><span class="sxs-lookup"><span data-stu-id="bd489-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="bd489-114">L' *authentification* est le processus d’identification et de validation de l’identité d’un client qui accède à une application.</span><span class="sxs-lookup"><span data-stu-id="bd489-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="bd489-115">Plus simplement, il s’agit d’identifier l’utilisateur final lorsqu’il visite un site Web.</span><span class="sxs-lookup"><span data-stu-id="bd489-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="bd489-116">ASP.NET prend en charge plusieurs méthodes d’authentification des utilisateurs du navigateur.</span><span class="sxs-lookup"><span data-stu-id="bd489-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="bd489-117">Pour les applications Web Internet, l’approche d’authentification la plus courante utilisée est appelée « authentification par formulaire ».</span><span class="sxs-lookup"><span data-stu-id="bd489-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="bd489-118">L’authentification par formulaire permet à un développeur de créer un formulaire de connexion HTML dans son application, puis de valider le nom d’utilisateur/mot de passe qu’un utilisateur final envoie sur une base de données ou autre magasin d’informations d’identification de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bd489-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="bd489-119">Si la combinaison nom d’utilisateur/mot de passe est correcte, le développeur peut demander à ASP.NET d’émettre un cookie HTTP chiffré pour identifier l’utilisateur parmi les demandes ultérieures.</span><span class="sxs-lookup"><span data-stu-id="bd489-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="bd489-120">Nous allons utiliser l’authentification par formulaire avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="bd489-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="bd489-121">L' *autorisation* est le processus qui consiste à déterminer si un utilisateur authentifié a l’autorisation d’accéder à une URL/ressource particulière ou d’effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="bd489-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="bd489-122">Par exemple, dans notre application NerdDinner, nous souhaitons autoriser que seuls les utilisateurs qui sont connectés peuvent accéder à l’URL */dinners/Create* et créer de nouveaux dîners.</span><span class="sxs-lookup"><span data-stu-id="bd489-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="bd489-123">Nous souhaitons également ajouter une logique d’autorisation afin que seul l’utilisateur qui héberge un dîner puisse le modifier, et refuser l’accès en modification à tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="bd489-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="bd489-124">Authentification par formulaire et AccountController</span><span class="sxs-lookup"><span data-stu-id="bd489-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="bd489-125">Le modèle de projet Visual Studio par défaut pour ASP.NET MVC active automatiquement l’authentification par formulaire lorsque de nouvelles applications ASP.NET MVC sont créées.</span><span class="sxs-lookup"><span data-stu-id="bd489-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="bd489-126">Il ajoute également automatiquement une implémentation de page de connexion de compte prédéfinie au projet, ce qui rend très facile l’intégration de la sécurité dans un site.</span><span class="sxs-lookup"><span data-stu-id="bd489-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="bd489-127">La page maître du site par défaut affiche un lien « ouvrir une session » en haut à droite du site lorsque l’utilisateur qui y accède n’est pas authentifié :</span><span class="sxs-lookup"><span data-stu-id="bd489-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="bd489-128">En cliquant sur le lien « connexion », vous accédez à l’URL */Account/Logon* :</span><span class="sxs-lookup"><span data-stu-id="bd489-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="bd489-129">Les visiteurs qui n’ont pas été inscrits peuvent le faire en cliquant sur le lien « s’inscrire », qui les mettra à l’URL */Account/Register* et leur permettra d’entrer les informations de compte :</span><span class="sxs-lookup"><span data-stu-id="bd489-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="bd489-130">En cliquant sur le bouton « s’inscrire », vous créez un nouvel utilisateur dans le système d’appartenance ASP.NET et vous authentifiez l’utilisateur sur le site à l’aide de l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="bd489-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="bd489-131">Quand un utilisateur se connecte, le fichier site. Master modifie le coin supérieur droit de la page pour générer un « Welcome [username] ! »</span><span class="sxs-lookup"><span data-stu-id="bd489-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="bd489-132">message et affiche un lien « fermer la session » au lieu d’un « ouvrir une session ».</span><span class="sxs-lookup"><span data-stu-id="bd489-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="bd489-133">Cliquer sur le lien « fermer la session » déconnecte l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="bd489-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="bd489-134">Les fonctionnalités de connexion, de déconnexion et d’inscription ci-dessus sont implémentées dans la classe AccountController qui a été ajoutée à notre projet par Visual Studio lors de la création du projet.</span><span class="sxs-lookup"><span data-stu-id="bd489-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="bd489-135">L’interface utilisateur pour AccountController est implémentée à l’aide de modèles de vue dans le répertoire \Views\Account :</span><span class="sxs-lookup"><span data-stu-id="bd489-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="bd489-136">La classe AccountController utilise le système d’authentification ASP.NET Forms pour émettre des cookies d’authentification chiffrés et l’API d’appartenance ASP.NET pour stocker et valider les noms d’utilisateur/mots de passe.</span><span class="sxs-lookup"><span data-stu-id="bd489-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="bd489-137">L’API d’appartenance ASP.NET est extensible et permet l’utilisation de n’importe quel magasin d’informations d’identification de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bd489-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="bd489-138">ASP.NET est fourni avec des implémentations de fournisseur d’appartenances intégrées qui stockent les noms d’utilisateur/mots de passe dans une base de données SQL, ou dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="bd489-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="bd489-139">Nous pouvons configurer le fournisseur d’appartenances que notre application NerdDinner doit utiliser en ouvrant le fichier « Web. config » à la racine du projet et en recherchant la section&gt; de l’appartenance au &lt;.</span><span class="sxs-lookup"><span data-stu-id="bd489-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="bd489-140">Le fichier Web. config par défaut ajouté lors de la création du projet inscrit le fournisseur d’appartenances SQL et le configure pour qu’il utilise une chaîne de connexion nommée « ApplicationServices » pour spécifier l’emplacement de la base de données.</span><span class="sxs-lookup"><span data-stu-id="bd489-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="bd489-141">La chaîne de connexion « ApplicationServices » par défaut (qui est spécifiée dans la section &lt;connectionStrings&gt; du fichier Web. config) est configurée pour utiliser SQL Express.</span><span class="sxs-lookup"><span data-stu-id="bd489-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="bd489-142">Il pointe vers une base de données SQL Express nommée «ASPNETDB. MDF» dans le répertoire « App\_Data » de l’application.</span><span class="sxs-lookup"><span data-stu-id="bd489-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="bd489-143">Si cette base de données n’existe pas lors de la première utilisation de l’API d’appartenance au sein de l’application, ASP.NET crée automatiquement la base de données et configure le schéma de base de données d’appartenance approprié au sein de celle-ci :</span><span class="sxs-lookup"><span data-stu-id="bd489-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="bd489-144">Si, au lieu d’utiliser SQL Express, nous souhaitons utiliser une instance de SQL Server complète (ou se connecter à une base de données distante), tout ce qu’il faudrait faire est de mettre à jour la chaîne de connexion « ApplicationServices » dans le fichier Web. config et de vérifier que le schéma d’appartenance approprié a été ajouté à la base de données sur laquelle il pointe.</span><span class="sxs-lookup"><span data-stu-id="bd489-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="bd489-145">Vous pouvez exécuter l’utilitaire « ASPNET\_RegSql. exe » dans le répertoire \Windows\Microsoft.NET\Framework\v2.0.50727\ pour ajouter le schéma approprié pour l’appartenance et les autres services d’application ASP.NET à une base de données.</span><span class="sxs-lookup"><span data-stu-id="bd489-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="bd489-146">Autorisation de l’URL/Dinners/Create à l’aide du filtre [Authorize]</span><span class="sxs-lookup"><span data-stu-id="bd489-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="bd489-147">Nous n’avons pas eu à écrire de code pour activer une implémentation sécurisée de l’authentification et de la gestion des comptes pour l’application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="bd489-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="bd489-148">Les utilisateurs peuvent enregistrer de nouveaux comptes avec notre application, ainsi que la connexion/déconnexion du site.</span><span class="sxs-lookup"><span data-stu-id="bd489-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="bd489-149">À présent, nous pouvons ajouter une logique d’autorisation à l’application et utiliser l’état d’authentification et le nom d’utilisateur des visiteurs pour contrôler ce qu’ils peuvent et ne peuvent pas faire au sein du site.</span><span class="sxs-lookup"><span data-stu-id="bd489-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="bd489-150">Commençons par ajouter la logique d’autorisation aux méthodes d’action « Create » de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="bd489-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="bd489-151">Plus précisément, nous exigeons que les utilisateurs qui accèdent à l’URL */dinners/Create* doivent être connectés.</span><span class="sxs-lookup"><span data-stu-id="bd489-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="bd489-152">S’ils ne sont pas connectés, nous les redirigeons vers la page de connexion pour qu’ils puissent se connecter.</span><span class="sxs-lookup"><span data-stu-id="bd489-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="bd489-153">Il est assez facile d’implémenter cette logique.</span><span class="sxs-lookup"><span data-stu-id="bd489-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="bd489-154">Tout ce que nous devons faire, c’est d’ajouter un attribut de filtre [Authorize] à nos méthodes d’action de création, comme suit :</span><span class="sxs-lookup"><span data-stu-id="bd489-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="bd489-155">ASP.NET MVC prend en charge la possibilité de créer des « filtres d’action » qui peuvent être utilisés pour implémenter une logique réutilisable qui peut être appliquée de manière déclarative aux méthodes d’action.</span><span class="sxs-lookup"><span data-stu-id="bd489-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="bd489-156">Le filtre [Authorize] est l’un des filtres d’action intégrés fournis par ASP.NET MVC et permet à un développeur d’appliquer de façon déclarative des règles d’autorisation aux méthodes d’action et aux classes de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="bd489-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="bd489-157">Lorsqu’il est appliqué sans aucun paramètre (comme ci-dessus), le filtre [Authorize] impose que l’utilisateur qui effectue la demande de méthode d’action doive être connecté et redirige automatiquement le navigateur vers l’URL de connexion, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="bd489-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="bd489-158">Lors de cette redirection, l’URL demandée à l’origine est transmise en tant qu’argument QueryString (par exemple:/Account/LogOn ? ReturnUrl =% 2fDinners% 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="bd489-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="bd489-159">Le AccountController redirige ensuite l’utilisateur vers l’URL demandée à l’origine une fois qu’il se connecte.</span><span class="sxs-lookup"><span data-stu-id="bd489-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="bd489-160">Le filtre [Authorize] prend éventuellement en charge la possibilité de spécifier une propriété « Users » ou « Roles » qui peut être utilisée pour exiger que l’utilisateur soit à la fois connecté et dans une liste d’utilisateurs autorisés ou membre d’un rôle de sécurité autorisé.</span><span class="sxs-lookup"><span data-stu-id="bd489-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="bd489-161">Par exemple, le code ci-dessous autorise uniquement deux utilisateurs spécifiques, « scottgu » et « billg », à accéder à l’URL/Dinners/Create :</span><span class="sxs-lookup"><span data-stu-id="bd489-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="bd489-162">Toutefois, l’incorporation de noms d’utilisateur spécifiques dans le code a tendance à être plutôt impossible à entretenir.</span><span class="sxs-lookup"><span data-stu-id="bd489-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="bd489-163">Une meilleure approche consiste à définir des « rôles » de niveau supérieur pour la vérification du code, puis à mapper les utilisateurs dans le rôle à l’aide d’une base de données ou d’un système Active Directory (en activant la liste de mappages d’utilisateur réelle à stocker en externe à partir du code).</span><span class="sxs-lookup"><span data-stu-id="bd489-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="bd489-164">ASP.NET inclut une API de gestion des rôles intégrée, ainsi qu’un ensemble intégré de fournisseurs de rôles (y compris ceux pour SQL et Active Directory) qui peuvent aider à effectuer ce mappage utilisateur/rôle.</span><span class="sxs-lookup"><span data-stu-id="bd489-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="bd489-165">Nous pourrions ensuite mettre à jour le code pour permettre uniquement aux utilisateurs d’un rôle « administrateur » spécifique d’accéder à l’URL/Dinners/Create :</span><span class="sxs-lookup"><span data-stu-id="bd489-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="bd489-166">Utilisation de la propriété User.Identity.Name lors de la création de dîners</span><span class="sxs-lookup"><span data-stu-id="bd489-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="bd489-167">Nous pouvons récupérer le nom d’utilisateur de l’utilisateur actuellement connecté à une demande à l’aide de la propriété User.Identity.Name exposée sur la classe de base du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="bd489-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="bd489-168">Plus haut, lorsque nous avons implémenté la version HTTP-POSTÉRIEURe de notre méthode d’action Create (), nous avions codé en dur la propriété « HostedBy » du dîner sur une chaîne statique.</span><span class="sxs-lookup"><span data-stu-id="bd489-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="bd489-169">Nous pouvons maintenant mettre à jour ce code pour utiliser à la place la propriété User.Identity.Name, et ajouter automatiquement une RSVP pour l’hôte qui crée le dîner :</span><span class="sxs-lookup"><span data-stu-id="bd489-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="bd489-170">Étant donné que nous avons ajouté un attribut [Authorize] à la méthode Create (), ASP.NET MVC garantit que la méthode d’action s’exécute uniquement si l’utilisateur visitant l’URL/Dinners/Create est connecté au site.</span><span class="sxs-lookup"><span data-stu-id="bd489-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="bd489-171">Par conséquent, la valeur de la propriété User.Identity.Name contient toujours un nom d’utilisateur valide.</span><span class="sxs-lookup"><span data-stu-id="bd489-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="bd489-172">Utilisation de la propriété User.Identity.Name lors de la modification de dîners</span><span class="sxs-lookup"><span data-stu-id="bd489-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="bd489-173">Nous allons maintenant ajouter une logique d’autorisation qui restreint les utilisateurs afin qu’ils puissent uniquement modifier les propriétés des dîners qu’ils hébergent eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="bd489-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="bd489-174">Pour vous aider, nous allons d’abord ajouter une méthode d’assistance « IsHostedBy (username) » à notre objet dîner (dans la classe partielle Dinner.cs que nous avons créée précédemment).</span><span class="sxs-lookup"><span data-stu-id="bd489-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="bd489-175">Cette méthode d’assistance retourne la valeur true ou false selon que le nom d’utilisateur fourni correspond à la propriété Dinner HostedBy et encapsule la logique nécessaire pour effectuer une comparaison de chaînes ne respectant pas la casse :</span><span class="sxs-lookup"><span data-stu-id="bd489-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="bd489-176">Nous allons ensuite ajouter un attribut [Authorize] aux méthodes d’action Edit () au sein de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="bd489-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="bd489-177">Cela permet de s’assurer que les utilisateurs doivent être connectés pour demander une URL */dinners/Edit/[id]* .</span><span class="sxs-lookup"><span data-stu-id="bd489-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="bd489-178">Nous pouvons ensuite ajouter du code à nos méthodes de modification qui utilisent la méthode d’assistance dinner. IsHostedBy (nom d’utilisateur) pour vérifier que l’utilisateur connecté correspond à l’hôte du dîner.</span><span class="sxs-lookup"><span data-stu-id="bd489-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="bd489-179">Si l’utilisateur n’est pas l’hôte, nous affichons une vue « InvalidOwner » et terminons la demande.</span><span class="sxs-lookup"><span data-stu-id="bd489-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="bd489-180">Le code permettant d’effectuer cette opération ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="bd489-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="bd489-181">Nous pouvons ensuite cliquer avec le bouton droit sur le répertoire \Views\Dinners et choisir la commande de menu Ajouter-&gt;afficher pour créer une nouvelle vue « InvalidOwner ».</span><span class="sxs-lookup"><span data-stu-id="bd489-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="bd489-182">Nous allons le remplir avec le message d’erreur ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="bd489-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="bd489-183">Désormais, lorsqu’un utilisateur tente de modifier un dîner qu’il ne possède pas, un message d’erreur s’affiche :</span><span class="sxs-lookup"><span data-stu-id="bd489-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="bd489-184">Nous pouvons répéter les mêmes étapes pour les méthodes d’action DELETE () au sein de notre contrôleur afin de verrouiller l’autorisation de supprimer les dîners, et vous assurer que seul l’hôte d’un dîner peut le supprimer.</span><span class="sxs-lookup"><span data-stu-id="bd489-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="bd489-185">Montrer/masquer les liens modifier et supprimer</span><span class="sxs-lookup"><span data-stu-id="bd489-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="bd489-186">Nous créons une liaison avec la méthode d’action Edit et Delete de notre classe DinnersController à partir de notre URL de détails :</span><span class="sxs-lookup"><span data-stu-id="bd489-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="bd489-187">Actuellement, nous affichons les liens d’action modifier et supprimer, que le visiteur de l’URL des détails soit l’hôte du dîner.</span><span class="sxs-lookup"><span data-stu-id="bd489-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="bd489-188">Nous allons modifier cela afin que les liens ne s’affichent que si l’utilisateur visiteur est le propriétaire du dîner.</span><span class="sxs-lookup"><span data-stu-id="bd489-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="bd489-189">La méthode d’action Details () dans notre DinnersController récupère un objet Dinner, puis le passe en tant qu’objet de modèle à notre modèle de vue :</span><span class="sxs-lookup"><span data-stu-id="bd489-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="bd489-190">Nous pouvons mettre à jour notre modèle de vue pour afficher ou masquer de manière conditionnelle les liens modifier et supprimer à l’aide de la méthode d’assistance dinner. IsHostedBy (), comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="bd489-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="bd489-191">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bd489-191">Next Steps</span></span>

<span data-ttu-id="bd489-192">Voyons maintenant comment nous pouvons permettre aux utilisateurs authentifiés de répondre aux dîners à l’aide d’AJAX.</span><span class="sxs-lookup"><span data-stu-id="bd489-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="bd489-193">[Précédent](implement-efficient-data-paging.md)
> [Suivant](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="bd489-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
