---
uid: mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-cs
title: Création de Tests unitaires pour les Applications ASP.NET MVC (c#) | Microsoft Docs
author: StephenWalther
description: Découvrez comment créer des tests unitaires pour les actions de contrôleur. Dans ce didacticiel, Stephen Walther montre comment tester si une action de contrôleur retourne une section...
ms.author: riande
ms.date: 08/19/2008
ms.assetid: d3a270b9-d7b1-47f2-8775-fc3beb518b5c
msc.legacyurl: /mvc/overview/older-versions-1/unit-testing/creating-unit-tests-for-asp-net-mvc-applications-cs
msc.type: authoredcontent
ms.openlocfilehash: 633e28a100937c5d40d62fe5cc151e613171cc8f
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65126881"
---
# <a name="creating-unit-tests-for-aspnet-mvc-applications-c"></a><span data-ttu-id="1e59e-104">Création de tests unitaires pour les applications ASP.NET MVC (C#)</span><span class="sxs-lookup"><span data-stu-id="1e59e-104">Creating Unit Tests for ASP.NET MVC Applications (C#)</span></span>

<span data-ttu-id="1e59e-105">par [Stephen Walther](https://github.com/StephenWalther)</span><span class="sxs-lookup"><span data-stu-id="1e59e-105">by [Stephen Walther](https://github.com/StephenWalther)</span></span>

[<span data-ttu-id="1e59e-106">Télécharger PDF</span><span class="sxs-lookup"><span data-stu-id="1e59e-106">Download PDF</span></span>](http://download.microsoft.com/download/8/4/8/84843d8d-1575-426c-bcb5-9d0c42e51416/ASPNET_MVC_Tutorial_07_CS.pdf)

> <span data-ttu-id="1e59e-107">Découvrez comment créer des tests unitaires pour les actions de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-107">Learn how to create unit tests for controller actions.</span></span> <span data-ttu-id="1e59e-108">Dans ce didacticiel, Stephen Walther montre comment tester si une action de contrôleur retourne une vue particulière, retourne un jeu de données particulier ou retourne un autre type de résultat d’action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-108">In this tutorial, Stephen Walther demonstrates how to test whether a controller action returns a particular view, returns a particular set of data, or returns a different type of action result.</span></span>

<span data-ttu-id="1e59e-109">L’objectif de ce didacticiel consiste à montrer comment vous pouvez écrire des tests unitaires pour les contrôleurs dans votre ASP.NET MVC applications.</span><span class="sxs-lookup"><span data-stu-id="1e59e-109">The goal of this tutorial is to demonstrate how you can write unit tests for the controllers in your ASP.NET MVC applications.</span></span> <span data-ttu-id="1e59e-110">Explique comment créer trois différents types de tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="1e59e-110">We discuss how to build three different types of unit tests.</span></span> <span data-ttu-id="1e59e-111">Vous découvrez comment tester la vue retournée par une action de contrôleur, comment afficher les données retournées par une action de contrôleur de test et comment tester si une action de contrôleur vous redirige vers une deuxième action de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-111">You learn how to test the view returned by a controller action, how to test the View Data returned by a controller action, and how to test whether or not one controller action redirects you to a second controller action.</span></span>

## <a name="creating-the-controller-under-test"></a><span data-ttu-id="1e59e-112">Création du contrôleur de Test</span><span class="sxs-lookup"><span data-stu-id="1e59e-112">Creating the Controller under Test</span></span>

<span data-ttu-id="1e59e-113">Nous allons commencer en créant le contrôleur que nous souhaitons tester.</span><span class="sxs-lookup"><span data-stu-id="1e59e-113">Let's start by creating the controller that we intend to test.</span></span> <span data-ttu-id="1e59e-114">Le contrôleur, nommé le `ProductController`, est contenue dans le Listing 1.</span><span class="sxs-lookup"><span data-stu-id="1e59e-114">The controller, named the `ProductController`, is contained in Listing 1.</span></span>

<span data-ttu-id="1e59e-115">**Liste 1 : `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-115">**Listing 1 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample1.cs)]

<span data-ttu-id="1e59e-116">Le `ProductController` contient deux méthodes d’action nommées `Index()` et `Details()`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-116">The `ProductController` contains two action methods named `Index()` and `Details()`.</span></span> <span data-ttu-id="1e59e-117">Les deux méthodes d’action retournent une vue.</span><span class="sxs-lookup"><span data-stu-id="1e59e-117">Both action methods return a view.</span></span> <span data-ttu-id="1e59e-118">Notez que le `Details()` action accepte un paramètre nommé ID.</span><span class="sxs-lookup"><span data-stu-id="1e59e-118">Notice that the `Details()` action accepts a parameter named Id.</span></span>

## <a name="testing-the-view-returned-by-a-controller"></a><span data-ttu-id="1e59e-119">Test de la vue retournée par un contrôleur</span><span class="sxs-lookup"><span data-stu-id="1e59e-119">Testing the View returned by a Controller</span></span>

<span data-ttu-id="1e59e-120">Imaginez que nous voulons tester ou non la `ProductController` retourne la vue de droite.</span><span class="sxs-lookup"><span data-stu-id="1e59e-120">Imagine that we want to test whether or not the `ProductController` returns the right view.</span></span> <span data-ttu-id="1e59e-121">Nous souhaitons vous assurer qu’au moment où le `ProductController.Details()` action est appelée, la vue de détails est retournée.</span><span class="sxs-lookup"><span data-stu-id="1e59e-121">We want to make sure that when the `ProductController.Details()` action is invoked, the Details view is returned.</span></span> <span data-ttu-id="1e59e-122">La classe de test dans le Listing 2 contient un test unitaire pour tester la vue retournée par la `ProductController.Details()` action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-122">The test class in Listing 2 contains a unit test for testing the view returned by the `ProductController.Details()` action.</span></span>

<span data-ttu-id="1e59e-123">**Listing 2 : `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-123">**Listing 2 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample2.cs)]

<span data-ttu-id="1e59e-124">La classe dans le Listing 2 inclut une méthode de test nommée `TestDetailsView()`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-124">The class in Listing 2 includes a test method named `TestDetailsView()`.</span></span> <span data-ttu-id="1e59e-125">Cette méthode contient trois lignes de code.</span><span class="sxs-lookup"><span data-stu-id="1e59e-125">This method contains three lines of code.</span></span> <span data-ttu-id="1e59e-126">La première ligne de code crée une nouvelle instance de la `ProductController` classe.</span><span class="sxs-lookup"><span data-stu-id="1e59e-126">The first line of code creates a new instance of the `ProductController` class.</span></span> <span data-ttu-id="1e59e-127">La deuxième ligne de code appelle le contrôleur `Details()` méthode d’action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-127">The second line of code invokes the controller's `Details()` action method.</span></span> <span data-ttu-id="1e59e-128">Enfin, la dernière ligne de contrôles du code ou non la vue retournée par la `Details()` action est le mode Détails.</span><span class="sxs-lookup"><span data-stu-id="1e59e-128">Finally, the last line of code checks whether or not the view returned by the `Details()` action is the Details view.</span></span>

<span data-ttu-id="1e59e-129">Le `ViewResult.ViewName` propriété représente le nom de la vue retournée par un contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-129">The `ViewResult.ViewName` property represents the name of the view returned by a controller.</span></span> <span data-ttu-id="1e59e-130">Un avertissement sur le test de cette propriété.</span><span class="sxs-lookup"><span data-stu-id="1e59e-130">One big warning about testing this property.</span></span> <span data-ttu-id="1e59e-131">Il existe deux façons qu’un contrôleur peut retourner une vue.</span><span class="sxs-lookup"><span data-stu-id="1e59e-131">There are two ways that a controller can return a view.</span></span> <span data-ttu-id="1e59e-132">Un contrôleur peut retourner explicitement un affichage semblable à ceci :</span><span class="sxs-lookup"><span data-stu-id="1e59e-132">A controller can explicitly return a view like this:</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample3.cs)]

<span data-ttu-id="1e59e-133">Vous pouvez également le nom de la vue peut être déduit à partir du nom de l’action de contrôleur comme suit :</span><span class="sxs-lookup"><span data-stu-id="1e59e-133">Alternatively, the name of the view can be inferred from the name of the controller action like this:</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample4.cs)]

<span data-ttu-id="1e59e-134">Cette action de contrôleur retourne également une vue nommée `Details`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-134">This controller action also returns a view named `Details`.</span></span> <span data-ttu-id="1e59e-135">Toutefois, le nom de la vue est déduit à partir du nom d’action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-135">However, the name of the view is inferred from the action name.</span></span> <span data-ttu-id="1e59e-136">Si vous souhaitez tester le nom de la vue, vous devez retourner explicitement le nom de la vue à partir de l’action du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-136">If you want to test the view name, then you must explicitly return the view name from the controller action.</span></span>

<span data-ttu-id="1e59e-137">Vous pouvez exécuter le test unitaire dans le Listing 2 soit en entrant la combinaison de touches **Ctrl + R, A** ou en cliquant sur le **exécuter tous les Tests de la Solution** bouton (voir Figure 1).</span><span class="sxs-lookup"><span data-stu-id="1e59e-137">You can run the unit test in Listing 2 by either entering the keyboard combination **Ctrl-R, A** or by clicking the **Run All Tests in Solution** button (see Figure 1).</span></span> <span data-ttu-id="1e59e-138">Si le test réussit, vous verrez la fenêtre Résultats des tests dans la Figure 2.</span><span class="sxs-lookup"><span data-stu-id="1e59e-138">If the test passes, you'll see the Test Results window in Figure 2.</span></span>

<span data-ttu-id="1e59e-139">[![Exécuter tous les Tests dans la Solution](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1e59e-139">[![Run All Tests in Solution](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image2.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image1.png)</span></span>

<span data-ttu-id="1e59e-140">**Figure 01**: Exécuter tous les Tests dans la Solution ([cliquez pour afficher l’image en taille réelle](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="1e59e-140">**Figure 01**: Run All Tests in Solution ([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image3.png))</span></span>

<span data-ttu-id="1e59e-141">[![Succès !](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1e59e-141">[![Success!](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image5.png)](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image4.png)</span></span>

<span data-ttu-id="1e59e-142">**Figure 02**: Opération réussie</span><span class="sxs-lookup"><span data-stu-id="1e59e-142">**Figure 02**: Success!</span></span> <span data-ttu-id="1e59e-143">([Cliquez pour afficher l’image en taille réelle](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1e59e-143">([Click to view full-size image](creating-unit-tests-for-asp-net-mvc-applications-cs/_static/image6.png))</span></span>

## <a name="testing-the-view-data-returned-by-a-controller"></a><span data-ttu-id="1e59e-144">La vue de données de test retourné par un contrôleur</span><span class="sxs-lookup"><span data-stu-id="1e59e-144">Testing the View Data returned by a Controller</span></span>

<span data-ttu-id="1e59e-145">Un contrôleur MVC transmet les données à une vue à l’aide de ce que l'on appelle *`View Data`*.</span><span class="sxs-lookup"><span data-stu-id="1e59e-145">An MVC controller passes data to a view by using something called *`View Data`*.</span></span> <span data-ttu-id="1e59e-146">Par exemple, imaginez que vous souhaitez afficher les détails d’un produit spécifique lorsque vous appelez le `ProductController Details()` action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-146">For example, imagine that you want to display the details for a particular product when you invoke the `ProductController Details()` action.</span></span> <span data-ttu-id="1e59e-147">Dans ce cas, vous pouvez créer une instance d’un `Product` classe (défini dans votre modèle) et passez l’instance à la `Details` vue en tirant parti de `View Data`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-147">In that case, you can create an instance of a `Product` class (defined in your model) and pass the instance to the `Details` view by taking advantage of `View Data`.</span></span>

<span data-ttu-id="1e59e-148">Modifié `ProductController` dans le Listing 3 inclut une mise à jour `Details()` action qui retourne un produit.</span><span class="sxs-lookup"><span data-stu-id="1e59e-148">The modified `ProductController` in Listing 3 includes an updated `Details()` action that returns a Product.</span></span>

<span data-ttu-id="1e59e-149">**Liste 3 : `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-149">**Listing 3 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample5.cs)]

<span data-ttu-id="1e59e-150">Tout d’abord, le `Details()` action crée une nouvelle instance de la `Product` classe qui représente un ordinateur portable.</span><span class="sxs-lookup"><span data-stu-id="1e59e-150">First, the `Details()` action creates a new instance of the `Product` class that represents a laptop computer.</span></span> <span data-ttu-id="1e59e-151">Ensuite, l’instance de la `Product` classe est passée comme deuxième paramètre à la `View()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="1e59e-151">Next, the instance of the `Product` class is passed as the second parameter to the `View()` method.</span></span>

<span data-ttu-id="1e59e-152">Vous pouvez écrire des tests unitaires pour vérifier si les données attendues sont contenue dans la vue données.</span><span class="sxs-lookup"><span data-stu-id="1e59e-152">You can write unit tests to test whether the expected data is contained in view data.</span></span> <span data-ttu-id="1e59e-153">Le test unitaire dans les tests de la liste 4 déterminant si un produit qui représente un ordinateur portable est retourné lorsque vous appelez le `ProductController Details()` méthode d’action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-153">The unit test in Listing 4 tests whether or not a Product representing a laptop computer is returned when you call the `ProductController Details()` action method.</span></span>

<span data-ttu-id="1e59e-154">**Liste 4 – `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-154">**Listing 4 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample6.cs)]

<span data-ttu-id="1e59e-155">Dans la liste 4, le `TestDetailsView()` méthode teste les données d’affichage retournée en appelant le `Details()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="1e59e-155">In Listing 4, the `TestDetailsView()` method tests the View Data returned by invoking the `Details()` method.</span></span> <span data-ttu-id="1e59e-156">Le `ViewData` est exposée en tant que propriété sur le `ViewResult` retournée en appelant le `Details()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="1e59e-156">The `ViewData` is exposed as a property on the `ViewResult` returned by invoking the `Details()` method.</span></span> <span data-ttu-id="1e59e-157">Le `ViewData.Model` propriété contient le produit passé à la vue.</span><span class="sxs-lookup"><span data-stu-id="1e59e-157">The `ViewData.Model` property contains the product passed to the view.</span></span> <span data-ttu-id="1e59e-158">Le test vérifie simplement que le produit contenu dans les données de la vue a le nom d’ordinateur portable.</span><span class="sxs-lookup"><span data-stu-id="1e59e-158">The test simply verifies that the product contained in the View Data has the name Laptop.</span></span>

## <a name="testing-the-action-result-returned-by-a-controller"></a><span data-ttu-id="1e59e-159">Test du résultat d’Action retournée par un contrôleur</span><span class="sxs-lookup"><span data-stu-id="1e59e-159">Testing the Action Result returned by a Controller</span></span>

<span data-ttu-id="1e59e-160">Une action de contrôleur plus complexe pouvant retourner différents types de résultats d’actions en fonction des valeurs des paramètres transmis à l’action du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-160">A more complex controller action might return different types of action results depending on the values of the parameters passed to the controller action.</span></span> <span data-ttu-id="1e59e-161">Une action de contrôleur peut retourner divers types de résultats d’actions, y compris un `ViewResult`, `RedirectToRouteResult`, ou `JsonResult`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-161">A controller action can return a variety of types of action results including a `ViewResult`, `RedirectToRouteResult`, or `JsonResult`.</span></span>

<span data-ttu-id="1e59e-162">Par exemple, la modification `Details()` action dans la liste 5 retourne le `Details` afficher lorsque vous transmettez un Id de produit valide à l’action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-162">For example, the modified `Details()` action in Listing 5 returns the `Details` view when you pass a valid product Id to the action.</span></span> <span data-ttu-id="1e59e-163">Si vous passez un produit non valide Id--un Id avec une valeur inférieure à 1--, puis vous êtes redirigé vers le `Index()` action.</span><span class="sxs-lookup"><span data-stu-id="1e59e-163">If you pass an invalid product Id -- an Id with a value less than 1 -- then you are redirected to the `Index()` action.</span></span>

<span data-ttu-id="1e59e-164">**Liste 5 – `ProductController.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-164">**Listing 5 – `ProductController.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample7.cs)]

<span data-ttu-id="1e59e-165">Vous pouvez tester le comportement de la `Details()` action avec le test unitaire de la liste 6.</span><span class="sxs-lookup"><span data-stu-id="1e59e-165">You can test the behavior of the `Details()` action with the unit test in Listing 6.</span></span> <span data-ttu-id="1e59e-166">Le test unitaire de la liste 6 vérifie que vous êtes redirigé vers la `Index` afficher lorsqu’un Id avec la valeur -1 est passé à la `Details()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="1e59e-166">The unit test in Listing 6 verifies that you are redirected to the `Index` view when an Id with the value -1 is passed to the `Details()` method.</span></span>

<span data-ttu-id="1e59e-167">**Liste 6 : `ProductControllerTest.cs`**</span><span class="sxs-lookup"><span data-stu-id="1e59e-167">**Listing 6 – `ProductControllerTest.cs`**</span></span>

[!code-csharp[Main](creating-unit-tests-for-asp-net-mvc-applications-cs/samples/sample8.cs)]

<span data-ttu-id="1e59e-168">Lorsque vous appelez le `RedirectToAction()` méthode dans une action de contrôleur, l’action du contrôleur retourne un `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-168">When you call the `RedirectToAction()` method in a controller action, the controller action returns a `RedirectToRouteResult`.</span></span> <span data-ttu-id="1e59e-169">Les vérifications de test si le `RedirectToRouteResult` redirige l’utilisateur à une action de contrôleur nommée `Index`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-169">The test checks whether the `RedirectToRouteResult` will redirect the user to a controller action named `Index`.</span></span>

## <a name="summary"></a><span data-ttu-id="1e59e-170">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="1e59e-170">Summary</span></span>

<span data-ttu-id="1e59e-171">Dans ce didacticiel, vous avez appris à créer des tests unitaires pour les actions de contrôleur MVC.</span><span class="sxs-lookup"><span data-stu-id="1e59e-171">In this tutorial, you learned how to build unit tests for MVC controller actions.</span></span> <span data-ttu-id="1e59e-172">Tout d’abord, vous avez appris à vérifier si la vue de droite est retournée par une action de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-172">First, you learned how to verify whether the right view is returned by a controller action.</span></span> <span data-ttu-id="1e59e-173">Vous avez appris comment utiliser le `ViewResult.ViewName` propriété pour vérifier le nom d’une vue.</span><span class="sxs-lookup"><span data-stu-id="1e59e-173">You learned how to use the `ViewResult.ViewName` property to verify the name of a view.</span></span>

<span data-ttu-id="1e59e-174">Ensuite, nous avons examiné comment vous pouvez tester le contenu de `View Data`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-174">Next, we examined how you can test the contents of `View Data`.</span></span> <span data-ttu-id="1e59e-175">Vous avez appris comment vérifier si le produit approprié a été retourné dans `View Data` après l’appel d’une action de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-175">You learned how to check whether the right product was returned in `View Data` after calling a controller action.</span></span>

<span data-ttu-id="1e59e-176">Enfin, nous avons abordé la façon dont vous pouvez tester si les différents types de résultats d’action sont renvoyées à partir d’une action de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="1e59e-176">Finally, we discussed how you can test whether different types of action results are returned from a controller action.</span></span> <span data-ttu-id="1e59e-177">Vous avez appris comment tester si un contrôleur retourne un `ViewResult` ou un `RedirectToRouteResult`.</span><span class="sxs-lookup"><span data-stu-id="1e59e-177">You learned how to test whether a controller returns a `ViewResult` or a `RedirectToRouteResult`.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="1e59e-178">Next</span><span class="sxs-lookup"><span data-stu-id="1e59e-178">Next</span></span>](creating-unit-tests-for-asp-net-mvc-applications-vb.md)
