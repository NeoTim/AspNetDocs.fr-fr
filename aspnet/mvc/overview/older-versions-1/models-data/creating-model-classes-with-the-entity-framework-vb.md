---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
title: Création de classes modèles avec le Cadre d’entités (VB) Microsoft Docs
author: rick-anderson
description: Dans ce tutoriel, vous apprenez à utiliser ASP.NET MVC avec le cadre d’entité Microsoft. Vous apprenez à utiliser l’Assistant d’Entité pour créer une ADO.NET’Entité Da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: ff8322c9-12f3-4e24-aba6-a38046b9bb0d
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-vb
msc.type: authoredcontent
ms.openlocfilehash: cdba91969a6ed9c02965999bbc48d5c5cdea140d
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542649"
---
# <a name="creating-model-classes-with-the-entity-framework-vb"></a><span data-ttu-id="745ce-104">Création de classes de modèle avec Entity Framework (VB)</span><span class="sxs-lookup"><span data-stu-id="745ce-104">Creating Model Classes with the Entity Framework (VB)</span></span>

<span data-ttu-id="745ce-105">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="745ce-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="745ce-106">Dans ce tutoriel, vous apprenez à utiliser ASP.NET MVC avec le cadre d’entité Microsoft.</span><span class="sxs-lookup"><span data-stu-id="745ce-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="745ce-107">Vous apprenez à utiliser l’Assistant d’Entité pour créer un modèle de données d’entité ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="745ce-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="745ce-108">Au cours de ce tutoriel, nous construisons une application Web qui illustre comment sélectionner, insérer, mettre à jour et supprimer les données de base de données en utilisant le cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>

<span data-ttu-id="745ce-109">Le but de ce tutoriel est d’expliquer comment vous pouvez créer des classes d’accès aux données en utilisant le cadre d’entité Microsoft lors de la construction d’une application ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="745ce-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="745ce-110">Ce tutoriel suppose qu’aucune connaissance préalable du cadre d’entité Microsoft.</span><span class="sxs-lookup"><span data-stu-id="745ce-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="745ce-111">À la fin de ce tutoriel, vous comprendrez comment utiliser le cadre d’entité pour sélectionner, insérer, mettre à jour et supprimer les enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="745ce-112">Le cadre d’entité Microsoft est un outil de cartographie relationnelle d’objet (O/RM) qui vous permet de générer automatiquement une couche d’accès aux données à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="745ce-113">Le cadre d’entité vous permet d’éviter le travail fastidieux de construction de vos classes d’accès aux données à la main.</span><span class="sxs-lookup"><span data-stu-id="745ce-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="745ce-114">Il n’y a pas de lien essentiel entre ASP.NET MVC et le cadre d’entité Microsoft.</span><span class="sxs-lookup"><span data-stu-id="745ce-114">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="745ce-115">Il existe plusieurs alternatives au Cadre d’entité que vous pouvez utiliser avec ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="745ce-115">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="745ce-116">Par exemple, vous pouvez créer vos classes de modèles MVC à l’aide d’autres outils O/RM tels que Microsoft LINQ à SQL, NHibernate ou SubSonic.</span><span class="sxs-lookup"><span data-stu-id="745ce-116">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>

<span data-ttu-id="745ce-117">Afin d’illustrer comment vous pouvez utiliser le cadre d’entité Microsoft avec ASP.NET MVC, nous allons construire une application d’échantillon simple.</span><span class="sxs-lookup"><span data-stu-id="745ce-117">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="745ce-118">Nous créerons une application Movie Database qui vous permettra d’afficher et d’éditer des enregistrements de bases de données de films.</span><span class="sxs-lookup"><span data-stu-id="745ce-118">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="745ce-119">Ce tutoriel suppose que vous avez Visual Studio 2008 ou Visual Web Developer 2008 avec Service Pack 1.</span><span class="sxs-lookup"><span data-stu-id="745ce-119">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="745ce-120">Vous avez besoin de Service Pack 1 pour utiliser le cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-120">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="745ce-121">Vous pouvez télécharger Visual Studio 2008 Service Pack 1 ou Visual Web Developer avec Service Pack 1 à partir de l’adresse suivante :</span><span class="sxs-lookup"><span data-stu-id="745ce-121">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="745ce-122">Création de la base de données sur les échantillons de films</span><span class="sxs-lookup"><span data-stu-id="745ce-122">Creating the Movie Sample Database</span></span>

<span data-ttu-id="745ce-123">L’application Movie Database utilise un tableau de base de données nommé Films qui contient les colonnes suivantes :</span><span class="sxs-lookup"><span data-stu-id="745ce-123">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="745ce-124">Nom de la colonne</span><span class="sxs-lookup"><span data-stu-id="745ce-124">Column Name</span></span> | <span data-ttu-id="745ce-125">Type de données</span><span class="sxs-lookup"><span data-stu-id="745ce-125">Data Type</span></span> | <span data-ttu-id="745ce-126">Autoriser Nulls?</span><span class="sxs-lookup"><span data-stu-id="745ce-126">Allow Nulls?</span></span> | <span data-ttu-id="745ce-127">La clé primaire est-elle la clé?</span><span class="sxs-lookup"><span data-stu-id="745ce-127">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="745ce-128">Id</span><span class="sxs-lookup"><span data-stu-id="745ce-128">Id</span></span> | <span data-ttu-id="745ce-129">int</span><span class="sxs-lookup"><span data-stu-id="745ce-129">int</span></span> | <span data-ttu-id="745ce-130">False</span><span class="sxs-lookup"><span data-stu-id="745ce-130">False</span></span> | <span data-ttu-id="745ce-131">True</span><span class="sxs-lookup"><span data-stu-id="745ce-131">True</span></span> |
| <span data-ttu-id="745ce-132">Intitulé</span><span class="sxs-lookup"><span data-stu-id="745ce-132">Title</span></span> | <span data-ttu-id="745ce-133">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="745ce-133">nvarchar(100)</span></span> | <span data-ttu-id="745ce-134">False</span><span class="sxs-lookup"><span data-stu-id="745ce-134">False</span></span> | <span data-ttu-id="745ce-135">False</span><span class="sxs-lookup"><span data-stu-id="745ce-135">False</span></span> |
| <span data-ttu-id="745ce-136">Directeur</span><span class="sxs-lookup"><span data-stu-id="745ce-136">Director</span></span> | <span data-ttu-id="745ce-137">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="745ce-137">nvarchar(100)</span></span> | <span data-ttu-id="745ce-138">False</span><span class="sxs-lookup"><span data-stu-id="745ce-138">False</span></span> | <span data-ttu-id="745ce-139">False</span><span class="sxs-lookup"><span data-stu-id="745ce-139">False</span></span> |

<span data-ttu-id="745ce-140">Vous pouvez ajouter cette table à un projet MVC ASP.NET en suivant ces étapes :</span><span class="sxs-lookup"><span data-stu-id="745ce-140">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="745ce-141">Cliquez à droite\_sur le dossier App Data dans la fenêtre Solution Explorer et sélectionnez l’option menu **Ajouter, Nouvel article.**</span><span class="sxs-lookup"><span data-stu-id="745ce-141">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="745ce-142">À partir de la boîte de dialogue **Add New Item,** sélectionnez **SQL Server Database**, donnez à la base de données le nom MoviesDB.mdf et cliquez sur le bouton **Ajouter.**</span><span class="sxs-lookup"><span data-stu-id="745ce-142">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="745ce-143">Double-cliquez sur le fichier MoviesDB.mdf pour ouvrir la fenêtre Server Explorer/Database Explorer.</span><span class="sxs-lookup"><span data-stu-id="745ce-143">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="745ce-144">Élargissez la connexion de base de données MoviesDB.mdf, cliquez à droite sur le dossier Tables et sélectionnez l’option menu **Ajouter une nouvelle table**.</span><span class="sxs-lookup"><span data-stu-id="745ce-144">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="745ce-145">Dans le concepteur de table, ajoutez les colonnes Id, Titre et Directeur.</span><span class="sxs-lookup"><span data-stu-id="745ce-145">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="745ce-146">Cliquez sur le bouton **Enregistrer** (il a l’icône de la disquette) pour enregistrer la nouvelle table avec le nom Films.</span><span class="sxs-lookup"><span data-stu-id="745ce-146">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="745ce-147">Après avoir créé la table de base de données Movies, vous devez ajouter des données d’exemple à la table.</span><span class="sxs-lookup"><span data-stu-id="745ce-147">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="745ce-148">Cliquez à droite sur la table Films et sélectionnez l’option menu **Afficher les données de table**.</span><span class="sxs-lookup"><span data-stu-id="745ce-148">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="745ce-149">Vous pouvez saisir de fausses données de film dans la grille qui apparaît.</span><span class="sxs-lookup"><span data-stu-id="745ce-149">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="745ce-150">Création du modèle de données ADO.NET entity</span><span class="sxs-lookup"><span data-stu-id="745ce-150">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="745ce-151">Afin d’utiliser le cadre d’entité, vous devez créer un modèle de données d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-151">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="745ce-152">Vous pouvez profiter de *l’assistant modèle* de données Visual Studio Entity pour générer automatiquement un modèle de données d’entité à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-152">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="745ce-153">Procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="745ce-153">Follow these steps:</span></span>

1. <span data-ttu-id="745ce-154">Cliquez à droite sur le dossier Modèles dans la fenêtre Solution Explorer et sélectionnez l’option menu **Ajouter, Nouvel article**.</span><span class="sxs-lookup"><span data-stu-id="745ce-154">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="745ce-155">Dans le dialogue **Add New Item,** sélectionnez la catégorie Données (voir la figure 1).</span><span class="sxs-lookup"><span data-stu-id="745ce-155">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="745ce-156">Sélectionnez le modèle **ADO.NET modèle de modèle de données d’entité,** donnez au modèle de données d’entité le nom MoviesDBModel.edmx, et cliquez sur le bouton **Ajouter.**</span><span class="sxs-lookup"><span data-stu-id="745ce-156">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="745ce-157">En cliquant sur le bouton **Ajouter,** le modèle de données Wizard lance l’assistant de modèle de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-157">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="745ce-158">Dans l’étape Choisissez le **contenu du modèle,** choisissez le **Générer à partir d’une** option de base de données et cliquez sur le bouton **Suivant** (voir la figure 2).</span><span class="sxs-lookup"><span data-stu-id="745ce-158">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="745ce-159">Dans l’étape **Choisissez votre connexion de données,** sélectionnez la connexion de base de données MoviesDB.mdf, entrez les paramètres de connexion des entités nom de FilmsDBEntities et cliquez sur le bouton **Suivant** (voir la figure 3).</span><span class="sxs-lookup"><span data-stu-id="745ce-159">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="745ce-160">Dans l’étape **Choisissez vos objets de base de données,** sélectionnez la table de base de données Movie et cliquez sur le bouton **Finition** (voir la figure 4).</span><span class="sxs-lookup"><span data-stu-id="745ce-160">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="745ce-161">Après avoir terminé ces étapes, le ADO.NET Entity Data Model Designer (Entity Designer) s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="745ce-161">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="745ce-162">**Figure 1 - Création d’un nouveau modèle de données d’entité**</span><span class="sxs-lookup"><span data-stu-id="745ce-162">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-vb/_static/image1.jpg)

<span data-ttu-id="745ce-164">**Figure 2 - Choisissez l’étape du contenu du modèle**</span><span class="sxs-lookup"><span data-stu-id="745ce-164">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-vb/_static/image2.jpg)

<span data-ttu-id="745ce-166">**Figure 3 - Choisissez votre connexion de données**</span><span class="sxs-lookup"><span data-stu-id="745ce-166">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-vb/_static/image3.jpg)

<span data-ttu-id="745ce-168">**Figure 4 - Choisissez vos objets de base de données**</span><span class="sxs-lookup"><span data-stu-id="745ce-168">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-vb/_static/image4.jpg)

## <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="745ce-170">Modification du modèle de données ADO.NET entité</span><span class="sxs-lookup"><span data-stu-id="745ce-170">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="745ce-171">Après avoir créé un modèle de données d’entité, vous pouvez modifier le modèle en profitant du concepteur d’entités (voir la figure 5).</span><span class="sxs-lookup"><span data-stu-id="745ce-171">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="745ce-172">Vous pouvez ouvrir le concepteur d’entités à tout moment en cliquant à deux reprises sur le fichier MoviesDBModel.edmx contenu dans le dossier Models dans la fenêtre Solution Explorer.</span><span class="sxs-lookup"><span data-stu-id="745ce-172">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="745ce-173">**Figure 5 - Le concepteur de modèle de données de l’entité ADO.NET**</span><span class="sxs-lookup"><span data-stu-id="745ce-173">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-vb/_static/image5.jpg)

<span data-ttu-id="745ce-175">Par exemple, vous pouvez utiliser le concepteur d’entités pour modifier les noms des classes générées par l’Assistant de Données Du Modèle d’Entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-175">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="745ce-176">Le Magicien a créé une nouvelle classe d’accès aux données nommée Movies.</span><span class="sxs-lookup"><span data-stu-id="745ce-176">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="745ce-177">En d’autres termes, l’Assistant a donné à la classe le même nom que la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-177">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="745ce-178">Parce que nous allons utiliser cette classe pour représenter une instance de film particulier, nous devrions renommer la classe de films à film.</span><span class="sxs-lookup"><span data-stu-id="745ce-178">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="745ce-179">Si vous souhaitez renommer une classe d’entités, vous pouvez cliquer deux fois sur le nom de la classe dans le concepteur d’entités et entrer un nouveau nom (voir la figure 6).</span><span class="sxs-lookup"><span data-stu-id="745ce-179">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="745ce-180">Alternativement, vous pouvez changer le nom d’une entité dans la fenêtre Propriétés après avoir sélectionné une entité dans le concepteur d’entités.</span><span class="sxs-lookup"><span data-stu-id="745ce-180">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="745ce-181">**Figure 6 - Changer un nom d’entité**</span><span class="sxs-lookup"><span data-stu-id="745ce-181">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-vb/_static/image6.jpg)

<span data-ttu-id="745ce-183">N’oubliez pas d’enregistrer votre modèle de données d’entité après avoir apporté une modification en cliquant sur le bouton Enregistrer (l’icône du disque disquette).</span><span class="sxs-lookup"><span data-stu-id="745ce-183">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="745ce-184">Dans les coulisses, le concepteur d’entités génère un ensemble de classes Visual Basic .NET.</span><span class="sxs-lookup"><span data-stu-id="745ce-184">Behind the scenes, the Entity Designer generates a set of Visual Basic .NET classes.</span></span> <span data-ttu-id="745ce-185">Vous pouvez consulter ces classes en ouvrant le fichier MoviesDBModel.Designer.vb depuis la fenêtre Solution Explorer.</span><span class="sxs-lookup"><span data-stu-id="745ce-185">You can view these classes by opening the MoviesDBModel.Designer.vb file from the Solution Explorer window.</span></span>

<span data-ttu-id="745ce-186">Ne modifiez pas le code dans le fichier Designer.vb puisque vos modifications seront écrasées la prochaine fois que vous utiliserez le concepteur d’entités.</span><span class="sxs-lookup"><span data-stu-id="745ce-186">Don't modify the code in the Designer.vb file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="745ce-187">Si vous souhaitez étendre la fonctionnalité des classes d’entité définies dans le fichier Designer.vb, vous pouvez créer *des classes partielles* dans des fichiers distincts.</span><span class="sxs-lookup"><span data-stu-id="745ce-187">If you want to extend the functionality of the entity classes defined in the Designer.vb file then you can create *partial classes* in separate files.</span></span>

#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="745ce-188">Sélection des enregistrements de bases de données avec le Cadre d’entité</span><span class="sxs-lookup"><span data-stu-id="745ce-188">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="745ce-189">Commençons à construire notre application Movie Database en créant une page qui affiche une liste de disques.</span><span class="sxs-lookup"><span data-stu-id="745ce-189">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="745ce-190">Le contrôleur à domicile dans la liste 1 expose une action nommée Index().</span><span class="sxs-lookup"><span data-stu-id="745ce-190">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="745ce-191">L’action Index() renvoie tous les enregistrements de films à partir de la table de base de données Movie en profitant du cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-191">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="745ce-192">**Liste 1 - Controllers-HomeController.vb**</span><span class="sxs-lookup"><span data-stu-id="745ce-192">**Listing 1 – Controllers\HomeController.vb**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample1.vb)]

<span data-ttu-id="745ce-193">Notez que le contrôleur dans la liste 1 inclut un constructeur.</span><span class="sxs-lookup"><span data-stu-id="745ce-193">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="745ce-194">Le constructeur initialise un champ de \_classe nommé db.</span><span class="sxs-lookup"><span data-stu-id="745ce-194">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="745ce-195">Le \_champ db représente les entités de base de données générées par le cadre d’entité Microsoft.</span><span class="sxs-lookup"><span data-stu-id="745ce-195">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="745ce-196">Le \_champ db est un exemple de la classe MoviesDBEntities qui a été généré par le concepteur d’entités.</span><span class="sxs-lookup"><span data-stu-id="745ce-196">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>

<span data-ttu-id="745ce-197">Le \_champ db est utilisé dans l’action Index() pour récupérer les enregistrements de la table de base de données Movies.</span><span class="sxs-lookup"><span data-stu-id="745ce-197">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="745ce-198">L’expression \_db. MovieSet représente tous les enregistrements de la table de base de données Movies.</span><span class="sxs-lookup"><span data-stu-id="745ce-198">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="745ce-199">La méthode ToList() est utilisée pour convertir l’ensemble de films en une collection générique d’objets movie: List ( Of Movie).</span><span class="sxs-lookup"><span data-stu-id="745ce-199">The ToList() method is used to convert the set of movies into a generic collection of Movie objects: List( Of Movie).</span></span>

<span data-ttu-id="745ce-200">Les enregistrements du film sont récupérés avec l’aide de LINQ aux entités.</span><span class="sxs-lookup"><span data-stu-id="745ce-200">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="745ce-201">L’action Index() dans La liste 1 utilise *la syntaxe de méthode* LINQ pour récupérer l’ensemble des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-201">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="745ce-202">Si vous préférez, vous pouvez utiliser la *syntaxe de requête* LINQ à la place.</span><span class="sxs-lookup"><span data-stu-id="745ce-202">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="745ce-203">Les deux déclarations suivantes font la même chose :</span><span class="sxs-lookup"><span data-stu-id="745ce-203">The following two statements do the very same thing:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample2.vb)]

<span data-ttu-id="745ce-204">Utilisez la syntaxe LINQ - syntaxe de méthode ou syntaxe de requête - que vous trouvez la plus intuitive.</span><span class="sxs-lookup"><span data-stu-id="745ce-204">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="745ce-205">Il n’y a pas de différence de performance entre les deux approches - la seule différence est le style.</span><span class="sxs-lookup"><span data-stu-id="745ce-205">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="745ce-206">La vue dans La liste 2 est utilisée pour afficher les enregistrements du film.</span><span class="sxs-lookup"><span data-stu-id="745ce-206">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="745ce-207">**Liste 2 - Views-Home.Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="745ce-207">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample3.aspx)]

<span data-ttu-id="745ce-208">La vue dans Listing 2 contient une boucle **pour chaque** film qui itère à travers chaque album de film et affiche les valeurs des propriétés titre et réalisateur de l’enregistrement du film.</span><span class="sxs-lookup"><span data-stu-id="745ce-208">The view in Listing 2 contains a **For Each** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="745ce-209">Notez qu’un lien Edit and Delete s’affiche à côté de chaque enregistrement.</span><span class="sxs-lookup"><span data-stu-id="745ce-209">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="745ce-210">De plus, un lien Add Movie apparaît au bas de la vue (voir la figure 7).</span><span class="sxs-lookup"><span data-stu-id="745ce-210">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="745ce-211">**Figure 7 - La vue de l’indice**</span><span class="sxs-lookup"><span data-stu-id="745ce-211">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-vb/_static/image7.jpg)

<span data-ttu-id="745ce-213">La vue index est une *vue dactylographe*.</span><span class="sxs-lookup"><span data-stu-id="745ce-213">The Index view is a *typed view*.</span></span> <span data-ttu-id="745ce-214">L’avis de &lt;l’indice&gt; comporte une directive de % et de pourcentage de pages qui comprend un attribut Héritière.</span><span class="sxs-lookup"><span data-stu-id="745ce-214">The Index view has a &lt;%@ Page %&gt; directive that includes an Inherits attribute.</span></span> <span data-ttu-id="745ce-215">L’attribut Inherits jette la propriété ViewData.Model à une collection de listes génériques fortement dactylographiées d’objets movie - une liste (Of Movie).</span><span class="sxs-lookup"><span data-stu-id="745ce-215">The Inherits attribute casts the ViewData.Model property to a strongly typed generic List collection of Movie objects – a List(Of Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="745ce-216">Insérer les enregistrements de bases de données avec le Cadre d’entité</span><span class="sxs-lookup"><span data-stu-id="745ce-216">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="745ce-217">Vous pouvez utiliser le cadre d’entité pour faciliter l’insertion de nouveaux enregistrements dans une table de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-217">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="745ce-218">La liste 3 contient deux nouvelles actions ajoutées à la classe de contrôleur d’accueil que vous pouvez utiliser pour insérer de nouveaux enregistrements dans le tableau de base de données Movie.</span><span class="sxs-lookup"><span data-stu-id="745ce-218">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="745ce-219">**Liste 3 - Controllers-HomeController.vb (Méthodes d’ajout)**</span><span class="sxs-lookup"><span data-stu-id="745ce-219">**Listing 3 – Controllers\HomeController.vb (Add methods)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample4.vb)]

<span data-ttu-id="745ce-220">La première action Add() renvoie simplement une vue.</span><span class="sxs-lookup"><span data-stu-id="745ce-220">The first Add() action simply returns a view.</span></span> <span data-ttu-id="745ce-221">La vue contient un formulaire pour l’ajout d’un nouvel enregistrement de base de données de films (voir la figure 8).</span><span class="sxs-lookup"><span data-stu-id="745ce-221">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="745ce-222">Lorsque vous soumettez le formulaire, la deuxième action Add() est invoquée.</span><span class="sxs-lookup"><span data-stu-id="745ce-222">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="745ce-223">Notez que la deuxième action Add() est décorée avec l’attribut AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="745ce-223">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="745ce-224">Cette action ne peut être invoquée que lors de l’exécution d’une opération HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="745ce-224">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="745ce-225">En d’autres termes, cette action ne peut être invoquée que lors de l’affichage d’un formulaire HTML.</span><span class="sxs-lookup"><span data-stu-id="745ce-225">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="745ce-226">La deuxième action Add() crée une nouvelle instance de la classe de film-cadre d’entité avec l’aide de la méthode ASP.NET MVC TryUpdateModel() .</span><span class="sxs-lookup"><span data-stu-id="745ce-226">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="745ce-227">La méthode TryUpdateModel() prend les champs dans la FormCollection passé à la méthode Add() et attribue les valeurs de ces champs de forme HTML à la classe de film.</span><span class="sxs-lookup"><span data-stu-id="745ce-227">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>

<span data-ttu-id="745ce-228">Lorsque vous utilisez le cadre d’entité, vous devez fournir une « liste blanche » de propriétés lors de l’utilisation des méthodes TryUpdateModel ou UpdateModel pour mettre à jour les propriétés d’une classe d’entités.</span><span class="sxs-lookup"><span data-stu-id="745ce-228">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>

<span data-ttu-id="745ce-229">Ensuite, l’action Add() effectue une validation de formulaire simple.</span><span class="sxs-lookup"><span data-stu-id="745ce-229">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="745ce-230">L’action vérifie que les propriétés Titre et Directeur ont des valeurs.</span><span class="sxs-lookup"><span data-stu-id="745ce-230">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="745ce-231">S’il y a une erreur de validation, un message d’erreur de validation est ajouté à ModelState.</span><span class="sxs-lookup"><span data-stu-id="745ce-231">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="745ce-232">S’il n’y a pas d’erreurs de validation, un nouvel enregistrement de film est ajouté à la table de base de données Movies avec l’aide du cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-232">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="745ce-233">Le nouvel enregistrement est ajouté à la base de données avec les deux lignes de code suivantes :</span><span class="sxs-lookup"><span data-stu-id="745ce-233">The new record is added to the database with the following two lines of code:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample5.vb)]

<span data-ttu-id="745ce-234">La première ligne de code ajoute la nouvelle entité Movie à l’ensemble de films suivis par le Cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="745ce-234">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="745ce-235">La deuxième ligne de code enregistre les modifications apportées aux films qui sont suivis vers la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="745ce-235">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="745ce-236">**Figure 8 - La vue Add**</span><span class="sxs-lookup"><span data-stu-id="745ce-236">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-vb/_static/image8.jpg)

## <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="745ce-238">Mise à jour des dossiers de base de données avec le Cadre d’entité</span><span class="sxs-lookup"><span data-stu-id="745ce-238">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="745ce-239">Vous pouvez suivre presque la même approche pour modifier un enregistrement de base de données avec le cadre d’entité que l’approche que nous venons de suivre pour insérer un nouvel enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-239">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="745ce-240">La liste 4 contient deux nouvelles actions de contrôleur nommées Edit().</span><span class="sxs-lookup"><span data-stu-id="745ce-240">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="745ce-241">La première action Edit() renvoie un formulaire HTML pour l’édition d’un disque de film.</span><span class="sxs-lookup"><span data-stu-id="745ce-241">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="745ce-242">La deuxième action Edit() tente de mettre à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-242">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="745ce-243">**Liste 4 - Controllers-HomeController.vb (Méthodes d’édition)**</span><span class="sxs-lookup"><span data-stu-id="745ce-243">**Listing 4 – Controllers\HomeController.vb (Edit methods)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample6.vb)]

<span data-ttu-id="745ce-244">La deuxième action Edit() commence par récupérer l’enregistrement du film à partir de la base de données qui correspond à l’id du film en cours d’édition.</span><span class="sxs-lookup"><span data-stu-id="745ce-244">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="745ce-245">La déclaration SUIVANTE de LINQ aux entités saisit le premier enregistrement de base de données qui correspond à une id particulière :</span><span class="sxs-lookup"><span data-stu-id="745ce-245">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample7.vb)]

<span data-ttu-id="745ce-246">Ensuite, la méthode TryUpdateModel() est utilisée pour attribuer les valeurs des champs de formulaires HTML aux propriétés de l’entité cinématographique.</span><span class="sxs-lookup"><span data-stu-id="745ce-246">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="745ce-247">Notez qu’une liste blanche est fournie pour spécifier les propriétés exactes à mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="745ce-247">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="745ce-248">Ensuite, une simple validation est effectuée pour vérifier que les propriétés du titre du film et du réalisateur ont des valeurs.</span><span class="sxs-lookup"><span data-stu-id="745ce-248">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="745ce-249">Si l’une ou l’autre propriété manque une valeur, alors un message d’erreur de validation est ajouté à ModelState et ModelState.IsValid retourne la valeur fausse.</span><span class="sxs-lookup"><span data-stu-id="745ce-249">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="745ce-250">Enfin, s’il n’y a pas d’erreurs de validation, le tableau de base de données Movies sous-jacent est mis à jour avec des modifications en appelant la méthode SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="745ce-250">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="745ce-251">Lors de l’édition des enregistrements de base de données, vous devez passer l’id de l’enregistrement en cours de modification à l’action du contrôleur qui effectue la mise à jour de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-251">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="745ce-252">Dans le cas contraire, l’action du contrôleur ne saura pas quel enregistrement mettre à jour dans la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="745ce-252">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="745ce-253">La vue Edit, contenue dans la liste 5, comprend un champ de formulaire caché qui représente l’id de l’enregistrement de base de données en cours de modification.</span><span class="sxs-lookup"><span data-stu-id="745ce-253">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="745ce-254">**Liste 5 - Views-Home-Edit.aspx**</span><span class="sxs-lookup"><span data-stu-id="745ce-254">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="745ce-255">Suppression des dossiers de base de données avec le Cadre d’entité</span><span class="sxs-lookup"><span data-stu-id="745ce-255">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="745ce-256">L’opération de base de données finale, que nous devons aborder dans ce tutoriel, est la suppression des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-256">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="745ce-257">Vous pouvez utiliser l’action du contrôleur dans la liste 6 pour supprimer un enregistrement de base de données particulier.</span><span class="sxs-lookup"><span data-stu-id="745ce-257">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="745ce-258">**Liste 6 -- 'Controllers’HomeController.vb (Supprimer l’action)**</span><span class="sxs-lookup"><span data-stu-id="745ce-258">**Listing 6 -- \Controllers\HomeController.vb (Delete action)**</span></span>

[!code-vb[Main](creating-model-classes-with-the-entity-framework-vb/samples/sample9.vb)]

<span data-ttu-id="745ce-259">L’action Supprimer() récupère d’abord l’entité Movie qui correspond à l’Id passé à l’action.</span><span class="sxs-lookup"><span data-stu-id="745ce-259">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="745ce-260">Ensuite, le film est supprimé de la base de données en appelant la méthode DeleteObject() suivie par la méthode SaveChanges().</span><span class="sxs-lookup"><span data-stu-id="745ce-260">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="745ce-261">Enfin, l’utilisateur est redirigé vers la vue Index.</span><span class="sxs-lookup"><span data-stu-id="745ce-261">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="745ce-262">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="745ce-262">Summary</span></span>

<span data-ttu-id="745ce-263">Le but de ce tutoriel était de démontrer comment vous pouvez construire des applications Web axées sur les bases de données en profitant de ASP.NET MVC et le cadre d’entité Microsoft.</span><span class="sxs-lookup"><span data-stu-id="745ce-263">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="745ce-264">Vous avez appris à créer une application qui vous permet de sélectionner, d’insérer, de mettre à jour et de supprimer les enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-264">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="745ce-265">Tout d’abord, nous avons discuté de la façon dont vous pouvez utiliser l’Assistant modèle de données d’entité pour générer un modèle de données d’entité à partir de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="745ce-265">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="745ce-266">Ensuite, vous apprenez à utiliser LINQ pour les entités pour récupérer un ensemble d’enregistrements de base de données à partir d’une table de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-266">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="745ce-267">Enfin, nous avons utilisé le cadre d’entité pour insérer, mettre à jour et supprimer les enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="745ce-267">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="745ce-268">[Suivant précédent](validation-with-the-data-annotation-validators-cs.md)
> [Next](creating-model-classes-with-linq-to-sql-vb.md)</span><span class="sxs-lookup"><span data-stu-id="745ce-268">[Previous](validation-with-the-data-annotation-validators-cs.md)
[Next](creating-model-classes-with-linq-to-sql-vb.md)</span></span>
