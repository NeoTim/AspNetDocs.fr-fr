---
uid: mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
title: Création de classes de modèle avec leC#Entity Framework () | Microsoft Docs
author: microsoft
description: Dans ce didacticiel, vous allez apprendre à utiliser ASP.NET MVC avec Microsoft Entity Framework. Vous allez apprendre à utiliser l’Assistant entité pour créer une entité ADO.NET da...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 61644169-e8b1-45dd-bf96-9c2301b69879
msc.legacyurl: /mvc/overview/older-versions-1/models-data/creating-model-classes-with-the-entity-framework-cs
msc.type: authoredcontent
ms.openlocfilehash: 2e0e365c287fc455015d237ea466301335805d14
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78581164"
---
# <a name="creating-model-classes-with-the-entity-framework-c"></a><span data-ttu-id="ab321-104">Création de classes de modèle avec Entity Framework (C#)</span><span class="sxs-lookup"><span data-stu-id="ab321-104">Creating Model Classes with the Entity Framework (C#)</span></span>

<span data-ttu-id="ab321-105">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="ab321-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="ab321-106">Dans ce didacticiel, vous allez apprendre à utiliser ASP.NET MVC avec Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-106">In this tutorial, you learn how to use ASP.NET MVC with the Microsoft Entity Framework.</span></span> <span data-ttu-id="ab321-107">Vous allez apprendre à utiliser l’Assistant entité pour créer une Entity Data Model ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="ab321-107">You learn how to use the Entity Wizard to create an ADO.NET Entity Data Model.</span></span> <span data-ttu-id="ab321-108">Au cours de ce didacticiel, nous créons une application Web qui illustre comment sélectionner, insérer, mettre à jour et supprimer des données de base de données à l’aide de l’Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-108">Over the course of this tutorial, we build a web application that illustrates how to select, insert, update, and delete database data by using the Entity Framework.</span></span>

<span data-ttu-id="ab321-109">L’objectif de ce didacticiel est d’expliquer comment vous pouvez créer des classes d’accès aux données à l’aide de l’Entity Framework Microsoft lors de la création d’une application MVC ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ab321-109">The goal of this tutorial is to explain how you can create data access classes using the Microsoft Entity Framework when building an ASP.NET MVC application.</span></span> <span data-ttu-id="ab321-110">Ce didacticiel ne suppose aucune connaissance préalable de la Entity Framework Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ab321-110">This tutorial assumes no previous knowledge of the Microsoft Entity Framework.</span></span> <span data-ttu-id="ab321-111">À la fin de ce didacticiel, vous comprendrez comment utiliser l’Entity Framework pour sélectionner, insérer, mettre à jour et supprimer des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-111">By the end of this tutorial, you'll understand how to use the Entity Framework to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="ab321-112">Le Entity Framework Microsoft est un outil de mappage relationnel d’objets (O/RM) qui vous permet de générer automatiquement une couche d’accès aux données à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-112">The Microsoft Entity Framework is an Object Relational Mapping (O/RM) tool that enables you to generate a data access layer from a database automatically.</span></span> <span data-ttu-id="ab321-113">Le Entity Framework vous permet d’éviter le travail fastidieux de création de vos classes d’accès aux données à la main.</span><span class="sxs-lookup"><span data-stu-id="ab321-113">The Entity Framework enables you to avoid the tedious work of building your data access classes by hand.</span></span>

<span data-ttu-id="ab321-114">Pour illustrer la façon dont vous pouvez utiliser Microsoft Entity Framework avec ASP.NET MVC, nous allons créer un exemple d’application simple.</span><span class="sxs-lookup"><span data-stu-id="ab321-114">In order to illustrate how you can use the Microsoft Entity Framework with ASP.NET MVC, we'll build a simple sample application.</span></span> <span data-ttu-id="ab321-115">Nous allons créer une application de base de données de films qui vous permet d’afficher et de modifier les enregistrements de base de données de films.</span><span class="sxs-lookup"><span data-stu-id="ab321-115">We'll create a Movie Database application that enables you to display and edit movie database records.</span></span>

<span data-ttu-id="ab321-116">Ce didacticiel part du principe que vous disposez de Visual Studio 2008 ou Visual Web Developer 2008 avec Service Pack 1.</span><span class="sxs-lookup"><span data-stu-id="ab321-116">This tutorial assumes that you have Visual Studio 2008 or Visual Web Developer 2008 with Service Pack 1.</span></span> <span data-ttu-id="ab321-117">Vous avez besoin du Service Pack 1 pour pouvoir utiliser le Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-117">You need Service Pack 1 in order to use the Entity Framework.</span></span> <span data-ttu-id="ab321-118">Vous pouvez télécharger Visual Studio 2008 Service Pack 1 ou Visual Web Developer avec Service Pack 1 à partir de l’adresse suivante :</span><span class="sxs-lookup"><span data-stu-id="ab321-118">You can download Visual Studio 2008 Service Pack 1 or Visual Web Developer with Service Pack 1 from the following address:</span></span>

> [https://www.asp.net/downloads/](https://www.asp.net/downloads)

> [!NOTE] 
> 
> <span data-ttu-id="ab321-119">Il n’existe pas de connexion essentielle entre ASP.NET MVC et le Entity Framework Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ab321-119">There is no essential connection between ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="ab321-120">Il existe plusieurs alternatives au Entity Framework que vous pouvez utiliser avec ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="ab321-120">There are several alternatives to the Entity Framework that you can use with ASP.NET MVC.</span></span> <span data-ttu-id="ab321-121">Par exemple, vous pouvez créer vos classes de modèle MVC à l’aide d’autres outils O/RM tels que Microsoft LINQ to SQL, NHibernate ou Subsonic.</span><span class="sxs-lookup"><span data-stu-id="ab321-121">For example, you can build your MVC Model classes using other O/RM tools such as Microsoft LINQ to SQL, NHibernate, or SubSonic.</span></span>

## <a name="creating-the-movie-sample-database"></a><span data-ttu-id="ab321-122">Création de l’exemple de base de données Movie</span><span class="sxs-lookup"><span data-stu-id="ab321-122">Creating the Movie Sample Database</span></span>

<span data-ttu-id="ab321-123">L’application de base de données Movie utilise une table de base de données nommée movies qui contient les colonnes suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab321-123">The Movie Database application uses a database table named Movies that contains the following columns:</span></span>

| <span data-ttu-id="ab321-124">Nom de la colonne</span><span class="sxs-lookup"><span data-stu-id="ab321-124">Column Name</span></span> | <span data-ttu-id="ab321-125">Type de données</span><span class="sxs-lookup"><span data-stu-id="ab321-125">Data Type</span></span> | <span data-ttu-id="ab321-126">Autoriser les valeurs null ?</span><span class="sxs-lookup"><span data-stu-id="ab321-126">Allow Nulls?</span></span> | <span data-ttu-id="ab321-127">Est une clé primaire ?</span><span class="sxs-lookup"><span data-stu-id="ab321-127">Is Primary Key?</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ab321-128">Id</span><span class="sxs-lookup"><span data-stu-id="ab321-128">Id</span></span> | <span data-ttu-id="ab321-129">int</span><span class="sxs-lookup"><span data-stu-id="ab321-129">int</span></span> | <span data-ttu-id="ab321-130">False</span><span class="sxs-lookup"><span data-stu-id="ab321-130">False</span></span> | <span data-ttu-id="ab321-131">True</span><span class="sxs-lookup"><span data-stu-id="ab321-131">True</span></span> |
| <span data-ttu-id="ab321-132">Titre</span><span class="sxs-lookup"><span data-stu-id="ab321-132">Title</span></span> | <span data-ttu-id="ab321-133">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="ab321-133">nvarchar(100)</span></span> | <span data-ttu-id="ab321-134">False</span><span class="sxs-lookup"><span data-stu-id="ab321-134">False</span></span> | <span data-ttu-id="ab321-135">False</span><span class="sxs-lookup"><span data-stu-id="ab321-135">False</span></span> |
| <span data-ttu-id="ab321-136">Directeur</span><span class="sxs-lookup"><span data-stu-id="ab321-136">Director</span></span> | <span data-ttu-id="ab321-137">nvarchar(100)</span><span class="sxs-lookup"><span data-stu-id="ab321-137">nvarchar(100)</span></span> | <span data-ttu-id="ab321-138">False</span><span class="sxs-lookup"><span data-stu-id="ab321-138">False</span></span> | <span data-ttu-id="ab321-139">False</span><span class="sxs-lookup"><span data-stu-id="ab321-139">False</span></span> |

<span data-ttu-id="ab321-140">Vous pouvez ajouter cette table à un projet MVC ASP.NET en procédant comme suit :</span><span class="sxs-lookup"><span data-stu-id="ab321-140">You can add this table to an ASP.NET MVC project by following these steps:</span></span>

1. <span data-ttu-id="ab321-141">Cliquez avec le bouton droit sur le dossier de données de l’application\_dans la fenêtre Explorateur de solutions et sélectionnez l’option de menu **Ajouter, nouvel élément.**</span><span class="sxs-lookup"><span data-stu-id="ab321-141">Right-click the App\_Data folder in the Solution Explorer window and select the menu option **Add, New Item.**</span></span>
2. <span data-ttu-id="ab321-142">Dans la boîte de dialogue **Ajouter un nouvel élément** , sélectionnez **SQL Server base de données**, nommez la base de données MoviesDB. mdf, puis cliquez sur le bouton **Ajouter** .</span><span class="sxs-lookup"><span data-stu-id="ab321-142">From the **Add New Item** dialog box, select **SQL Server Database**, give the database the name MoviesDB.mdf, and click the **Add** button.</span></span>
3. <span data-ttu-id="ab321-143">Double-cliquez sur le fichier MoviesDB. mdf pour ouvrir la fenêtre Explorateur de serveurs/explorateur de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-143">Double-click the MoviesDB.mdf file to open the Server Explorer/Database Explorer window.</span></span>
4. <span data-ttu-id="ab321-144">Développez la connexion à la base de données MoviesDB. mdf, cliquez avec le bouton droit sur le dossier tables, puis sélectionnez l’option de menu **Ajouter une nouvelle table**.</span><span class="sxs-lookup"><span data-stu-id="ab321-144">Expand the MoviesDB.mdf database connection, right-click the Tables folder, and select the menu option **Add New Table**.</span></span>
5. <span data-ttu-id="ab321-145">Dans la Concepteur de tables, ajoutez les colonnes ID, title et Director.</span><span class="sxs-lookup"><span data-stu-id="ab321-145">In the Table Designer, add the Id, Title, and Director columns.</span></span>
6. <span data-ttu-id="ab321-146">Cliquez sur le bouton **Enregistrer** (l’icône de la disquette) pour enregistrer la nouvelle table avec le nom films.</span><span class="sxs-lookup"><span data-stu-id="ab321-146">Click the **Save** button (it has the icon of the floppy) to save the new table with the name Movies.</span></span>

<span data-ttu-id="ab321-147">Après avoir créé la table de base de données movies, vous devez ajouter des exemples de données à la table.</span><span class="sxs-lookup"><span data-stu-id="ab321-147">After you create the Movies database table, you should add some sample data to the table.</span></span> <span data-ttu-id="ab321-148">Cliquez avec le bouton droit sur le tableau films et sélectionnez l’option de menu **afficher les données**de la table.</span><span class="sxs-lookup"><span data-stu-id="ab321-148">Right-click the Movies table and select the menu option **Show Table Data**.</span></span> <span data-ttu-id="ab321-149">Vous pouvez entrer des données factices dans la grille qui s’affiche.</span><span class="sxs-lookup"><span data-stu-id="ab321-149">You can enter fake movie data into the grid that appears.</span></span>

## <a name="creating-the-adonet-entity-data-model"></a><span data-ttu-id="ab321-150">Création du Entity Data Model ADO.NET</span><span class="sxs-lookup"><span data-stu-id="ab321-150">Creating the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="ab321-151">Pour utiliser le Entity Framework, vous devez créer une Entity Data Model.</span><span class="sxs-lookup"><span data-stu-id="ab321-151">In order to use the Entity Framework, you need to create an Entity Data Model.</span></span> <span data-ttu-id="ab321-152">Vous pouvez tirer parti de l' *assistant Entity Data Model* de Visual Studio pour générer automatiquement un Entity Data Model à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-152">You can take advantage of the Visual Studio *Entity Data Model Wizard* to generate an Entity Data Model from a database automatically.</span></span>

<span data-ttu-id="ab321-153">Procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="ab321-153">Follow these steps:</span></span>

1. <span data-ttu-id="ab321-154">Cliquez avec le bouton droit sur le dossier modèles dans la fenêtre Explorateur de solutions et sélectionnez l’option de menu **Ajouter, nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="ab321-154">Right-click the Models folder in the Solution Explorer window and select the menu option **Add, New Item**.</span></span>
2. <span data-ttu-id="ab321-155">Dans la boîte de dialogue **Ajouter un nouvel élément** , sélectionnez la catégorie de données (voir la figure 1).</span><span class="sxs-lookup"><span data-stu-id="ab321-155">In the **Add New Item** dialog, select the Data category (see Figure 1).</span></span>
3. <span data-ttu-id="ab321-156">Sélectionnez le modèle **ADO.NET Entity Data Model** , attribuez au Entity Data Model le nom MoviesDBModel. edmx, puis cliquez sur le bouton **Ajouter** .</span><span class="sxs-lookup"><span data-stu-id="ab321-156">Select the **ADO.NET Entity Data Model** template, give the Entity Data Model the name MoviesDBModel.edmx, and click the **Add** button.</span></span> <span data-ttu-id="ab321-157">Cliquez sur le bouton **Ajouter** pour lancer l’Assistant modèle de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-157">Clicking the **Add** button launches the Data Model Wizard.</span></span>
4. <span data-ttu-id="ab321-158">Dans l’étape **choisir le contenu du modèle** , choisissez l’option **générer à partir d’une base de données** , puis cliquez sur le bouton **suivant** (voir figure 2).</span><span class="sxs-lookup"><span data-stu-id="ab321-158">In the **Choose Model Contents** step, choose the **Generate from a database** option and click the **Next** button (see Figure 2).</span></span>
5. <span data-ttu-id="ab321-159">Dans l’étape **choisir votre connexion de données** , sélectionnez la connexion à la base de données MoviesDB. mdf, entrez le nom des paramètres de connexion des entités MoviesDBEntities, puis cliquez sur le bouton **suivant** (voir figure 3).</span><span class="sxs-lookup"><span data-stu-id="ab321-159">In the **Choose Your Data Connection** step, select the MoviesDB.mdf database connection, enter the entities connection settings name MoviesDBEntities, and click the **Next** button (see Figure 3).</span></span>
6. <span data-ttu-id="ab321-160">Dans l’étape **choisir vos objets de base de données** , sélectionnez la table de base de données de films, puis cliquez sur le bouton **Terminer** (voir figure 4).</span><span class="sxs-lookup"><span data-stu-id="ab321-160">In the **Choose Your Database Objects** step, select the Movie database table and click the **Finish** button (see Figure 4).</span></span>

<span data-ttu-id="ab321-161">Une fois ces étapes terminées, le ADO.NET Entity Data Model Designer (Entity Designer) s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="ab321-161">After you complete these steps, the ADO.NET Entity Data Model Designer (Entity Designer) opens.</span></span>

<span data-ttu-id="ab321-162">**Figure 1 : création d’un Entity Data Model**</span><span class="sxs-lookup"><span data-stu-id="ab321-162">**Figure 1 – Creating a new Entity Data Model**</span></span>

![clip_image002](creating-model-classes-with-the-entity-framework-cs/_static/image1.jpg)

<span data-ttu-id="ab321-164">**Figure 2 – étape choisir le contenu du modèle**</span><span class="sxs-lookup"><span data-stu-id="ab321-164">**Figure 2 – Choose Model Contents Step**</span></span>

![clip_image004](creating-model-classes-with-the-entity-framework-cs/_static/image2.jpg)

<span data-ttu-id="ab321-166">**Figure 3 – choisir votre connexion de données**</span><span class="sxs-lookup"><span data-stu-id="ab321-166">**Figure 3 – Choose Your Data Connection**</span></span>

![clip_image006](creating-model-classes-with-the-entity-framework-cs/_static/image3.jpg)

<span data-ttu-id="ab321-168">**Figure 4 – choisir vos objets de base de données**</span><span class="sxs-lookup"><span data-stu-id="ab321-168">**Figure 4 – Choose Your Database Objects**</span></span>

![clip_image008](creating-model-classes-with-the-entity-framework-cs/_static/image4.jpg)

#### <a name="modifying-the-adonet-entity-data-model"></a><span data-ttu-id="ab321-170">Modification de la Entity Data Model ADO.NET</span><span class="sxs-lookup"><span data-stu-id="ab321-170">Modifying the ADO.NET Entity Data Model</span></span>

<span data-ttu-id="ab321-171">Après avoir créé une Entity Data Model, vous pouvez modifier le modèle en tirant parti de la Entity Designer (voir figure 5).</span><span class="sxs-lookup"><span data-stu-id="ab321-171">After you create an Entity Data Model, you can modify the model by taking advantage of the Entity Designer (see Figure 5).</span></span> <span data-ttu-id="ab321-172">Vous pouvez ouvrir le Entity Designer à tout moment en double-cliquant sur le fichier MoviesDBModel. edmx contenu dans le dossier modèles dans la fenêtre de Explorateur de solutions.</span><span class="sxs-lookup"><span data-stu-id="ab321-172">You can open the Entity Designer at any time by double-clicking the MoviesDBModel.edmx file contained in the Models folder within the Solution Explorer window.</span></span>

<span data-ttu-id="ab321-173">**Figure 5 : ADO.NET Entity Data Model Designer**</span><span class="sxs-lookup"><span data-stu-id="ab321-173">**Figure 5 – The ADO.NET Entity Data Model Designer**</span></span>

![clip_image010](creating-model-classes-with-the-entity-framework-cs/_static/image5.jpg)

<span data-ttu-id="ab321-175">Par exemple, vous pouvez utiliser la Entity Designer pour modifier les noms des classes générées par l’Assistant données de modèle d’entité.</span><span class="sxs-lookup"><span data-stu-id="ab321-175">For example, you can use the Entity Designer to change the names of the classes that the Entity Model Data Wizard generates.</span></span> <span data-ttu-id="ab321-176">L’Assistant a créé une nouvelle classe d’accès aux données nommée movies.</span><span class="sxs-lookup"><span data-stu-id="ab321-176">The Wizard created a new data access class named Movies.</span></span> <span data-ttu-id="ab321-177">En d’autres termes, l’Assistant a donné à la classe le nom identique à celui de la table de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-177">In other words, the Wizard gave the class the very same name as the database table.</span></span> <span data-ttu-id="ab321-178">Étant donné que nous allons utiliser cette classe pour représenter une instance de film particulière, nous devons renommer la classe films en film.</span><span class="sxs-lookup"><span data-stu-id="ab321-178">Because we will use this class to represent a particular Movie instance, we should rename the class from Movies to Movie.</span></span>

<span data-ttu-id="ab321-179">Si vous souhaitez renommer une classe d’entité, vous pouvez double-cliquer sur le nom de la classe dans la Entity Designer et entrer un nouveau nom (voir figure 6).</span><span class="sxs-lookup"><span data-stu-id="ab321-179">If you want to rename an entity class, you can double-click on the class name in the Entity Designer and enter a new name (see Figure 6).</span></span> <span data-ttu-id="ab321-180">Vous pouvez également modifier le nom d’une entité dans le Fenêtre Propriétés après avoir sélectionné une entité dans le Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="ab321-180">Alternatively, you can change the name of an entity in the Properties window after selecting an entity in the Entity Designer.</span></span>

<span data-ttu-id="ab321-181">**Figure 6 – modification d’un nom d’entité**</span><span class="sxs-lookup"><span data-stu-id="ab321-181">**Figure 6 – Changing an entity name**</span></span>

![clip_image012](creating-model-classes-with-the-entity-framework-cs/_static/image6.jpg)

<span data-ttu-id="ab321-183">N’oubliez pas d’enregistrer votre Entity Data Model après avoir apporté une modification en cliquant sur le bouton Enregistrer (l’icône de la disquette).</span><span class="sxs-lookup"><span data-stu-id="ab321-183">Remember to save your Entity Data Model after making a modification by clicking the Save button (the icon of the floppy disk).</span></span> <span data-ttu-id="ab321-184">En arrière-plan, le Entity Designer génère un ensemble C# de classes.</span><span class="sxs-lookup"><span data-stu-id="ab321-184">Behind the scenes, the Entity Designer generates a set of C# classes.</span></span> <span data-ttu-id="ab321-185">Vous pouvez afficher ces classes en ouvrant le fichier MoviesDBModel.Designer.cs à partir de la fenêtre Explorateur de solutions.</span><span class="sxs-lookup"><span data-stu-id="ab321-185">You can view these classes by opening the MoviesDBModel.Designer.cs file from the Solution Explorer window.</span></span>

<span data-ttu-id="ab321-186">Ne modifiez pas le code dans le fichier Designer.cs, car vos modifications seront remplacées la prochaine fois que vous utiliserez la Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="ab321-186">Don't modify the code in the Designer.cs file since your changes will be overwritten the next time you use the Entity Designer.</span></span> <span data-ttu-id="ab321-187">Si vous souhaitez étendre les fonctionnalités des classes d’entité définies dans le fichier Designer.cs, vous pouvez créer des *classes partielles* dans des fichiers distincts.</span><span class="sxs-lookup"><span data-stu-id="ab321-187">If you want to extend the functionality of the entity classes defined in the Designer.cs file then you can create *partial classes* in separate files.</span></span>

#### <a name="selecting-database-records-with-the-entity-framework"></a><span data-ttu-id="ab321-188">Sélection des enregistrements de base de données avec le Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ab321-188">Selecting Database Records with the Entity Framework</span></span>

<span data-ttu-id="ab321-189">Commençons à créer notre application de base de données de films en créant une page qui affiche une liste d’enregistrements de films.</span><span class="sxs-lookup"><span data-stu-id="ab321-189">Let's start building our Movie Database application by creating a page that displays a list of movie records.</span></span> <span data-ttu-id="ab321-190">Le contrôleur d’hébergement de la liste 1 expose une action nommée index ().</span><span class="sxs-lookup"><span data-stu-id="ab321-190">The Home controller in Listing 1 exposes an action named Index().</span></span> <span data-ttu-id="ab321-191">L’action index () retourne tous les enregistrements de films à partir de la table de base de données de films en tirant parti de la Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-191">The Index() action returns all of the movie records from the Movie database table by taking advantage of the Entity Framework.</span></span>

<span data-ttu-id="ab321-192">**Liste 1 – Controllers\HomeController.cs**</span><span class="sxs-lookup"><span data-stu-id="ab321-192">**Listing 1 – Controllers\HomeController.cs**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample1.cs)]

<span data-ttu-id="ab321-193">Notez que le contrôleur de la liste 1 comprend un constructeur.</span><span class="sxs-lookup"><span data-stu-id="ab321-193">Notice that the controller in Listing 1 includes a constructor.</span></span> <span data-ttu-id="ab321-194">Le constructeur initialise un champ au niveau de la classe nommé \_DB.</span><span class="sxs-lookup"><span data-stu-id="ab321-194">The constructor initializes a class-level field named \_db.</span></span> <span data-ttu-id="ab321-195">Le champ \_DB représente les entités de base de données générées par le Entity Framework Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ab321-195">The \_db field represents the database entities generated by the Microsoft Entity Framework.</span></span> <span data-ttu-id="ab321-196">Le champ \_DB est une instance de la classe MoviesDBEntities qui a été générée par l’Entity Designer.</span><span class="sxs-lookup"><span data-stu-id="ab321-196">The \_db field is an instance of the MoviesDBEntities class that was generated by the Entity Designer.</span></span>

<span data-ttu-id="ab321-197">Pour pouvoir utiliser la classe theMoviesDBEntities dans le contrôleur d’hébergement, vous devez importer l’espace de noms MovieEntityApp. Models (*MVCProjectName*. Modèles).</span><span class="sxs-lookup"><span data-stu-id="ab321-197">In order to use theMoviesDBEntities class in the Home controller, you must import the MovieEntityApp.Models namespace (*MVCProjectName*.Models).</span></span>

<span data-ttu-id="ab321-198">Le champ \_DB est utilisé dans l’action index () pour récupérer les enregistrements de la table de base de données movies.</span><span class="sxs-lookup"><span data-stu-id="ab321-198">The \_db field is used within the Index() action to retrieve the records from the Movies database table.</span></span> <span data-ttu-id="ab321-199">Expression \_DB. MovieSet représente tous les enregistrements de la table de base de données de films.</span><span class="sxs-lookup"><span data-stu-id="ab321-199">The expression \_db.MovieSet represents all of the records from the Movies database table.</span></span> <span data-ttu-id="ab321-200">La méthode ToList () est utilisée pour convertir l’ensemble de films en une collection générique d’objets Movie (List&lt;Movie&gt;).</span><span class="sxs-lookup"><span data-stu-id="ab321-200">The ToList() method is used to convert the set of movies into a generic collection of Movie objects (List&lt;Movie&gt;).</span></span>

<span data-ttu-id="ab321-201">Les enregistrements de film sont extraits avec l’aide de LINQ to Entities.</span><span class="sxs-lookup"><span data-stu-id="ab321-201">The movie records are retrieved with the help of LINQ to Entities.</span></span> <span data-ttu-id="ab321-202">L’action index () dans la liste 1 utilise la *syntaxe de méthode* LINQ pour récupérer le jeu d’enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-202">The Index() action in Listing 1 uses LINQ *method syntax* to retrieve the set of database records.</span></span> <span data-ttu-id="ab321-203">Si vous préférez, vous pouvez utiliser la *syntaxe de requête* LINQ à la place.</span><span class="sxs-lookup"><span data-stu-id="ab321-203">If you prefer, you can use LINQ *query syntax* instead.</span></span> <span data-ttu-id="ab321-204">Les deux instructions suivantes font la même chose :</span><span class="sxs-lookup"><span data-stu-id="ab321-204">The following two statements do the very same thing:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample2.cs)]

<span data-ttu-id="ab321-205">Utilisez la syntaxe LINQ (syntaxe de méthode ou syntaxe de requête) la plus intuitive.</span><span class="sxs-lookup"><span data-stu-id="ab321-205">Use whichever LINQ syntax – method syntax or query syntax – that you find most intuitive.</span></span> <span data-ttu-id="ab321-206">Il n’existe aucune différence de performances entre les deux approches : la seule différence est le style.</span><span class="sxs-lookup"><span data-stu-id="ab321-206">There is no difference in performance between the two approaches – the only difference is style.</span></span>

<span data-ttu-id="ab321-207">La vue dans la liste 2 est utilisée pour afficher les enregistrements de film.</span><span class="sxs-lookup"><span data-stu-id="ab321-207">The view in Listing 2 is used to display the movie records.</span></span>

<span data-ttu-id="ab321-208">**Liste 2 – Views\Home\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="ab321-208">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample3.aspx)]

<span data-ttu-id="ab321-209">La vue de la liste 2 contient une boucle **foreach** qui itère au sein de chaque enregistrement de film et affiche les valeurs des propriétés Title et Director de l’enregistrement de film.</span><span class="sxs-lookup"><span data-stu-id="ab321-209">The view in Listing 2 contains a **foreach** loop that iterates through each movie record and displays the values of the movie record's Title and Director properties.</span></span> <span data-ttu-id="ab321-210">Notez qu’un lien modifier et supprimer est affiché en regard de chaque enregistrement.</span><span class="sxs-lookup"><span data-stu-id="ab321-210">Notice that an Edit and Delete link is displayed next to each record.</span></span> <span data-ttu-id="ab321-211">En outre, un lien ajouter un film s’affiche au bas de la vue (voir la figure 7).</span><span class="sxs-lookup"><span data-stu-id="ab321-211">Furthermore, an Add Movie link appears at the bottom of the view (see Figure 7).</span></span>

<span data-ttu-id="ab321-212">**Figure 7 : vue index**</span><span class="sxs-lookup"><span data-stu-id="ab321-212">**Figure 7 – The Index view**</span></span>

![clip_image014](creating-model-classes-with-the-entity-framework-cs/_static/image7.jpg)

<span data-ttu-id="ab321-214">La vue index est une *vue typée*.</span><span class="sxs-lookup"><span data-stu-id="ab321-214">The Index view is a *typed view*.</span></span> <span data-ttu-id="ab321-215">La vue index comprend une directive &lt;% @ page%&gt; avec un attribut *Inherits* qui effectue un cast de la propriété Model en une collection générique fortement typée d’objets Movie (List&lt;Movie).</span><span class="sxs-lookup"><span data-stu-id="ab321-215">The Index view includes a &lt;%@ Page %&gt; directive with an *Inherits* attribute that casts the Model property to a strongly typed generic List collection of Movie objects (List&lt;Movie).</span></span>

## <a name="inserting-database-records-with-the-entity-framework"></a><span data-ttu-id="ab321-216">Insertion d’enregistrements de base de données avec le Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ab321-216">Inserting Database Records with the Entity Framework</span></span>

<span data-ttu-id="ab321-217">Vous pouvez utiliser la Entity Framework pour faciliter l’insertion de nouveaux enregistrements dans une table de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-217">You can use the Entity Framework to make it easy to insert new records into a database table.</span></span> <span data-ttu-id="ab321-218">La liste 3 contient deux nouvelles actions ajoutées à la classe de contrôleur d’hébergement que vous pouvez utiliser pour insérer de nouveaux enregistrements dans la table de base de données de films.</span><span class="sxs-lookup"><span data-stu-id="ab321-218">Listing 3 contains two new actions added to the Home controller class that you can use to insert new records into the Movie database table.</span></span>

<span data-ttu-id="ab321-219">**Liste 3 – Controllers\HomeController.cs (ajouter des méthodes)**</span><span class="sxs-lookup"><span data-stu-id="ab321-219">**Listing 3 – Controllers\HomeController.cs (Add methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample4.cs)]

<span data-ttu-id="ab321-220">La première action Add () retourne simplement une vue.</span><span class="sxs-lookup"><span data-stu-id="ab321-220">The first Add() action simply returns a view.</span></span> <span data-ttu-id="ab321-221">La vue contient un formulaire pour l’ajout d’un nouvel enregistrement de base de données de films (voir figure 8).</span><span class="sxs-lookup"><span data-stu-id="ab321-221">The view contains a form for adding a new movie database record (see Figure 8).</span></span> <span data-ttu-id="ab321-222">Lorsque vous envoyez le formulaire, la deuxième action Add () est appelée.</span><span class="sxs-lookup"><span data-stu-id="ab321-222">When you submit the form, the second Add() action is invoked.</span></span>

<span data-ttu-id="ab321-223">Notez que la deuxième action Add () est décorée avec l’attribut AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="ab321-223">Notice that the second Add() action is decorated with the AcceptVerbs attribute.</span></span> <span data-ttu-id="ab321-224">Cette action ne peut être appelée que lors de l’exécution d’une opération HTTP après.</span><span class="sxs-lookup"><span data-stu-id="ab321-224">This action can be invoked only when performing an HTTP POST operation.</span></span> <span data-ttu-id="ab321-225">En d’autres termes, cette action ne peut être appelée que lors de la publication d’un formulaire HTML.</span><span class="sxs-lookup"><span data-stu-id="ab321-225">In other words, this action can only be invoked when posting an HTML form.</span></span>

<span data-ttu-id="ab321-226">La deuxième action Add () crée une nouvelle instance de la classe Entity Framework Movie avec l’aide de la méthode ASP.NET MVC TryUpdateModel ().</span><span class="sxs-lookup"><span data-stu-id="ab321-226">The second Add() action creates a new instance of the Entity Framework Movie class with the help of the ASP.NET MVC TryUpdateModel() method.</span></span> <span data-ttu-id="ab321-227">La méthode TryUpdateModel () prend les champs du FormCollection transmis à la méthode Add () et assigne les valeurs de ces champs de formulaire HTML à la classe Movie.</span><span class="sxs-lookup"><span data-stu-id="ab321-227">The TryUpdateModel() method takes the fields in the FormCollection passed to the Add() method and assigns the values of these HTML form fields to the Movie class.</span></span>

<span data-ttu-id="ab321-228">Lorsque vous utilisez Entity Framework, vous devez fournir une « liste verte » des propriétés lorsque vous utilisez les méthodes TryUpdateModel ou UpdateModel pour mettre à jour les propriétés d’une classe d’entité.</span><span class="sxs-lookup"><span data-stu-id="ab321-228">When using the Entity Framework, you must supply a "white list" of properties when using the TryUpdateModel or UpdateModel methods to update the properties of an entity class.</span></span>

<span data-ttu-id="ab321-229">Ensuite, l’action Add () effectue une validation de formulaire simple.</span><span class="sxs-lookup"><span data-stu-id="ab321-229">Next, the Add() action performs some simple form validation.</span></span> <span data-ttu-id="ab321-230">L’action vérifie que les propriétés Title et Director ont des valeurs.</span><span class="sxs-lookup"><span data-stu-id="ab321-230">The action verifies that both the Title and Director properties have values.</span></span> <span data-ttu-id="ab321-231">En cas d’erreur de validation, un message d’erreur de validation est ajouté à ModelState.</span><span class="sxs-lookup"><span data-stu-id="ab321-231">If there is a validation error, then a validation error message is added to ModelState.</span></span>

<span data-ttu-id="ab321-232">S’il n’y a pas d’erreurs de validation, un nouvel enregistrement de film est ajouté à la table de base de données de films avec l’aide de l’Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-232">If there are no validation errors then a new movie record is added to the Movies database table with the help of the Entity Framework.</span></span> <span data-ttu-id="ab321-233">Le nouvel enregistrement est ajouté à la base de données avec les deux lignes de code suivantes :</span><span class="sxs-lookup"><span data-stu-id="ab321-233">The new record is added to the database with the following two lines of code:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample5.cs)]

<span data-ttu-id="ab321-234">La première ligne de code ajoute la nouvelle entité Movie à l’ensemble des films suivis par le Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="ab321-234">The first line of code adds the new Movie entity to the set of movies being tracked by the Entity Framework.</span></span> <span data-ttu-id="ab321-235">La deuxième ligne de code enregistre toutes les modifications apportées aux films faisant l’objet d’un suivi dans la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="ab321-235">The second line of code saves whatever changes have been made to the Movies being tracked back to the underlying database.</span></span>

<span data-ttu-id="ab321-236">**Figure 8 – Ajout d’une vue**</span><span class="sxs-lookup"><span data-stu-id="ab321-236">**Figure 8 – The Add view**</span></span>

![clip_image016](creating-model-classes-with-the-entity-framework-cs/_static/image8.jpg)

#### <a name="updating-database-records-with-the-entity-framework"></a><span data-ttu-id="ab321-238">Mise à jour des enregistrements de base de données avec le Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ab321-238">Updating Database Records with the Entity Framework</span></span>

<span data-ttu-id="ab321-239">Vous pouvez suivre presque la même approche pour modifier un enregistrement de base de données avec le Entity Framework que l’approche que nous venons de suivre pour insérer un nouvel enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-239">You can follow almost the same approach to edit a database record with the Entity Framework as the approach that we just followed to insert a new database record.</span></span> <span data-ttu-id="ab321-240">La liste 4 contient deux nouvelles actions de contrôleur nommées modifier ().</span><span class="sxs-lookup"><span data-stu-id="ab321-240">Listing 4 contains two new controller actions named Edit().</span></span> <span data-ttu-id="ab321-241">La première action Edit () retourne un formulaire HTML pour la modification d’un enregistrement de film.</span><span class="sxs-lookup"><span data-stu-id="ab321-241">The first Edit() action returns an HTML form for editing a movie record.</span></span> <span data-ttu-id="ab321-242">La deuxième action de modification () tente de mettre à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-242">The second Edit() action attempts to update the database.</span></span>

<span data-ttu-id="ab321-243">**Liste 4 – Controllers\HomeController.cs (méthodes de modification)**</span><span class="sxs-lookup"><span data-stu-id="ab321-243">**Listing 4 – Controllers\HomeController.cs (Edit methods)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample6.cs)]

<span data-ttu-id="ab321-244">La deuxième action Edit () commence par récupérer l’enregistrement Movie de la base de données qui correspond à l’ID du film en cours de modification.</span><span class="sxs-lookup"><span data-stu-id="ab321-244">The second Edit() action starts by retrieving the Movie record from the database that matches the Id of the movie being edited.</span></span> <span data-ttu-id="ab321-245">L’instruction LINQ to Entities suivante récupère le premier enregistrement de base de données qui correspond à un ID particulier :</span><span class="sxs-lookup"><span data-stu-id="ab321-245">The following LINQ to Entities statement grabs the first database record that matches a particular Id:</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample7.cs)]

<span data-ttu-id="ab321-246">Ensuite, la méthode TryUpdateModel () est utilisée pour assigner les valeurs des champs de formulaire HTML aux propriétés de l’entité Movie.</span><span class="sxs-lookup"><span data-stu-id="ab321-246">Next, the TryUpdateModel() method is used to assign the values of the HTML form fields to the properties of the movie entity.</span></span> <span data-ttu-id="ab321-247">Notez qu’une liste verte est fournie pour spécifier les propriétés exactes à mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="ab321-247">Notice that a white list is supplied to specify the exact properties to update.</span></span>

<span data-ttu-id="ab321-248">Ensuite, une validation simple est effectuée pour vérifier que les propriétés titre du film et directeur ont des valeurs.</span><span class="sxs-lookup"><span data-stu-id="ab321-248">Next, some simple validation is performed to verify that both the Movie Title and Director properties have values.</span></span> <span data-ttu-id="ab321-249">Si une valeur est manquante pour une propriété, un message d’erreur de validation est ajouté à ModelState et ModelState. IsValid retourne la valeur false.</span><span class="sxs-lookup"><span data-stu-id="ab321-249">If either property is missing a value, then a validation error message is added to ModelState and ModelState.IsValid returns the value false.</span></span>

<span data-ttu-id="ab321-250">Enfin, s’il n’y a aucune erreur de validation, la table de base de données de films sous-jacente est mise à jour avec toutes les modifications en appelant la méthode SaveChanges ().</span><span class="sxs-lookup"><span data-stu-id="ab321-250">Finally, if there are no validation errors, then the underlying Movies database table is updated with any changes by calling the SaveChanges() method.</span></span>

<span data-ttu-id="ab321-251">Lorsque vous modifiez des enregistrements de base de données, vous devez transmettre l’ID de l’enregistrement en cours de modification à l’action du contrôleur qui effectue la mise à jour de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-251">When editing database records, you need to pass the Id of the record being edited to the controller action that performs the database update.</span></span> <span data-ttu-id="ab321-252">Dans le cas contraire, l’action du contrôleur ne saura pas quel enregistrement mettre à jour dans la base de données sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="ab321-252">Otherwise, the controller action will not know which record to update in the underlying database.</span></span> <span data-ttu-id="ab321-253">La vue Edit, contenue dans la liste 5, comprend un champ de formulaire masqué qui représente l’ID de l’enregistrement de base de données en cours de modification.</span><span class="sxs-lookup"><span data-stu-id="ab321-253">The Edit view, contained in Listing 5, includes a hidden form field that represents the Id of the database record being edited.</span></span>

<span data-ttu-id="ab321-254">**Liste 5 – Views\Home\Edit.aspx**</span><span class="sxs-lookup"><span data-stu-id="ab321-254">**Listing 5 – Views\Home\Edit.aspx**</span></span>

[!code-aspx[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample8.aspx)]

## <a name="deleting-database-records-with-the-entity-framework"></a><span data-ttu-id="ab321-255">Suppression des enregistrements de base de données avec le Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ab321-255">Deleting Database Records with the Entity Framework</span></span>

<span data-ttu-id="ab321-256">La dernière opération de base de données, que nous devons aborder dans ce didacticiel, consiste à supprimer les enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-256">The final database operation, which we need to tackle in this tutorial, is deleting database records.</span></span> <span data-ttu-id="ab321-257">Vous pouvez utiliser l’action contrôleur dans la liste 6 pour supprimer un enregistrement de base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="ab321-257">You can use the controller action in Listing 6 to delete a particular database record.</span></span>

<span data-ttu-id="ab321-258">**Liste 6--\Controllers\HomeController.cs (action de suppression)**</span><span class="sxs-lookup"><span data-stu-id="ab321-258">**Listing 6 -- \Controllers\HomeController.cs (Delete action)**</span></span>

[!code-csharp[Main](creating-model-classes-with-the-entity-framework-cs/samples/sample9.cs)]

<span data-ttu-id="ab321-259">L’action DELETE () récupère d’abord l’entité Movie qui correspond à l’ID passé à l’action.</span><span class="sxs-lookup"><span data-stu-id="ab321-259">The Delete() action first retrieves the Movie entity that matches the Id passed to the action.</span></span> <span data-ttu-id="ab321-260">Ensuite, le film est supprimé de la base de données en appelant la méthode SupprimerObjet () suivie de la méthode SaveChanges ().</span><span class="sxs-lookup"><span data-stu-id="ab321-260">Next, the movie is deleted from the database by calling the DeleteObject() method followed by the SaveChanges() method.</span></span> <span data-ttu-id="ab321-261">Enfin, l’utilisateur est redirigé vers la vue index.</span><span class="sxs-lookup"><span data-stu-id="ab321-261">Finally, the user is redirected back to the Index view.</span></span>

## <a name="summary"></a><span data-ttu-id="ab321-262">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="ab321-262">Summary</span></span>

<span data-ttu-id="ab321-263">L’objectif de ce didacticiel était de montrer comment vous pouvez créer des applications Web basées sur les bases de données en tirant parti de ASP.NET MVC et de l’Entity Framework Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ab321-263">The purpose of this tutorial was to demonstrate how you can build database-driven web applications by taking advantage of ASP.NET MVC and the Microsoft Entity Framework.</span></span> <span data-ttu-id="ab321-264">Vous avez appris à créer une application qui vous permet de sélectionner, d’insérer, de mettre à jour et de supprimer des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-264">You learned how to build an application that enables you to select, insert, update, and delete database records.</span></span>

<span data-ttu-id="ab321-265">Tout d’abord, nous avons abordé la manière dont vous pouvez utiliser l’Assistant Entity Data Model pour générer une Entity Data Model à partir de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ab321-265">First, we discussed how you can use the Entity Data Model Wizard to generate an Entity Data Model from within Visual Studio.</span></span> <span data-ttu-id="ab321-266">Ensuite, vous allez apprendre à utiliser LINQ to Entities pour récupérer un ensemble d’enregistrements de base de données à partir d’une table de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-266">Next, you learn how to use LINQ to Entities to retrieve a set of database records from a database table.</span></span> <span data-ttu-id="ab321-267">Enfin, nous avons utilisé le Entity Framework pour insérer, mettre à jour et supprimer des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="ab321-267">Finally, we used the Entity Framework to insert, update, and delete database records.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="ab321-268">Next</span><span class="sxs-lookup"><span data-stu-id="ab321-268">Next</span></span>](creating-model-classes-with-linq-to-sql-cs.md)
