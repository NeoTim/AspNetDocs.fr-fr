---
uid: mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-cs
title: Ajout de contenu dynamique à une page mise enC#cache () | Microsoft Docs
author: microsoft
description: Découvrez comment mélanger du contenu dynamique et mis en cache dans la même page. La substitution postérieure au cache vous permet d’afficher du contenu dynamique, par exemple des annonces de bannières...
ms.author: riande
ms.date: 01/27/2009
ms.assetid: 2ddd4407-d143-4a94-877c-21771bfb97a6
msc.legacyurl: /mvc/overview/older-versions-1/controllers-and-routing/adding-dynamic-content-to-a-cached-page-cs
msc.type: authoredcontent
ms.openlocfilehash: be43712d3dd5235117558e991d9dd71aa30ec470
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78601583"
---
# <a name="adding-dynamic-content-to-a-cached-page-c"></a><span data-ttu-id="0cd6c-104">Ajout de contenu dynamique à une page mise en cache (C#)</span><span class="sxs-lookup"><span data-stu-id="0cd6c-104">Adding Dynamic Content to a Cached Page (C#)</span></span>

<span data-ttu-id="0cd6c-105">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="0cd6c-105">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="0cd6c-106">Découvrez comment mélanger du contenu dynamique et mis en cache dans la même page.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-106">Learn how to mix dynamic and cached content in the same page.</span></span> <span data-ttu-id="0cd6c-107">La substitution postérieure au cache vous permet d’afficher du contenu dynamique, tel que des annonces de bannière ou des éléments d’actualité, dans une page qui a été mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-107">Post-cache substitution enables you to display dynamic content, such as banner advertisements or news items, within a page that has been output cached.</span></span>

<span data-ttu-id="0cd6c-108">En tirant parti de la mise en cache de sortie, vous pouvez améliorer considérablement les performances d’une application ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-108">By taking advantage of output caching, you can dramatically improve the performance of an ASP.NET MVC application.</span></span> <span data-ttu-id="0cd6c-109">Au lieu de régénérer une page chaque fois que la page est demandée, la page peut être générée une seule fois et mise en cache en mémoire pour plusieurs utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-109">Instead of regenerating a page each and every time the page is requested, the page can be generated once and cached in memory for multiple users.</span></span>

<span data-ttu-id="0cd6c-110">Mais il y a un problème.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-110">But there is a problem.</span></span> <span data-ttu-id="0cd6c-111">Que se passe-t-il si vous avez besoin d’afficher du contenu dynamique dans la page ?</span><span class="sxs-lookup"><span data-stu-id="0cd6c-111">What if you need to display dynamic content in the page?</span></span> <span data-ttu-id="0cd6c-112">Par exemple, imaginez que vous souhaitez afficher une bannière dans la page.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-112">For example, imagine that you want to display a banner advertisement in the page.</span></span> <span data-ttu-id="0cd6c-113">Vous ne souhaitez pas que la bannière bannière soit mise en cache afin que chaque utilisateur voit la même publication.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-113">You don't want the banner advertisement to be cached so that every user sees the very same advertisement.</span></span> <span data-ttu-id="0cd6c-114">Vous n’avez rien à faire !</span><span class="sxs-lookup"><span data-stu-id="0cd6c-114">You wouldn't make any money that way!</span></span>

<span data-ttu-id="0cd6c-115">Heureusement, il existe une solution simple.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-115">Fortunately, there is an easy solution.</span></span> <span data-ttu-id="0cd6c-116">Vous pouvez tirer parti d’une fonctionnalité de l’infrastructure ASP.NET appelée *substitution après le cache*.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-116">You can take advantage of a feature of the ASP.NET framework called *post-cache substitution*.</span></span> <span data-ttu-id="0cd6c-117">La substitution postérieure au cache vous permet de substituer du contenu dynamique dans une page qui a été mise en cache en mémoire.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-117">Post-cache substitution enables you to substitute dynamic content in a page that has been cached in memory.</span></span>

<span data-ttu-id="0cd6c-118">En règle générale, lorsque vous exportez une page en sortie à l’aide de l’attribut [OutputCache], la page est mise en cache sur le serveur et le client (le navigateur Web).</span><span class="sxs-lookup"><span data-stu-id="0cd6c-118">Normally, when you output cache a page by using the [OutputCache] attribute, the page is cached on both the server and the client (the web browser).</span></span> <span data-ttu-id="0cd6c-119">Lorsque vous utilisez la substitution après le cache, une page est mise en cache uniquement sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-119">When you use post-cache substitution, a page is cached only on the server.</span></span>

#### <a name="using-post-cache-substitution"></a><span data-ttu-id="0cd6c-120">Utilisation de la substitution postérieure au cache</span><span class="sxs-lookup"><span data-stu-id="0cd6c-120">Using Post-Cache Substitution</span></span>

<span data-ttu-id="0cd6c-121">L’utilisation de la substitution après le cache requiert deux étapes.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-121">Using post-cache substitution requires two steps.</span></span> <span data-ttu-id="0cd6c-122">Tout d’abord, vous devez définir une méthode qui retourne une chaîne qui représente le contenu dynamique que vous souhaitez afficher dans la page mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-122">First, you need to define a method that returns a string that represents the dynamic content that you want to display in the cached page.</span></span> <span data-ttu-id="0cd6c-123">Ensuite, vous appelez la méthode HttpResponse. WriteSubstitution () pour injecter le contenu dynamique dans la page.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-123">Next, you call the HttpResponse.WriteSubstitution() method to inject the dynamic content into the page.</span></span>

<span data-ttu-id="0cd6c-124">Imaginez, par exemple, que vous souhaitez afficher de manière aléatoire différents éléments d’actualité dans une page mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-124">Imagine, for example, that you want to randomly display different news items in a cached page.</span></span> <span data-ttu-id="0cd6c-125">La classe de la liste 1 expose une méthode unique, nommée RenderNews (), qui retourne de manière aléatoire un élément d’actualité à partir d’une liste de trois éléments d’information.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-125">The class in Listing 1 exposes a single method, named RenderNews(), that randomly returns one news item from a list of three news items.</span></span>

<span data-ttu-id="0cd6c-126">**Liste 1 – Models\News.cs**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-126">**Listing 1 – Models\News.cs**</span></span>

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample1.cs)]

<span data-ttu-id="0cd6c-127">Pour tirer parti de la substitution postérieure au cache, vous appelez la méthode HttpResponse. WriteSubstitution ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-127">To take advantage of post-cache substitution, you call the HttpResponse.WriteSubstitution() method.</span></span> <span data-ttu-id="0cd6c-128">La méthode WriteSubstitution () configure le code pour remplacer une région de la page mise en cache par du contenu dynamique.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-128">The WriteSubstitution() method sets up the code to replace a region of the cached page with dynamic content.</span></span> <span data-ttu-id="0cd6c-129">La méthode WriteSubstitution () est utilisée pour afficher l’élément d’actualité aléatoire dans la vue de la liste 2.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-129">The WriteSubstitution() method is used to display the random news item in the view in Listing 2.</span></span>

<span data-ttu-id="0cd6c-130">**Liste 2 – Views\Home\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-130">**Listing 2 – Views\Home\Index.aspx**</span></span>

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample2.aspx)]

<span data-ttu-id="0cd6c-131">La méthode RenderNews est transmise à la méthode WriteSubstitution ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-131">The RenderNews method is passed to the WriteSubstitution() method.</span></span> <span data-ttu-id="0cd6c-132">Notez que la méthode RenderNews n’est pas appelée (il n’y a pas de parenthèses).</span><span class="sxs-lookup"><span data-stu-id="0cd6c-132">Notice that the RenderNews method is not called (there are no parentheses).</span></span> <span data-ttu-id="0cd6c-133">Au lieu de cela, une référence à la méthode est passée à WriteSubstitution ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-133">Instead a reference to the method is passed to WriteSubstitution().</span></span>

<span data-ttu-id="0cd6c-134">La vue index est mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-134">The Index view is cached.</span></span> <span data-ttu-id="0cd6c-135">La vue est retournée par le contrôleur dans la liste 3.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-135">The view is returned by the controller in Listing 3.</span></span> <span data-ttu-id="0cd6c-136">Notez que l’action index () est décorée avec un attribut [OutputCache] qui provoque la mise en cache de la vue d’index pendant 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-136">Notice that the Index() action is decorated with an [OutputCache] attribute that causes the Index view to be cached for 60 seconds.</span></span>

<span data-ttu-id="0cd6c-137">**Liste 3 – Controllers\HomeController.cs**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-137">**Listing 3 – Controllers\HomeController.cs**</span></span>

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample3.cs)]

<span data-ttu-id="0cd6c-138">Même si la vue d’index est mise en cache, des éléments de News aléatoires différents s’affichent lorsque vous demandez la page d’index.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-138">Even though the Index view is cached, different random news items are displayed when you request the Index page.</span></span> <span data-ttu-id="0cd6c-139">Lorsque vous demandez la page d’index, l’heure affichée par la page ne change pas pendant 60 secondes (voir figure 1).</span><span class="sxs-lookup"><span data-stu-id="0cd6c-139">When you request the Index page, the time displayed by the page does not change for 60 seconds (see Figure 1).</span></span> <span data-ttu-id="0cd6c-140">Le fait que l’heure ne change pas prouve que la page est mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-140">The fact that the time does not change proves that the page is cached.</span></span> <span data-ttu-id="0cd6c-141">Toutefois, le contenu injecté par la méthode WriteSubstitution (), l’élément d’actualité aléatoire, change avec chaque demande.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-141">However, the content injected by the WriteSubstitution() method – the random news item – changes with each request .</span></span>

<span data-ttu-id="0cd6c-142">**Figure 1 : injection d’éléments de News dynamiques dans une page mise en cache**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-142">**Figure 1 – Injecting dynamic news items in a cached page**</span></span>

![clip_image002](adding-dynamic-content-to-a-cached-page-cs/_static/image1.jpg)

#### <a name="using-post-cache-substitution-in-helper-methods"></a><span data-ttu-id="0cd6c-144">Utilisation de la substitution postérieure au cache dans les méthodes d’assistance</span><span class="sxs-lookup"><span data-stu-id="0cd6c-144">Using Post-Cache Substitution in Helper Methods</span></span>

<span data-ttu-id="0cd6c-145">Un moyen plus simple de tirer parti de la substitution après le cache consiste à encapsuler l’appel à la méthode WriteSubstitution () au sein d’une méthode d’assistance personnalisée.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-145">An easier way to take advantage of post-cache substitution is to encapsulate the call to the WriteSubstitution() method within a custom helper method.</span></span> <span data-ttu-id="0cd6c-146">Cette approche est illustrée par la méthode d’assistance de la liste 4.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-146">This approach is illustrated by the helper method in Listing 4.</span></span>

<span data-ttu-id="0cd6c-147">**Liste 4 – AdHelper.cs**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-147">**Listing 4 – AdHelper.cs**</span></span>

[!code-csharp[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample4.cs)]

<span data-ttu-id="0cd6c-148">La liste 4 contient une classe statique qui expose deux méthodes : RenderBanner () et RenderBannerInternal ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-148">Listing 4 contains a static class that exposes two methods: RenderBanner() and RenderBannerInternal().</span></span> <span data-ttu-id="0cd6c-149">La méthode RenderBanner () représente la méthode d’assistance réelle.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-149">The RenderBanner() method represents the actual helper method.</span></span> <span data-ttu-id="0cd6c-150">Cette méthode étend la classe ASP.NET MVC HtmlHelper standard afin que vous puissiez appeler html. RenderBanner () dans une vue comme n’importe quelle autre méthode d’assistance.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-150">This method extends the standard ASP.NET MVC HtmlHelper class so that you can call Html.RenderBanner() in a view just like any other helper method.</span></span>

<span data-ttu-id="0cd6c-151">La méthode RenderBanner () appelle la méthode HttpResponse. WriteSubstitution () qui passe la méthode RenderBannerInternal () à la méthode WriteSubstitution ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-151">The RenderBanner() method calls the HttpResponse.WriteSubstitution() method passing the RenderBannerInternal() method to the WriteSubstitution() method.</span></span>

<span data-ttu-id="0cd6c-152">La méthode RenderBannerInternal () est une méthode privée.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-152">The RenderBannerInternal() method is a private method.</span></span> <span data-ttu-id="0cd6c-153">Cette méthode n’est pas exposée en tant que méthode d’assistance.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-153">This method won't be exposed as a helper method.</span></span> <span data-ttu-id="0cd6c-154">La méthode RenderBannerInternal () renvoie de manière aléatoire une image de publicité de bannière à partir d’une liste de trois images de publicité de bannière.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-154">The RenderBannerInternal() method randomly returns one banner advertisement image from a list of three banner advertisement images.</span></span>

<span data-ttu-id="0cd6c-155">La vue d’index modifiée dans la liste 5 illustre comment vous pouvez utiliser la méthode d’assistance RenderBanner ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-155">The modified Index view in Listing 5 illustrates how you can use the RenderBanner() helper method.</span></span> <span data-ttu-id="0cd6c-156">Notez qu’une directive supplémentaire &lt;% @ Import%&gt; est incluse en haut de la vue pour importer l’espace de noms MvcApplication1. helpers.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-156">Notice that an additional &lt;%@ Import %&gt; directive is included at the top of the view to import the MvcApplication1.Helpers namespace.</span></span> <span data-ttu-id="0cd6c-157">Si vous négligez d’importer cet espace de noms, la méthode RenderBanner () n’apparaîtra pas en tant que méthode sur la propriété html.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-157">If you neglect to import this namespace, then the RenderBanner() method won't appear as a method on the Html property.</span></span>

<span data-ttu-id="0cd6c-158">**Liste 5 – Views\Home\Index.aspx (avec la méthode RenderBanner ())**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-158">**Listing 5 – Views\Home\Index.aspx (with RenderBanner() method)**</span></span>

[!code-aspx[Main](adding-dynamic-content-to-a-cached-page-cs/samples/sample5.aspx)]

<span data-ttu-id="0cd6c-159">Lorsque vous demandez la page rendue par la vue dans la liste 5, une publicité de bannière différente s’affiche avec chaque demande (voir figure 2).</span><span class="sxs-lookup"><span data-stu-id="0cd6c-159">When you request the page rendered by the view in Listing 5, a different banner advertisement is displayed with each request (see Figure 2).</span></span> <span data-ttu-id="0cd6c-160">La page est mise en cache, mais la bannière est injectée dynamiquement par la méthode d’assistance RenderBanner ().</span><span class="sxs-lookup"><span data-stu-id="0cd6c-160">The page is cached, but the banner advertisement is injected dynamically by the RenderBanner() helper method.</span></span>

<span data-ttu-id="0cd6c-161">**Figure 2 : vue d’index affichant une bannière de bannière aléatoire**</span><span class="sxs-lookup"><span data-stu-id="0cd6c-161">**Figure 2 – The Index view displaying a random banner advertisement**</span></span>

![clip_image004](adding-dynamic-content-to-a-cached-page-cs/_static/image2.jpg)

#### <a name="summary"></a><span data-ttu-id="0cd6c-163">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="0cd6c-163">Summary</span></span>

<span data-ttu-id="0cd6c-164">Ce didacticiel a expliqué comment vous pouvez mettre à jour dynamiquement le contenu d’une page mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-164">This tutorial explained how you can dynamically update content in a cached page.</span></span> <span data-ttu-id="0cd6c-165">Vous avez appris à utiliser la méthode HttpResponse. WriteSubstitution () pour permettre l’injection de contenu dynamique dans une page mise en cache.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-165">You learned how to use the HttpResponse.WriteSubstitution() method to enable dynamic content to be injected in a cached page.</span></span> <span data-ttu-id="0cd6c-166">Vous avez également appris à encapsuler l’appel à la méthode WriteSubstitution () au sein d’une méthode d’assistance HTML.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-166">You also learned how to encapsulate the call to the WriteSubstitution() method within an HTML helper method.</span></span>

<span data-ttu-id="0cd6c-167">Tirez parti de la mise en cache dans la mesure du possible. elle peut avoir un impact considérable sur les performances de vos applications Web.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-167">Take advantage of caching whenever possible – it can have a dramatic impact on the performance of your web applications.</span></span> <span data-ttu-id="0cd6c-168">Comme expliqué dans ce didacticiel, vous pouvez tirer parti de la mise en cache même lorsque vous avez besoin d’afficher du contenu dynamique dans vos pages.</span><span class="sxs-lookup"><span data-stu-id="0cd6c-168">As explained in this tutorial, you can take advantage of caching even when you need to display dynamic content in your pages.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0cd6c-169">[Précédent](improving-performance-with-output-caching-cs.md)
> [Suivant](creating-a-controller-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0cd6c-169">[Previous](improving-performance-with-output-caching-cs.md)
[Next](creating-a-controller-cs.md)</span></span>
