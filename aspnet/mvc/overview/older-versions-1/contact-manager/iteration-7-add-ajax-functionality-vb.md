---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
title: 'Itération #7 - Ajouter la fonctionnalité Ajax (VB) Microsoft Docs'
author: rick-anderson
description: Dans la septième itération, nous améliorons la réactivité et la performance de notre application en ajoutant un soutien pour Ajax.
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f640e063-150e-453d-8cfc-7e54a6ce0f1e
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
msc.type: authoredcontent
ms.openlocfilehash: 04eaaa129a56b765c090e64118ed528c65987b50
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542298"
---
# <a name="iteration-7--add-ajax-functionality-vb"></a><span data-ttu-id="f01c5-103">Itération #7 : Ajouter des fonctionnalités Ajax (VB)</span><span class="sxs-lookup"><span data-stu-id="f01c5-103">Iteration #7 – Add Ajax functionality (VB)</span></span>

<span data-ttu-id="f01c5-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="f01c5-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="f01c5-105">Code de téléchargement</span><span class="sxs-lookup"><span data-stu-id="f01c5-105">Download Code</span></span>](iteration-7-add-ajax-functionality-vb/_static/contactmanager_7_vb1.zip)

> <span data-ttu-id="f01c5-106">Dans la septième itération, nous améliorons la réactivité et la performance de notre application en ajoutant un soutien pour Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="f01c5-107">Construire une application de gestion des contacts ASP.NET MVC (VB)</span><span class="sxs-lookup"><span data-stu-id="f01c5-107">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="f01c5-108">Dans cette série de tutoriels, nous construisons toute une application de gestion de contact du début à la fin.</span><span class="sxs-lookup"><span data-stu-id="f01c5-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="f01c5-109">L’application Contact Manager vous permet de stocker les coordonnées - noms, numéros de téléphone et adresses e-mail - pour une liste de personnes.</span><span class="sxs-lookup"><span data-stu-id="f01c5-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="f01c5-110">Nous construisons l’application sur plusieurs itérations.</span><span class="sxs-lookup"><span data-stu-id="f01c5-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="f01c5-111">À chaque itération, nous améliorons progressivement l’application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="f01c5-112">Le but de cette approche d’itération multiple est de vous permettre de comprendre la raison de chaque changement.</span><span class="sxs-lookup"><span data-stu-id="f01c5-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="f01c5-113">Itération #1 - Créer l’application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="f01c5-114">Dans la première itération, nous créons le Gestionnaire de Contact de la manière la plus simple possible.</span><span class="sxs-lookup"><span data-stu-id="f01c5-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="f01c5-115">Nous ajoutons un support pour les opérations de base de base de base : Créer, lire, mettre à jour et supprimer (CRUD).</span><span class="sxs-lookup"><span data-stu-id="f01c5-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="f01c5-116">Itération #2 - Rendre l’application belle.</span><span class="sxs-lookup"><span data-stu-id="f01c5-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="f01c5-117">Dans cette itération, nous améliorons l’apparence de l’application en modifiant la page principale de vue par défaut ASP.NET MVC et la feuille de style en cascade.</span><span class="sxs-lookup"><span data-stu-id="f01c5-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="f01c5-118">Itération #3 - Ajouter la validation du formulaire.</span><span class="sxs-lookup"><span data-stu-id="f01c5-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="f01c5-119">Dans la troisième itération, nous ajoutons la validation de forme de base.</span><span class="sxs-lookup"><span data-stu-id="f01c5-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="f01c5-120">Nous empêchons les gens de soumettre un formulaire sans remplir les champs de formulaire requis.</span><span class="sxs-lookup"><span data-stu-id="f01c5-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="f01c5-121">Nous validons également les adresses e-mail et les numéros de téléphone.</span><span class="sxs-lookup"><span data-stu-id="f01c5-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="f01c5-122">Itération #4 - Rendre l’application lâchement couplée.</span><span class="sxs-lookup"><span data-stu-id="f01c5-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="f01c5-123">Dans cette quatrième itération, nous profitons de plusieurs modèles de conception logicielle pour faciliter le maintien et la modification de l’application Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="f01c5-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="f01c5-124">Par exemple, nous refactorrons notre application pour utiliser le modèle de dépôt et le modèle d’injection de dépendance.</span><span class="sxs-lookup"><span data-stu-id="f01c5-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="f01c5-125">Itération #5 - Créer des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="f01c5-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="f01c5-126">Dans la cinquième itération, nous rendons notre application plus facile à maintenir et à modifier en ajoutant des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="f01c5-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="f01c5-127">Nous nous moquons de nos classes de modèles de données et construisons des tests unitaires pour nos contrôleurs et la logique de validation.</span><span class="sxs-lookup"><span data-stu-id="f01c5-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="f01c5-128">Itération #6 - Utilisez le développement axé sur les tests.</span><span class="sxs-lookup"><span data-stu-id="f01c5-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="f01c5-129">Dans cette sixième itération, nous ajoutons de nouvelles fonctionnalités à notre application en écrivant d’abord des tests unitaires et en écrivant du code contre les tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="f01c5-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="f01c5-130">Dans cette itération, nous ajoutons des groupes de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="f01c5-131">Itération #7 - Ajouter la fonctionnalité Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="f01c5-132">Dans la septième itération, nous améliorons la réactivité et la performance de notre application en ajoutant un soutien pour Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="f01c5-133">Cette Itération</span><span class="sxs-lookup"><span data-stu-id="f01c5-133">This Iteration</span></span>

<span data-ttu-id="f01c5-134">Dans cette itération de l’application Contact Manager, nous refactorrons notre application pour faire usage d’Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="f01c5-135">En profitant de l’Ajax, nous rendons notre application plus réactive.</span><span class="sxs-lookup"><span data-stu-id="f01c5-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="f01c5-136">Nous pouvons éviter de rendre une page entière lorsque nous avons besoin de mettre à jour seulement une certaine région dans une page.</span><span class="sxs-lookup"><span data-stu-id="f01c5-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="f01c5-137">Nous refactorrons notre vue Index afin de ne pas avoir besoin de redisjouer la page entière chaque fois que quelqu’un choisit un nouveau groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="f01c5-138">Au lieu de cela, lorsque quelqu’un clique sur un groupe de contact, nous allons simplement mettre à jour la liste des contacts et laisser le reste de la page seul.</span><span class="sxs-lookup"><span data-stu-id="f01c5-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="f01c5-139">Nous modifierons également la façon dont notre lien de suppression fonctionne.</span><span class="sxs-lookup"><span data-stu-id="f01c5-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="f01c5-140">Au lieu d’afficher une page de confirmation séparée, nous afficherons un dialogue de confirmation JavaScript.</span><span class="sxs-lookup"><span data-stu-id="f01c5-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="f01c5-141">Si vous confirmez que vous souhaitez supprimer un contact, une opération HTTP DELETE est effectuée contre le serveur pour supprimer l’enregistrement de contact de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f01c5-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="f01c5-142">En outre, nous profiterons de jQuery pour ajouter des effets d’animation à notre vue Index.</span><span class="sxs-lookup"><span data-stu-id="f01c5-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="f01c5-143">Nous afficherons une animation lorsque la nouvelle liste de contacts sera récupérée sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="f01c5-144">Enfin, nous tirerons parti de la ASP.NET support-cadre AJAX pour gérer l’historique du navigateur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="f01c5-145">Nous créerons des points d’histoire chaque fois que nous effectuerons un appel Ajax pour mettre à jour la liste de contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="f01c5-146">De cette façon, le navigateur vers l’arrière et vers l’avant des boutons fonctionnera.</span><span class="sxs-lookup"><span data-stu-id="f01c5-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="f01c5-147">Pourquoi utiliser Ajax?</span><span class="sxs-lookup"><span data-stu-id="f01c5-147">Why use Ajax?</span></span>

<span data-ttu-id="f01c5-148">L’utilisation de l’Ajax a de nombreux avantages.</span><span class="sxs-lookup"><span data-stu-id="f01c5-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="f01c5-149">Tout d’abord, l’ajout de fonctionnalités Ajax à une application se traduit par une meilleure expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="f01c5-150">Dans une application Web normale, la page entière doit être postée sur le serveur chaque fois qu’un utilisateur effectue une action.</span><span class="sxs-lookup"><span data-stu-id="f01c5-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="f01c5-151">Chaque fois que vous effectuez une action, le navigateur se verrouille et l’utilisateur doit attendre jusqu’à ce que la page entière est récupérée et redisjouée.</span><span class="sxs-lookup"><span data-stu-id="f01c5-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="f01c5-152">Ce serait une expérience inacceptable dans le cas d’une application de bureau.</span><span class="sxs-lookup"><span data-stu-id="f01c5-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="f01c5-153">Mais, traditionnellement, nous vivions avec cette mauvaise expérience utilisateur dans le cas d’une application web parce que nous ne savions pas que nous pouvions faire mieux.</span><span class="sxs-lookup"><span data-stu-id="f01c5-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="f01c5-154">Nous avons pensé que c’était une limitation des applications web alors que, en réalité, c’était juste une limitation de notre imagination.</span><span class="sxs-lookup"><span data-stu-id="f01c5-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="f01c5-155">Dans une application Ajax, vous n’avez pas besoin de mettre un terme à l’expérience utilisateur juste pour mettre à jour une page.</span><span class="sxs-lookup"><span data-stu-id="f01c5-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="f01c5-156">Au lieu de cela, vous pouvez effectuer une demande asynchrone en arrière-plan pour mettre à jour la page.</span><span class="sxs-lookup"><span data-stu-id="f01c5-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="f01c5-157">Vous ne forcez pas l’utilisateur à attendre pendant qu’une partie de la page est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="f01c5-158">En profitant de l’Ajax, vous pouvez également améliorer les performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="f01c5-159">Considérez comment fonctionne l’application Contact Manager dès maintenant sans fonctionnalité Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="f01c5-160">Lorsque vous cliquez sur un groupe de contact, la vue de l’index entier doit être redisjouée.</span><span class="sxs-lookup"><span data-stu-id="f01c5-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="f01c5-161">La liste des contacts et la liste des groupes de contact doivent être récupérées à partir du serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="f01c5-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="f01c5-162">Toutes ces données doivent être transmises à travers le fil du serveur Web au navigateur Web.</span><span class="sxs-lookup"><span data-stu-id="f01c5-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="f01c5-163">Après avoir ajouté la fonctionnalité Ajax à notre application, cependant, nous pouvons éviter de redisplaying la page entière quand un utilisateur clique sur un groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="f01c5-164">Nous n’avons plus besoin de saisir les groupes de contact de la base de données.</span><span class="sxs-lookup"><span data-stu-id="f01c5-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="f01c5-165">Nous n’avons pas non plus besoin de pousser la vue de l’index entier à travers le fil.</span><span class="sxs-lookup"><span data-stu-id="f01c5-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="f01c5-166">En profitant d’Ajax, nous réduisons la quantité de travail que notre serveur de base de données doit effectuer et nous réduisons la quantité de trafic réseau requis par notre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="f01c5-167">N’ayez pas peur de l’Ajax</span><span class="sxs-lookup"><span data-stu-id="f01c5-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="f01c5-168">Certains développeurs évitent d’utiliser Ajax parce qu’ils s’inquiètent des navigateurs à un niveau bas.</span><span class="sxs-lookup"><span data-stu-id="f01c5-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="f01c5-169">Ils veulent s’assurer que leurs applications Web fonctionneront toujours lorsqu’ils sont accessibles par un navigateur qui ne prend pas en charge JavaScript.</span><span class="sxs-lookup"><span data-stu-id="f01c5-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="f01c5-170">Parce que l’Ajax dépend de JavaScript, certains développeurs évitent d’utiliser Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="f01c5-171">Cependant, si vous faites attention sur la façon dont vous implémentez Ajax alors vous pouvez construire des applications qui fonctionnent avec les navigateurs haut de niveau et à la baisse.</span><span class="sxs-lookup"><span data-stu-id="f01c5-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="f01c5-172">Notre application Contact Manager fonctionnera avec les navigateurs qui prennent en charge JavaScript et les navigateurs qui ne le font pas.</span><span class="sxs-lookup"><span data-stu-id="f01c5-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="f01c5-173">Si vous utilisez l’application Contact Manager avec un navigateur qui prend en charge JavaScript, vous aurez une meilleure expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="f01c5-174">Par exemple, lorsque vous cliquez sur un groupe de contact, seule la région de la page qui affiche les contacts sera mise à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="f01c5-175">Si, d’autre part, vous utilisez l’application Contact Manager avec un navigateur qui ne prend pas en charge JavaScript (ou qui a JavaScript désactivé), alors vous aurez une expérience utilisateur un peu moins souhaitable.</span><span class="sxs-lookup"><span data-stu-id="f01c5-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="f01c5-176">Par exemple, lorsque vous cliquez sur un groupe de contact, l’ensemble de la vue Index doit être affiché sur le navigateur afin d’afficher la liste correspondante des contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="f01c5-177">Ajout des fichiers JavaScript requis</span><span class="sxs-lookup"><span data-stu-id="f01c5-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="f01c5-178">Nous devrons utiliser trois fichiers JavaScript pour ajouter la fonctionnalité Ajax à notre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="f01c5-179">Ces trois fichiers sont inclus dans le dossier Scripts d’une nouvelle application ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="f01c5-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="f01c5-180">Si vous prévoyez d utiliser Ajax dans plusieurs pages de votre application, il est logique d inclure les fichiers JavaScript requis dans la page principale de votre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="f01c5-181">De cette façon, les fichiers JavaScript seront inclus automatiquement dans toutes les pages de votre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="f01c5-182">Ajouter le JavaScript suivant &lt;&gt; comprend à l’intérieur de l’étiquette de tête de votre page principale de vue:</span><span class="sxs-lookup"><span data-stu-id="f01c5-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-vb/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="f01c5-183">Refactoring the Index View to use Ajax</span><span class="sxs-lookup"><span data-stu-id="f01c5-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="f01c5-184">Commençons par modifier notre vue d’index de sorte que le clic d’un groupe de contact ne met à jour que la région de la vue qui affiche les contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="f01c5-185">La boîte rouge de la figure 1 contient la région que nous voulons mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="f01c5-186">[![Mise à jour uniquement des contacts](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f01c5-186">[![Updating only contacts](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span></span>

<span data-ttu-id="f01c5-187">**Figure 01**: Mise à jour uniquement des contacts ([Cliquez pour voir l’image grandeur nature](iteration-7-add-ajax-functionality-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="f01c5-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image2.png))</span></span>

<span data-ttu-id="f01c5-188">La première étape consiste à séparer la partie de l’opinion que nous voulons mettre à jour asynchroneously dans une partielle séparée (voir le contrôle de l’utilisateur).</span><span class="sxs-lookup"><span data-stu-id="f01c5-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="f01c5-189">La section de l’indice de vue qui affiche le tableau des contacts a été déplacée dans la partie dans la liste 1.</span><span class="sxs-lookup"><span data-stu-id="f01c5-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="f01c5-190">**Liste 1 - Vues-ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="f01c5-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample2.aspx)]

<span data-ttu-id="f01c5-191">Notez que la partie dans la liste 1 a un modèle différent de celui de l’indice.</span><span class="sxs-lookup"><span data-stu-id="f01c5-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="f01c5-192">L’attribut *d’Inherits* &lt;dans&gt; la directive % de page en % précise&lt;que&gt; l’attribut partiel hérite de la classe ViewUserControl Group.</span><span class="sxs-lookup"><span data-stu-id="f01c5-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="f01c5-193">La vue de l’indice mise à jour est contenue dans la liste 2.</span><span class="sxs-lookup"><span data-stu-id="f01c5-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="f01c5-194">**Liste 2 - Views-Contact.Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="f01c5-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample3.aspx)]

<span data-ttu-id="f01c5-195">Il ya deux choses que vous devriez remarquer sur la vue mise à jour dans la liste 2.</span><span class="sxs-lookup"><span data-stu-id="f01c5-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="f01c5-196">Tout d’abord, notez que tout le contenu déplacé dans la partie est remplacé par un appel à Html.RenderPartial ().</span><span class="sxs-lookup"><span data-stu-id="f01c5-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="f01c5-197">La méthode Html.RenderPartial() est appelée lorsque la vue d’index est demandée pour la première fois afin d’afficher l’ensemble initial de contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="f01c5-198">Deuxièmement, notez que le Html.ActionLink() utilisé pour afficher les groupes de contact a été remplacé par un Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="f01c5-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="f01c5-199">L’Ajax.ActionLink () est appelé avec les paramètres suivants:</span><span class="sxs-lookup"><span data-stu-id="f01c5-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample4.aspx)]

<span data-ttu-id="f01c5-200">Le premier paramètre représente le texte à afficher pour le lien, le deuxième paramètre représente les valeurs de l’itinéraire, et le troisième paramètre représente les options Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="f01c5-201">Dans ce cas, nous utilisons l’option UpdateTargetId&gt; Ajax pour pointer vers l’étiquette de div HTML &lt;que nous voulons mettre à jour après la demande Ajax terminée.</span><span class="sxs-lookup"><span data-stu-id="f01c5-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="f01c5-202">Nous voulons mettre &lt;à&gt; jour l’étiquette de div avec la nouvelle liste de contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="f01c5-203">La méthode index() mise à jour du contrôleur de contact est contenue dans la liste 3.</span><span class="sxs-lookup"><span data-stu-id="f01c5-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="f01c5-204">**Liste 3 - Controllers-ContactController.vb (méthode de l’indice)**</span><span class="sxs-lookup"><span data-stu-id="f01c5-204">**Listing 3 - Controllers\ContactController.vb (Index method)**</span></span>

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample5.vb)]

<span data-ttu-id="f01c5-205">L’action index mise à jour() renvoie conditionnellement l’une des deux choses.</span><span class="sxs-lookup"><span data-stu-id="f01c5-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="f01c5-206">Si l’action Index() est invoquée par une demande d’Ajax, le contrôleur renvoie une partie.</span><span class="sxs-lookup"><span data-stu-id="f01c5-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="f01c5-207">Dans le cas contraire, l’action Index() renvoie une vue entière.</span><span class="sxs-lookup"><span data-stu-id="f01c5-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="f01c5-208">Notez que l’action Index() n’a pas besoin de retourner autant de données lorsqu’elle est invoquée par une demande Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="f01c5-209">Dans le cadre d’une demande normale, l’action Index renvoie une liste de tous les groupes de contact et du groupe de contact sélectionné.</span><span class="sxs-lookup"><span data-stu-id="f01c5-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="f01c5-210">Dans le cadre d’une demande Ajax, l’action Index() ne renvoie que le groupe sélectionné.</span><span class="sxs-lookup"><span data-stu-id="f01c5-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="f01c5-211">Ajax signifie moins de travail sur votre serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="f01c5-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="f01c5-212">Notre vue Index modifiée fonctionne dans le cas des navigateurs haut de niveau et à la baisse.</span><span class="sxs-lookup"><span data-stu-id="f01c5-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="f01c5-213">Si vous cliquez sur un groupe de contact, et que votre navigateur prend en charge JavaScript, la région de la vue qui contient la liste des contacts est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="f01c5-214">Si, d’autre part, votre navigateur ne prend pas en charge JavaScript, alors la vue entière est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="f01c5-215">Notre vue Index mise à jour a un problème.</span><span class="sxs-lookup"><span data-stu-id="f01c5-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="f01c5-216">Lorsque vous cliquez sur un groupe de contact, le groupe sélectionné n’est pas mis en évidence.</span><span class="sxs-lookup"><span data-stu-id="f01c5-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="f01c5-217">Étant donné que la liste des groupes est affichée à l’extérieur de la région qui est mise à jour lors d’une demande Ajax, le bon groupe ne se fait pas mettre en évidence.</span><span class="sxs-lookup"><span data-stu-id="f01c5-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="f01c5-218">Nous allons résoudre ce problème dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="f01c5-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="f01c5-219">Ajout d’effets d’animation jQuery</span><span class="sxs-lookup"><span data-stu-id="f01c5-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="f01c5-220">Normalement, lorsque vous cliquez sur un lien dans une page Web, vous pouvez utiliser la barre de progression du navigateur pour détecter si oui ou non le navigateur est activement chercher le contenu mis à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="f01c5-221">Lors de l’exécution d’une demande Ajax, d’autre part, la barre de progression du navigateur ne montre aucun progrès.</span><span class="sxs-lookup"><span data-stu-id="f01c5-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="f01c5-222">Cela peut rendre les utilisateurs nerveux.</span><span class="sxs-lookup"><span data-stu-id="f01c5-222">This can make users nervous.</span></span> <span data-ttu-id="f01c5-223">Comment savez-vous si le navigateur a gelé?</span><span class="sxs-lookup"><span data-stu-id="f01c5-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="f01c5-224">Il existe plusieurs façons d’indiquer à un utilisateur que le travail est effectué lors de l’exécution d’une demande Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="f01c5-225">Une approche consiste à afficher une animation simple.</span><span class="sxs-lookup"><span data-stu-id="f01c5-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="f01c5-226">Par exemple, vous pouvez vous faner une région lorsqu’une demande d’Ajax commence et s’estomper dans la région lorsque la demande sera terminée.</span><span class="sxs-lookup"><span data-stu-id="f01c5-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="f01c5-227">Nous utiliserons la bibliothèque jQuery qui est incluse avec le cadre Microsoft ASP.NET MVC, pour créer les effets d’animation.</span><span class="sxs-lookup"><span data-stu-id="f01c5-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="f01c5-228">La vue de l’indice mise à jour est contenue dans la liste 4.</span><span class="sxs-lookup"><span data-stu-id="f01c5-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="f01c5-229">**Liste 4 - Views-Contact.Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="f01c5-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample6.aspx)]

<span data-ttu-id="f01c5-230">Notez que la vue Index mise à jour contient trois nouvelles fonctions JavaScript.</span><span class="sxs-lookup"><span data-stu-id="f01c5-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="f01c5-231">Les deux premières fonctions utilisent jQuery pour s’estomper et s’estomper dans la liste des contacts lorsque vous cliquez sur un nouveau groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="f01c5-232">La troisième fonction affiche un message d’erreur lorsqu’une demande d’Ajax entraîne une erreur (par exemple, un délai d’attente en réseau).</span><span class="sxs-lookup"><span data-stu-id="f01c5-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="f01c5-233">La première fonction s’occupe également de mettre en évidence le groupe sélectionné.</span><span class="sxs-lookup"><span data-stu-id="f01c5-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="f01c5-234">Un attribut sélectionné par classeMD est ajouté à l’élément parent (l’élément LI) de l’élément cliqué.</span><span class="sxs-lookup"><span data-stu-id="f01c5-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="f01c5-235">Encore une fois, jQuery permet de sélectionner facilement le bon élément et d’ajouter la classe CSS.</span><span class="sxs-lookup"><span data-stu-id="f01c5-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="f01c5-236">Ces scripts sont liés aux liens de groupe avec l’aide du paramètre Ajax.ActionLink() AjaxOptions.</span><span class="sxs-lookup"><span data-stu-id="f01c5-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="f01c5-237">L’appel de méthode Ajax.ActionLink() mis à jour ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="f01c5-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="f01c5-238">Ajout d’un support d’historique de navigateur</span><span class="sxs-lookup"><span data-stu-id="f01c5-238">Adding Browser History Support</span></span>

<span data-ttu-id="f01c5-239">Normalement, lorsque vous cliquez sur un lien pour mettre à jour une page, l’historique de votre navigateur est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="f01c5-240">De cette façon, vous pouvez cliquer sur le bouton De retour du navigateur pour revenir dans le temps à l’état précédent de la page.</span><span class="sxs-lookup"><span data-stu-id="f01c5-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="f01c5-241">Par exemple, si vous cliquez sur le groupe de contact Friends, puis cliquez sur le groupe de contact Business, vous pouvez cliquer sur le bouton De retour du navigateur pour revenir à l’état de la page lorsque le groupe de contact Friends a été sélectionné.</span><span class="sxs-lookup"><span data-stu-id="f01c5-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="f01c5-242">Malheureusement, l’exécution d’une demande Ajax ne met pas à jour automatiquement l’historique du navigateur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="f01c5-243">Si vous cliquez sur un groupe de contact, et la liste des contacts correspondants est récupérée avec une demande Ajax, alors l’historique du navigateur n’est pas mis à jour.</span><span class="sxs-lookup"><span data-stu-id="f01c5-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="f01c5-244">Vous ne pouvez pas utiliser le bouton Navigateur Retour pour revenir à un groupe de contact après avoir sélectionné un nouveau groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="f01c5-245">Si vous voulez que les utilisateurs soient en mesure d’utiliser le bouton De retour du navigateur après avoir effectué des demandes Ajax, alors vous devez effectuer un peu plus de travail.</span><span class="sxs-lookup"><span data-stu-id="f01c5-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="f01c5-246">Vous devez profiter de la fonctionnalité de gestion de l’historique du navigateur intégrée dans le cadre ASP.NET AJAX.</span><span class="sxs-lookup"><span data-stu-id="f01c5-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="f01c5-247">ASP.NET’historique du navigateur AJAX, vous devez faire trois choses:</span><span class="sxs-lookup"><span data-stu-id="f01c5-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="f01c5-248">Activez l’historique du navigateur en définissant la propriété enableBrowserHistory.</span><span class="sxs-lookup"><span data-stu-id="f01c5-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="f01c5-249">Enregistrez les points d’histoire lorsque l’état d’une vue change en appelant la méthode addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="f01c5-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="f01c5-250">Reconstruire l’état de la vue lorsque l’événement de navigation est soulevé.</span><span class="sxs-lookup"><span data-stu-id="f01c5-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="f01c5-251">La vue de l’indice mise à jour est contenue dans la liste 5.</span><span class="sxs-lookup"><span data-stu-id="f01c5-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="f01c5-252">**Liste 5 - Views-Contact.Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="f01c5-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample8.aspx)]

<span data-ttu-id="f01c5-253">Dans La liste 5, l’historique du navigateur est activé dans la fonction pageInit() .</span><span class="sxs-lookup"><span data-stu-id="f01c5-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="f01c5-254">La fonction pageInit() est également utilisée pour configurer le gestionnaire d’événements pour l’événement de navigation.</span><span class="sxs-lookup"><span data-stu-id="f01c5-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="f01c5-255">L’événement de navigation est soulevé chaque fois que le navigateur Forward ou Back bouton provoque l’état de la page à changer.</span><span class="sxs-lookup"><span data-stu-id="f01c5-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="f01c5-256">La méthode beginContactList() s’appelle lorsque vous cliquez sur un groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="f01c5-257">Cette méthode crée un nouveau point d’histoire en appelant la méthode addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="f01c5-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="f01c5-258">L’id du groupe de contact cliqué est ajouté à l’historique.</span><span class="sxs-lookup"><span data-stu-id="f01c5-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="f01c5-259">L’id de groupe est récupéré à partir d’un attribut expando sur le lien de groupe de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="f01c5-260">Le lien est rendu avec l’appel suivant à Ajax.ActionLink ().</span><span class="sxs-lookup"><span data-stu-id="f01c5-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample9.aspx)]

<span data-ttu-id="f01c5-261">Le dernier paramètre passé à l’Ajax.ActionLink () ajoute un attribut expando nommé groupidé au lien (lowercase pour la compatibilité XHTML).</span><span class="sxs-lookup"><span data-stu-id="f01c5-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="f01c5-262">Lorsqu’un utilisateur touche le navigateur Sur le bouton Retour ou Avant, l’événement de navigation est déclenché et la méthode de navigation () s’appelle.</span><span class="sxs-lookup"><span data-stu-id="f01c5-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="f01c5-263">Cette méthode met à jour les contacts affichés dans la page pour correspondre à l’état de la page qui correspond au point d’historique du navigateur passé à la méthode de navigation.</span><span class="sxs-lookup"><span data-stu-id="f01c5-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="f01c5-264">Exécution Ajax Supprime</span><span class="sxs-lookup"><span data-stu-id="f01c5-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="f01c5-265">Actuellement, pour supprimer un contact, vous devez cliquer sur le lien Supprimer, puis cliquer sur le bouton Supprimer affiché dans la page de confirmation de suppression (voir la figure 2).</span><span class="sxs-lookup"><span data-stu-id="f01c5-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="f01c5-266">Cela semble être beaucoup de demandes de page pour faire quelque chose de simple comme la suppression d’un enregistrement de base de données.</span><span class="sxs-lookup"><span data-stu-id="f01c5-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="f01c5-267">[![La page de confirmation de suppression](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f01c5-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span></span>

<span data-ttu-id="f01c5-268">**Figure 02**: La page de confirmation de suppression[(Cliquez pour voir l’image grandeur nature](iteration-7-add-ajax-functionality-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="f01c5-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image4.png))</span></span>

<span data-ttu-id="f01c5-269">Il est tentant de sauter la page de confirmation de suppression et de supprimer un contact directement à partir de la vue index.</span><span class="sxs-lookup"><span data-stu-id="f01c5-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="f01c5-270">Vous devriez éviter cette tentation parce que la prise de cette approche ouvre votre application à des trous de sécurité.</span><span class="sxs-lookup"><span data-stu-id="f01c5-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="f01c5-271">En général, vous ne voulez pas effectuer une opération HTTP GET lors de l’invocation d’une action qui modifie l’état de votre application web.</span><span class="sxs-lookup"><span data-stu-id="f01c5-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="f01c5-272">Lors de l’exécution d’une suppression, vous souhaitez effectuer un MESSAGE HTTP, ou mieux encore, une opération HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="f01c5-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="f01c5-273">Le lien Supprimer est contenu dans la Liste de contact partielle.</span><span class="sxs-lookup"><span data-stu-id="f01c5-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="f01c5-274">Une version mise à jour de la liste de contact partielle est contenue dans la liste 6.</span><span class="sxs-lookup"><span data-stu-id="f01c5-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="f01c5-275">**Liste 6 - Views-Contact-ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="f01c5-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample10.aspx)]

<span data-ttu-id="f01c5-276">Le lien Supprimer est rendu avec l’appel suivant à la méthode Ajax.ImageActionLink() :</span><span class="sxs-lookup"><span data-stu-id="f01c5-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="f01c5-277">L’Ajax.ImageActionLink() n’est pas une partie standard du cadre ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="f01c5-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="f01c5-278">L’Ajax.ImageActionLink() est une méthode d’aide personnalisée incluse dans le projet Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="f01c5-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="f01c5-279">Le paramètre AjaxOptions a deux propriétés.</span><span class="sxs-lookup"><span data-stu-id="f01c5-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="f01c5-280">Tout d’abord, la propriété Confirm est utilisée pour afficher un dialogue de confirmation JavaScript popup.</span><span class="sxs-lookup"><span data-stu-id="f01c5-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="f01c5-281">Deuxièmement, la propriété HttpMethod est utilisée pour effectuer une opération HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="f01c5-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="f01c5-282">La liste 7 contient une nouvelle action AjaxDelete() qui a été ajoutée au contrôleur de contact.</span><span class="sxs-lookup"><span data-stu-id="f01c5-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="f01c5-283">**Liste 7 - Controllers-ContactController.vb (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="f01c5-283">**Listing 7 - Controllers\ContactController.vb (AjaxDelete)**</span></span>   

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample12.vb)]

<span data-ttu-id="f01c5-284">L’action AjaxDelete() est décorée d’un attribut AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="f01c5-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="f01c5-285">Cet attribut empêche l’action d’être invoquée, sauf par toute opération HTTP autre qu’une opération HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="f01c5-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="f01c5-286">En particulier, vous ne pouvez pas invoquer cette action avec un GET HTTP.</span><span class="sxs-lookup"><span data-stu-id="f01c5-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="f01c5-287">Après avoir supprimé l’enregistrement de base de données, vous devez afficher la liste mise à jour des contacts qui ne contiennent pas l’enregistrement supprimé.</span><span class="sxs-lookup"><span data-stu-id="f01c5-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="f01c5-288">La méthode AjaxDelete() renvoie la Liste de contact partielle et la liste mise à jour des contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="f01c5-289">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="f01c5-289">Summary</span></span>

<span data-ttu-id="f01c5-290">Dans cette itération, nous avons ajouté la fonctionnalité Ajax à notre application Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="f01c5-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="f01c5-291">Nous avons utilisé Ajax pour améliorer la réactivité et les performances de notre application.</span><span class="sxs-lookup"><span data-stu-id="f01c5-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="f01c5-292">Tout d’abord, nous avons refactorisé la vue Index de sorte que le fait de cliquer sur un groupe de contact ne met pas à jour l’ensemble de la vue.</span><span class="sxs-lookup"><span data-stu-id="f01c5-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="f01c5-293">Au lieu de cela, en cliquant sur un groupe de contact ne met à jour la liste des contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="f01c5-294">Ensuite, nous avons utilisé des effets d’animation jQuery pour s’estomper et s’estomper dans la liste des contacts.</span><span class="sxs-lookup"><span data-stu-id="f01c5-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="f01c5-295">L’ajout d’animation à une application Ajax peut être utilisé pour fournir aux utilisateurs de l’application l’équivalent d’une barre de progression du navigateur.</span><span class="sxs-lookup"><span data-stu-id="f01c5-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="f01c5-296">Nous avons également ajouté le support d’historique du navigateur à notre application Ajax.</span><span class="sxs-lookup"><span data-stu-id="f01c5-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="f01c5-297">Nous avons permis aux utilisateurs de cliquer sur les boutons Back and Forward du navigateur pour modifier l’état de la vue de l’index.</span><span class="sxs-lookup"><span data-stu-id="f01c5-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="f01c5-298">Enfin, nous avons créé un lien de suppression qui prend en charge les opérations HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="f01c5-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="f01c5-299">En effectuant les suppressions d’Ajax, nous permettons aux utilisateurs de supprimer les enregistrements de base de données sans exiger de l’utilisateur qu’il demande une page de confirmation de suppression supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="f01c5-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="f01c5-300">Précédent</span><span class="sxs-lookup"><span data-stu-id="f01c5-300">Previous</span></span>](iteration-6-use-test-driven-development-vb.md)
