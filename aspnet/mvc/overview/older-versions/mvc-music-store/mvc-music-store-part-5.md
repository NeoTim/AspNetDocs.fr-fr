---
uid: mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-5
title: 'Partie 5 : modifier les formulaires et les modèles | Microsoft Docs'
author: jongalloway
description: Cette série de didacticiels détaille toutes les étapes nécessaires à la création de l’exemple d’application ASP.NET MVC Music Store. La partie 5 couvre les formulaires de modification et la création de modèles.
ms.author: riande
ms.date: 04/21/2011
ms.assetid: 6b09413a-6d6a-425a-87c9-629f91b91b28
msc.legacyurl: /mvc/overview/older-versions/mvc-music-store/mvc-music-store-part-5
msc.type: authoredcontent
ms.openlocfilehash: 20b99cbe57b5dfa623205838a5929733a6c2d70d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78559548"
---
# <a name="part-5-edit-forms-and-templating"></a><span data-ttu-id="3e4cc-104">Partie 5 : modifier les formulaires et les modèles</span><span class="sxs-lookup"><span data-stu-id="3e4cc-104">Part 5: Edit Forms and Templating</span></span>

<span data-ttu-id="3e4cc-105">par [Jon Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="3e4cc-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="3e4cc-106">Le magasin de musique MVC est une application de didacticiel qui présente et explique pas à pas comment utiliser ASP.NET MVC et Visual Studio pour le développement Web.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-106">The MVC Music Store is a tutorial application that introduces and explains step-by-step how to use ASP.NET MVC and Visual Studio for web development.</span></span>  
>   
> <span data-ttu-id="3e4cc-107">Le magasin de musique MVC est une implémentation de magasin légère qui vend des albums musicaux en ligne et implémente l’administration de site de base, la connexion utilisateur et la fonctionnalité de panier d’achat.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-107">The MVC Music Store is a lightweight sample store implementation which sells music albums online, and implements basic site administration, user sign-in, and shopping cart functionality.</span></span>
> 
> <span data-ttu-id="3e4cc-108">Cette série de didacticiels détaille toutes les étapes nécessaires à la création de l’exemple d’application ASP.NET MVC Music Store.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-108">This tutorial series details all of the steps taken to build the ASP.NET MVC Music Store sample application.</span></span> <span data-ttu-id="3e4cc-109">La partie 5 couvre les formulaires de modification et la création de modèles.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-109">Part 5 covers Edit Forms and Templating.</span></span>

<span data-ttu-id="3e4cc-110">Dans le chapitre précédent, nous avons chargé des données à partir de notre base de données et nous les affichions.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-110">In the past chapter, we were loading data from our database and displaying it.</span></span> <span data-ttu-id="3e4cc-111">Dans ce chapitre, nous allons également activer la modification des données.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-111">In this chapter, we'll also enable editing the data.</span></span>

## <a name="creating-the-storemanagercontroller"></a><span data-ttu-id="3e4cc-112">Création du StoreManagerController</span><span class="sxs-lookup"><span data-stu-id="3e4cc-112">Creating the StoreManagerController</span></span>

<span data-ttu-id="3e4cc-113">Nous allons commencer par créer un nouveau contrôleur appelé **StoreManagerController**.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-113">We'll begin by creating a new controller called **StoreManagerController**.</span></span> <span data-ttu-id="3e4cc-114">Pour ce contrôleur, nous allons tirer parti des fonctionnalités de génération de modèles automatique disponibles dans la mise à jour des outils ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-114">For this controller, we will be taking advantage of the Scaffolding features available in the ASP.NET MVC 3 Tools Update.</span></span> <span data-ttu-id="3e4cc-115">Définissez les options de la boîte de dialogue Ajouter un contrôleur comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-115">Set the options for the Add Controller dialog as shown below.</span></span>

![](mvc-music-store-part-5/_static/image1.png)

<span data-ttu-id="3e4cc-116">Lorsque vous cliquez sur le bouton Ajouter, vous constatez que le mécanisme de génération de modèles automatique ASP.NET MVC 3 effectue une bonne quantité de travail pour vous :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-116">When you click the Add button, you'll see that the ASP.NET MVC 3 scaffolding mechanism does a good amount of work for you:</span></span>

- <span data-ttu-id="3e4cc-117">Elle crée le nouveau StoreManagerController avec une variable Entity Framework locale</span><span class="sxs-lookup"><span data-stu-id="3e4cc-117">It creates the new StoreManagerController with a local Entity Framework variable</span></span>
- <span data-ttu-id="3e4cc-118">Il ajoute un dossier StoreManager au dossier views du projet</span><span class="sxs-lookup"><span data-stu-id="3e4cc-118">It adds a StoreManager folder to the project's Views folder</span></span>
- <span data-ttu-id="3e4cc-119">Elle ajoute les vues Create. cshtml, DELETE. cshtml, Details. cshtml, Edit. cshtml et index. cshtml, fortement typées dans la classe album.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-119">It adds Create.cshtml, Delete.cshtml, Details.cshtml, Edit.cshtml, and Index.cshtml view, strongly typed to the Album class</span></span>

![](mvc-music-store-part-5/_static/image2.png)

<span data-ttu-id="3e4cc-120">La nouvelle classe de contrôleur StoreManager comprend des actions de contrôleur CRUD (créer, lire, mettre à jour, supprimer) qui savent comment utiliser la classe de modèle d’album et utiliser notre contexte de Entity Framework pour l’accès aux bases de données.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-120">The new StoreManager controller class includes CRUD (create, read, update, delete) controller actions which know how to work with the Album model class and use our Entity Framework context for database access.</span></span>

## <a name="modifying-a-scaffolded-view"></a><span data-ttu-id="3e4cc-121">Modification d’une vue échafaudée</span><span class="sxs-lookup"><span data-stu-id="3e4cc-121">Modifying a Scaffolded View</span></span>

<span data-ttu-id="3e4cc-122">Il est important de se souvenir que, même si ce code a été généré pour nous, il s’agit d’un code ASP.NET MVC standard, tout comme nous avons écrit dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-122">It's important to remember that, while this code was generated for us, it's standard ASP.NET MVC code, just like we've been writing throughout this tutorial.</span></span> <span data-ttu-id="3e4cc-123">Il est conçu pour vous faire gagner du temps lors de l’écriture d’un code de contrôleur réutilisable et de la création manuelle des vues fortement typées, mais ce n’est pas le type de code généré que vous avez pu constater par des avertissements de manière importante dans les commentaires sur la façon dont vous ne doit pas modifier le code.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-123">It's intended to save you the time you'd spend on writing boilerplate controller code and creating the strongly typed views manually, but this isn't the kind of generated code you may have seen prefaced with dire warnings in comments about how you mustn't change the code.</span></span> <span data-ttu-id="3e4cc-124">Il s’agit de votre code et vous êtes censé le changer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-124">This is your code, and you're expected to change it.</span></span>

<span data-ttu-id="3e4cc-125">Commençons par une modification rapide de la vue d’index StoreManager (/Views/StoreManager/Index.cshtml).</span><span class="sxs-lookup"><span data-stu-id="3e4cc-125">So, let's start with a quick edit to the StoreManager Index view (/Views/StoreManager/Index.cshtml).</span></span> <span data-ttu-id="3e4cc-126">Cette vue affiche une table qui répertorie les albums dans notre magasin avec des liens modifier/détails/supprimer, et comprend les propriétés publiques de l’album.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-126">This view will display a table which lists the Albums in our store with Edit / Details / Delete links, and includes the Album's public properties.</span></span> <span data-ttu-id="3e4cc-127">Nous allons supprimer le champ AlbumArtUrl, car il n’est pas très utile dans cet affichage.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-127">We'll remove the AlbumArtUrl field, as it's not very useful in this display.</span></span> <span data-ttu-id="3e4cc-128">Dans &lt;section&gt; de la table de la vue de code, supprimez les éléments &lt;&gt; et &lt;TD&gt; entourant les références AlbumArtUrl, comme indiqué par les lignes en surbrillance ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-128">In &lt;table&gt; section of the view code, remove the &lt;th&gt; and &lt;td&gt; elements surrounding AlbumArtUrl references, as indicated by the highlighted lines below:</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample1.cshtml)]

<span data-ttu-id="3e4cc-129">Le code d’affichage modifié s’affiche comme suit :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-129">The modified view code will appear as follows:</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample2.cshtml)]

## <a name="a-first-look-at-the-store-manager"></a><span data-ttu-id="3e4cc-130">Un premier aperçu du responsable du magasin</span><span class="sxs-lookup"><span data-stu-id="3e4cc-130">A first look at the Store Manager</span></span>

<span data-ttu-id="3e4cc-131">Exécutez maintenant l’application et accédez à/StoreManager/.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-131">Now run the application and browse to /StoreManager/.</span></span> <span data-ttu-id="3e4cc-132">Cela permet d’afficher l’index du responsable du magasin que nous venons de modifier, en affichant une liste des albums dans le magasin avec des liens pour modifier, détails et supprimer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-132">This displays the Store Manager Index we just modified, showing a list of the albums in the store with links to Edit, Details, and Delete.</span></span>

![](mvc-music-store-part-5/_static/image3.png)

<span data-ttu-id="3e4cc-133">Cliquer sur le lien modifier affiche un formulaire de modification avec les champs de l’album, y compris les listes déroulantes pour le genre et l’artiste.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-133">Clicking the Edit link displays an edit form with fields for the Album, including dropdowns for Genre and Artist.</span></span>

![](mvc-music-store-part-5/_static/image4.png)

<span data-ttu-id="3e4cc-134">Cliquez sur le lien « retour à la liste » en bas, puis cliquez sur le lien détails d’un album.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-134">Click the "Back to List" link at the bottom, then click on the Details link for an Album.</span></span> <span data-ttu-id="3e4cc-135">Cela permet d’afficher les informations détaillées d’un album individuel.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-135">This displays the detail information for an individual Album.</span></span>

![](mvc-music-store-part-5/_static/image5.png)

<span data-ttu-id="3e4cc-136">Là encore, cliquez sur le lien retour à la liste, puis cliquez sur un lien supprimer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-136">Again, click the Back to List link, then click on a Delete link.</span></span> <span data-ttu-id="3e4cc-137">Une boîte de dialogue de confirmation s’affiche, indiquant les détails de l’album et demandant si nous sommes sûrs de le supprimer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-137">This displays a confirmation dialog, showing the album details and asking if we're sure we want to delete it.</span></span>

![](mvc-music-store-part-5/_static/image6.png)

<span data-ttu-id="3e4cc-138">En cliquant sur le bouton supprimer en bas, vous allez supprimer l’album et revenir à la page index, qui affiche l’album supprimé.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-138">Clicking the Delete button at the bottom will delete the album and return you to the Index page, which shows the album deleted.</span></span>

<span data-ttu-id="3e4cc-139">Nous n’avons pas terminé avec le responsable du magasin, mais nous avons le contrôleur de travail et le code de vue pour les opérations CRUD à partir desquelles démarrer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-139">We're not done with the Store Manager, but we have working controller and view code for the CRUD operations to start from.</span></span>

## <a name="looking-at-the-store-manager-controller-code"></a><span data-ttu-id="3e4cc-140">Examen du code du contrôleur Store Manager</span><span class="sxs-lookup"><span data-stu-id="3e4cc-140">Looking at the Store Manager Controller code</span></span>

<span data-ttu-id="3e4cc-141">Le contrôleur du responsable du magasin contient une bonne quantité de code.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-141">The Store Manager Controller contains a good amount of code.</span></span> <span data-ttu-id="3e4cc-142">Passons en revue ce point de haut en bas.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-142">Let's go through this from top to bottom.</span></span> <span data-ttu-id="3e4cc-143">Le contrôleur comprend des espaces de noms standard pour un contrôleur MVC, ainsi qu’une référence à l’espace de noms de nos modèles.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-143">The controller includes some standard namespaces for an MVC controller, as well as a reference to our Models namespace.</span></span> <span data-ttu-id="3e4cc-144">Le contrôleur a une instance privée de MusicStoreEntities, utilisée par chacune des actions de contrôleur pour l’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-144">The controller has a private instance of MusicStoreEntities, used by each of the controller actions for data access.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample3.cs)]

### <a name="store-manager-index-and-details-actions"></a><span data-ttu-id="3e4cc-145">Actions des détails et de l’index du gestionnaire de magasin</span><span class="sxs-lookup"><span data-stu-id="3e4cc-145">Store Manager Index and Details actions</span></span>

<span data-ttu-id="3e4cc-146">La vue index récupère une liste d’albums, y compris les informations relatives au genre et à l’artiste référencées de chaque album, comme nous l’avons vu précédemment lors de l’utilisation de la méthode browse Store.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-146">The index view retrieves a list of Albums, including each album's referenced Genre and Artist information, as we previously saw when working on the Store Browse method.</span></span> <span data-ttu-id="3e4cc-147">La vue index suit les références aux objets liés afin de pouvoir afficher le nom de genre et le nom de l’artiste de chaque album, de sorte que le contrôleur est efficace et interrogeant ces informations dans la requête d’origine.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-147">The Index view is following the references to the linked objects so that it can display each album's Genre name and Artist name, so the controller is being efficient and querying for this information in the original request.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample4.cs)]

<span data-ttu-id="3e4cc-148">L’action du contrôleur des détails du contrôleur StoreManager fonctionne exactement de la même façon que l’action Détails du contrôleur de magasin que nous avons écrite précédemment pour l’album par ID à l’aide de la méthode Find (), puis le renvoie à la vue.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-148">The StoreManager Controller's Details controller action works exactly the same as the Store Controller Details action we wrote previously - it queries for the Album by ID using the Find() method, then returns it to the view.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample5.cs)]

### <a name="the-create-action-methods"></a><span data-ttu-id="3e4cc-149">Méthodes d’action de création</span><span class="sxs-lookup"><span data-stu-id="3e4cc-149">The Create Action Methods</span></span>

<span data-ttu-id="3e4cc-150">Les méthodes d’action Create sont légèrement différentes de celles que nous avons vu jusqu’à présent, car elles gèrent l’entrée de formulaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-150">The Create action methods are a little different from ones we've seen so far, because they handle form input.</span></span> <span data-ttu-id="3e4cc-151">Lorsqu’un utilisateur visite/StoreManager/Create/, il affiche un formulaire vide.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-151">When a user first visits /StoreManager/Create/ they will be shown an empty form.</span></span> <span data-ttu-id="3e4cc-152">Cette page HTML contient une &lt;formulaire&gt; élément qui contient des éléments d’entrée de zone de liste déroulante et de zone de texte où ils peuvent entrer les détails de l’album.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-152">This HTML page will contain a &lt;form&gt; element that contains dropdown and textbox input elements where they can enter the album's details.</span></span>

<span data-ttu-id="3e4cc-153">Une fois que l’utilisateur a renseigné les valeurs de formulaire de l’album, il peut appuyer sur le bouton « enregistrer » pour soumettre ces modifications à notre application afin de l’enregistrer dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-153">After the user fills in the Album form values, they can press the "Save" button to submit these changes back to our application to save within the database.</span></span> <span data-ttu-id="3e4cc-154">Quand l’utilisateur appuie sur le bouton « enregistrer », le formulaire de &lt;&gt; effectue une publication HTTP sur l’URL/StoreManager/Create/et envoie les valeurs de&gt; du formulaire &lt;dans le cadre de la requête HTTP-HTTP.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-154">When the user presses the "save" button the &lt;form&gt; will perform an HTTP-POST back to the /StoreManager/Create/ URL and submit the &lt;form&gt; values as part of the HTTP-POST.</span></span>

<span data-ttu-id="3e4cc-155">ASP.NET MVC nous permet de fractionner facilement la logique de ces deux scénarios d’invocation d’URL en nous permettant d’implémenter deux méthodes d’action « Create » distinctes au sein de notre classe StoreManagerController : une pour gérer l’URL HTTP-aller au/StoreManager/Create/et l’autre pour gérer le HTTP-poster des modifications soumises.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-155">ASP.NET MVC allows us to easily split up the logic of these two URL invocation scenarios by enabling us to implement two separate "Create" action methods within our StoreManagerController class – one to handle the initial HTTP-GET browse to the /StoreManager/Create/ URL, and the other to handle the HTTP-POST of the submitted changes.</span></span>

### <a name="passing-information-to-a-view-using-viewbag"></a><span data-ttu-id="3e4cc-156">Passage d’informations à une vue à l’aide de ViewBag</span><span class="sxs-lookup"><span data-stu-id="3e4cc-156">Passing information to a View using ViewBag</span></span>

<span data-ttu-id="3e4cc-157">Nous avons utilisé le ViewBag précédemment dans ce didacticiel, mais je n’en ai pas parlé.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-157">We've used the ViewBag earlier in this tutorial, but haven't talked much about it.</span></span> <span data-ttu-id="3e4cc-158">ViewBag nous permet de transmettre des informations à la vue sans utiliser d’objet de modèle fortement typé.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-158">The ViewBag allows us to pass information to the view without using a strongly typed model object.</span></span> <span data-ttu-id="3e4cc-159">Dans ce cas, notre action modifier le contrôleur HTTP-obtenir doit transmettre une liste de genres et d’artistes au formulaire pour remplir les listes déroulantes, et le moyen le plus simple de le faire consiste à les retourner en tant qu’éléments ViewBag.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-159">In this case, our Edit HTTP-GET controller action needs to pass both a list of Genres and Artists to the form to populate the dropdowns, and the simplest way to do that is to return them as ViewBag items.</span></span>

<span data-ttu-id="3e4cc-160">ViewBag est un objet dynamique, ce qui signifie que vous pouvez taper ViewBag. foo ou ViewBag. YourNameHere sans écrire de code pour définir ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-160">The ViewBag is a dynamic object, meaning that you can type ViewBag.Foo or ViewBag.YourNameHere without writing code to define those properties.</span></span> <span data-ttu-id="3e4cc-161">Dans ce cas, le code du contrôleur utilise ViewBag. GenreId et ViewBag. ArtistId afin que les valeurs de liste déroulante soumises avec le formulaire soient GenreId et ArtistId, qui sont les propriétés de l’album qui seront configurées.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-161">In this case, the controller code uses ViewBag.GenreId and ViewBag.ArtistId so that the dropdown values submitted with the form will be GenreId and ArtistId, which are the Album properties they will be setting.</span></span>

<span data-ttu-id="3e4cc-162">Ces valeurs de liste déroulante sont retournées au formulaire à l’aide de l’objet SelectList, qui est généré uniquement à cet effet.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-162">These dropdown values are returned to the form using the SelectList object, which is built just for that purpose.</span></span> <span data-ttu-id="3e4cc-163">Pour ce faire, utilisez un code similaire à celui-ci :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-163">This is done using code like this:</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample6.cs)]

<span data-ttu-id="3e4cc-164">Comme vous pouvez le voir dans le code de la méthode d’action, trois paramètres sont utilisés pour créer cet objet :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-164">As you can see from the action method code, three parameters are being used to create this object:</span></span>

- <span data-ttu-id="3e4cc-165">Liste des éléments que la liste déroulante affichera.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-165">The list of items the dropdown will be displaying.</span></span> <span data-ttu-id="3e4cc-166">Notez qu’il ne s’agit pas simplement d’une chaîne. nous passons une liste de genres.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-166">Note that this isn't just a string - we're passing a list of Genres.</span></span>
- <span data-ttu-id="3e4cc-167">Le paramètre suivant passé à SelectList est la valeur sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-167">The next parameter being passed to the SelectList is the Selected Value.</span></span> <span data-ttu-id="3e4cc-168">Cela explique comment le SelectList sait comment présélectionner un élément dans la liste.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-168">This how the SelectList knows how to pre-select an item in the list.</span></span> <span data-ttu-id="3e4cc-169">Cela sera plus facile à comprendre lorsque nous examinerons le formulaire de modification, ce qui est assez similaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-169">This will be easier to understand when we look at the Edit form, which is pretty similar.</span></span>
- <span data-ttu-id="3e4cc-170">Le dernier paramètre est la propriété à afficher.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-170">The final parameter is the property to be displayed.</span></span> <span data-ttu-id="3e4cc-171">Dans ce cas, cela indique que la propriété Genre.Name est celle qui sera affichée à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-171">In this case, this is indicating that the Genre.Name property is what will be shown to the user.</span></span>

<span data-ttu-id="3e4cc-172">Dans ce souci, l’action de création HTTP-is est assez simple-deux SelectLists sont ajoutés au ViewBag, et aucun objet de modèle n’est transmis au formulaire (car il n’a pas encore été créé).</span><span class="sxs-lookup"><span data-stu-id="3e4cc-172">With that in mind, then, the HTTP-GET Create action is pretty simple - two SelectLists are added to the ViewBag, and no model object is passed to the form (since it hasn't been created yet).</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample7.cs)]

### <a name="html-helpers-to-display-the-drop-downs-in-the-create-view"></a><span data-ttu-id="3e4cc-173">Applications auxiliaires HTML pour afficher les listes déroulantes dans la vue Create</span><span class="sxs-lookup"><span data-stu-id="3e4cc-173">HTML Helpers to display the Drop Downs in the Create View</span></span>

<span data-ttu-id="3e4cc-174">Étant donné que nous avons parlé de la façon dont les valeurs de liste déroulante sont passées à la vue, examinons rapidement la vue pour voir comment ces valeurs sont affichées.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-174">Since we've talked about how the drop down values are passed to the view, let's take a quick look at the view to see how those values are displayed.</span></span> <span data-ttu-id="3e4cc-175">Dans le code de vue (/Views/StoreManager/Create.cshtml), vous verrez que l’appel suivant est effectué pour afficher la liste déroulante de genres.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-175">In the view code (/Views/StoreManager/Create.cshtml), you'll see the following call is made to display the Genre drop down.</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample8.cshtml)]

<span data-ttu-id="3e4cc-176">C’est ce qu’on appelle un programme d’assistance HTML, une méthode utilitaire qui effectue une tâche d’affichage courante.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-176">This is known as an HTML Helper - a utility method which performs a common view task.</span></span> <span data-ttu-id="3e4cc-177">Les applications auxiliaires HTML sont très utiles pour maintenir le code de vue concis et lisible.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-177">HTML Helpers are very useful in keeping our view code concise and readable.</span></span> <span data-ttu-id="3e4cc-178">Le programme d’assistance HTML. DropDownList est fourni par ASP.NET MVC, mais comme nous le verrons ultérieurement, il est possible de créer nos propres aide pour le code de vue que nous allons réutiliser dans notre application.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-178">The Html.DropDownList helper is provided by ASP.NET MVC, but as we'll see later it's possible to create our own helpers for view code we'll reuse in our application.</span></span>

<span data-ttu-id="3e4cc-179">L’appel HTML. DropDownList doit simplement être indiqué deux choses : où obtenir la liste à afficher et la valeur (le cas échéant) doit être présélectionnée.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-179">The Html.DropDownList call just needs to be told two things - where to get the list to display, and what value (if any) should be pre-selected.</span></span> <span data-ttu-id="3e4cc-180">Le premier paramètre, GenreId, indique à DropDownList de rechercher une valeur nommée GenreId dans le modèle ou ViewBag.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-180">The first parameter, GenreId, tells the DropDownList to look for a value named GenreId in either the model or ViewBag.</span></span> <span data-ttu-id="3e4cc-181">Le deuxième paramètre est utilisé pour indiquer la valeur à afficher comme étant initialement sélectionné dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-181">The second parameter is used to indicate the value to show as initially selected in the drop down list.</span></span> <span data-ttu-id="3e4cc-182">Dans la mesure où ce formulaire est un formulaire de création, il n’y a aucune valeur à présélectionner et String. Empty est passé.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-182">Since this form is a Create form, there's no value to be preselected and String.Empty is passed.</span></span>

### <a name="handling-the-posted-form-values"></a><span data-ttu-id="3e4cc-183">Gestion des valeurs de formulaire publiées</span><span class="sxs-lookup"><span data-stu-id="3e4cc-183">Handling the Posted Form values</span></span>

<span data-ttu-id="3e4cc-184">Comme nous l’avons vu précédemment, il existe deux méthodes d’action associées à chaque formulaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-184">As we discussed before, there are two action methods associated with each form.</span></span> <span data-ttu-id="3e4cc-185">La première gère la requête HTTP-obtenir et affiche le formulaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-185">The first handles the HTTP-GET request and displays the form.</span></span> <span data-ttu-id="3e4cc-186">La seconde gère la requête HTTP-POSTCONNEXION, qui contient les valeurs de formulaire soumises.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-186">The second handles the HTTP-POST request, which contains the submitted form values.</span></span> <span data-ttu-id="3e4cc-187">Notez que l’action du contrôleur possède un attribut [HttpPost], qui indique à ASP.NET MVC qu’il doit répondre uniquement aux requêtes HTTP-POSTCONNEXION.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-187">Notice that controller action has an [HttpPost] attribute, which tells ASP.NET MVC that it should only respond to HTTP-POST requests.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample9.cs)]

<span data-ttu-id="3e4cc-188">Cette action a quatre responsabilités :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-188">This action has four responsibilities:</span></span>

- 1. <span data-ttu-id="3e4cc-189">Lire les valeurs de formulaire</span><span class="sxs-lookup"><span data-stu-id="3e4cc-189">Read the form values</span></span>
- 2. <span data-ttu-id="3e4cc-190">Vérifier si les valeurs de formulaire passent des règles de validation</span><span class="sxs-lookup"><span data-stu-id="3e4cc-190">Check if the form values pass any validation rules</span></span>
- 3. <span data-ttu-id="3e4cc-191">Si l’envoi du formulaire est valide, enregistrez les données et affichez la liste mise à jour.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-191">If the form submission is valid, save the data and display the updated list</span></span>
- 4. <span data-ttu-id="3e4cc-192">Si l’envoi du formulaire n’est pas valide, réaffichez le formulaire avec des erreurs de validation</span><span class="sxs-lookup"><span data-stu-id="3e4cc-192">If the form submission is not valid, redisplay the form with validation errors</span></span>

#### <a name="reading-form-values-with-model-binding"></a><span data-ttu-id="3e4cc-193">Lecture des valeurs de formulaire avec la liaison de modèle</span><span class="sxs-lookup"><span data-stu-id="3e4cc-193">Reading Form Values with Model Binding</span></span>

<span data-ttu-id="3e4cc-194">L’action du contrôleur traite une soumission de formulaire qui comprend des valeurs pour GenreId et ArtistId (dans la liste déroulante) et des valeurs de zone de texte pour titre, Price et AlbumArtUrl.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-194">The controller action is processing a form submission that includes values for GenreId and ArtistId (from the drop down list) and textbox values for Title, Price, and AlbumArtUrl.</span></span> <span data-ttu-id="3e4cc-195">Bien qu’il soit possible d’accéder directement aux valeurs de formulaire, une meilleure approche consiste à utiliser les fonctionnalités de liaison de modèle intégrées à ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-195">While it's possible to directly access form values, a better approach is to use the Model Binding capabilities built into ASP.NET MVC.</span></span> <span data-ttu-id="3e4cc-196">Lorsqu’une action de contrôleur accepte un type de modèle en tant que paramètre, ASP.NET MVC tente de remplir un objet de ce type à l’aide des entrées de formulaire (ainsi que des valeurs de routage et QueryString).</span><span class="sxs-lookup"><span data-stu-id="3e4cc-196">When a controller action takes a model type as a parameter, ASP.NET MVC will attempt to populate an object of that type using form inputs (as well as route and querystring values).</span></span> <span data-ttu-id="3e4cc-197">Pour ce faire, il recherche des valeurs dont les noms correspondent aux propriétés de l’objet de modèle, par exemple lors de la définition de la valeur GenreId de l’objet album, il recherche une entrée portant le nom GenreId.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-197">It does this by looking for values whose names match properties of the model object, e.g. when setting the new Album object's GenreId value, it looks for an input with the name GenreId.</span></span> <span data-ttu-id="3e4cc-198">Lorsque vous créez des vues à l’aide des méthodes standard dans ASP.NET MVC, les formulaires sont toujours rendus à l’aide de noms de propriété en tant que noms de champ d’entrée, ce qui signifie que les noms de champs correspondent simplement.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-198">When you create views using the standard methods in ASP.NET MVC, the forms will always be rendered using property names as input field names, so this the field names will just match up.</span></span>

#### <a name="validating-the-model"></a><span data-ttu-id="3e4cc-199">Validation du modèle</span><span class="sxs-lookup"><span data-stu-id="3e4cc-199">Validating the Model</span></span>

<span data-ttu-id="3e4cc-200">Le modèle est validé avec un simple appel à ModelState. IsValid.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-200">The model is validated with a simple call to ModelState.IsValid.</span></span> <span data-ttu-id="3e4cc-201">Nous n’avons pas encore ajouté de règles de validation à notre classe album. nous allons le faire dans un instant, à ce stade, ce contrôle n’a pas grand-chose à faire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-201">We haven't added any validation rules to our Album class yet - we'll do that in a bit - so right now this check doesn't have much to do.</span></span> <span data-ttu-id="3e4cc-202">Ce qui est important, c’est que ce contrôle ModelStat. IsValid s’adaptera aux règles de validation que nous plaçons dans notre modèle. par conséquent, les modifications ultérieures apportées aux règles de validation ne nécessitent aucune mise à jour du code d’action du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-202">What's important is that this ModelStat.IsValid check will adapt to the validation rules we put on our model, so future changes to validation rules won't require any updates to the controller action code.</span></span>

#### <a name="saving-the-submitted-values"></a><span data-ttu-id="3e4cc-203">Enregistrement des valeurs soumises</span><span class="sxs-lookup"><span data-stu-id="3e4cc-203">Saving the submitted values</span></span>

<span data-ttu-id="3e4cc-204">Si l’envoi du formulaire réussit la validation, il est temps d’enregistrer les valeurs dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-204">If the form submission passes validation, it's time to save the values to the database.</span></span> <span data-ttu-id="3e4cc-205">Avec Entity Framework, il suffit d’ajouter le modèle à la collection d’albums et d’appeler SaveChanges.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-205">With Entity Framework, that just requires adding the model to the Albums collection and calling SaveChanges.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample10.cs)]

<span data-ttu-id="3e4cc-206">Entity Framework génère les commandes SQL appropriées pour rendre la valeur persistante.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-206">Entity Framework generates the appropriate SQL commands to persist the value.</span></span> <span data-ttu-id="3e4cc-207">Une fois les données enregistrées, nous redirigeons vers la liste des albums pour voir notre mise à jour.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-207">After saving the data, we redirect back to the list of Albums so we can see our update.</span></span> <span data-ttu-id="3e4cc-208">Pour ce faire, vous devez retourner RedirectToAction avec le nom de l’action de contrôleur que nous souhaitons afficher.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-208">This is done by returning RedirectToAction with the name of the controller action we want displayed.</span></span> <span data-ttu-id="3e4cc-209">Dans ce cas, il s’agit de la méthode d’index.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-209">In this case, that's the Index method.</span></span>

#### <a name="displaying-invalid-form-submissions-with-validation-errors"></a><span data-ttu-id="3e4cc-210">Affichage des envois de formulaire non valides avec des erreurs de validation</span><span class="sxs-lookup"><span data-stu-id="3e4cc-210">Displaying invalid form submissions with Validation Errors</span></span>

<span data-ttu-id="3e4cc-211">Dans le cas d’une entrée de formulaire non valide, les valeurs de liste déroulante sont ajoutées au ViewBag (comme dans le cas HTTP-alobtenu) et les valeurs de modèle liées sont retournées à la vue pour l’affichage.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-211">In the case of invalid form input, the dropdown values are added to the ViewBag (as in the HTTP-GET case) and the bound model values are passed back to the view for display.</span></span> <span data-ttu-id="3e4cc-212">Les erreurs de validation s’affichent automatiquement à l’aide du programme d’assistance HTML @Html.ValidationMessageFor.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-212">Validation errors are automatically displayed using the @Html.ValidationMessageFor HTML Helper.</span></span>

#### <a name="testing-the-create-form"></a><span data-ttu-id="3e4cc-213">Test du formulaire de création</span><span class="sxs-lookup"><span data-stu-id="3e4cc-213">Testing the Create Form</span></span>

<span data-ttu-id="3e4cc-214">Pour tester cela, exécutez l’application et accédez à/StoreManager/Create/. cette opération affiche le formulaire vide qui a été retourné par la méthode StoreController Create HTTP-obten.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-214">To test this out, run the application and browse to /StoreManager/Create/ - this will show you the blank form which was returned by the StoreController Create HTTP-GET method.</span></span>

<span data-ttu-id="3e4cc-215">Renseignez certaines valeurs et cliquez sur le bouton créer pour envoyer le formulaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-215">Fill in some values and click the Create button to submit the form.</span></span>

![](mvc-music-store-part-5/_static/image7.png)

![](mvc-music-store-part-5/_static/image8.png)

### <a name="handling-edits"></a><span data-ttu-id="3e4cc-216">Gestion des modifications</span><span class="sxs-lookup"><span data-stu-id="3e4cc-216">Handling Edits</span></span>

<span data-ttu-id="3e4cc-217">La paire d’actions de modification (HTTP-obten et HTTP-poster) est très similaire aux méthodes d’action de création que nous venons de regarder.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-217">The Edit action pair (HTTP-GET and HTTP-POST) are very similar to the Create action methods we just looked at.</span></span> <span data-ttu-id="3e4cc-218">Étant donné que le scénario de modification implique l’utilisation d’un album existant, la méthode Edit HTTP-obten charge l’album en fonction du paramètre « ID », passé par le biais de l’itinéraire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-218">Since the edit scenario involves working with an existing album, the Edit HTTP-GET method loads the Album based on the "id" parameter, passed in via the route.</span></span> <span data-ttu-id="3e4cc-219">Ce code pour récupérer un album par AlbumId est identique à celui que nous avons précédemment consulté dans l’action Détails Controller.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-219">This code for retrieving an album by AlbumId is the same as we've previously looked at in the Details controller action.</span></span> <span data-ttu-id="3e4cc-220">Comme avec la méthode Create/HTTP-obten, les valeurs de liste déroulante sont retournées via ViewBag.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-220">As with the Create / HTTP-GET method, the drop down values are returned via the ViewBag.</span></span> <span data-ttu-id="3e4cc-221">Cela nous permet de retourner un album en tant qu’objet de modèle à la vue (qui est fortement typée dans la classe album) tout en passant des données supplémentaires (par exemple, une liste de genres) via ViewBag.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-221">This allows us to return an Album as our model object to the view (which is strongly typed to the Album class) while passing additional data (e.g. a list of Genres) via the ViewBag.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample11.cs)]

<span data-ttu-id="3e4cc-222">L’action modifier le protocole HTTP-poster est très similaire à l’action créer HTTP-poster.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-222">The Edit HTTP-POST action is very similar to the Create HTTP-POST action.</span></span> <span data-ttu-id="3e4cc-223">La seule différence est qu’au lieu d’ajouter un nouvel album à la base de la base de la. Collection d’albums, nous avons trouvé l’instance actuelle de l’album à l’aide de DB. Entrée (album) et définition de son état sur modifié.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-223">The only difference is that instead of adding a new album to the db.Albums collection, we're finding the current instance of the Album using db.Entry(album) and setting its state to Modified.</span></span> <span data-ttu-id="3e4cc-224">Cela indique Entity Framework que nous modifions un album existant au lieu d’en créer un nouveau.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-224">This tells Entity Framework that we are modifying an existing album as opposed to creating a new one.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample12.cs)]

<span data-ttu-id="3e4cc-225">Nous pouvons tester cela en exécutant l’application et en accédant à/StoreManger/, puis en cliquant sur le lien Modifier pour un album.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-225">We can test this out by running the application and browsing to /StoreManger/, then clicking the Edit link for an album.</span></span>

![](mvc-music-store-part-5/_static/image9.png)

<span data-ttu-id="3e4cc-226">Cela permet d’afficher le formulaire de modification affiché par la méthode de modification HTTP-obtient.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-226">This displays the Edit form shown by the Edit HTTP-GET method.</span></span> <span data-ttu-id="3e4cc-227">Renseignez certaines valeurs et cliquez sur le bouton enregistrer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-227">Fill in some values and click the Save button.</span></span>

![](mvc-music-store-part-5/_static/image10.png)

<span data-ttu-id="3e4cc-228">Cette opération publie le formulaire, enregistre les valeurs et nous renvoie à la liste d’albums, indiquant que les valeurs ont été mises à jour.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-228">This posts the form, saves the values, and returns us to the Album list, showing that the values were updated.</span></span>

![](mvc-music-store-part-5/_static/image11.png)

### <a name="handling-deletion"></a><span data-ttu-id="3e4cc-229">Gestion de la suppression</span><span class="sxs-lookup"><span data-stu-id="3e4cc-229">Handling Deletion</span></span>

<span data-ttu-id="3e4cc-230">La suppression suit le même modèle que modifier et créer, à l’aide d’une action de contrôleur pour afficher le formulaire de confirmation, et d’une autre action de contrôleur pour gérer l’envoi de formulaire.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-230">Deletion follows the same pattern as Edit and Create, using one controller action to display the confirmation form, and another controller action to handle the form submission.</span></span>

<span data-ttu-id="3e4cc-231">L’action HTTP-récupérer la suppression du contrôleur est exactement la même que celle de l’action précédente du contrôleur Store Manager.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-231">The HTTP-GET Delete controller action is exactly the same as our previous Store Manager Details controller action.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample13.cs)]

<span data-ttu-id="3e4cc-232">Nous affichons un formulaire fortement typé dans un type d’album, à l’aide du modèle de contenu supprimer la vue.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-232">We display a form that's strongly typed to an Album type, using the Delete view content template.</span></span>

![](mvc-music-store-part-5/_static/image12.png)

<span data-ttu-id="3e4cc-233">Le modèle de suppression affiche tous les champs du modèle, mais nous pouvons le simplifier un peu plus longtemps.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-233">The Delete template shows all the fields for the model, but we can simplify that down quite a bit.</span></span> <span data-ttu-id="3e4cc-234">Modifiez le code de vue dans/Views/StoreManager/Delete.cshtml comme suit.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-234">Change the view code in /Views/StoreManager/Delete.cshtml to the following.</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample14.cshtml)]

<span data-ttu-id="3e4cc-235">Cela permet d’afficher une confirmation de suppression simplifiée.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-235">This displays a simplified Delete confirmation.</span></span>

![](mvc-music-store-part-5/_static/image13.png)

<span data-ttu-id="3e4cc-236">Si vous cliquez sur le bouton supprimer, le formulaire est publié sur le serveur, ce qui entraîne l’exécution de l’action DeleteConfirmed.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-236">Clicking the Delete button causes the form to be posted back to the server, which executes the DeleteConfirmed action.</span></span>

[!code-csharp[Main](mvc-music-store-part-5/samples/sample15.cs)]

<span data-ttu-id="3e4cc-237">Notre action de contrôleur HTTP-après suppression effectue les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="3e4cc-237">Our HTTP-POST Delete Controller Action takes the following actions:</span></span>

- 1. <span data-ttu-id="3e4cc-238">Charge l’album par ID</span><span class="sxs-lookup"><span data-stu-id="3e4cc-238">Loads the Album by ID</span></span>
- 2. <span data-ttu-id="3e4cc-239">Supprime l’album et enregistre les modifications</span><span class="sxs-lookup"><span data-stu-id="3e4cc-239">Deletes it the album and save changes</span></span>
- 3. <span data-ttu-id="3e4cc-240">Redirige vers l’index, indiquant que l’album a été supprimé de la liste</span><span class="sxs-lookup"><span data-stu-id="3e4cc-240">Redirects to the Index, showing that the Album was removed from the list</span></span>

<span data-ttu-id="3e4cc-241">Pour tester cela, exécutez l’application et accédez à/StoreManager.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-241">To test this, run the application and browse to /StoreManager.</span></span> <span data-ttu-id="3e4cc-242">Sélectionnez un album dans la liste et cliquez sur le lien supprimer.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-242">Select an album from the list and click the Delete link.</span></span>

![](mvc-music-store-part-5/_static/image14.png)

<span data-ttu-id="3e4cc-243">L’écran de confirmation de la suppression s’affiche.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-243">This displays our Delete confirmation screen.</span></span>

![](mvc-music-store-part-5/_static/image15.png)

<span data-ttu-id="3e4cc-244">Le fait de cliquer sur le bouton Supprimer permet de supprimer l’album et de revenir à la page index du responsable du magasin, qui indique que l’album a été supprimé.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-244">Clicking the Delete button removes the album and returns us to the Store Manager Index page, which shows that the album has been deleted.</span></span>

![](mvc-music-store-part-5/_static/image16.png)

### <a name="using-a-custom-html-helper-to-truncate-text"></a><span data-ttu-id="3e4cc-245">Utilisation d’un programme d’assistance HTML personnalisé pour tronquer du texte</span><span class="sxs-lookup"><span data-stu-id="3e4cc-245">Using a custom HTML Helper to truncate text</span></span>

<span data-ttu-id="3e4cc-246">Nous avons rencontré un problème potentiel avec notre page d’index Store Manager.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-246">We've got one potential issue with our Store Manager Index page.</span></span> <span data-ttu-id="3e4cc-247">Les propriétés titre de l’album et nom de l’artiste peuvent être suffisamment longues pour pouvoir lever la mise en forme de la table.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-247">Our Album Title and Artist Name properties can both be long enough that they could throw off our table formatting.</span></span> <span data-ttu-id="3e4cc-248">Nous allons créer une application auxiliaire HTML personnalisée pour nous permettre de tronquer facilement ces propriétés et d’autres dans nos vues.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-248">We'll create a custom HTML Helper to allow us to easily truncate these and other properties in our Views.</span></span>

![](mvc-music-store-part-5/_static/image17.png)

<span data-ttu-id="3e4cc-249">La syntaxe de @helper de Razor a rendu assez facile de créer vos propres fonctions d’assistance pour une utilisation dans vos vues.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-249">Razor's @helper syntax has made it pretty easy to create your own helper functions for use in your views.</span></span> <span data-ttu-id="3e4cc-250">Ouvrez la vue/Views/StoreManager/Index.cshtml et ajoutez le code suivant directement après la ligne de @model.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-250">Open the /Views/StoreManager/Index.cshtml view and add the following code directly after the @model line.</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample16.cshtml)]

<span data-ttu-id="3e4cc-251">Cette méthode d’assistance prend une chaîne et une longueur maximale à autoriser.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-251">This helper method takes a string and a maximum length to allow.</span></span> <span data-ttu-id="3e4cc-252">Si le texte fourni est plus petit que la longueur spécifiée, le programme d’assistance le renvoie tel quel.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-252">If the text supplied is shorter than the length specified, the helper outputs it as-is.</span></span> <span data-ttu-id="3e4cc-253">Si elle est plus longue, elle tronque le texte et affiche « ... » pour le reste.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-253">If it is longer, then it truncates the text and renders "…" for the remainder.</span></span>

<span data-ttu-id="3e4cc-254">Nous pouvons maintenant utiliser notre application auxiliaire TRUNCATE pour vous assurer que les propriétés titre de l’album et nom de l’artiste sont inférieures à 25 caractères.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-254">Now we can use our Truncate helper to ensure that both the Album Title and Artist Name properties are less than 25 characters.</span></span> <span data-ttu-id="3e4cc-255">Le code complet de la vue à l’aide de notre nouvelle application d’assistance TRUNCATE apparaît ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-255">The complete view code using our new Truncate helper appears below.</span></span>

[!code-cshtml[Main](mvc-music-store-part-5/samples/sample17.cshtml)]

<span data-ttu-id="3e4cc-256">Désormais, lorsque nous parcourons l’URL/StoreManager/, les albums et les titres sont conservés en dessous de nos longueurs maximales.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-256">Now when we browse the /StoreManager/ URL, the albums and titles are kept below our maximum lengths.</span></span>

![](mvc-music-store-part-5/_static/image18.png)

<span data-ttu-id="3e4cc-257">Remarque : cela montre le cas simple de création et d’utilisation d’une application d’assistance dans une vue.</span><span class="sxs-lookup"><span data-stu-id="3e4cc-257">Note: This shows the simple case of creating and using a helper in one view.</span></span> <span data-ttu-id="3e4cc-258">Pour en savoir plus sur la création d’applications d’assistance que vous pouvez utiliser dans votre site, consultez mon billet de blog : [http://bit.ly/mvc3-helper-options](http://bit.ly/mvc3-helper-options)</span><span class="sxs-lookup"><span data-stu-id="3e4cc-258">To learn more about creating helpers that you can use throughout your site, see my blog post: [http://bit.ly/mvc3-helper-options](http://bit.ly/mvc3-helper-options)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3e4cc-259">[Précédent](mvc-music-store-part-4.md)
> [Suivant](mvc-music-store-part-6.md)</span><span class="sxs-lookup"><span data-stu-id="3e4cc-259">[Previous](mvc-music-store-part-4.md)
[Next](mvc-music-store-part-6.md)</span></span>
