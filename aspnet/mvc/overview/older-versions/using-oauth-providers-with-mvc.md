---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: À l’aide de fournisseurs OAuth avec MVC 4 | Microsoft Docs
author: Rick-Anderson
description: Ce didacticiel vous montre comment créer une application web ASP.NET MVC 4 qui permet aux utilisateurs de se connecter avec leurs informations d’identification à partir d’un fournisseur externe, tel que Facebo...
ms.author: riande
ms.date: 06/19/2013
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: c2fe74c3d7b1aa0d230f1893f6ba7dcaa7a88419
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/09/2019
ms.locfileid: "59396979"
---
# <a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="ac9c8-103">Utilisation de fournisseurs OAuth avec MVC 4</span><span class="sxs-lookup"><span data-stu-id="ac9c8-103">Using OAuth Providers with MVC 4</span></span>

<span data-ttu-id="ac9c8-104">par [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="ac9c8-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="ac9c8-105">Ce didacticiel vous montre comment créer une application web ASP.NET MVC 4 qui permet aux utilisateurs de se connecter avec des informations d’identification à partir d’un fournisseur externe, tels que Facebook, Twitter, Microsoft ou Google et l’intégrer ensuite certaines des fonctionnalités à partir de ces fournisseurs dans votre application Web.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="ac9c8-106">Par souci de simplicité, ce didacticiel se concentre sur l’utilisation des informations d’identification à partir de Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="ac9c8-107">Pour utiliser les informations d’identification externes dans une application web ASP.NET MVC 5, consultez [créer une application ASP.NET MVC 5 avec Facebook et Google OAuth2 et OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="ac9c8-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="ac9c8-108">L’activation de ces informations d’identification dans vos sites web de fournit un avantage significatif, car des millions d’utilisateurs disposent déjà de comptes avec ces fournisseurs externes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="ac9c8-109">Ces utilisateurs peuvent être plus de chances de s’inscrire à votre site si elles n’ont pas à créer et à mémoriser un nouvel ensemble d’informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="ac9c8-110">En outre, une fois un utilisateur s’est connecté via un de ces fournisseurs, vous pouvez incorporer des opérations réseau sociales à partir du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="ac9c8-111">Vous allez générer</span><span class="sxs-lookup"><span data-stu-id="ac9c8-111">What you'll build</span></span>

<span data-ttu-id="ac9c8-112">Il existe deux principaux objectifs dans ce didacticiel :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="ac9c8-113">Permettre aux utilisateurs de se connecter avec des informations d’identification d’un fournisseur OAuth.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="ac9c8-114">Récupérer des informations de compte à partir du fournisseur et intégrer ces informations à l’inscription de compte pour votre site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="ac9c8-115">Bien que les exemples de ce didacticiel vous concentrer sur l’utilisation de Facebook comme fournisseur d’authentification, vous pouvez modifier le code pour utiliser un des fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="ac9c8-116">Les étapes pour implémenter n’importe quel fournisseur sont très similaires à celles que vous voyez dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="ac9c8-117">Vous remarquez des différences significatives lors des appels directs à l’API du fournisseur défini.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="ac9c8-118">Prérequis</span><span class="sxs-lookup"><span data-stu-id="ac9c8-118">Prerequisites</span></span>

- <span data-ttu-id="ac9c8-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) ou [Microsoft Visual Studio Express 2012 pour le Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="ac9c8-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="ac9c8-120">Ou</span><span class="sxs-lookup"><span data-stu-id="ac9c8-120">Or</span></span>

- <span data-ttu-id="ac9c8-121">Microsoft Visual Studio 2010 SP1 ou [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="ac9c8-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="ac9c8-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="ac9c8-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="ac9c8-123">En outre, cette rubrique part du principe que vous avez des connaissances de base sur ASP.NET MVC et Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="ac9c8-124">Si vous avez besoin d’une introduction à ASP.NET MVC 4, consultez [Introduction à ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="ac9c8-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="ac9c8-125">Créer le projet</span><span class="sxs-lookup"><span data-stu-id="ac9c8-125">Create the project</span></span>

<span data-ttu-id="ac9c8-126">Dans Visual Studio, créez une nouvelle Application Web ASP.NET MVC 4 et nommez-le &quot;OAuthMVC&quot;.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="ac9c8-127">Vous pouvez cibler .NET Framework 4.5 ou 4.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-127">You can target either .NET Framework 4.5 or 4.</span></span>

![créer le projet](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="ac9c8-129">Dans la fenêtre Nouveau projet ASP.NET MVC 4, sélectionnez **Application Internet** et laissez **Razor** en tant que le moteur d’affichage.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Sélectionnez l’Application Internet](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="ac9c8-131">Activer un fournisseur</span><span class="sxs-lookup"><span data-stu-id="ac9c8-131">Enable a provider</span></span>

<span data-ttu-id="ac9c8-132">Lorsque vous créez une application web MVC 4 avec le modèle d’Application Internet, le projet est créé avec un fichier nommé AuthConfig.cs dans l’application\_dossier de démarrage.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![Fichier de AuthConfig](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="ac9c8-134">Le fichier AuthConfig contient le code pour inscrire les clients pour les fournisseurs d’authentification externes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="ac9c8-135">Par défaut, ce code est commenté pour aucun des fournisseurs externes sont activés.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="ac9c8-136">Vous devez supprimez les commentaires de ce code pour utiliser le client d’authentification externe.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="ac9c8-137">Vous supprimez les commentaires uniquement les fournisseurs que vous souhaitez inclure dans votre site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="ac9c8-138">Pour ce didacticiel, vous allez uniquement activer les informations d’identification Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="ac9c8-139">Notez que, dans l’exemple ci-dessus est que la méthode inclut des chaînes vides pour les paramètres d’inscription.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="ac9c8-140">Si vous essayez d’exécuter l’application maintenant, l’application lève une exception d’argument, car les chaînes vides ne sont pas autorisés pour les paramètres.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="ac9c8-141">Pour fournir des valeurs valides, vous devez inscrire votre site web avec les fournisseurs externes, comme indiqué dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="ac9c8-142">L’inscription auprès d’un fournisseur externe</span><span class="sxs-lookup"><span data-stu-id="ac9c8-142">Registering with an external provider</span></span>

<span data-ttu-id="ac9c8-143">Pour authentifier les utilisateurs avec les informations d’identification à partir d’un fournisseur externe, vous devez inscrire votre site web avec le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="ac9c8-144">Lorsque vous inscrivez votre site, vous recevrez les paramètres (tels que la clé ou id et clé secrète) pour inclure lors de l’inscription du client.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="ac9c8-145">Vous devez disposer d’un compte avec les fournisseurs que vous souhaitez utiliser.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="ac9c8-146">Ce didacticiel n’affiche pas toutes les étapes que vous devez effectuer pour vous inscrire avec ces fournisseurs.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="ac9c8-147">Les étapes ne sont généralement pas difficile.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-147">The steps are typically not difficult.</span></span> <span data-ttu-id="ac9c8-148">Pour enregistrer correctement votre site, suivez les instructions fournies sur ces sites.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="ac9c8-149">Pour commencer l’inscription de votre site, consultez le site de développeur pour :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="ac9c8-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="ac9c8-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="ac9c8-151">Google</span><span class="sxs-lookup"><span data-stu-id="ac9c8-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="ac9c8-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="ac9c8-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="ac9c8-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="ac9c8-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="ac9c8-154">Lors de l’inscription de votre site avec Facebook, vous pouvez fournir &quot;localhost&quot; pour le domaine du site et `&quot;http://localhost/&quot;` pour l’URL, comme indiqué dans l’image ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="ac9c8-155">En utilisant localhost fonctionne avec la plupart des fournisseurs, mais ne fonctionne pas actuellement avec le fournisseur de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="ac9c8-156">Pour le fournisseur de Microsoft, vous devez inclure une URL de site web valide.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![inscription de site](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="ac9c8-158">Dans l’image précédente, les valeurs de l’id d’application, clé secrète d’application et e-mail de contact ont été supprimés.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="ac9c8-159">Lorsque vous inscrivez en fait votre site, ces valeurs seront présents.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="ac9c8-160">Vous devez noter les valeurs pour l’id d’application et secret d’application car vous allez les ajouter à votre application.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="ac9c8-161">Création d’utilisateurs de test</span><span class="sxs-lookup"><span data-stu-id="ac9c8-161">Creating test users</span></span>

<span data-ttu-id="ac9c8-162">Si vous occupez pas à l’aide d’un compte Facebook existant pour tester votre site, vous pouvez ignorer cette section.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="ac9c8-163">Vous pouvez facilement créer des utilisateurs de test pour votre application au sein de la page de gestion d’application Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="ac9c8-164">Vous pouvez utiliser ces comptes pour vous connecter à votre site de test.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="ac9c8-165">Vous créez des utilisateurs de test en cliquant sur le **rôles** lien dans le volet de navigation gauche et le clic le **créer** lien.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![créer des utilisateurs de test](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="ac9c8-167">Le site Facebook crée automatiquement le nombre de comptes de test que vous demandez.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="ac9c8-168">Ajout d’id d’application et la clé secrète à partir du fournisseur</span><span class="sxs-lookup"><span data-stu-id="ac9c8-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="ac9c8-169">Maintenant que vous avez reçu l’id et la clé secrète à partir de Facebook, revenez au fichier AuthConfig et ajoutez-les en tant que les valeurs de paramètre.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="ac9c8-170">Les valeurs indiquées ci-dessous ne sont pas des valeurs réelles.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="ac9c8-171">Se connecter avec des informations d’identification externes</span><span class="sxs-lookup"><span data-stu-id="ac9c8-171">Log in with external credentials</span></span>

<span data-ttu-id="ac9c8-172">Voilà, il vous suffit pour activer les informations d’identification externes dans votre site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="ac9c8-173">Exécutez votre application et cliquez sur le lien de connexion dans le coin supérieur droit.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="ac9c8-174">Le modèle reconnaît automatiquement que vous avez inscrit Facebook en tant que fournisseur et inclut un bouton pour le fournisseur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="ac9c8-175">Si vous inscrivez plusieurs fournisseurs, un bouton pour chacun d'entre eux est automatiquement inclus.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![connexion externe](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="ac9c8-177">Ce didacticiel ne couvre pas comment personnaliser le journal des boutons pour les fournisseurs externes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="ac9c8-178">Pour plus d’informations, consultez [personnalisation de l’interface utilisateur de connexion lors de l’utilisation de OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac9c8-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="ac9c8-179">Cliquez sur le bouton de Facebook pour vous connecter avec leurs identifiants Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="ac9c8-180">Lorsque vous sélectionnez un des fournisseurs externes, vous êtes redirigé vers ce site et vous y êtes invité par ce service pour vous connecter.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="ac9c8-181">L’illustration suivante montre l’écran de connexion pour Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="ac9c8-182">Il remarque que vous utilisez votre compte Facebook pour vous connecter à un site nommé oauthmvcexample.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![authentification Facebook](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="ac9c8-184">Une fois connecté avec les informations d’identification Facebook, une page informe l’utilisateur que le site aura accès aux informations de base.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![demander l’autorisation](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="ac9c8-186">Après avoir sélectionné **accéder à l’application**, l’utilisateur doit enregistrer pour le site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="ac9c8-187">L’illustration suivante montre la page d’inscription après qu’un utilisateur a ouvert une session avec leurs identifiants Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="ac9c8-188">Le nom d’utilisateur est généralement préremplie avec un nom à partir du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-188">The user name is typically pre-filled with a name from the provider.</span></span>

![register](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="ac9c8-190">Cliquez sur **inscrire** pour terminer l’inscription.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="ac9c8-191">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-191">Close the browser.</span></span>

<span data-ttu-id="ac9c8-192">Vous pouvez voir que le nouveau compte a été ajouté à votre base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="ac9c8-193">Dans l’Explorateur de serveurs, ouvrez le **DefaultConnection** de base de données et ouvrez le **Tables** dossier.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![tables de base de données](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="ac9c8-195">Avec le bouton droit le **UserProfile** de table et sélectionnez **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![afficher les données](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="ac9c8-197">Vous verrez le nouveau compte que vous avez ajouté.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-197">You will see the new account you added.</span></span> <span data-ttu-id="ac9c8-198">Examiner les données dans **page Web\_OAuthMembership** table.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="ac9c8-199">Vous verrez plus de données liées au fournisseur externe pour le compte que vous venez d’ajouter.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="ac9c8-200">Si vous souhaitez uniquement activer l’authentification externe, vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="ac9c8-201">Toutefois, vous pouvez intégrer à partir du fournisseur d’informations dans le nouveau processus de l’inscription de l’utilisateur, comme indiqué dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="ac9c8-202">Créer des modèles pour des informations utilisateur supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ac9c8-202">Create models for additional user information</span></span>

<span data-ttu-id="ac9c8-203">Comme vous remarqué dans les sections précédentes, vous n’avez pas besoin récupérer des informations supplémentaires pour l’inscription de compte intégré fonctionner.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="ac9c8-204">Toutefois, la plupart de ces fournisseurs passer revenir plus d’informations sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="ac9c8-205">Les sections suivantes vous montrent comment conserver ces informations et l’enregistrer dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="ac9c8-206">Plus précisément, vous conserverez les valeurs pour le nom complet de l’utilisateur, l’URI de page web personnelle de l’utilisateur et une valeur qui indique si Facebook a vérifié le compte.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="ac9c8-207">Vous allez utiliser [Migrations Code First](https://msdn.microsoft.com/data/jj591621) pour ajouter une table pour stocker des informations utilisateur supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-207">You will use [Code First Migrations](https://msdn.microsoft.com/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="ac9c8-208">Vous ajoutez la table à une base de données existante, donc vous devez d’abord créer un instantané de la base de données actuelle.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="ac9c8-209">En créant un instantané de la base de données en cours, vous pourrez créer ultérieurement une migration qui contient uniquement la nouvelle table.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="ac9c8-210">Pour créer un instantané de la base de données actuelle :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="ac9c8-211">Ouvrez le **Console du Gestionnaire de Package**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="ac9c8-212">Exécutez la commande **enable-migrations**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="ac9c8-213">Exécutez la commande **ajouter-migration initial – IgnoreChanges**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="ac9c8-214">Exécutez la commande **mise à jour la base de données**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-214">Run the command **update-database**</span></span>

<span data-ttu-id="ac9c8-215">À présent, vous allez ajouter les nouvelles propriétés.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-215">Now, you will add the new properties.</span></span> <span data-ttu-id="ac9c8-216">Dans le dossier Models, ouvrez le fichier AccountModels.cs et trouver la classe RegisterExternalLoginModel.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="ac9c8-217">La classe RegisterExternalLoginModel conserve les valeurs renvoyés à partir du fournisseur d’authentification.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="ac9c8-218">Ajouter des propriétés nommées FullName et lien, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="ac9c8-219">Également dans AccountModels.cs, ajoutez une nouvelle classe appelée ExtraUserInformation.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="ac9c8-220">Cette classe représente la nouvelle table qui sera créée dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="ac9c8-221">Dans la classe UsersContext, ajoutez le code en surbrillance ci-dessous pour créer une propriété DbSet pour la nouvelle classe.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="ac9c8-222">Vous êtes maintenant prêt à créer la nouvelle table.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-222">You are now ready to create the new table.</span></span> <span data-ttu-id="ac9c8-223">Ouvrez la Console du Gestionnaire de Package et cette fois :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="ac9c8-224">Exécutez la commande **migration ajouter AddExtraUserInformation**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="ac9c8-225">Exécutez la commande **mise à jour la base de données**</span><span class="sxs-lookup"><span data-stu-id="ac9c8-225">Run the command **update-database**</span></span>

<span data-ttu-id="ac9c8-226">Il existe maintenant la nouvelle table dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="ac9c8-227">Récupérer les données supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ac9c8-227">Retrieve the additional data</span></span>

<span data-ttu-id="ac9c8-228">Il existe deux façons de récupérer des données utilisateur supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="ac9c8-229">La première consiste à conserver les données utilisateur qui sont retournées, par défaut, lors de la demande d’authentification.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="ac9c8-230">La seconde consiste à appeler l’API du fournisseur en particulier et de demander des informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="ac9c8-231">Valeurs des FullName et lien sont automatiquement transmises par Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="ac9c8-232">Une valeur qui indique si Facebook a vérifié le compte est extraite via un appel à l’API Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="ac9c8-233">Tout d’abord, vous allez renseigner les valeurs pour FullName et lien, et une version ultérieure, vous obtenez la valeur vérifiée.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="ac9c8-234">Pour récupérer les données utilisateur supplémentaires, ouvrez le **AccountController.cs** de fichiers dans le **contrôleurs** dossier.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="ac9c8-235">Ce fichier contient la logique de journalisation, l’inscription et la gestion des comptes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="ac9c8-236">En particulier, notez les méthodes appelées **ExternalLoginCallback** et **ExternalLoginConfirmation**.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="ac9c8-237">Au sein de ces méthodes, vous pouvez ajouter le code pour personnaliser les opérations de connexion externe pour votre application.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="ac9c8-238">La première ligne de la **ExternalLoginCallback** méthode contient :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="ac9c8-239">Autres données utilisateur a été renvoyé dans le **ExtraData** propriété de la **AuthenticationResult** objet qui est retourné à partir de la **verifyauthentication qui se** (méthode).</span><span class="sxs-lookup"><span data-stu-id="ac9c8-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="ac9c8-240">Le client Facebook contienne les valeurs suivantes dans le **ExtraData** propriété :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="ac9c8-241">ID</span><span class="sxs-lookup"><span data-stu-id="ac9c8-241">id</span></span>
- <span data-ttu-id="ac9c8-242">name</span><span class="sxs-lookup"><span data-stu-id="ac9c8-242">name</span></span>
- <span data-ttu-id="ac9c8-243">link</span><span class="sxs-lookup"><span data-stu-id="ac9c8-243">link</span></span>
- <span data-ttu-id="ac9c8-244">sexe</span><span class="sxs-lookup"><span data-stu-id="ac9c8-244">gender</span></span>
- <span data-ttu-id="ac9c8-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="ac9c8-245">accesstoken</span></span>

<span data-ttu-id="ac9c8-246">Dans la propriété ExtraData les autres fournisseurs ont similaires mais légèrement différentes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="ac9c8-247">Si l’utilisateur est une nouveauté à votre site, vous récupérer certaines données supplémentaires et transmettre ces données à la vue de confirmation.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="ac9c8-248">Le dernier bloc de code dans la méthode est exécuté uniquement si l’utilisateur est une nouveauté de votre site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="ac9c8-249">Remplacez la ligne suivante :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="ac9c8-250">Avec cette ligne :</span><span class="sxs-lookup"><span data-stu-id="ac9c8-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="ac9c8-251">Cette modification inclut simplement les valeurs des propriétés FullName et lien.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="ac9c8-252">Dans le **ExternalLoginConfirmation** (méthode), modifiez le code en surbrillance ci-dessous pour enregistrer les informations utilisateur supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="ac9c8-253">Ajustement de la vue</span><span class="sxs-lookup"><span data-stu-id="ac9c8-253">Adjusting the view</span></span>

<span data-ttu-id="ac9c8-254">Les données utilisateur supplémentaires que vous récupérez à partir du fournisseur seront affichera dans la page d’inscription.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="ac9c8-255">Dans le **vues**/**compte** dossier, ouvrez **ExternalLoginConfirmation.cshtml**.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="ac9c8-256">Sous le champ existant pour le nom d’utilisateur, ajouter des champs FullName et lien PictureLink.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="ac9c8-257">Maintenant, vous êtes presque prêt à exécuter l’application et inscrire un nouvel utilisateur avec les informations supplémentaires enregistrées.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="ac9c8-258">Vous devez disposer d’un compte qui n’est pas déjà inscrit auprès du site.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="ac9c8-259">Vous pouvez utiliser un autre compte de test, ou supprimer les lignes dans le **UserProfile** et **pages Web\_OAuthMembership** tables pour le compte que vous souhaitez réutiliser.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="ac9c8-260">En supprimant ces lignes, vous allez vérifier que le compte est inscrit à nouveau.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="ac9c8-261">Exécutez l’application et inscrire le nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-261">Run the application and register the new user.</span></span> <span data-ttu-id="ac9c8-262">Notez que cette fois la page de confirmation contient plus de valeurs.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-262">Notice that this time the confirmation page contains more values.</span></span>

![register](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="ac9c8-264">À l’issue de l’inscription, fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-264">After completing registration, close the browser.</span></span> <span data-ttu-id="ac9c8-265">Rechercher dans la base de données à noter les nouvelles valeurs dans le **ExtraUserInformation** table.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="ac9c8-266">Installez le package NuGet pour l’API Facebook</span><span class="sxs-lookup"><span data-stu-id="ac9c8-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="ac9c8-267">Facebook fournit un [API](https://developers.facebook.com/docs/reference/apis/) que vous pouvez appeler pour effectuer des opérations.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="ac9c8-268">Vous pouvez appeler l’API Facebook en dirigeant l’envoi de demandes HTTP, soit à l’aide de l’installation d’un package NuGet qui facilite l’envoi de ces demandes.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="ac9c8-269">À l’aide d’un package NuGet est indiqué dans ce didacticiel, mais l’installation de NuGet package n’est pas essentiel.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="ac9c8-270">Ce didacticiel explique comment utiliser le package C# SDK Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="ac9c8-271">Il existe des autres packages NuGet permettant l’appel de l’API Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="ac9c8-272">À partir de la **gérer les Packages NuGet** windows, sélectionnez le package C# SDK Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![installer le package](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="ac9c8-274">Vous allez utiliser le SDK Facebook C# pour appeler une opération qui requiert le jeton d’accès pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="ac9c8-275">La section suivante montre comment obtenir le jeton d’accès.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="ac9c8-276">Récupérer le jeton d’accès</span><span class="sxs-lookup"><span data-stu-id="ac9c8-276">Retrieve access token</span></span>

<span data-ttu-id="ac9c8-277">La plupart de ces fournisseurs transmettre un jeton d’accès après vérification des informations d’identification de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="ac9c8-278">Ce jeton d’accès est très important, car elle vous permet d’appeler des opérations qui sont disponibles uniquement pour les utilisateurs authentifiés.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="ac9c8-279">Par conséquent, récupérer et stocker le jeton d’accès sont essentiel lorsque vous souhaitez fournir davantage de fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="ac9c8-280">Selon le fournisseur externe, le jeton d’accès peut être valid pour qu’une quantité limitée de temps.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="ac9c8-281">Pour vous assurer que vous disposez d’un jeton d’accès valide, vous il récupérera chaque fois que l’utilisateur se connecte et stocker en tant que valeur de session non enregistrer dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="ac9c8-282">Dans le **ExternalLoginCallback** (méthode), le jeton d’accès est également passé dans le **ExtraData** propriété de la **AuthenticationResult** objet.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="ac9c8-283">Ajoutez le code en surbrillance à **ExternalLoginCallback** pour enregistrer le jeton d’accès dans le **Session** objet.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="ac9c8-284">Ce code est exécuté chaque fois que l’utilisateur se connecte avec un compte Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="ac9c8-285">Bien que cet exemple récupère un jeton d’accès à partir de Facebook, vous pouvez récupérer le jeton d’accès à partir de n’importe quel fournisseur externe via la même clé nommée &quot;accesstoken&quot;.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="ac9c8-286">Déconnexion</span><span class="sxs-lookup"><span data-stu-id="ac9c8-286">Logging off</span></span>

<span data-ttu-id="ac9c8-287">La valeur par défaut **fermeture de session** méthode se connecte l’utilisateur de votre application, mais n’enregistre pas l’utilisateur hors du fournisseur externe.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="ac9c8-288">Pour connecter l’utilisateur de Facebook et empêcher la persistance une fois que l’utilisateur a déconnecté le jeton, vous pouvez ajouter le code en surbrillance suivant à la **fermeture de session** méthode dans le contrôle AccountController.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="ac9c8-289">La valeur que vous fournissez dans le `next` paramètre est l’URL à utiliser après que l’utilisateur est déconnecté de Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="ac9c8-290">Lorsque vous testez sur votre ordinateur local, vous fournissez le numéro de port correct pour votre site local.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="ac9c8-291">En production, vous fourniriez une page par défaut, par exemple, contoso.com.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="ac9c8-292">Récupérer les informations utilisateur qui requiert le jeton d’accès</span><span class="sxs-lookup"><span data-stu-id="ac9c8-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="ac9c8-293">Maintenant que vous avez stocké le jeton d’accès et installé le package C# SDK Facebook, vous pouvez les utiliser ensemble pour demander des informations utilisateur supplémentaires auprès de Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="ac9c8-294">Dans le **ExternalLoginConfirmation** (méthode), créez une instance de la **FacebookClient** classe en passant la valeur du jeton d’accès.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="ac9c8-295">Demandez la valeur de la **vérifié** propriété pour l’utilisateur authentifié actuel.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="ac9c8-296">Le **vérifié** propriété indique si Facebook a validé le compte par le biais d’autres moyens, comme l’envoi d’un message à un téléphone portable.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="ac9c8-297">Enregistrez cette valeur dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="ac9c8-298">Vous devrez à nouveau supprimer les enregistrements dans la base de données pour l’utilisateur, ou utiliser un autre compte Facebook.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="ac9c8-299">Exécutez l’application, puis inscrire le nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-299">Run the application, and register the new user.</span></span> <span data-ttu-id="ac9c8-300">Examinez le **ExtraUserInformation** une table pour afficher la valeur de la propriété vérifié.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="ac9c8-301">Conclusion</span><span class="sxs-lookup"><span data-stu-id="ac9c8-301">Conclusion</span></span>

<span data-ttu-id="ac9c8-302">Dans ce didacticiel, vous avez créé un site qui est intégré à Facebook pour l’authentification des utilisateurs et des données d’inscription.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="ac9c8-303">Vous avez découvert le comportement par défaut qui est configuré pour l’application web MVC 4 et comment personnaliser ce comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="ac9c8-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ac9c8-304">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="ac9c8-304">Related topics</span></span>

- [<span data-ttu-id="ac9c8-305">Créer une application ASP.NET MVC avec authentification et base de données SQL et la déployer sur Azure App Service</span><span class="sxs-lookup"><span data-stu-id="ac9c8-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
