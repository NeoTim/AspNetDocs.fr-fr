---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: À l’aide de méthodes asynchrones dans ASP.NET MVC 4 | Microsoft Docs
author: Rick-Anderson
description: Ce didacticiel vous apprend les notions de base de la création d’une application Web ASP.NET MVC asynchrone à l’aide de Visual Studio Express 2012 pour le Web, qui est un ve gratuit...
ms.author: riande
ms.date: 06/06/2012
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 757b15c34f6fa0078d0bca0dfb38d553bb73809d
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57033266"
---
<a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="bb4e7-103">Utilisation de méthodes asynchrones dans ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="bb4e7-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>
====================
<span data-ttu-id="bb4e7-104">par [Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="bb4e7-104">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

> <span data-ttu-id="bb4e7-105">Ce didacticiel vous apprend les notions de base de la création d’une application Web ASP.NET MVC asynchrone à l’aide [Visual Studio Express 2012 pour Web](https://www.microsoft.com/visualstudio/11), qui est une version gratuite de Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="bb4e7-106">Vous pouvez également utiliser [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="bb4e7-107">Un exemple complet est fourni pour ce didacticiel sur github  [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-107">A complete sample is provided for this tutorial on github  [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>


<span data-ttu-id="bb4e7-108">ASP.NET MVC 4 [contrôleur](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) classe conjointement [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) vous permet d’écrire des méthodes d’action asynchrones qui retournent un objet de type [tâche&lt;ActionResult&gt; ](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="bb4e7-109">Le .NET Framework 4 a introduit un concept de programmation asynchrone appelé une [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) et ASP.NET MVC 4 prend en charge [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="bb4e7-110">Les tâches sont représentées par le **tâche** type et les types associés dans le [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) espace de noms.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="bb4e7-111">Le .NET Framework 4.5 s’appuie sur cette prise en charge asynchrone avec le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés qui facilitent l’utilisation avec [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objets beaucoup moins complexes que la précédente approches asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="bb4e7-112">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) mot clé est un raccourci syntaxique pour indiquer un morceau de code d’attente de façon asynchrone sur un autre fragment de code.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="bb4e7-113">Le [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mot clé représente un indicateur que vous pouvez utiliser pour marquer des méthodes comme méthodes asynchrones basées sur des tâches.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="bb4e7-114">La combinaison de **await**, **async**et le **tâche** objet rend beaucoup plus facile à écrire du code asynchrone dans .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="bb4e7-115">Le nouveau modèle pour les méthodes asynchrones est appelé le *Task-based Asynchronous Pattern* (**appuyez sur**).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="bb4e7-116">Ce didacticiel suppose que vous êtes familiarisé avec la programmation asynchrone à l’aide [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="bb4e7-117">Pour plus d’informations sur l’utilisation [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms, consultez les références suivantes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="bb4e7-118">Livre blanc : Le comportement asynchrone dans .NET</span><span class="sxs-lookup"><span data-stu-id="bb4e7-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="bb4e7-119">Forum aux questions d’async/Await</span><span class="sxs-lookup"><span data-stu-id="bb4e7-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="bb4e7-120">Programmation asynchrone Visual Basic</span><span class="sxs-lookup"><span data-stu-id="bb4e7-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a>  <span data-ttu-id="bb4e7-121">Comment les demandes sont traitées par le Pool de threads</span><span class="sxs-lookup"><span data-stu-id="bb4e7-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="bb4e7-122">Sur le serveur web, le .NET Framework gère un pool de threads qui sont utilisés pour traiter des demandes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="bb4e7-123">Lorsqu’une requête arrive, un thread du pool est distribué pour traiter cette demande.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="bb4e7-124">Si la demande est traitée de façon synchrone, le thread qui traite la demande est occupé lors de la demande est en cours de traitement, et que thread ne peut pas traiter d’autre.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="bb4e7-125">Cela peut être un problème, car le pool de threads peut devenir assez grand pour contenir le nombre de threads occupé.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="bb4e7-126">Toutefois, le nombre de threads dans le pool de threads est limité (la valeur maximale pour .NET 4.5 par défaut est de 5 000).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="bb4e7-127">Dans les grandes applications avec une forte concurrence des requêtes longues, tous les threads disponibles est occupés.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="bb4e7-128">Cette condition est appelée privation de thread.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="bb4e7-129">Lorsque cette condition est atteinte, le serveur web les files d’attente de demandes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="bb4e7-130">Si la file d’attente de la demande est saturé, le serveur web rejette les demandes dont l’état HTTP 503 (serveur encombré).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="bb4e7-131">Le pool de threads CLR présente des limitations sur Nouvelle injections de thread.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="bb4e7-132">Si l’accès concurrentiel est en rafale (autrement dit, votre site web peut soudainement obtenez un grand nombre de demandes) et tous les threads de requête disponibles sont occupés en raison d’appels de serveur principal avec une latence élevée, le taux d’injection de thread limité peut rendre votre application à répondre très mal.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="bb4e7-133">En outre, chaque nouveau thread ajouté au pool de threads a surcharge (par exemple, 1 Mo de mémoire de la pile).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="bb4e7-134">Une application web à l’aide des méthodes synchrones aux appels de service une latence élevée, où le pool de threads a atteint la valeur par défaut de .NET 4.5 maximal de 5 000 threads consomme environ 5 Go plus de mémoire qu’une application en mesure du service de la même demande à l’aide de méthodes asynchrones et les threads que 50.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="bb4e7-135">Lorsque vous effectuez le travail asynchrone, vous n’utilisez pas toujours un thread.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="bb4e7-136">Par exemple, lorsque vous effectuez une demande de service web asynchrone, ASP.NET n’utilisera pas les threads entre les **async** appel de méthode et la **await**.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="bb4e7-137">L’utilisation de pool de threads pour traiter les demandes avec une latence élevée peut entraîner une grande quantité de mémoire et un faible taux d’utilisation du matériel du serveur.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="bb4e7-138">Traitement des requêtes asynchrones</span><span class="sxs-lookup"><span data-stu-id="bb4e7-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="bb4e7-139">Dans une application web qui voit un grand nombre de demandes simultanées au démarrage ou a une charge de rafale (où l’accès concurrentiel augmente soudainement), rendre les appels de service web asynchrones augmente la réactivité de l’application.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-139">In a web app that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous increases the responsiveness of the app.</span></span> <span data-ttu-id="bb4e7-140">Une demande asynchrone prend le même laps de temps à traiter comme une demande synchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="bb4e7-141">Si une demande appelle un service web qui nécessite deux secondes, la requête prend deux secondes qu’elle soit exécutée de façon synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-141">If a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it's performed synchronously or asynchronously.</span></span> <span data-ttu-id="bb4e7-142">Toutefois lors d’un appel asynchrone, un thread n’est pas bloqué de répondre aux autres requêtes pendant qu’il attend la première demande terminer.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-142">However during an asynchronous call, a thread isn't blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="bb4e7-143">Par conséquent, les requêtes asynchrones empêchent croissance de demande files d’attente et le thread de pool lorsqu’il existe plusieurs demandes simultanées qui appellent des opérations à long terme.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a>  <span data-ttu-id="bb4e7-144">Choix des méthodes d’Action synchrones ou asynchrones</span><span class="sxs-lookup"><span data-stu-id="bb4e7-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="bb4e7-145">Cette section répertorie des directives relatives aux situations d’utiliser les méthodes d’action synchrones ou asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="bb4e7-146">Il s’agit que de directives ; examiner chaque application individuellement pour déterminer si les méthodes asynchrones améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="bb4e7-147">En général, utilisez les méthodes synchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="bb4e7-148">Les opérations sont simples ou exécution courte.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="bb4e7-149">Simplicité est plus importante que l’efficacité.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="bb4e7-150">Les opérations sont essentiellement des opérations UC plutôt que des opérations qui impliquent de disque complet ou la charge réseau.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="bb4e7-151">À l’aide des méthodes d’action asynchrones sur les opérations de processeur de manière intensive ne présente aucun avantage et entraîne une surcharge plus.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

  <span data-ttu-id="bb4e7-152">En règle générale, utilisez les méthodes asynchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="bb4e7-153">Vous appelez les services qui peuvent être consommées par le biais des méthodes asynchrones, et à l’aide de .NET 4.5 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="bb4e7-154">Les opérations sont gourmandes en réseau ou/O-e et non le processeur.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="bb4e7-155">Parallélisme est plus important que la simplicité du code.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="bb4e7-156">Vous souhaitez fournir un mécanisme qui permet aux utilisateurs d’annuler une demande longue.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="bb4e7-157">Lorsque l’avantage de la commutation des threads compense le coût du commutateur de contexte.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-157">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="bb4e7-158">En règle générale, vous devez effectuer une méthode asynchrone si la méthode synchrone attend sur le thread de demande ASP.NET tout en ne faisant aucun travail.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="bb4e7-159">En effectuant l’appel asynchrone, le thread de demande ASP.NET n’est pas bloqué effectue aucun travail en attendant que la demande de service web terminer.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="bb4e7-160">Les tests montrent que les opérations bloquantes forment un goulet d’étranglement de performances de site et qu’IIS peut traiter plus de requêtes à l’aide de méthodes asynchrones pour ces appels bloquants.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

  <span data-ttu-id="bb4e7-161">L’exemple téléchargeable montre comment utiliser efficacement des méthodes d’action asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="bb4e7-162">L’exemple fourni a été conçu pour fournir une démonstration simple de la programmation asynchrone dans ASP.NET MVC 4, à l’aide de .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="bb4e7-163">L’exemple n’est pas destiné à être une architecture de référence pour la programmation asynchrone dans ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="bb4e7-164">L’exemple de programme appelle [API Web ASP.NET](../../../web-api/index.md) méthodes qui appellent ensuite [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler des appels de service web d’exécution longue.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="bb4e7-165">La plupart des applications de production n’affiche pas ces avantages exceptionnels en utilisant les méthodes d’action asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="bb4e7-166">Peu d’applications requièrent toutes les méthodes d’action asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="bb4e7-167">Souvent, la conversion de quelques méthodes d’action synchrones en méthodes asynchrones offre le meilleur rapport performances / travail requis.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a>  <span data-ttu-id="bb4e7-168">L’exemple d’Application</span><span class="sxs-lookup"><span data-stu-id="bb4e7-168">The Sample Application</span></span>

<span data-ttu-id="bb4e7-169">Vous pouvez télécharger l’exemple d’application à partir de [ https://github.com/RickAndMSFT/Async-ASP.NET/ ](https://github.com/RickAndMSFT/Async-ASP.NET) sur le [GitHub](https://github.com/) site.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="bb4e7-170">Le référentiel se compose de trois projets :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="bb4e7-171">*Mvc4Async*: Le projet ASP.NET MVC 4 qui contient le code utilisé dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="bb4e7-172">Il effectue des appels d’API Web à la **WebAPIpgw** service.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="bb4e7-173">*WebAPIpgw*: Le projet ASP.NET MVC 4 Web API qui implémente le `Products, Gizmos and Widgets` contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="bb4e7-174">Il fournit les données pour le *WebAppAsync* projet et le *Mvc4Async* projet.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="bb4e7-175">*WebAppAsync*: Le projet Web Forms ASP.NET utilisé dans un autre didacticiel.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a>  <span data-ttu-id="bb4e7-176">La méthode d’Action synchrone Gizmos</span><span class="sxs-lookup"><span data-stu-id="bb4e7-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="bb4e7-177">Le code suivant illustre la `Gizmos` méthode d’action synchrone qui est utilisé pour afficher la liste des gizmos.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="bb4e7-178">(Pour cet article, un gizmo est un appareil mécanique fictif.)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="bb4e7-179">Le code suivant illustre la `GetGizmos` méthode du service gizmo.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="bb4e7-180">Le `GizmoService GetGizmos` méthode passe un URI à un service HTTP de l’API Web ASP.NET qui retourne une liste de données de gizmos.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="bb4e7-181">Le *WebAPIpgw* projet contient l’implémentation de l’API Web `gizmos, widget` et `product` contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="bb4e7-182">L’illustration suivante montre la vue gizmos à partir de l’exemple de projet.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a>  <span data-ttu-id="bb4e7-184">Création d’une méthode d’Action asynchrone Gizmos</span><span class="sxs-lookup"><span data-stu-id="bb4e7-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="bb4e7-185">L’exemple utilise le nouveau [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (disponible dans .NET 4.5 et Visual Studio 2012) de mots clés pour permettre au compilateur d’être chargée de maintenir les transformations complexes nécessaires pour programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="bb4e7-186">Le compilateur vous permet d’écrire le code à l’aide de que constructions de flux de contrôle synchrone de # et le compilateur applique automatiquement les transformations nécessaires pour utiliser des rappels afin d’éviter le blocage des threads.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="bb4e7-187">Le code suivant illustre la `Gizmos` méthode synchrone et le `GizmosAsync` méthode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="bb4e7-188">Si votre navigateur prend en charge la [HTML 5 `<mark>` élément](http://www.w3.org/wiki/HTML/Elements/mark), vous verrez les modifications dans `GizmosAsync` dans la mise en surbrillance jaune.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="bb4e7-189">Les modifications suivantes ont été appliquées pour autoriser le `GizmosAsync` asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="bb4e7-190">La méthode est marquée avec le [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mot clé, qui indique au compilateur de générer des rappels pour les parties du corps et de créer automatiquement un `Task<ActionResult>` qui est retourné.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="bb4e7-191">&quot;Async&quot; a été ajouté au nom de méthode.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="bb4e7-192">Ajout de « Async » n’est pas obligatoire, mais est la convention lors de l’écriture de méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="bb4e7-193">Le type de retour a été remplacé par `ActionResult` à `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="bb4e7-194">Le type de retour de `Task<ActionResult>` représente le travail en cours ainsi que les appelants de la méthode avec un descripteur via lequel attendre la fin de l’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="bb4e7-195">Dans ce cas, l’appelant est le service web.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="bb4e7-196">`Task<ActionResult>` représente en cours fonctionne avec le résultat `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="bb4e7-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="bb4e7-197">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) mot clé a été appliqué à l’appel de service web.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="bb4e7-198">L’API de service web asynchrone a été appelée (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="bb4e7-199">À l’intérieur de la `GetGizmosAsync` une autre méthode asynchrone, de corps de méthode `GetGizmosAsync` est appelée.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="bb4e7-200">`GetGizmosAsync` retourne immédiatement un `Task<List<Gizmo>>` qui se termine finalement lorsque les données sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="bb4e7-201">Étant donné que vous ne souhaitez rien d’autre jusqu'à ce que vous avez les données gizmo, le code attend la tâche (à l’aide de la **await** mot clé).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="bb4e7-202">Vous pouvez utiliser la **await** mot clé uniquement dans les méthodes annotées avec le **async** mot clé.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="bb4e7-203">Le **await** mot clé ne bloque pas le thread jusqu'à ce que la tâche est terminée.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="bb4e7-204">Il inscrit le reste de la méthode comme un rappel sur la tâche et retourne immédiatement.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="bb4e7-205">Lorsque la tâche attendue se termine par la suite, il appellera ce rappel et donc reprendre l’exécution de la droite de la méthode où elle s’était arrêtée.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="bb4e7-206">Pour plus d’informations sur l’utilisation de la [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms, consultez le [async références](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="bb4e7-207">Le code suivant illustre la `GetGizmos` et `GetGizmosAsync` méthodes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="bb4e7-208">Les modifications asynchrones sont semblables à celles apportées à la **GizmosAsync** ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="bb4e7-209">La signature de méthode a été annotée avec le [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mot clé, le type de retour a été remplacé par `Task<List<Gizmo>>`, et *Async* a été ajouté au nom de méthode.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="bb4e7-210">Asynchrone [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) classe est utilisée au lieu du [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) classe.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="bb4e7-211">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) mot clé a été appliqué à la [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="bb4e7-212">L’illustration suivante montre la vue gizmo asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="bb4e7-214">La présentation de navigateurs des données gizmos est identique à la vue créée par l’appel synchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="bb4e7-215">La seule différence est que la version asynchrone peut être plus performant charges sont élevées.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a>  <span data-ttu-id="bb4e7-216">Exécution de plusieurs opérations en parallèle</span><span class="sxs-lookup"><span data-stu-id="bb4e7-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="bb4e7-217">Méthodes d’action asynchrones ont un avantage significatif sur les méthodes synchrones lorsqu’une action doit exécuter plusieurs opérations indépendantes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="bb4e7-218">Dans l’exemple fourni, la méthode synchrone `PWG`(pour les produits, les Widgets et Gizmos) affiche les résultats de trois appels de service web pour obtenir une liste de produits, widgets et gizmos.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="bb4e7-219">Le [API Web ASP.NET](../../../web-api/index.md) projet qui fournit ces services utilise [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler les temps de latence ou un réseau lent appelle.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="bb4e7-220">Lorsque le délai a la valeur 500 millisecondes, asynchrone `PWGasync` méthode prend un peu plus de 500 millisecondes se termine tout synchrones `PWG` version adopte de 1 500 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="bb4e7-221">Synchrones `PWG` méthode est indiquée dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="bb4e7-222">Asynchrone `PWGasync` méthode est indiquée dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="bb4e7-223">L’illustration suivante montre la vue retournée par la **PWGasync** (méthode).</span><span class="sxs-lookup"><span data-stu-id="bb4e7-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a>  <span data-ttu-id="bb4e7-225">À l’aide d’un jeton d’annulation</span><span class="sxs-lookup"><span data-stu-id="bb4e7-225">Using a Cancellation Token</span></span>

<span data-ttu-id="bb4e7-226">Méthodes d’action asynchrones retournant `Task<ActionResult>`sont annulable, c'est-à-dire qu’ils prennent un [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) paramètre lorsqu’elle est fournie avec le [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribut.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="bb4e7-227">Le code suivant illustre la `GizmosCancelAsync` méthode avec un délai d’expiration de 150 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="bb4e7-228">Le code suivant illustre la surcharge GetGizmosAsync, qui prend un [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) paramètre.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="bb4e7-229">Dans l’exemple d’application fourni, en sélectionnant le *démonstration de jeton d’annulation* lier des appels le `GizmosCancelAsync` (méthode) et illustre l’annulation de l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancelation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a>  <span data-ttu-id="bb4e7-230">Configuration du serveur pour les appels de Service Web de haute simultanéité/haute latence</span><span class="sxs-lookup"><span data-stu-id="bb4e7-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="bb4e7-231">Pour profiter des avantages d’une application web asynchrones, vous devrez peut-être apporter des modifications à la configuration du serveur par défaut.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="bb4e7-232">Gardez les points suivants à l’esprit lors de la configuration et test de votre application web asynchrones de contrainte.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="bb4e7-233">Windows 7, Windows Vista et les systèmes d’exploitation de tous les clients Windows ont un maximum de 10 requêtes simultanées.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="bb4e7-234">Vous aurez besoin d’un système d’exploitation de Windows Server pour voir les avantages de méthodes asynchrones sous une charge élevée.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="bb4e7-235">Inscrire le .NET 4.5 avec IIS à partir d’une invite de commandes avec élévation de privilèges :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="bb4e7-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span><span class="sxs-lookup"><span data-stu-id="bb4e7-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="bb4e7-237">Consultez [outil ASP.NET IIS Registration (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="bb4e7-238">Vous devrez peut-être augmenter le [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) limite de file d’attente à partir de la valeur par défaut de 1 000 et 5 000.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="bb4e7-239">Si le paramètre est trop faible, vous pouvez voir [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) rejeter les demandes avec l’état HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="bb4e7-240">Pour modifier la limite de la file d’attente HTTP.sys :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="bb4e7-241">Ouvrez le Gestionnaire des services Internet et accédez au volet de Pools d’applications.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="bb4e7-242">Cliquez avec le bouton droit sur le pool d’applications cible et sélectionnez **paramètres avancés**.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="bb4e7-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="bb4e7-244">Dans le **paramètres avancés** boîte de dialogue, choisissez *longueur de file d’attente* à partir de 1 000 à 5 000.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="bb4e7-245">![Longueur de file d’attente](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="bb4e7-246">Notez dans les images ci-dessus, le .NET framework est répertorié en tant que version 4.0, même si le pool d’applications à l’aide de .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="bb4e7-247">Pour comprendre cette différence, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="bb4e7-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="bb4e7-248">Le contrôle de version .NET et multi-ciblage - .NET 4.5 est une mise à niveau sur place vers le .NET 4.0</span><span class="sxs-lookup"><span data-stu-id="bb4e7-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="bb4e7-249">Comment définir une Application IIS ou le pool d’applications à utiliser ASP.NET 3.5 au lieu de 2.0</span><span class="sxs-lookup"><span data-stu-id="bb4e7-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="bb4e7-250">[Versions et dépendances de .NET Framework](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="bb4e7-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="bb4e7-251">Si votre application est à l’aide des services web ou de noms System.NET pour communiquer avec un serveur principal via HTTP vous devrez peut-être augmenter le [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) élément.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="bb4e7-252">Pour les applications ASP.NET, il est limité par la fonctionnalité de configuration automatique à 12 fois le nombre d’unités centrales.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="bb4e7-253">Cela signifie que sur une procédure quadruple, vous pouvez avoir au maximum 12 \* 4 = 48 connexions simultanées à un point de terminaison IP.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="bb4e7-254">Étant donné que cela est lié à [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), le moyen le plus simple d’augmenter `maxconnection` dans ASP.NET application consiste à définir [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) par programmation dans l’à partir de `Application_Start` méthode dans le *global.asax* fichier.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="bb4e7-255">Consultez l’exemple à télécharger pour obtenir un exemple.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-255">See the sample download for an example.</span></span>
- <span data-ttu-id="bb4e7-256">Dans .NET 4.5, la valeur par défaut de 5000 pour [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) devraient être appropriées.</span><span class="sxs-lookup"><span data-stu-id="bb4e7-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
