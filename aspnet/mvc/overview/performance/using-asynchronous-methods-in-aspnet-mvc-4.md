---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: Utilisation de méthodes asynchrones dans ASP.NET MVC 4 | Microsoft Docs
author: Rick-Anderson
description: Ce didacticiel vous apprend les bases de la création d’une application Web ASP.NET MVC asynchrone à l’aide de Visual Studio Express 2012 pour le Web, ce qui est une opération gratuite...
ms.author: riande
ms.date: 06/06/2012
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 15692b18fc112c4c6cce4d50a243a0e8d5fb52a4
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457750"
---
# <a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="35841-103">Utilisation des méthodes asynchrones dans ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="35841-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>

<span data-ttu-id="35841-104">par [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="35841-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="35841-105">Ce didacticiel vous apprend les bases de la création d’une application Web ASP.NET MVC asynchrone à l’aide de [Visual Studio Express 2012 pour le Web](https://www.microsoft.com/visualstudio/11), qui est une version gratuite de Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="35841-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="35841-106">Vous pouvez également utiliser [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="35841-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="35841-107">Un exemple complet est fourni pour ce didacticiel sur GitHub [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="35841-107">A complete sample is provided for this tutorial on github [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>

<span data-ttu-id="35841-108">La classe de [contrôleur](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) ASP.NET MVC 4 en combinaison [.net 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) vous permet d’écrire des méthodes d’action asynchrones qui retournent un objet de type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="35841-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="35841-109">Le .NET Framework 4 a introduit un concept de programmation asynchrone appelé [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) et ASP.NET MVC 4 prend en charge la [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="35841-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="35841-110">Les tâches sont représentées par le type de **tâche** et les types associés dans l’espace de noms [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="35841-111">La .NET Framework 4,5 s’appuie sur cette prise en charge asynchrone avec les mots clés [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) qui rendent l’utilisation des objets de [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) bien moins complexe que les approches asynchrones précédentes.</span><span class="sxs-lookup"><span data-stu-id="35841-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="35841-112">Le mot clé [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) est un raccourci de syntaxe pour indiquer qu’un morceau de code doit attendre de façon asynchrone un autre morceau de code.</span><span class="sxs-lookup"><span data-stu-id="35841-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="35841-113">Le mot clé [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) représente un indicateur que vous pouvez utiliser pour marquer des méthodes en tant que méthodes asynchrones basées sur des tâches.</span><span class="sxs-lookup"><span data-stu-id="35841-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="35841-114">La combinaison d' **await**, **Async**et de l’objet de **tâche** facilite grandement l’écriture de code asynchrone dans .net 4,5.</span><span class="sxs-lookup"><span data-stu-id="35841-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="35841-115">Le nouveau modèle pour les méthodes asynchrones est appelé *modèle asynchrone basé sur les tâches* (**Tap**).</span><span class="sxs-lookup"><span data-stu-id="35841-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="35841-116">Ce didacticiel part du principe que vous êtes familiarisé avec les programmations asynchrones à l’aide des mots clés [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et de l’espace de noms de [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="35841-117">Pour plus d’informations sur l’utilisation des mots clés [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et l’espace de noms de [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , consultez les références suivantes.</span><span class="sxs-lookup"><span data-stu-id="35841-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="35841-118">Livre blanc : asynchronie dans .NET</span><span class="sxs-lookup"><span data-stu-id="35841-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="35841-119">FAQ Async/await</span><span class="sxs-lookup"><span data-stu-id="35841-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="35841-120">Programmation asynchrone Visual Studio</span><span class="sxs-lookup"><span data-stu-id="35841-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="35841-121">Mode de traitement des demandes par le pool de threads</span><span class="sxs-lookup"><span data-stu-id="35841-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="35841-122">Sur le serveur Web, le .NET Framework gère un pool de threads utilisés pour traiter les demandes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="35841-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="35841-123">À l'arrivée d'une requête, un thread du pool est distribué pour la traiter.</span><span class="sxs-lookup"><span data-stu-id="35841-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="35841-124">Si la demande est traitée de façon synchrone, le thread qui traite la demande est occupé pendant le traitement de la demande et ce thread ne peut pas traiter une autre demande.</span><span class="sxs-lookup"><span data-stu-id="35841-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="35841-125">Cela peut ne pas être un problème, car le pool de threads peut être rendu suffisamment grand pour accueillir de nombreux threads occupés.</span><span class="sxs-lookup"><span data-stu-id="35841-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="35841-126">Toutefois, le nombre de threads dans le pool de threads est limité (la valeur maximale par défaut pour .NET 4,5 est 5 000).</span><span class="sxs-lookup"><span data-stu-id="35841-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="35841-127">Dans les applications de grande taille avec un haut niveau de concurrence des requêtes à long terme, tous les threads disponibles peuvent être occupés.</span><span class="sxs-lookup"><span data-stu-id="35841-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="35841-128">Cet état est appelé privation de thread.</span><span class="sxs-lookup"><span data-stu-id="35841-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="35841-129">Lorsque cette condition est atteinte, le serveur Web met en file d’attente les demandes.</span><span class="sxs-lookup"><span data-stu-id="35841-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="35841-130">Si la file d’attente de demandes est pleine, le serveur Web rejette les demandes avec un état HTTP 503 (serveur encombré).</span><span class="sxs-lookup"><span data-stu-id="35841-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="35841-131">Le pool de threads CLR présente des limitations sur les nouvelles injections de thread.</span><span class="sxs-lookup"><span data-stu-id="35841-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="35841-132">Si la concurrence est éclatée (autrement dit, votre site Web peut obtenir soudainement un grand nombre de requêtes) et que tous les threads de requête disponibles sont occupés en raison des appels du backend avec une latence élevée, le taux d’injection de threads limité peut rendre votre application plus difficile à résoudre.</span><span class="sxs-lookup"><span data-stu-id="35841-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="35841-133">En outre, chaque nouveau thread ajouté au pool de threads a une charge mémoire (par exemple, 1 Mo de mémoire de pile).</span><span class="sxs-lookup"><span data-stu-id="35841-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="35841-134">Une application Web utilisant des méthodes synchrones pour traiter les appels à latence élevée où le pool de threads atteint le nombre maximal de 5 000 threads par défaut de .NET 4,5 consomme environ 5 Go de mémoire par rapport à une application capable de traiter les mêmes demandes à l’aide de les méthodes asynchrones et uniquement les threads 50.</span><span class="sxs-lookup"><span data-stu-id="35841-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="35841-135">Lorsque vous effectuez un travail asynchrone, vous n’utilisez pas toujours un thread.</span><span class="sxs-lookup"><span data-stu-id="35841-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="35841-136">Par exemple, lorsque vous effectuez une demande de service Web asynchrone, ASP.NET n’utilise aucun thread entre l’appel de méthode **Async** et l' **expression await**.</span><span class="sxs-lookup"><span data-stu-id="35841-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="35841-137">L’utilisation du pool de threads pour traiter les demandes avec une latence élevée peut entraîner un grand encombrement mémoire et une mauvaise utilisation du matériel serveur.</span><span class="sxs-lookup"><span data-stu-id="35841-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="35841-138">Traitement des requêtes asynchrones</span><span class="sxs-lookup"><span data-stu-id="35841-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="35841-139">Dans une application Web qui voit un grand nombre de demandes simultanées au démarrage ou a une charge de rafale (où l’accès concurrentiel augmente soudainement), le fait d’appeler le service Web de façon asynchrone augmente la réactivité de l’application.</span><span class="sxs-lookup"><span data-stu-id="35841-139">In a web app that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous increases the responsiveness of the app.</span></span> <span data-ttu-id="35841-140">Une requête asynchrone demande la même durée de traitement qu'une requête synchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="35841-141">Si une demande effectue un appel de service Web qui nécessite deux secondes, la demande prend deux secondes, qu’elle soit exécutée de façon synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-141">If a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it's performed synchronously or asynchronously.</span></span> <span data-ttu-id="35841-142">Toutefois, lors d’un appel asynchrone, un thread ne peut pas répondre à d’autres requêtes pendant qu’il attend la fin de la première requête.</span><span class="sxs-lookup"><span data-stu-id="35841-142">However during an asynchronous call, a thread isn't blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="35841-143">Par conséquent, les requêtes asynchrones empêchent la mise en file d’attente des demandes et la croissance du pool de threads lorsqu’il existe de nombreuses demandes simultanées qui appellent des opérations de longue durée</span><span class="sxs-lookup"><span data-stu-id="35841-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="35841-144">Choix de méthodes d’action synchrones ou asynchrones</span><span class="sxs-lookup"><span data-stu-id="35841-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="35841-145">Cette section répertorie des directives relatives aux situations dans lesquelles utiliser les méthodes d'action synchrones ou asynchrones.</span><span class="sxs-lookup"><span data-stu-id="35841-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="35841-146">Il s’agit simplement de recommandations. Examinez chaque application individuellement pour déterminer si les méthodes asynchrones permettent d’obtenir des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="35841-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="35841-147">En général, utilisez des méthodes synchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="35841-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="35841-148">Les opérations sont simples ou à durée d'exécution courte.</span><span class="sxs-lookup"><span data-stu-id="35841-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="35841-149">La simplicité est plus importante que l'efficacité.</span><span class="sxs-lookup"><span data-stu-id="35841-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="35841-150">Les opérations sont essentiellement des opérations UC, et non des opérations qui impliquent une surcharge du disque ou du réseau.</span><span class="sxs-lookup"><span data-stu-id="35841-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="35841-151">L'utilisation de méthodes d'action asynchrones sur des opérations utilisant le processeur de manière intensive ne présente aucun avantage et donne lieu à une surcharge plus importante.</span><span class="sxs-lookup"><span data-stu-id="35841-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="35841-152">En général, utilisez des méthodes asynchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="35841-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="35841-153">Vous appelez des services qui peuvent être utilisés par le biais de méthodes asynchrones, et vous utilisez .NET 4,5 ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="35841-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="35841-154">Les opérations utilisent le réseau ou les E/S de manière intensive et non le processeur.</span><span class="sxs-lookup"><span data-stu-id="35841-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="35841-155">Le parallélisme est plus important que la simplicité du code.</span><span class="sxs-lookup"><span data-stu-id="35841-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="35841-156">Vous souhaitez fournir un mécanisme qui permet aux utilisateurs d'annuler une requête à durée d'exécution longue.</span><span class="sxs-lookup"><span data-stu-id="35841-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="35841-157">Lorsque l’avantage du changement de threads compense le coût du changement de contexte.</span><span class="sxs-lookup"><span data-stu-id="35841-157">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="35841-158">En général, vous devez faire en sorte qu’une méthode soit asynchrone si la méthode synchrone attend sur le thread de demande ASP.NET en ne procédant à aucun travail.</span><span class="sxs-lookup"><span data-stu-id="35841-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="35841-159">En effectuant l’appel de manière asynchrone, le thread de demande ASP.NET n’est pas bloqué et n’effectue aucun travail pendant qu’il attend la fin de la demande de service Web.</span><span class="sxs-lookup"><span data-stu-id="35841-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="35841-160">Les tests montrent que les opérations bloquantes représentent un goulot d’étranglement dans les performances de site et qu’IIS peut traiter davantage de demandes en utilisant des méthodes asynchrones pour ces appels bloquant.</span><span class="sxs-lookup"><span data-stu-id="35841-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

<span data-ttu-id="35841-161">L'exemple téléchargeable indique comment utiliser efficacement des méthodes d'action asynchrones.</span><span class="sxs-lookup"><span data-stu-id="35841-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="35841-162">L’exemple fourni a été conçu pour fournir une démonstration simple de la programmation asynchrone dans ASP.NET MVC 4 à l’aide de .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="35841-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="35841-163">L’exemple n’est pas destiné à être une architecture de référence pour la programmation asynchrone dans ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="35841-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="35841-164">L’exemple de programme appelle [API Web ASP.net](../../../web-api/index.md) méthodes qui à son tour appellent [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler des appels de service Web à long terme.</span><span class="sxs-lookup"><span data-stu-id="35841-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="35841-165">La plupart des applications de production n’illustrent pas les avantages évidents de l’utilisation des méthodes d’action asynchrones.</span><span class="sxs-lookup"><span data-stu-id="35841-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="35841-166">Peu d'applications requièrent que toutes leurs méthodes d'action soient asynchrones.</span><span class="sxs-lookup"><span data-stu-id="35841-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="35841-167">Souvent, la conversion de quelques méthodes d'action synchrones en méthodes asynchrones offre le meilleur rapport performances/travail requis.</span><span class="sxs-lookup"><span data-stu-id="35841-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="35841-168">L’exemple d’application</span><span class="sxs-lookup"><span data-stu-id="35841-168">The Sample Application</span></span>

<span data-ttu-id="35841-169">Vous pouvez télécharger l’exemple d’application à partir de [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) sur le site [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="35841-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="35841-170">Le référentiel se compose de trois projets :</span><span class="sxs-lookup"><span data-stu-id="35841-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="35841-171">*Mvc4Async*: projet ASP.NET MVC 4 qui contient le code utilisé dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="35841-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="35841-172">Il effectue des appels d’API Web au service **WebAPIpgw** .</span><span class="sxs-lookup"><span data-stu-id="35841-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="35841-173">*WebAPIpgw*: projet d’API Web ASP.NET MVC 4 qui implémente les contrôleurs de `Products, Gizmos and Widgets`.</span><span class="sxs-lookup"><span data-stu-id="35841-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="35841-174">Il fournit les données pour le projet *WebAppAsync* et le projet *Mvc4Async* .</span><span class="sxs-lookup"><span data-stu-id="35841-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="35841-175">*WebAppAsync*: le projet ASP.NET Web Forms utilisé dans un autre didacticiel.</span><span class="sxs-lookup"><span data-stu-id="35841-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="35841-176">Méthode d’action synchrone gizmos</span><span class="sxs-lookup"><span data-stu-id="35841-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="35841-177">Le code suivant illustre la `Gizmos` méthode d’action synchrone utilisée pour afficher une liste de gizmos.</span><span class="sxs-lookup"><span data-stu-id="35841-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="35841-178">(Pour cet article, un gizmo est un appareil mécanique fictif.)</span><span class="sxs-lookup"><span data-stu-id="35841-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="35841-179">Le code suivant illustre la méthode `GetGizmos` du service gizmo.</span><span class="sxs-lookup"><span data-stu-id="35841-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="35841-180">La méthode `GizmoService GetGizmos` passe un URI à un service HTTP API Web ASP.NET qui retourne une liste de données gizmos.</span><span class="sxs-lookup"><span data-stu-id="35841-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="35841-181">Le projet *WebAPIpgw* contient l’implémentation de l’API Web `gizmos, widget` et `product` contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="35841-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="35841-182">L’illustration suivante montre la vue gizmos de l’exemple de projet.</span><span class="sxs-lookup"><span data-stu-id="35841-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="35841-184">Création d’une méthode d’action gizmos asynchrone</span><span class="sxs-lookup"><span data-stu-id="35841-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="35841-185">L’exemple utilise les nouveaux mots clés [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (disponibles dans .net 4,5 et Visual Studio 2012) pour permettre au compilateur de gérer les transformations compliquées nécessaires à la programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="35841-186">Le compilateur vous permet d’écrire du code C#à l’aide des constructions de flux de contrôle synchrones de et le compilateur applique automatiquement les transformations nécessaires pour utiliser les rappels afin d’éviter les threads de blocage.</span><span class="sxs-lookup"><span data-stu-id="35841-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="35841-187">Le code suivant montre les `Gizmos` méthode synchrone et `GizmosAsync` méthode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="35841-188">Si votre navigateur prend en charge l' [élément `<mark>` HTML 5](http://www.w3.org/wiki/HTML/Elements/mark), vous verrez les modifications apportées à `GizmosAsync` en surbrillance en jaune.</span><span class="sxs-lookup"><span data-stu-id="35841-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="35841-189">Les modifications suivantes ont été appliquées pour permettre l' `GizmosAsync` asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="35841-190">La méthode est marquée avec le mot clé [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , qui indique au compilateur de générer des rappels pour les parties du corps et de créer automatiquement une `Task<ActionResult>` retournée.</span><span class="sxs-lookup"><span data-stu-id="35841-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="35841-191">&quot;&quot; Async a été ajouté au nom de la méthode.</span><span class="sxs-lookup"><span data-stu-id="35841-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="35841-192">L’ajout de « Async » n’est pas obligatoire, mais il s’agit de la Convention lors de l’écriture de méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="35841-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="35841-193">Le type de retour a été modifié de `ActionResult` à `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="35841-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="35841-194">Le type de retour de `Task<ActionResult>` représente un travail en cours et fournit aux appelants de la méthode un handle par le biais duquel attendre l’achèvement de l’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="35841-195">Dans ce cas, l’appelant est le service Web.</span><span class="sxs-lookup"><span data-stu-id="35841-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="35841-196">`Task<ActionResult>` représente le travail en cours avec le résultat de `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="35841-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="35841-197">Le mot clé [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a été appliqué à l’appel de service Web.</span><span class="sxs-lookup"><span data-stu-id="35841-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="35841-198">L’API de service Web asynchrone a été appelée (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="35841-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="35841-199">Dans le corps de la méthode `GetGizmosAsync` une autre méthode asynchrone, `GetGizmosAsync` est appelée.</span><span class="sxs-lookup"><span data-stu-id="35841-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="35841-200">`GetGizmosAsync` retourne immédiatement un `Task<List<Gizmo>>` qui finit par se terminer lorsque les données sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="35841-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="35841-201">Étant donné que vous ne souhaitez rien faire d’autre tant que vous n’avez pas les données Gizmo, le code attend la tâche (à l’aide du mot clé **await** ).</span><span class="sxs-lookup"><span data-stu-id="35841-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="35841-202">Vous pouvez utiliser le mot clé **await** uniquement dans les méthodes annotées avec le mot clé **Async** .</span><span class="sxs-lookup"><span data-stu-id="35841-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="35841-203">Le mot clé **await** ne bloque pas le thread tant que la tâche n’est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="35841-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="35841-204">Il inscrit le reste de la méthode en tant que rappel sur la tâche et retourne immédiatement.</span><span class="sxs-lookup"><span data-stu-id="35841-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="35841-205">Lorsque la tâche attendue finit par se terminer, elle appelle ce rappel et, par conséquent, reprend l’exécution de la méthode juste là où elle s’était arrêtée.</span><span class="sxs-lookup"><span data-stu-id="35841-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="35841-206">Pour plus d’informations sur l’utilisation des mots clés [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et de l’espace de noms de [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) , consultez [références Async](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="35841-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="35841-207">Le code suivant représente les méthodes `GetGizmos` et `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="35841-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="35841-208">Les modifications asynchrones sont similaires à celles apportées aux **GizmosAsync** ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="35841-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="35841-209">La signature de la méthode a été annotée avec le mot clé [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , le type de retour a été remplacé par `Task<List<Gizmo>>`et *Async* a été ajouté au nom de la méthode.</span><span class="sxs-lookup"><span data-stu-id="35841-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="35841-210">La classe [httpclient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchrone est utilisée à la place de la classe [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="35841-211">Le mot clé [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a été appliqué aux méthodes asynchrones [httpclient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="35841-212">L’illustration suivante montre la vue Gizmo asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="35841-214">La présentation des navigateurs des données gizmos est identique à la vue créée par l’appel synchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="35841-215">La seule différence est que la version asynchrone peut être plus performante sous des charges lourdes.</span><span class="sxs-lookup"><span data-stu-id="35841-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a><span data-ttu-id="35841-216">Exécution de plusieurs opérations en parallèle</span><span class="sxs-lookup"><span data-stu-id="35841-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="35841-217">Les méthodes d’action asynchrones présentent un avantage significatif par rapport aux méthodes synchrones lorsqu’une action doit effectuer plusieurs opérations indépendantes.</span><span class="sxs-lookup"><span data-stu-id="35841-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="35841-218">Dans l’exemple fourni, la méthode synchrone `PWG`(pour Products, widgets et gizmos) affiche les résultats de trois appels de service Web pour obtenir la liste des produits, des widgets et des gizmos.</span><span class="sxs-lookup"><span data-stu-id="35841-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="35841-219">Le projet [API Web ASP.net](../../../web-api/index.md) qui fournit ces services utilise [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler la latence ou des appels réseau lents.</span><span class="sxs-lookup"><span data-stu-id="35841-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="35841-220">Lorsque le délai est défini sur 500 millisecondes, la méthode de `PWGasync` asynchrone prend un peu plus de 500 millisecondes pour s’exécuter, tandis que la version de `PWG` synchrone prend plus de 1 500 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="35841-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="35841-221">La méthode de `PWG` synchrone est illustrée dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="35841-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="35841-222">La méthode `PWGasync` asynchrone est présentée dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="35841-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="35841-223">L’illustration suivante montre la vue retournée par la méthode **PWGasync** .</span><span class="sxs-lookup"><span data-stu-id="35841-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="35841-225">Utilisation d’un jeton d’annulation</span><span class="sxs-lookup"><span data-stu-id="35841-225">Using a Cancellation Token</span></span>

<span data-ttu-id="35841-226">Les méthodes d’action asynchrones qui retournent `Task<ActionResult>`peuvent être annulées, c’est-à-dire qu’elles prennent un paramètre [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) lorsque l’une d’elles est fournie avec l’attribut [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="35841-227">Le code suivant illustre la méthode `GizmosCancelAsync` avec un délai d’expiration de 150 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="35841-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="35841-228">Le code suivant illustre la surcharge GetGizmosAsync, qui prend un paramètre [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="35841-229">Dans l’exemple d’application fourni, la sélection du lien de *démonstration de jeton d’annulation* appelle la méthode `GizmosCancelAsync` et montre l’annulation de l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancellation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="35841-230">Configuration du serveur pour les appels de service Web avec concurrence élevée/latence élevée</span><span class="sxs-lookup"><span data-stu-id="35841-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="35841-231">Pour tirer parti des avantages d’une application Web asynchrone, vous devrez peut-être apporter des modifications à la configuration du serveur par défaut.</span><span class="sxs-lookup"><span data-stu-id="35841-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="35841-232">Gardez à l’esprit les points suivants lors de la configuration et du test de stress de votre application Web asynchrone.</span><span class="sxs-lookup"><span data-stu-id="35841-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="35841-233">Windows 7, Windows Vista et tous les systèmes d’exploitation clients Windows ont un maximum de 10 demandes simultanées.</span><span class="sxs-lookup"><span data-stu-id="35841-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="35841-234">Vous aurez besoin d’un système d’exploitation Windows Server pour voir les avantages des méthodes asynchrones sous une charge élevée.</span><span class="sxs-lookup"><span data-stu-id="35841-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="35841-235">Inscrire .NET 4,5 avec IIS à partir d’une invite de commandes avec élévation de privilèges :</span><span class="sxs-lookup"><span data-stu-id="35841-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="35841-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis-i</span><span class="sxs-lookup"><span data-stu-id="35841-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="35841-237">Consultez [ASP.NET IIS Registration Tool (Aspnet\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="35841-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="35841-238">Vous devrez peut-être augmenter la limite de file d’attente [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) de la valeur par défaut 1 000 à 5 000.</span><span class="sxs-lookup"><span data-stu-id="35841-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="35841-239">Si le paramètre est trop bas, vous pouvez voir que [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) rejette les demandes avec un état HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="35841-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="35841-240">Pour modifier la limite de file d’attente HTTP. sys :</span><span class="sxs-lookup"><span data-stu-id="35841-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="35841-241">Ouvrez le gestionnaire des services Internet et accédez au volet pools d’applications.</span><span class="sxs-lookup"><span data-stu-id="35841-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="35841-242">Cliquez avec le bouton droit sur le pool d’applications cible et sélectionnez **Paramètres avancés**.</span><span class="sxs-lookup"><span data-stu-id="35841-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="35841-243">![](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png) avancé</span><span class="sxs-lookup"><span data-stu-id="35841-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="35841-244">Dans la boîte de dialogue **Paramètres avancés** , changez la longueur de la *file d’attente* de 1 000 à 5 000.</span><span class="sxs-lookup"><span data-stu-id="35841-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="35841-245">longueur de la file d’attente ![](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="35841-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="35841-246">Remarque dans les images ci-dessus, le .NET Framework est listé comme v 4.0, même si le pool d’applications utilise .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="35841-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="35841-247">Pour comprendre cette différence, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="35841-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="35841-248">Contrôle de version .NET et multi-ciblage-.NET 4,5 est une mise à niveau sur place vers .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="35841-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="35841-249">Comment définir une application IIS ou un pool d’applications pour utiliser ASP.NET 3,5 au lieu de 2,0</span><span class="sxs-lookup"><span data-stu-id="35841-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="35841-250">[Versions et dépendances de .NET Framework](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="35841-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="35841-251">Si votre application utilise des services Web ou System.NET pour communiquer avec un serveur principal via HTTP, vous devrez peut-être augmenter l’élément [connectionManagement/MaxConnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="35841-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="35841-252">Pour les applications ASP.NET, cela est limité par la fonctionnalité de configuration automatique à 12 fois le nombre de processeurs.</span><span class="sxs-lookup"><span data-stu-id="35841-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="35841-253">Cela signifie que sur un Quad-proc, vous pouvez avoir au maximum 12 \* 4 = 48 connexions simultanées à un point de terminaison IP.</span><span class="sxs-lookup"><span data-stu-id="35841-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="35841-254">Étant donné que cela est lié à la [configuration automatique](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), le moyen le plus simple d’augmenter `maxconnection` dans une application ASP.net consiste à définir [System .net. ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) par programmation dans la méthode from `Application_Start` dans le fichier *global. asax* .</span><span class="sxs-lookup"><span data-stu-id="35841-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="35841-255">Consultez l’exemple de téléchargement pour obtenir un exemple.</span><span class="sxs-lookup"><span data-stu-id="35841-255">See the sample download for an example.</span></span>
- <span data-ttu-id="35841-256">Dans .NET 4,5, la valeur par défaut 5000 pour [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) doit être correcte.</span><span class="sxs-lookup"><span data-stu-id="35841-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
