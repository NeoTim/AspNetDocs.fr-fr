---
uid: mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
title: Créer une application web ASP.NET MVC 5 sécurisée avec connexion, confirmation par e-mail et réinitialisation de mot de passe (C#) | Microsoft Docs
author: Rick-Anderson
description: Ce didacticiel vous montre comment créer une application web ASP.NET MVC 5 avec confirmation par courrier électronique et réinitialisation de mot de passe en utilisant le système d’appartenance d'ASP.NET Identity. Ca...
ms.author: riande
ms.date: 03/26/2015
ms.assetid: d4911cb3-1afb-4805-b860-10818c4b1280
msc.legacyurl: /mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 07f5b290b73f75000e6f29fe09e4dc25e144452f
ms.sourcegitcommit: 969e7db924ebad3cc0f0cb0d65d148e8b9221b9a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/06/2019
ms.locfileid: "74899698"
---
# <a name="create-a-secure-aspnet-mvc-5-web-app-with-log-in-email-confirmation-and-password-reset-c"></a><span data-ttu-id="bc68f-104">Créer une application web ASP.NET MVC 5 sécurisée avec connexion, confirmation par e-mail et réinitialisation du mot de passe (C#)</span><span class="sxs-lookup"><span data-stu-id="bc68f-104">Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="bc68f-105">par [Rick Anderson]((https://twitter.com/RickAndMSFT))</span><span class="sxs-lookup"><span data-stu-id="bc68f-105">by [Rick Anderson]((https://twitter.com/RickAndMSFT))</span></span>

<span data-ttu-id="bc68f-106">Ce didacticiel vous montre comment créer une application web ASP.NET MVC 5 avec confirmation par courrier électronique et réinitialisation de mot de passe en utilisant le système d’appartenance d'ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="bc68f-106">This tutorial shows you how to build an ASP.NET MVC 5 web app with email confirmation and password reset using the ASP.NET Identity membership system.</span></span>

<span data-ttu-id="bc68f-107">Pour obtenir une version mise à jour de ce didacticiel qui utilise .NET Core, consultez [confirmation de compte et récupération de mot de passe dans ASP.NET Core [/ASPNET/Core/Security/Authentication/accconfirm).</span><span class="sxs-lookup"><span data-stu-id="bc68f-107">For an updated version of this tutorial that uses .NET Core, see [Account confirmation and password recovery in ASP.NET Core[/aspnet/core/security/authentication/accconfirm).</span></span>

<a id="createMvc"></a>
## <a name="create-an-aspnet-mvc-app"></a><span data-ttu-id="bc68f-108">Créer une application MVC ASP.NET</span><span class="sxs-lookup"><span data-stu-id="bc68f-108">Create an ASP.NET MVC app</span></span>

<span data-ttu-id="bc68f-109">Commencez par installer et exécuter [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="bc68f-109">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="bc68f-110">Installez [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="bc68f-110">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="bc68f-111">AVERTISSEMENT : vous devez installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou version ultérieure pour suivre ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="bc68f-111">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="bc68f-112">Créez un projet Web ASP.NET et sélectionnez le modèle MVC.</span><span class="sxs-lookup"><span data-stu-id="bc68f-112">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="bc68f-113">Web Forms prend également en charge ASP.NET Identity : vous pouvez donc suivre des étapes similaires dans une application Web Forms.</span><span class="sxs-lookup"><span data-stu-id="bc68f-113">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image1.png)
2. <span data-ttu-id="bc68f-114">Laissez l’authentification par défaut à **Comptes d’utilisateur individuels**.</span><span class="sxs-lookup"><span data-stu-id="bc68f-114">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="bc68f-115">Si vous souhaitez héberger l’application dans Azure, laissez la case à cocher activée.</span><span class="sxs-lookup"><span data-stu-id="bc68f-115">If you'd like to host the app in Azure, leave the check box checked.</span></span> <span data-ttu-id="bc68f-116">Plus loin dans ce didacticiel, nous déploierons sur Azure.</span><span class="sxs-lookup"><span data-stu-id="bc68f-116">Later in the tutorial we will deploy to Azure.</span></span> <span data-ttu-id="bc68f-117">Vous pouvez [ouvrir un compte Azure gratuitement](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="bc68f-117">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).</span></span>
3. <span data-ttu-id="bc68f-118">Définissez le [projet pour utiliser SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="bc68f-118">Set the [project to use SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="bc68f-119">Exécutez l’application, cliquez sur le lien **S'inscrire** et inscrivez un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bc68f-119">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="bc68f-120">À ce stade, la seule validation sur l’adresse e-mail se fait avec l'attribut [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="bc68f-120">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
5. <span data-ttu-id="bc68f-121">Dans l’Explorateur de serveurs, accédez à **Data Connections\DefaultConnection\Tables\AspNetUsers**, cliquez avec le bouton droit et sélectionnez **Ouvrir la définition de la table**.</span><span class="sxs-lookup"><span data-stu-id="bc68f-121">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="bc68f-122">L’illustration suivante montre le schéma `AspNetUsers` :</span><span class="sxs-lookup"><span data-stu-id="bc68f-122">The following image shows the `AspNetUsers` schema:</span></span>

    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="bc68f-123">Cliquez avec le bouton droit sur la table **AspNetUsers** et sélectionnez **Afficher les données de la table**.</span><span class="sxs-lookup"><span data-stu-id="bc68f-123">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="bc68f-124">À ce stade, l’adresse de messagerie n’a pas été confirmée.</span><span class="sxs-lookup"><span data-stu-id="bc68f-124">At this point the email has not been confirmed.</span></span>
7. <span data-ttu-id="bc68f-125">Cliquez sur la ligne et sélectionnez Supprimer.</span><span class="sxs-lookup"><span data-stu-id="bc68f-125">Click on the row and select delete.</span></span> <span data-ttu-id="bc68f-126">Vous allez ajouter cet e-mail à l’étape suivante et envoyer un e-mail de confirmation.</span><span class="sxs-lookup"><span data-stu-id="bc68f-126">You'll add this email again in the next step, and send a confirmation email.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="bc68f-127">Confirmation par e-mail</span><span class="sxs-lookup"><span data-stu-id="bc68f-127">Email confirmation</span></span>

<span data-ttu-id="bc68f-128">Il est recommandé de confirmer l’adresse de messagerie d’un nouvel enregistrement d’utilisateur pour vérifier qu’ils n’empruntent pas l'identité d'une autre personne (autrement dit, qu'ils ne se sont pas inscrits avec par l'adresse de messagerie de quelqu'un d’autre).</span><span class="sxs-lookup"><span data-stu-id="bc68f-128">It's a best practice to confirm the email of a new user registration to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="bc68f-129">Supposons que vous ayez un forum de discussion : vous voudriez empêcher `"bob@example.com"` de s'inscrire en tant que `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="bc68f-129">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="bc68f-130">ans la confirmation par courrier électronique, `"joe@contoso.com"` pourrait recevoir du courrier indésirable à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="bc68f-130">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="bc68f-131">Supposons que Bob s’est inscrit accidentellement comme `"bib@example.com"` et n’avait pas remarqué qu’il ne serait pas en mesure d’utiliser la récupération de mot de passe parce que l’application n’a pas son adresse e-mail correcte.</span><span class="sxs-lookup"><span data-stu-id="bc68f-131">Suppose Bob accidentally registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="bc68f-132">La confirmation par courrier électronique fournit uniquement une protection limitée des robots et ne fournit pas de protection contre les spammeurs déterminés. ils ont de nombreux alias de messagerie de travail qu’ils peuvent utiliser pour s’inscrire.</span><span class="sxs-lookup"><span data-stu-id="bc68f-132">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.</span></span>

<span data-ttu-id="bc68f-133">En règle générale, vous souhaitez empêcher les nouveaux utilisateurs d'envoyer des données à votre site web avant qu’ils soient confirmés par courrier électronique, par SMS ou via un autre mécanisme.</span><span class="sxs-lookup"><span data-stu-id="bc68f-133">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a><span data-ttu-id="bc68f-134">Dans les sections ci-dessous, nous allons activer la confirmation de courrier électronique et modifier le code pour empêcher les utilisateurs qui viennent d’être inscrits de se connecter jusqu'à ce que leur courrier électronique ait été confirmé.</span><span class="sxs-lookup"><span data-stu-id="bc68f-134">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="bc68f-135">Se connecter à SendGrid</span><span class="sxs-lookup"><span data-stu-id="bc68f-135">Hook up SendGrid</span></span>

<span data-ttu-id="bc68f-136">Les instructions de cette section ne sont pas à jour.</span><span class="sxs-lookup"><span data-stu-id="bc68f-136">The instructions in this section are not current.</span></span> <span data-ttu-id="bc68f-137">Pour obtenir des instructions mises à jour, consultez [configurer le fournisseur de messagerie SendGrid](/aspnet/core/security/authentication/accconfirm#configure-email-provider) .</span><span class="sxs-lookup"><span data-stu-id="bc68f-137">See [Configure SendGrid email provider](/aspnet/core/security/authentication/accconfirm#configure-email-provider) for updated instructions.</span></span>

<span data-ttu-id="bc68f-138">Bien que ce didacticiel montre uniquement comment ajouter la notification par courrier électronique via [SendGrid](http://sendgrid.com/), vous pouvez envoyer un e-mail à l’aide de SMTP et d'autres mécanismes (consultez [les ressources additionnelles](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="bc68f-138">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="bc68f-139">Dans la Console du Gestionnaire de Package, entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="bc68f-139">In the Package Manager Console, enter the following command:</span></span> 

    [!code-console[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample1.cmd)]
2. <span data-ttu-id="bc68f-140">Accédez à la [page d’inscription d'Azure SendGrid](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) et inscrivez-vous à un compte SendGrid gratuit.</span><span class="sxs-lookup"><span data-stu-id="bc68f-140">Go to the [Azure SendGrid sign up page](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) and register for a free SendGrid account.</span></span> <span data-ttu-id="bc68f-141">Configurez SendGrid en ajoutant du code semblable au suivant dans *App_Start/IdentityConfig.cs* :</span><span class="sxs-lookup"><span data-stu-id="bc68f-141">Configure SendGrid by adding code similar to the following in *App_Start/IdentityConfig.cs*:</span></span>

    [!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample2.cs?highlight=3,5)]

<span data-ttu-id="bc68f-142">Vous devrez ajouter les inclusions suivantes :</span><span class="sxs-lookup"><span data-stu-id="bc68f-142">You'll need to add the following includes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample3.cs)]

<span data-ttu-id="bc68f-143">Pour simplifier cet exemple, nous allons stocker les paramètres d’application dans le fichier *web.config* :</span><span class="sxs-lookup"><span data-stu-id="bc68f-143">To keep this sample simple, we'll store the app settings in the *web.config* file:</span></span>

[!code-xml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample4.xml)]

> [!WARNING]
> <span data-ttu-id="bc68f-144">Sécurité - Ne jamais stocker de données sensibles dans votre code source.</span><span class="sxs-lookup"><span data-stu-id="bc68f-144">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="bc68f-145">Le compte et les informations d’identification sont stockés dans l’appSetting.</span><span class="sxs-lookup"><span data-stu-id="bc68f-145">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="bc68f-146">Sur Azure, vous pouvez stocker en toute sécurité ces valeurs sur l'onglet **[Configurer](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="bc68f-146">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="bc68f-147">Consultez [les meilleures pratiques pour le déploiement des mots de passe et autres données sensibles sur ASP.NET et Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="bc68f-147">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>

### <a name="enable-email-confirmation-in-the-account-controller"></a><span data-ttu-id="bc68f-148">Activer la confirmation par courrier électronique dans le contrôleur de compte</span><span class="sxs-lookup"><span data-stu-id="bc68f-148">Enable email confirmation in the Account controller</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample5.cs?highlight=16-21)]

<span data-ttu-id="bc68f-149">Vérifiez que le fichier *Views\Account\ConfirmEmail.cshtml* a une syntaxe razor correcte.</span><span class="sxs-lookup"><span data-stu-id="bc68f-149">Verify the *Views\Account\ConfirmEmail.cshtml* file has correct razor syntax.</span></span> <span data-ttu-id="bc68f-150">(Le caractère @ dans la première ligne est peut-être manquant.</span><span class="sxs-lookup"><span data-stu-id="bc68f-150">( The @ character in the first line might be missing.</span></span> <span data-ttu-id="bc68f-151">)</span><span class="sxs-lookup"><span data-stu-id="bc68f-151">)</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample6.cshtml?highlight=1)]

<span data-ttu-id="bc68f-152">Exécutez l’application et cliquez sur le lien S’inscrire.</span><span class="sxs-lookup"><span data-stu-id="bc68f-152">Run the app and click the Register link.</span></span> <span data-ttu-id="bc68f-153">Une fois que vous avez envoyé le formulaire d’inscription, vous êtes connecté.</span><span class="sxs-lookup"><span data-stu-id="bc68f-153">Once you submit the registration form, you are logged in.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image4.png)

<span data-ttu-id="bc68f-154">Vérifiez votre compte de messagerie et cliquez sur le lien pour confirmer votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="bc68f-154">Check your email account and click on the link to confirm your email.</span></span>

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="bc68f-155">Demander une confirmation par courrier électronique avant la connexion</span><span class="sxs-lookup"><span data-stu-id="bc68f-155">Require email confirmation before log in</span></span>

<span data-ttu-id="bc68f-156">Actuellement, une fois qu’un utilisateur complète le formulaire d’inscription, il est connecté.</span><span class="sxs-lookup"><span data-stu-id="bc68f-156">Currently once a user completes the registration form, they are logged in.</span></span> <span data-ttu-id="bc68f-157">En règle générale, vous voulez vérifier son adresse e-mail avant de le connecter.</span><span class="sxs-lookup"><span data-stu-id="bc68f-157">You generally want to confirm their email before logging them in.</span></span> <span data-ttu-id="bc68f-158">Dans la section ci-dessous, nous modifions le code pour demander aux nouveaux utilisateurs un e-mail vérifié avant de les connecter (les authentifier).</span><span class="sxs-lookup"><span data-stu-id="bc68f-158">In the section below, we will modify the code to require new users to have a confirmed email before they are logged in (authenticated).</span></span> <span data-ttu-id="bc68f-159">Mettez à jour la méthode `HttpPost Register` avec les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="bc68f-159">Update the `HttpPost Register` method with the following highlighted changes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample7.cs?highlight=14-15,23-30)]

<span data-ttu-id="bc68f-160">Si vous décommentez la méthode `SignInAsync`, l’utilisateur ne sera pas connecté lors de l’inscription.</span><span class="sxs-lookup"><span data-stu-id="bc68f-160">By commenting out the `SignInAsync` method, the user will not be signed in by the registration.</span></span> <span data-ttu-id="bc68f-161">La ligne `TempData["ViewBagLink"] = callbackUrl;` peut être utilisée pour [déboguer l’application](#dbg) et tester l’inscription sans envoyer de courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="bc68f-161">The `TempData["ViewBagLink"] = callbackUrl;` line can be used to [debug the app](#dbg) and test registration without sending email.</span></span> <span data-ttu-id="bc68f-162">`ViewBag.Message` permet d’afficher les instructions de confirmation.</span><span class="sxs-lookup"><span data-stu-id="bc68f-162">`ViewBag.Message` is used to display the confirm instructions.</span></span> <span data-ttu-id="bc68f-163">L'[exemple à télécharger](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contient du code pour tester l’e-mail de confirmation sans configurer la messagerie et peut également être utilisé pour déboguer l’application.</span><span class="sxs-lookup"><span data-stu-id="bc68f-163">The [download sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contains code to test email confirmation without setting up email, and can also be used to debug the application.</span></span>

<span data-ttu-id="bc68f-164">Créez un fichier `Views\Shared\Info.cshtml` et ajoutez le balisage razor suivant :</span><span class="sxs-lookup"><span data-stu-id="bc68f-164">Create a `Views\Shared\Info.cshtml` file and add the following razor markup:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample8.cshtml)]

<span data-ttu-id="bc68f-165">Ajoutez l' [attribut Authorize](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) à la méthode d’action `Contact` du contrôleur Home.</span><span class="sxs-lookup"><span data-stu-id="bc68f-165">Add the [Authorize attribute](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) to the `Contact` action method of the Home controller.</span></span> <span data-ttu-id="bc68f-166">Vous pouvez cliquer sur le lien de **contact** pour vérifier que les utilisateurs anonymes n’ont pas d’accès et que les utilisateurs authentifiés ont accès.</span><span class="sxs-lookup"><span data-stu-id="bc68f-166">You can click on the **Contact** link to verify anonymous users don't have access and authenticated users do have access.</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample9.cs?highlight=1)]

<span data-ttu-id="bc68f-167">Vous devez également mettre à jour la méthode d’action `HttpPost Login`:</span><span class="sxs-lookup"><span data-stu-id="bc68f-167">You must also update the `HttpPost Login` action method:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample10.cs?highlight=13-22)]

<span data-ttu-id="bc68f-168">Mettez à jour la vue *Views\Shared\Error.cshtml* pour afficher le message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="bc68f-168">Update the *Views\Shared\Error.cshtml* view to display the error message:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample11.cshtml?highlight=8-17)]

<span data-ttu-id="bc68f-169">Supprimez les comptes de la table **AspNetUsers** qui contiennent l’alias d’e-mail que vous voulez tester.</span><span class="sxs-lookup"><span data-stu-id="bc68f-169">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test with.</span></span> <span data-ttu-id="bc68f-170">Exécutez l’application et vérifiez que vous ne pouvez pas vous connecter avant d’avoir confirmé votre adresse e-mail.</span><span class="sxs-lookup"><span data-stu-id="bc68f-170">Run the app and verify you can't log in until you have confirmed your email address.</span></span> <span data-ttu-id="bc68f-171">Après avoir confirmé votre adresse e-mail, cliquez sur le lien **Contact**.</span><span class="sxs-lookup"><span data-stu-id="bc68f-171">Once you confirm your email address, click the **Contact** link.</span></span>

<a id="reset"></a>
## <a name="password-recoveryreset"></a><span data-ttu-id="bc68f-172">Récupération/réinitialisation du mot de passe</span><span class="sxs-lookup"><span data-stu-id="bc68f-172">Password recovery/reset</span></span>

<span data-ttu-id="bc68f-173">Supprimez les caractères de commentaire de la méthode d’action `HttpPost ForgotPassword` dans le contrôleur de compte :</span><span class="sxs-lookup"><span data-stu-id="bc68f-173">Remove the comment characters from the `HttpPost ForgotPassword` action method in the account controller:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample12.cs?highlight=17-20)]

<span data-ttu-id="bc68f-174">Supprimez les caractères de commentaire de la méthode `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) dans le fichier de vue razor *Views\Account\Login.cshtml* :</span><span class="sxs-lookup"><span data-stu-id="bc68f-174">Remove the comment characters from the `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) in the *Views\Account\Login.cshtml* razor view file:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample13.cshtml?highlight=47-50)]

<span data-ttu-id="bc68f-175">La page de connexion affiche alors un lien pour réinitialiser le mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bc68f-175">The Log in page will now show a link to reset the password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="bc68f-176">Renvoyer le lien de confirmation par e-mail</span><span class="sxs-lookup"><span data-stu-id="bc68f-176">Resend email confirmation link</span></span>

<span data-ttu-id="bc68f-177">Une fois qu’un utilisateur crée un compte local, un lien de confirmation lui est envoyé par e-mail, qu’il doit utiliser avant de pouvoir se connecter.</span><span class="sxs-lookup"><span data-stu-id="bc68f-177">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="bc68f-178">Si l’utilisateur supprime accidentellement l’e-mail de confirmation ou si l’e-mail n’arrive jamais, il a besoin du lien de confirmation renvoyé.</span><span class="sxs-lookup"><span data-stu-id="bc68f-178">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="bc68f-179">Les modifications suivantes du code montrent comment faire cela.</span><span class="sxs-lookup"><span data-stu-id="bc68f-179">The following code changes show how to enable this.</span></span>

<span data-ttu-id="bc68f-180">Ajoutez la méthode helper suivante en bas du fichier *Controllers\AccountController.cs*:</span><span class="sxs-lookup"><span data-stu-id="bc68f-180">Add the following helper method to the bottom of the *Controllers\AccountController.cs* file:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample14.cs)]

<span data-ttu-id="bc68f-181">Mettez à jour la méthode Register de façon à utiliser le nouveau helper :</span><span class="sxs-lookup"><span data-stu-id="bc68f-181">Update the Register method to use the new helper:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample15.cs?highlight=17)]

<span data-ttu-id="bc68f-182">Mettez à jour la méthode Login de façon à renvoyer le mot de passe si le compte d’utilisateur n’a pas été confirmé :</span><span class="sxs-lookup"><span data-stu-id="bc68f-182">Update the Login method to resend the password if the user account has not been confirmed:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample16.cs?highlight=20)]

<a id="combine"></a>
## <a name="combine-social-and-local-login-accounts"></a><span data-ttu-id="bc68f-183">Combiner les comptes de connexion sociale et locale</span><span class="sxs-lookup"><span data-stu-id="bc68f-183">Combine social and local login accounts</span></span>

<span data-ttu-id="bc68f-184">Vous pouvez combiner des comptes locaux et de réseaux sociaux en cliquant sur le lien de votre e-mail.</span><span class="sxs-lookup"><span data-stu-id="bc68f-184">You can combine local and social accounts by clicking on your email link.</span></span> <span data-ttu-id="bc68f-185">Dans la séquence suivante, **RickAndMSFT@gmail.com** est d’abord créé en tant que connexion locale, mais vous pouvez d’abord créer le compte en tant que connexion de réseau social, puis ajouter une connexion locale.</span><span class="sxs-lookup"><span data-stu-id="bc68f-185">In the following sequence **RickAndMSFT@gmail.com** is first created as a local login, but you can create the account as a social log in first, then add a local login.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image5.png)

<span data-ttu-id="bc68f-186">Cliquez sur le lien **Gérer**.</span><span class="sxs-lookup"><span data-stu-id="bc68f-186">Click on the **Manage** link.</span></span> <span data-ttu-id="bc68f-187">Notez l’information **Connexions externes : 0** associée à ce compte.</span><span class="sxs-lookup"><span data-stu-id="bc68f-187">Note the **External Logins: 0** associated with this account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image6.png)

<span data-ttu-id="bc68f-188">Cliquez sur le lien vers un autre service de connexion et acceptez les demandes d’application.</span><span class="sxs-lookup"><span data-stu-id="bc68f-188">Click the link to another log in service and accept the app requests.</span></span> <span data-ttu-id="bc68f-189">Les deux comptes ont été combinés : vous pourrez donc vous connecter avec l'un ou l'autre compte.</span><span class="sxs-lookup"><span data-stu-id="bc68f-189">The two accounts have been combined, you will be able to log on with either account.</span></span> <span data-ttu-id="bc68f-190">Vous pouvez permettre à vos utilisateurs d’ajouter des comptes locaux au cas où leur service d’authentification de connexion de réseau social serait indisponible, ou au cas plus probable où ils auraient perdu l’accès à leur compte social.</span><span class="sxs-lookup"><span data-stu-id="bc68f-190">You might want your users to add local accounts in case their social log in authentication service is down, or more likely they have lost access to their social account.</span></span>

<span data-ttu-id="bc68f-191">Dans l’image suivante, Tom est une connexion de réseau social (comme l'indique **Connexions externes : 1** affiché dans la page).</span><span class="sxs-lookup"><span data-stu-id="bc68f-191">In the following image, Tom is a social log in (which you can see from the **External Logins: 1** shown on the page).</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image7.png)

<span data-ttu-id="bc68f-192">Le fait de cliquer sur **Choisir un mot de passe** vous permet d’ajouter une connexion locale associée au même compte.</span><span class="sxs-lookup"><span data-stu-id="bc68f-192">Clicking on **Pick a password** allows you to add a local log on associated with the same account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image8.png)

## <a name="email-confirmation-in-more-depth"></a><span data-ttu-id="bc68f-193">Confirmation de l’e-mail plus en détail</span><span class="sxs-lookup"><span data-stu-id="bc68f-193">Email confirmation in more depth</span></span>

<span data-ttu-id="bc68f-194">Mon didacticiel [Confirmation du compte et récupération de mot de passe avec ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) aborde ce sujet avec plus de détails.</span><span class="sxs-lookup"><span data-stu-id="bc68f-194">My tutorial [Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) goes into this topic with more details.</span></span>

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="bc68f-195">Débogage de l’application</span><span class="sxs-lookup"><span data-stu-id="bc68f-195">Debugging the app</span></span>

<span data-ttu-id="bc68f-196">Si vous ne recevez pas d’e-mail contenant le lien :</span><span class="sxs-lookup"><span data-stu-id="bc68f-196">If you don't get an email containing the link:</span></span>

- <span data-ttu-id="bc68f-197">Vérifiez votre dossier des courriers indésirables.</span><span class="sxs-lookup"><span data-stu-id="bc68f-197">Check your junk or spam folder.</span></span>
- <span data-ttu-id="bc68f-198">Connectez-vous à votre compte SendGrid et cliquez sur le [lien activité de messagerie](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="bc68f-198">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>

<span data-ttu-id="bc68f-199">Pour tester le lien de vérification sans e-mail, vous devez télécharger l'[exemple terminé](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span><span class="sxs-lookup"><span data-stu-id="bc68f-199">To test the verification link without email, download the [completed sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span></span> <span data-ttu-id="bc68f-200">Le lien de confirmation et les codes de confirmation seront affichés dans la page.</span><span class="sxs-lookup"><span data-stu-id="bc68f-200">The confirmation link and confirmation codes will be displayed on the page.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="bc68f-201">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="bc68f-201">Additional Resources</span></span>

- [<span data-ttu-id="bc68f-202">Des liens vers les ressources recommandées sur ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="bc68f-202">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- <span data-ttu-id="bc68f-203">[Confirmation de compte et récupération de mot de passe avec ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) Décrit plus en détails la confirmation de compte et la récupération de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bc68f-203">[Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) Goes into more detail on password recovery and account confirmation.</span></span>
- <span data-ttu-id="bc68f-204">[Application MVC 5 avec connexion Facebook, Twitter, LinkedIn et Google OAuth2](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) Ce tutoriel vous montre comment écrire une application ASP.NET MVC 5 avec une autorisation Facebook et Google OAuth2.</span><span class="sxs-lookup"><span data-stu-id="bc68f-204">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) This tutorial shows you how to write an ASP.NET MVC 5 app with Facebook and Google OAuth 2 authorization.</span></span> <span data-ttu-id="bc68f-205">Il montre également comment ajouter des données supplémentaires à la base de données Identity.</span><span class="sxs-lookup"><span data-stu-id="bc68f-205">It also shows how to add additional data to the Identity database.</span></span>
- <span data-ttu-id="bc68f-206">[Déployer une application sécurisée ASP.NET MVC avec l’appartenance, OAuth et SQL Database sur Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="bc68f-206">[Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="bc68f-207">Ce tutoriel ajoute le déploiement Azure, la sécurisation de votre application avec des rôles, l’utilisation de l’API d’appartenance pour ajouter des utilisateurs et des rôles, et des fonctionnalités de sécurité supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="bc68f-207">This tutorial adds Azure deployment, how to secure your app with roles, how to use the membership API to add users and roles, and additional security features.</span></span>
- [<span data-ttu-id="bc68f-208">Création d’une application pour Google OAuth 2 et connexion de l’application au projet</span><span class="sxs-lookup"><span data-stu-id="bc68f-208">Creating a Google app for OAuth 2 and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#goog)
- [<span data-ttu-id="bc68f-209">Création de l’application dans Facebook et connexion de l’application au projet</span><span class="sxs-lookup"><span data-stu-id="bc68f-209">Creating the app in Facebook and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#fb)
- [<span data-ttu-id="bc68f-210">Configuration de SSL dans le projet</span><span class="sxs-lookup"><span data-stu-id="bc68f-210">Setting up SSL in the Project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#ssl)
