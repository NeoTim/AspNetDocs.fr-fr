---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: La densité des connexions SignalR avec Crank de test | Microsoft Docs
author: bradygaster
description: Test de la densité des connexions SignalR avec Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65116085"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="7ab62-103">Test de la densité des connexions SignalR avec Crank</span><span class="sxs-lookup"><span data-stu-id="7ab62-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="7ab62-104">par [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="7ab62-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="7ab62-105">Cet article décrit comment utiliser l’outil de manivelle pour tester une application avec plusieurs clients simulés.</span><span class="sxs-lookup"><span data-stu-id="7ab62-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="7ab62-106">Une fois que votre application s’exécute dans son environnement d’hébergement (Azure un rôle, IIS, web ou auto-hébergé à l’aide d’Owin), vous pouvez tester la réponse de l’application à un niveau élevé de la densité des connexions à l’aide de l’outil manivelle.</span><span class="sxs-lookup"><span data-stu-id="7ab62-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="7ab62-107">L’environnement d’hébergement peut être un serveur Internet Information Services (IIS), un hôte Owin ou un rôle web Azure.</span><span class="sxs-lookup"><span data-stu-id="7ab62-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="7ab62-108">(Remarque : Compteurs de performances ne sont pas disponibles sur Azure App Service Web Apps, donc vous ne serez pas en mesure d’obtenir des données de performances à partir d’un test de densité de connexion.)</span><span class="sxs-lookup"><span data-stu-id="7ab62-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="7ab62-109">Densité de connexion fait référence au nombre de connexions TCP simultanées qui peuvent être établies sur un serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="7ab62-110">Chaque connexion TCP entraîne une surcharge de sa propre et ouverture d’un grand nombre de connexions inactives parviendrez à créer un goulot d’étranglement de mémoire.</span><span class="sxs-lookup"><span data-stu-id="7ab62-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="7ab62-111">[SignalR codebase](https://github.com/signalr/signalr) inclut un outil de test de charge appelé **Crank**.</span><span class="sxs-lookup"><span data-stu-id="7ab62-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="7ab62-112">Vous trouverez la dernière version de manivelle dans [la branche Dev](https://github.com/SignalR/signalr/tree/dev) sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="7ab62-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="7ab62-113">Vous pouvez télécharger un fichier Zip archive de la branche Dev de SignalR codebase [ici](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="7ab62-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="7ab62-114">Crank peut servir à entièrement saturer la mémoire du serveur afin de calculer le nombre total de connexions inactives que possibles sur le matériel serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="7ab62-115">Ou bien, vous pouvez également utiliser manivelle pour le test de charge du serveur sous une certaine quantité de pression de mémoire, en identifiant les connexions jusqu'à ce qu’un nombre spécifique ou un seuil de mémoire spécifique est atteint.</span><span class="sxs-lookup"><span data-stu-id="7ab62-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="7ab62-116">Lorsque vous testez, il est important d’utiliser à distance ou les clients afin d’éviter toute concurrence pour les ressources (par exemple, les connexions TCP et la mémoire).</span><span class="sxs-lookup"><span data-stu-id="7ab62-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="7ab62-117">Surveiller les clients pour vous assurer qu’ils n’atteignent pas les goulots d’étranglement qui peuvent empêcher le serveur d’atteindre sa capacité totale (processeur ou mémoire).</span><span class="sxs-lookup"><span data-stu-id="7ab62-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="7ab62-118">Vous devrez peut-être augmenter le nombre de clients afin de charger entièrement le serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="7ab62-119">Exécution d’un Test de densité de connexion</span><span class="sxs-lookup"><span data-stu-id="7ab62-119">Running a Connection Density Test</span></span>

<span data-ttu-id="7ab62-120">Cette section décrit les étapes nécessaires pour exécuter un test de densité de connexion sur une application de SignalR.</span><span class="sxs-lookup"><span data-stu-id="7ab62-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="7ab62-121">Télécharger et générer les [codebase de la branche Dev de SignalR](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="7ab62-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="7ab62-122">Dans une invite de commandes, accédez à &lt;répertoire du projet&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="7ab62-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="7ab62-123">Déployer votre application dans son environnement d’hébergement prévue.</span><span class="sxs-lookup"><span data-stu-id="7ab62-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="7ab62-124">Prenez note du point de terminaison par votre application ; par exemple, dans l’application créée dans le [didacticiel mise en route](../getting-started/tutorial-getting-started-with-signalr.md), le point de terminaison `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="7ab62-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="7ab62-125">Installer [les compteurs de performances de SignalR](signalr-performance.md#perfcounters) sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="7ab62-126">Si votre application s’exécute sur Azure, consultez [à l’aide des compteurs de performances de SignalR dans un rôle Web Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="7ab62-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="7ab62-127">Une fois que vous avez téléchargé et créé la base de code et installé les compteurs de performances sur votre ordinateur hôte, l’outil de ligne de commande manivelle se trouve dans le `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` dossier.</span><span class="sxs-lookup"><span data-stu-id="7ab62-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="7ab62-128">Les options disponibles pour l’outil manivelle incluent :</span><span class="sxs-lookup"><span data-stu-id="7ab62-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="7ab62-129">**/?**: Affiche l’écran d’aide.</span><span class="sxs-lookup"><span data-stu-id="7ab62-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="7ab62-130">Les options disponibles sont également affichées si les **Url** paramètre est omis.</span><span class="sxs-lookup"><span data-stu-id="7ab62-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="7ab62-131">**/ Url**: L’URL pour les connexions SignalR.</span><span class="sxs-lookup"><span data-stu-id="7ab62-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="7ab62-132">Ce paramètre est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="7ab62-132">This parameter is required.</span></span> <span data-ttu-id="7ab62-133">Pour une application de SignalR en utilisant le mappage par défaut, le chemin d’accès se termine par « / signalr ».</span><span class="sxs-lookup"><span data-stu-id="7ab62-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="7ab62-134">**/ Transport**: Le nom du transport utilisé.</span><span class="sxs-lookup"><span data-stu-id="7ab62-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="7ab62-135">La valeur par défaut est `auto`, qui sélectionne le meilleur protocole disponible.</span><span class="sxs-lookup"><span data-stu-id="7ab62-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="7ab62-136">Les options incluent `WebSockets`, `ServerSentEvents`, et `LongPolling` (`ForeverFrame` n’est pas une option pour manivelle, depuis le client .NET au lieu d’Internet Explorer est utilisé).</span><span class="sxs-lookup"><span data-stu-id="7ab62-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="7ab62-137">Pour plus d’informations sur la façon dont SignalR sélectionne les transports, consultez [Transports et les solutions de secours](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="7ab62-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="7ab62-138">**/BatchSize**: Le nombre de clients ajoutés dans chaque lot.</span><span class="sxs-lookup"><span data-stu-id="7ab62-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="7ab62-139">La valeur par défaut est 50.</span><span class="sxs-lookup"><span data-stu-id="7ab62-139">The default is 50.</span></span>
- <span data-ttu-id="7ab62-140">**/ ConnectInterval**: L’intervalle en millisecondes entre l’ajout de connexions.</span><span class="sxs-lookup"><span data-stu-id="7ab62-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="7ab62-141">La valeur par défaut est 500.</span><span class="sxs-lookup"><span data-stu-id="7ab62-141">The default is 500.</span></span>
- <span data-ttu-id="7ab62-142">**/ Connexions**: Le nombre de connexions utilisé pour l’application de test de charge.</span><span class="sxs-lookup"><span data-stu-id="7ab62-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="7ab62-143">La valeur par défaut est 100 000.</span><span class="sxs-lookup"><span data-stu-id="7ab62-143">The default is 100,000.</span></span>
- <span data-ttu-id="7ab62-144">**/ ConnectTimeout**: Le délai d’attente en secondes avant l’abandon du test.</span><span class="sxs-lookup"><span data-stu-id="7ab62-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="7ab62-145">La valeur par défaut est 300.</span><span class="sxs-lookup"><span data-stu-id="7ab62-145">The default is 300.</span></span>
- <span data-ttu-id="7ab62-146">**MinServerMBytes**: Les mégaoctets minimale du serveur à atteindre.</span><span class="sxs-lookup"><span data-stu-id="7ab62-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="7ab62-147">La valeur par défaut est 500.</span><span class="sxs-lookup"><span data-stu-id="7ab62-147">The default is 500.</span></span>
- <span data-ttu-id="7ab62-148">**SendBytes**: La taille de la charge utile envoyée au serveur en octets.</span><span class="sxs-lookup"><span data-stu-id="7ab62-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="7ab62-149">La valeur par défaut est 0.</span><span class="sxs-lookup"><span data-stu-id="7ab62-149">The default is 0.</span></span>
- <span data-ttu-id="7ab62-150">**SendInterval**: Le délai en millisecondes entre les messages au serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="7ab62-151">La valeur par défaut est 500.</span><span class="sxs-lookup"><span data-stu-id="7ab62-151">The default is 500.</span></span>
- <span data-ttu-id="7ab62-152">**SendTimeout**: Le délai d’expiration en millisecondes pour les messages au serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="7ab62-153">La valeur par défaut est 300.</span><span class="sxs-lookup"><span data-stu-id="7ab62-153">The default is 300.</span></span>
- <span data-ttu-id="7ab62-154">**ControllerUrl**: L’Url où un seul client hébergera un contrôleur central.</span><span class="sxs-lookup"><span data-stu-id="7ab62-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="7ab62-155">La valeur par défaut est null (aucun hub de contrôleur).</span><span class="sxs-lookup"><span data-stu-id="7ab62-155">The default is null (no controller hub).</span></span> <span data-ttu-id="7ab62-156">Le hub de contrôleur est lancé au démarrage de la session manivelle ; aucune autre contact entre le contrôleur et manivelle est fait.</span><span class="sxs-lookup"><span data-stu-id="7ab62-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="7ab62-157">**NumClients**: Le nombre de clients simulés pour vous connecter à l’application.</span><span class="sxs-lookup"><span data-stu-id="7ab62-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="7ab62-158">La valeur par défaut est un.</span><span class="sxs-lookup"><span data-stu-id="7ab62-158">The default is one.</span></span>
- <span data-ttu-id="7ab62-159">**Fichier journal**: Le nom de fichier pour le fichier journal pour la série de tests.</span><span class="sxs-lookup"><span data-stu-id="7ab62-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="7ab62-160">La valeur par défaut est `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="7ab62-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="7ab62-161">**SampleInterval**: Durée en millisecondes entre les échantillons de compteurs de performances.</span><span class="sxs-lookup"><span data-stu-id="7ab62-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="7ab62-162">La valeur par défaut est 1000.</span><span class="sxs-lookup"><span data-stu-id="7ab62-162">The default is 1000.</span></span>
- <span data-ttu-id="7ab62-163">**SignalRInstance**: Le nom d’instance des compteurs de performances sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="7ab62-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="7ab62-164">La valeur par défaut consiste à utiliser l’état de connexion du client.</span><span class="sxs-lookup"><span data-stu-id="7ab62-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="7ab62-165">Exemple</span><span class="sxs-lookup"><span data-stu-id="7ab62-165">Example</span></span>

<span data-ttu-id="7ab62-166">La commande suivante teste un site nommé `pfsignalr` sur Azure qui héberge une application sur le port 8080 avec un hub nommé « ControllerHub », à l’aide de 100 connexions.</span><span class="sxs-lookup"><span data-stu-id="7ab62-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
