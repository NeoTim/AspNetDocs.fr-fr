---
uid: signalr/overview/performance/scaleout-in-signalr
title: Présentation de ScaleOut dans Signalr | Microsoft Docs
author: bradygaster
description: Versions logicielles utilisées dans cette rubrique Visual Studio 2013 .NET 4,5 Signalr version 2 versions précédentes de cette rubrique pour plus d’informations sur les versions antérieures de...
ms.author: bradyg
ms.date: 06/10/2014
ms.assetid: 7e781fc1-1c1f-45a8-bc1d-338e96dbe9c9
msc.legacyurl: /signalr/overview/performance/scaleout-in-signalr
msc.type: authoredcontent
ms.openlocfilehash: 14dc22f99a43b566903c59fb23b7d419350f4a25
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78579232"
---
# <a name="introduction-to-scaleout-in-signalr"></a><span data-ttu-id="b8b74-103">Introduction au scale-out dans SignalR</span><span class="sxs-lookup"><span data-stu-id="b8b74-103">Introduction to Scaleout in SignalR</span></span>

<span data-ttu-id="b8b74-104">par [Mike Wasson](https://github.com/MikeWasson), [Patrick Fletcher](https://github.com/pfletcher)</span><span class="sxs-lookup"><span data-stu-id="b8b74-104">by [Mike Wasson](https://github.com/MikeWasson), [Patrick Fletcher](https://github.com/pfletcher)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> ## <a name="software-versions-used-in-this-topic"></a><span data-ttu-id="b8b74-105">Versions logicielles utilisées dans cette rubrique</span><span class="sxs-lookup"><span data-stu-id="b8b74-105">Software versions used in this topic</span></span>
>
>
> - [<span data-ttu-id="b8b74-106">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="b8b74-106">Visual Studio 2013</span></span>](https://my.visualstudio.com/Downloads?q=visual%20studio%202013)
> - <span data-ttu-id="b8b74-107">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="b8b74-107">.NET 4.5</span></span>
> - <span data-ttu-id="b8b74-108">Signalr version 2</span><span class="sxs-lookup"><span data-stu-id="b8b74-108">SignalR version 2</span></span>
>
>
>
> ## <a name="previous-versions-of-this-topic"></a><span data-ttu-id="b8b74-109">Versions précédentes de cette rubrique</span><span class="sxs-lookup"><span data-stu-id="b8b74-109">Previous versions of this topic</span></span>
>
> <span data-ttu-id="b8b74-110">Pour plus d’informations sur les versions antérieures de Signalr, consultez [versions antérieures de signalr](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="b8b74-110">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="b8b74-111">Questions et commentaires</span><span class="sxs-lookup"><span data-stu-id="b8b74-111">Questions and comments</span></span>
>
> <span data-ttu-id="b8b74-112">N’hésitez pas à nous faire part de vos commentaires sur la façon dont vous aimez ce didacticiel et sur ce que nous pourrions améliorer dans les commentaires en bas de la page.</span><span class="sxs-lookup"><span data-stu-id="b8b74-112">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="b8b74-113">Si vous avez des questions qui ne sont pas directement liées au didacticiel, vous pouvez les poster sur le [forum ASP.net signalr](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) ou [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="b8b74-113">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="b8b74-114">En général, il existe deux façons de mettre à l’échelle une application Web : *montée* en puissance et *montée*en charge.</span><span class="sxs-lookup"><span data-stu-id="b8b74-114">In general, there are two ways to scale a web application: *scale up* and *scale out*.</span></span>

- <span data-ttu-id="b8b74-115">La montée en puissance implique l’utilisation d’un serveur de plus grande taille (ou d’une machine virtuelle plus grande) avec davantage de RAM, de processeurs, etc.</span><span class="sxs-lookup"><span data-stu-id="b8b74-115">Scale up means using a larger server (or a larger VM) with more RAM, CPUs, etc.</span></span>
- <span data-ttu-id="b8b74-116">La montée en charge signifie l’ajout de serveurs supplémentaires pour gérer la charge.</span><span class="sxs-lookup"><span data-stu-id="b8b74-116">Scale out means adding more servers to handle the load.</span></span>

<span data-ttu-id="b8b74-117">Le problème de la mise à l’échelle est que vous atteignez rapidement une limite de la taille de la machine.</span><span class="sxs-lookup"><span data-stu-id="b8b74-117">The problem with scaling up is that you quickly hit a limit on the size of the machine.</span></span> <span data-ttu-id="b8b74-118">Au-delà, vous devez effectuer une montée en charge. Toutefois, lorsque vous mettez à l’échelle, les clients peuvent être acheminés vers différents serveurs.</span><span class="sxs-lookup"><span data-stu-id="b8b74-118">Beyond that, you need to scale out. However, when you scale out, clients can get routed to different servers.</span></span> <span data-ttu-id="b8b74-119">Un client connecté à un serveur ne reçoit pas les messages envoyés à partir d’un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="b8b74-119">A client that is connected to one server will not receive messages sent from another server.</span></span>

![](scaleout-in-signalr/_static/image1.png)

<span data-ttu-id="b8b74-120">Une solution consiste à transférer les messages entre les serveurs, à l’aide d’un composant appelé *backplane*.</span><span class="sxs-lookup"><span data-stu-id="b8b74-120">One solution is to forward messages between servers, using a component called a *backplane*.</span></span> <span data-ttu-id="b8b74-121">Quand un fond de panier est activé, chaque instance d’application envoie des messages au fond de panier et le fond de panier les transfère aux autres instances de l’application.</span><span class="sxs-lookup"><span data-stu-id="b8b74-121">With a backplane enabled, each application instance sends messages to the backplane, and the backplane forwards them to the other application instances.</span></span> <span data-ttu-id="b8b74-122">(En électronique, un fond de panier est un groupe de connecteurs parallèles.</span><span class="sxs-lookup"><span data-stu-id="b8b74-122">(In electronics, a backplane is a group of parallel connectors.</span></span> <span data-ttu-id="b8b74-123">Par analogie, un fond de panier Signalr connecte plusieurs serveurs.)</span><span class="sxs-lookup"><span data-stu-id="b8b74-123">By analogy, a SignalR backplane connects multiple servers.)</span></span>

![](scaleout-in-signalr/_static/image2.png)

<span data-ttu-id="b8b74-124">Signalr propose actuellement trois plans de perfectionnement :</span><span class="sxs-lookup"><span data-stu-id="b8b74-124">SignalR currently provides three backplanes:</span></span>

- <span data-ttu-id="b8b74-125">**Azure Service Bus**.</span><span class="sxs-lookup"><span data-stu-id="b8b74-125">**Azure Service Bus**.</span></span> <span data-ttu-id="b8b74-126">Service Bus est une infrastructure de messagerie qui permet aux composants d’envoyer des messages d’une manière faiblement couplée.</span><span class="sxs-lookup"><span data-stu-id="b8b74-126">Service Bus is a messaging infrastructure that allows components to send messages in a loosely coupled way.</span></span>
- <span data-ttu-id="b8b74-127">**ReDim**.</span><span class="sxs-lookup"><span data-stu-id="b8b74-127">**Redis**.</span></span> <span data-ttu-id="b8b74-128">Redims est un magasin clé-valeur en mémoire.</span><span class="sxs-lookup"><span data-stu-id="b8b74-128">Redis is an in-memory key-value store.</span></span> <span data-ttu-id="b8b74-129">Redims prend en charge un modèle de publication/abonnement (« Pub/Sub ») pour l’envoi de messages.</span><span class="sxs-lookup"><span data-stu-id="b8b74-129">Redis supports a publish/subscribe ("pub/sub") pattern for sending messages.</span></span>
- <span data-ttu-id="b8b74-130">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="b8b74-130">**SQL Server**.</span></span> <span data-ttu-id="b8b74-131">Le fond de panier SQL Server écrit des messages dans des tables SQL.</span><span class="sxs-lookup"><span data-stu-id="b8b74-131">The SQL Server backplane writes messages to SQL tables.</span></span> <span data-ttu-id="b8b74-132">Le fond de panier utilise Service Broker pour une messagerie efficace.</span><span class="sxs-lookup"><span data-stu-id="b8b74-132">The backplane uses Service Broker for efficient messaging.</span></span> <span data-ttu-id="b8b74-133">Toutefois, il fonctionne également si Service Broker n’est pas activé.</span><span class="sxs-lookup"><span data-stu-id="b8b74-133">However, it also works if Service Broker is not enabled.</span></span>

<span data-ttu-id="b8b74-134">Si vous déployez votre application sur Azure, envisagez d’utiliser le backplane ReDim à l’aide du [cache redims Azure](https://azure.microsoft.com/services/cache/).</span><span class="sxs-lookup"><span data-stu-id="b8b74-134">If you deploy your application on Azure, consider using the Redis backplane using [Azure Redis Cache](https://azure.microsoft.com/services/cache/).</span></span> <span data-ttu-id="b8b74-135">Si vous effectuez un déploiement sur votre propre batterie de serveurs, envisagez les SQL Server ou les redirections ReDim.</span><span class="sxs-lookup"><span data-stu-id="b8b74-135">If you are deploying to your own server farm, consider the SQL Server or Redis backplanes.</span></span>

<span data-ttu-id="b8b74-136">Les rubriques suivantes contiennent des didacticiels pas à pas pour chaque fond de panier :</span><span class="sxs-lookup"><span data-stu-id="b8b74-136">The following topics contain step-by-step tutorials for each backplane:</span></span>

- [<span data-ttu-id="b8b74-137">Montée en puissance parallèle de SignalR avec Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="b8b74-137">SignalR Scaleout with Azure Service Bus</span></span>](scaleout-with-windows-azure-service-bus.md)
- [<span data-ttu-id="b8b74-138">Montée en puissance parallèle de SignalR avec Redis</span><span class="sxs-lookup"><span data-stu-id="b8b74-138">SignalR Scaleout with Redis</span></span>](scaleout-with-redis.md)
- [<span data-ttu-id="b8b74-139">Montée en puissance parallèle de SignalR avec SQL Server</span><span class="sxs-lookup"><span data-stu-id="b8b74-139">SignalR Scaleout with SQL Server</span></span>](scaleout-with-sql-server.md)

## <a name="implementation"></a><span data-ttu-id="b8b74-140">Implémentation</span><span class="sxs-lookup"><span data-stu-id="b8b74-140">Implementation</span></span>

<span data-ttu-id="b8b74-141">Dans Signalr, chaque message est envoyé via un bus de messages.</span><span class="sxs-lookup"><span data-stu-id="b8b74-141">In SignalR, every message is sent through a message bus.</span></span> <span data-ttu-id="b8b74-142">Un bus de messages implémente l’interface [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) , qui fournit une abstraction de publication/abonnement.</span><span class="sxs-lookup"><span data-stu-id="b8b74-142">A message bus implements the [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) interface, which provides a publish/subscribe abstraction.</span></span> <span data-ttu-id="b8b74-143">Ces plans fonctionnent en remplaçant le **IMessageBus** par défaut par un bus conçu pour ce backplane.</span><span class="sxs-lookup"><span data-stu-id="b8b74-143">The backplanes work by replacing the default **IMessageBus** with a bus designed for that backplane.</span></span> <span data-ttu-id="b8b74-144">Par exemple, le bus de messages pour les insertions est [RedisMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.redis.redismessagebus(v=vs.100).aspx), et il utilise le mécanisme de [Pub/Sub](http://redis.io/topics/pubsub) redims pour envoyer et recevoir des messages.</span><span class="sxs-lookup"><span data-stu-id="b8b74-144">For example, the message bus for Redis is [RedisMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.redis.redismessagebus(v=vs.100).aspx), and it uses the Redis [pub/sub](http://redis.io/topics/pubsub) mechanism to send and receive messages.</span></span>

<span data-ttu-id="b8b74-145">Chaque instance de serveur se connecte au fond de panier via le bus.</span><span class="sxs-lookup"><span data-stu-id="b8b74-145">Each server instance connects to the backplane through the bus.</span></span> <span data-ttu-id="b8b74-146">Lorsqu’un message est envoyé, il passe au fond de panier et le fond de panier l’envoie à tous les serveurs.</span><span class="sxs-lookup"><span data-stu-id="b8b74-146">When a message is sent, it goes to the backplane, and the backplane sends it to every server.</span></span> <span data-ttu-id="b8b74-147">Lorsqu’un serveur reçoit un message du fond de panier, il place le message dans son cache local.</span><span class="sxs-lookup"><span data-stu-id="b8b74-147">When a server gets a message from the backplane, it puts the message in its local cache.</span></span> <span data-ttu-id="b8b74-148">Le serveur remet ensuite les messages aux clients à partir de son cache local.</span><span class="sxs-lookup"><span data-stu-id="b8b74-148">The server then delivers messages to clients from its local cache.</span></span>

<span data-ttu-id="b8b74-149">Pour chaque connexion client, la progression du client lors de la lecture du flux de messages est suivie à l’aide d’un curseur.</span><span class="sxs-lookup"><span data-stu-id="b8b74-149">For each client connection, the client's progress in reading the message stream is tracked using a cursor.</span></span> <span data-ttu-id="b8b74-150">(Un curseur représente une position dans le flux de message.) Si un client se déconnecte, puis se reconnecte, il demande au bus les messages arrivés après la valeur de curseur du client.</span><span class="sxs-lookup"><span data-stu-id="b8b74-150">(A cursor represents a position in the message stream.) If a client disconnects and then reconnects, it asks the bus for any messages that arrived after the client's cursor value.</span></span> <span data-ttu-id="b8b74-151">La même chose se produit lorsqu’une connexion utilise une [interrogation longue](../getting-started/introduction-to-signalr.md#transports).</span><span class="sxs-lookup"><span data-stu-id="b8b74-151">The same thing happens when a connection uses [long polling](../getting-started/introduction-to-signalr.md#transports).</span></span> <span data-ttu-id="b8b74-152">Après la fin d’une demande d’interrogation longue, le client ouvre une nouvelle connexion et demande les messages arrivés après le curseur.</span><span class="sxs-lookup"><span data-stu-id="b8b74-152">After a long poll request completes, the client opens a new connection and asks for messages that arrived after the cursor.</span></span>

<span data-ttu-id="b8b74-153">Le mécanisme de curseur fonctionne même si un client est routé vers un autre serveur lors de la reconnexion.</span><span class="sxs-lookup"><span data-stu-id="b8b74-153">The cursor mechanism works even if a client is routed to a different server on reconnect.</span></span> <span data-ttu-id="b8b74-154">Le fond de panier est conscient de tous les serveurs et peu importe le serveur auquel se connecte le client.</span><span class="sxs-lookup"><span data-stu-id="b8b74-154">The backplane is aware of all the servers, and it doesn't matter which server a client connects to.</span></span>

## <a name="limitations"></a><span data-ttu-id="b8b74-155">Limitations</span><span class="sxs-lookup"><span data-stu-id="b8b74-155">Limitations</span></span>

<span data-ttu-id="b8b74-156">À l’aide d’un fond de panier, le débit maximal de messages est plus faible que lorsque les clients communiquent directement avec un nœud de serveur unique.</span><span class="sxs-lookup"><span data-stu-id="b8b74-156">Using a backplane, the maximum message throughput is lower than it is when clients talk directly to a single server node.</span></span> <span data-ttu-id="b8b74-157">Cela est dû au fait que le fond de panier transmet chaque message à chaque nœud, de sorte que le fond de panier peut devenir un goulot d’étranglement.</span><span class="sxs-lookup"><span data-stu-id="b8b74-157">That's because the backplane forwards every message to every node, so the backplane can become a bottleneck.</span></span> <span data-ttu-id="b8b74-158">Le fait que cette limitation soit un problème dépend de l’application.</span><span class="sxs-lookup"><span data-stu-id="b8b74-158">Whether this limitation is a problem depends on the application.</span></span> <span data-ttu-id="b8b74-159">Par exemple, voici quelques scénarios de Signalr classiques :</span><span class="sxs-lookup"><span data-stu-id="b8b74-159">For example, here are some typical SignalR scenarios:</span></span>

- <span data-ttu-id="b8b74-160">[Diffusion](../getting-started/tutorial-server-broadcast-with-signalr.md) sur le serveur (par exemple, cotation boursière) : les plans sont adaptés à ce scénario, car le serveur contrôle la vitesse à laquelle les messages sont envoyés.</span><span class="sxs-lookup"><span data-stu-id="b8b74-160">[Server broadcast](../getting-started/tutorial-server-broadcast-with-signalr.md) (e.g., stock ticker): Backplanes work well for this scenario, because the server controls the rate at which messages are sent.</span></span>
- <span data-ttu-id="b8b74-161">[Client à client](../getting-started/tutorial-getting-started-with-signalr.md) (par exemple, conversation) : dans ce scénario, le fond de panier peut être un goulot d’étranglement si le nombre de messages est mis à l’échelle avec le nombre de clients ; autrement dit, si le taux de messages augmente proportionnellement au fur et à mesure que d’autres clients se joignent.</span><span class="sxs-lookup"><span data-stu-id="b8b74-161">[Client-to-client](../getting-started/tutorial-getting-started-with-signalr.md) (e.g., chat): In this scenario, the backplane might be a bottleneck if the number of messages scales with the number of clients; that is, if the rate of messages grows proportionally as more clients join.</span></span>
- <span data-ttu-id="b8b74-162">[Haute fréquence en temps réel](../getting-started/tutorial-high-frequency-realtime-with-signalr.md) (par exemple, jeux en temps réel) : un backplane n’est pas recommandé pour ce scénario.</span><span class="sxs-lookup"><span data-stu-id="b8b74-162">[High-frequency realtime](../getting-started/tutorial-high-frequency-realtime-with-signalr.md) (e.g., real-time games): A backplane is not recommended for this scenario.</span></span>

## <a name="enabling-tracing-for-signalr-scaleout"></a><span data-ttu-id="b8b74-163">Activation du suivi pour Signalr ScaleOut</span><span class="sxs-lookup"><span data-stu-id="b8b74-163">Enabling Tracing For SignalR Scaleout</span></span>

<span data-ttu-id="b8b74-164">Pour activer le suivi des plans, ajoutez les sections suivantes au fichier Web. config, sous l’élément de **configuration** racine :</span><span class="sxs-lookup"><span data-stu-id="b8b74-164">To enable tracing for the backplanes, add the following sections to the web.config file, under the root **configuration** element:</span></span>

[!code-html[Main](scaleout-in-signalr/samples/sample1.html)]
