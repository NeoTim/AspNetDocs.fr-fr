---
uid: signalr/overview/getting-started/real-time-web-applications-with-signalr
title: 'Atelier pratique : applications Web en temps réel avec Signalr | Microsoft Docs'
author: bradygaster
description: Les applications Web en temps réel permettent d’envoyer du contenu côté serveur vers les clients connectés en temps réel. Pour les développeurs ASP.NET, ASP...
ms.author: bradyg
ms.date: 07/16/2014
ms.assetid: ba07958c-42e1-4da0-81db-ba6925ed6db0
msc.legacyurl: /signalr/overview/getting-started/real-time-web-applications-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 9e39fd3f2fc9d4e791002450085215096c222fcd
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78537099"
---
# <a name="hands-on-lab-real-time-web-applications-with-signalr"></a><span data-ttu-id="64680-104">Atelier pratique : applications Web en temps réel avec Signalr</span><span class="sxs-lookup"><span data-stu-id="64680-104">Hands On Lab: Real-Time Web Applications with SignalR</span></span>

<span data-ttu-id="64680-105">par l' [équipe Web camps](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="64680-105">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

[<span data-ttu-id="64680-106">Télécharger le kit de formation Web camps, version 2015 d’octobre</span><span class="sxs-lookup"><span data-stu-id="64680-106">Download Web Camps Training Kit, October 2015 Release</span></span>](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b)

> <span data-ttu-id="64680-107">Les applications Web en temps réel permettent d’envoyer du contenu côté serveur vers les clients connectés en temps réel.</span><span class="sxs-lookup"><span data-stu-id="64680-107">Real-time Web applications feature the ability to push server-side content to the connected clients as it happens, in real-time.</span></span> <span data-ttu-id="64680-108">Pour les développeurs ASP.NET, **ASP.net signalr** est une bibliothèque qui permet d’ajouter des fonctionnalités Web en temps réel à leurs applications.</span><span class="sxs-lookup"><span data-stu-id="64680-108">For ASP.NET developers, **ASP.NET SignalR** is a library to add real-time web functionality to their applications.</span></span> <span data-ttu-id="64680-109">Elle tire parti de plusieurs transports, en sélectionnant automatiquement le meilleur transport disponible en fonction du meilleur transport disponible du client et du serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-109">It takes advantage of several transports, automatically selecting the best available transport given the client and server's best available transport.</span></span> <span data-ttu-id="64680-110">Elle tire parti de **WebSocket**, une API HTML5 qui permet une communication bidirectionnelle entre le navigateur et le serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-110">It takes advantage of **WebSocket**, an HTML5 API that enables bi-directional communication between the browser and server.</span></span>
> 
> <span data-ttu-id="64680-111">**Signalr** fournit également une API de haut niveau simple pour effectuer un RPC de serveur à client (appeler des fonctions JavaScript dans les navigateurs de vos clients à partir du code .net côté serveur) dans votre application ASP.net, ainsi qu’ajouter des hooks utiles pour la gestion des connexions, telles que les événements de connexion/déconnexion, le regroupement de connexions et l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="64680-111">**SignalR** also provides a simple, high-level API for doing server to client RPC (call JavaScript functions in your clients' browsers from server-side .NET code) in your ASP.NET application, as well as adding useful hooks for connection management, such as connect/disconnect events, grouping connections, and authorization.</span></span>
> 
> <span data-ttu-id="64680-112">**Signalr** est une abstraction sur certains des transports requis pour effectuer un travail en temps réel entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-112">**SignalR** is an abstraction over some of the transports that are required to do real-time work between client and server.</span></span> <span data-ttu-id="64680-113">Une connexion **signalr** démarre en tant que http et est ensuite promue en connexion **WebSocket** si elle est disponible.</span><span class="sxs-lookup"><span data-stu-id="64680-113">A **SignalR** connection starts as HTTP, and is then promoted to a **WebSocket** connection if available.</span></span> <span data-ttu-id="64680-114">**WebSocket** est le transport idéal pour **signalr**, car il optimise l’utilisation de la mémoire du serveur, présente la latence la plus faible et possède les fonctionnalités les plus sous-jacentes (telles que la communication duplex intégrale entre le client et le serveur), mais il présente également les exigences les plus strictes : **WebSocket** requiert que le serveur utilise **Windows server 2012** ou **Windows 8**, ainsi **4,5 .NET Framework**que</span><span class="sxs-lookup"><span data-stu-id="64680-114">**WebSocket** is the ideal transport for **SignalR**, since it makes the most efficient use of server memory, has the lowest latency, and has the most underlying features (such as full duplex communication between client and server), but it also has the most stringent requirements: **WebSocket** requires the server to be using **Windows Server 2012** or **Windows 8**, along with **.NET Framework 4.5**.</span></span> <span data-ttu-id="64680-115">Si ces exigences ne sont pas satisfaites, **signalr** tente d’utiliser d’autres transports pour effectuer ses connexions (par exemple, *interrogation longue Ajax*).</span><span class="sxs-lookup"><span data-stu-id="64680-115">If these requirements are not met, **SignalR** will attempt to use other transports to make its connections (like *Ajax long polling*).</span></span>
> 
> <span data-ttu-id="64680-116">L’API **signalr** contient deux modèles pour la communication entre les clients et les serveurs : **connexions persistantes** et **concentrateurs**.</span><span class="sxs-lookup"><span data-stu-id="64680-116">The **SignalR** API contains two models for communicating between clients and servers: **Persistent Connections** and **Hubs**.</span></span> <span data-ttu-id="64680-117">Une **connexion** représente un point de terminaison simple pour l’envoi de messages de destinataire unique, groupés ou de diffusion.</span><span class="sxs-lookup"><span data-stu-id="64680-117">A **Connection** represents a simple endpoint for sending single-recipient, grouped, or broadcast messages.</span></span> <span data-ttu-id="64680-118">Un **Hub** est un pipeline plus élevé basé sur l’API de connexion qui permet à votre client et à votre serveur d’appeler directement des méthodes.</span><span class="sxs-lookup"><span data-stu-id="64680-118">A **Hub** is a more high-level pipeline built upon the Connection API that allows your client and server to call methods on each other directly.</span></span>
> 
> ![Architecture signalr](real-time-web-applications-with-signalr/_static/image1.png)
> 
> <span data-ttu-id="64680-120">Tous les exemples de code et les extraits de code sont inclus dans le kit de formation Web camps, version 2015 d’octobre, disponible sur [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span><span class="sxs-lookup"><span data-stu-id="64680-120">All sample code and snippets are included in the Web Camps Training Kit, October 2015 Release, available at [https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b](https://github.com/Microsoft-Web/WebCampTrainingKit/releases/tag/v2015.10.13b).</span></span>  <span data-ttu-id="64680-121">Notez que le lien du programme d’installation sur cette page ne fonctionne plus ; Utilisez plutôt l’un des liens sous la section ressources.</span><span class="sxs-lookup"><span data-stu-id="64680-121">Please note that the Installer link on that page no longer works; use one of the links under the Assets section instead.</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="64680-122">Présentation</span><span class="sxs-lookup"><span data-stu-id="64680-122">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="64680-123">Objectifs</span><span class="sxs-lookup"><span data-stu-id="64680-123">Objectives</span></span>

<span data-ttu-id="64680-124">Dans ce laboratoire pratique, vous allez apprendre à :</span><span class="sxs-lookup"><span data-stu-id="64680-124">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="64680-125">Envoyer des notifications du serveur au client à l’aide de Signalr.</span><span class="sxs-lookup"><span data-stu-id="64680-125">Send notifications from server to client using SignalR.</span></span>
- <span data-ttu-id="64680-126">Scale Out votre application Signalr à l’aide de **SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="64680-126">Scale Out your SignalR application using **SQL Server**.</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="64680-127">Conditions préalables requises</span><span class="sxs-lookup"><span data-stu-id="64680-127">Prerequisites</span></span>

<span data-ttu-id="64680-128">Les éléments suivants sont requis pour effectuer ce laboratoire pratique :</span><span class="sxs-lookup"><span data-stu-id="64680-128">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="64680-129">[Visual Studio Express 2013 pour Web](https://www.microsoft.com/visualstudio/) ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="64680-129">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="64680-130">Installation</span><span class="sxs-lookup"><span data-stu-id="64680-130">Setup</span></span>

<span data-ttu-id="64680-131">Pour exécuter les exercices dans ce laboratoire pratique, vous devez d’abord configurer votre environnement.</span><span class="sxs-lookup"><span data-stu-id="64680-131">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="64680-132">Ouvrez une fenêtre de l’Explorateur Windows et accédez au dossier **source** du laboratoire.</span><span class="sxs-lookup"><span data-stu-id="64680-132">Open a Windows Explorer window and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="64680-133">Cliquez avec le bouton droit sur **Setup. cmd** et sélectionnez **exécuter en tant qu’administrateur** pour lancer le processus d’installation qui va configurer votre environnement et installer les extraits de code Visual Studio pour ce Lab.</span><span class="sxs-lookup"><span data-stu-id="64680-133">Right-click **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="64680-134">Si la boîte de dialogue contrôle de compte d’utilisateur s’affiche, confirmez l’action pour continuer.</span><span class="sxs-lookup"><span data-stu-id="64680-134">If the User Account Control dialog box is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="64680-135">Vérifiez que vous avez vérifié toutes les dépendances de ce Lab avant d’exécuter le programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="64680-135">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="64680-136">Utilisation des extraits de code</span><span class="sxs-lookup"><span data-stu-id="64680-136">Using the Code Snippets</span></span>

<span data-ttu-id="64680-137">Tout au long du document Lab, vous serez invité à insérer des blocs de code.</span><span class="sxs-lookup"><span data-stu-id="64680-137">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="64680-138">Pour plus de commodité, la majeure partie de ce code est fournie sous la forme d’extraits de Visual Studio Code, auxquels vous pouvez accéder à partir de Visual Studio 2013 pour éviter d’avoir à l’ajouter manuellement.</span><span class="sxs-lookup"><span data-stu-id="64680-138">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="64680-139">Chaque exercice est accompagné d’une solution de démarrage située dans le dossier **Begin** de l’exercice, qui vous permet de suivre chaque exercice indépendamment des autres.</span><span class="sxs-lookup"><span data-stu-id="64680-139">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="64680-140">N’oubliez pas que les extraits de code ajoutés au cours d’un exercice sont absents de ces solutions de démarrage et peuvent ne pas fonctionner tant que vous n’avez pas terminé l’exercice.</span><span class="sxs-lookup"><span data-stu-id="64680-140">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="64680-141">À l’intérieur du code source d’un exercice, vous trouverez également un dossier de **fin** contenant une solution Visual Studio avec le code qui résulte de l’exécution des étapes de l’exercice correspondant.</span><span class="sxs-lookup"><span data-stu-id="64680-141">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="64680-142">Vous pouvez utiliser ces solutions comme conseils si vous avez besoin d’aide supplémentaire au fur et à mesure que vous travaillez dans ce laboratoire pratique.</span><span class="sxs-lookup"><span data-stu-id="64680-142">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="64680-143">Exercices</span><span class="sxs-lookup"><span data-stu-id="64680-143">Exercises</span></span>

<span data-ttu-id="64680-144">Ce laboratoire pratique comprend les exercices suivants :</span><span class="sxs-lookup"><span data-stu-id="64680-144">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="64680-145">Utilisation des données en temps réel à l’aide de Signalr</span><span class="sxs-lookup"><span data-stu-id="64680-145">Working with Real-Time Data Using SignalR</span></span>](#Exercise1)
2. [<span data-ttu-id="64680-146">Montée en charge à l’aide de SQL Server</span><span class="sxs-lookup"><span data-stu-id="64680-146">Scaling Out Using SQL Server</span></span>](#Exercise2)

<span data-ttu-id="64680-147">Durée estimée pour effectuer ce laboratoire : **60 minutes**</span><span class="sxs-lookup"><span data-stu-id="64680-147">Estimated time to complete this lab: **60 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="64680-148">Lorsque vous démarrez Visual Studio pour la première fois, vous devez sélectionner l’une des collections de paramètres prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="64680-148">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="64680-149">Chaque collection prédéfinie est conçue pour correspondre à un style de développement particulier et détermine les dispositions de fenêtres, le comportement de l’éditeur, les extraits de code IntelliSense et les options de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="64680-149">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="64680-150">Les procédures de ce laboratoire décrivent les actions nécessaires pour accomplir une tâche donnée dans Visual Studio lors de l’utilisation de la collection de **paramètres de développement généraux** .</span><span class="sxs-lookup"><span data-stu-id="64680-150">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="64680-151">Si vous choisissez une autre collection de paramètres pour votre environnement de développement, il peut y avoir des différences entre les étapes que vous devez prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="64680-151">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-working-with-real-time-data-using-signalr"></a><span data-ttu-id="64680-152">Exercice 1 : utilisation des données en temps réel à l’aide de Signalr</span><span class="sxs-lookup"><span data-stu-id="64680-152">Exercise 1: Working with Real-Time Data Using SignalR</span></span>

<span data-ttu-id="64680-153">Alors que la conversation est souvent utilisée comme exemple, vous pouvez en faire beaucoup plus avec la fonctionnalité Web en temps réel.</span><span class="sxs-lookup"><span data-stu-id="64680-153">While chat is often used as an example, you can do a whole lot more with real-time Web functionality.</span></span> <span data-ttu-id="64680-154">Chaque fois qu’un utilisateur actualise une page Web pour voir les nouvelles données ou que la page implémente une interrogation longue AJAX pour récupérer de nouvelles données, vous pouvez utiliser Signalr.</span><span class="sxs-lookup"><span data-stu-id="64680-154">Any time a user refreshes a web page to see new data or the page implements Ajax long polling to retrieve new data, you can use SignalR.</span></span>

<span data-ttu-id="64680-155">Signalr prend en charge la fonctionnalité d’émission ou de **diffusion** de **serveur** ; Il gère automatiquement la gestion des connexions.</span><span class="sxs-lookup"><span data-stu-id="64680-155">SignalR supports **server push** or **broadcasting** functionality; it handles connection management automatically.</span></span> <span data-ttu-id="64680-156">Dans les connexions HTTP classiques pour la communication client-serveur, la connexion est rétablie pour chaque demande, mais Signalr assure une connexion permanente entre le client et le serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-156">In classic HTTP connections for client-server communication, connection is re-established for each request, but SignalR provides persistent connection between the client and server.</span></span> <span data-ttu-id="64680-157">Dans Signalr, le code serveur appelle un code client dans le navigateur à l’aide d’appels de procédure distante (RPC), plutôt que du modèle de demande-réponse que nous savons aujourd’hui.</span><span class="sxs-lookup"><span data-stu-id="64680-157">In SignalR the server code calls out to a client code in the browser using Remote Procedure Calls (RPC), rather than the request-response model we know today.</span></span>

<span data-ttu-id="64680-158">Dans cet exercice, vous allez configurer l’application de **quiz** pour utiliser signalr pour afficher le tableau de bord des statistiques avec les mesures mises à jour sans avoir à actualiser la page entière.</span><span class="sxs-lookup"><span data-stu-id="64680-158">In this exercise, you will configure the **Geek Quiz** application to use SignalR to display the Statistics dashboard with the updated metrics without the need to refresh the entire page.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--exploring-the-geek-quiz-statistics-page"></a><span data-ttu-id="64680-159">Tâche 1 : exploration de la page de statistiques des quiz de l’inversion</span><span class="sxs-lookup"><span data-stu-id="64680-159">Task 1 – Exploring the Geek Quiz Statistics Page</span></span>

<span data-ttu-id="64680-160">Dans cette tâche, vous allez parcourir l’application et vérifier comment la page statistiques s’affiche et comment vous pouvez améliorer la façon dont les informations sont mises à jour.</span><span class="sxs-lookup"><span data-stu-id="64680-160">In this task, you will go through the application and verify how the statistics page is shown and how you can improve the way the information is updated.</span></span>

1. <span data-ttu-id="64680-161">Ouvrez **Visual Studio Express 2013 pour le Web** et ouvrez la solution **GeekQuiz. sln** qui se trouve dans le dossier **Source\Ex1-WorkingWithRealTimeData\Begin** .</span><span class="sxs-lookup"><span data-stu-id="64680-161">Open **Visual Studio Express 2013 for Web** and open the **GeekQuiz.sln** solution located in the **Source\Ex1-WorkingWithRealTimeData\Begin** folder.</span></span>
2. <span data-ttu-id="64680-162">Appuyez sur **F5** pour exécuter la solution.</span><span class="sxs-lookup"><span data-stu-id="64680-162">Press **F5** to run the solution.</span></span> <span data-ttu-id="64680-163">La page **de connexion** doit s’afficher dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="64680-163">The **Log in** page should appear in the browser.</span></span>

    <span data-ttu-id="64680-164">![Exécution de la solution](real-time-web-applications-with-signalr/_static/image2.png "Exécution de la solution")</span><span class="sxs-lookup"><span data-stu-id="64680-164">![Running the solution](real-time-web-applications-with-signalr/_static/image2.png "Running the solution")</span></span>

    <span data-ttu-id="64680-165">*Exécution de la solution*</span><span class="sxs-lookup"><span data-stu-id="64680-165">*Running the solution*</span></span>
3. <span data-ttu-id="64680-166">Cliquez sur **s’inscrire** dans le coin supérieur droit de la page pour créer un nouvel utilisateur dans l’application.</span><span class="sxs-lookup"><span data-stu-id="64680-166">Click **Register** in the upper-right corner of the page to create a new user in the application.</span></span>

    <span data-ttu-id="64680-167">![Enregistrer le lien](real-time-web-applications-with-signalr/_static/image3.png "Enregistrer le lien")</span><span class="sxs-lookup"><span data-stu-id="64680-167">![Register link](real-time-web-applications-with-signalr/_static/image3.png "Register link")</span></span>

    <span data-ttu-id="64680-168">*Enregistrer le lien*</span><span class="sxs-lookup"><span data-stu-id="64680-168">*Register link*</span></span>
4. <span data-ttu-id="64680-169">Dans la page **inscrire** , entrez un **nom d’utilisateur** et un **mot de passe**, puis cliquez sur **inscrire**.</span><span class="sxs-lookup"><span data-stu-id="64680-169">In the **Register** page, enter a **User name** and **Password**, and then click **Register**.</span></span>

    <span data-ttu-id="64680-170">![Inscription d’un utilisateur](real-time-web-applications-with-signalr/_static/image4.png "Inscription d’un utilisateur")</span><span class="sxs-lookup"><span data-stu-id="64680-170">![Registering a user](real-time-web-applications-with-signalr/_static/image4.png "Registering a user")</span></span>

    <span data-ttu-id="64680-171">*Inscription d’un utilisateur*</span><span class="sxs-lookup"><span data-stu-id="64680-171">*Registering a user*</span></span>
5. <span data-ttu-id="64680-172">L’application inscrit le nouveau compte et l’utilisateur est authentifié et redirigé vers la page d’hébergement pour montrer la première question du quiz.</span><span class="sxs-lookup"><span data-stu-id="64680-172">The application registers the new account and the user is authenticated and redirected back to the home page showing the first quiz question.</span></span>
6. <span data-ttu-id="64680-173">Ouvrez la page des **statistiques** dans une nouvelle fenêtre et placez la page d' **hébergement** et la page de **statistiques** côte à côte.</span><span class="sxs-lookup"><span data-stu-id="64680-173">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side.</span></span>

    <span data-ttu-id="64680-174">![Fenêtres côte à côte](real-time-web-applications-with-signalr/_static/image5.png "Fenêtres côte à côte")</span><span class="sxs-lookup"><span data-stu-id="64680-174">![Side-by-side windows](real-time-web-applications-with-signalr/_static/image5.png "Side by side windows")</span></span>

    <span data-ttu-id="64680-175">*Fenêtres côte à côte*</span><span class="sxs-lookup"><span data-stu-id="64680-175">*Side-by-side windows*</span></span>
7. <span data-ttu-id="64680-176">Dans la page d' **hébergement** , répondez à la question en cliquant sur l’une des options.</span><span class="sxs-lookup"><span data-stu-id="64680-176">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="64680-177">![Répondre à une question](real-time-web-applications-with-signalr/_static/image6.png "Répondre à une question")</span><span class="sxs-lookup"><span data-stu-id="64680-177">![Answering a question](real-time-web-applications-with-signalr/_static/image6.png "Answering a question")</span></span>

    <span data-ttu-id="64680-178">*Répondre à une question*</span><span class="sxs-lookup"><span data-stu-id="64680-178">*Answering a question*</span></span>
8. <span data-ttu-id="64680-179">Une fois que vous avez cliqué sur l’un des boutons, la réponse doit s’afficher.</span><span class="sxs-lookup"><span data-stu-id="64680-179">After clicking one of the buttons, the answer should appear.</span></span>

    <span data-ttu-id="64680-180">![Question à réponse correcte](real-time-web-applications-with-signalr/_static/image7.png "Question à réponse correcte")</span><span class="sxs-lookup"><span data-stu-id="64680-180">![Question answered correct](real-time-web-applications-with-signalr/_static/image7.png "Question answered correct")</span></span>

    <span data-ttu-id="64680-181">*Réponse à la question correctement*</span><span class="sxs-lookup"><span data-stu-id="64680-181">*Question answered correctly*</span></span>
9. <span data-ttu-id="64680-182">Notez que les informations fournies dans la page des statistiques sont obsolètes.</span><span class="sxs-lookup"><span data-stu-id="64680-182">Notice that the information provided in the Statistics page is outdated.</span></span> <span data-ttu-id="64680-183">Actualisez la page pour afficher les résultats mis à jour.</span><span class="sxs-lookup"><span data-stu-id="64680-183">Refresh the page in order to see the updated results.</span></span>

    <span data-ttu-id="64680-184">![Page des statistiques](real-time-web-applications-with-signalr/_static/image8.png "Page des statistiques")</span><span class="sxs-lookup"><span data-stu-id="64680-184">![Statistics page](real-time-web-applications-with-signalr/_static/image8.png "Statistics page")</span></span>

    <span data-ttu-id="64680-185">*Page des statistiques*</span><span class="sxs-lookup"><span data-stu-id="64680-185">*Statistics page*</span></span>
10. <span data-ttu-id="64680-186">Revenez à Visual Studio et arrêtez le débogage.</span><span class="sxs-lookup"><span data-stu-id="64680-186">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--adding-signalr-to-geek-quiz-to-show-online-charts"></a><span data-ttu-id="64680-187">Tâche 2 : ajout de Signalr au quiz de l’inversion pour afficher les graphiques en ligne</span><span class="sxs-lookup"><span data-stu-id="64680-187">Task 2 – Adding SignalR to Geek Quiz to Show Online Charts</span></span>

<span data-ttu-id="64680-188">Au cours de cette tâche, vous allez ajouter Signalr à la solution et envoyer automatiquement des mises à jour aux clients lorsqu’une nouvelle réponse est envoyée au serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-188">In this task, you will add SignalR to the solution and send updates to the clients automatically when a new answer is sent to the server.</span></span>

1. <span data-ttu-id="64680-189">Dans le menu **Outils** de Visual Studio, sélectionnez **Gestionnaire de package NuGet**, puis cliquez sur **console du gestionnaire de package**.</span><span class="sxs-lookup"><span data-stu-id="64680-189">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
2. <span data-ttu-id="64680-190">Dans la fenêtre **console du gestionnaire de package** , exécutez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="64680-190">In the **Package Manager Console** window, execute the following command:</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample1.ps1)]

    <span data-ttu-id="64680-191">![Installation du package signalr](real-time-web-applications-with-signalr/_static/image9.png "Installation du package signalr")</span><span class="sxs-lookup"><span data-stu-id="64680-191">![SignalR package installation](real-time-web-applications-with-signalr/_static/image9.png "SignalR package installation")</span></span>

    <span data-ttu-id="64680-192">*Installation du package signalr*</span><span class="sxs-lookup"><span data-stu-id="64680-192">*SignalR package installation*</span></span>

   > [!NOTE]
   > <span data-ttu-id="64680-193">Lors de l’installation des packages NuGet **signalr** version 2.0.2 à partir d’une nouvelle application MVC 5, vous devez mettre à jour manuellement les packages **OWIN** vers la version 2.0.1 (ou une version ultérieure) avant d’installer signalr.</span><span class="sxs-lookup"><span data-stu-id="64680-193">When installing **SignalR** NuGet packages version 2.0.2 from a brand new MVC 5 application, you will need to manually update **OWIN** packages to version 2.0.1 (or higher) before installing SignalR.</span></span> <span data-ttu-id="64680-194">Pour ce faire, vous pouvez exécuter le script suivant dans la **console du gestionnaire de package**:</span><span class="sxs-lookup"><span data-stu-id="64680-194">To do this, you can execute the following script in the **Package Manager Console**:</span></span>
   > 
   > [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample2.ps1)]
   > 
   > <span data-ttu-id="64680-195">Dans une version ultérieure de Signalr, les dépendances OWIN seront automatiquement mises à jour.</span><span class="sxs-lookup"><span data-stu-id="64680-195">In a future release of SignalR, OWIN dependencies will be automatically updated.</span></span>
3. <span data-ttu-id="64680-196">Dans **Explorateur de solutions**, développez le dossier **scripts** et notez que les fichiers *js* signalr ont été ajoutés à la solution.</span><span class="sxs-lookup"><span data-stu-id="64680-196">In **Solution Explorer**, expand the **Scripts** folder and notice that the SignalR *js* files were added to the solution.</span></span>

    <span data-ttu-id="64680-197">![Références JavaScript signalr](real-time-web-applications-with-signalr/_static/image10.png "Références JavaScript signalr")</span><span class="sxs-lookup"><span data-stu-id="64680-197">![SignalR JavaScript references](real-time-web-applications-with-signalr/_static/image10.png "SignalR JavaScript references")</span></span>

    <span data-ttu-id="64680-198">*Références JavaScript signalr*</span><span class="sxs-lookup"><span data-stu-id="64680-198">*SignalR JavaScript references*</span></span>
4. <span data-ttu-id="64680-199">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet **GeekQuiz** , sélectionnez **Ajouter** | **nouveau dossier**, puis nommez-le **hubs**.</span><span class="sxs-lookup"><span data-stu-id="64680-199">In **Solution Explorer**, right-click the **GeekQuiz** project, select **Add** | **New Folder**, and name it **Hubs**.</span></span>
5. <span data-ttu-id="64680-200">Cliquez avec le bouton droit sur le dossier **hubs** , puis sélectionnez **Ajouter | Nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="64680-200">Right-click the **Hubs** folder and select **Add | New Item**.</span></span>

    <span data-ttu-id="64680-201">![Ajouter un nouvel élément](real-time-web-applications-with-signalr/_static/image11.png "Ajouter un nouvel élément")</span><span class="sxs-lookup"><span data-stu-id="64680-201">![Add new item](real-time-web-applications-with-signalr/_static/image11.png "Add new item")</span></span>

    <span data-ttu-id="64680-202">*Ajouter un nouvel élément*</span><span class="sxs-lookup"><span data-stu-id="64680-202">*Add new item*</span></span>
6. <span data-ttu-id="64680-203">Dans la boîte de dialogue **Ajouter un nouvel élément** , sélectionnez l’élément  **C# visuel | Web | Nœud signalr** dans le volet gauche, sélectionnez la **classe de concentrateur signalr (v2)** dans le volet central, nommez le fichier **StatisticsHub.cs** , puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="64680-203">In the **Add New Item** dialog box, select the **Visual C# | Web | SignalR** node in the left pane, select **SignalR Hub Class (v2)** from the center pane, name the file **StatisticsHub.cs** and click **Add**.</span></span>

    <span data-ttu-id="64680-204">![Boîte de dialogue Ajouter un nouvel élément](real-time-web-applications-with-signalr/_static/image12.png "Boîte de dialogue Ajouter un nouvel élément")</span><span class="sxs-lookup"><span data-stu-id="64680-204">![Add new item dialog box](real-time-web-applications-with-signalr/_static/image12.png "Add new item dialog box")</span></span>

    <span data-ttu-id="64680-205">*Boîte de dialogue Ajouter un nouvel élément*</span><span class="sxs-lookup"><span data-stu-id="64680-205">*Add new item dialog box*</span></span>
7. <span data-ttu-id="64680-206">Remplacez le code de la classe **StatisticsHub** par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="64680-206">Replace the code in the **StatisticsHub** class with the following code.</span></span>

    <span data-ttu-id="64680-207">(Extrait de code- *RealTimeSignalR-EX1-StatisticsHubClass*)</span><span class="sxs-lookup"><span data-stu-id="64680-207">(Code Snippet - *RealTimeSignalR - Ex1 - StatisticsHubClass*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample3.cs)]
8. <span data-ttu-id="64680-208">Ouvrez **Startup.cs** et ajoutez la ligne suivante à la fin de la méthode de **configuration** .</span><span class="sxs-lookup"><span data-stu-id="64680-208">Open **Startup.cs** and add the following line at the end of the **Configuration** method.</span></span>

    <span data-ttu-id="64680-209">(Extrait de code- *RealTimeSignalR-EX1-MapSignalR*)</span><span class="sxs-lookup"><span data-stu-id="64680-209">(Code Snippet - *RealTimeSignalR - Ex1 - MapSignalR*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample4.cs)]
9. <span data-ttu-id="64680-210">Ouvrez la page **StatisticsService.cs** dans le dossier **services** et ajoutez les directives using suivantes.</span><span class="sxs-lookup"><span data-stu-id="64680-210">Open the **StatisticsService.cs** page inside the **Services** folder and add the following using directives.</span></span>

    <span data-ttu-id="64680-211">(Extrait de code- *RealTimeSignalR-EX1-UsingDirectives*)</span><span class="sxs-lookup"><span data-stu-id="64680-211">(Code Snippet - *RealTimeSignalR - Ex1 - UsingDirectives*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample5.cs)]
10. <span data-ttu-id="64680-212">Pour informer les clients connectés des mises à jour, vous devez d’abord récupérer un objet de **contexte** pour la connexion actuelle.</span><span class="sxs-lookup"><span data-stu-id="64680-212">To notify connected clients of updates, you first retrieve a **Context** object for the current connection.</span></span> <span data-ttu-id="64680-213">L’objet **Hub** contient des méthodes pour envoyer des messages à un seul client ou à une diffusion à tous les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="64680-213">The **Hub** object contains methods to send messages to a single client or broadcast to all connected clients.</span></span> <span data-ttu-id="64680-214">Ajoutez la méthode suivante à la classe **StatisticsService** pour diffuser les données de statistiques.</span><span class="sxs-lookup"><span data-stu-id="64680-214">Add the following method to the **StatisticsService** class to broadcast the statistics data.</span></span>

    <span data-ttu-id="64680-215">(Extrait de code- *RealTimeSignalR-EX1-NotifyUpdatesMethod*)</span><span class="sxs-lookup"><span data-stu-id="64680-215">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesMethod*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample6.cs)]

    > [!NOTE]
    > <span data-ttu-id="64680-216">Dans le code ci-dessus, vous utilisez un nom de méthode arbitraire pour appeler une fonction sur le client (c.-à-d. : *UpdateStatistics*).</span><span class="sxs-lookup"><span data-stu-id="64680-216">In the code above, you are using an arbitrary method name to call a function on the client (i.e.: *updateStatistics*).</span></span> <span data-ttu-id="64680-217">Le nom de la méthode que vous spécifiez est interprété comme un objet dynamique, ce qui signifie qu’il n’y a pas de validation IntelliSense ou de compilation pour celui-ci.</span><span class="sxs-lookup"><span data-stu-id="64680-217">The method name that you specify is interpreted as a dynamic object, which means there is no IntelliSense or compile-time validation for it.</span></span> <span data-ttu-id="64680-218">L’expression est évaluée au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="64680-218">The expression is evaluated at run time.</span></span> <span data-ttu-id="64680-219">Lorsque l’appel de méthode s’exécute, Signalr envoie le nom de la méthode et les valeurs de paramètre au client.</span><span class="sxs-lookup"><span data-stu-id="64680-219">When the method call executes, SignalR sends the method name and the parameter values to the client.</span></span> <span data-ttu-id="64680-220">Si le client a une méthode qui correspond au nom, cette méthode est appelée et les valeurs de paramètre lui sont passées.</span><span class="sxs-lookup"><span data-stu-id="64680-220">If the client has a method that matches the name, that method is called and the parameter values are passed to it.</span></span> <span data-ttu-id="64680-221">Si aucune méthode correspondante n’est trouvée sur le client, aucune erreur n’est générée.</span><span class="sxs-lookup"><span data-stu-id="64680-221">If no matching method is found on the client, no error is raised.</span></span> <span data-ttu-id="64680-222">Pour plus d’informations, reportez-vous au Guide de l' [API ASP.net signalr hubs](../guide-to-the-api/hubs-api-guide-server.md).</span><span class="sxs-lookup"><span data-stu-id="64680-222">For more information, refer to [ASP.NET SignalR Hubs API Guide](../guide-to-the-api/hubs-api-guide-server.md).</span></span>
11. <span data-ttu-id="64680-223">Ouvrez la page **TriviaController.cs** dans le dossier **Controllers** et ajoutez les directives using suivantes.</span><span class="sxs-lookup"><span data-stu-id="64680-223">Open the **TriviaController.cs** page inside the **Controllers** folder and add the following using directives.</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample7.cs)]
12. <span data-ttu-id="64680-224">Ajoutez le code en surbrillance suivant à la méthode d’action de **publication** .</span><span class="sxs-lookup"><span data-stu-id="64680-224">Add the following highlighted code to the **Post** action method.</span></span>

    <span data-ttu-id="64680-225">(Extrait de code- *RealTimeSignalR-EX1-NotifyUpdatesCall*)</span><span class="sxs-lookup"><span data-stu-id="64680-225">(Code Snippet - *RealTimeSignalR - Ex1 - NotifyUpdatesCall*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample8.cs)]
13. <span data-ttu-id="64680-226">Ouvrez la page **Statistics. cshtml** à l’intérieur des **vues |** Dossier de démarrage.</span><span class="sxs-lookup"><span data-stu-id="64680-226">Open the **Statistics.cshtml** page inside the **Views | Home** folder.</span></span> <span data-ttu-id="64680-227">Recherchez la section **scripts** et ajoutez les références de script suivantes au début de la section.</span><span class="sxs-lookup"><span data-stu-id="64680-227">Locate the **Scripts** section and add the following script references at the beginning of the section.</span></span>

    <span data-ttu-id="64680-228">(Extrait de code- *RealTimeSignalR-EX1-SignalRScriptReferences*)</span><span class="sxs-lookup"><span data-stu-id="64680-228">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRScriptReferences*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample9.cshtml)]

    > [!NOTE]
    > <span data-ttu-id="64680-229">Quand vous ajoutez Signalr et d’autres bibliothèques de scripts à votre projet Visual Studio, le gestionnaire de package peut installer une version du fichier de script Signalr qui est plus récente que la version indiquée dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="64680-229">When you add SignalR and other script libraries to your Visual Studio project, the Package Manager might install a version of the SignalR script file that is more recent than the version shown in this topic.</span></span> <span data-ttu-id="64680-230">Assurez-vous que la référence de script dans votre code correspond à la version de la bibliothèque de scripts installée dans votre projet.</span><span class="sxs-lookup"><span data-stu-id="64680-230">Make sure that the script reference in your code matches the version of the script library installed in your project.</span></span>
14. <span data-ttu-id="64680-231">Ajoutez le code en surbrillance suivant pour connecter le client au hub Signalr et mettre à jour les données de statistiques lors de la réception d’un nouveau message à partir du concentrateur.</span><span class="sxs-lookup"><span data-stu-id="64680-231">Add the following highlighted code to connect the client to the SignalR hub and update the statistics data when a new message is received from the hub.</span></span>

    <span data-ttu-id="64680-232">(Extrait de code- *RealTimeSignalR-EX1-SignalRClientCode*)</span><span class="sxs-lookup"><span data-stu-id="64680-232">(Code Snippet - *RealTimeSignalR - Ex1 - SignalRClientCode*)</span></span>

    [!code-cshtml[Main](real-time-web-applications-with-signalr/samples/sample10.cshtml)]

    <span data-ttu-id="64680-233">Dans ce code, vous créez un proxy Hub et vous inscrivez un gestionnaire d’événements pour écouter les messages envoyés par le serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-233">In this code, you are creating a Hub Proxy and registering an event handler to listen for messages sent by the server.</span></span> <span data-ttu-id="64680-234">Dans ce cas, vous écoutez les messages envoyés par le biais de la méthode *UpdateStatistics* .</span><span class="sxs-lookup"><span data-stu-id="64680-234">In this case, you listen for messages sent through the *updateStatistics* method.</span></span>

<a id="Ex1Task3"></a>
#### <a name="task-3--running-the-solution"></a><span data-ttu-id="64680-235">Tâche 3 : exécution de la solution</span><span class="sxs-lookup"><span data-stu-id="64680-235">Task 3 – Running the Solution</span></span>

<span data-ttu-id="64680-236">Dans cette tâche, vous allez exécuter la solution pour vérifier que l’affichage des statistiques est mis à jour automatiquement à l’aide de Signalr après avoir répondu à une nouvelle question.</span><span class="sxs-lookup"><span data-stu-id="64680-236">In this task, you will run the solution to verify that the statistics view is updated automatically using SignalR after answering a new question.</span></span>

1. <span data-ttu-id="64680-237">Appuyez sur **F5** pour exécuter la solution.</span><span class="sxs-lookup"><span data-stu-id="64680-237">Press **F5** to run the solution.</span></span>

    > [!NOTE]
    > <span data-ttu-id="64680-238">Si vous n’êtes pas déjà connecté à l’application, connectez-vous avec l’utilisateur que vous avez créé dans la tâche 1.</span><span class="sxs-lookup"><span data-stu-id="64680-238">If not already logged in to the application, log in with the user you created in Task 1.</span></span>
2. <span data-ttu-id="64680-239">Ouvrez la page des **statistiques** dans une nouvelle fenêtre et placez la page d' **hébergement** et la page de **statistiques** côte à côte comme vous l’avez fait dans la tâche 1.</span><span class="sxs-lookup"><span data-stu-id="64680-239">Open the **Statistics** page in a new window and put the **Home** page and **Statistics** page side-by-side as you did in Task 1.</span></span>
3. <span data-ttu-id="64680-240">Dans la page d' **hébergement** , répondez à la question en cliquant sur l’une des options.</span><span class="sxs-lookup"><span data-stu-id="64680-240">In the **Home** page, answer the question by clicking one of the options.</span></span>

    <span data-ttu-id="64680-241">![Réponse à une autre question](real-time-web-applications-with-signalr/_static/image13.png "Réponse à une autre question")</span><span class="sxs-lookup"><span data-stu-id="64680-241">![Answering another question](real-time-web-applications-with-signalr/_static/image13.png "Answering another question")</span></span>

    <span data-ttu-id="64680-242">*Réponse à une autre question*</span><span class="sxs-lookup"><span data-stu-id="64680-242">*Answering another question*</span></span>
4. <span data-ttu-id="64680-243">Une fois que vous avez cliqué sur l’un des boutons, la réponse doit s’afficher.</span><span class="sxs-lookup"><span data-stu-id="64680-243">After clicking one of the buttons, the answer should appear.</span></span> <span data-ttu-id="64680-244">Notez que les informations sur les statistiques de la page sont mises à jour automatiquement après avoir répondu à la question avec les informations mises à jour sans qu’il soit nécessaire d’actualiser la page entière.</span><span class="sxs-lookup"><span data-stu-id="64680-244">Notice that the Statistics information on the page is updated automatically after answering the question with the updated information without the need to refresh the entire page.</span></span>

    <span data-ttu-id="64680-245">![Page de statistiques actualisée après la réponse](real-time-web-applications-with-signalr/_static/image14.png "Page de statistiques actualisée après la réponse")</span><span class="sxs-lookup"><span data-stu-id="64680-245">![Statistics page refreshed after answer](real-time-web-applications-with-signalr/_static/image14.png "Statistics page refreshed after answer")</span></span>

    <span data-ttu-id="64680-246">*Page de statistiques actualisée après la réponse*</span><span class="sxs-lookup"><span data-stu-id="64680-246">*Statistics page refreshed after answer*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-scaling-out-using-sql-server"></a><span data-ttu-id="64680-247">Exercice 2 : montée en charge à l’aide de SQL Server</span><span class="sxs-lookup"><span data-stu-id="64680-247">Exercise 2: Scaling Out Using SQL Server</span></span>

<span data-ttu-id="64680-248">Lors de la mise à l’échelle d’une application Web, vous pouvez généralement choisir entre *les* options de montée en puissance et de *montée* en puissance.</span><span class="sxs-lookup"><span data-stu-id="64680-248">When scaling a web application, you can generally choose between *scaling up* and *scaling out* options.</span></span> <span data-ttu-id="64680-249">La *montée* en puissance signifie l’utilisation d’un serveur de plus grande taille, avec plus de ressources (processeur, RAM, etc.), tandis que l’augmentation de la *taille des* instances implique l’ajout de serveurs supplémentaires pour gérer la charge.</span><span class="sxs-lookup"><span data-stu-id="64680-249">*Scale up* means using a larger server, with more resources (CPU, RAM, etc.) while *scale out* means adding more servers to handle the load.</span></span> <span data-ttu-id="64680-250">Le problème avec ce dernier est que les clients peuvent être acheminés vers différents serveurs.</span><span class="sxs-lookup"><span data-stu-id="64680-250">The problem with the latter is that the clients can get routed to different servers.</span></span> <span data-ttu-id="64680-251">Un client connecté à un serveur ne reçoit pas les messages envoyés à partir d’un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="64680-251">A client that is connected to one server will not receive messages sent from another server.</span></span>

<span data-ttu-id="64680-252">Vous pouvez résoudre ces problèmes en utilisant un composant appelé *backplane*, pour transférer les messages entre les serveurs.</span><span class="sxs-lookup"><span data-stu-id="64680-252">You can solve these issues by using a component called *backplane*, to forward messages between servers.</span></span> <span data-ttu-id="64680-253">Quand un fond de panier est activé, chaque instance d’application envoie des messages au fond de panier et le fond de panier les transfère aux autres instances de l’application.</span><span class="sxs-lookup"><span data-stu-id="64680-253">With a backplane enabled, each application instance sends messages to the backplane, and the backplane forwards them to the other application instances.</span></span>

<span data-ttu-id="64680-254">Il existe actuellement trois types de plans pour Signalr :</span><span class="sxs-lookup"><span data-stu-id="64680-254">There are currently three types of backplanes for SignalR:</span></span>

- <span data-ttu-id="64680-255">**Azure Service bus Windows**.</span><span class="sxs-lookup"><span data-stu-id="64680-255">**Windows Azure Service Bus**.</span></span> <span data-ttu-id="64680-256">Service Bus est une infrastructure de messagerie qui permet aux composants d’envoyer des messages faiblement couplés.</span><span class="sxs-lookup"><span data-stu-id="64680-256">Service Bus is a messaging infrastructure that allows components to send loosely coupled messages.</span></span>
- <span data-ttu-id="64680-257">**SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="64680-257">**SQL Server**.</span></span> <span data-ttu-id="64680-258">Le fond de panier SQL Server écrit des messages dans des tables SQL.</span><span class="sxs-lookup"><span data-stu-id="64680-258">The SQL Server backplane writes messages to SQL tables.</span></span> <span data-ttu-id="64680-259">Le fond de panier utilise Service Broker pour une messagerie efficace.</span><span class="sxs-lookup"><span data-stu-id="64680-259">The backplane uses Service Broker for efficient messaging.</span></span> <span data-ttu-id="64680-260">Toutefois, il fonctionne également si Service Broker n’est pas activé.</span><span class="sxs-lookup"><span data-stu-id="64680-260">However, it also works if Service Broker is not enabled.</span></span>
- <span data-ttu-id="64680-261">**ReDim**.</span><span class="sxs-lookup"><span data-stu-id="64680-261">**Redis**.</span></span> <span data-ttu-id="64680-262">Redims est un magasin clé-valeur en mémoire.</span><span class="sxs-lookup"><span data-stu-id="64680-262">Redis is an in-memory key-value store.</span></span> <span data-ttu-id="64680-263">Redims prend en charge un modèle de publication/abonnement (« Pub/Sub ») pour l’envoi de messages.</span><span class="sxs-lookup"><span data-stu-id="64680-263">Redis supports a publish/subscribe ("pub/sub") pattern for sending messages.</span></span>

<span data-ttu-id="64680-264">Chaque message est envoyé via un bus de messages.</span><span class="sxs-lookup"><span data-stu-id="64680-264">Every message is sent through a message bus.</span></span> <span data-ttu-id="64680-265">Un bus de messages implémente l’interface [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) , qui fournit une abstraction de publication/abonnement.</span><span class="sxs-lookup"><span data-stu-id="64680-265">A message bus implements the [IMessageBus](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.messaging.imessagebus(v=vs.100).aspx) interface, which provides a publish/subscribe abstraction.</span></span> <span data-ttu-id="64680-266">Ces plans fonctionnent en remplaçant le **IMessageBus** par défaut par un bus conçu pour ce backplane.</span><span class="sxs-lookup"><span data-stu-id="64680-266">The backplanes work by replacing the default **IMessageBus** with a bus designed for that backplane.</span></span>

<span data-ttu-id="64680-267">Chaque instance de serveur se connecte au fond de panier via le bus.</span><span class="sxs-lookup"><span data-stu-id="64680-267">Each server instance connects to the backplane through the bus.</span></span> <span data-ttu-id="64680-268">Lorsqu’un message est envoyé, il passe au fond de panier et le fond de panier l’envoie à tous les serveurs.</span><span class="sxs-lookup"><span data-stu-id="64680-268">When a message is sent, it goes to the backplane, and the backplane sends it to every server.</span></span> <span data-ttu-id="64680-269">Lorsqu’un serveur reçoit un message du fond de panier, il stocke le message dans son cache local.</span><span class="sxs-lookup"><span data-stu-id="64680-269">When a server receives a message from the backplane, it stores the message in its local cache.</span></span> <span data-ttu-id="64680-270">Le serveur remet ensuite les messages aux clients à partir de son cache local.</span><span class="sxs-lookup"><span data-stu-id="64680-270">The server then delivers messages to clients from its local cache.</span></span>

<span data-ttu-id="64680-271">Pour plus d’informations sur le fonctionnement du fond de panier Signalr, lisez cet [article](../performance/scaleout-in-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="64680-271">For more information about how the SignalR backplane works, read this [article](../performance/scaleout-in-signalr.md).</span></span>

> [!NOTE]
> <span data-ttu-id="64680-272">Dans certains cas, un fond de panier peut devenir un goulot d’étranglement.</span><span class="sxs-lookup"><span data-stu-id="64680-272">There are some scenarios where a backplane can become a bottleneck.</span></span> <span data-ttu-id="64680-273">Voici quelques scénarios typiques de Signalr :</span><span class="sxs-lookup"><span data-stu-id="64680-273">Here are some typical SignalR scenarios:</span></span>
> 
> - <span data-ttu-id="64680-274">[Diffusion](tutorial-server-broadcast-with-signalr.md) sur le serveur (par exemple, cotation boursière) : les plans sont adaptés à ce scénario, car le serveur contrôle la vitesse à laquelle les messages sont envoyés.</span><span class="sxs-lookup"><span data-stu-id="64680-274">[Server broadcast](tutorial-server-broadcast-with-signalr.md) (e.g., stock ticker): Backplanes work well for this scenario, because the server controls the rate at which messages are sent.</span></span>
> - <span data-ttu-id="64680-275">[Client à client](tutorial-getting-started-with-signalr.md) (par exemple, conversation) : dans ce scénario, le fond de panier peut être un goulot d’étranglement si le nombre de messages est mis à l’échelle avec le nombre de clients ; autrement dit, si le taux de messages augmente proportionnellement au fur et à mesure que d’autres clients se joignent.</span><span class="sxs-lookup"><span data-stu-id="64680-275">[Client-to-client](tutorial-getting-started-with-signalr.md) (e.g., chat): In this scenario, the backplane might be a bottleneck if the number of messages scales with the number of clients; that is, if the rate of messages grows proportionally as more clients join.</span></span>
> - <span data-ttu-id="64680-276">[Haute fréquence en temps réel](tutorial-high-frequency-realtime-with-signalr.md) (par exemple, jeux en temps réel) : un backplane n’est pas recommandé pour ce scénario.</span><span class="sxs-lookup"><span data-stu-id="64680-276">[High-frequency realtime](tutorial-high-frequency-realtime-with-signalr.md) (e.g., real-time games): A backplane is not recommended for this scenario.</span></span>

<span data-ttu-id="64680-277">Dans cet exercice, vous allez utiliser **SQL Server** pour distribuer des messages dans l’application du **quiz** de l’inversion.</span><span class="sxs-lookup"><span data-stu-id="64680-277">In this exercise, you will use **SQL Server** to distribute messages across the **Geek Quiz** application.</span></span> <span data-ttu-id="64680-278">Vous exécuterez ces tâches sur un seul ordinateur de test pour apprendre à configurer la configuration, mais pour tirer pleinement parti, vous devrez déployer l’application Signalr sur deux serveurs ou plus.</span><span class="sxs-lookup"><span data-stu-id="64680-278">You will run these tasks on a single test machine to learn how to set up the configuration, but in order to get the full effect, you will need to deploy the SignalR application to two or more servers.</span></span> <span data-ttu-id="64680-279">Vous devez également installer SQL Server sur l’un des serveurs, ou sur un serveur dédié distinct.</span><span class="sxs-lookup"><span data-stu-id="64680-279">You must also install SQL Server on one of the servers, or on a separate dedicated server.</span></span>

![Scale Out à l’aide du diagramme de SQL Server](real-time-web-applications-with-signalr/_static/image15.png)

<a id="Ex2Task1"></a>
#### <a name="task-1---understanding-the-scenario"></a><span data-ttu-id="64680-281">Tâche 1 : comprendre le scénario</span><span class="sxs-lookup"><span data-stu-id="64680-281">Task 1 - Understanding the Scenario</span></span>

<span data-ttu-id="64680-282">Au cours de cette tâche, vous allez exécuter 2 instances du quiz de l’un des **passionnés** simulant plusieurs instances IIS sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="64680-282">In this task, you will run 2 instances of **Geek Quiz** simulating multiple IIS instances on your local machine.</span></span> <span data-ttu-id="64680-283">Dans ce scénario, lorsque vous répondez à des questions sur une application, la mise à jour n’est pas notifiée sur la page des statistiques de la seconde instance.</span><span class="sxs-lookup"><span data-stu-id="64680-283">In this scenario, when answering trivia questions on one application, update won't be notified on the statistics page of the second instance.</span></span> <span data-ttu-id="64680-284">Cette simulation ressemble à un environnement dans lequel votre application est déployée sur plusieurs instances et utilise un équilibreur de charge pour communiquer avec eux.</span><span class="sxs-lookup"><span data-stu-id="64680-284">This simulation resembles an environment where your application is deployed on multiple instances and using a load balancer to communicate with them.</span></span>

1. <span data-ttu-id="64680-285">Ouvrez la solution **Begin. sln** située dans le dossier **source/EX2-ScalingOutWithSQLServer/Begin** .</span><span class="sxs-lookup"><span data-stu-id="64680-285">Open the **Begin.sln** solution located in the **Source/Ex2-ScalingOutWithSQLServer/Begin** folder.</span></span> <span data-ttu-id="64680-286">Une fois chargé, vous **reExplorateur de serveurs** marquerez que la solution a deux projets avec des structures identiques, mais des noms différents.</span><span class="sxs-lookup"><span data-stu-id="64680-286">Once loaded, you will notice on the **Server Explorer** that the solution has two projects with identical structures but different names.</span></span> <span data-ttu-id="64680-287">Cela permet de simuler l’exécution de deux instances de la même application sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="64680-287">This will simulate running two instances of the same application on your local machine.</span></span>

    <span data-ttu-id="64680-288">![Commencer la solution simuler 2 instances du quiz du passionné](real-time-web-applications-with-signalr/_static/image16.png "Commencer la solution simuler 2 instances du quiz du passionné")</span><span class="sxs-lookup"><span data-stu-id="64680-288">![Begin Solution Simulating 2 Instances of Geek Quiz](real-time-web-applications-with-signalr/_static/image16.png "Begin Solution Simulating 2 Instances of Geek Quiz")</span></span>

    <span data-ttu-id="64680-289">*Commencer la solution simuler 2 instances du quiz du passionné*</span><span class="sxs-lookup"><span data-stu-id="64680-289">*Begin Solution Simulating 2 Instances of Geek Quiz*</span></span>
2. <span data-ttu-id="64680-290">Ouvrez la page Propriétés de la solution en cliquant avec le bouton droit sur le nœud de la solution et en sélectionnant **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="64680-290">Open the properties page of the solution by right-clicking the solution node and selecting **Properties**.</span></span> <span data-ttu-id="64680-291">Sous **projet de démarrage**, sélectionnez **plusieurs projets de démarrage** et modifiez la valeur **action** pour les deux projets sur *Démarrer*.</span><span class="sxs-lookup"><span data-stu-id="64680-291">Under **Startup Project**, select **Multiple startup projects** and change the **Action** value for both projects to *Start*.</span></span>

    <span data-ttu-id="64680-292">![Démarrage de plusieurs projets](real-time-web-applications-with-signalr/_static/image17.png "Démarrage de plusieurs projets")</span><span class="sxs-lookup"><span data-stu-id="64680-292">![Starting Multiple Projects](real-time-web-applications-with-signalr/_static/image17.png "Starting Multiple Projects")</span></span>

    <span data-ttu-id="64680-293">*Démarrage de plusieurs projets*</span><span class="sxs-lookup"><span data-stu-id="64680-293">*Starting Multiple Projects*</span></span>
3. <span data-ttu-id="64680-294">Appuyez sur **F5** pour exécuter la solution.</span><span class="sxs-lookup"><span data-stu-id="64680-294">Press **F5** to run the solution.</span></span> <span data-ttu-id="64680-295">L’application lance deux instances de **quiz** sur les différents ports, en simulant plusieurs instances de la même application.</span><span class="sxs-lookup"><span data-stu-id="64680-295">The application will launch two instances of **Geek Quiz** in different ports, simulating multiple instances of the same application.</span></span> <span data-ttu-id="64680-296">Épinglez l’un des navigateurs à gauche et l’autre à droite de votre écran.</span><span class="sxs-lookup"><span data-stu-id="64680-296">Pin one of the browsers on left and the other on the right of your screen.</span></span> <span data-ttu-id="64680-297">Connectez-vous avec vos informations d’identification ou enregistrez un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="64680-297">Log in with your credentials or register a new user.</span></span> <span data-ttu-id="64680-298">Une fois connecté, conservez la page des anecdotes à gauche et accédez à la page des **statistiques** dans le navigateur à droite.</span><span class="sxs-lookup"><span data-stu-id="64680-298">Once logged in, keep the Trivia page on the left and go to the **Statistics** page in the browser on the right.</span></span>

    ![Quiz de l’un des passionnés côte à côte](real-time-web-applications-with-signalr/_static/image18.png)

    <span data-ttu-id="64680-300">*Quiz de l’un des passionnés côte à côte*</span><span class="sxs-lookup"><span data-stu-id="64680-300">*Geek Quiz Side by Side*</span></span>

    ![Quiz de l’un des passionnés dans différents ports](real-time-web-applications-with-signalr/_static/image19.png)

    <span data-ttu-id="64680-302">*Quiz de l’un des passionnés dans différents ports*</span><span class="sxs-lookup"><span data-stu-id="64680-302">*Geek Quiz in Different Ports*</span></span>
4. <span data-ttu-id="64680-303">Commencez à répondre aux questions dans le navigateur de gauche. vous remarquerez que la page des **statistiques** dans le bon navigateur n’est pas mise à jour.</span><span class="sxs-lookup"><span data-stu-id="64680-303">Start answering questions in the left browser and you will notice that the **Statistics** page in the right browser is not being updated.</span></span> <span data-ttu-id="64680-304">Cela est dû au fait que **signalr** utilise un cache local pour distribuer les messages entre les clients et que ce scénario simule plusieurs instances. par conséquent, le cache n’est pas partagé entre eux.</span><span class="sxs-lookup"><span data-stu-id="64680-304">This is because **SignalR** uses a local cache to distribute messages across their clients and this scenario is simulating multiple instances, therefore the cache is not shared between them.</span></span> <span data-ttu-id="64680-305">Vous pouvez vérifier que **signalr** fonctionne en testant les mêmes étapes, mais en utilisant une seule application.</span><span class="sxs-lookup"><span data-stu-id="64680-305">You can verify that **SignalR** is working by testing the same steps but using a single app.</span></span> <span data-ttu-id="64680-306">Dans les tâches suivantes, vous allez configurer un fond de panier pour répliquer les messages entre les instances.</span><span class="sxs-lookup"><span data-stu-id="64680-306">In the following tasks you will configure a backplane to replicate the messages across instances.</span></span>
5. <span data-ttu-id="64680-307">Revenez à Visual Studio et arrêtez le débogage.</span><span class="sxs-lookup"><span data-stu-id="64680-307">Go back to Visual Studio and stop debugging.</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-sql-server-backplane"></a><span data-ttu-id="64680-308">Tâche 2 : création de la SQL Server fond de panier</span><span class="sxs-lookup"><span data-stu-id="64680-308">Task 2 – Creating the SQL Server Backplane</span></span>

<span data-ttu-id="64680-309">Au cours de cette tâche, vous allez créer une base de données qui servira de fond de panier pour l’application du **quiz** de l’inversion.</span><span class="sxs-lookup"><span data-stu-id="64680-309">In this task, you will create a database that will serve as a backplane for the **Geek Quiz** application.</span></span> <span data-ttu-id="64680-310">Vous utiliserez **Explorateur d’objets SQL Server** pour parcourir votre serveur et initialiser la base de données.</span><span class="sxs-lookup"><span data-stu-id="64680-310">You will use **SQL Server Object Explorer** to browse your server and initialize the database.</span></span> <span data-ttu-id="64680-311">En outre, vous allez activer l' **Service Broker**.</span><span class="sxs-lookup"><span data-stu-id="64680-311">Additionally, you will enable the **Service Broker**.</span></span>

1. <span data-ttu-id="64680-312">Dans **Visual Studio**, ouvrez la **vue** de menu et sélectionnez **Explorateur d’objets SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="64680-312">In **Visual Studio**, open menu **View** and select **SQL Server Object Explorer**.</span></span>
2. <span data-ttu-id="64680-313">Connectez-vous à votre instance de base de données locale en cliquant avec le bouton droit sur le nœud **SQL Server** et en sélectionnant l’option **ajouter SQL Server..** ..</span><span class="sxs-lookup"><span data-stu-id="64680-313">Connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="64680-314">![Ajout d’une instance de SQL Server](real-time-web-applications-with-signalr/_static/image20.png "Ajout d’une instance de SQL Server")</span><span class="sxs-lookup"><span data-stu-id="64680-314">![Adding a SQL Server Instance](real-time-web-applications-with-signalr/_static/image20.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="64680-315">*Ajout d’une instance de SQL Server à Explorateur d’objets SQL Server*</span><span class="sxs-lookup"><span data-stu-id="64680-315">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
3. <span data-ttu-id="64680-316">Définissez le **nom du serveur** sur *(\v11.0)* et laissez **authentification Windows** comme mode d’authentification.</span><span class="sxs-lookup"><span data-stu-id="64680-316">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="64680-317">Cliquez sur **Connect** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="64680-317">Click **Connect** to continue.</span></span>

    <span data-ttu-id="64680-318">![Connexion à la base de données locale](real-time-web-applications-with-signalr/_static/image21.png "Connexion à la base de données locale")</span><span class="sxs-lookup"><span data-stu-id="64680-318">![Connecting to LocalDB](real-time-web-applications-with-signalr/_static/image21.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="64680-319">*Connexion à la base de données locale*</span><span class="sxs-lookup"><span data-stu-id="64680-319">*Connecting to LocalDB*</span></span>
4. <span data-ttu-id="64680-320">Maintenant que vous êtes connecté à votre instance de base de données locale, vous devez créer une base de données qui représente le SQL Server fond de panier pour Signalr.</span><span class="sxs-lookup"><span data-stu-id="64680-320">Now that you are connected to your LocalDB instance, you will need to create a database that will represent the SQL Server backplane for SignalR.</span></span> <span data-ttu-id="64680-321">Pour ce faire, cliquez avec le bouton droit sur le nœud **bases de données** , puis sélectionnez **Ajouter une nouvelle base de données**.</span><span class="sxs-lookup"><span data-stu-id="64680-321">To do this, right-click the **Databases** node and select **Add New Database**.</span></span>

    <span data-ttu-id="64680-322">![Ajout d’une nouvelle base de données](real-time-web-applications-with-signalr/_static/image22.png "Ajout d’une nouvelle base de données")</span><span class="sxs-lookup"><span data-stu-id="64680-322">![Adding a new database](real-time-web-applications-with-signalr/_static/image22.png "Adding a new database")</span></span>

    <span data-ttu-id="64680-323">*Ajout d’une nouvelle base de données*</span><span class="sxs-lookup"><span data-stu-id="64680-323">*Adding a new database*</span></span>
5. <span data-ttu-id="64680-324">Définissez le nom de la base de données sur *signalr* et cliquez sur **OK** pour le créer.</span><span class="sxs-lookup"><span data-stu-id="64680-324">Set the database name to *SignalR* and click **OK** to create it.</span></span>

    <span data-ttu-id="64680-325">![Création de la base de données Signalr](real-time-web-applications-with-signalr/_static/image23.png "Création de la base de données Signalr")</span><span class="sxs-lookup"><span data-stu-id="64680-325">![Creating the SignalR database](real-time-web-applications-with-signalr/_static/image23.png "Creating the SignalR database")</span></span>

    <span data-ttu-id="64680-326">*Création de la base de données Signalr*</span><span class="sxs-lookup"><span data-stu-id="64680-326">*Creating the SignalR database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="64680-327">Vous pouvez choisir n’importe quel nom pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="64680-327">You can choose any name for the database.</span></span>
6. <span data-ttu-id="64680-328">Pour recevoir des mises à jour plus efficacement à partir du backplane, il est recommandé d’activer les Service Broker pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="64680-328">To receive updates more efficiently from the backplane, it is recommended to enable Service Broker for the database.</span></span> <span data-ttu-id="64680-329">Service Broker fournit une prise en charge native de la messagerie et de la mise en file d’attente dans SQL Server.</span><span class="sxs-lookup"><span data-stu-id="64680-329">Service Broker provides native support for messaging and queuing in SQL Server.</span></span> <span data-ttu-id="64680-330">Le fond de panier fonctionne également sans Service Broker.</span><span class="sxs-lookup"><span data-stu-id="64680-330">The backplane also works without Service Broker.</span></span> <span data-ttu-id="64680-331">Ouvrez une nouvelle requête en cliquant avec le bouton droit sur la base de données et sélectionnez **nouvelle requête**.</span><span class="sxs-lookup"><span data-stu-id="64680-331">Open a new query by right-clicking the database and select **New Query**.</span></span>

    <span data-ttu-id="64680-332">![Ouverture d’une nouvelle requête](real-time-web-applications-with-signalr/_static/image24.png "Ouverture d’une nouvelle requête")</span><span class="sxs-lookup"><span data-stu-id="64680-332">![Opening a New Query](real-time-web-applications-with-signalr/_static/image24.png "Opening a New Query")</span></span>

    <span data-ttu-id="64680-333">*Ouverture d’une nouvelle requête*</span><span class="sxs-lookup"><span data-stu-id="64680-333">*Opening a New Query*</span></span>
7. <span data-ttu-id="64680-334">Pour vérifier si la Service Broker est activée, interrogez la colonne **is\_Broker\_activée** de l’affichage catalogue **sys. databases** .</span><span class="sxs-lookup"><span data-stu-id="64680-334">To check whether Service Broker is enabled, query the **is\_broker\_enabled** column in the **sys.databases** catalog view.</span></span> <span data-ttu-id="64680-335">Exécutez le script suivant dans la fenêtre de requête ouverte récemment.</span><span class="sxs-lookup"><span data-stu-id="64680-335">Execute the following script in the recently opened query window.</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample11.sql)]

    <span data-ttu-id="64680-336">![Interrogation de l’état de l’Service Broker](real-time-web-applications-with-signalr/_static/image25.png "Interrogation de l’état de l’Service Broker")</span><span class="sxs-lookup"><span data-stu-id="64680-336">![Querying the Service Broker Status](real-time-web-applications-with-signalr/_static/image25.png "Querying the Service Broker Status")</span></span>

    <span data-ttu-id="64680-337">*Interrogation de l’état de l’Service Broker*</span><span class="sxs-lookup"><span data-stu-id="64680-337">*Querying the Service Broker Status*</span></span>
8. <span data-ttu-id="64680-338">Si la valeur de la colonne **est\_broker\_activée** dans votre base de données est &quot;0&quot;, utilisez la commande suivante pour l’activer.</span><span class="sxs-lookup"><span data-stu-id="64680-338">If the value of the **is\_broker\_enabled** column in your database is &quot;0&quot;, use the following command to enable it.</span></span> <span data-ttu-id="64680-339">Remplacez **&lt;votre&gt;de base de données** par le nom que vous avez défini lors de la création de la base de données (par exemple : signalr).</span><span class="sxs-lookup"><span data-stu-id="64680-339">Replace **&lt;YOUR-DATABASE&gt;** with the name you set when creating the database (e.g.: SignalR).</span></span>

    [!code-sql[Main](real-time-web-applications-with-signalr/samples/sample12.sql)]

    <span data-ttu-id="64680-340">![Activation de Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Activation de Service Broker")</span><span class="sxs-lookup"><span data-stu-id="64680-340">![Enabling Service Broker](real-time-web-applications-with-signalr/_static/image26.png "Enabling Service Broker")</span></span>

    <span data-ttu-id="64680-341">*Activation de Service Broker*</span><span class="sxs-lookup"><span data-stu-id="64680-341">*Enabling Service Broker*</span></span>

    > [!NOTE]
    > <span data-ttu-id="64680-342">Si cette requête semble se bloquer, assurez-vous qu’aucune application n’est connectée à la base de la base de la.</span><span class="sxs-lookup"><span data-stu-id="64680-342">If this query appears to deadlock, make sure there are no applications connected to the DB.</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--configuring-the-signalr-application"></a><span data-ttu-id="64680-343">Tâche 3 : configuration de l’application Signalr</span><span class="sxs-lookup"><span data-stu-id="64680-343">Task 3 – Configuring the SignalR Application</span></span>

<span data-ttu-id="64680-344">Au cours de cette tâche, vous allez configurer le **quiz** de l’initiateur pour la connexion au SQL Server fond de panier.</span><span class="sxs-lookup"><span data-stu-id="64680-344">In this task, you will configure **Geek Quiz** to connect to the SQL Server backplane.</span></span> <span data-ttu-id="64680-345">Vous allez d’abord ajouter le package NuGet **signalr. SqlServer** et définir la chaîne de connexion à votre base de données de fond de panier.</span><span class="sxs-lookup"><span data-stu-id="64680-345">You will first add the **SignalR.SqlServer** NuGet package and set the connection string to your backplane database.</span></span>

1. <span data-ttu-id="64680-346">Ouvrez la **console du gestionnaire de package** dans **Outils** > **Gestionnaire de package NuGet**.</span><span class="sxs-lookup"><span data-stu-id="64680-346">Open the **Package Manager Console** from **Tools** > **NuGet Package Manager**.</span></span> <span data-ttu-id="64680-347">Assurez-vous que **GeekQuiz** Project est sélectionné dans la liste déroulante **projet par défaut** .</span><span class="sxs-lookup"><span data-stu-id="64680-347">Make sure that **GeekQuiz** project is selected in the **Default project** drop-down list.</span></span> <span data-ttu-id="64680-348">Tapez la commande suivante pour installer le package NuGet **Microsoft. Aspnet. signalr. SqlServer** .</span><span class="sxs-lookup"><span data-stu-id="64680-348">Type the following command to install the **Microsoft.AspNet.SignalR.SqlServer** NuGet package.</span></span>

    [!code-powershell[Main](real-time-web-applications-with-signalr/samples/sample13.ps1)]
2. <span data-ttu-id="64680-349">Répétez l’étape précédente, mais cette fois pour le projet **GeekQuiz2**.</span><span class="sxs-lookup"><span data-stu-id="64680-349">Repeat the previous step but this time for project **GeekQuiz2**.</span></span>
3. <span data-ttu-id="64680-350">Pour configurer la SQL Server fond de panier, ouvrez le fichier **Startup.cs** du projet **GeekQuiz** et ajoutez le code suivant à la méthode **configure** .</span><span class="sxs-lookup"><span data-stu-id="64680-350">To configure the SQL Server backplane, open the **Startup.cs** file of the **GeekQuiz** project and add the following code to the **Configure** method.</span></span> <span data-ttu-id="64680-351">Remplacez **&lt;votre&gt;de base de données** par le nom de votre base de données que vous avez utilisé lors de la création du fond de panier SQL Server.</span><span class="sxs-lookup"><span data-stu-id="64680-351">Replace **&lt;YOUR-DATABASE&gt;** with your database name you used when creating the SQL Server backplane.</span></span> <span data-ttu-id="64680-352">Répétez cette étape pour le projet **GeekQuiz2** .</span><span class="sxs-lookup"><span data-stu-id="64680-352">Repeat this step for the **GeekQuiz2** project.</span></span>

    <span data-ttu-id="64680-353">(Extrait de code- *RealTimeSignalR-EX2-StartupConfiguration*)</span><span class="sxs-lookup"><span data-stu-id="64680-353">(Code Snippet - *RealTimeSignalR - Ex2 - StartupConfiguration*)</span></span>

    [!code-csharp[Main](real-time-web-applications-with-signalr/samples/sample14.cs)]
4. <span data-ttu-id="64680-354">Maintenant que les deux projets sont configurés pour utiliser le SQL Server fond de panier, appuyez sur **F5** pour les exécuter simultanément.</span><span class="sxs-lookup"><span data-stu-id="64680-354">Now that both projects are configured to use the SQL Server backplane, press **F5** to run them simultaneously.</span></span>
5. <span data-ttu-id="64680-355">Là encore, **Visual Studio** lance deux instances du quiz de l’un des **passionnés** dans différents ports.</span><span class="sxs-lookup"><span data-stu-id="64680-355">Again, **Visual Studio** will launch two instances of **Geek Quiz** in different ports.</span></span> <span data-ttu-id="64680-356">Épinglez l’un des navigateurs sur la gauche et l’autre à droite de votre écran et connectez-vous avec vos informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="64680-356">Pin one of the browsers on the left and the other on the right of your screen and log in with your credentials.</span></span> <span data-ttu-id="64680-357">Conservez la page des anecdotes à gauche et accédez à la page des **statistiques** dans le bon navigateur.</span><span class="sxs-lookup"><span data-stu-id="64680-357">Keep the Trivia page on the left and go to **Statistics** pagein the right browser.</span></span>
6. <span data-ttu-id="64680-358">Commencez à répondre aux questions dans le navigateur de gauche.</span><span class="sxs-lookup"><span data-stu-id="64680-358">Start answering questions in the left browser.</span></span> <span data-ttu-id="64680-359">Cette fois-ci, la page de **statistiques** est mise à jour grâce au fond de panier.</span><span class="sxs-lookup"><span data-stu-id="64680-359">This time, the **Statistics** page is updated thanks to the backplane.</span></span> <span data-ttu-id="64680-360">Basculer entre les applications (les**statistiques** sont désormais sur la gauche, et les **anecdotes** sur la droite) et répéter le test pour vérifier qu’il fonctionne pour les deux instances.</span><span class="sxs-lookup"><span data-stu-id="64680-360">Switch between applications (**Statistics** is now on the left, and **Trivia** is on the right) and repeat the test to validate that it is working for both instances.</span></span> <span data-ttu-id="64680-361">Le fond de panier fait office de *cache partagé* de messages pour chaque serveur connecté, et chaque serveur stocke les messages dans leur propre cache local pour les distribuer aux clients connectés.</span><span class="sxs-lookup"><span data-stu-id="64680-361">The backplane serves as a *shared cache* of messages for each connected server, and each server will store the messages in their own local cache to distribute to connected clients.</span></span>
7. <span data-ttu-id="64680-362">Revenez à Visual Studio et arrêtez le débogage.</span><span class="sxs-lookup"><span data-stu-id="64680-362">Go back to Visual Studio and stop debugging.</span></span>
8. <span data-ttu-id="64680-363">Le composant SQL Server backplane génère automatiquement les tables nécessaires sur la base de données spécifiée.</span><span class="sxs-lookup"><span data-stu-id="64680-363">The SQL Server backplane component automatically generates the necessary tables on the specified database.</span></span> <span data-ttu-id="64680-364">Dans le panneau **Explorateur d’objets SQL Server** , ouvrez la base de données que vous avez créée pour le fond de panier (p. ex. : signalr) et développez ses tables.</span><span class="sxs-lookup"><span data-stu-id="64680-364">In the **SQL Server Object Explorer** panel, open the database you created for the backplane (e.g.: SignalR) and expand its tables.</span></span> <span data-ttu-id="64680-365">Les tableaux suivants doivent s’afficher :</span><span class="sxs-lookup"><span data-stu-id="64680-365">You should see the following tables:</span></span>

    ![Tables générées par le fond de panier](real-time-web-applications-with-signalr/_static/image27.png)

    <span data-ttu-id="64680-367">*Tables générées par le fond de panier*</span><span class="sxs-lookup"><span data-stu-id="64680-367">*Backplane Generated Tables*</span></span>
9. <span data-ttu-id="64680-368">Cliquez avec le bouton droit sur la table **signalr. Messages\_0** , puis sélectionnez **afficher les données**.</span><span class="sxs-lookup"><span data-stu-id="64680-368">Right-click the **SignalR.Messages\_0** table and select **View Data**.</span></span>

    ![Afficher la table des messages de fond de panier Signalr](real-time-web-applications-with-signalr/_static/image28.png)

    <span data-ttu-id="64680-370">*Afficher la table des messages de fond de panier Signalr*</span><span class="sxs-lookup"><span data-stu-id="64680-370">*View SignalR Backplane Messages Table*</span></span>
10. <span data-ttu-id="64680-371">Vous pouvez voir les différents messages envoyés au **Hub** lorsque vous répondez aux questions des questionnaires.</span><span class="sxs-lookup"><span data-stu-id="64680-371">You can see the different messages sent to the **Hub** when answering the trivia questions.</span></span> <span data-ttu-id="64680-372">Le fond de panier distribue ces messages à toute instance connectée.</span><span class="sxs-lookup"><span data-stu-id="64680-372">The backplane distributes these messages to any connected instance.</span></span>

    ![Table des messages de fond de panier](real-time-web-applications-with-signalr/_static/image29.png)

    <span data-ttu-id="64680-374">*Table des messages de fond de panier*</span><span class="sxs-lookup"><span data-stu-id="64680-374">*Backplane Messages Table*</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="64680-375">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="64680-375">Summary</span></span>

<span data-ttu-id="64680-376">Dans ce laboratoire pratique, vous avez appris à ajouter **signalr** à votre application et à envoyer des notifications du serveur à vos clients connectés à l’aide de **hubs**.</span><span class="sxs-lookup"><span data-stu-id="64680-376">In this hands-on lab, you have learned how to add **SignalR** to your application and send notifications from the server to your connected clients using **Hubs**.</span></span> <span data-ttu-id="64680-377">En outre, vous avez appris à mettre à l’échelle votre application à l’aide d’un composant de *fond de panier* lorsque votre application est déployée dans plusieurs instances IIS.</span><span class="sxs-lookup"><span data-stu-id="64680-377">Additionally, you learned how to scale out your application by using a *backplane* component when your application is deployed in multiple IIS instances.</span></span>
