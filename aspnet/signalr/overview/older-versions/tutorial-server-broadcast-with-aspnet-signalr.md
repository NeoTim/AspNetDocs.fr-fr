---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Didacticiel : diffusion sur le serveur avec ASP.NET Signalr 1. x | Microsoft Docs'
author: bradygaster
description: Ce didacticiel montre comment créer une application Web qui utilise ASP.NET Signalr pour fournir une fonctionnalité de diffusion serveur. La diffusion serveur signifie que la commune...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78579407"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="9be25-104">Didacticiel : diffusion sur le serveur avec ASP.NET Signalr 1. x</span><span class="sxs-lookup"><span data-stu-id="9be25-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="9be25-105">de [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="9be25-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="9be25-106">Ce didacticiel montre comment créer une application Web qui utilise ASP.NET Signalr pour fournir une fonctionnalité de diffusion serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="9be25-107">La diffusion serveur signifie que les communications envoyées aux clients sont lancées par le serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="9be25-108">Ce scénario nécessite une approche de programmation différente des scénarios d’égal à égal, tels que les applications de conversation, dans lesquelles les communications envoyées aux clients sont lancées par un ou plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="9be25-109">L’application que vous allez créer dans ce didacticiel simule un ticker boursier, un scénario classique de fonctionnalités de diffusion serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="9be25-110">Les commentaires sur ce didacticiel sont les bienvenus.</span><span class="sxs-lookup"><span data-stu-id="9be25-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="9be25-111">Si vous avez des questions qui ne sont pas directement liées au didacticiel, vous pouvez les poster sur le [forum ASP.net signalr](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) ou [StackOverflow.com](http://stackoverflow.com).</span><span class="sxs-lookup"><span data-stu-id="9be25-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="9be25-112">Présentation</span><span class="sxs-lookup"><span data-stu-id="9be25-112">Overview</span></span>

<span data-ttu-id="9be25-113">Le package NuGet [Microsoft. Aspnet. signalr. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) installe un exemple d’application de téléscripteur de cotations boursières simulé dans un projet Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9be25-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="9be25-114">Dans la première partie de ce didacticiel, vous allez créer une version simplifiée de cette application à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="9be25-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="9be25-115">Dans le reste du didacticiel, vous allez installer le package NuGet et passer en revue les fonctionnalités et le code supplémentaires qu’il crée.</span><span class="sxs-lookup"><span data-stu-id="9be25-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="9be25-116">L’application de cotations boursières est représentative d’une application en temps réel dans laquelle vous souhaitez régulièrement « pousser » ou diffuser des notifications du serveur vers tous les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="9be25-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="9be25-117">L’application que vous allez créer dans la première partie de ce didacticiel affiche une grille contenant les données boursières.</span><span class="sxs-lookup"><span data-stu-id="9be25-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Version initiale de StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="9be25-119">Périodiquement, le serveur met à jour de façon aléatoire les cotations boursières et transmet les mises à jour à tous les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="9be25-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="9be25-120">Dans le navigateur, les nombres et les symboles de la **modification** et **%** colonnes changent de manière dynamique en réponse aux notifications du serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="9be25-121">Si vous ouvrez des navigateurs supplémentaires sur la même URL, ils affichent tous les mêmes données et les mêmes modifications simultanément aux données.</span><span class="sxs-lookup"><span data-stu-id="9be25-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="9be25-122">Ce didacticiel contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="9be25-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="9be25-123">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="9be25-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="9be25-124">Création du projet</span><span class="sxs-lookup"><span data-stu-id="9be25-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="9be25-125">Ajouter les packages NuGet Signalr</span><span class="sxs-lookup"><span data-stu-id="9be25-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="9be25-126">Configurer le code serveur</span><span class="sxs-lookup"><span data-stu-id="9be25-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="9be25-127">Configurer le code client</span><span class="sxs-lookup"><span data-stu-id="9be25-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="9be25-128">Testez l’application</span><span class="sxs-lookup"><span data-stu-id="9be25-128">Test the application</span></span>](#test)
- [<span data-ttu-id="9be25-129">Activer la journalisation</span><span class="sxs-lookup"><span data-stu-id="9be25-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="9be25-130">Installer et examiner l’exemple de StockTicker complet</span><span class="sxs-lookup"><span data-stu-id="9be25-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="9be25-131">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9be25-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="9be25-132">Si vous ne souhaitez pas suivre les étapes de création de l’application, vous pouvez installer le package Signalr. Sample dans un nouveau projet d' **application Web ASP.net vide** et lire ces étapes pour obtenir des explications sur le code.</span><span class="sxs-lookup"><span data-stu-id="9be25-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="9be25-133">La première partie du didacticiel couvre un sous-ensemble de Signalr. exemple de code, et la deuxième partie explique les fonctionnalités clés des fonctionnalités supplémentaires de Signalr. exemple de package.</span><span class="sxs-lookup"><span data-stu-id="9be25-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="9be25-134">Conditions préalables requises</span><span class="sxs-lookup"><span data-stu-id="9be25-134">Prerequisites</span></span>

<span data-ttu-id="9be25-135">Avant de commencer, assurez-vous que Visual Studio 2012 ou 2010 SP1 est installé sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="9be25-136">Si vous ne disposez pas de Visual Studio, consultez [ASP.net downloads](https://www.asp.net/downloads) pour obtenir gratuitement Visual Studio 2012 Express pour le Web.</span><span class="sxs-lookup"><span data-stu-id="9be25-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="9be25-137">Si vous disposez de Visual Studio 2010, assurez-vous que [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) est installé.</span><span class="sxs-lookup"><span data-stu-id="9be25-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="9be25-138">Créer le projet</span><span class="sxs-lookup"><span data-stu-id="9be25-138">Create the project</span></span>

1. <span data-ttu-id="9be25-139">Dans le menu **Fichier**, cliquez sur **Nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="9be25-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="9be25-140">Dans la boîte de dialogue **nouveau projet** , **C#** développez sous **modèles** , puis sélectionnez **Web**.</span><span class="sxs-lookup"><span data-stu-id="9be25-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="9be25-141">Sélectionnez le modèle **application Web vide ASP.net** , nommez le projet *signalr. StockTicker*, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9be25-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Boîte de dialogue Nouveau projet de test](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="9be25-143">Ajouter les packages NuGet Signalr</span><span class="sxs-lookup"><span data-stu-id="9be25-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="9be25-144">Ajouter les packages Signalr et JQuery NuGet</span><span class="sxs-lookup"><span data-stu-id="9be25-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="9be25-145">Vous pouvez ajouter une fonctionnalité Signalr à un projet en installant un package NuGet.</span><span class="sxs-lookup"><span data-stu-id="9be25-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="9be25-146">Cliquez sur **Outils | Gestionnaire de package NuGet | Console du gestionnaire de package**.</span><span class="sxs-lookup"><span data-stu-id="9be25-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="9be25-147">Dans le gestionnaire de package, entrez la commande suivante.</span><span class="sxs-lookup"><span data-stu-id="9be25-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="9be25-148">Le package Signalr installe un certain nombre d’autres packages NuGet en tant que dépendances.</span><span class="sxs-lookup"><span data-stu-id="9be25-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="9be25-149">Une fois l’installation terminée, vous disposez de tous les composants serveur et client requis pour utiliser Signalr dans une application ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="9be25-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="9be25-150">Configurer le code du serveur</span><span class="sxs-lookup"><span data-stu-id="9be25-150">Set up the server code</span></span>

<span data-ttu-id="9be25-151">Dans cette section, vous configurez le code qui s’exécute sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="9be25-152">Créer la classe stock</span><span class="sxs-lookup"><span data-stu-id="9be25-152">Create the Stock class</span></span>

<span data-ttu-id="9be25-153">Commencez par créer la classe de modèle stock que vous utiliserez pour stocker et transmettre des informations sur une action.</span><span class="sxs-lookup"><span data-stu-id="9be25-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="9be25-154">Créez un nouveau fichier de classe dans le dossier du projet, nommez-le *stock.cs*, puis remplacez le code du modèle par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="9be25-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="9be25-155">Les deux propriétés que vous allez définir lorsque vous créez des actions sont le symbole (par exemple, MSFT pour Microsoft) et le prix.</span><span class="sxs-lookup"><span data-stu-id="9be25-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="9be25-156">Les autres propriétés dépendent de la façon dont et quand vous définissez Price.</span><span class="sxs-lookup"><span data-stu-id="9be25-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="9be25-157">La première fois que vous définissez Price, la valeur est propagée à DayOpen.</span><span class="sxs-lookup"><span data-stu-id="9be25-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="9be25-158">Quand vous définissez Price, les valeurs de propriété change et PercentChange sont calculées en fonction de la différence entre Price et DayOpen.</span><span class="sxs-lookup"><span data-stu-id="9be25-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="9be25-159">Créer les classes StockTicker et StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="9be25-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="9be25-160">Vous allez utiliser l’API Hub Signalr pour gérer l’interaction de serveur à client.</span><span class="sxs-lookup"><span data-stu-id="9be25-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="9be25-161">Une classe StockTickerHub qui dérive de la classe Hub Signalr va gérer la réception des connexions et des appels de méthode à partir des clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="9be25-162">Vous devez également mettre à jour les données boursières et exécuter un objet minuteur pour déclencher régulièrement des mises à jour de prix, indépendamment des connexions clientes.</span><span class="sxs-lookup"><span data-stu-id="9be25-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="9be25-163">Vous ne pouvez pas placer ces fonctions dans une classe de concentrateur, car les instances de concentrateur sont temporaires.</span><span class="sxs-lookup"><span data-stu-id="9be25-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="9be25-164">Une instance de classe de concentrateur est créée pour chaque opération sur le concentrateur, comme les connexions et les appels du client au serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="9be25-165">Par conséquent, le mécanisme qui conserve les données boursières, met à jour les prix et diffuse les mises à jour de prix doit s’exécuter dans une classe distincte, que vous nommerez StockTicker.</span><span class="sxs-lookup"><span data-stu-id="9be25-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Diffusion à partir de StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="9be25-167">Vous souhaitez qu’une seule instance de la classe StockTicker s’exécute sur le serveur. vous devez donc configurer une référence de chaque instance StockTickerHub à l’instance StockTicker Singleton.</span><span class="sxs-lookup"><span data-stu-id="9be25-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="9be25-168">La classe StockTicker doit pouvoir être diffusée aux clients, car elle contient les données boursières et déclenche les mises à jour, mais StockTicker n’est pas une classe de concentrateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="9be25-169">Par conséquent, la classe StockTicker doit obtenir une référence à l’objet de contexte de connexion du concentrateur Signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="9be25-170">Il peut ensuite utiliser l’objet de contexte de connexion Signalr pour la diffusion vers les clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="9be25-171">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet, puis cliquez sur **Ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="9be25-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="9be25-172">Si vous avez Visual Studio 2012 avec la [mise à jour ASP.net et Web Tools 2012,2](https://go.microsoft.com/fwlink/?LinkId=279941), cliquez sur **Web** sous **Visual C#**  et sélectionnez le modèle d’élément de **classe du concentrateur signalr** .</span><span class="sxs-lookup"><span data-stu-id="9be25-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="9be25-173">Dans le cas contraire, sélectionnez le modèle de **classe** .</span><span class="sxs-lookup"><span data-stu-id="9be25-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="9be25-174">Nommez la nouvelle classe *StockTickerHub.cs*, puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="9be25-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![Ajouter StockTickerHub.cs](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="9be25-176">Remplacez le code du modèle par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="9be25-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="9be25-177">La classe de [concentrateur](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) est utilisée pour définir les méthodes que les clients peuvent appeler sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="9be25-178">Vous définissez une méthode : `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="9be25-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="9be25-179">Lorsqu’un client se connecte initialement au serveur, il appelle cette méthode pour obtenir la liste de tous les stocks avec leurs prix actuels.</span><span class="sxs-lookup"><span data-stu-id="9be25-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="9be25-180">La méthode peut s’exécuter de façon synchrone et retourner `IEnumerable<Stock>`, car elle retourne des données à partir de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="9be25-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="9be25-181">Si la méthode devait obtenir les données en réalisant une opération impliquant l’attente, par exemple une recherche de base de données ou un appel de service Web, vous devez spécifier `Task<IEnumerable<Stock>>` comme valeur de retour pour activer le traitement asynchrone.</span><span class="sxs-lookup"><span data-stu-id="9be25-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="9be25-182">Pour plus d’informations, consultez Guide de l' [API hubs signalr ASP.net-serveur-quand exécuter de manière asynchrone](index.md).</span><span class="sxs-lookup"><span data-stu-id="9be25-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="9be25-183">L’attribut HubName spécifie la manière dont le concentrateur sera référencé dans le code JavaScript sur le client.</span><span class="sxs-lookup"><span data-stu-id="9be25-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="9be25-184">Le nom par défaut sur le client si vous n’utilisez pas cet attribut est une version en casse mixte du nom de la classe, qui est dans ce cas stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="9be25-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="9be25-185">Comme vous le verrez plus tard lorsque vous créerez la classe StockTicker, une instance singleton de cette classe est créée dans sa propriété d’instance statique.</span><span class="sxs-lookup"><span data-stu-id="9be25-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="9be25-186">Cette instance singleton de StockTicker reste en mémoire, quel que soit le nombre de clients connectés ou déconnectés, et cette instance est celle utilisée par la méthode GetAllStocks pour retourner les informations boursières actuelles.</span><span class="sxs-lookup"><span data-stu-id="9be25-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="9be25-187">Créez un nouveau fichier de classe dans le dossier du projet, nommez-le *stockticker.cs*, puis remplacez le code du modèle par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="9be25-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="9be25-188">Étant donné que plusieurs threads exécuteront la même instance du code StockTicker, la classe StockTicker doit être threadsafe.</span><span class="sxs-lookup"><span data-stu-id="9be25-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="9be25-189">Stockage de l’instance singleton dans un champ statique</span><span class="sxs-lookup"><span data-stu-id="9be25-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="9be25-190">Le code initialise le champ d’instance statique \_qui stocke la propriété d’instance avec une instance de la classe, et il s’agit de la seule instance de la classe qui peut être créée, car le constructeur est marqué comme privé.</span><span class="sxs-lookup"><span data-stu-id="9be25-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="9be25-191">L' [initialisation tardive](https://msdn.microsoft.com/library/dd997286.aspx) est utilisée pour le champ d’instance \_, pas pour des raisons de performances, mais pour garantir que la création de l’instance est threadsafe.</span><span class="sxs-lookup"><span data-stu-id="9be25-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="9be25-192">Chaque fois qu’un client se connecte au serveur, une nouvelle instance de la classe StockTickerHub qui s’exécute dans un thread distinct obtient l’instance singleton de StockTicker à partir de la propriété statique de StockTicker. instance, comme vous l’avez vu précédemment dans la classe StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="9be25-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="9be25-193">Stockage des données boursières dans un ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="9be25-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="9be25-194">Le constructeur initialise la collection \_stocks avec des exemples de données stock et GetAllStocks retourne les actions.</span><span class="sxs-lookup"><span data-stu-id="9be25-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="9be25-195">Comme vous l’avez vu précédemment, cette collection de stocks est à son tour retournée par StockTickerHub. GetAllStocks, qui est une méthode serveur dans la classe de concentrateur que les clients peuvent appeler.</span><span class="sxs-lookup"><span data-stu-id="9be25-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="9be25-196">La collection d’actions est définie en tant que type [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) pour la sécurité des threads.</span><span class="sxs-lookup"><span data-stu-id="9be25-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="9be25-197">Vous pouvez également utiliser un objet [dictionnaire](https://msdn.microsoft.com/library/xfhwa508.aspx) et verrouiller explicitement le dictionnaire lorsque vous y apportez des modifications.</span><span class="sxs-lookup"><span data-stu-id="9be25-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="9be25-198">Pour cet exemple d’application, il est OK de stocker les données d’application en mémoire et de perdre les données lorsque l’instance de StockTicker est supprimée.</span><span class="sxs-lookup"><span data-stu-id="9be25-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="9be25-199">Dans une application réelle, vous travaillez avec un magasin de données principal tel qu’une base de données.</span><span class="sxs-lookup"><span data-stu-id="9be25-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="9be25-200">Mise à jour périodique des cours boursiers</span><span class="sxs-lookup"><span data-stu-id="9be25-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="9be25-201">Le constructeur démarre un objet minuteur qui appelle périodiquement des méthodes qui mettent à jour les cotations boursières de manière aléatoire.</span><span class="sxs-lookup"><span data-stu-id="9be25-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="9be25-202">UpdateStockPrices est appelé par le minuteur, qui passe la valeur null dans le paramètre d’État.</span><span class="sxs-lookup"><span data-stu-id="9be25-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="9be25-203">Avant la mise à jour des tarifs, un verrou est pris sur l’objet \_updateStockPricesLock.</span><span class="sxs-lookup"><span data-stu-id="9be25-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="9be25-204">Le code vérifie si un autre thread est déjà en cours de mise à jour des prix, puis appelle TryUpdateStockPrice sur chaque stock de la liste.</span><span class="sxs-lookup"><span data-stu-id="9be25-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="9be25-205">La méthode TryUpdateStockPrice décide s’il faut modifier le cours de l’action et la quantité de modification.</span><span class="sxs-lookup"><span data-stu-id="9be25-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="9be25-206">Si le cours de la bourse est modifié, BroadcastStockPrice est appelé pour diffuser la modification du cours de l’action à tous les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="9be25-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="9be25-207">L’indicateur \_updatingStockPrices est marqué comme [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) pour s’assurer que son accès est threadsafe.</span><span class="sxs-lookup"><span data-stu-id="9be25-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="9be25-208">Dans une application réelle, la méthode TryUpdateStockPrice appelle un service Web pour rechercher le prix. dans ce code, il utilise un générateur de nombres aléatoires pour apporter des modifications de manière aléatoire.</span><span class="sxs-lookup"><span data-stu-id="9be25-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="9be25-209">Obtention du contexte Signalr afin que la classe StockTicker puisse être diffusée aux clients</span><span class="sxs-lookup"><span data-stu-id="9be25-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="9be25-210">Étant donné que les changements de prix proviennent ici dans l’objet StockTicker, il s’agit de l’objet qui doit appeler une méthode updateStockPrice sur tous les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="9be25-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="9be25-211">Dans une classe de concentrateur, vous avez une API pour appeler des méthodes clientes, mais StockTicker ne dérive pas de la classe Hub et n’a pas de référence à un objet Hub.</span><span class="sxs-lookup"><span data-stu-id="9be25-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="9be25-212">Par conséquent, pour la diffusion vers les clients connectés, la classe StockTicker doit obtenir l’instance de contexte Signalr pour la classe StockTickerHub et l’utiliser pour appeler des méthodes sur les clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="9be25-213">Le code obtient une référence au contexte Signalr lorsqu’il crée l’instance de classe singleton, passe cette référence au constructeur, et le constructeur le place dans la propriété clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="9be25-214">Il existe deux raisons pour lesquelles vous souhaitez obtenir le contexte une seule fois : l’obtention du contexte est une opération coûteuse et l’obtention d’une fois pour s’assurer que l’ordre prévu des messages envoyés aux clients est préservé.</span><span class="sxs-lookup"><span data-stu-id="9be25-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="9be25-215">L’obtention de la propriété clients du contexte et sa mise dans la propriété StockTickerClient vous permet d’écrire du code pour appeler des méthodes clientes qui se présente comme dans une classe de concentrateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="9be25-216">Par exemple, pour diffuser sur tous les clients, vous pouvez écrire des clients. All. updateStockPrice (stock).</span><span class="sxs-lookup"><span data-stu-id="9be25-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="9be25-217">La méthode updateStockPrice que vous appelez dans BroadcastStockPrice n’existe pas encore ; vous l’ajouterez ultérieurement lorsque vous écrirez du code qui s’exécute sur le client.</span><span class="sxs-lookup"><span data-stu-id="9be25-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="9be25-218">Vous pouvez vous référer à updateStockPrice ici, car clients. All est dynamique, ce qui signifie que l’expression sera évaluée au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="9be25-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="9be25-219">Lorsque cet appel de méthode s’exécute, Signalr envoie le nom de la méthode et la valeur du paramètre au client, et si le client a une méthode nommée updateStockPrice, cette méthode est appelée et la valeur du paramètre lui est transmise.</span><span class="sxs-lookup"><span data-stu-id="9be25-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="9be25-220">Clients. All signifie envoyer à tous les clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="9be25-221">Signalr vous offre d’autres options pour spécifier les clients ou groupes de clients à envoyer à.</span><span class="sxs-lookup"><span data-stu-id="9be25-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="9be25-222">Pour plus d’informations, consultez [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="9be25-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="9be25-223">Inscrire l’itinéraire Signalr</span><span class="sxs-lookup"><span data-stu-id="9be25-223">Register the SignalR route</span></span>

<span data-ttu-id="9be25-224">Le serveur doit connaître l’URL à intercepter et diriger vers Signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="9be25-225">Pour ce faire, vous allez ajouter du code au fichier *global. asax* .</span><span class="sxs-lookup"><span data-stu-id="9be25-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="9be25-226">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet, puis cliquez sur **Ajouter un nouvel élément**.</span><span class="sxs-lookup"><span data-stu-id="9be25-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="9be25-227">Sélectionnez le modèle d’élément de **classe d’application globale** , puis cliquez sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="9be25-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    ![Ajouter global. asax](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="9be25-229">Ajoutez le code d’inscription de l’itinéraire Signalr à l’application\_méthode Start :</span><span class="sxs-lookup"><span data-stu-id="9be25-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="9be25-230">Par défaut, l’URL de base pour tout le trafic Signalr est « /signalr » et « /signalr/hubs » est utilisé pour récupérer un fichier JavaScript généré dynamiquement qui définit des proxies pour tous les concentrateurs que vous avez dans votre application.</span><span class="sxs-lookup"><span data-stu-id="9be25-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="9be25-231">La méthode MapHubs comprend des surcharges qui vous permettent de spécifier une URL de base différente et certaines options Signalr dans une instance de la classe [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) .</span><span class="sxs-lookup"><span data-stu-id="9be25-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="9be25-232">Ajoutez une instruction using en haut du fichier :</span><span class="sxs-lookup"><span data-stu-id="9be25-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="9be25-233">Enregistrez et fermez le fichier *global. asax* , puis générez le projet.</span><span class="sxs-lookup"><span data-stu-id="9be25-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="9be25-234">Vous avez maintenant terminé la configuration du code serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="9be25-235">Dans la section suivante, vous allez configurer le client.</span><span class="sxs-lookup"><span data-stu-id="9be25-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="9be25-236">Configurer le code client</span><span class="sxs-lookup"><span data-stu-id="9be25-236">Set up the client code</span></span>

1. <span data-ttu-id="9be25-237">Créez un nouveau fichier HTML dans le dossier du projet, puis nommez-le *stockticker. html*.</span><span class="sxs-lookup"><span data-stu-id="9be25-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="9be25-238">Remplacez le code du modèle par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="9be25-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="9be25-239">Le code HTML crée une table avec 5 colonnes, une ligne d’en-tête et une ligne de données avec une seule cellule qui s’étend sur cinq colonnes.</span><span class="sxs-lookup"><span data-stu-id="9be25-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="9be25-240">La ligne de données affiche « chargement en cours... » et s’affichent momentanément uniquement au démarrage de l’application.</span><span class="sxs-lookup"><span data-stu-id="9be25-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="9be25-241">Le code JavaScript supprimera cette ligne et ajoutera à ses lignes de place les données de stock extraites du serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="9be25-242">Les balises de script spécifient le fichier de script jQuery, le fichier de script du noyau Signalr, le fichier de script des proxies de Signalr et un fichier de script StockTicker que vous allez créer ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="9be25-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="9be25-243">Le fichier de script des proxies Signalr, qui spécifie l’URL « /signalr/hubs », est généré dynamiquement et définit des méthodes de proxy pour les méthodes sur la classe de concentrateur, dans ce cas pour StockTickerHub. GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="9be25-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="9be25-244">Si vous préférez, vous pouvez générer ce fichier JavaScript manuellement à l’aide des [utilitaires signalr](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) et désactiver la création de fichiers dynamiques dans l’appel de la méthode MapHubs.</span><span class="sxs-lookup"><span data-stu-id="9be25-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="9be25-245">Assurez-vous que les références de fichier JavaScript dans *stockticker. html* sont correctes.</span><span class="sxs-lookup"><span data-stu-id="9be25-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="9be25-246">Autrement dit, assurez-vous que la version jQuery dans votre balise de script (1.8.2 dans l’exemple) est identique à la version jQuery dans le dossier *scripts* de votre projet, et assurez-vous que la version de signalr dans votre balise de script est la même que la version de signalr dans le dossier *scripts* de votre projet.</span><span class="sxs-lookup"><span data-stu-id="9be25-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="9be25-247">Modifiez les noms de fichiers dans les balises de script, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="9be25-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="9be25-248">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur *stockticker. html*, puis cliquez sur **définir comme page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="9be25-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="9be25-249">Créez un nouveau fichier JavaScript dans le dossier du projet et nommez-le *stockticker. js*.</span><span class="sxs-lookup"><span data-stu-id="9be25-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="9be25-250">Remplacez le code du modèle par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="9be25-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="9be25-251">$. Connection fait référence aux proxies Signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="9be25-252">Le code obtient une référence au proxy pour la classe StockTickerHub et le place dans la variable du téléscripteur.</span><span class="sxs-lookup"><span data-stu-id="9be25-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="9be25-253">Le nom du proxy est le nom qui a été défini par l’attribut [HubName] :</span><span class="sxs-lookup"><span data-stu-id="9be25-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="9be25-254">Une fois que toutes les variables et fonctions sont définies, la dernière ligne de code du fichier initialise la connexion Signalr en appelant la fonction de démarrage Signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="9be25-255">La fonction Start s’exécute de façon asynchrone et retourne un [objet différé jQuery](http://api.jquery.com/category/deferred-object/), ce qui signifie que vous pouvez appeler la fonction Done pour spécifier la fonction à appeler lorsque l’opération asynchrone est terminée.</span><span class="sxs-lookup"><span data-stu-id="9be25-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="9be25-256">La fonction init appelle la fonction getAllStocks sur le serveur et utilise les informations renvoyées par le serveur pour mettre à jour la table stock.</span><span class="sxs-lookup"><span data-stu-id="9be25-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="9be25-257">Notez que, par défaut, vous devez utiliser la casse mixte sur le client bien que le nom de la méthode soit en respectant la casse sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="9be25-258">La règle de casse mixte s’applique uniquement aux méthodes, pas aux objets.</span><span class="sxs-lookup"><span data-stu-id="9be25-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="9be25-259">Par exemple, vous faites référence à stock. Symbole et stock. Prix, non stock. Symbol ou stock. Price.</span><span class="sxs-lookup"><span data-stu-id="9be25-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="9be25-260">Si vous souhaitez utiliser la casse Pascal sur le client, ou si vous souhaitez utiliser un nom de méthode complètement différent, vous pouvez décorer la méthode de concentrateur avec l’attribut HubMethodName de la même façon que vous avez décoré la classe de concentrateur proprement dite avec l’attribut HubName.</span><span class="sxs-lookup"><span data-stu-id="9be25-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="9be25-261">Dans la méthode Init, le code HTML d’une ligne de table est créé pour chaque objet stock reçu du serveur en appelant formatStock pour mettre en forme les propriétés de l’objet stock, puis en appelant la méthode supplanté (qui est définie en haut de *stockticker. js*) pour remplacer les espaces réservés dans la variable rowTemplate par les valeurs de propriété de l’objet stock.</span><span class="sxs-lookup"><span data-stu-id="9be25-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="9be25-262">Le code HTML qui en résulte est ensuite ajouté à la table stock.</span><span class="sxs-lookup"><span data-stu-id="9be25-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="9be25-263">Vous appelez init en le transmettant en tant que fonction de rappel qui s’exécute une fois la fonction Start asynchrone terminée.</span><span class="sxs-lookup"><span data-stu-id="9be25-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="9be25-264">Si vous avez appelé init en tant qu’instruction JavaScript distincte après avoir appelé Start, la fonction échoue, car elle s’exécute immédiatement sans attendre la fin de l’établissement de la connexion par la fonction Start.</span><span class="sxs-lookup"><span data-stu-id="9be25-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="9be25-265">Dans ce cas, la fonction init tente d’appeler la fonction getAllStocks avant l’établissement de la connexion au serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="9be25-266">Lorsque le serveur modifie le prix d’une action, il appelle le updateStockPrice sur les clients connectés.</span><span class="sxs-lookup"><span data-stu-id="9be25-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="9be25-267">La fonction est ajoutée à la propriété client du proxy stockTicker afin de la rendre disponible aux appels à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="9be25-268">La fonction updateStockPrice met en forme un objet stock reçu à partir du serveur dans une ligne de table de la même façon que dans la fonction init.</span><span class="sxs-lookup"><span data-stu-id="9be25-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="9be25-269">Toutefois, au lieu d’ajouter la ligne à la table, elle trouve la ligne active du stock dans la table et remplace cette ligne par la nouvelle.</span><span class="sxs-lookup"><span data-stu-id="9be25-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="9be25-270">Tester l’application</span><span class="sxs-lookup"><span data-stu-id="9be25-270">Test the application</span></span>

1. <span data-ttu-id="9be25-271">Appuyez sur F5 pour exécuter l'application en mode débogage.</span><span class="sxs-lookup"><span data-stu-id="9be25-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="9be25-272">La table stock affiche initialement le chargement... puis, après un court délai, les données boursières initiales sont affichées, puis les cours des actions commencent à changer.</span><span class="sxs-lookup"><span data-stu-id="9be25-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Chargement en cours](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Table de stock initiale](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Table stock recevant les modifications du serveur](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="9be25-276">Copiez l’URL à partir de la barre d’adresses du navigateur et collez-la dans une ou plusieurs nouvelles fenêtres de navigateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="9be25-277">L’affichage du stock initial est le même que celui du premier navigateur et les modifications se produisent simultanément.</span><span class="sxs-lookup"><span data-stu-id="9be25-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="9be25-278">Fermez tous les navigateurs et ouvrez un nouveau navigateur, puis accédez à la même URL.</span><span class="sxs-lookup"><span data-stu-id="9be25-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="9be25-279">L’objet singleton de StockTicker a continué à s’exécuter sur le serveur. par conséquent, l’affichage de la table stock indique que les stocks ont continué à changer.</span><span class="sxs-lookup"><span data-stu-id="9be25-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="9be25-280">(Vous ne voyez pas la table initiale avec des chiffres de modification zéro.)</span><span class="sxs-lookup"><span data-stu-id="9be25-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="9be25-281">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="9be25-282">Activer la journalisation</span><span class="sxs-lookup"><span data-stu-id="9be25-282">Enable logging</span></span>

<span data-ttu-id="9be25-283">Signalr possède une fonction de journalisation intégrée que vous pouvez activer sur le client pour faciliter la résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="9be25-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="9be25-284">Dans cette section, vous activez la journalisation et consultez des exemples qui montrent comment les journaux vous indiquent les méthodes de transport signalant les suivantes :</span><span class="sxs-lookup"><span data-stu-id="9be25-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="9be25-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), pris en charge par IIS 8 et les navigateurs actuels.</span><span class="sxs-lookup"><span data-stu-id="9be25-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="9be25-286">[Événements envoyés par le serveur](http://en.wikipedia.org/wiki/Server-sent_events), pris en charge par les navigateurs autres qu’Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="9be25-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="9be25-287">[Cadre illimité](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), pris en charge par Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="9be25-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="9be25-288">[Interrogation longue Ajax](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), prise en charge par tous les navigateurs.</span><span class="sxs-lookup"><span data-stu-id="9be25-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="9be25-289">Pour une connexion donnée, Signalr choisit la meilleure méthode de transport que le serveur et le client prennent en charge.</span><span class="sxs-lookup"><span data-stu-id="9be25-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="9be25-290">Ouvrez *stockticker. js* et ajoutez une ligne de code pour activer la journalisation immédiatement avant le code qui initialise la connexion à la fin du fichier :</span><span class="sxs-lookup"><span data-stu-id="9be25-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="9be25-291">Appuyez sur F5 pour exécuter le projet.</span><span class="sxs-lookup"><span data-stu-id="9be25-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="9be25-292">Ouvrez la fenêtre outils de développement de votre navigateur, puis sélectionnez la console pour afficher les journaux.</span><span class="sxs-lookup"><span data-stu-id="9be25-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="9be25-293">Vous devrez peut-être actualiser la page pour afficher les journaux de Signalr qui négocient la méthode de transport pour une nouvelle connexion.</span><span class="sxs-lookup"><span data-stu-id="9be25-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="9be25-294">Si vous exécutez Internet Explorer 10 sur Windows 8 (IIS 8), la méthode de transport est WebSocket.</span><span class="sxs-lookup"><span data-stu-id="9be25-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Console Internet Explorer 10 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="9be25-296">Si vous exécutez Internet Explorer 10 sur Windows 7 (IIS 7,5), la méthode de transport est IFRAME.</span><span class="sxs-lookup"><span data-stu-id="9be25-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![Console IE 10, IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="9be25-298">Dans Firefox, installez le complément Firebug pour obtenir une fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="9be25-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="9be25-299">Si vous exécutez Firefox 19 sur Windows 8 (IIS 8), la méthode de transport est WebSocket.</span><span class="sxs-lookup"><span data-stu-id="9be25-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19, WebSockets IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="9be25-301">Si vous exécutez Firefox 19 sur Windows 7 (IIS 7,5), la méthode de transport est un événement envoyé par le serveur.</span><span class="sxs-lookup"><span data-stu-id="9be25-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 console IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="9be25-303">Installer et examiner l’exemple de StockTicker complet</span><span class="sxs-lookup"><span data-stu-id="9be25-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="9be25-304">L’application StockTicker qui est installée par le package NuGet [Microsoft. Aspnet. signalr. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) contient plus de fonctionnalités que la version simplifiée que vous venez de créer à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="9be25-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="9be25-305">Dans cette section du didacticiel, vous installez le package NuGet et passez en revue les nouvelles fonctionnalités et le code qui les implémente.</span><span class="sxs-lookup"><span data-stu-id="9be25-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="9be25-306">Installez Signalr. exemple de package NuGet</span><span class="sxs-lookup"><span data-stu-id="9be25-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="9be25-307">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet, puis cliquez sur **gérer les packages NuGet**.</span><span class="sxs-lookup"><span data-stu-id="9be25-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="9be25-308">Dans la boîte de dialogue **gérer les packages NuGet** , cliquez sur **en ligne**, entrez *signalr. Sample* dans la zone **Rechercher en ligne** , puis cliquez sur **installer** dans l’exemple de package **signalr.**</span><span class="sxs-lookup"><span data-stu-id="9be25-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Installer Signalr. exemple de package](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="9be25-310">Dans le fichier *global. asax* , commentez RouteTable. routes. MapHubs (); la ligne que vous avez ajoutée précédemment dans l’application\_méthode Start.</span><span class="sxs-lookup"><span data-stu-id="9be25-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="9be25-311">Le code dans *global. asax* n’est plus nécessaire, car le package signalr. Sample enregistre l’itinéraire signalr dans le fichier *app\_Start/RegisterHubs. cs* :</span><span class="sxs-lookup"><span data-stu-id="9be25-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="9be25-312">La classe webactivateur référencée par l’attribut assembly est incluse dans le package NuGet WebActivatorEx, qui est installé en tant que dépendance de l’exemple de package Signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="9be25-313">Dans **Explorateur de solutions**, développez le dossier *signalr. Sample* qui a été créé en installant l’exemple de package signalr.</span><span class="sxs-lookup"><span data-stu-id="9be25-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="9be25-314">Dans le dossier *signalr. Sample* , cliquez avec le bouton droit sur *stockticker. html*, puis cliquez sur **définir comme page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="9be25-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9be25-315">Installation de Signalr. l’exemple de package NuGet peut modifier la version de jQuery que vous avez dans votre dossier *scripts* .</span><span class="sxs-lookup"><span data-stu-id="9be25-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="9be25-316">Le nouveau fichier *stockticker. html* que le package installe dans le dossier *signalr. Sample* sera synchronisé avec la version jQuery installée par le package, mais si vous souhaitez réexécuter votre fichier *stockticker. html* d’origine, vous devrez peut-être mettre à jour la référence jQuery dans la balise de script en premier.</span><span class="sxs-lookup"><span data-stu-id="9be25-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="9be25-317">Exécuter l'application</span><span class="sxs-lookup"><span data-stu-id="9be25-317">Run the application</span></span>

1. <span data-ttu-id="9be25-318">Appuyez sur F5 pour exécuter l'application.</span><span class="sxs-lookup"><span data-stu-id="9be25-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="9be25-319">En plus de la grille que vous avez vue précédemment, l’application de cotations boursières complètes affiche une fenêtre de défilement horizontal qui affiche les mêmes données boursières.</span><span class="sxs-lookup"><span data-stu-id="9be25-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="9be25-320">Lorsque vous exécutez l’application pour la première fois, le « marché » est « fermé » et vous voyez une grille statique et une fenêtre de téléscripteur qui ne défile pas.</span><span class="sxs-lookup"><span data-stu-id="9be25-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Démarrage de l’écran StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="9be25-322">Lorsque vous cliquez sur **ouvrir le marché**, la zone de cotations **boursières dynamiques** commence à faire défiler horizontalement et le serveur commence à diffuser régulièrement les modifications du cours de l’action sur une base aléatoire.</span><span class="sxs-lookup"><span data-stu-id="9be25-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="9be25-323">Chaque fois qu’un cours boursier change, la grille de la **table des stocks** en direct et la zone de cotations **boursières en direct** sont mises à jour.</span><span class="sxs-lookup"><span data-stu-id="9be25-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="9be25-324">Lorsque le changement de prix d’une action est positif, le brut s’affiche avec un arrière-plan vert et, lorsque la modification est négative, l’action est représentée par un arrière-plan rouge.</span><span class="sxs-lookup"><span data-stu-id="9be25-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Application StockTicker, ouverture du marché](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="9be25-326">Le bouton **Fermer le marché** arrête les modifications et arrête le défilement du téléscripteur, et le bouton **Réinitialiser** rétablit l’état initial de toutes les données de stock avant le début des changements de prix.</span><span class="sxs-lookup"><span data-stu-id="9be25-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="9be25-327">Si vous ouvrez d’autres fenêtres de navigateur et que vous accédez à la même URL, les mêmes données sont mises à jour de manière dynamique en même temps dans chaque navigateur.</span><span class="sxs-lookup"><span data-stu-id="9be25-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="9be25-328">Lorsque vous cliquez sur l’un des boutons, tous les navigateurs répondent de la même manière en même temps.</span><span class="sxs-lookup"><span data-stu-id="9be25-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="9be25-329">Affichage de cotations boursières en direct</span><span class="sxs-lookup"><span data-stu-id="9be25-329">Live Stock Ticker display</span></span>

<span data-ttu-id="9be25-330">L’affichage de **cotations boursières en direct** est une liste non triée dans un élément div qui est mis en forme sur une seule ligne par les styles CSS.</span><span class="sxs-lookup"><span data-stu-id="9be25-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="9be25-331">Le Ticker est initialisé et mis à jour de la même façon que la table : en remplaçant les espaces réservés dans une chaîne de modèle &lt;Li&gt; et en ajoutant dynamiquement les éléments &lt;Li&gt; à l’élément &lt;UL&gt;.</span><span class="sxs-lookup"><span data-stu-id="9be25-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="9be25-332">Le défilement est effectué à l’aide de la fonction d’animation jQuery pour faire varier la marge à gauche de la liste non triée dans la balise div.</span><span class="sxs-lookup"><span data-stu-id="9be25-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="9be25-333">CODE HTML du ticker de stock :</span><span class="sxs-lookup"><span data-stu-id="9be25-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="9be25-334">CSS ticker ticker :</span><span class="sxs-lookup"><span data-stu-id="9be25-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="9be25-335">Code jQuery qui le fait défiler :</span><span class="sxs-lookup"><span data-stu-id="9be25-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="9be25-336">Méthodes supplémentaires sur le serveur que le client peut appeler</span><span class="sxs-lookup"><span data-stu-id="9be25-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="9be25-337">La classe StockTickerHub définit quatre méthodes supplémentaires que le client peut appeler :</span><span class="sxs-lookup"><span data-stu-id="9be25-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="9be25-338">OpenMarket, CloseMarket et Reset sont appelés en réponse aux boutons situés en haut de la page.</span><span class="sxs-lookup"><span data-stu-id="9be25-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="9be25-339">Elles illustrent le modèle d’un client déclenchant une modification de l’État qui est immédiatement propagée à tous les clients.</span><span class="sxs-lookup"><span data-stu-id="9be25-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="9be25-340">Chacune de ces méthodes appelle une méthode dans la classe StockTicker qui affecte la modification de l’état du marché, puis diffuse le nouvel État.</span><span class="sxs-lookup"><span data-stu-id="9be25-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="9be25-341">Dans la classe StockTicker, l’état du marché est géré par une propriété MarketState qui retourne une valeur d’énumération MarketState :</span><span class="sxs-lookup"><span data-stu-id="9be25-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="9be25-342">Chacune des méthodes qui modifient l’état du marché le fait à l’intérieur d’un bloc de verrouillage, car la classe StockTicker doit être threadsafe :</span><span class="sxs-lookup"><span data-stu-id="9be25-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="9be25-343">Pour vous assurer que ce code est threadsafe, le champ marketState \_qui stocke la propriété MarketState est marqué comme volatile,</span><span class="sxs-lookup"><span data-stu-id="9be25-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="9be25-344">Les méthodes BroadcastMarketStateChange et BroadcastMarketReset sont similaires à la méthode BroadcastStockPrice que vous avez déjà vue, à ceci près qu’elles appellent différentes méthodes définies sur le client :</span><span class="sxs-lookup"><span data-stu-id="9be25-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="9be25-345">Fonctions supplémentaires sur le client que le serveur peut appeler</span><span class="sxs-lookup"><span data-stu-id="9be25-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="9be25-346">La fonction updateStockPrice gère désormais la grille et l’affichage du téléscripteur, et utilise jQuery. Color pour faire clignoter les couleurs rouges et vertes.</span><span class="sxs-lookup"><span data-stu-id="9be25-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="9be25-347">De nouvelles fonctions dans *signalr. stockticker. js* activent et désactivent les boutons en fonction de l’état du marché, et ils arrêtent ou démarrent le défilement horizontal de la fenêtre du téléscripteur.</span><span class="sxs-lookup"><span data-stu-id="9be25-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="9be25-348">Étant donné que plusieurs fonctions sont ajoutées à Ticker. client, la [fonction d’extension jQuery](http://api.jquery.com/jQuery.extend/) est utilisée pour les ajouter.</span><span class="sxs-lookup"><span data-stu-id="9be25-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="9be25-349">Configuration supplémentaire du client après l’établissement de la connexion</span><span class="sxs-lookup"><span data-stu-id="9be25-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="9be25-350">Une fois que le client a établi la connexion, il a d’autres tâches à effectuer : Déterminez si le marché est ouvert ou fermé afin d’appeler la fonction marketOpened ou marketClosed appropriée, et joignez les appels de la méthode serveur aux boutons.</span><span class="sxs-lookup"><span data-stu-id="9be25-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="9be25-351">Les méthodes de serveur ne sont pas connectées aux boutons tant que la connexion n’est pas établie, de sorte que le code ne peut pas essayer d’appeler les méthodes du serveur avant qu’elles ne soient disponibles.</span><span class="sxs-lookup"><span data-stu-id="9be25-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="9be25-352">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9be25-352">Next steps</span></span>

<span data-ttu-id="9be25-353">Dans ce didacticiel, vous avez appris à programmer une application Signalr qui diffuse des messages à partir du serveur à tous les clients connectés, à la fois sur une base périodique et en réponse aux notifications de n’importe quel client.</span><span class="sxs-lookup"><span data-stu-id="9be25-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="9be25-354">Le modèle d’utilisation d’une instance Singleton multithread pour maintenir l’état du serveur peut également être utilisé dans les scénarios de jeux en ligne multi-joueurs.</span><span class="sxs-lookup"><span data-stu-id="9be25-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="9be25-355">Pour obtenir un exemple, consultez [le jeu de pousseurs basé sur signalr](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="9be25-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="9be25-356">Pour obtenir des didacticiels montrant les scénarios de communication d’égal à égal, consultez [prise en main avec signalr](index.md) et [mise à jour en temps réel avec signalr](index.md).</span><span class="sxs-lookup"><span data-stu-id="9be25-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="9be25-357">Pour en savoir plus sur les concepts de développement Signalr plus avancés, visitez les sites suivants pour le code source et les ressources Signalr :</span><span class="sxs-lookup"><span data-stu-id="9be25-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="9be25-358">ASP.NET SignalR</span><span class="sxs-lookup"><span data-stu-id="9be25-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="9be25-359">Projet signalr</span><span class="sxs-lookup"><span data-stu-id="9be25-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="9be25-360">Signalr GitHub et exemples</span><span class="sxs-lookup"><span data-stu-id="9be25-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="9be25-361">Wiki signalr</span><span class="sxs-lookup"><span data-stu-id="9be25-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
