---
uid: signalr/overview/guide-to-the-api/handling-connection-lifetime-events
title: Comprendre et gérer les événements à vie de connexion dans SignalR (fr) Microsoft Docs
author: bradygaster
description: Cet article décrit comment utiliser les événements exposés par l’API Hubs.
ms.author: bradyg
ms.date: 01/15/2019
ms.assetid: 03960de2-8d95-4444-9169-4426dcc64913
msc.legacyurl: /signalr/overview/guide-to-the-api/handling-connection-lifetime-events
msc.type: authoredcontent
ms.openlocfilehash: 5bdf20549fccab5d644e35fdf4ce351540c8620d
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80676215"
---
# <a name="understanding-and-handling-connection-lifetime-events-in-signalr"></a><span data-ttu-id="a9633-103">Présentation et gestion des événements de durée de vie des connexions dans SignalR</span><span class="sxs-lookup"><span data-stu-id="a9633-103">Understanding and Handling Connection Lifetime Events in SignalR</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="a9633-104">Cet article fournit un aperçu de la connexion SignalR, de la reconnexion et des événements de déconnexion que vous pouvez gérer, ainsi que des délais d’attente et des paramètres keepalives que vous pouvez configurer.</span><span class="sxs-lookup"><span data-stu-id="a9633-104">This article provides an overview of the SignalR connection, reconnection, and disconnection events that you can handle, and timeout and keepalive settings that you can configure.</span></span>
>
> <span data-ttu-id="a9633-105">L’article suppose que vous avez déjà une certaine connaissance de SignalR et de connexion événements à vie.</span><span class="sxs-lookup"><span data-stu-id="a9633-105">The article assumes you already have some knowledge of SignalR and connection lifetime events.</span></span> <span data-ttu-id="a9633-106">Pour une introduction à SignalR, voir [Introduction à SignalR](../getting-started/introduction-to-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="a9633-106">For an introduction to SignalR, see [Introduction to SignalR](../getting-started/introduction-to-signalr.md).</span></span> <span data-ttu-id="a9633-107">Pour les listes d’événements à vie de connexion, voir les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="a9633-107">For lists of connection lifetime events, see the following resources:</span></span>
>
> - [<span data-ttu-id="a9633-108">Comment gérer les événements de connexion à vie dans la classe Hub</span><span class="sxs-lookup"><span data-stu-id="a9633-108">How to handle connection lifetime events in the Hub class</span></span>](hubs-api-guide-server.md#connectionlifetime)
> - [<span data-ttu-id="a9633-109">Comment gérer les événements de connexion à vie dans les clients JavaScript</span><span class="sxs-lookup"><span data-stu-id="a9633-109">How to handle connection lifetime events in JavaScript clients</span></span>](hubs-api-guide-javascript-client.md#connectionlifetime)
> - [<span data-ttu-id="a9633-110">Comment gérer les événements de connexion vie dans les clients .NET</span><span class="sxs-lookup"><span data-stu-id="a9633-110">How to handle connection lifetime events in .NET clients</span></span>](hubs-api-guide-net-client.md#connectionlifetime)
>
> ## <a name="software-versions-used-in-this-topic"></a><span data-ttu-id="a9633-111">Versions logicielles utilisées dans ce sujet</span><span class="sxs-lookup"><span data-stu-id="a9633-111">Software versions used in this topic</span></span>
>
>
> - [<span data-ttu-id="a9633-112">Visual Studio 2017</span><span class="sxs-lookup"><span data-stu-id="a9633-112">Visual Studio 2017</span></span>](https://visualstudio.microsoft.com/downloads/)
> - <span data-ttu-id="a9633-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="a9633-113">.NET 4.5</span></span>
> - <span data-ttu-id="a9633-114">Version SignalR 2</span><span class="sxs-lookup"><span data-stu-id="a9633-114">SignalR version 2</span></span>
>
>
>
> ## <a name="previous-versions-of-this-topic"></a><span data-ttu-id="a9633-115">Versions précédentes de ce sujet</span><span class="sxs-lookup"><span data-stu-id="a9633-115">Previous versions of this topic</span></span>
>
> <span data-ttu-id="a9633-116">Pour plus d’informations sur les versions antérieures de SignalR, voir [SignalR Older Versions](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="a9633-116">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
>
> ## <a name="questions-and-comments"></a><span data-ttu-id="a9633-117">Questions et commentaires</span><span class="sxs-lookup"><span data-stu-id="a9633-117">Questions and comments</span></span>
>
> <span data-ttu-id="a9633-118">S’il vous plaît laisser des commentaires sur la façon dont vous avez aimé ce tutoriel et ce que nous pourrions améliorer dans les commentaires au bas de la page.</span><span class="sxs-lookup"><span data-stu-id="a9633-118">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="a9633-119">Si vous avez des questions qui ne sont pas directement liées au tutoriel, vous pouvez les poster sur le [ASP.NET Forum SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) ou [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="a9633-119">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>

## <a name="overview"></a><span data-ttu-id="a9633-120">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="a9633-120">Overview</span></span>

<span data-ttu-id="a9633-121">Cet article contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="a9633-121">This article contains the following sections:</span></span>

- [<span data-ttu-id="a9633-122">Connexion de la terminologie et des scénarios à vie</span><span class="sxs-lookup"><span data-stu-id="a9633-122">Connection lifetime terminology and scenarios</span></span>](#terminology)

    - [<span data-ttu-id="a9633-123">Connexions SignalR, connexions de transport et connexions physiques</span><span class="sxs-lookup"><span data-stu-id="a9633-123">SignalR connections, transport connections, and physical connections</span></span>](#signalrvstransport)
    - [<span data-ttu-id="a9633-124">Scénarios de déconnexion des transports</span><span class="sxs-lookup"><span data-stu-id="a9633-124">Transport disconnection scenarios</span></span>](#transportdisconnect)
    - [<span data-ttu-id="a9633-125">Scénarios de déconnexion des clients</span><span class="sxs-lookup"><span data-stu-id="a9633-125">Client disconnection scenarios</span></span>](#clientdisconnect)
    - [<span data-ttu-id="a9633-126">Scénarios de déconnexion du serveur</span><span class="sxs-lookup"><span data-stu-id="a9633-126">Server disconnection scenarios</span></span>](#serverdisconnect)
- [<span data-ttu-id="a9633-127">Temps d’arrêt et paramètres keepalive</span><span class="sxs-lookup"><span data-stu-id="a9633-127">Timeout and keepalive settings</span></span>](#timeoutkeepalive)

    - [<span data-ttu-id="a9633-128">ConnexionTimeout</span><span class="sxs-lookup"><span data-stu-id="a9633-128">ConnectionTimeout</span></span>](#connectiontimeout)
    - [<span data-ttu-id="a9633-129">DisconnectTimeout (en)</span><span class="sxs-lookup"><span data-stu-id="a9633-129">DisconnectTimeout</span></span>](#disconnecttimeout)
    - [<span data-ttu-id="a9633-130">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="a9633-130">KeepAlive</span></span>](#keepalive)
    - [<span data-ttu-id="a9633-131">Comment modifier le délai d’attente et les paramètres keepalive</span><span class="sxs-lookup"><span data-stu-id="a9633-131">How to change timeout and keepalive settings</span></span>](#changetimeout)
- [<span data-ttu-id="a9633-132">Comment informer l’utilisateur des déconnexions</span><span class="sxs-lookup"><span data-stu-id="a9633-132">How to notify the user about disconnections</span></span>](#notifydisconnect)
- [<span data-ttu-id="a9633-133">Comment se reconnecter en permanence</span><span class="sxs-lookup"><span data-stu-id="a9633-133">How to continuously reconnect</span></span>](#continuousreconnect)
- [<span data-ttu-id="a9633-134">Comment déconnecter un client dans le code serveur</span><span class="sxs-lookup"><span data-stu-id="a9633-134">How to disconnect a client in server code</span></span>](#disconnectclientfromserver)
- [<span data-ttu-id="a9633-135">Détecter la raison d’une déconnexion</span><span class="sxs-lookup"><span data-stu-id="a9633-135">Detecting the reason for a disconnection</span></span>](#detectingreasonfordisconnection)

<span data-ttu-id="a9633-136">Les liens vers les sujets de référence API sont à la version .NET 4.5 de l’API.</span><span class="sxs-lookup"><span data-stu-id="a9633-136">Links to API Reference topics are to the .NET 4.5 version of the API.</span></span> <span data-ttu-id="a9633-137">Si vous utilisez .NET 4, voir [la version .NET 4 des sujets API](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span><span class="sxs-lookup"><span data-stu-id="a9633-137">If you're using .NET 4, see [the .NET 4 version of the API topics](https://msdn.microsoft.com/library/jj891075(v=vs.100).aspx).</span></span>

<a id="terminology"></a>

## <a name="connection-lifetime-terminology-and-scenarios"></a><span data-ttu-id="a9633-138">Connexion de la terminologie et des scénarios à vie</span><span class="sxs-lookup"><span data-stu-id="a9633-138">Connection lifetime terminology and scenarios</span></span>

<span data-ttu-id="a9633-139">Le `OnReconnected` gestionnaire d’événements dans un `OnConnected` hub SignalR peut exécuter directement après mais pas après `OnDisconnected` pour un client donné.</span><span class="sxs-lookup"><span data-stu-id="a9633-139">The `OnReconnected` event handler in a SignalR Hub can execute directly after `OnConnected` but not after `OnDisconnected` for a given client.</span></span> <span data-ttu-id="a9633-140">La raison pour laquelle vous pouvez avoir une reconnexion sans déconnexion est qu’il existe plusieurs façons dont le mot "connexion" est utilisé dans SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-140">The reason you can have a reconnection without a disconnection is that there are several ways in which the word "connection" is used in SignalR.</span></span>

<a id="signalrvstransport"></a>

### <a name="signalr-connections-transport-connections-and-physical-connections"></a><span data-ttu-id="a9633-141">Connexions SignalR, connexions de transport et connexions physiques</span><span class="sxs-lookup"><span data-stu-id="a9633-141">SignalR connections, transport connections, and physical connections</span></span>

<span data-ttu-id="a9633-142">Cet article fera la distinction entre *les connexions SignalR,* *les connexions de transport*et les *connexions physiques*:</span><span class="sxs-lookup"><span data-stu-id="a9633-142">This article will differentiate between *SignalR connections*, *transport connections*, and *physical connections*:</span></span>

- <span data-ttu-id="a9633-143">**La connexion SignalR** fait référence à une relation logique entre un client et une URL serveur, maintenue par l’API SignalR et identifiée uniquement par un identifiant de connexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-143">**SignalR connection** refers to a logical relationship between a client and a server URL, maintained by the SignalR API and uniquely identified by a connection ID.</span></span> <span data-ttu-id="a9633-144">Les données sur cette relation sont conservées par SignalR et sont utilisées pour établir une connexion de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-144">The data about this relationship is maintained by SignalR and is used to establish a transport connection.</span></span> <span data-ttu-id="a9633-145">La relation se termine et SignalR dispose des `Stop` données lorsque le client appelle la méthode ou une limite de délai d’attente est atteinte pendant que SignalR tente de rétablir une connexion de transport perdue.</span><span class="sxs-lookup"><span data-stu-id="a9633-145">The relationship ends and SignalR disposes of the data when the client calls the `Stop` method or a timeout limit is reached while SignalR is attempting to re-establish a lost transport connection.</span></span>
- <span data-ttu-id="a9633-146">**La connexion transport** se réfère à une relation logique entre un client et un serveur, maintenu par l’une des quatre API de transport: WebSockets, événements envoyés par serveur, cadre pour toujours, ou de longs sondages.</span><span class="sxs-lookup"><span data-stu-id="a9633-146">**Transport connection** refers to a logical relationship between a client and a server, maintained by one of the four transport APIs: WebSockets, server-sent events, forever frame, or long polling.</span></span> <span data-ttu-id="a9633-147">SignalR utilise l’API de transport pour créer une connexion de transport, et l’API de transport dépend de l’existence d’une connexion réseau physique pour créer la connexion de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-147">SignalR uses the transport API to create a transport connection, and the transport API depends on the existence of a physical network connection to create the transport connection.</span></span> <span data-ttu-id="a9633-148">La connexion de transport prend fin lorsque SignalR y met fin ou lorsque l’API de transport détecte que la connexion physique est rompue.</span><span class="sxs-lookup"><span data-stu-id="a9633-148">The transport connection ends when SignalR terminates it or when the transport API detects that the physical connection is broken.</span></span>
- <span data-ttu-id="a9633-149">**La connexion physique** se réfère aux liens de réseau physique -- fils, signaux sans fil, routeurs, etc. -- qui facilitent la communication entre un ordinateur client et un ordinateur serveur.</span><span class="sxs-lookup"><span data-stu-id="a9633-149">**Physical connection** refers to the physical network links -- wires, wireless signals, routers, etc. -- that facilitate communication between a client computer and a server computer.</span></span> <span data-ttu-id="a9633-150">La connexion physique doit être présente afin d’établir une connexion de transport, et une connexion de transport doit être établie afin d’établir une connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-150">The physical connection must be present in order to establish a transport connection, and a transport connection must be established in order to establish a SignalR connection.</span></span> <span data-ttu-id="a9633-151">Cependant, la rupture de la connexion physique ne met pas toujours fin immédiatement à la connexion de transport ou à la connexion SignalR, comme cela sera expliqué plus tard dans ce sujet.</span><span class="sxs-lookup"><span data-stu-id="a9633-151">However, breaking the physical connection doesn't always immediately end the transport connection or the SignalR connection, as will be explained later in this topic.</span></span>

<span data-ttu-id="a9633-152">Dans le diagramme suivant, la connexion SignalR est représentée par la couche aPI Hubs et PersistentConnection, la connexion de transport est représentée par la couche Transports, et la connexion physique est représentée par les lignes entre le serveur et les clients.</span><span class="sxs-lookup"><span data-stu-id="a9633-152">In the following diagram, the SignalR connection is represented by the Hubs API and PersistentConnection API SignalR layer, the transport connection is represented by the Transports layer, and the physical connection is represented by the lines between the server and the clients.</span></span>

![Diagramme d’architecture SignalR](handling-connection-lifetime-events/_static/image1.png)

<span data-ttu-id="a9633-154">Lorsque vous `Start` appelez la méthode d’un client SignalR, vous fournissez au code client SignalR toutes les informations dont il a besoin afin d’établir une connexion physique à un serveur.</span><span class="sxs-lookup"><span data-stu-id="a9633-154">When you call the `Start` method in a SignalR client, you are providing SignalR client code with all the information it needs in order to establish a physical connection to a server.</span></span> <span data-ttu-id="a9633-155">Le code client SignalR utilise ces informations pour faire une demande HTTP et établir une connexion physique qui utilise l’une des quatre méthodes de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-155">SignalR client code uses this information to make an HTTP request and establish a physical connection that uses one of the four transport methods.</span></span> <span data-ttu-id="a9633-156">Si la connexion de transport échoue ou si le serveur échoue, la connexion SignalR ne disparaît pas immédiatement parce que le client a toujours les informations dont il a besoin pour rétablir automatiquement une nouvelle connexion de transport à la même URL SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-156">If the transport connection fails or the server fails, the SignalR connection doesn't go away immediately because the client still has the information it needs to automatically re-establish a new transport connection to the same SignalR URL.</span></span> <span data-ttu-id="a9633-157">Dans ce scénario, aucune intervention de l’application utilisateur n’est impliquée, et lorsque le code client SignalR établit une nouvelle connexion de transport, il ne démarre pas une nouvelle connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-157">In this scenario, no intervention from the user application is involved, and when the SignalR client code establishes a new transport connection, it does not start a new SignalR connection.</span></span> <span data-ttu-id="a9633-158">La continuité de la connexion SignalR se reflète dans le fait que `Start` l’ID de connexion, qui est créé lorsque vous appelez la méthode, ne change pas.</span><span class="sxs-lookup"><span data-stu-id="a9633-158">The continuity of the SignalR connection is reflected in the fact that the connection ID, which is created when you call the `Start` method, does not change.</span></span>

<span data-ttu-id="a9633-159">Le `OnReconnected` gestionnaire d’événements sur le Hub s’exécute lorsqu’une connexion de transport est automatiquement rétablie après avoir été perdue.</span><span class="sxs-lookup"><span data-stu-id="a9633-159">The `OnReconnected` event handler on the Hub executes when a transport connection is automatically re-established after having been lost.</span></span> <span data-ttu-id="a9633-160">Le `OnDisconnected` gestionnaire d’événements exécute à la fin d’une connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-160">The `OnDisconnected` event handler executes at the end of a SignalR connection.</span></span> <span data-ttu-id="a9633-161">Une connexion SignalR peut se terminer de toutes les façons suivantes :</span><span class="sxs-lookup"><span data-stu-id="a9633-161">A SignalR connection can end in any of the following ways:</span></span>

- <span data-ttu-id="a9633-162">Si le client `Stop` appelle la méthode, un message d’arrêt est envoyé au serveur, et le client et le serveur terminent immédiatement la connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-162">If the client calls the `Stop` method, a stop message is sent to the server, and both client and server end the SignalR connection immediately.</span></span>
- <span data-ttu-id="a9633-163">Une fois la connectivité entre le client et le serveur perdue, le client tente de se reconnecter et le serveur attend que le client se reconnecte.</span><span class="sxs-lookup"><span data-stu-id="a9633-163">After connectivity between client and server is lost, the client tries to reconnect and the server waits for the client to reconnect.</span></span> <span data-ttu-id="a9633-164">Si les tentatives de reconnexion sont infructueuses et que la période de décalage se termine, le client et le serveur mettent fin à la connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-164">If the attempts to reconnect are unsuccessful and the disconnect timeout period ends, both client and server end the SignalR connection.</span></span> <span data-ttu-id="a9633-165">Le client cesse d’essayer de se reconnecter, et le serveur dispose de sa représentation de la connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-165">The client stops trying to reconnect, and the server disposes of its representation of the SignalR connection.</span></span>
- <span data-ttu-id="a9633-166">Si le client cesse de fonctionner `Stop` sans avoir la possibilité d’appeler la méthode, le serveur attend que le client se reconnecte, puis met fin à la connexion SignalR après la période de décalage.</span><span class="sxs-lookup"><span data-stu-id="a9633-166">If the client stops running without having a chance to call the `Stop` method, the server waits for the client to reconnect, and then ends the SignalR connection after the disconnect timeout period.</span></span>
- <span data-ttu-id="a9633-167">Si le serveur cesse de fonctionner, le client tente de se reconnecter (recréer la connexion de transport), puis met fin à la connexion SignalR après la période de décalage.</span><span class="sxs-lookup"><span data-stu-id="a9633-167">If the server stops running, the client tries to reconnect (re-create the transport connection), and then ends the SignalR connection after the disconnect timeout period.</span></span>

<span data-ttu-id="a9633-168">Lorsqu’il n’y a pas de problèmes de connexion, et que l’application utilisateur met fin à la connexion SignalR en appelant la `Stop` méthode, la connexion SignalR et la connexion de transport commencent et se terminent à peu près au même moment.</span><span class="sxs-lookup"><span data-stu-id="a9633-168">When there are no connection problems, and the user application ends the SignalR connection by calling the `Stop` method, the SignalR connection and the transport connection begin and end at about the same time.</span></span> <span data-ttu-id="a9633-169">Les sections suivantes décrivent plus en détail les autres scénarios.</span><span class="sxs-lookup"><span data-stu-id="a9633-169">The following sections describe in more detail the other scenarios.</span></span>

<a id="transportdisconnect"></a>

### <a name="transport-disconnection-scenarios"></a><span data-ttu-id="a9633-170">Scénarios de déconnexion des transports</span><span class="sxs-lookup"><span data-stu-id="a9633-170">Transport disconnection scenarios</span></span>

<span data-ttu-id="a9633-171">Les connexions physiques peuvent être lentes ou il peut y avoir des interruptions de connectivité.</span><span class="sxs-lookup"><span data-stu-id="a9633-171">Physical connections might be slow or there might be interruptions in connectivity.</span></span> <span data-ttu-id="a9633-172">Selon des facteurs tels que la durée de l’interruption, la connexion de transport peut être supprimée.</span><span class="sxs-lookup"><span data-stu-id="a9633-172">Depending on factors such as the length of the interruption, the transport connection might be dropped.</span></span> <span data-ttu-id="a9633-173">SignalR tente alors de rétablir la connexion de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-173">SignalR then tries to re-establish the transport connection.</span></span> <span data-ttu-id="a9633-174">Parfois, la connexion de transport API détecte l’interruption et laisse tomber la connexion de transport, et SignalR découvre immédiatement que la connexion est perdue.</span><span class="sxs-lookup"><span data-stu-id="a9633-174">Sometimes the transport connection API detects the interruption and drops the transport connection, and SignalR finds out immediately that the connection is lost.</span></span> <span data-ttu-id="a9633-175">Dans d’autres scénarios, ni l’API de la connexion de transport ni SignalR ne prennent conscience immédiatement que la connectivité a été perdue.</span><span class="sxs-lookup"><span data-stu-id="a9633-175">In other scenarios, neither the transport connection API nor SignalR becomes aware immediately that connectivity has been lost.</span></span> <span data-ttu-id="a9633-176">Pour tous les transports, sauf les longs sondages, le client SignalR utilise une fonction appelée *keepalive* pour vérifier la perte de connectivité que l’API de transport est incapable de détecter.</span><span class="sxs-lookup"><span data-stu-id="a9633-176">For all transports except long polling, the SignalR client uses a function called *keepalive* to check for loss of connectivity that the transport API is unable to detect.</span></span> <span data-ttu-id="a9633-177">Pour plus d’informations sur les longs connexions de sondage, consultez [les paramètres Timeout et keepalive](#timeoutkeepalive) plus tard dans ce sujet.</span><span class="sxs-lookup"><span data-stu-id="a9633-177">For information about long polling connections, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

<span data-ttu-id="a9633-178">Lorsqu’une connexion est inactive, le serveur envoie périodiquement un paquet keepalive au client.</span><span class="sxs-lookup"><span data-stu-id="a9633-178">When a connection is inactive, periodically the server sends a keepalive packet to the client.</span></span> <span data-ttu-id="a9633-179">À la date de l’écriture de cet article, la fréquence par défaut est toutes les 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-179">As of the date this article is being written, the default frequency is every 10 seconds.</span></span> <span data-ttu-id="a9633-180">En écoutant ces paquets, les clients peuvent dire s’il y a un problème de connexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-180">By listening for these packets, clients can tell if there is a connection problem.</span></span> <span data-ttu-id="a9633-181">Si un paquet de keepalive n’est pas reçu lorsqu’il est prévu, après un court laps de temps, le client suppose qu’il existe des problèmes de connexion tels que la lenteur ou les interruptions.</span><span class="sxs-lookup"><span data-stu-id="a9633-181">If a keepalive packet is not received when expected, after a short time the client assumes that there are connection problems such as slowness or interruptions.</span></span> <span data-ttu-id="a9633-182">Si le keepalive n’est toujours pas reçu après une plus longue période, le client suppose que la connexion a été supprimée, et il commence à essayer de se reconnecter.</span><span class="sxs-lookup"><span data-stu-id="a9633-182">If the keepalive is still not received after a longer time, the client assumes that the connection has been dropped, and it begins trying to reconnect.</span></span>

<span data-ttu-id="a9633-183">Le diagramme suivant illustre les événements clients et serveur qui sont soulevés dans un scénario typique lorsqu’il y a des problèmes avec la connexion physique qui ne sont pas immédiatement reconnus par l’API de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-183">The following diagram illustrates the client and server events that are raised in a typical scenario when there are problems with the physical connection that aren't immediately recognized by the transport API.</span></span> <span data-ttu-id="a9633-184">Le diagramme s’applique aux circonstances suivantes :</span><span class="sxs-lookup"><span data-stu-id="a9633-184">The diagram applies to the following circumstances:</span></span>

- <span data-ttu-id="a9633-185">Le transport est WebSockets, image pour toujours, ou des événements envoyés par le serveur.</span><span class="sxs-lookup"><span data-stu-id="a9633-185">The transport is WebSockets, forever frame, or server-sent events.</span></span>
- <span data-ttu-id="a9633-186">Il y a différentes périodes d’interruption dans la connexion réseau physique.</span><span class="sxs-lookup"><span data-stu-id="a9633-186">There are varying periods of interruption in the physical network connection.</span></span>
- <span data-ttu-id="a9633-187">L’API de transport ne prend pas conscience des interruptions, donc SignalR s’appuie sur la fonctionnalité de maintien pour les détecter.</span><span class="sxs-lookup"><span data-stu-id="a9633-187">The transport API does not become aware of the interruptions, so SignalR relies on the keepalive functionality to detect them.</span></span>

![Déconnexions de transport](handling-connection-lifetime-events/_static/image2.png)

<span data-ttu-id="a9633-189">Si le client passe en mode de reconnexion mais ne peut pas établir une connexion de transport dans la limite de délai de débranchement, le serveur met fin à la connexion SignalR.</span><span class="sxs-lookup"><span data-stu-id="a9633-189">If the client goes into reconnecting mode but can't establish a transport connection within the disconnect timeout limit, the server terminates the SignalR connection.</span></span> <span data-ttu-id="a9633-190">Lorsque cela se produit, le serveur `OnDisconnected` exécute la méthode du Hub et fait la queue d’un message de déconnexion à envoyer au client au cas où le client parvient à se connecter plus tard.</span><span class="sxs-lookup"><span data-stu-id="a9633-190">When that happens, the server executes the Hub's `OnDisconnected` method and queues up a disconnect message to send to the client in case the client manages to connect later.</span></span> <span data-ttu-id="a9633-191">Si le client se reconnecte alors, il `Stop` reçoit la commande de déconnexion et appelle la méthode.</span><span class="sxs-lookup"><span data-stu-id="a9633-191">If the client then does reconnect, it receives the disconnect command and calls the `Stop` method.</span></span> <span data-ttu-id="a9633-192">Dans ce `OnReconnected` scénario, n’est pas exécuté `OnDisconnected` lorsque le client se `Stop`reconnecte, et n’est pas exécuté lorsque le client appelle .</span><span class="sxs-lookup"><span data-stu-id="a9633-192">In this scenario, `OnReconnected` is not executed when the client reconnects, and `OnDisconnected` is not executed when the client calls `Stop`.</span></span> <span data-ttu-id="a9633-193">Le diagramme suivant illustre ce scénario.</span><span class="sxs-lookup"><span data-stu-id="a9633-193">The following diagram illustrates this scenario.</span></span>

![Perturbations de transport - délai d’attente du serveur](handling-connection-lifetime-events/_static/image3.png)

<span data-ttu-id="a9633-195">Les événements à vie de connexion SignalR qui peuvent être soulevés sur le client sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="a9633-195">The SignalR connection lifetime events that may be raised on the client are the following:</span></span>

- <span data-ttu-id="a9633-196">`ConnectionSlow`événement client.</span><span class="sxs-lookup"><span data-stu-id="a9633-196">`ConnectionSlow` client event.</span></span>

    <span data-ttu-id="a9633-197">Augmenté quand une proportion prédéfinie de la période de temps d’arrêt de keepalive s’est passée depuis que le dernier message ou le ping keepalive a été reçu.</span><span class="sxs-lookup"><span data-stu-id="a9633-197">Raised when a preset proportion of the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="a9633-198">La période d’avertissement de délai d’arrêt par défaut est de 2/3 du délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="a9633-198">The default keepalive timeout warning period is 2/3 of the keepalive timeout.</span></span> <span data-ttu-id="a9633-199">Le délai d’attente est de 20 secondes, de sorte que l’avertissement se produit à environ 13 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-199">The keepalive timeout is 20 seconds, so the warning occurs at about 13 seconds.</span></span>

    <span data-ttu-id="a9633-200">Par défaut, le serveur envoie des pings keepalive toutes les 10 secondes, et le client vérifie les pings keepalive environ toutes les 2 secondes (un tiers de la différence entre la valeur de temps d’arrêt keepalive et la valeur d’avertissement de temps d’arrêt keepalive).</span><span class="sxs-lookup"><span data-stu-id="a9633-200">By default, the server sends keepalive pings every 10 seconds, and the client checks for keepalive pings about every 2 seconds (one third of the difference between the keepalive timeout value and the keepalive timeout warning value).</span></span>

    <span data-ttu-id="a9633-201">Si l’API de transport prend connaissance d’une déconnexion, SignalR peut être informé de la déconnexion avant que la période d’avertissement de délai d’attente ne passe.</span><span class="sxs-lookup"><span data-stu-id="a9633-201">If the transport API becomes aware of a disconnection, SignalR might be informed of the disconnection before the keepalive timeout warning period passes.</span></span> <span data-ttu-id="a9633-202">Dans ce cas, l’événement `ConnectionSlow` ne serait pas soulevé, `Reconnecting` et SignalR irait directement à l’événement.</span><span class="sxs-lookup"><span data-stu-id="a9633-202">In that case, the `ConnectionSlow` event would not be raised, and SignalR would go directly to the `Reconnecting` event.</span></span>
- <span data-ttu-id="a9633-203">`Reconnecting`événement client.</span><span class="sxs-lookup"><span data-stu-id="a9633-203">`Reconnecting` client event.</span></span>

    <span data-ttu-id="a9633-204">Augmenté lorsque (a) l’API de transport détecte que la connexion est perdue, ou (b) la période de délai d’attente a passé depuis le dernier message ou ping keepalive a été reçu.</span><span class="sxs-lookup"><span data-stu-id="a9633-204">Raised when (a) the transport API detects that the connection is lost, or (b) the keepalive timeout period has passed since the last message or keepalive ping was received.</span></span> <span data-ttu-id="a9633-205">Le code client SignalR commence à essayer de se reconnecter.</span><span class="sxs-lookup"><span data-stu-id="a9633-205">The SignalR client code begins trying to reconnect.</span></span> <span data-ttu-id="a9633-206">Vous pouvez gérer cet événement si vous voulez que votre application prenne des mesures lorsqu’une connexion de transport est perdue.</span><span class="sxs-lookup"><span data-stu-id="a9633-206">You can handle this event if you want your application to take some action when a transport connection is lost.</span></span> <span data-ttu-id="a9633-207">La période de délai d’arrêt par défaut est actuellement de 20 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-207">The default keepalive timeout period is currently 20 seconds.</span></span>

    <span data-ttu-id="a9633-208">Si votre code client essaie d’appeler une méthode Hub pendant que SignalR est en mode de reconnexion, SignalR va essayer d’envoyer la commande.</span><span class="sxs-lookup"><span data-stu-id="a9633-208">If your client code tries to call a Hub method while SignalR is in reconnecting mode, SignalR will try to send the command.</span></span> <span data-ttu-id="a9633-209">La plupart du temps, de telles tentatives échoueront, mais dans certaines circonstances, elles pourraient réussir.</span><span class="sxs-lookup"><span data-stu-id="a9633-209">Most of the time, such attempts will fail, but in some circumstances they might succeed.</span></span> <span data-ttu-id="a9633-210">Pour les événements envoyés par le serveur, pour toujours le cadre, et les longs transports de vote, SignalR utilise deux canaux de communication, l’un que le client utilise pour envoyer des messages et celui qu’il utilise pour recevoir des messages.</span><span class="sxs-lookup"><span data-stu-id="a9633-210">For the server-sent events, forever frame, and long polling transports, SignalR uses two communication channels, one that the client uses to send messages and one that it uses to receive messages.</span></span> <span data-ttu-id="a9633-211">Le canal utilisé pour recevoir est le canal ouvert en permanence, et c’est celui qui est fermé lorsque la connexion physique est interrompue.</span><span class="sxs-lookup"><span data-stu-id="a9633-211">The channel used for receiving is the permanently open one, and that's the one that is closed when the physical connection is interrupted.</span></span> <span data-ttu-id="a9633-212">Le canal utilisé pour l’envoi reste disponible, donc si la connectivité physique est restaurée, un appel de méthode du client au serveur pourrait être réussi avant que le canal de réception est rétabli.</span><span class="sxs-lookup"><span data-stu-id="a9633-212">The channel used for sending remains available, so if physical connectivity is restored, a method call from client to server might be successful before the receive channel is re-established.</span></span> <span data-ttu-id="a9633-213">La valeur de retour ne serait pas reçue jusqu’à ce que SignalR rouvre le canal utilisé pour la réception.</span><span class="sxs-lookup"><span data-stu-id="a9633-213">The return value would not be received until SignalR re-opens the channel used for receiving.</span></span>
- <span data-ttu-id="a9633-214">`Reconnected`événement client.</span><span class="sxs-lookup"><span data-stu-id="a9633-214">`Reconnected` client event.</span></span>

    <span data-ttu-id="a9633-215">Augmenté lorsque la connexion de transport est rétablie.</span><span class="sxs-lookup"><span data-stu-id="a9633-215">Raised when the transport connection is reestablished.</span></span> <span data-ttu-id="a9633-216">Le `OnReconnected` gestionnaire d’événements dans le Hub s’exécute.</span><span class="sxs-lookup"><span data-stu-id="a9633-216">The `OnReconnected` event handler in the Hub executes.</span></span>
- <span data-ttu-id="a9633-217">`Closed`événement client`disconnected` (événement à JavaScript).</span><span class="sxs-lookup"><span data-stu-id="a9633-217">`Closed` client event (`disconnected` event in JavaScript).</span></span>

    <span data-ttu-id="a9633-218">Augmenté lorsque la période de délai de déconnexion expire pendant que le code client SignalR tente de se reconnecter après avoir perdu la connexion de transport.</span><span class="sxs-lookup"><span data-stu-id="a9633-218">Raised when the disconnect timeout period expires while the SignalR client code is trying to reconnect after losing the transport connection.</span></span> <span data-ttu-id="a9633-219">Le délai de déconnectage par défaut est de 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-219">The default disconnect timeout is 30 seconds.</span></span> <span data-ttu-id="a9633-220">(Cet événement est également soulevé lorsque `Stop` la connexion se termine parce que la méthode est appelée.)</span><span class="sxs-lookup"><span data-stu-id="a9633-220">(This event is also raised when the connection ends because the `Stop` method is called.)</span></span>

<span data-ttu-id="a9633-221">Interruptions de connexion de transport qui ne sont pas détectées par l’API de transport et ne retardent pas la réception des pings keepalive du serveur pendant plus longtemps que la période d’avertissement de délai d’attente pourrait ne pas provoquer des événements à vie de connexion à augmenter.</span><span class="sxs-lookup"><span data-stu-id="a9633-221">Transport connection interruptions that are not detected by the transport API and don't delay the reception of keepalive pings from the server for longer than the keepalive timeout warning period might not cause any connection lifetime events to be raised.</span></span>

<span data-ttu-id="a9633-222">Certains environnements réseau ferment délibérément les connexions inactives, et une autre fonction des paquets keepalive est d’aider à prévenir cela en faisant savoir à ces réseaux qu’une connexion SignalR est utilisée.</span><span class="sxs-lookup"><span data-stu-id="a9633-222">Some network environments deliberately close idle connections, and another function of the keepalive packets is to help prevent this by letting these networks know that a SignalR connection is in use.</span></span> <span data-ttu-id="a9633-223">Dans les cas extrêmes, la fréquence par défaut des pings keepalives peut ne pas être suffisante pour empêcher les connexions fermées.</span><span class="sxs-lookup"><span data-stu-id="a9633-223">In extreme cases the default frequency of keepalive pings might not be enough to prevent closed connections.</span></span> <span data-ttu-id="a9633-224">Dans ce cas, vous pouvez configurer des pings keepalives à envoyer plus souvent.</span><span class="sxs-lookup"><span data-stu-id="a9633-224">In that case you can configure keepalive pings to be sent more often.</span></span> <span data-ttu-id="a9633-225">Pour plus d’informations, consultez [Timeout et keepalive paramètres](#timeoutkeepalive) plus tard dans ce sujet.</span><span class="sxs-lookup"><span data-stu-id="a9633-225">For more information, see [Timeout and keepalive settings](#timeoutkeepalive) later in this topic.</span></span>

> [!NOTE]
>
> <span data-ttu-id="a9633-226">**Important**: La séquence des événements décrits ici n’est pas garantie.</span><span class="sxs-lookup"><span data-stu-id="a9633-226">**Important**: The sequence of events described here is not guaranteed.</span></span> <span data-ttu-id="a9633-227">SignalR fait toutes les tentatives pour augmenter les événements de connexion à vie d’une manière prévisible selon ce régime, mais il existe de nombreuses variations d’événements réseau et de nombreuses façons dont les cadres de communication sous-jacents tels que les API de transport les gérer.</span><span class="sxs-lookup"><span data-stu-id="a9633-227">SignalR makes every attempt to raise connection lifetime events in a predictable manner according to this scheme, but there are many variations of network events and many ways in which underlying communications frameworks such as transport APIs handle them.</span></span> <span data-ttu-id="a9633-228">Par exemple, `Reconnected` l’événement peut ne pas être `OnConnected` soulevé lorsque le client se reconnecte, ou le gestionnaire sur le serveur peut s’exécuter lorsque la tentative d’établir une connexion est infructueuse.</span><span class="sxs-lookup"><span data-stu-id="a9633-228">For example, the `Reconnected` event might not be raised when the client reconnects, or the `OnConnected` handler on the server might run when the attempt to establish a connection is unsuccessful.</span></span> <span data-ttu-id="a9633-229">Ce sujet ne décrit que les effets qui seraient normalement produits par certaines circonstances typiques.</span><span class="sxs-lookup"><span data-stu-id="a9633-229">This topic describes only the effects that would normally be produced by certain typical circumstances.</span></span>

<a id="clientdisconnect"></a>

### <a name="client-disconnection-scenarios"></a><span data-ttu-id="a9633-230">Scénarios de déconnexion des clients</span><span class="sxs-lookup"><span data-stu-id="a9633-230">Client disconnection scenarios</span></span>

<span data-ttu-id="a9633-231">Dans un client navigateur, le code client SignalR qui maintient une connexion SignalR s’exécute dans le contexte JavaScript d’une page Web.</span><span class="sxs-lookup"><span data-stu-id="a9633-231">In a browser client, the SignalR client code that maintains a SignalR connection runs in the JavaScript context of a web page.</span></span> <span data-ttu-id="a9633-232">C’est pourquoi la connexion SignalR doit prendre fin lorsque vous naviguez d’une page à l’autre, et c’est pourquoi vous avez plusieurs connexions avec plusieurs connexions ID si vous vous connectez à partir de plusieurs fenêtres ou onglets de navigateur.</span><span class="sxs-lookup"><span data-stu-id="a9633-232">That's why the SignalR connection has to end when you navigate from one page to another, and that's why you have multiple connections with multiple connection IDs if you connect from multiple browser windows or tabs.</span></span> <span data-ttu-id="a9633-233">Lorsque l’utilisateur ferme une fenêtre ou un onglet de navigateur, ou navigue vers une nouvelle page ou actualise la page, `Stop` la connexion SignalR se termine immédiatement parce que le code client SignalR gère cet événement de navigateur pour vous et appelle la méthode.</span><span class="sxs-lookup"><span data-stu-id="a9633-233">When the user closes a browser window or tab, or navigates to a new page or refreshes the page, the SignalR connection immediately ends because SignalR client code handles that browser event for you and calls the `Stop` method.</span></span> <span data-ttu-id="a9633-234">Dans ces scénarios, ou dans n’importe `Stop` quelle plate-forme client lorsque votre application appelle la méthode, le `OnDisconnected` gestionnaire d’événements s’exécute immédiatement sur le serveur et le client soulève l’événement `Closed` (l’événement est nommé `disconnected` dans JavaScript).</span><span class="sxs-lookup"><span data-stu-id="a9633-234">In these scenarios, or in any client platform when your application calls the `Stop` method, the `OnDisconnected` event handler executes immediately on the server and the client raises the `Closed` event (the event is named `disconnected` in JavaScript).</span></span>

<span data-ttu-id="a9633-235">Si une application client ou l’ordinateur qu’il est en cours d’exécution sur les accidents ou va dormir (par exemple, lorsque l’utilisateur ferme l’ordinateur portable), le serveur n’est pas informé de ce qui s’est passé.</span><span class="sxs-lookup"><span data-stu-id="a9633-235">If a client application or the computer that it's running on crashes or goes to sleep (for example, when the user closes the laptop), the server is not informed about what happened.</span></span> <span data-ttu-id="a9633-236">Pour autant que le serveur le sache, la perte du client peut être due à une interruption de connectivité et le client pourrait essayer de se reconnecter.</span><span class="sxs-lookup"><span data-stu-id="a9633-236">As far as the server knows, the loss of the client might be due to connectivity interruption and the client might be trying to reconnect.</span></span> <span data-ttu-id="a9633-237">Par conséquent, dans ces scénarios, le serveur attend pour `OnDisconnected` donner au client une chance de se reconnecter, et ne s’exécute pas jusqu’à ce que la période de délai de déconnectement expire (environ 30 secondes par défaut).</span><span class="sxs-lookup"><span data-stu-id="a9633-237">Therefore, in these scenarios the server waits to give the client a chance to reconnect, and `OnDisconnected` does not execute until the disconnect timeout period expires (about 30 seconds by default).</span></span> <span data-ttu-id="a9633-238">Le diagramme suivant illustre ce scénario.</span><span class="sxs-lookup"><span data-stu-id="a9633-238">The following diagram illustrates this scenario.</span></span>

![Défaillance de l’ordinateur client](handling-connection-lifetime-events/_static/image4.png)

<a id="serverdisconnect"></a>

### <a name="server-disconnection-scenarios"></a><span data-ttu-id="a9633-240">Scénarios de déconnexion du serveur</span><span class="sxs-lookup"><span data-stu-id="a9633-240">Server disconnection scenarios</span></span>

<span data-ttu-id="a9633-241">Lorsqu’un serveur est hors connexion -- il redémarre, échoue, le domaine de l’application recycle, etc. -- le résultat peut être similaire à une connexion perdue, `ConnectionSlow` ou l’API de transport et SignalR peuvent savoir immédiatement que le serveur est parti, et SignalR peut commencer à essayer de se reconnecter sans soulever l’événement.</span><span class="sxs-lookup"><span data-stu-id="a9633-241">When a server goes offline -- it reboots, fails, the app domain recycles, etc. -- the result might be similar to a lost connection, or the transport API and SignalR might know immediately that the server is gone, and SignalR might begin trying to reconnect without raising the `ConnectionSlow` event.</span></span> <span data-ttu-id="a9633-242">Si le client passe en mode de reconnexion, et si le serveur récupère ou redémarre ou si un nouveau serveur est mis en ligne avant l’expiration de la période de délai de déconnexion, le client se reconnectera au serveur restauré ou nouveau.</span><span class="sxs-lookup"><span data-stu-id="a9633-242">If the client goes into reconnecting mode, and if the server recovers or restarts or a new server is brought online before the disconnect timeout period expires, the client will reconnect to the restored or new server.</span></span> <span data-ttu-id="a9633-243">Dans ce cas, la connexion SignalR `Reconnected` se poursuit sur le client et l’événement est soulevé.</span><span class="sxs-lookup"><span data-stu-id="a9633-243">In that case, the SignalR connection continues on the client and the `Reconnected` event is raised.</span></span> <span data-ttu-id="a9633-244">Sur le premier `OnDisconnected` serveur, n’est jamais exécuté, et sur le nouveau serveur, `OnReconnected` est exécuté, mais n’a `OnConnected` jamais été exécuté pour ce client sur ce serveur avant.</span><span class="sxs-lookup"><span data-stu-id="a9633-244">On the first server, `OnDisconnected` is never executed, and on the new server, `OnReconnected` is executed although `OnConnected` was never executed for that client on that server before.</span></span> <span data-ttu-id="a9633-245">(L’effet est le même si le client se reconnecte au même serveur après un redémarrage ou un recyclage de domaine d’application, parce que lorsque le serveur redémarre, il n’a aucun souvenir de l’activité de connexion antérieure.) Le diagramme suivant suppose que l’API de transport prend `ConnectionSlow` connaissance immédiatement de la connexion perdue, de sorte que l’événement n’est pas soulevé.</span><span class="sxs-lookup"><span data-stu-id="a9633-245">(The effect is the same if the client reconnects to the same server after a reboot or app domain recycle, because when the server restarts it has no memory of prior connection activity.) The following diagram assumes that the transport API becomes aware of the lost connection immediately, so the `ConnectionSlow` event is not raised.</span></span>

![Défaillance du serveur et reconnexion](handling-connection-lifetime-events/_static/image5.png)

<span data-ttu-id="a9633-247">Si un serveur n’est pas disponible dans la période de décalage, la connexion SignalR se termine.</span><span class="sxs-lookup"><span data-stu-id="a9633-247">If a server does not become available within the disconnect timeout period, the SignalR connection ends.</span></span> <span data-ttu-id="a9633-248">Dans ce scénario,`disconnected` l’événement (dans les `Closed` clients `OnDisconnected` JavaScript) est soulevé sur le client, mais n’est jamais appelé sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="a9633-248">In this scenario, the `Closed` event (`disconnected` in JavaScript clients) is raised on the client but `OnDisconnected` is never called on the server.</span></span> <span data-ttu-id="a9633-249">Le diagramme suivant suppose que l’API de transport ne prend pas conscience de la connexion perdue, de sorte qu’il est détecté par La fonctionnalité de maintien signalR et l’événement `ConnectionSlow` est soulevé.</span><span class="sxs-lookup"><span data-stu-id="a9633-249">The following diagram assumes that the transport API does not become aware of the lost connection, so it is detected by SignalR keepalive functionality and the `ConnectionSlow` event is raised.</span></span>

![Défaillance du serveur et délai d’attente](handling-connection-lifetime-events/_static/image6.png)

<a id="timeoutkeepalive"></a>

## <a name="timeout-and-keepalive-settings"></a><span data-ttu-id="a9633-251">Temps d’arrêt et paramètres keepalive</span><span class="sxs-lookup"><span data-stu-id="a9633-251">Timeout and keepalive settings</span></span>

<span data-ttu-id="a9633-252">Le `ConnectionTimeout`défaut `DisconnectTimeout`, `KeepAlive` , et les valeurs sont appropriées pour la plupart des scénarios, mais peuvent être modifiés si votre environnement a des besoins spéciaux.</span><span class="sxs-lookup"><span data-stu-id="a9633-252">The default `ConnectionTimeout`, `DisconnectTimeout`, and `KeepAlive` values are appropriate for most scenarios but can be changed if your environment has special needs.</span></span> <span data-ttu-id="a9633-253">Par exemple, si votre environnement réseau ferme les connexions qui sont inactives pendant 5 secondes, vous devrez peut-être diminuer la valeur continue.</span><span class="sxs-lookup"><span data-stu-id="a9633-253">For example, if your network environment closes connections that are idle for 5 seconds, you might have to decrease the keepalive value.</span></span>

<a id="connectiontimeout"></a>

### <a name="connectiontimeout"></a><span data-ttu-id="a9633-254">ConnectionTimeout</span><span class="sxs-lookup"><span data-stu-id="a9633-254">ConnectionTimeout</span></span>

<span data-ttu-id="a9633-255">Ce paramètre représente le temps de laisser une connexion de transport ouverte et d’attendre une réponse avant de la fermer et d’ouvrir une nouvelle connexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-255">This setting represents the amount of time to leave a transport connection open and waiting for a response before closing it and opening a new connection.</span></span> <span data-ttu-id="a9633-256">La valeur par défaut est de 110 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-256">The default value is 110 seconds.</span></span>

<span data-ttu-id="a9633-257">Ce paramètre ne s’applique que lorsque la fonctionnalité de maintien est désactivée, qui ne s’applique normalement qu’au long transport de vote.</span><span class="sxs-lookup"><span data-stu-id="a9633-257">This setting applies only when keepalive functionality is disabled, which normally applies only to the long polling transport.</span></span> <span data-ttu-id="a9633-258">Le diagramme suivant illustre l’effet de ce paramètre sur une longue connexion de transport de scrutin.</span><span class="sxs-lookup"><span data-stu-id="a9633-258">The following diagram illustrates the effect of this setting on a long polling transport connection.</span></span>

![Longue connexion de transport de sondage](handling-connection-lifetime-events/_static/image7.png)

<a id="disconnecttimeout"></a>

### <a name="disconnecttimeout"></a><span data-ttu-id="a9633-260">DisconnectTimeout (en)</span><span class="sxs-lookup"><span data-stu-id="a9633-260">DisconnectTimeout</span></span>

<span data-ttu-id="a9633-261">Ce paramètre représente le temps d’attente après la `Disconnected` perte d’une connexion de transport avant de soulever l’événement.</span><span class="sxs-lookup"><span data-stu-id="a9633-261">This setting represents the amount of time to wait after a transport connection is lost before raising the `Disconnected` event.</span></span> <span data-ttu-id="a9633-262">La valeur par défaut est de 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-262">The default value is 30 seconds.</span></span> <span data-ttu-id="a9633-263">Lorsque vous `DisconnectTimeout` `KeepAlive` définissez, est automatiquement réglé à `DisconnectTimeout` 1/3 de la valeur.</span><span class="sxs-lookup"><span data-stu-id="a9633-263">When you set `DisconnectTimeout`, `KeepAlive` is automatically set to 1/3 of the `DisconnectTimeout` value.</span></span>

<a id="keepalive"></a>

### <a name="keepalive"></a><span data-ttu-id="a9633-264">KeepAlive</span><span class="sxs-lookup"><span data-stu-id="a9633-264">KeepAlive</span></span>

<span data-ttu-id="a9633-265">Ce paramètre représente le temps d’attente avant d’envoyer un paquet de keepalive sur une connexion au ralenti.</span><span class="sxs-lookup"><span data-stu-id="a9633-265">This setting represents the amount of time to wait before sending a keepalive packet over an idle connection.</span></span> <span data-ttu-id="a9633-266">La valeur par défaut est 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="a9633-266">The default value is 10 seconds.</span></span> <span data-ttu-id="a9633-267">Cette valeur ne doit pas dépasser 1/3 de la `DisconnectTimeout` valeur.</span><span class="sxs-lookup"><span data-stu-id="a9633-267">This value must not be more than 1/3 of the `DisconnectTimeout` value.</span></span>

<span data-ttu-id="a9633-268">Si vous voulez `DisconnectTimeout` définir `KeepAlive`les `KeepAlive` `DisconnectTimeout`deux et , ensemble après .</span><span class="sxs-lookup"><span data-stu-id="a9633-268">If you want to set both `DisconnectTimeout` and `KeepAlive`, set `KeepAlive` after `DisconnectTimeout`.</span></span> <span data-ttu-id="a9633-269">Sinon, `KeepAlive` votre paramètre `DisconnectTimeout` sera `KeepAlive` écrasé lorsque vous définissez automatiquement à 1/3 de la valeur de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="a9633-269">Otherwise your `KeepAlive` setting will be overwritten when `DisconnectTimeout` automatically sets `KeepAlive` to 1/3 of the timeout value.</span></span>

<span data-ttu-id="a9633-270">Si vous souhaitez désactiver la fonctionnalité de `KeepAlive` keepalive, définissez-vous à nul.</span><span class="sxs-lookup"><span data-stu-id="a9633-270">If you want to disable keepalive functionality, set `KeepAlive` to null.</span></span> <span data-ttu-id="a9633-271">La fonctionnalité keepalive est automatiquement désactivée pour le long transport de bureaux de vote.</span><span class="sxs-lookup"><span data-stu-id="a9633-271">Keepalive functionality is automatically disabled for the long polling transport.</span></span>

<a id="changetimeout"></a>

### <a name="how-to-change-timeout-and-keepalive-settings"></a><span data-ttu-id="a9633-272">Comment modifier le délai d’attente et les paramètres keepalive</span><span class="sxs-lookup"><span data-stu-id="a9633-272">How to change timeout and keepalive settings</span></span>

<span data-ttu-id="a9633-273">Pour modifier les valeurs par défaut `Application_Start` de ces paramètres, définissez-les dans votre fichier *Global.asax,* comme indiqué dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="a9633-273">To change the default values for these settings, set them in `Application_Start` in your *Global.asax* file, as shown in the following example.</span></span> <span data-ttu-id="a9633-274">Les valeurs indiquées dans le code de l’échantillon sont les mêmes que les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="a9633-274">The values shown in the sample code are the same as the default values.</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample1.cs)]

<a id="notifydisconnect"></a>

## <a name="how-to-notify-the-user-about-disconnections"></a><span data-ttu-id="a9633-275">Comment informer l’utilisateur des déconnexions</span><span class="sxs-lookup"><span data-stu-id="a9633-275">How to notify the user about disconnections</span></span>

<span data-ttu-id="a9633-276">Dans certaines applications, vous pouvez afficher un message à l’utilisateur en cas de problèmes de connectivité.</span><span class="sxs-lookup"><span data-stu-id="a9633-276">In some applications you might want to display a message to the user when there are connectivity problems.</span></span> <span data-ttu-id="a9633-277">Vous avez plusieurs options pour savoir comment et quand le faire.</span><span class="sxs-lookup"><span data-stu-id="a9633-277">You have several options for how and when to do this.</span></span> <span data-ttu-id="a9633-278">Les échantillons de code suivants sont pour un client JavaScript en utilisant le proxy généré.</span><span class="sxs-lookup"><span data-stu-id="a9633-278">The following code samples are for a JavaScript client using the generated proxy.</span></span>

- <span data-ttu-id="a9633-279">Gérez `connectionSlow` l’événement pour afficher un message dès que SignalR est conscient des problèmes de connexion, avant qu’il ne passe en mode de reconnexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-279">Handle the `connectionSlow` event to display a message as soon as SignalR is aware of connection problems, before it goes into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample2.js)]
- <span data-ttu-id="a9633-280">Gérez `reconnecting` l’événement pour afficher un message lorsque SignalR est au courant d’une déconnexion et passe en mode de reconnexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-280">Handle the `reconnecting` event to display a message when SignalR is aware of a disconnection and is going into reconnecting mode.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample3.js)]
- <span data-ttu-id="a9633-281">Gérez `disconnected` l’événement pour afficher un message lorsqu’une tentative de reconnexion s’est évanouie. Dans ce scénario, la seule façon de rétablir une connexion avec le serveur `Start` est de redémarrer la connexion SignalR en appelant la méthode, qui créera un nouvel ID de connexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-281">Handle the `disconnected` event to display a message when an attempt to reconnect has timed out. In this scenario, the only way to re-establish a connection with the server again is to restart the SignalR connection by calling the `Start` method, which will create a new connection ID.</span></span> <span data-ttu-id="a9633-282">L’exemple de code suivant utilise un drapeau pour s’assurer que vous n’émetssez la notification qu’après un délai de reconnexion, et non après une fin normale de la connexion SignalR causée par l’appel de la `Stop` méthode.</span><span class="sxs-lookup"><span data-stu-id="a9633-282">The following code sample uses a flag to make sure that you issue the notification only after a reconnecting timeout, not after a normal end to the SignalR connection caused by calling the `Stop` method.</span></span>

    [!code-javascript[Main](handling-connection-lifetime-events/samples/sample4.js)]

<a id="continuousreconnect"></a>

## <a name="how-to-continuously-reconnect"></a><span data-ttu-id="a9633-283">Comment se reconnecter en permanence</span><span class="sxs-lookup"><span data-stu-id="a9633-283">How to continuously reconnect</span></span>

<span data-ttu-id="a9633-284">Dans certaines applications, vous pouvez automatiquement rétablir une connexion après qu’elle a été perdue et que la tentative de reconnexion a été chronométrée. Pour ce faire, vous `Start` pouvez `Closed` appeler la`disconnected` méthode de votre gestionnaire d’événements (gestionnaire d’événements sur les clients JavaScript).</span><span class="sxs-lookup"><span data-stu-id="a9633-284">In some applications you might want to automatically re-establish a connection after it has been lost and the attempt to reconnect has timed out. To do that, you can call the `Start` method from your `Closed` event handler (`disconnected` event handler on JavaScript clients).</span></span> <span data-ttu-id="a9633-285">Vous pouvez attendre un certain temps `Start` avant d’appeler afin d’éviter de le faire trop fréquemment lorsque le serveur ou la connexion physique ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="a9633-285">You might want to wait a period of time before calling `Start` in order to avoid doing this too frequently when the server or the physical connection are unavailable.</span></span> <span data-ttu-id="a9633-286">L’échantillon de code suivant s’adresse à un client JavaScript utilisant le proxy généré.</span><span class="sxs-lookup"><span data-stu-id="a9633-286">The following code sample is for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample5.js)]

<span data-ttu-id="a9633-287">Un problème potentiel à connaître chez les clients mobiles est que les tentatives de reconnexion continue lorsque le serveur ou la connexion physique n’est pas disponible pourrait causer une vidange inutile de la batterie.</span><span class="sxs-lookup"><span data-stu-id="a9633-287">A potential problem to be aware of in mobile clients is that continuous reconnection attempts when the server or physical connection isn't available could cause unnecessary battery drain.</span></span>

<a id="disconnectclientfromserver"></a>

## <a name="how-to-disconnect-a-client-in-server-code"></a><span data-ttu-id="a9633-288">Comment déconnecter un client dans le code serveur</span><span class="sxs-lookup"><span data-stu-id="a9633-288">How to disconnect a client in server code</span></span>

<span data-ttu-id="a9633-289">SignalR version 2 ne dispose pas d’une API serveur intégré pour déconnecter les clients.</span><span class="sxs-lookup"><span data-stu-id="a9633-289">SignalR version 2 does not have a built-in server API for disconnecting clients.</span></span> <span data-ttu-id="a9633-290">Il est [prévu d’ajouter cette fonctionnalité à l’avenir](https://github.com/SignalR/SignalR/issues/2101).</span><span class="sxs-lookup"><span data-stu-id="a9633-290">There are [plans for adding this functionality in the future](https://github.com/SignalR/SignalR/issues/2101).</span></span> <span data-ttu-id="a9633-291">Dans la version SignalR actuelle, la façon la plus simple de déconnecter un client du serveur est d’implémenter une méthode de déconnexion sur le client et d’appeler cette méthode à partir du serveur.</span><span class="sxs-lookup"><span data-stu-id="a9633-291">In the current SignalR release, the simplest way to disconnect a client from the server is to implement a disconnect method on the client and call that method from the server.</span></span> <span data-ttu-id="a9633-292">L’échantillon de code suivant montre une méthode de déconnexion pour un client JavaScript utilisant le proxy généré.</span><span class="sxs-lookup"><span data-stu-id="a9633-292">The following code sample shows a disconnect method for a JavaScript client using the generated proxy.</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample6.js)]

> [!WARNING]
> <span data-ttu-id="a9633-293">Sécurité - Ni cette méthode de déconnectement des clients, ni l’API intégrée proposée ne traitera du scénario des clients `stopClient` piratés qui exécutent du code malveillant, puisque les clients pourraient se reconnecter ou le code piraté pourrait supprimer la méthode ou changer ce qu’il fait.</span><span class="sxs-lookup"><span data-stu-id="a9633-293">Security - Neither this method for disconnecting clients nor the proposed built-in API will address the scenario of hacked clients that are running malicious code, since the clients could reconnect or the hacked code might remove the `stopClient` method or change what it does.</span></span> <span data-ttu-id="a9633-294">L’endroit approprié pour mettre en œuvre la protection par déni de service (DOS) état n’est pas dans le cadre ou la couche du serveur, mais plutôt dans l’infrastructure frontale.</span><span class="sxs-lookup"><span data-stu-id="a9633-294">The appropriate place to implement stateful denial-of-service (DOS) protection is not in the framework or the server layer, but rather in front-end infrastructure.</span></span>

<a id="detectingreasonfordisconnection"></a>
## <a name="detecting-the-reason-for-a-disconnection"></a><span data-ttu-id="a9633-295">Détecter la raison d’une déconnexion</span><span class="sxs-lookup"><span data-stu-id="a9633-295">Detecting the reason for a disconnection</span></span>

<span data-ttu-id="a9633-296">SignalR 2.1 ajoute une surcharge `OnDisconnect` à l’événement serveur qui indique si le client s’est délibérément déconnecté plutôt que de le chronométrer. Le `StopCalled` paramètre est vrai si le client a explicitement fermé la connexion.</span><span class="sxs-lookup"><span data-stu-id="a9633-296">SignalR 2.1 adds an overload to the server `OnDisconnect` event that indicates if the client deliberately disconnected rather than timing out. The `StopCalled` parameter is true if the client explicitly closed the connection.</span></span> <span data-ttu-id="a9633-297">Dans JavaScript, si une erreur de serveur a conduit le client `$.connection.hub.lastError`à se déconnecter, les informations d’erreur seront transmises au client comme .</span><span class="sxs-lookup"><span data-stu-id="a9633-297">In JavaScript, if a server error led the client to disconnect, the error information will be passed to the client as `$.connection.hub.lastError`.</span></span>

<span data-ttu-id="a9633-298">**Code serveur C `stopCalled` : paramètre**</span><span class="sxs-lookup"><span data-stu-id="a9633-298">**C# server code: `stopCalled` parameter**</span></span>

[!code-csharp[Main](handling-connection-lifetime-events/samples/sample7.cs?highlight=1,3)]

<span data-ttu-id="a9633-299">**Code client JavaScript `lastError` : `disconnect` accès à l’événement.**</span><span class="sxs-lookup"><span data-stu-id="a9633-299">**JavaScript client code: accessing `lastError` in the `disconnect` event.**</span></span>

[!code-javascript[Main](handling-connection-lifetime-events/samples/sample8.js?highlight=2-3)]
