---
uid: web-pages/overview/data/5-working-with-data
title: Présentation de l’utilisation d’une base de données dans des sites pages Web ASP.NET (Razor) | Microsoft Docs
author: Rick-Anderson
description: Ce chapitre décrit comment accéder aux données d’une base de données et les afficher à l’aide de pages Web ASP.NET.
ms.author: riande
ms.date: 02/18/2014
ms.assetid: 673d502f-2c16-4a6f-bb63-dbfd9a77ef47
msc.legacyurl: /web-pages/overview/data/5-working-with-data
msc.type: authoredcontent
ms.openlocfilehash: 45e988d037465e59ad352bb9444af2c69fd3cd70
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78586533"
---
# <a name="introduction-to-working-with-a-database-in-aspnet-web-pages-razor-sites"></a><span data-ttu-id="eaef1-103">Présentation de l’utilisation d’une base de données dans des sites pages Web ASP.NET (Razor)</span><span class="sxs-lookup"><span data-stu-id="eaef1-103">Introduction to Working with a Database in ASP.NET Web Pages (Razor) Sites</span></span>

<span data-ttu-id="eaef1-104">par [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="eaef1-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="eaef1-105">Cet article explique comment utiliser les outils Microsoft WebMatrix pour créer une base de données dans un site Web pages Web ASP.NET (Razor) et comment créer des pages qui vous permettent d’afficher, d’ajouter, de modifier et de supprimer des données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-105">This article describes how to use Microsoft WebMatrix tools to create a database in an ASP.NET Web Pages (Razor) website, and how to create pages that let you display, add, edit, and delete data.</span></span>
> 
> <span data-ttu-id="eaef1-106">**Ce que vous allez apprendre :**</span><span class="sxs-lookup"><span data-stu-id="eaef1-106">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="eaef1-107">Comment créer une base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-107">How to create a database.</span></span>
> - <span data-ttu-id="eaef1-108">Comment se connecter à une base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-108">How to connect to a database.</span></span>
> - <span data-ttu-id="eaef1-109">Comment afficher des données dans une page Web.</span><span class="sxs-lookup"><span data-stu-id="eaef1-109">How to display data in a web page.</span></span>
> - <span data-ttu-id="eaef1-110">Comment insérer, mettre à jour et supprimer des enregistrements de base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-110">How to insert, update, and delete database records.</span></span>
> 
> <span data-ttu-id="eaef1-111">Les fonctionnalités présentées dans l’article sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="eaef1-111">These are the features introduced in the article:</span></span>
> 
> - <span data-ttu-id="eaef1-112">Utilisation d’une base de données Microsoft SQL Server Compact Edition.</span><span class="sxs-lookup"><span data-stu-id="eaef1-112">Working with a Microsoft SQL Server Compact Edition database.</span></span>
> - <span data-ttu-id="eaef1-113">Utilisation de requêtes SQL.</span><span class="sxs-lookup"><span data-stu-id="eaef1-113">Working with SQL queries.</span></span>
> - <span data-ttu-id="eaef1-114">La classe `Database`.</span><span class="sxs-lookup"><span data-stu-id="eaef1-114">The `Database` class.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="eaef1-115">Versions logicielles utilisées dans le didacticiel</span><span class="sxs-lookup"><span data-stu-id="eaef1-115">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="eaef1-116">Pages Web ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="eaef1-116">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="eaef1-117">WebMatrix 2</span><span class="sxs-lookup"><span data-stu-id="eaef1-117">WebMatrix 2</span></span>
>   
> 
> <span data-ttu-id="eaef1-118">Ce didacticiel fonctionne également avec WebMatrix 3.</span><span class="sxs-lookup"><span data-stu-id="eaef1-118">This tutorial also works with WebMatrix 3.</span></span> <span data-ttu-id="eaef1-119">Vous pouvez utiliser pages Web ASP.NET 3 et Visual Studio 2013 (ou Visual Studio Express 2013 pour le Web); Toutefois, l’interface utilisateur sera différente.</span><span class="sxs-lookup"><span data-stu-id="eaef1-119">You can use ASP.NET Web Pages 3 and Visual Studio 2013 (or Visual Studio Express 2013 for Web); however, the user interface will be different.</span></span>

## <a name="introduction-to-databases"></a><span data-ttu-id="eaef1-120">Présentation des bases de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-120">Introduction to Databases</span></span>

<span data-ttu-id="eaef1-121">Imaginez un carnet d’adresses classique.</span><span class="sxs-lookup"><span data-stu-id="eaef1-121">Imagine a typical address book.</span></span> <span data-ttu-id="eaef1-122">Pour chaque entrée dans le carnet d’adresses (c’est-à-dire, pour chaque personne), vous avez plusieurs éléments d’information, tels que le prénom, le nom, l’adresse, l’adresse de messagerie et le numéro de téléphone.</span><span class="sxs-lookup"><span data-stu-id="eaef1-122">For each entry in the address book (that is, for each person) you have several pieces of information such as first name, last name, address, email address, and phone number.</span></span>

<span data-ttu-id="eaef1-123">Une façon classique d’imager des données comme celle-ci est une table avec des lignes et des colonnes.</span><span class="sxs-lookup"><span data-stu-id="eaef1-123">A typical way to picture data like this is as a table with rows and columns.</span></span> <span data-ttu-id="eaef1-124">En termes de base de données, chaque ligne est souvent appelée un enregistrement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-124">In database terms, each row is often referred to as a record.</span></span> <span data-ttu-id="eaef1-125">Chaque colonne (parfois appelée champs) contient une valeur pour chaque type de données : prénom, nom, etc.</span><span class="sxs-lookup"><span data-stu-id="eaef1-125">Each column (sometimes referred to as fields) contains a value for each type of data: first name, last name, and so on.</span></span>

| <span data-ttu-id="eaef1-126">**ID**</span><span class="sxs-lookup"><span data-stu-id="eaef1-126">**ID**</span></span> | <span data-ttu-id="eaef1-127">**FirstName**</span><span class="sxs-lookup"><span data-stu-id="eaef1-127">**FirstName**</span></span> | <span data-ttu-id="eaef1-128">**LastName**</span><span class="sxs-lookup"><span data-stu-id="eaef1-128">**LastName**</span></span> | <span data-ttu-id="eaef1-129">**Adresse**</span><span class="sxs-lookup"><span data-stu-id="eaef1-129">**Address**</span></span> | <span data-ttu-id="eaef1-130">**Courrier électronique**</span><span class="sxs-lookup"><span data-stu-id="eaef1-130">**Email**</span></span> | <span data-ttu-id="eaef1-131">**Téléphone**</span><span class="sxs-lookup"><span data-stu-id="eaef1-131">**Phone**</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="eaef1-132">1</span><span class="sxs-lookup"><span data-stu-id="eaef1-132">1</span></span> | <span data-ttu-id="eaef1-133">Jim</span><span class="sxs-lookup"><span data-stu-id="eaef1-133">Jim</span></span> | <span data-ttu-id="eaef1-134">Abrus</span><span class="sxs-lookup"><span data-stu-id="eaef1-134">Abrus</span></span> | <span data-ttu-id="eaef1-135">210 100 ème er SE Orcas WA 98031</span><span class="sxs-lookup"><span data-stu-id="eaef1-135">210 100th St SE Orcas WA 98031</span></span> | jim@contoso.com | <span data-ttu-id="eaef1-136">555 0100</span><span class="sxs-lookup"><span data-stu-id="eaef1-136">555 0100</span></span> |
| <span data-ttu-id="eaef1-137">2</span><span class="sxs-lookup"><span data-stu-id="eaef1-137">2</span></span> | <span data-ttu-id="eaef1-138">Terry</span><span class="sxs-lookup"><span data-stu-id="eaef1-138">Terry</span></span> | <span data-ttu-id="eaef1-139">Beaune</span><span class="sxs-lookup"><span data-stu-id="eaef1-139">Adams</span></span> | <span data-ttu-id="eaef1-140">1234 Main St. Seattle WA 99011</span><span class="sxs-lookup"><span data-stu-id="eaef1-140">1234 Main St. Seattle WA 99011</span></span> | terry@cohowinery.com | <span data-ttu-id="eaef1-141">555 0101</span><span class="sxs-lookup"><span data-stu-id="eaef1-141">555 0101</span></span> |

<span data-ttu-id="eaef1-142">Pour la plupart des tables de base de données, la table doit contenir une colonne qui contient un identificateur unique, tel qu’un numéro de client, un numéro de compte, etc. C’est ce que l’on appelle la *clé primaire*de la table et vous l’utilisez pour identifier chaque ligne dans la table.</span><span class="sxs-lookup"><span data-stu-id="eaef1-142">For most database tables, the table has to have a column that contains a unique identifier, like a customer number, account number, etc. This is known as the table's *primary key*, and you use it to identify each row in the table.</span></span> <span data-ttu-id="eaef1-143">Dans l’exemple, la colonne ID est la clé primaire du carnet d’adresses.</span><span class="sxs-lookup"><span data-stu-id="eaef1-143">In the example, the ID column is the primary key for the address book.</span></span>

<span data-ttu-id="eaef1-144">Avec cette compréhension de base des bases de données, vous êtes prêt à apprendre à créer une base de données simple et à effectuer des opérations telles que l’ajout, la modification et la suppression de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-144">With this basic understanding of databases, you're ready to learn how to create a simple database and perform operations such as adding, modifying, and deleting data.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="eaef1-145">**Bases de données relationnelles**</span><span class="sxs-lookup"><span data-stu-id="eaef1-145">**Relational Databases**</span></span>
> 
> <span data-ttu-id="eaef1-146">Vous pouvez stocker des données de nombreuses façons, notamment des fichiers texte et des feuilles de calcul.</span><span class="sxs-lookup"><span data-stu-id="eaef1-146">You can store data in lots of ways, including text files and spreadsheets.</span></span> <span data-ttu-id="eaef1-147">Pour la plupart des utilisations commerciales, cependant, les données sont stockées dans une base de données relationnelle.</span><span class="sxs-lookup"><span data-stu-id="eaef1-147">For most business uses, though, data is stored in a relational database.</span></span>
> 
> <span data-ttu-id="eaef1-148">Cet article ne s’approfondit pas dans les bases de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-148">This article doesn't go very deeply into databases.</span></span> <span data-ttu-id="eaef1-149">Toutefois, il peut être utile d’en comprendre un peu plus.</span><span class="sxs-lookup"><span data-stu-id="eaef1-149">However, you might find it useful to understand a little about them.</span></span> <span data-ttu-id="eaef1-150">Dans une base de données relationnelle, les informations sont logiquement divisées en tables distinctes.</span><span class="sxs-lookup"><span data-stu-id="eaef1-150">In a relational database, information is logically divided into separate tables.</span></span> <span data-ttu-id="eaef1-151">Par exemple, une base de données pour une école peut contenir des tables distinctes pour les élèves et pour les offres de classe.</span><span class="sxs-lookup"><span data-stu-id="eaef1-151">For example, a database for a school might contain separate tables for students and for class offerings.</span></span> <span data-ttu-id="eaef1-152">Le logiciel de base de données (tel que SQL Server) prend en charge des commandes puissantes qui vous permettent d’établir dynamiquement des relations entre les tables.</span><span class="sxs-lookup"><span data-stu-id="eaef1-152">The database software (such as SQL Server) supports powerful commands that let you dynamically establish relationships between the tables.</span></span> <span data-ttu-id="eaef1-153">Par exemple, vous pouvez utiliser la base de données relationnelle pour établir une relation logique entre les élèves et les classes, afin de créer une planification.</span><span class="sxs-lookup"><span data-stu-id="eaef1-153">For example, you can use the relational database to establish a logical relationship between students and classes in order to create a schedule.</span></span> <span data-ttu-id="eaef1-154">Le stockage de données dans des tables distinctes réduit la complexité de la structure de la table et réduit la nécessité de conserver des données redondantes dans les tables.</span><span class="sxs-lookup"><span data-stu-id="eaef1-154">Storing data in separate tables reduces the complexity of the table structure and reduces the need to keep redundant data in tables.</span></span>

## <a name="creating-a-database"></a><span data-ttu-id="eaef1-155">Création d’une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-155">Creating a Database</span></span>

<span data-ttu-id="eaef1-156">Cette procédure vous montre comment créer une base de données nommée SmallBakery à l’aide de l’outil de conception de base de données SQL Server Compact inclus dans WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-156">This procedure shows you how to create a database named SmallBakery by using the SQL Server Compact Database design tool that's included in WebMatrix.</span></span> <span data-ttu-id="eaef1-157">Bien que vous puissiez créer une base de données à l’aide du code, il est plus courant de créer la base de données et les tables de base de données à l’aide d’un outil de conception comme WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-157">Although you can create a database using code, it's more typical to create the database and database tables using a design tool like WebMatrix.</span></span>

1. <span data-ttu-id="eaef1-158">Démarrez WebMatrix, puis dans la page Démarrage rapide, cliquez sur **site à partir d’un modèle**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-158">Start WebMatrix, and on the Quick Start page, click **Site From Template**.</span></span>
2. <span data-ttu-id="eaef1-159">Sélectionnez **site vide**, puis dans la zone **nom du site** , entrez « SmallBakery », puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-159">Select **Empty Site**, and in the **Site Name** box enter "SmallBakery" and then click **OK**.</span></span> <span data-ttu-id="eaef1-160">Le site est créé et affiché dans WebMatrix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-160">The site is created and displayed in WebMatrix.</span></span>
3. <span data-ttu-id="eaef1-161">Dans le volet gauche, cliquez sur l’espace **de travail bases de données** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-161">In the left pane, click the **Databases** workspace.</span></span>
4. <span data-ttu-id="eaef1-162">Dans le ruban, cliquez sur **nouvelle base de données**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-162">In the ribbon, click **New Database**.</span></span> <span data-ttu-id="eaef1-163">Une base de données vide est créée avec le même nom que votre site.</span><span class="sxs-lookup"><span data-stu-id="eaef1-163">An empty database is created with the same name as your site.</span></span>
5. <span data-ttu-id="eaef1-164">Dans le volet gauche, développez le nœud **SmallBakery. sdf** , puis cliquez sur **tables**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-164">In the left pane, expand the **SmallBakery.sdf** node and then click **Tables**.</span></span>
6. <span data-ttu-id="eaef1-165">Dans le ruban, cliquez sur **nouvelle table**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-165">In the ribbon, click **New Table**.</span></span> <span data-ttu-id="eaef1-166">WebMatrix ouvre le concepteur de tables.</span><span class="sxs-lookup"><span data-stu-id="eaef1-166">WebMatrix opens the table designer.</span></span>

    ![[image]](5-working-with-data/_static/image1.jpg)
7. <span data-ttu-id="eaef1-168">Cliquez dans la colonne **nom** et entrez &quot;ID&quot;.</span><span class="sxs-lookup"><span data-stu-id="eaef1-168">Click in the **Name** column and enter &quot;Id&quot;.</span></span>
8. <span data-ttu-id="eaef1-169">Dans la colonne **type de données** , sélectionnez **int**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-169">In the **Data Type** column, select **int**.</span></span>
9. <span data-ttu-id="eaef1-170">Définissez les options **est la clé primaire** et **est identifier ?** sur **Oui**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-170">Set the **Is Primary Key?** and **Is Identify?** options to **Yes**.</span></span>

    <span data-ttu-id="eaef1-171">Comme son nom l’indique, **est une clé primaire** qui indique à la base de données qu’il s’agit de la clé primaire de la table.</span><span class="sxs-lookup"><span data-stu-id="eaef1-171">As the name suggests, **Is Primary Key** tells the database that this will be the table's primary key.</span></span> <span data-ttu-id="eaef1-172">**Is Identity** indique à la base de données de créer automatiquement un numéro d’identification pour chaque nouvel enregistrement et de lui attribuer le numéro séquentiel suivant (à partir de 1).</span><span class="sxs-lookup"><span data-stu-id="eaef1-172">**Is Identity** tells the database to automatically create an ID number for every new record and to assign it the next sequential number (starting at 1).</span></span>
10. <span data-ttu-id="eaef1-173">Cliquez sur dans la ligne suivante.</span><span class="sxs-lookup"><span data-stu-id="eaef1-173">Click in the next row.</span></span> <span data-ttu-id="eaef1-174">L’éditeur démarre une nouvelle définition de colonne.</span><span class="sxs-lookup"><span data-stu-id="eaef1-174">The editor starts a new column definition.</span></span>
11. <span data-ttu-id="eaef1-175">Pour la valeur nom, entrez &quot;nom&quot;.</span><span class="sxs-lookup"><span data-stu-id="eaef1-175">For the Name value, enter &quot;Name&quot;.</span></span>
12. <span data-ttu-id="eaef1-176">Pour **type de données**, choisissez &quot;nvarchar&quot; et définissez la longueur sur 50.</span><span class="sxs-lookup"><span data-stu-id="eaef1-176">For **Data Type**, choose &quot;nvarchar&quot; and set the length to 50.</span></span> <span data-ttu-id="eaef1-177">La partie *var* de `nvarchar` indique à la base de données que les données de cette colonne seront une chaîne dont la taille peut varier d’un enregistrement à l’autre.</span><span class="sxs-lookup"><span data-stu-id="eaef1-177">The *var* part of `nvarchar` tells the database that the data for this column will be a string whose size might vary from record to record.</span></span> <span data-ttu-id="eaef1-178">(Le préfixe *n* représente *national*, ce qui indique que le champ peut contenir des données de type caractère représentant &#8212; n’importe quel ordre alphabétique ou système d’écriture qui est, que le champ contient des données Unicode.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-178">(The *n* prefix represents *national*, indicating that the field can hold character data that represents any alphabet or writing system &#8212; that is, that the field holds Unicode data.)</span></span>
13. <span data-ttu-id="eaef1-179">Affectez la valeur **non**à l’option **autoriser les valeurs NULL** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-179">Set the **Allow Nulls** option to **No**.</span></span> <span data-ttu-id="eaef1-180">Cela permet d’appliquer que la colonne *Name* n’est pas vide.</span><span class="sxs-lookup"><span data-stu-id="eaef1-180">This will enforce that the *Name* column is not left blank.</span></span>
14. <span data-ttu-id="eaef1-181">À l’aide de ce même processus, créez une colonne nommée *Description*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-181">Using this same process, create a column named *Description*.</span></span> <span data-ttu-id="eaef1-182">Définissez **type de données** sur « nvarchar » et 50 pour la longueur, et affectez à **autoriser les valeurs NULL** la valeur false.</span><span class="sxs-lookup"><span data-stu-id="eaef1-182">Set **Data Type** to "nvarchar" and 50 for the length, and set **Allow Nulls** to false.</span></span>
15. <span data-ttu-id="eaef1-183">Créez une colonne nommée *Price*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-183">Create a column named *Price*.</span></span> <span data-ttu-id="eaef1-184">Affectez **à type de données la valeur « Money »** et affectez à **autoriser les valeurs NULL** la valeur false.</span><span class="sxs-lookup"><span data-stu-id="eaef1-184">Set **Data Type to "money"** and set **Allow Nulls** to false.</span></span>
16. <span data-ttu-id="eaef1-185">Dans la zone située en haut, nommez la table &quot;&quot;produit.</span><span class="sxs-lookup"><span data-stu-id="eaef1-185">In the box at the top, name the table &quot;Product&quot;.</span></span>

    <span data-ttu-id="eaef1-186">Lorsque vous avez terminé, la définition se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-186">When you're done, the definition will look like this:</span></span>

    ![[image]](5-working-with-data/_static/image2.png)
17. <span data-ttu-id="eaef1-188">Appuyez sur CTRL + S pour enregistrer la table.</span><span class="sxs-lookup"><span data-stu-id="eaef1-188">Press Ctrl+S to save the table.</span></span>

## <a name="adding-data-to-the-database"></a><span data-ttu-id="eaef1-189">Ajout de données à la base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-189">Adding Data to the Database</span></span>

<span data-ttu-id="eaef1-190">Vous pouvez maintenant ajouter des exemples de données à votre base de données que vous utiliserez plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="eaef1-190">Now you can add some sample data to your database that you'll work with later in the article.</span></span>

1. <span data-ttu-id="eaef1-191">Dans le volet gauche, développez le nœud **SmallBakery. sdf** , puis cliquez sur **tables**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-191">In the left pane, expand the **SmallBakery.sdf** node and then click **Tables**.</span></span>
2. <span data-ttu-id="eaef1-192">Cliquez avec le bouton droit sur la table Product, puis cliquez sur **données**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-192">Right-click the Product table and then click **Data**.</span></span>
3. <span data-ttu-id="eaef1-193">Dans le volet d’édition, entrez les enregistrements suivants :</span><span class="sxs-lookup"><span data-stu-id="eaef1-193">In the edit pane, enter the following records:</span></span>

    | <span data-ttu-id="eaef1-194">**Name**</span><span class="sxs-lookup"><span data-stu-id="eaef1-194">**Name**</span></span> | <span data-ttu-id="eaef1-195">**Description**</span><span class="sxs-lookup"><span data-stu-id="eaef1-195">**Description**</span></span> | <span data-ttu-id="eaef1-196">**Compétitif**</span><span class="sxs-lookup"><span data-stu-id="eaef1-196">**Price**</span></span> |
    | --- | --- | --- |
    | <span data-ttu-id="eaef1-197">Pain</span><span class="sxs-lookup"><span data-stu-id="eaef1-197">Bread</span></span> | <span data-ttu-id="eaef1-198">Cuit à nouveau tous les jours.</span><span class="sxs-lookup"><span data-stu-id="eaef1-198">Baked fresh every day.</span></span> | <span data-ttu-id="eaef1-199">2.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-199">2.99</span></span> |
    | <span data-ttu-id="eaef1-200">Frais Shortcake</span><span class="sxs-lookup"><span data-stu-id="eaef1-200">Strawberry Shortcake</span></span> | <span data-ttu-id="eaef1-201">Créé avec des frais organiques de notre jardin.</span><span class="sxs-lookup"><span data-stu-id="eaef1-201">Made with organic strawberries from our garden.</span></span> | <span data-ttu-id="eaef1-202">9.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-202">9.99</span></span> |
    | <span data-ttu-id="eaef1-203">Secteurs Apple</span><span class="sxs-lookup"><span data-stu-id="eaef1-203">Apple Pie</span></span> | <span data-ttu-id="eaef1-204">Deuxièmement uniquement dans le secteur de votre MOM.</span><span class="sxs-lookup"><span data-stu-id="eaef1-204">Second only to your mom's pie.</span></span> | <span data-ttu-id="eaef1-205">12.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-205">12.99</span></span> |
    | <span data-ttu-id="eaef1-206">Pecan secteurs</span><span class="sxs-lookup"><span data-stu-id="eaef1-206">Pecan Pie</span></span> | <span data-ttu-id="eaef1-207">Si vous aimez pecans, c’est pour vous.</span><span class="sxs-lookup"><span data-stu-id="eaef1-207">If you like pecans, this is for you.</span></span> | <span data-ttu-id="eaef1-208">10.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-208">10.99</span></span> |
    | <span data-ttu-id="eaef1-209">Camembert citron</span><span class="sxs-lookup"><span data-stu-id="eaef1-209">Lemon Pie</span></span> | <span data-ttu-id="eaef1-210">Créé avec les meilleurs citrons dans le monde.</span><span class="sxs-lookup"><span data-stu-id="eaef1-210">Made with the best lemons in the world.</span></span> | <span data-ttu-id="eaef1-211">11.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-211">11.99</span></span> |
    | <span data-ttu-id="eaef1-212">Petits gâteaux</span><span class="sxs-lookup"><span data-stu-id="eaef1-212">Cupcakes</span></span> | <span data-ttu-id="eaef1-213">Vos enfants et l’enfant de vous les apprécieront.</span><span class="sxs-lookup"><span data-stu-id="eaef1-213">Your kids and the kid in you will love these.</span></span> | <span data-ttu-id="eaef1-214">7.99</span><span class="sxs-lookup"><span data-stu-id="eaef1-214">7.99</span></span> |

    <span data-ttu-id="eaef1-215">N’oubliez pas que vous n’avez rien à saisir pour la colonne *ID* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-215">Remember that you don't have to enter anything for the *Id* column.</span></span> <span data-ttu-id="eaef1-216">Lorsque vous avez créé la colonne *ID* , vous affectez à sa propriété **is Identity** la valeur true, ce qui entraîne son remplissage automatique.</span><span class="sxs-lookup"><span data-stu-id="eaef1-216">When you created the *Id* column, you set its **Is Identity** property to true, which causes it to automatically be filled in.</span></span>

    <span data-ttu-id="eaef1-217">Lorsque vous avez terminé d’entrer les données, le concepteur de tables se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-217">When you're finished entering the data, the table designer will look like this:</span></span>

    ![[image]](5-working-with-data/_static/image3.jpg)
4. <span data-ttu-id="eaef1-219">Fermez l’onglet qui contient les données de la base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-219">Close the tab that contains the database data.</span></span>

## <a name="displaying-data-from-a-database"></a><span data-ttu-id="eaef1-220">Affichage de données à partir d’une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-220">Displaying Data from a Database</span></span>

<span data-ttu-id="eaef1-221">Une fois que vous disposez d’une base de données contenant des données, vous pouvez afficher les données dans une page Web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="eaef1-221">Once you've got a database with data in it, you can display the data in an ASP.NET web page.</span></span> <span data-ttu-id="eaef1-222">Pour sélectionner les lignes de table à afficher, vous utilisez une instruction SQL, qui est une commande que vous transmettez à la base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-222">To select the table rows to display, you use a SQL statement, which is a command that you pass to the database.</span></span>

1. <span data-ttu-id="eaef1-223">Dans le volet gauche, cliquez sur l’espace de travail **fichiers** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-223">In the left pane, click the **Files** workspace.</span></span>
2. <span data-ttu-id="eaef1-224">À la racine du site Web, créez une nouvelle page CSHTML nommée *ListProducts. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-224">In the root of the website, create a new CSHTML page named *ListProducts.cshtml*.</span></span>
3. <span data-ttu-id="eaef1-225">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="eaef1-225">Replace the existing markup with the following:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample1.cshtml)]

    <span data-ttu-id="eaef1-226">Dans le premier bloc de code, vous ouvrez le fichier *SmallBakery. sdf* (base de données) que vous avez créé précédemment.</span><span class="sxs-lookup"><span data-stu-id="eaef1-226">In the first code block, you open the *SmallBakery.sdf* file (database) that you created earlier.</span></span> <span data-ttu-id="eaef1-227">La méthode `Database.Open` suppose que le fichier *. sdf* se trouve dans le dossier de *données de l’application\_* de votre site Web.</span><span class="sxs-lookup"><span data-stu-id="eaef1-227">The `Database.Open` method assumes that the *.sdf* file is in your website's *App\_Data* folder.</span></span> <span data-ttu-id="eaef1-228">(Notez que vous n’avez pas besoin de spécifier l’extension &#8212; *. sdf* en fait, si vous le faites, la méthode `Open` ne fonctionnera pas.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-228">(Notice that you don't need to specify the *.sdf* extension &#8212; in fact, if you do, the `Open` method won't work.)</span></span>

    > [!NOTE]
    > <span data-ttu-id="eaef1-229">Le dossier *application\_Data* est un dossier spécial dans ASP.net qui est utilisé pour stocker les fichiers de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-229">The *App\_Data* folder is a special folder in ASP.NET that's used to store data files.</span></span> <span data-ttu-id="eaef1-230">Pour plus d’informations, consultez [connexion à une base de données](#SB_ConnectingToADatabase) plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="eaef1-230">For more information, see [Connecting to a Database](#SB_ConnectingToADatabase) later in this article.</span></span>

    <span data-ttu-id="eaef1-231">Vous effectuez ensuite une requête pour interroger la base de données à l’aide de l’instruction SQL `Select` suivante :</span><span class="sxs-lookup"><span data-stu-id="eaef1-231">You then make a request to query the database using the following SQL `Select` statement:</span></span>

    [!code-sql[Main](5-working-with-data/samples/sample2.sql)]

    <span data-ttu-id="eaef1-232">Dans l’instruction, `Product` identifie la table à interroger.</span><span class="sxs-lookup"><span data-stu-id="eaef1-232">In the statement, `Product` identifies the table to query.</span></span> <span data-ttu-id="eaef1-233">Le caractère `*` spécifie que la requête doit retourner toutes les colonnes de la table.</span><span class="sxs-lookup"><span data-stu-id="eaef1-233">The `*` character specifies that the query should return all the columns from the table.</span></span> <span data-ttu-id="eaef1-234">(Vous pouvez également répertorier les colonnes individuellement, séparées par des virgules, si vous souhaitez afficher uniquement certaines colonnes.) La clause `Order By` indique la manière dont les données doivent &#8212; être triées dans ce cas, par la colonne *nom* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-234">(You could also list columns individually, separated by commas, if you wanted to see only some of the columns.) The `Order By` clause indicates how the data should be sorted &#8212; in this case, by the *Name* column.</span></span> <span data-ttu-id="eaef1-235">Cela signifie que les données sont triées par ordre alphabétique en fonction de la valeur de la colonne *Name* pour chaque ligne.</span><span class="sxs-lookup"><span data-stu-id="eaef1-235">This means that the data is sorted alphabetically based on the value of the *Name* column for each row.</span></span>

    <span data-ttu-id="eaef1-236">Dans le corps de la page, le balisage crée un tableau HTML qui sera utilisé pour afficher les données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-236">In the body of the page, the markup creates an HTML table that will be used to display the data.</span></span> <span data-ttu-id="eaef1-237">À l’intérieur de l’élément `<tbody>`, vous utilisez une boucle `foreach` pour obtenir individuellement chaque ligne de données retournée par la requête.</span><span class="sxs-lookup"><span data-stu-id="eaef1-237">Inside the `<tbody>` element, you use a `foreach` loop to individually get each data row that's returned by the query.</span></span> <span data-ttu-id="eaef1-238">Pour chaque ligne de données, vous créez une ligne de tableau HTML (élément`<tr>`).</span><span class="sxs-lookup"><span data-stu-id="eaef1-238">For each data row, you create an HTML table row (`<tr>` element).</span></span> <span data-ttu-id="eaef1-239">Ensuite, vous créez des cellules de tableau HTML (éléments`<td>`) pour chaque colonne.</span><span class="sxs-lookup"><span data-stu-id="eaef1-239">Then you create HTML table cells (`<td>` elements) for each column.</span></span> <span data-ttu-id="eaef1-240">Chaque fois que vous parcourez la boucle, la ligne suivante disponible dans la base de données se trouve dans la variable `row` (vous la configurez dans l’instruction `foreach`).</span><span class="sxs-lookup"><span data-stu-id="eaef1-240">Each time you go through the loop, the next available row from the database is in the `row` variable (you set this up in the `foreach` statement).</span></span> <span data-ttu-id="eaef1-241">Pour obtenir une colonne individuelle à partir de la ligne, vous pouvez utiliser `row.Name` ou `row.Description` ou n’importe quel nom de la colonne de votre choix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-241">To get an individual column from the row, you can use `row.Name` or `row.Description` or whatever the name is of the column you want.</span></span>
4. <span data-ttu-id="eaef1-242">Exécutez la page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-242">Run the page in a browser.</span></span> <span data-ttu-id="eaef1-243">(Assurez-vous que la page est sélectionnée dans l’espace de travail **fichiers** avant de l’exécuter.) La page affiche une liste semblable à la suivante :</span><span class="sxs-lookup"><span data-stu-id="eaef1-243">(Make sure the page is selected in the **Files** workspace before you run it.) The page displays a list like the following:</span></span>

    ![[image]](5-working-with-data/_static/image4.jpg)

> [!TIP] 
> 
> <span data-ttu-id="eaef1-245">**SQL (Structured Query Language)**</span><span class="sxs-lookup"><span data-stu-id="eaef1-245">**Structured Query Language (SQL)**</span></span>
> 
> <span data-ttu-id="eaef1-246">SQL est un langage utilisé dans la plupart des bases de données relationnelles pour la gestion des données dans une base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-246">SQL is a language that's used in most relational databases for managing data in a database.</span></span> <span data-ttu-id="eaef1-247">Il comprend des commandes qui vous permettent de récupérer des données et de les mettre à jour, et qui vous permettent de créer, modifier et gérer des tables de base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-247">It includes commands that let you retrieve data and update it, and that let you create, modify, and manage database tables.</span></span> <span data-ttu-id="eaef1-248">SQL est différent d’un langage de programmation (comme celui que vous utilisez dans WebMatrix), car avec SQL, l’idée est que vous indiquez à la base de données ce que vous voulez, et c’est la tâche de la base de données de déterminer comment obtenir les données ou effectuer la tâche.</span><span class="sxs-lookup"><span data-stu-id="eaef1-248">SQL is different than a programming language (like the one you're using in WebMatrix) because with SQL, the idea is that you tell the database what you want, and it's the database's job to figure out how to get the data or perform the task.</span></span> <span data-ttu-id="eaef1-249">Voici quelques exemples de commandes SQL et ce qu’elles font :</span><span class="sxs-lookup"><span data-stu-id="eaef1-249">Here are examples of some SQL commands and what they do:</span></span>
> 
> `SELECT Id, Name, Price FROM Product WHERE Price > 10.00 ORDER BY Name`
> 
> <span data-ttu-id="eaef1-250">Cette commande extrait les colonnes *ID*, *Name*et *Price* des enregistrements de la table *Product* si la valeur *Price* est supérieure à 10, et retourne les résultats par ordre alphabétique en fonction des valeurs de la colonne *Name* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-250">This fetches the *Id*, *Name*, and *Price* columns from records in the *Product* table if the value of *Price* is more than 10, and returns the results in alphabetical order based on the values of the *Name* column.</span></span> <span data-ttu-id="eaef1-251">Cette commande retourne un jeu de résultats qui contient les enregistrements qui répondent aux critères ou un ensemble vide si aucun enregistrement ne correspond.</span><span class="sxs-lookup"><span data-stu-id="eaef1-251">This command will return a result set that contains the records that meet the criteria, or an empty set if no records match.</span></span>
> 
> `INSERT INTO Product (Name, Description, Price) VALUES ("Croissant", "A flaky delight", 1.99)`
> 
> <span data-ttu-id="eaef1-252">Cela insère un nouvel enregistrement dans la table *Product* , en définissant la colonne *Name* sur &quot;croissant&quot;, la colonne *Description* pour &quot;un&quot;de la satisfaction des regards et le prix à 1,99.</span><span class="sxs-lookup"><span data-stu-id="eaef1-252">This inserts a new record into the *Product* table, setting the *Name* column to &quot;Croissant&quot;, the *Description* column to &quot;A flaky delight&quot;, and the price to 1.99.</span></span>
> 
> `DELETE FROM Product WHERE ExpirationDate < "01/01/2008"`
> 
> <span data-ttu-id="eaef1-253">Cette commande supprime les enregistrements de la table *Product* dont la colonne Date d’expiration est antérieure au 1er janvier 2008.</span><span class="sxs-lookup"><span data-stu-id="eaef1-253">This command deletes records in the *Product* table whose expiration date column is earlier than January 1, 2008.</span></span> <span data-ttu-id="eaef1-254">(Cela suppose que la table *Product* possède une telle colonne, bien évidemment.) La date est entrée ici au format MM/JJ/AAAA, mais elle doit être entrée au format utilisé pour vos paramètres régionaux.</span><span class="sxs-lookup"><span data-stu-id="eaef1-254">(This assumes that the *Product* table has such a column, of course.) The date is entered here in MM/DD/YYYY format, but it should be entered in the format that's used for your locale.</span></span>
> 
> <span data-ttu-id="eaef1-255">Les commandes `Insert Into` et `Delete` ne retournent pas de jeux de résultats.</span><span class="sxs-lookup"><span data-stu-id="eaef1-255">The `Insert Into` and `Delete` commands don't return result sets.</span></span> <span data-ttu-id="eaef1-256">Au lieu de cela, ils retournent un nombre qui indique le nombre d’enregistrements affectés par la commande.</span><span class="sxs-lookup"><span data-stu-id="eaef1-256">Instead, they return a number that tells you how many records were affected by the command.</span></span>
> 
> <span data-ttu-id="eaef1-257">Pour certaines de ces opérations (telles que l’insertion et la suppression d’enregistrements), le processus qui demande l’opération doit disposer des autorisations appropriées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-257">For some of these operations (like inserting and deleting records), the process that's requesting the operation has to have appropriate permissions in the database.</span></span> <span data-ttu-id="eaef1-258">C’est pour cette raison que, pour les bases de données de production, vous devez souvent fournir un nom d’utilisateur et un mot de passe lorsque vous vous connectez à la base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-258">This is why for production databases you often have to supply a username and password when you connect to the database.</span></span>
> 
> <span data-ttu-id="eaef1-259">Il existe des dizaines de commandes SQL, mais elles suivent toutes un modèle comme celui-ci.</span><span class="sxs-lookup"><span data-stu-id="eaef1-259">There are dozens of SQL commands, but they all follow a pattern like this.</span></span> <span data-ttu-id="eaef1-260">Vous pouvez utiliser des commandes SQL pour créer des tables de base de données, compter le nombre d’enregistrements dans une table, calculer les prix et effectuer de nombreuses opérations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="eaef1-260">You can use SQL commands to create database tables, count the number of records in a table, calculate prices, and perform many more operations.</span></span>

## <a name="inserting-data-in-a-database"></a><span data-ttu-id="eaef1-261">Insertion de données dans une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-261">Inserting Data in a Database</span></span>

<span data-ttu-id="eaef1-262">Cette section explique comment créer une page qui permet aux utilisateurs d’ajouter un nouveau produit à la table de base de données du *produit* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-262">This section shows how to create a page that lets users add a new product to the *Product* database table.</span></span> <span data-ttu-id="eaef1-263">Après l’insertion d’un nouvel enregistrement de produit, la page affiche la table mise à jour à l’aide de la page *ListProducts. cshtml* que vous avez créée dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="eaef1-263">After a new product record is inserted, the page displays the updated table using the *ListProducts.cshtml* page that you created in the previous section.</span></span>

<span data-ttu-id="eaef1-264">La page comprend une validation pour s’assurer que les données entrées par l’utilisateur sont valides pour la base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-264">The page includes validation to make sure that the data that the user enters is valid for the database.</span></span> <span data-ttu-id="eaef1-265">Par exemple, le code de la page permet de s’assurer qu’une valeur a été entrée pour toutes les colonnes requises.</span><span class="sxs-lookup"><span data-stu-id="eaef1-265">For example, code in the page makes sure that a value has been entered for all required columns.</span></span>

1. <span data-ttu-id="eaef1-266">Dans le site Web, créez un nouveau fichier CSHTML nommé *InsertProducts. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-266">In the website, create a new CSHTML file named *InsertProducts.cshtml*.</span></span>
2. <span data-ttu-id="eaef1-267">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="eaef1-267">Replace the existing markup with the following:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample3.cshtml)]

    <span data-ttu-id="eaef1-268">Le corps de la page contient un formulaire HTML avec trois zones de texte qui permettent aux utilisateurs d’entrer un nom, une description et un prix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-268">The body of the page contains an HTML form with three text boxes that let users enter a name, description, and price.</span></span> <span data-ttu-id="eaef1-269">Quand les utilisateurs cliquent sur le bouton **Insérer** , le code en haut de la page ouvre une connexion à la base de données *SmallBakery. sdf* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-269">When users click the **Insert** button, the code at the top of the page opens a connection to the *SmallBakery.sdf* database.</span></span> <span data-ttu-id="eaef1-270">Vous pouvez ensuite récupérer les valeurs que l’utilisateur a soumises à l’aide de l’objet `Request` et affecter ces valeurs à des variables locales.</span><span class="sxs-lookup"><span data-stu-id="eaef1-270">You then get the values that the user has submitted by using the `Request` object and assign those values to local variables.</span></span>

    <span data-ttu-id="eaef1-271">Pour confirmer que l’utilisateur a entré une valeur pour chaque colonne requise, vous devez inscrire chaque `<input>` élément que vous souhaitez valider :</span><span class="sxs-lookup"><span data-stu-id="eaef1-271">To validate that the user entered a value for each required column, you register each `<input>` element that you want to validate:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample4.cs)]

    <span data-ttu-id="eaef1-272">Le `Validation` Helper vérifie qu’il existe une valeur dans chacun des champs que vous avez enregistrés.</span><span class="sxs-lookup"><span data-stu-id="eaef1-272">The `Validation` helper checks that there is a value in each of the fields that you've registered.</span></span> <span data-ttu-id="eaef1-273">Vous pouvez vérifier si tous les champs ont été validés en vérifiant `Validation.IsValid()`, que vous faites généralement avant de traiter les informations que vous recevez de l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="eaef1-273">You can test whether all the fields passed validation by checking `Validation.IsValid()`, which you typically do before you process the information you get from the user:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample5.cs)]

    <span data-ttu-id="eaef1-274">(L’opérateur `&&` signifie et — ce test est *s’il s’agit d’une soumission de formulaire et que tous les champs ont été validés*.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-274">(The `&&` operator means AND — this test is *If this is a form submission AND all the fields have passed validation*.)</span></span>

    <span data-ttu-id="eaef1-275">Si toutes les colonnes sont validées (aucune n’était vide), vous allez créer une instruction SQL pour insérer les données et les exécuter comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="eaef1-275">If all the columns validated (none were empty), you go ahead and create a SQL statement to insert the data and then execute it as shown next:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample6.cs)]

    <span data-ttu-id="eaef1-276">Pour les valeurs à insérer, vous incluez des espaces réservés de paramètre (`@0`, `@1`, `@2`).</span><span class="sxs-lookup"><span data-stu-id="eaef1-276">For the values to insert, you include parameter placeholders (`@0`, `@1`, `@2`).</span></span>

    > [!NOTE]
    > <span data-ttu-id="eaef1-277">Par mesure de sécurité, transmettez toujours des valeurs à une instruction SQL à l’aide de paramètres, comme vous pouvez le voir dans l’exemple précédent.</span><span class="sxs-lookup"><span data-stu-id="eaef1-277">As a security precaution, always pass values to a SQL statement using parameters, as you see in the preceding example.</span></span> <span data-ttu-id="eaef1-278">Cela vous donne la possibilité de valider les données de l’utilisateur, et cela vous permet de vous protéger contre les tentatives d’envoi de commandes malveillantes à votre base de données (parfois appelées « attaques par injection SQL »).</span><span class="sxs-lookup"><span data-stu-id="eaef1-278">This gives you a chance to validate the user's data, plus it helps protect against attempts to send malicious commands to your database (sometimes referred to as SQL injection attacks).</span></span>

    <span data-ttu-id="eaef1-279">Pour exécuter la requête, vous utilisez cette instruction, en lui transmettant les variables qui contiennent les valeurs pour remplacer les espaces réservés :</span><span class="sxs-lookup"><span data-stu-id="eaef1-279">To execute the query, you use this statement, passing to it the variables that contain the values to substitute for the placeholders:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample7.cs)]

    <span data-ttu-id="eaef1-280">Après l’exécution de l’instruction `Insert Into`, vous envoyez l’utilisateur à la page qui répertorie les produits à l’aide de cette ligne :</span><span class="sxs-lookup"><span data-stu-id="eaef1-280">After the `Insert Into` statement has executed, you send the user to the page that lists the products using this line:</span></span>

    [!code-javascript[Main](5-working-with-data/samples/sample8.js)]

    <span data-ttu-id="eaef1-281">Si la validation n’a pas réussi, vous ignorez l’insertion.</span><span class="sxs-lookup"><span data-stu-id="eaef1-281">If validation didn't succeed, you skip the insert.</span></span> <span data-ttu-id="eaef1-282">Au lieu de cela, vous disposez d’une application d’assistance dans la page qui peut afficher les messages d’erreur accumulés (le cas échéant) :</span><span class="sxs-lookup"><span data-stu-id="eaef1-282">Instead, you have a helper in the page that can display the accumulated error messages (if any):</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample9.cshtml)]

    <span data-ttu-id="eaef1-283">Notez que le bloc de style dans le balisage comprend une définition de classe CSS nommée `.validation-summary-errors`.</span><span class="sxs-lookup"><span data-stu-id="eaef1-283">Notice that the style block in the markup includes a CSS class definition named `.validation-summary-errors`.</span></span> <span data-ttu-id="eaef1-284">Il s’agit du nom de la classe CSS qui est utilisée par défaut pour l’élément `<div>` qui contient des erreurs de validation.</span><span class="sxs-lookup"><span data-stu-id="eaef1-284">This is the name of the CSS class that's used by default for the `<div>` element that contains any validation errors.</span></span> <span data-ttu-id="eaef1-285">Dans ce cas, la classe CSS spécifie que les erreurs de résumé de validation s’affichent en rouge et en gras, mais vous pouvez définir la classe `.validation-summary-errors` pour afficher la mise en forme de votre choix.</span><span class="sxs-lookup"><span data-stu-id="eaef1-285">In this case, the CSS class specifies that validation summary errors are displayed in red and in bold, but you can define the `.validation-summary-errors` class to display any formatting you like.</span></span>

### <a name="testing-the-insert-page"></a><span data-ttu-id="eaef1-286">Test de la page d’insertion</span><span class="sxs-lookup"><span data-stu-id="eaef1-286">Testing the Insert Page</span></span>

1. <span data-ttu-id="eaef1-287">Affichez la page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-287">View the page in a browser.</span></span> <span data-ttu-id="eaef1-288">La page affiche un formulaire similaire à celui présenté dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="eaef1-288">The page displays a form that's similar to the one that's shown in the following illustration.</span></span>

    ![[image]](5-working-with-data/_static/image5.jpg)
2. <span data-ttu-id="eaef1-290">Entrez des valeurs pour toutes les colonnes, mais veillez à laisser la colonne *Price* vide.</span><span class="sxs-lookup"><span data-stu-id="eaef1-290">Enter values for all the columns, but make sure that you leave the *Price* column blank.</span></span>
3. <span data-ttu-id="eaef1-291">Cliquez sur **Insérer**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-291">Click **Insert**.</span></span> <span data-ttu-id="eaef1-292">La page affiche un message d’erreur, comme indiqué dans l’illustration suivante.</span><span class="sxs-lookup"><span data-stu-id="eaef1-292">The page displays an error message, as shown in the following illustration.</span></span> <span data-ttu-id="eaef1-293">(Aucun nouvel enregistrement n’est créé.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-293">(No new record is created.)</span></span>

    ![[image]](5-working-with-data/_static/image6.jpg)
4. <span data-ttu-id="eaef1-295">Remplissez entièrement le formulaire, puis cliquez sur **Insérer**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-295">Fill the form out completely, and then click **Insert**.</span></span> <span data-ttu-id="eaef1-296">Cette fois-ci, la page *ListProducts. cshtml* s’affiche et affiche le nouvel enregistrement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-296">This time, the *ListProducts.cshtml* page is displayed and shows the new record.</span></span>

## <a name="updating-data-in-a-database"></a><span data-ttu-id="eaef1-297">Mise à jour des données d’une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-297">Updating Data in a Database</span></span>

<span data-ttu-id="eaef1-298">Une fois les données entrées dans une table, vous devrez peut-être les mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="eaef1-298">After data has been entered into a table, you might need to update it.</span></span> <span data-ttu-id="eaef1-299">Cette procédure vous montre comment créer deux pages similaires à celles que vous avez créées pour l’insertion de données précédemment.</span><span class="sxs-lookup"><span data-stu-id="eaef1-299">This procedure shows you how to create two pages that are similar to the ones you created for data insertion earlier.</span></span> <span data-ttu-id="eaef1-300">La première page affiche les produits et permet aux utilisateurs de sélectionner un produit à modifier.</span><span class="sxs-lookup"><span data-stu-id="eaef1-300">The first page displays products and lets users select one to change.</span></span> <span data-ttu-id="eaef1-301">La deuxième page permet aux utilisateurs d’apporter les modifications et de les enregistrer.</span><span class="sxs-lookup"><span data-stu-id="eaef1-301">The second page lets the users actually make the edits and save them.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="eaef1-302">**Important** Dans un site Web de production, vous limitez généralement les personnes autorisées à apporter des modifications aux données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-302">**Important** In a production website, you typically restrict who's allowed to make changes to the data.</span></span> <span data-ttu-id="eaef1-303">Pour plus d’informations sur la configuration de l’appartenance et sur les façons d’autoriser les utilisateurs à effectuer des tâches sur le site, consultez [Ajout de la sécurité et de l’appartenance à un site pages Web ASP.net](https://go.microsoft.com/fwlink/?LinkId=202904).</span><span class="sxs-lookup"><span data-stu-id="eaef1-303">For information about how to set up membership and about ways to authorize users to perform tasks on the site, see [Adding Security and Membership to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202904).</span></span>

1. <span data-ttu-id="eaef1-304">Dans le site Web, créez un nouveau fichier CSHTML nommé *EditProducts. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-304">In the website, create a new CSHTML file named *EditProducts.cshtml*.</span></span>
2. <span data-ttu-id="eaef1-305">Remplacez le balisage existant dans le fichier par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="eaef1-305">Replace the existing markup in the file with the following:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample10.cshtml)]

    <span data-ttu-id="eaef1-306">La seule différence entre cette page et la page *ListProducts. cshtml* de la version antérieure est que le tableau HTML de cette page comprend une colonne supplémentaire qui affiche un lien **modifier** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-306">The only difference between this page and the *ListProducts.cshtml* page from earlier is that the HTML table in this page includes an extra column that displays an **Edit** link.</span></span> <span data-ttu-id="eaef1-307">Lorsque vous cliquez sur ce lien, vous accédez à la page *UpdateProducts. cshtml* (que vous allez créer ensuite) dans laquelle vous pouvez modifier l’enregistrement sélectionné.</span><span class="sxs-lookup"><span data-stu-id="eaef1-307">When you click this link, it takes you to the *UpdateProducts.cshtml* page (which you'll create next) where you can edit the selected record.</span></span>

    <span data-ttu-id="eaef1-308">Examinez le code qui crée le lien **modifier** :</span><span class="sxs-lookup"><span data-stu-id="eaef1-308">Look at the code that creates the **Edit** link:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample11.cshtml)]

    <span data-ttu-id="eaef1-309">Cela crée un élément `<a>` HTML dont l’attribut `href` est défini dynamiquement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-309">This creates an HTML `<a>` element whose `href` attribute is set dynamically.</span></span> <span data-ttu-id="eaef1-310">L’attribut `href` spécifie la page à afficher lorsque l’utilisateur clique sur le lien.</span><span class="sxs-lookup"><span data-stu-id="eaef1-310">The `href` attribute specifies the page to display when the user clicks the link.</span></span> <span data-ttu-id="eaef1-311">Il passe également la valeur `Id` de la ligne actuelle au lien.</span><span class="sxs-lookup"><span data-stu-id="eaef1-311">It also passes the `Id` value of the current row to the link.</span></span> <span data-ttu-id="eaef1-312">Lorsque la page s’exécute, la source de la page peut contenir des liens comme suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-312">When the page runs, the page source might contain links like these:</span></span>

    [!code-html[Main](5-working-with-data/samples/sample12.html)]

    <span data-ttu-id="eaef1-313">Notez que l’attribut `href` est défini sur `UpdateProducts/n`, où *n* est un numéro de produit.</span><span class="sxs-lookup"><span data-stu-id="eaef1-313">Notice that the `href` attribute is set to `UpdateProducts/n`, where *n* is a product number.</span></span> <span data-ttu-id="eaef1-314">Lorsqu’un utilisateur clique sur l’un de ces liens, l’URL obtenue ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="eaef1-314">When a user clicks one of these links, the resulting URL will look something like this:</span></span>

    `http://localhost:18816/UpdateProducts/6`

    <span data-ttu-id="eaef1-315">En d’autres termes, le numéro de produit à modifier sera transmis à l’URL.</span><span class="sxs-lookup"><span data-stu-id="eaef1-315">In other words, the product number to be edited will be passed in the URL.</span></span>
3. <span data-ttu-id="eaef1-316">Affichez la page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-316">View the page in a browser.</span></span> <span data-ttu-id="eaef1-317">La page affiche les données dans un format similaire à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-317">The page displays the data in a format like this:</span></span>

    ![[image]](5-working-with-data/_static/image7.jpg)

    <span data-ttu-id="eaef1-319">Ensuite, vous allez créer la page qui permet aux utilisateurs de mettre à jour les données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-319">Next, you'll create the page that lets users actually update the data.</span></span> <span data-ttu-id="eaef1-320">La page de mise à jour comprend une validation pour valider les données entrées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-320">The update page includes validation to validate the data that the user enters.</span></span> <span data-ttu-id="eaef1-321">Par exemple, le code de la page permet de s’assurer qu’une valeur a été entrée pour toutes les colonnes requises.</span><span class="sxs-lookup"><span data-stu-id="eaef1-321">For example, code in the page makes sure that a value has been entered for all required columns.</span></span>
4. <span data-ttu-id="eaef1-322">Dans le site Web, créez un nouveau fichier CSHTML nommé *UpdateProducts. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-322">In the website, create a new CSHTML file named *UpdateProducts.cshtml*.</span></span>
5. <span data-ttu-id="eaef1-323">Remplacez le balisage existant dans le fichier par le code suivant.</span><span class="sxs-lookup"><span data-stu-id="eaef1-323">Replace the existing markup in the file with the following.</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample13.cshtml)]

    <span data-ttu-id="eaef1-324">Le corps de la page contient un formulaire HTML dans lequel un produit est affiché et l’endroit où les utilisateurs peuvent le modifier.</span><span class="sxs-lookup"><span data-stu-id="eaef1-324">The body of the page contains an HTML form where a product is displayed and where users can edit it.</span></span> <span data-ttu-id="eaef1-325">Pour obtenir le produit à afficher, utilisez l’instruction SQL suivante :</span><span class="sxs-lookup"><span data-stu-id="eaef1-325">To get the product to display, you use this SQL statement:</span></span>

    [!code-sql[Main](5-working-with-data/samples/sample14.sql)]

    <span data-ttu-id="eaef1-326">Cela permet de sélectionner le produit dont l’ID correspond à la valeur passée dans le paramètre `@0`.</span><span class="sxs-lookup"><span data-stu-id="eaef1-326">This will select the product whose ID matches the value that's passed in the `@0` parameter.</span></span> <span data-ttu-id="eaef1-327">(Étant donné que l' *ID* est la clé primaire et doit donc être unique, un seul enregistrement produit peut être sélectionné de cette façon.) Pour obtenir la valeur d’ID à transmettre à cette instruction `Select`, vous pouvez lire la valeur transmise à la page dans le cadre de l’URL, à l’aide de la syntaxe suivante :</span><span class="sxs-lookup"><span data-stu-id="eaef1-327">(Because *Id* is the primary key and therefore must be unique, only one product record can ever be selected this way.) To get the ID value to pass to this `Select` statement, you can read the value that's passed to the page as part of the URL, using the following syntax:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample15.cs)]

    <span data-ttu-id="eaef1-328">Pour récupérer réellement l’enregistrement du produit, vous utilisez la méthode `QuerySingle`, qui retourne un seul enregistrement :</span><span class="sxs-lookup"><span data-stu-id="eaef1-328">To actually fetch the product record, you use the `QuerySingle` method, which will return just one record:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample16.cs)]

    <span data-ttu-id="eaef1-329">La ligne unique est retournée dans la variable `row`.</span><span class="sxs-lookup"><span data-stu-id="eaef1-329">The single row is returned into the `row` variable.</span></span> <span data-ttu-id="eaef1-330">Vous pouvez récupérer des données de chaque colonne et les assigner à des variables locales comme suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-330">You can get data out of each column and assign it to local variables like this:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample17.cs)]

    <span data-ttu-id="eaef1-331">Dans le balisage du formulaire, ces valeurs s’affichent automatiquement dans des zones de texte individuelles à l’aide d’un code incorporé comme suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-331">In the markup for the form, these values are displayed automatically in individual text boxes by using embedded code like the following:</span></span>

    [!code-html[Main](5-working-with-data/samples/sample18.html)]

    <span data-ttu-id="eaef1-332">Cette partie du code affiche l’enregistrement du produit à mettre à jour.</span><span class="sxs-lookup"><span data-stu-id="eaef1-332">That part of the code displays the product record to be updated.</span></span> <span data-ttu-id="eaef1-333">Une fois l’enregistrement affiché, l’utilisateur peut modifier des colonnes individuelles.</span><span class="sxs-lookup"><span data-stu-id="eaef1-333">Once the record has been displayed, the user can edit individual columns.</span></span>

    <span data-ttu-id="eaef1-334">Lorsque l’utilisateur envoie le formulaire en cliquant sur le bouton **mettre à jour** , le code du bloc `if(IsPost)` s’exécute.</span><span class="sxs-lookup"><span data-stu-id="eaef1-334">When the user submits the form by clicking the **Update** button, the code in the `if(IsPost)` block runs.</span></span> <span data-ttu-id="eaef1-335">Cela obtient les valeurs de l’utilisateur de l’objet `Request`, stocke les valeurs dans les variables et valide que chaque colonne a été remplie.</span><span class="sxs-lookup"><span data-stu-id="eaef1-335">This gets the user's values from the `Request` object, stores the values in variables, and validates that each column has been filled in.</span></span> <span data-ttu-id="eaef1-336">Si la validation réussit, le code crée l’instruction SQL UPDATE suivante :</span><span class="sxs-lookup"><span data-stu-id="eaef1-336">If validation passes, the code creates the following SQL Update statement:</span></span>

    [!code-sql[Main](5-working-with-data/samples/sample19.sql)]

    <span data-ttu-id="eaef1-337">Dans une instruction SQL `Update`, vous spécifiez chaque colonne à mettre à jour et la valeur à laquelle la définir.</span><span class="sxs-lookup"><span data-stu-id="eaef1-337">In a SQL `Update` statement, you specify each column to update and the value to set it to.</span></span> <span data-ttu-id="eaef1-338">Dans ce code, les valeurs sont spécifiées à l’aide des espaces réservés de paramètre `@0`, `@1`, `@2`, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="eaef1-338">In this code, the values are specified using the parameter placeholders `@0`, `@1`, `@2`, and so on.</span></span> <span data-ttu-id="eaef1-339">(Comme indiqué précédemment, pour la sécurité, vous devez toujours passer des valeurs à une instruction SQL à l’aide de paramètres.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-339">(As noted earlier, for security, you should always pass values to a SQL statement by using parameters.)</span></span>

    <span data-ttu-id="eaef1-340">Lorsque vous appelez la méthode `db.Execute`, vous transmettez les variables qui contiennent les valeurs dans l’ordre qui correspond aux paramètres dans l’instruction SQL :</span><span class="sxs-lookup"><span data-stu-id="eaef1-340">When you call the `db.Execute` method, you pass the variables that contain the values in the order that corresponds to the parameters in the SQL statement:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample20.cs)]

    <span data-ttu-id="eaef1-341">Après l’exécution de l’instruction `Update`, vous appelez la méthode suivante afin de rediriger l’utilisateur vers la page de modification :</span><span class="sxs-lookup"><span data-stu-id="eaef1-341">After the `Update` statement has been executed, you call the following method in order to redirect the user back to the edit page:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample21.cshtml)]

    <span data-ttu-id="eaef1-342">L’effet est que l’utilisateur voit une liste mise à jour des données dans la base de données et peut modifier un autre produit.</span><span class="sxs-lookup"><span data-stu-id="eaef1-342">The effect is that the user sees an updated listing of the data in the database and can edit another product.</span></span>
6. <span data-ttu-id="eaef1-343">Enregistrez la page.</span><span class="sxs-lookup"><span data-stu-id="eaef1-343">Save the page.</span></span>
7. <span data-ttu-id="eaef1-344">Exécutez la page *EditProducts. cshtml* (pas la page mettre à jour), puis cliquez sur **modifier** pour sélectionner un produit à modifier.</span><span class="sxs-lookup"><span data-stu-id="eaef1-344">Run the *EditProducts.cshtml* page (not the update page) and then click **Edit** to select a product to edit.</span></span> <span data-ttu-id="eaef1-345">La page *UpdateProducts. cshtml* s’affiche, affichant l’enregistrement que vous avez sélectionné.</span><span class="sxs-lookup"><span data-stu-id="eaef1-345">The *UpdateProducts.cshtml* page is displayed, showing the record you selected.</span></span>

    ![[image]](5-working-with-data/_static/image8.jpg)
8. <span data-ttu-id="eaef1-347">Apportez une modification, puis cliquez sur **mettre à jour**.</span><span class="sxs-lookup"><span data-stu-id="eaef1-347">Make a change and click **Update**.</span></span> <span data-ttu-id="eaef1-348">La liste des produits s’affiche à nouveau avec vos données mises à jour.</span><span class="sxs-lookup"><span data-stu-id="eaef1-348">The products list is shown again with your updated data.</span></span>

## <a name="deleting-data-in-a-database"></a><span data-ttu-id="eaef1-349">Suppression de données dans une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-349">Deleting Data in a Database</span></span>

<span data-ttu-id="eaef1-350">Cette section montre comment permettre aux utilisateurs de supprimer un produit de la table de base de données du *produit* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-350">This section shows how to let users delete a product from the *Product* database table.</span></span> <span data-ttu-id="eaef1-351">L’exemple se compose de deux pages.</span><span class="sxs-lookup"><span data-stu-id="eaef1-351">The example consists of two pages.</span></span> <span data-ttu-id="eaef1-352">Dans la première page, les utilisateurs sélectionnent un enregistrement à supprimer.</span><span class="sxs-lookup"><span data-stu-id="eaef1-352">In the first page, users select a record to delete.</span></span> <span data-ttu-id="eaef1-353">L’enregistrement à supprimer est ensuite affiché dans une deuxième page qui permet de confirmer qu’il souhaite supprimer l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-353">The record to be deleted is then displayed in a second page that lets them confirm that they want to delete the record.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="eaef1-354">**Important** Dans un site Web de production, vous limitez généralement les personnes autorisées à apporter des modifications aux données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-354">**Important** In a production website, you typically restrict who's allowed to make changes to the data.</span></span> <span data-ttu-id="eaef1-355">Pour plus d’informations sur la configuration de l’appartenance et sur les façons d’autoriser l’utilisateur à effectuer des tâches sur le site, consultez [Ajout de la sécurité et de l’appartenance à un site pages Web ASP.net](https://go.microsoft.com/fwlink/?LinkId=202904).</span><span class="sxs-lookup"><span data-stu-id="eaef1-355">For information about how to set up membership and about ways to authorize user to perform tasks on the site, see [Adding Security and Membership to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202904).</span></span>

1. <span data-ttu-id="eaef1-356">Dans le site Web, créez un nouveau fichier CSHTML nommé *ListProductsForDelete. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-356">In the website, create a new CSHTML file named *ListProductsForDelete.cshtml*.</span></span>
2. <span data-ttu-id="eaef1-357">Remplacez le balisage existant par le code suivant :</span><span class="sxs-lookup"><span data-stu-id="eaef1-357">Replace the existing markup with the following:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample22.cshtml)]

    <span data-ttu-id="eaef1-358">Cette page est similaire à la page *EditProducts. cshtml* de la version antérieure.</span><span class="sxs-lookup"><span data-stu-id="eaef1-358">This page is similar to the *EditProducts.cshtml* page from earlier.</span></span> <span data-ttu-id="eaef1-359">Toutefois, au lieu d’afficher un lien de **modification** pour chaque produit, il affiche un lien **supprimer** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-359">However, instead of displaying an **Edit** link for each product, it displays a **Delete** link.</span></span> <span data-ttu-id="eaef1-360">Le lien **supprimer** est créé à l’aide du code incorporé suivant dans le balisage :</span><span class="sxs-lookup"><span data-stu-id="eaef1-360">The **Delete** link is created using the following embedded code in the markup:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample23.cshtml)]

    <span data-ttu-id="eaef1-361">Cela crée une URL qui ressemble à ce qui suit lorsque les utilisateurs cliquent sur le lien :</span><span class="sxs-lookup"><span data-stu-id="eaef1-361">This creates a URL that looks like this when users click the link:</span></span>

    `http://<server>/DeleteProduct/4`

    <span data-ttu-id="eaef1-362">L’URL appelle une page nommée *DeleteProduct. cshtml* (que vous allez créer ensuite) et lui transmet l’ID du produit à supprimer (ici, 4).</span><span class="sxs-lookup"><span data-stu-id="eaef1-362">The URL calls a page named *DeleteProduct.cshtml* (which you'll create next) and passes it the ID of the product to delete (here, 4).</span></span>
3. <span data-ttu-id="eaef1-363">Enregistrez le fichier, mais laissez-le ouvert.</span><span class="sxs-lookup"><span data-stu-id="eaef1-363">Save the file, but leave it open.</span></span>
4. <span data-ttu-id="eaef1-364">Créez un autre fichier CHTML nommé *DeleteProduct. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="eaef1-364">Create another CHTML file named *DeleteProduct.cshtml*.</span></span> <span data-ttu-id="eaef1-365">Remplacez le contenu existant par ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="eaef1-365">Replace the existing content with the following:</span></span>

    [!code-cshtml[Main](5-working-with-data/samples/sample24.cshtml)]

    <span data-ttu-id="eaef1-366">Cette page est appelée par *ListProductsForDelete. cshtml* et permet aux utilisateurs de confirmer qu’ils veulent supprimer un produit.</span><span class="sxs-lookup"><span data-stu-id="eaef1-366">This page is called by *ListProductsForDelete.cshtml* and lets users confirm that they want to delete a product.</span></span> <span data-ttu-id="eaef1-367">Pour répertorier le produit à supprimer, vous devez récupérer l’ID du produit à supprimer de l’URL à l’aide du code suivant :</span><span class="sxs-lookup"><span data-stu-id="eaef1-367">To list the product to be deleted, you get the ID of the product to delete from the URL using the following code:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample25.cs)]

    <span data-ttu-id="eaef1-368">La page demande ensuite à l’utilisateur de cliquer sur un bouton pour supprimer réellement l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-368">The page then asks the user to click a button to actually delete the record.</span></span> <span data-ttu-id="eaef1-369">Il s’agit d’une mesure de sécurité importante : lorsque vous effectuez des opérations sensibles sur votre site Web, telles que la mise à jour ou la suppression de données, ces opérations doivent toujours être effectuées à l’aide d’une opération de publication, et non d’une opération d’extraction.</span><span class="sxs-lookup"><span data-stu-id="eaef1-369">This is an important security measure: when you perform sensitive operations in your website like updating or deleting data, these operations should always be done using a POST operation, not a GET operation.</span></span> <span data-ttu-id="eaef1-370">Si votre site est configuré de façon à ce qu’une opération de suppression puisse être effectuée à l’aide d’une opération d’extraction, tout le monde peut passer une URL comme `http://<server>/DeleteProduct/4` et supprimer tout ce qu’il veut de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-370">If your site is set up so that a delete operation can be performed using a GET operation, anyone can pass a URL like `http://<server>/DeleteProduct/4` and delete anything they want from your database.</span></span> <span data-ttu-id="eaef1-371">En ajoutant la confirmation et en codant la page de sorte que la suppression ne puisse être effectuée qu’à l’aide d’une publication, vous ajoutez une mesure de sécurité à votre site.</span><span class="sxs-lookup"><span data-stu-id="eaef1-371">By adding the confirmation and coding the page so that the deletion can be performed only by using a POST, you add a measure of security to your site.</span></span>

    <span data-ttu-id="eaef1-372">L’opération de suppression réelle est effectuée à l’aide du code suivant, qui confirme d’abord qu’il s’agit d’une opération de publication et que l’ID n’est pas vide :</span><span class="sxs-lookup"><span data-stu-id="eaef1-372">The actual delete operation is performed using the following code, which first confirms that this is a post operation and that the ID isn't empty:</span></span>

    [!code-csharp[Main](5-working-with-data/samples/sample26.cs)]

    <span data-ttu-id="eaef1-373">Le code exécute une instruction SQL qui supprime l’enregistrement spécifié, puis redirige l’utilisateur vers la page de liste.</span><span class="sxs-lookup"><span data-stu-id="eaef1-373">The code runs a SQL statement that deletes the specified record and then redirects the user back to the listing page.</span></span>
5. <span data-ttu-id="eaef1-374">Exécutez *ListProductsForDelete. cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-374">Run *ListProductsForDelete.cshtml* in a browser.</span></span>

    ![[image]](5-working-with-data/_static/image9.jpg)
6. <span data-ttu-id="eaef1-376">Cliquez sur le lien **supprimer** pour l’un des produits.</span><span class="sxs-lookup"><span data-stu-id="eaef1-376">Click the **Delete** link for one of the products.</span></span> <span data-ttu-id="eaef1-377">La page *DeleteProduct. cshtml* s’affiche pour confirmer que vous souhaitez supprimer cet enregistrement.</span><span class="sxs-lookup"><span data-stu-id="eaef1-377">The *DeleteProduct.cshtml* page is displayed to confirm that you want to delete that record.</span></span>
7. <span data-ttu-id="eaef1-378">Cliquez sur le bouton **Supprimer** .</span><span class="sxs-lookup"><span data-stu-id="eaef1-378">Click the **Delete** button.</span></span> <span data-ttu-id="eaef1-379">L’enregistrement du produit est supprimé et la page est actualisée avec une mise à jour de la liste des produits.</span><span class="sxs-lookup"><span data-stu-id="eaef1-379">The product record is deleted and the page is refreshed with an updated product listing.</span></span>

> [!TIP]
> 
> <a id="SB_ConnectingToADatabase"></a>
> ### <a name="connecting-to-a-database"></a><span data-ttu-id="eaef1-380">Connexion à une base de données</span><span class="sxs-lookup"><span data-stu-id="eaef1-380">Connecting to a Database</span></span>
> 
> <span data-ttu-id="eaef1-381">Vous pouvez vous connecter à une base de données de deux façons.</span><span class="sxs-lookup"><span data-stu-id="eaef1-381">You can connect to a database in two ways.</span></span> <span data-ttu-id="eaef1-382">La première consiste à utiliser la méthode `Database.Open` et à spécifier le nom du fichier de base de données (moins l’extension *. sdf* ) :</span><span class="sxs-lookup"><span data-stu-id="eaef1-382">The first is to use the `Database.Open` method and to specify the name of the database file (less the *.sdf* extension):</span></span>
> 
> `var db = Database.Open("SmallBakery");`
> 
> <span data-ttu-id="eaef1-383">La méthode `Open` suppose que le. le fichier *SDF* se trouve dans le dossier de données de l' *application\_* du site Web.</span><span class="sxs-lookup"><span data-stu-id="eaef1-383">The `Open` method assumes that the .*sdf* file is in the website's *App\_Data* folder.</span></span> <span data-ttu-id="eaef1-384">Ce dossier est conçu spécifiquement pour contenir des données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-384">This folder is designed specifically for holding data.</span></span> <span data-ttu-id="eaef1-385">Par exemple, il dispose des autorisations appropriées pour permettre au site Web de lire et d’écrire des données, et en tant que mesure de sécurité, WebMatrix n’autorise pas l’accès aux fichiers à partir de ce dossier.</span><span class="sxs-lookup"><span data-stu-id="eaef1-385">For example, it has appropriate permissions to allow the website to read and write data, and as a security measure, WebMatrix does not allow access to files from this folder.</span></span>
> 
> <span data-ttu-id="eaef1-386">La seconde consiste à utiliser une chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="eaef1-386">The second way is to use a connection string.</span></span> <span data-ttu-id="eaef1-387">Une chaîne de connexion contient des informations sur le mode de connexion à une base de données.</span><span class="sxs-lookup"><span data-stu-id="eaef1-387">A connection string contains information about how to connect to a database.</span></span> <span data-ttu-id="eaef1-388">Il peut s’agir d’un chemin d’accès à un fichier, ou il peut inclure le nom d’une base de données SQL Server sur un serveur local ou distant, ainsi qu’un nom d’utilisateur et un mot de passe pour se connecter à ce serveur.</span><span class="sxs-lookup"><span data-stu-id="eaef1-388">This can include a file path, or it can include the name of a SQL Server database on a local or remote server, along with a user name and password to connect to that server.</span></span> <span data-ttu-id="eaef1-389">(Si vous conservez les données dans une version gérée de manière centralisée de SQL Server, par exemple sur le site d’un fournisseur d’hébergement, vous utilisez toujours une chaîne de connexion pour spécifier les informations de connexion à la base de données.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-389">(If you keep data in a centrally managed version of SQL Server, such as on a hosting provider's site, you always use a connection string to specify the database connection information.)</span></span>
> 
> <span data-ttu-id="eaef1-390">Dans WebMatrix, les chaînes de connexion sont généralement stockées dans un fichier XML nommé *Web. config*. Comme son nom l’indique, vous pouvez utiliser un fichier *Web. config* à la racine de votre site Web pour stocker les informations de configuration du site, y compris les chaînes de connexion dont votre site peut avoir besoin.</span><span class="sxs-lookup"><span data-stu-id="eaef1-390">In WebMatrix, connection strings are usually stored in an XML file named *Web.config*. As the name implies, you can use a *Web.config* file in the root of your website to store the site's configuration information, including any connection strings that your site might require.</span></span> <span data-ttu-id="eaef1-391">Voici un exemple de chaîne de connexion dans un fichier *Web. config* :</span><span class="sxs-lookup"><span data-stu-id="eaef1-391">An example of a connection string in a *Web.config* file might look like the following:</span></span>
> 
> [!code-xml[Main](5-working-with-data/samples/sample27.xml)]
> 
> <span data-ttu-id="eaef1-392">Dans l’exemple, la chaîne de connexion pointe vers une base de données dans une instance de SQL Server qui s’exécute sur un serveur quelque part (au lieu d’un fichier *. sdf* local).</span><span class="sxs-lookup"><span data-stu-id="eaef1-392">In the example, the connection string points to a database in an instance of SQL Server that's running on a server somewhere (as opposed to a local *.sdf* file).</span></span> <span data-ttu-id="eaef1-393">Vous devez substituer les noms appropriés pour `myServer` et `myDatabase`et spécifier SQL Server valeurs de connexion pour `username` et `password`.</span><span class="sxs-lookup"><span data-stu-id="eaef1-393">You would need to substitute the appropriate names for `myServer` and `myDatabase`, and specify SQL Server login values for `username` and `password`.</span></span> <span data-ttu-id="eaef1-394">(Les valeurs nom d’utilisateur et mot de passe ne sont pas nécessairement les mêmes que celles de vos informations d’identification Windows ou de celles que votre fournisseur d’hébergement vous a donné pour vous connecter à leurs serveurs.</span><span class="sxs-lookup"><span data-stu-id="eaef1-394">(The username and password values are not necessarily the same as your Windows credentials or as the values that your hosting provider has given you for logging in to their servers.</span></span> <span data-ttu-id="eaef1-395">Vérifiez auprès de l’administrateur les valeurs exactes dont vous avez besoin.)</span><span class="sxs-lookup"><span data-stu-id="eaef1-395">Check with the administrator for the exact values you need.)</span></span>
> 
> <span data-ttu-id="eaef1-396">La méthode `Database.Open` est flexible, car elle vous permet de transmettre le nom d’un fichier *. sdf* de base de données ou le nom d’une chaîne de connexion stockée dans le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-396">The `Database.Open` method is flexible, because it lets you pass either the name of a database *.sdf* file or the name of a connection string that's stored in the *Web.config* file.</span></span> <span data-ttu-id="eaef1-397">L’exemple suivant montre comment se connecter à la base de données à l’aide de la chaîne de connexion illustrée dans l’exemple précédent :</span><span class="sxs-lookup"><span data-stu-id="eaef1-397">The following example shows how to connect to the database using the connection string illustrated in the previous example:</span></span>
> 
> [!code-cshtml[Main](5-working-with-data/samples/sample28.cshtml)]
> 
> <span data-ttu-id="eaef1-398">Comme indiqué précédemment, la méthode `Database.Open` vous permet de transmettre un nom de base de données ou une chaîne de connexion, et de déterminer le nom à utiliser.</span><span class="sxs-lookup"><span data-stu-id="eaef1-398">As noted, the `Database.Open` method lets you pass either a database name or a connection string, and it'll figure out which to use.</span></span> <span data-ttu-id="eaef1-399">Cela est très utile lorsque vous déployez (publiez) votre site Web.</span><span class="sxs-lookup"><span data-stu-id="eaef1-399">This is very useful when you deploy (publish) your website.</span></span> <span data-ttu-id="eaef1-400">Vous pouvez utiliser un fichier *. sdf* dans le dossier de données de l' *application\_* lorsque vous développez et testez votre site.</span><span class="sxs-lookup"><span data-stu-id="eaef1-400">You can use an *.sdf* file in the *App\_Data* folder when you're developing and testing your site.</span></span> <span data-ttu-id="eaef1-401">Ensuite, lorsque vous déplacez votre site vers un serveur de production, vous pouvez utiliser une chaîne de connexion dans le fichier *Web. config* portant le même nom que votre fichier *. sdf* , mais qui pointe vers la base &#8212; de données du fournisseur d’hébergement sans avoir à modifier votre code.</span><span class="sxs-lookup"><span data-stu-id="eaef1-401">Then when you move your site to a production server, you can use a connection string in the *Web.config* file that has the same name as your *.sdf* file but that points to the hosting provider's database &#8212; all without having to change your code.</span></span>
> 
> <span data-ttu-id="eaef1-402">Enfin, si vous souhaitez travailler directement avec une chaîne de connexion, vous pouvez appeler la méthode `Database.OpenConnectionString` et la passer à la chaîne de connexion réelle plutôt qu’au nom d’une valeur dans le fichier *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="eaef1-402">Finally, if you want to work directly with a connection string, you can call the `Database.OpenConnectionString` method and pass it the actual connection string instead of just the name of one in the *Web.config* file.</span></span> <span data-ttu-id="eaef1-403">Cela peut être utile dans les situations où, pour une raison quelconque, vous n’avez pas accès à la chaîne de connexion (ou aux valeurs qu’elle contient, telles que le nom de fichier *. sdf* ) jusqu’à ce que la page soit en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="eaef1-403">This might be useful in situations where for some reason you don't have access to the connection string (or values in it, such as the *.sdf* file name) until the page is running.</span></span> <span data-ttu-id="eaef1-404">Toutefois, pour la plupart des scénarios, vous pouvez utiliser `Database.Open` comme décrit dans cet article.</span><span class="sxs-lookup"><span data-stu-id="eaef1-404">However, for most scenarios, you can use `Database.Open` as described in this article.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="eaef1-405">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="eaef1-405">Additional Resources</span></span>

- [<span data-ttu-id="eaef1-406">SQL Server Compact</span><span class="sxs-lookup"><span data-stu-id="eaef1-406">SQL Server Compact</span></span>](https://www.microsoft.com/sqlserver/2008/en/us/compact.aspx)
- [<span data-ttu-id="eaef1-407">Connexion à une base de données SQL Server ou MySQL dans WebMatrix</span><span class="sxs-lookup"><span data-stu-id="eaef1-407">Connecting to a SQL Server or MySQL Database in WebMatrix</span></span>](https://go.microsoft.com/fwlink/?LinkId=208661)
- [<span data-ttu-id="eaef1-408">Validation des entrées utilisateur dans les sites ASP.NET Web Pages</span><span class="sxs-lookup"><span data-stu-id="eaef1-408">Validating User Input in ASP.NET Web Pages Sites</span></span>](https://go.microsoft.com/fwlink/?LinkId=253002)
