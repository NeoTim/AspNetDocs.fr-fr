---
uid: aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
title: 'Atelier pratique : sites Web Azure gérables : gestion des modifications et de la mise à l’échelle | Microsoft Docs'
author: rick-anderson
description: Dans ce laboratoire, Découvrez comment Microsoft Azure facilite la création et le déploiement de sites Web en production.
ms.author: riande
ms.date: 07/16/2014
ms.assetid: ecfd0eb4-c4ad-44e6-9db9-a2a66611ff6a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/maintainable-azure-websites-managing-change-and-scale
msc.type: authoredcontent
ms.openlocfilehash: c88bae40a8aa092037c0b359ee391acaf161cf10
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/06/2020
ms.locfileid: "78624270"
---
# <a name="hands-on-lab-maintainable-azure-websites-managing-change-and-scale"></a><span data-ttu-id="9467c-103">Atelier pratique : sites Web Azure gérables : gestion des modifications et de la mise à l’échelle</span><span class="sxs-lookup"><span data-stu-id="9467c-103">Hands on Lab: Maintainable Azure Websites: Managing Change and Scale</span></span>

<span data-ttu-id="9467c-104">par l' [équipe Web camps](https://twitter.com/webcamps)</span><span class="sxs-lookup"><span data-stu-id="9467c-104">by [Web Camps Team](https://twitter.com/webcamps)</span></span>

[<span data-ttu-id="9467c-105">Télécharger le kit de formation Web camps</span><span class="sxs-lookup"><span data-stu-id="9467c-105">Download Web Camps Training Kit</span></span>](https://aka.ms/webcamps-training-kit)

> <span data-ttu-id="9467c-106">Microsoft Azure facilite la création et le déploiement de sites Web en production.</span><span class="sxs-lookup"><span data-stu-id="9467c-106">Microsoft Azure makes it easy to build and deploy websites to production.</span></span> <span data-ttu-id="9467c-107">Mais vous n’avez pas terminé quand votre application est en ligne, vous venez de commencer !</span><span class="sxs-lookup"><span data-stu-id="9467c-107">But you're not done when your application is live, you're just getting started!</span></span> <span data-ttu-id="9467c-108">Vous devez gérer les besoins en modification, les mises à jour de base de données, la mise à l’échelle, etc.</span><span class="sxs-lookup"><span data-stu-id="9467c-108">You'll need to handle changing requirements, database updates, scale, and more.</span></span> <span data-ttu-id="9467c-109">Heureusement, Azure App Service vous a abordé, avec de nombreuses fonctionnalités pour vous aider à assurer le bon fonctionnement de vos sites.</span><span class="sxs-lookup"><span data-stu-id="9467c-109">Fortunately, Azure App Service has you covered, with plenty of features to help you keep your sites running smoothly.</span></span>
>
> <span data-ttu-id="9467c-110">Azure offre des options de développement, de déploiement et de mise à l’échelle sécurisées et flexibles pour toutes les applications Web de toute taille.</span><span class="sxs-lookup"><span data-stu-id="9467c-110">Azure offers secure and flexible development, deployment and scaling options for any size web application.</span></span> <span data-ttu-id="9467c-111">Servez-vous des outils existants pour créer et déployer des applications sans vous soucier de la gestion de l'infrastructure.</span><span class="sxs-lookup"><span data-stu-id="9467c-111">Leverage your existing tools to create and deploy applications without the hassle of managing infrastructure.</span></span>
>
> <span data-ttu-id="9467c-112">Approvisionnez vous-même une application Web de production en quelques minutes en déployant facilement le contenu créé à l’aide de votre outil de développement préféré.</span><span class="sxs-lookup"><span data-stu-id="9467c-112">Provision a production web application yourself in minutes by easily deploying content created using your favorite development tool.</span></span> <span data-ttu-id="9467c-113">Vous pouvez déployer un site existant directement à partir du contrôle de code source avec la prise en charge de **git**, **GitHub**, **bitbucket**, **tfs**et même **Dropbox**.</span><span class="sxs-lookup"><span data-stu-id="9467c-113">You can deploy an existing site directly from source control with support for **Git**, **GitHub**, **Bitbucket**, **TFS**, and even **DropBox**.</span></span> <span data-ttu-id="9467c-114">Déployez directement à partir de votre IDE favori ou de scripts à l’aide de **PowerShell** dans Windows ou des outils **CLI** exécutés sur n’importe quel système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="9467c-114">Deploy directly from your favorite IDE or from scripts using **PowerShell** in Windows or **CLI** tools running on any OS.</span></span> <span data-ttu-id="9467c-115">Une fois le déploiement terminé, gardez vos sites à jour en permanence grâce à la prise en charge du déploiement continu.</span><span class="sxs-lookup"><span data-stu-id="9467c-115">Once deployed, keep your sites constantly up-to-date with support for continuous deployment.</span></span>
>
> <span data-ttu-id="9467c-116">Azure fournit des solutions de stockage, de sauvegarde et de récupération sur le Cloud évolutives et durables pour toutes les données, grand ou petit.</span><span class="sxs-lookup"><span data-stu-id="9467c-116">Azure provides scalable, durable cloud storage, backup, and recovery solutions for any data, big or small.</span></span> <span data-ttu-id="9467c-117">Lors du déploiement d’applications dans un environnement de production, les services de stockage tels que les tables, les objets BLOB et les bases de données SQL, vous aident à mettre à l’échelle votre application dans le Cloud.</span><span class="sxs-lookup"><span data-stu-id="9467c-117">When deploying applications to a production environment, storage services such as Tables, Blobs and SQL Databases, help you scale your application in the cloud.</span></span>
>
> <span data-ttu-id="9467c-118">Avec les bases de données SQL, il est important de maintenir à jour votre base de données productive lors du déploiement de nouvelles versions de votre application.</span><span class="sxs-lookup"><span data-stu-id="9467c-118">With SQL Databases, it is important to keep your productive database up-to-date when deploying new versions of your application.</span></span> <span data-ttu-id="9467c-119">Grâce à **migrations Entity Framework code First**, le développement et le déploiement de votre modèle de données ont été simplifiés pour mettre à jour vos environnements en quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="9467c-119">Thanks to **Entity Framework Code First Migrations**, the development and deployment of your data model has been simplified to update your environments in minutes.</span></span> <span data-ttu-id="9467c-120">Ce laboratoire pratique vous montrera les différentes rubriques que vous pouvez rencontrer lors du déploiement de votre application Web dans des environnements de production dans Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-120">This hands-on lab will show you the different topics you could encounter when deploying your web app to production environments in Microsoft Azure.</span></span>
>
> <span data-ttu-id="9467c-121">Tous les exemples de code et les extraits de code sont inclus dans le kit de formation Web camps, disponible sur [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span><span class="sxs-lookup"><span data-stu-id="9467c-121">All sample code and snippets are included in the Web Camps Training Kit, available at [https://aka.ms/webcamps-training-kit](https://aka.ms/webcamps-training-kit).</span></span>
>
> <span data-ttu-id="9467c-122">Pour plus d’informations sur cette rubrique, consultez [création d’applications Cloud réalistes avec Azure e-Book](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="9467c-122">For more in-depth coverage of this topic, see the [Building Real-World Cloud Apps with Azure e-book](building-real-world-cloud-apps-with-windows-azure/introduction.md).</span></span>

<a id="Overview"></a>
## <a name="overview"></a><span data-ttu-id="9467c-123">Présentation</span><span class="sxs-lookup"><span data-stu-id="9467c-123">Overview</span></span>

<a id="Objectives"></a>
### <a name="objectives"></a><span data-ttu-id="9467c-124">Objectifs</span><span class="sxs-lookup"><span data-stu-id="9467c-124">Objectives</span></span>

<span data-ttu-id="9467c-125">Dans ce laboratoire pratique, vous allez apprendre à :</span><span class="sxs-lookup"><span data-stu-id="9467c-125">In this hands-on lab, you will learn how to:</span></span>

- <span data-ttu-id="9467c-126">Activer Entity Framework migrations avec un modèle existant</span><span class="sxs-lookup"><span data-stu-id="9467c-126">Enable Entity Framework Migrations with an existing model</span></span>
- <span data-ttu-id="9467c-127">Mettre à jour le modèle objet et la base de données en conséquence à l’aide de Entity Framework migrations</span><span class="sxs-lookup"><span data-stu-id="9467c-127">Update the object model and database accordingly using Entity Framework Migrations</span></span>
- <span data-ttu-id="9467c-128">Déployer sur Azure App Service à l’aide de git</span><span class="sxs-lookup"><span data-stu-id="9467c-128">Deploy to Azure App Service using Git</span></span>
- <span data-ttu-id="9467c-129">Restauration d’un déploiement précédent à l’aide du portail de gestion Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-129">Rollback to a previous deployment using the Azure Management portal</span></span>
- <span data-ttu-id="9467c-130">Utiliser le stockage Azure pour mettre à l’échelle une application Web</span><span class="sxs-lookup"><span data-stu-id="9467c-130">Use Azure Storage to scale a web app</span></span>
- <span data-ttu-id="9467c-131">Configurer la mise à l’échelle automatique pour une application Web à l’aide d’Azure Portail de gestion</span><span class="sxs-lookup"><span data-stu-id="9467c-131">Configure auto-scaling for a web app using the Azure Management Portal</span></span>
- <span data-ttu-id="9467c-132">Créer et configurer un projet de test de charge dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9467c-132">Create and configure a load test project in Visual Studio</span></span>

<a id="Prerequisites"></a>
### <a name="prerequisites"></a><span data-ttu-id="9467c-133">Conditions préalables requises</span><span class="sxs-lookup"><span data-stu-id="9467c-133">Prerequisites</span></span>

<span data-ttu-id="9467c-134">Les éléments suivants sont requis pour effectuer ce laboratoire pratique :</span><span class="sxs-lookup"><span data-stu-id="9467c-134">The following is required to complete this hands-on lab:</span></span>

- <span data-ttu-id="9467c-135">[Visual Studio Express 2013 pour Web](https://www.microsoft.com/visualstudio/) ou version ultérieure</span><span class="sxs-lookup"><span data-stu-id="9467c-135">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/) or greater</span></span>
- [<span data-ttu-id="9467c-136">Kit de développement logiciel (SDK) Azure pour .NET 2,2</span><span class="sxs-lookup"><span data-stu-id="9467c-136">Azure SDK for .NET 2.2</span></span>](https://www.microsoft.com/windowsazure/sdk/)
- [<span data-ttu-id="9467c-137">Système de contrôle de version GIT</span><span class="sxs-lookup"><span data-stu-id="9467c-137">GIT Version Control System</span></span>](http://git-scm.com/download)
- <span data-ttu-id="9467c-138">Un abonnement Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-138">A Microsoft Azure subscription</span></span>

    - <span data-ttu-id="9467c-139">S’inscrire à une [version d’évaluation gratuite](https://aka.ms/watk-freetrial)</span><span class="sxs-lookup"><span data-stu-id="9467c-139">Sign up for a [Free Trial](https://aka.ms/watk-freetrial)</span></span>
    - <span data-ttu-id="9467c-140">Si vous êtes un Visual Studio Professional, Test Professional, Premium ou Ultimate avec MSDN ou Plateformes MSDN abonné, activez votre [avantage MSDN](https://aka.ms/watk-msdn) dès maintenant pour commencer à développer et à tester sur Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-140">If you are a Visual Studio Professional, Test Professional, Premium or Ultimate with MSDN or MSDN Platforms subscriber, activate your [MSDN benefit](https://aka.ms/watk-msdn) now to start developing and testing on Azure</span></span>
    - <span data-ttu-id="9467c-141">Les membres de [BizSpark](https://aka.ms/watk-bizspark) bénéficient automatiquement de l’avantage Azure par le biais de leur abonnement Visual Studio Ultimate avec MSDN</span><span class="sxs-lookup"><span data-stu-id="9467c-141">[BizSpark](https://aka.ms/watk-bizspark) members automatically receive the Azure benefit through their Visual Studio Ultimate with MSDN subscriptions</span></span>
    - <span data-ttu-id="9467c-142">Les membres du programme [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials reçoivent gratuitement des crédits Azure mensuels</span><span class="sxs-lookup"><span data-stu-id="9467c-142">Members of the [Microsoft Partner Network](https://aka.ms/watk-mpn) Cloud Essentials program receive monthly Azure credits at no charge</span></span>

<a id="Setup"></a>
### <a name="setup"></a><span data-ttu-id="9467c-143">Installation</span><span class="sxs-lookup"><span data-stu-id="9467c-143">Setup</span></span>

<span data-ttu-id="9467c-144">Pour exécuter les exercices dans ce laboratoire pratique, vous devez d’abord configurer votre environnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-144">In order to run the exercises in this hands-on lab, you will need to set up your environment first.</span></span>

1. <span data-ttu-id="9467c-145">Ouvrez l’Explorateur Windows et accédez au dossier **source** du laboratoire.</span><span class="sxs-lookup"><span data-stu-id="9467c-145">Open Windows Explorer and browse to the lab's **Source** folder.</span></span>
2. <span data-ttu-id="9467c-146">Cliquez avec le bouton droit sur **Setup. cmd** et sélectionnez **exécuter en tant qu’administrateur** pour lancer le processus d’installation qui va configurer votre environnement et installer les extraits de code Visual Studio pour ce Lab.</span><span class="sxs-lookup"><span data-stu-id="9467c-146">Right-click on **Setup.cmd** and select **Run as administrator** to launch the setup process that will configure your environment and install the Visual Studio code snippets for this lab.</span></span>
3. <span data-ttu-id="9467c-147">Si la boîte de dialogue contrôle de compte d’utilisateur s’affiche, confirmez l’action pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-147">If the User Account Control dialog is shown, confirm the action to proceed.</span></span>

> [!NOTE]
> <span data-ttu-id="9467c-148">Vérifiez que vous avez vérifié toutes les dépendances de ce Lab avant d’exécuter le programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="9467c-148">Make sure you have checked all the dependencies for this lab before running the setup.</span></span>

<a id="CodeSnippets"></a>
### <a name="using-the-code-snippets"></a><span data-ttu-id="9467c-149">Utilisation des extraits de code</span><span class="sxs-lookup"><span data-stu-id="9467c-149">Using the Code Snippets</span></span>

<span data-ttu-id="9467c-150">Tout au long du document Lab, vous serez invité à insérer des blocs de code.</span><span class="sxs-lookup"><span data-stu-id="9467c-150">Throughout the lab document, you will be instructed to insert code blocks.</span></span> <span data-ttu-id="9467c-151">Pour plus de commodité, la majeure partie de ce code est fournie sous la forme d’extraits de Visual Studio Code, auxquels vous pouvez accéder à partir de Visual Studio 2013 pour éviter d’avoir à l’ajouter manuellement.</span><span class="sxs-lookup"><span data-stu-id="9467c-151">For your convenience, most of this code is provided as Visual Studio Code Snippets, which you can access from within Visual Studio 2013 to avoid having to add it manually.</span></span>

> [!NOTE]
> <span data-ttu-id="9467c-152">Chaque exercice est accompagné d’une solution de démarrage située dans le dossier **Begin** de l’exercice, qui vous permet de suivre chaque exercice indépendamment des autres.</span><span class="sxs-lookup"><span data-stu-id="9467c-152">Each exercise is accompanied by a starting solution located in the **Begin** folder of the exercise that allows you to follow each exercise independently of the others.</span></span> <span data-ttu-id="9467c-153">N’oubliez pas que les extraits de code ajoutés au cours d’un exercice sont absents de ces solutions de démarrage et peuvent ne pas fonctionner tant que vous n’avez pas terminé l’exercice.</span><span class="sxs-lookup"><span data-stu-id="9467c-153">Please be aware that the code snippets that are added during an exercise are missing from these starting solutions and may not work until you have completed the exercise.</span></span> <span data-ttu-id="9467c-154">À l’intérieur du code source d’un exercice, vous trouverez également un dossier de **fin** contenant une solution Visual Studio avec le code qui résulte de l’exécution des étapes de l’exercice correspondant.</span><span class="sxs-lookup"><span data-stu-id="9467c-154">Inside the source code for an exercise, you will also find an **End** folder containing a Visual Studio solution with the code that results from completing the steps in the corresponding exercise.</span></span> <span data-ttu-id="9467c-155">Vous pouvez utiliser ces solutions comme conseils si vous avez besoin d’aide supplémentaire au fur et à mesure que vous travaillez dans ce laboratoire pratique.</span><span class="sxs-lookup"><span data-stu-id="9467c-155">You can use these solutions as guidance if you need additional help as you work through this hands-on lab.</span></span>

---

<a id="Exercises"></a>
## <a name="exercises"></a><span data-ttu-id="9467c-156">Exercices</span><span class="sxs-lookup"><span data-stu-id="9467c-156">Exercises</span></span>

<span data-ttu-id="9467c-157">Ce laboratoire pratique comprend les exercices suivants :</span><span class="sxs-lookup"><span data-stu-id="9467c-157">This hands-on lab includes the following exercises:</span></span>

1. [<span data-ttu-id="9467c-158">Utilisation des migrations de Entity Framework</span><span class="sxs-lookup"><span data-stu-id="9467c-158">Using Entity Framework Migrations</span></span>](#Exercise1)
2. [<span data-ttu-id="9467c-159">Déploiement d’une application Web dans un environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="9467c-159">Deploying a Web App to Staging</span></span>](#Exercise2)
3. [<span data-ttu-id="9467c-160">Exécution d’une restauration de déploiement en production</span><span class="sxs-lookup"><span data-stu-id="9467c-160">Performing Deployment Rollback in Production</span></span>](#Exercise3)
4. [<span data-ttu-id="9467c-161">Mise à l’échelle à l’aide du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-161">Scaling Using Azure Storage</span></span>](#Exercise4)
5. <span data-ttu-id="9467c-162">[Utilisation de la mise à l’échelle automatique pour Web Apps](#Exercise5) (facultatif pour Visual Studio 2013 Édition Ultimate)</span><span class="sxs-lookup"><span data-stu-id="9467c-162">[Using Autoscale for Web Apps](#Exercise5) (Optional for Visual Studio 2013 Ultimate edition)</span></span>

<span data-ttu-id="9467c-163">Durée estimée pour effectuer ce laboratoire : **75 minutes**</span><span class="sxs-lookup"><span data-stu-id="9467c-163">Estimated time to complete this lab: **75 minutes**</span></span>

> [!NOTE]
> <span data-ttu-id="9467c-164">Lorsque vous démarrez Visual Studio pour la première fois, vous devez sélectionner l’une des collections de paramètres prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="9467c-164">When you first start Visual Studio, you must select one of the predefined settings collections.</span></span> <span data-ttu-id="9467c-165">Chaque collection prédéfinie est conçue pour correspondre à un style de développement particulier et détermine les dispositions de fenêtres, le comportement de l’éditeur, les extraits de code IntelliSense et les options de boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="9467c-165">Each predefined collection is designed to match a particular development style and determines window layouts, editor behavior, IntelliSense code snippets, and dialog box options.</span></span> <span data-ttu-id="9467c-166">Les procédures de ce laboratoire décrivent les actions nécessaires pour accomplir une tâche donnée dans Visual Studio lors de l’utilisation de la collection de **paramètres de développement généraux** .</span><span class="sxs-lookup"><span data-stu-id="9467c-166">The procedures in this lab describe the actions necessary to accomplish a given task in Visual Studio when using the **General Development Settings** collection.</span></span> <span data-ttu-id="9467c-167">Si vous choisissez une autre collection de paramètres pour votre environnement de développement, il peut y avoir des différences entre les étapes que vous devez prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="9467c-167">If you choose a different settings collection for your development environment, there may be differences in the steps that you should take into account.</span></span>

<a id="Exercise1"></a>
### <a name="exercise-1-using-entity-framework-migrations"></a><span data-ttu-id="9467c-168">Exercice 1 : utilisation de Entity Framework migrations</span><span class="sxs-lookup"><span data-stu-id="9467c-168">Exercise 1: Using Entity Framework Migrations</span></span>

<span data-ttu-id="9467c-169">Lorsque vous développez une application, votre modèle de données peut changer au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="9467c-169">When you are developing an application, your data model might change over time.</span></span> <span data-ttu-id="9467c-170">Ces modifications peuvent affecter le modèle existant dans votre base de données (si vous créez une nouvelle version) et il est important de maintenir votre base de données à jour pour éviter les erreurs.</span><span class="sxs-lookup"><span data-stu-id="9467c-170">These changes could affect the existing model in your database (if you are creating a new version) and it is important to keep your database up-to-date to prevent errors.</span></span>

<span data-ttu-id="9467c-171">Pour simplifier le suivi de ces modifications dans votre modèle, **migrations Entity Framework code First** détecter automatiquement les modifications en comparant votre modèle au schéma de la base de données et génère du code spécifique pour mettre à jour votre base de données et créer de nouvelles *versions* de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-171">To simplify the tracking of these changes in your model, **Entity Framework Code First Migrations** automatically detect changes comparing your model with the database schema and generates specific code to update your database, creating new *versions* of your database.</span></span>

<span data-ttu-id="9467c-172">Cet exercice vous montre comment activer des **migrations** pour votre application et comment vous pouvez facilement détecter et générer des modifications pour mettre à jour vos bases de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-172">This exercise shows you how to enable **Migrations** for your application and how you can easily detect and generate changes to update your databases.</span></span>

<a id="Ex1Task1"></a>
#### <a name="task-1--enabling-migrations"></a><span data-ttu-id="9467c-173">Tâche 1 : activation des migrations</span><span class="sxs-lookup"><span data-stu-id="9467c-173">Task 1 – Enabling Migrations</span></span>

<span data-ttu-id="9467c-174">Dans cette tâche, vous allez passer en revue les étapes d’activation de la **migrations Entity Framework code First** à la base de données des **quiz des passionnés** , à modifier le modèle et à comprendre comment ces modifications sont reflétées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-174">In this task, you will go through the steps of enabling **Entity Framework Code First Migrations** to the **Geek Quiz** database, changing the model and understanding how those changes are reflected in the database.</span></span>

1. <span data-ttu-id="9467c-175">Ouvrez Visual Studio et ouvrez le fichier solution **GeekQuiz. sln** à partir de **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span><span class="sxs-lookup"><span data-stu-id="9467c-175">Open Visual Studio and open the **GeekQuiz.sln** solution file from **Source\Ex1-UsingEntityFrameworkMigrations\Begin**.</span></span>
2. <span data-ttu-id="9467c-176">Générez la solution afin de télécharger et d’installer les dépendances du package **NuGet** .</span><span class="sxs-lookup"><span data-stu-id="9467c-176">Build the solution in order to download and install the **NuGet** package dependencies.</span></span> <span data-ttu-id="9467c-177">Pour ce faire, cliquez avec le bouton droit sur la solution, puis cliquez sur **générer la solution** ou appuyez sur **Ctrl + Maj + B**.</span><span class="sxs-lookup"><span data-stu-id="9467c-177">To do this, right-click the solution and click **Build Solution** or press **Ctrl + Shift + B**.</span></span>
3. <span data-ttu-id="9467c-178">Dans le menu **Outils** de Visual Studio, sélectionnez **Gestionnaire de package NuGet**, puis cliquez sur **console du gestionnaire de package**.</span><span class="sxs-lookup"><span data-stu-id="9467c-178">From the **Tools** menu in Visual Studio, select **NuGet Package Manager**, and then click **Package Manager Console**.</span></span>
4. <span data-ttu-id="9467c-179">Dans la **console du gestionnaire de package**, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-179">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="9467c-180">Une migration initiale basée sur le modèle existant sera créée.</span><span class="sxs-lookup"><span data-stu-id="9467c-180">An initial migration based on the existing model will be created.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample1.ps1)]

    <span data-ttu-id="9467c-181">![Activation des migrations](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Activation des migrations")</span><span class="sxs-lookup"><span data-stu-id="9467c-181">![Enabling Migrations](maintainable-azure-websites-managing-change-and-scale/_static/image1.png "Enabling Migrations")</span></span>

    <span data-ttu-id="9467c-182">*Activation des migrations*</span><span class="sxs-lookup"><span data-stu-id="9467c-182">*Enabling Migrations*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-183">Cette commande ajoute un dossier **migrations** au projet de quiz de l’initiateur qui contient un fichier appelé **Configuration.cs**.</span><span class="sxs-lookup"><span data-stu-id="9467c-183">This command adds a **Migrations** folder to Geek Quiz project that contains a file called **Configuration.cs**.</span></span> <span data-ttu-id="9467c-184">La classe de **configuration** vous permet de configurer le comportement des migrations pour votre contexte.</span><span class="sxs-lookup"><span data-stu-id="9467c-184">The **Configuration** class allows you to configure how Migrations behaves for your context.</span></span>
5. <span data-ttu-id="9467c-185">Lorsque la migration est activée, vous devez mettre à jour la classe de **configuration** pour remplir la base de données avec les données initiales requises par le **quiz** de l’inverseur.</span><span class="sxs-lookup"><span data-stu-id="9467c-185">With Migrations enabled, you need to update the **Configuration** class to populate the database with the initial data that **Geek Quiz** requires.</span></span> <span data-ttu-id="9467c-186">Sous **migrations**, remplacez le fichier **Configuration.cs** par celui qui se trouve dans le dossier **Source\Assets** de ce Lab.</span><span class="sxs-lookup"><span data-stu-id="9467c-186">Under **Migrations**, replace the **Configuration.cs** file with the one located in the **Source\Assets** folder of this lab.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-187">Étant donné que les **migrations** appellent la méthode **Seed** avec chaque mise à jour de base de données, vous devez vous assurer que les enregistrements ne sont pas dupliqués dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-187">Since **Migrations** will call the **Seed** method with every database update, you need to be sure that records are not duplicated in the database.</span></span> <span data-ttu-id="9467c-188">La méthode **AddOrUpdate** permet d’éviter les doublons de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-188">The **AddOrUpdate** method will help to prevent duplicate data.</span></span>
6. <span data-ttu-id="9467c-189">Pour ajouter une migration initiale, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-189">To add an initial migration, enter the following command and then press **Enter**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-190">Assurez-vous qu’il n’existe aucune base de données nommée &quot;GeekQuizProd&quot; dans votre instance de base de données locale.</span><span class="sxs-lookup"><span data-stu-id="9467c-190">Make sure that there is no database named &quot;GeekQuizProd&quot; in your LocalDB instance.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample2.ps1)]

    <span data-ttu-id="9467c-191">![Ajout d’une migration de schéma de base](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Ajout d’une migration de schéma de base")</span><span class="sxs-lookup"><span data-stu-id="9467c-191">![Adding base schema migration](maintainable-azure-websites-managing-change-and-scale/_static/image2.png "Adding base schema migration")</span></span>

    <span data-ttu-id="9467c-192">*Ajout d’une migration de schéma de base*</span><span class="sxs-lookup"><span data-stu-id="9467c-192">*Adding base schema migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-193">**Add-migration génère une** structure de la prochaine migration en fonction des modifications que vous avez apportées à votre modèle depuis la création de la dernière migration.</span><span class="sxs-lookup"><span data-stu-id="9467c-193">**Add-Migration** will scaffold the next migration based on changes you have made to your model since the last migration was created.</span></span> <span data-ttu-id="9467c-194">Dans ce cas, comme c’est la première migration du projet, il ajoute les scripts pour créer toutes les tables définies dans la classe **TriviaContext** .</span><span class="sxs-lookup"><span data-stu-id="9467c-194">In this case, as it is the first migration of the project, it will add the scripts to create all the tables defined in the **TriviaContext** class.</span></span>
7. <span data-ttu-id="9467c-195">Exécutez la migration pour mettre à jour la base de données en exécutant la commande suivante.</span><span class="sxs-lookup"><span data-stu-id="9467c-195">Execute the migration to update the database by running the following command.</span></span> <span data-ttu-id="9467c-196">Pour cette commande, vous allez spécifier l’indicateur **Verbose** pour afficher les instructions SQL appliquées à la base de données cible.</span><span class="sxs-lookup"><span data-stu-id="9467c-196">For this command you will specify the **Verbose** flag to view the SQL statements being applied to the target database.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample3.ps1)]

    <span data-ttu-id="9467c-197">![Création de la base de données initiale](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Création de la base de données initiale")</span><span class="sxs-lookup"><span data-stu-id="9467c-197">![Creating initial database](maintainable-azure-websites-managing-change-and-scale/_static/image3.png "Creating initial database")</span></span>

    <span data-ttu-id="9467c-198">*Création de la base de données initiale*</span><span class="sxs-lookup"><span data-stu-id="9467c-198">*Creating initial database*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-199">**Update-Database** appliquera toutes les migrations en attente à la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-199">**Update-Database** will apply any pending migrations to the database.</span></span> <span data-ttu-id="9467c-200">Dans ce cas, la base de données est créée à l’aide de la chaîne de connexion définie dans votre fichier Web. config.</span><span class="sxs-lookup"><span data-stu-id="9467c-200">In this case, it will create the database using the connection string defined in your web.config file.</span></span>
8. <span data-ttu-id="9467c-201">Accédez au menu **affichage** et ouvrez **Explorateur d’objets SQL Server**.</span><span class="sxs-lookup"><span data-stu-id="9467c-201">Go to **View** menu and open **SQL Server Object Explorer**.</span></span>

    <span data-ttu-id="9467c-202">![Ouvrir dans Explorateur d’objets SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Ouvrir dans Explorateur d’objets SQL Server")</span><span class="sxs-lookup"><span data-stu-id="9467c-202">![Open in SQL Server Object Explorer](maintainable-azure-websites-managing-change-and-scale/_static/image4.png "Open in SQL Server Object Explorer")</span></span>

    <span data-ttu-id="9467c-203">*Ouvrir dans Explorateur d’objets SQL Server*</span><span class="sxs-lookup"><span data-stu-id="9467c-203">*Open in SQL Server Object Explorer*</span></span>
9. <span data-ttu-id="9467c-204">Dans la fenêtre **Explorateur d’objets SQL Server** , connectez-vous à votre instance de base de données locale en cliquant avec le bouton droit sur le nœud **SQL Server** et en sélectionnant l’option **Ajouter un SQL Server...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-204">In the **SQL Server Object Explorer** window, connect to your LocalDB instance by right-clicking the **SQL Server** node and selecting **Add SQL Server...** option.</span></span>

    <span data-ttu-id="9467c-205">![Ajout d’une instance de SQL Server](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Ajout d’une instance de SQL Server")</span><span class="sxs-lookup"><span data-stu-id="9467c-205">![Adding a SQL Server Instance](maintainable-azure-websites-managing-change-and-scale/_static/image5.png "Adding a SQL Server Instance")</span></span>

    <span data-ttu-id="9467c-206">*Ajout d’une instance de SQL Server à Explorateur d’objets SQL Server*</span><span class="sxs-lookup"><span data-stu-id="9467c-206">*Adding a SQL Server instance to SQL Server Object Explorer*</span></span>
10. <span data-ttu-id="9467c-207">Définissez le **nom du serveur** sur *(\v11.0)* et laissez **authentification Windows** comme mode d’authentification.</span><span class="sxs-lookup"><span data-stu-id="9467c-207">Set the **server name** to *(localdb)\v11.0* and leave **Windows Authentication** as your authentication mode.</span></span> <span data-ttu-id="9467c-208">Cliquez sur **Connect** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-208">Click **Connect** to continue.</span></span>

    <span data-ttu-id="9467c-209">![Connexion à la base de données locale](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Connexion à la base de données locale")</span><span class="sxs-lookup"><span data-stu-id="9467c-209">![Connecting to LocalDB](maintainable-azure-websites-managing-change-and-scale/_static/image6.png "Connecting to LocalDB")</span></span>

    <span data-ttu-id="9467c-210">*Connexion à la base de données locale*</span><span class="sxs-lookup"><span data-stu-id="9467c-210">*Connecting to LocalDB*</span></span>
11. <span data-ttu-id="9467c-211">Ouvrez la base de données **GeekQuizProd** et développez le nœud **tables** .</span><span class="sxs-lookup"><span data-stu-id="9467c-211">Open the **GeekQuizProd** database and expand the **Tables** node.</span></span> <span data-ttu-id="9467c-212">Comme vous pouvez le voir, la commande **Update-Database** a généré toutes les tables définies dans la classe **TriviaContext** .</span><span class="sxs-lookup"><span data-stu-id="9467c-212">As you can see, the **Update-Database** command generated all the tables defined in the **TriviaContext** class.</span></span> <span data-ttu-id="9467c-213">Localisez le **dbo. Table TriviaQuestions** et ouvrez le nœud Columns.</span><span class="sxs-lookup"><span data-stu-id="9467c-213">Locate the **dbo.TriviaQuestions** table and open the columns node.</span></span> <span data-ttu-id="9467c-214">Dans la tâche suivante, vous allez ajouter une nouvelle colonne à cette table et mettre à jour la base de données à l’aide des **migrations**.</span><span class="sxs-lookup"><span data-stu-id="9467c-214">In the next task, you will add a new column to this table and update the database using **Migrations**.</span></span>

    <span data-ttu-id="9467c-215">![Colonnes de questions de questions](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Colonnes de questions de questions")</span><span class="sxs-lookup"><span data-stu-id="9467c-215">![Trivia Questions Columns](maintainable-azure-websites-managing-change-and-scale/_static/image7.png "Trivia Questions Columns")</span></span>

    <span data-ttu-id="9467c-216">*Colonnes de questions de questions*</span><span class="sxs-lookup"><span data-stu-id="9467c-216">*Trivia Questions Columns*</span></span>

<a id="Ex1Task2"></a>
#### <a name="task-2--updating-database-schema-using-migrations"></a><span data-ttu-id="9467c-217">Tâche 2 : mise à jour du schéma de base de données à l’aide des migrations</span><span class="sxs-lookup"><span data-stu-id="9467c-217">Task 2 – Updating Database Schema Using Migrations</span></span>

<span data-ttu-id="9467c-218">Dans cette tâche, vous allez utiliser **migrations Entity Framework code First** pour détecter une modification dans votre modèle et générer le code nécessaire pour mettre à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-218">In this task, you will use **Entity Framework Code First Migrations** to detect a change in your model and generate the necessary code to update the database.</span></span> <span data-ttu-id="9467c-219">Vous allez mettre à jour l’entité **TriviaQuestions** en lui ajoutant une nouvelle propriété.</span><span class="sxs-lookup"><span data-stu-id="9467c-219">You will update the **TriviaQuestions** entity by adding a new property to it.</span></span> <span data-ttu-id="9467c-220">Ensuite, vous allez exécuter des commandes pour créer une nouvelle migration afin d’inclure la nouvelle colonne dans la table.</span><span class="sxs-lookup"><span data-stu-id="9467c-220">Then you will run commands to create a new Migration to include the new column in the table.</span></span>

1. <span data-ttu-id="9467c-221">Dans **Explorateur de solutions**, double-cliquez sur le fichier **TriviaQuestion.cs** situé dans le dossier **modèles** .</span><span class="sxs-lookup"><span data-stu-id="9467c-221">In **Solution Explorer**, double-click the **TriviaQuestion.cs** file located inside the **Models** folder.</span></span>
2. <span data-ttu-id="9467c-222">Ajoutez une nouvelle propriété nommée **Hint**, comme illustré dans l’extrait de code suivant.</span><span class="sxs-lookup"><span data-stu-id="9467c-222">Add a new property named **Hint**, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample4.cs)]
3. <span data-ttu-id="9467c-223">Dans la **console du gestionnaire de package**, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-223">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span> <span data-ttu-id="9467c-224">Une nouvelle migration sera créée pour refléter la modification apportée à notre modèle.</span><span class="sxs-lookup"><span data-stu-id="9467c-224">A new migration will be created reflecting the change in our model.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample5.ps1)]

    <span data-ttu-id="9467c-225">![Ajouter une migration](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Ajouter une migration")</span><span class="sxs-lookup"><span data-stu-id="9467c-225">![Add-Migration](maintainable-azure-websites-managing-change-and-scale/_static/image8.png "Add-Migration")</span></span>

    <span data-ttu-id="9467c-226">*Ajouter une migration*</span><span class="sxs-lookup"><span data-stu-id="9467c-226">*Add-Migration*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-227">Un fichier de migration est composé de deux méthodes, **vers le haut et vers le** **haut** .</span><span class="sxs-lookup"><span data-stu-id="9467c-227">A Migration file is composed of two methods, **Up** and **Down**.</span></span>
    >
    > - <span data-ttu-id="9467c-228">La méthode **up** sera utilisée pour spécifier les modifications que la version actuelle de notre application doit appliquer à la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-228">The **Up** method will be used to specify what changes the current version of our application need to apply to the database.</span></span>
    > - <span data-ttu-id="9467c-229">La valeur **vers** le haut permet d’inverser les modifications que nous avons ajoutées à la méthode **up** .</span><span class="sxs-lookup"><span data-stu-id="9467c-229">The **Down** is used to reverse the changes we have added to the **Up** method.</span></span>
    >
    > <span data-ttu-id="9467c-230">Lorsque la migration de base de données met à jour la base de données, elle exécute toutes les migrations dans l’ordre d’horodatage, et uniquement celles qui n’ont pas été utilisées depuis la dernière mise à jour (la table \_MigrationHistory assure le suivi des migrations qui ont été appliquées).</span><span class="sxs-lookup"><span data-stu-id="9467c-230">When the Database Migration updates the database, it will run all migrations in the timestamp order, and only those that have not been used since the last update (The \_MigrationHistory table keeps track of which migrations have been applied).</span></span> <span data-ttu-id="9467c-231">La méthode **up** de toutes les migrations sera appelée et effectuera les modifications que nous avons spécifiées dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="9467c-231">The **Up** method of all migrations will be called and will make the changes we have specified to the database.</span></span> <span data-ttu-id="9467c-232">Si nous décidons de revenir à une migration précédente, la méthode **UpDown** sera appelée pour rétablir les modifications dans l’ordre inverse.</span><span class="sxs-lookup"><span data-stu-id="9467c-232">If we decide to go back to a previous migration, the **Down** method will be called to redo the changes in a reverse order.</span></span>
4. <span data-ttu-id="9467c-233">Dans la **console du gestionnaire de package**, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-233">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample6.ps1)]
5. <span data-ttu-id="9467c-234">La sortie de la commande **Update-Database** a généré une instruction **ALTER TABLE** SQL pour ajouter une nouvelle colonne à la table **TriviaQuestions** , comme indiqué dans l’image ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="9467c-234">The output of the **Update-Database** command generated an **Alter Table** SQL statement to add a new column to the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="9467c-235">![Instruction SQL d’ajout de colonne générée](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Instruction SQL d’ajout de colonne générée")</span><span class="sxs-lookup"><span data-stu-id="9467c-235">![Add column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image9.png "Add column SQL statement generated")</span></span>

    <span data-ttu-id="9467c-236">*Instruction SQL d’ajout de colonne générée*</span><span class="sxs-lookup"><span data-stu-id="9467c-236">*Add column SQL statement generated*</span></span>
6. <span data-ttu-id="9467c-237">Dans **Explorateur d’objets SQL Server**, actualisez le **dbo. Table TriviaQuestions** et vérifiez que la nouvelle colonne **Hint** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="9467c-237">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the new **Hint** column is displayed.</span></span>

    <span data-ttu-id="9467c-238">![Présentation de la nouvelle colonne d’indicateur](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Présentation de la nouvelle colonne d’indicateur")</span><span class="sxs-lookup"><span data-stu-id="9467c-238">![Showing the new Hint Column](maintainable-azure-websites-managing-change-and-scale/_static/image10.png "Showing the new Hint Column")</span></span>

    <span data-ttu-id="9467c-239">*Présentation de la nouvelle colonne d’indicateur*</span><span class="sxs-lookup"><span data-stu-id="9467c-239">*Showing the new Hint Column*</span></span>
7. <span data-ttu-id="9467c-240">De retour dans l’éditeur **TriviaQuestion.cs** , ajoutez une contrainte **StringLength** à la propriété *Hint* , comme indiqué dans l’extrait de code suivant.</span><span class="sxs-lookup"><span data-stu-id="9467c-240">Back in the **TriviaQuestion.cs** editor, add a **StringLength** constraint to the *Hint* property, as shown in the following code snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample7.cs)]
8. <span data-ttu-id="9467c-241">Dans la **console du gestionnaire de package**, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-241">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample8.ps1)]
9. <span data-ttu-id="9467c-242">Dans la **console du gestionnaire de package**, entrez la commande suivante, puis appuyez sur **entrée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-242">In the **Package Manager Console**, enter the following command and then press **Enter**.</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample9.ps1)]
10. <span data-ttu-id="9467c-243">La sortie de la commande **Update-Database** a généré une instruction **ALTER TABLE** SQL pour mettre à jour le type de colonne *Hint* de la table **TriviaQuestions** , comme indiqué dans l’image ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="9467c-243">The output of the **Update-Database** command generated an **Alter Table** SQL statement to update the *hint* column type of the **TriviaQuestions** table, as shown in the image below.</span></span>

    <span data-ttu-id="9467c-244">![Instruction SQL ALTER COLUMN générée](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Instruction SQL ALTER COLUMN générée")</span><span class="sxs-lookup"><span data-stu-id="9467c-244">![Alter column SQL statement generated](maintainable-azure-websites-managing-change-and-scale/_static/image11.png "Alter column SQL statement generated")</span></span>

    <span data-ttu-id="9467c-245">*Instruction SQL ALTER COLUMN générée*</span><span class="sxs-lookup"><span data-stu-id="9467c-245">*Alter column SQL statement generated*</span></span>
11. <span data-ttu-id="9467c-246">Dans **Explorateur d’objets SQL Server**, actualisez le **dbo. Table TriviaQuestions** et vérifiez que le type de colonne **Hint** est **nvarchar (150)** .</span><span class="sxs-lookup"><span data-stu-id="9467c-246">In **SQL Server Object Explorer**, refresh the **dbo.TriviaQuestions** table and check that the **Hint** column type is **nvarchar(150)**.</span></span>

    <span data-ttu-id="9467c-247">![Présentation de la nouvelle contrainte](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Présentation de la nouvelle contrainte")</span><span class="sxs-lookup"><span data-stu-id="9467c-247">![Showing the new constraint](maintainable-azure-websites-managing-change-and-scale/_static/image12.png "Showing the new constraint")</span></span>

    <span data-ttu-id="9467c-248">*Présentation de la nouvelle contrainte*</span><span class="sxs-lookup"><span data-stu-id="9467c-248">*Showing the new constraint*</span></span>

<a id="Exercise2"></a>
### <a name="exercise-2-deploying-a-web-app-to-staging"></a><span data-ttu-id="9467c-249">Exercice 2 : déploiement d’une application Web dans un environnement intermédiaire</span><span class="sxs-lookup"><span data-stu-id="9467c-249">Exercise 2: Deploying a Web App to Staging</span></span>

<span data-ttu-id="9467c-250">**Web Apps dans Azure App service** vous permet d’effectuer une publication intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-250">**Web Apps in Azure App Service** enables you to perform staged publishing.</span></span> <span data-ttu-id="9467c-251">La publication intermédiaire crée un emplacement de site intermédiaire pour chaque site de production par défaut et vous permet d’échanger ces emplacements sans temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="9467c-251">Staged publishing creates a staging site slot for each default production site and enables you to swap these slots with no down time.</span></span> <span data-ttu-id="9467c-252">Cela est très utile pour valider les modifications avant de les publier dans le public, pour intégrer de façon incrémentielle le contenu du site et pour restaurer si les modifications ne fonctionnent pas comme prévu.</span><span class="sxs-lookup"><span data-stu-id="9467c-252">This is really useful to validate changes before releasing to the public, incrementally integrate site content, and roll back if changes are not working as expected.</span></span>

<span data-ttu-id="9467c-253">Dans cet exercice, vous allez déployer l’application **quiz du test** sur l’environnement intermédiaire de votre application Web à l’aide du contrôle de code source git.</span><span class="sxs-lookup"><span data-stu-id="9467c-253">In this exercise, you will deploy the **Geek Quiz** application to the staging environment of your web app using Git source control.</span></span> <span data-ttu-id="9467c-254">Pour ce faire, vous allez créer l’application Web et approvisionner les composants requis dans le portail de gestion, configurer un référentiel **git** et transmettre le code source de l’application de votre ordinateur local vers l’emplacement intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-254">To do this, you will create the web app and provision the required components at the management portal, configure a **Git** repository and push the application source code from your local computer to the staging slot.</span></span> <span data-ttu-id="9467c-255">Vous allez également mettre à jour votre base de données de production avec le **migrations code First** que vous avez créé dans l’exercice précédent.</span><span class="sxs-lookup"><span data-stu-id="9467c-255">You will also update your production database with the **Code First Migrations** you created in the previous exercise.</span></span> <span data-ttu-id="9467c-256">Vous allez ensuite exécuter l’application dans cet environnement de test pour vérifier son fonctionnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-256">You will then execute the application in this test environment to verify its operation.</span></span> <span data-ttu-id="9467c-257">Une fois que vous êtes satisfait de votre travail en fonction de vos attentes, vous allez promouvoir l’application en production.</span><span class="sxs-lookup"><span data-stu-id="9467c-257">Once you are satisfied that it is working according to your expectations, you will promote the application to production.</span></span>

> [!NOTE]
> <span data-ttu-id="9467c-258">Pour activer la publication intermédiaire, l’application Web doit être en **mode standard**.</span><span class="sxs-lookup"><span data-stu-id="9467c-258">To enable staged publishing, the web app must be in **Standard mode**.</span></span> <span data-ttu-id="9467c-259">Notez que des frais supplémentaires seront facturés si vous passez votre application Web en mode standard.</span><span class="sxs-lookup"><span data-stu-id="9467c-259">Note that additional charges will be incurred if you change your web app to Standard mode.</span></span> <span data-ttu-id="9467c-260">Pour plus d’informations sur la tarification, consultez [app service tarification](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="9467c-260">For more information about pricing, see [App Service Pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<a id="Ex2Task1"></a>
#### <a name="task-1--creating-a-web-app-in-azure-app-service"></a><span data-ttu-id="9467c-261">Tâche 1 : création d’une application Web dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="9467c-261">Task 1 – Creating a Web App in Azure App Service</span></span>

<span data-ttu-id="9467c-262">Au cours de cette tâche, vous allez créer une application Web dans **Azure App service** à partir du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-262">In this task, you will create a web app in **Azure App Service** from the management portal.</span></span> <span data-ttu-id="9467c-263">Vous allez également configurer un **SQL Database** pour conserver les données d’application et configurer un référentiel Git local pour le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="9467c-263">You will also configure a **SQL Database** to persist the application data, and configure a local Git repository for source control.</span></span>

1. <span data-ttu-id="9467c-264">Accédez au [portail de gestion Azure](https://manage.windowsazure.com) et connectez-vous à l’aide de la compte Microsoft associée à votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-264">Go to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>

    ![Connectez-vous au portail de gestion Azure](maintainable-azure-websites-managing-change-and-scale/_static/image13.png)

    <span data-ttu-id="9467c-266">*Connectez-vous au portail de gestion Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-266">*Sign in to the Azure management portal*</span></span>
2. <span data-ttu-id="9467c-267">Cliquez sur **nouveau** dans la barre de commandes en bas de la page.</span><span class="sxs-lookup"><span data-stu-id="9467c-267">Click **New** in the command bar at the bottom of the page.</span></span>

    <span data-ttu-id="9467c-268">![Création d’une nouvelle application Web](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Création d’une nouvelle application Web")</span><span class="sxs-lookup"><span data-stu-id="9467c-268">![Creating a new web app](maintainable-azure-websites-managing-change-and-scale/_static/image14.png "Creating a new web app")</span></span>

    <span data-ttu-id="9467c-269">*Création d’une nouvelle application Web*</span><span class="sxs-lookup"><span data-stu-id="9467c-269">*Creating a new web app*</span></span>
3. <span data-ttu-id="9467c-270">Cliquez sur **calcul**, **site Web** , puis sur **création personnalisée**.</span><span class="sxs-lookup"><span data-stu-id="9467c-270">Click **Compute**, **Website** and then **Custom Create**.</span></span>

    <span data-ttu-id="9467c-271">![Création d’une application Web à l’aide de la création personnalisée](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Création d’une application Web à l’aide de la création personnalisée")</span><span class="sxs-lookup"><span data-stu-id="9467c-271">![Creating a new web app using Custom Create](maintainable-azure-websites-managing-change-and-scale/_static/image15.png "Creating a new web app using Custom Create")</span></span>

    <span data-ttu-id="9467c-272">*Création d’une application Web à l’aide de la création personnalisée*</span><span class="sxs-lookup"><span data-stu-id="9467c-272">*Creating a new web app using Custom Create*</span></span>
4. <span data-ttu-id="9467c-273">Dans la boîte de dialogue **nouveau site Web-création personnalisée** , indiquez une **URL** disponible (par exemple, *quiz-quiz*), sélectionnez un emplacement dans la liste déroulante **région** , puis sélectionnez **créer une base de données SQL** dans la liste déroulante **base de données** .</span><span class="sxs-lookup"><span data-stu-id="9467c-273">In the **New Website - Custom Create** dialog box, provide an available **URL** (e.g. *geek-quiz*), select a location in the **Region** drop-down list, and select **Create a new SQL database** in the **Database** drop-down list.</span></span> <span data-ttu-id="9467c-274">Enfin, activez la case à cocher **publier à partir du contrôle de code source** , puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-274">Finally, select the **Publish from source control** check box and click **Next**.</span></span>

    ![Personnalisation de la nouvelle application Web](maintainable-azure-websites-managing-change-and-scale/_static/image16.png)

    <span data-ttu-id="9467c-276">*Personnalisation de la nouvelle application Web*</span><span class="sxs-lookup"><span data-stu-id="9467c-276">*Customizing the new web app*</span></span>
5. <span data-ttu-id="9467c-277">Spécifiez les informations suivantes pour les paramètres de base de données :</span><span class="sxs-lookup"><span data-stu-id="9467c-277">Specify the following information for the database settings:</span></span>

   - <span data-ttu-id="9467c-278">Dans la zone de texte **nom** , entrez un nom de base de données (par exemple, *geekquiz\_DB*).</span><span class="sxs-lookup"><span data-stu-id="9467c-278">In the **Name** text box, enter a database name (e.g. *geekquiz\_db*)</span></span>
   - <span data-ttu-id="9467c-279">Dans la liste **déroulante** serveur, sélectionnez **nouveau serveur de base de données SQL**.</span><span class="sxs-lookup"><span data-stu-id="9467c-279">In the Server **drop-down** list, select **New SQL database server**.</span></span> <span data-ttu-id="9467c-280">Vous pouvez également sélectionner un serveur existant.</span><span class="sxs-lookup"><span data-stu-id="9467c-280">Alternatively, you can select an existing server.</span></span>
   - <span data-ttu-id="9467c-281">Dans les zones **nom d’utilisateur** et **mot de passe** de la base de données, entrez le nom d’utilisateur et le mot de passe de l’administrateur pour le serveur SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9467c-281">In the **Database username** and **Database password** boxes, enter the administrator username and password for the SQL database server.</span></span> <span data-ttu-id="9467c-282">Si vous sélectionnez un serveur que vous avez déjà créé, vous êtes invité à entrer le mot de passe.</span><span class="sxs-lookup"><span data-stu-id="9467c-282">If you select a server you have already created, you will be prompted for the password.</span></span>

     ![Spécification des paramètres de base de données](maintainable-azure-websites-managing-change-and-scale/_static/image17.png)

     <span data-ttu-id="9467c-284">*Spécification des paramètres de base de données*</span><span class="sxs-lookup"><span data-stu-id="9467c-284">*Specifying the database settings*</span></span>
6. <span data-ttu-id="9467c-285">Cliquez sur **Suivant** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-285">Click **Next** to continue.</span></span>
7. <span data-ttu-id="9467c-286">Sélectionnez **référentiel Git local** pour le contrôle de code source à utiliser, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-286">Select **Local Git repository** for the source control to use and click **Next**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-287">Vous pouvez être invité à entrer les informations d’identification de déploiement (un nom d’utilisateur et un mot de passe).</span><span class="sxs-lookup"><span data-stu-id="9467c-287">You may be prompted for the deployment credentials (a username and password).</span></span>

    ![Création du dépôt git](maintainable-azure-websites-managing-change-and-scale/_static/image18.png)

    <span data-ttu-id="9467c-289">*Création du dépôt git*</span><span class="sxs-lookup"><span data-stu-id="9467c-289">*Creating the Git repository*</span></span>
8. <span data-ttu-id="9467c-290">Attendez que la création de l’application Web soit créée.</span><span class="sxs-lookup"><span data-stu-id="9467c-290">Wait until the new web app is created.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-291">Par défaut, Azure fournit des domaines sur *azurewebsites.net* , mais vous donne également la possibilité de définir des domaines personnalisés à l’aide du portail de gestion Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-291">By default, Azure provides domains at *azurewebsites.net* but also gives you the possibility to set custom domains using the Azure management portal.</span></span> <span data-ttu-id="9467c-292">Toutefois, vous ne pouvez gérer des domaines personnalisés que si vous utilisez certains modes de Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="9467c-292">However, you can only manage custom domains if you are using certain Azure App Service modes.</span></span>
    >
    > <span data-ttu-id="9467c-293">Azure App Service est disponible dans les éditions gratuit, partagé, de base, standard et Premium.</span><span class="sxs-lookup"><span data-stu-id="9467c-293">Azure App Service is available in Free, Shared, Basic, Standard, and Premium editions.</span></span> <span data-ttu-id="9467c-294">En mode gratuit et partagé, toutes les applications Web s’exécutent dans un environnement multi-locataire et ont des quotas pour l’utilisation du processeur, de la mémoire et du réseau.</span><span class="sxs-lookup"><span data-stu-id="9467c-294">In Free and Shared mode, all web apps run in a multi-tenant environment and have quotas for CPU, Memory, and Network usage.</span></span> <span data-ttu-id="9467c-295">Le nombre maximal d’applications gratuites peut varier en fonction de votre plan.</span><span class="sxs-lookup"><span data-stu-id="9467c-295">The maximum number of free apps may vary with your plan.</span></span> <span data-ttu-id="9467c-296">En mode standard, vous choisissez les applications qui s’exécutent sur des machines virtuelles dédiées qui correspondent aux ressources de calcul Azure standard.</span><span class="sxs-lookup"><span data-stu-id="9467c-296">In Standard mode, you choose which apps run on dedicated virtual machines that correspond to the standard Azure compute resources.</span></span> <span data-ttu-id="9467c-297">Vous pouvez trouver la configuration du mode d’application Web dans le menu mettre à l' **échelle** de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-297">You can find the web app mode configuration in the **Scale** menu of your web app.</span></span>
    >
    > <span data-ttu-id="9467c-298">![Modes de Azure App Service](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Modes de Azure App Service")</span><span class="sxs-lookup"><span data-stu-id="9467c-298">![Azure App Service Modes](maintainable-azure-websites-managing-change-and-scale/_static/image19.png "Azure App Service Modes")</span></span>
    >
    > <span data-ttu-id="9467c-299">Si vous utilisez le mode **partagé** ou **standard** , vous serez en mesure de gérer des domaines personnalisés pour votre application Web en accédant au menu **configurer** de votre application et en cliquant sur **gérer les domaines** sous noms de *domaine*.</span><span class="sxs-lookup"><span data-stu-id="9467c-299">If you are using **Shared** or **Standard** mode, you will be able to manage custom domains for your web app by going to your app's **Configure** menu and clicking **Manage Domains** under *domain names*.</span></span>
    >
    > <span data-ttu-id="9467c-300">![Gérer les domaines](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Gérer les domaines")</span><span class="sxs-lookup"><span data-stu-id="9467c-300">![Manage Domains](maintainable-azure-websites-managing-change-and-scale/_static/image20.png "Manage Domains")</span></span>
    >
    > <span data-ttu-id="9467c-301">![Gérer les domaines personnalisés](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Gérer les domaines personnalisés")</span><span class="sxs-lookup"><span data-stu-id="9467c-301">![Manage Custom Domains](maintainable-azure-websites-managing-change-and-scale/_static/image21.png "Manage Custom Domains")</span></span>
9. <span data-ttu-id="9467c-302">Une fois l’application Web créée, cliquez sur le lien sous la colonne **URL** pour vérifier que la nouvelle application Web est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9467c-302">Once the web app is created, click the link under the **URL** column to check that the new web app is running.</span></span>

    ![Accès à la nouvelle application Web](maintainable-azure-websites-managing-change-and-scale/_static/image22.png)

    <span data-ttu-id="9467c-304">*Accès à la nouvelle application Web*</span><span class="sxs-lookup"><span data-stu-id="9467c-304">*Browsing to the new web app*</span></span>

    ![application Web en cours d’exécution](maintainable-azure-websites-managing-change-and-scale/_static/image23.png)

    <span data-ttu-id="9467c-306">*application Web en cours d’exécution*</span><span class="sxs-lookup"><span data-stu-id="9467c-306">*web app running*</span></span>

<a id="Ex2Task2"></a>
#### <a name="task-2--creating-the-production-sql-database"></a><span data-ttu-id="9467c-307">Tâche 2 : création de la SQL Database de production</span><span class="sxs-lookup"><span data-stu-id="9467c-307">Task 2 – Creating the Production SQL Database</span></span>

<span data-ttu-id="9467c-308">Dans cette tâche, vous allez utiliser la **migrations Entity Framework code First** pour créer la base de données ciblant l’instance **Azure SQL Database** que vous avez créée lors de la tâche précédente.</span><span class="sxs-lookup"><span data-stu-id="9467c-308">In this task, you will use the **Entity Framework Code First Migrations** to create the database targeting the **Azure SQL Database** instance you created in the previous task.</span></span>

1. <span data-ttu-id="9467c-309">Dans la Portail de gestion, accédez à l’application Web que vous avez créée dans la tâche précédente et accédez à son **tableau de bord**.</span><span class="sxs-lookup"><span data-stu-id="9467c-309">In the Management Portal, navigate to the web app you created in the previous task and go to its **Dashboard**.</span></span>
2. <span data-ttu-id="9467c-310">Dans la page **tableau de bord** , cliquez sur Afficher les chaînes de **connexion** dans la section **Aperçu rapide** .</span><span class="sxs-lookup"><span data-stu-id="9467c-310">In the **Dashboard** page, click **View connection strings** link under the **quick glance** section.</span></span>

    <span data-ttu-id="9467c-311">![Afficher les chaînes de connexion](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "Afficher les chaînes de connexion")</span><span class="sxs-lookup"><span data-stu-id="9467c-311">![View connection strings](maintainable-azure-websites-managing-change-and-scale/_static/image24.png "View connection strings")</span></span>

    <span data-ttu-id="9467c-312">*Afficher les chaînes de connexion*</span><span class="sxs-lookup"><span data-stu-id="9467c-312">*View connection strings*</span></span>
3. <span data-ttu-id="9467c-313">Copiez la valeur de la **chaîne de connexion** et fermez la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="9467c-313">Copy the **connection string** value and close the dialog box.</span></span>

    <span data-ttu-id="9467c-314">![Chaîne de connexion dans Azure Portail de gestion](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Chaîne de connexion dans Azure Portail de gestion")</span><span class="sxs-lookup"><span data-stu-id="9467c-314">![Connection String in Azure Management Portal](maintainable-azure-websites-managing-change-and-scale/_static/image25.png "Connection String in Azure Management Portal")</span></span>

    <span data-ttu-id="9467c-315">*Chaîne de connexion dans Azure Portail de gestion*</span><span class="sxs-lookup"><span data-stu-id="9467c-315">*Connection String in Azure Management Portal*</span></span>
4. <span data-ttu-id="9467c-316">Cliquez sur **bases de données SQL** pour afficher la liste des bases de données SQL dans Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-316">Click **SQL Databases** to see the list of SQL databases in Azure</span></span>

    <span data-ttu-id="9467c-317">![Menu SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "Menu SQL Database")</span><span class="sxs-lookup"><span data-stu-id="9467c-317">![SQL Database menu](maintainable-azure-websites-managing-change-and-scale/_static/image26.png "SQL Database menu")</span></span>

    <span data-ttu-id="9467c-318">*Menu SQL Database*</span><span class="sxs-lookup"><span data-stu-id="9467c-318">*SQL Database menu*</span></span>
5. <span data-ttu-id="9467c-319">Localisez la base de données que vous avez créée lors de la tâche précédente, puis cliquez sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="9467c-319">Locate the database you created in the previous task and click on the Server.</span></span>

    <span data-ttu-id="9467c-320">![Serveur de SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "Serveur SQL Database")</span><span class="sxs-lookup"><span data-stu-id="9467c-320">![SQL Database server](maintainable-azure-websites-managing-change-and-scale/_static/image27.png "SQL Database server")</span></span>

    <span data-ttu-id="9467c-321">*Serveur de SQL Database*</span><span class="sxs-lookup"><span data-stu-id="9467c-321">*SQL Database server*</span></span>
6. <span data-ttu-id="9467c-322">Sur la page **démarrage rapide** du serveur, cliquez sur **configurer**.</span><span class="sxs-lookup"><span data-stu-id="9467c-322">In the **Quick Start** page of the server, click on **Configure**.</span></span>

    <span data-ttu-id="9467c-323">![Menu configurer](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Menu configurer")</span><span class="sxs-lookup"><span data-stu-id="9467c-323">![Configure menu](maintainable-azure-websites-managing-change-and-scale/_static/image28.png "Configure menu")</span></span>

    <span data-ttu-id="9467c-324">*Menu configurer*</span><span class="sxs-lookup"><span data-stu-id="9467c-324">*Configure menu*</span></span>
7. <span data-ttu-id="9467c-325">Dans la section **adresses IP autorisées** , cliquez sur **Ajouter au lien adresses IP autorisées** pour permettre à votre adresse IP de se connecter au serveur de SQL Database.</span><span class="sxs-lookup"><span data-stu-id="9467c-325">In the **Allowed IP addresses** section, click on **Add to the allowed IP addresses** link to enable your IP to connect to the SQL Database server.</span></span>

    <span data-ttu-id="9467c-326">![Adresses IP autorisées](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Adresses IP autorisées")</span><span class="sxs-lookup"><span data-stu-id="9467c-326">![Allowed IP addresses](maintainable-azure-websites-managing-change-and-scale/_static/image29.png "Allowed IP addresses")</span></span>

    <span data-ttu-id="9467c-327">*Adresses IP autorisées*</span><span class="sxs-lookup"><span data-stu-id="9467c-327">*Allowed IP addresses*</span></span>
8. <span data-ttu-id="9467c-328">Cliquez sur **Enregistrer** en bas de la page pour achever cette étape.</span><span class="sxs-lookup"><span data-stu-id="9467c-328">Click **Save** at the bottom of the page to complete the step.</span></span>
9. <span data-ttu-id="9467c-329">Revenez à Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9467c-329">Switch back to Visual Studio.</span></span>
10. <span data-ttu-id="9467c-330">Dans la **console du gestionnaire de package**, exécutez la commande suivante en remplaçant l’espace réservé *[votre-Connection-String]* par la chaîne de connexion que vous avez copiée à partir d’Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-330">In the **Package Manager Console**, execute the following command replacing *[YOUR-CONNECTION-STRING]* placeholder with the connection string you copied from Azure</span></span>

    [!code-powershell[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample10.ps1)]

    <span data-ttu-id="9467c-331">![Mettre à jour la base de données ciblant Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Mettre à jour la base de données ciblant Windows Azure SQL Database")</span><span class="sxs-lookup"><span data-stu-id="9467c-331">![Update database targeting Windows Azure SQL Database](maintainable-azure-websites-managing-change-and-scale/_static/image30.png "Update database targeting Windows Azure SQL Database")</span></span>

    <span data-ttu-id="9467c-332">*Mettre à jour la cible de la base de données Azure SQL Database*</span><span class="sxs-lookup"><span data-stu-id="9467c-332">*Update database targeting Azure SQL Database*</span></span>

<a id="Ex2Task3"></a>
#### <a name="task-3--deploying-geek-quiz-to-staging-using-git"></a><span data-ttu-id="9467c-333">Tâche 3 : déploiement du quiz de l’un des passionnés dans l’environnement intermédiaire à l’aide de git</span><span class="sxs-lookup"><span data-stu-id="9467c-333">Task 3 – Deploying Geek Quiz to Staging Using Git</span></span>

<span data-ttu-id="9467c-334">Dans cette tâche, vous allez activer la publication intermédiaire dans votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-334">In this task, you will enable staged publishing in your web app.</span></span> <span data-ttu-id="9467c-335">Ensuite, vous allez utiliser Git pour publier l’application de quiz de l’ordinateur local directement à partir de votre ordinateur local vers l’environnement intermédiaire de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-335">Then, you will use Git to publish the Geek Quiz application directly from your local computer to the staging environment of your web app.</span></span>

1. <span data-ttu-id="9467c-336">Revenez au portail et cliquez sur le nom de l’application Web dans la colonne **nom** pour afficher les pages de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-336">Go back to the portal and click the name of the web app under the **Name** column to display the management pages.</span></span>

    ![Ouverture des pages de gestion des applications Web](maintainable-azure-websites-managing-change-and-scale/_static/image31.png)

    <span data-ttu-id="9467c-338">*Ouverture des pages de gestion des applications Web*</span><span class="sxs-lookup"><span data-stu-id="9467c-338">*Opening the web app management pages*</span></span>
2. <span data-ttu-id="9467c-339">Accédez à la page mettre à l' **échelle** .</span><span class="sxs-lookup"><span data-stu-id="9467c-339">Navigate to the **Scale** page.</span></span> <span data-ttu-id="9467c-340">Dans la section **général** , sélectionnez **standard** pour la configuration, puis cliquez sur **Enregistrer** dans la barre de commandes.</span><span class="sxs-lookup"><span data-stu-id="9467c-340">Under the **general** section, select **Standard** for the configuration and click **Save** in the command bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-341">Pour exécuter toutes les applications Web dans la région et l’abonnement en cours en mode **standard** , laissez la case à cocher **Sélectionner tout** activée dans la configuration **choisir des sites** .</span><span class="sxs-lookup"><span data-stu-id="9467c-341">To run all web apps in the current region and subscription in **Standard** mode, leave the **Select All** check box selected in the **Choose Sites** configuration.</span></span> <span data-ttu-id="9467c-342">Dans le cas contraire, désactivez la case à cocher **Sélectionner tout** .</span><span class="sxs-lookup"><span data-stu-id="9467c-342">Otherwise, clear the **Select All** check box.</span></span>

    <span data-ttu-id="9467c-343">![Mise à niveau de l’application Web vers le mode standard](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Mise à niveau de l’application Web vers le mode standard")</span><span class="sxs-lookup"><span data-stu-id="9467c-343">![Upgrading the web app to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image32.png "Upgrading the web app to Standard mode")</span></span>

    <span data-ttu-id="9467c-344">*Mise à niveau de l’application Web vers le mode standard*</span><span class="sxs-lookup"><span data-stu-id="9467c-344">*Upgrading the Web App to Standard mode*</span></span>
3. <span data-ttu-id="9467c-345">Cliquez sur **Oui** pour confirmer les modifications.</span><span class="sxs-lookup"><span data-stu-id="9467c-345">Click **Yes** to confirm the changes.</span></span>

    <span data-ttu-id="9467c-346">![Confirmation du changement en mode standard](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Poursuite de la modification du mode d’application Web")</span><span class="sxs-lookup"><span data-stu-id="9467c-346">![Confirming the change to Standard mode](maintainable-azure-websites-managing-change-and-scale/_static/image33.png "Continuing with the changing of the web app mode")</span></span>

    <span data-ttu-id="9467c-347">*Confirmation du changement en mode standard*</span><span class="sxs-lookup"><span data-stu-id="9467c-347">*Confirming the change to Standard mode*</span></span>
4. <span data-ttu-id="9467c-348">Accédez à la page **tableau de bord** , puis cliquez sur Activer la **publication intermédiaire** sous la section **Aperçu rapide** .</span><span class="sxs-lookup"><span data-stu-id="9467c-348">Go to the **Dashboard** page and click **Enable staged publishing** under the **quick glance** section.</span></span>

    <span data-ttu-id="9467c-349">![Activation de la publication intermédiaire](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Activation de la publication intermédiaire")</span><span class="sxs-lookup"><span data-stu-id="9467c-349">![Enabling staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image34.png "Enabling staged publishing")</span></span>

    <span data-ttu-id="9467c-350">*Activation de la publication intermédiaire*</span><span class="sxs-lookup"><span data-stu-id="9467c-350">*Enabling staged publishing*</span></span>
5. <span data-ttu-id="9467c-351">Cliquez sur **Oui** pour activer la publication intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-351">Click **Yes** to enable staged publishing.</span></span>

    <span data-ttu-id="9467c-352">![Confirmation de la publication intermédiaire](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Cliquer sur Oui pour activer la publication intermédiaire")</span><span class="sxs-lookup"><span data-stu-id="9467c-352">![Confirming staged publishing](maintainable-azure-websites-managing-change-and-scale/_static/image35.png "Clicking Yes to enable staged publishing")</span></span>

    <span data-ttu-id="9467c-353">*Confirmation de la publication intermédiaire*</span><span class="sxs-lookup"><span data-stu-id="9467c-353">*Confirming staged publishing*</span></span>
6. <span data-ttu-id="9467c-354">Dans la liste des applications Web, développez la marque à gauche du nom de votre application Web pour afficher l’emplacement du site intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-354">In the list of web apps, expand the mark to the left of your web app name to display the staging site slot.</span></span> <span data-ttu-id="9467c-355">Il porte le nom de votre application Web suivi de ***(intermédiaire)***.</span><span class="sxs-lookup"><span data-stu-id="9467c-355">It has the name of your web app followed by ***(staging)***.</span></span> <span data-ttu-id="9467c-356">Cliquez sur le site intermédiaire pour accéder à la page de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-356">Click the staging site to go to the management page.</span></span>

    <span data-ttu-id="9467c-357">![Navigation vers l’application Web intermédiaire](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Navigation vers l’application Web intermédiaire")</span><span class="sxs-lookup"><span data-stu-id="9467c-357">![Navigating to the staging web app](maintainable-azure-websites-managing-change-and-scale/_static/image36.png "Navigating to the staging web app")</span></span>

    <span data-ttu-id="9467c-358">*Navigation vers l’application intermédiaire*</span><span class="sxs-lookup"><span data-stu-id="9467c-358">*Navigating to the staging app*</span></span>
7. <span data-ttu-id="9467c-359">Notez que la page de gestion ressemble à toute autre page de gestion de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-359">Notice that he management page looks like any other web app's management page.</span></span> <span data-ttu-id="9467c-360">Accédez à la page **déploiements** et copiez la valeur de l' **URL git** .</span><span class="sxs-lookup"><span data-stu-id="9467c-360">Navigate to the **Deployments** page and copy the **Git URL** value.</span></span> <span data-ttu-id="9467c-361">Vous l’utiliserez plus loin dans cet exercice.</span><span class="sxs-lookup"><span data-stu-id="9467c-361">You will use it later in this exercise.</span></span>

    ![Copie de la valeur de l’URL git](maintainable-azure-websites-managing-change-and-scale/_static/image37.png)

    <span data-ttu-id="9467c-363">*Copie de la valeur de l’URL git*</span><span class="sxs-lookup"><span data-stu-id="9467c-363">*Copying the Git URL value*</span></span>
8. <span data-ttu-id="9467c-364">Ouvrez une nouvelle console **git bash** et exécutez les commandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="9467c-364">Open a new **Git Bash** console and execute the following commands.</span></span> <span data-ttu-id="9467c-365">Mettez à jour l’espace réservé *[votre-application-path]* avec le chemin d’accès à la solution **GeekQuiz** , situé dans le dossier **Source\Ex1-DeployingWebSiteToStaging\Begin** de ce Lab.</span><span class="sxs-lookup"><span data-stu-id="9467c-365">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution, located in the **Source\Ex1-DeployingWebSiteToStaging\Begin** folder of this lab.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample11.cmd)]

    ![Initialisation git et validation initiale](maintainable-azure-websites-managing-change-and-scale/_static/image38.png)

    <span data-ttu-id="9467c-367">*Initialisation git et validation initiale*</span><span class="sxs-lookup"><span data-stu-id="9467c-367">*Git initialization and first commit*</span></span>
9. <span data-ttu-id="9467c-368">Exécutez la commande suivante pour pousser votre application Web vers le référentiel **git** distant.</span><span class="sxs-lookup"><span data-stu-id="9467c-368">Run the following command to push your web app to the remote **Git** repository.</span></span> <span data-ttu-id="9467c-369">Remplacez l’espace réservé par l’URL que vous avez obtenue à partir du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-369">Replace the placeholder with the URL you obtained from the management portal.</span></span> <span data-ttu-id="9467c-370">Vous serez invité à entrer votre mot de passe de déploiement.</span><span class="sxs-lookup"><span data-stu-id="9467c-370">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample12.cmd)]

    ![Envoi vers Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image39.png)

    <span data-ttu-id="9467c-372">*Envoi vers Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-372">*Pushing to Azure*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-373">Lorsque vous déployez du contenu sur l’hôte FTP ou le référentiel GIT d’une application Web, vous devez vous authentifier à l’aide des **informations d’identification de déploiement** que vous avez créées à partir des pages de gestion **démarrage rapide** ou **tableau de bord** de l’application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-373">When you deploy content to the FTP host or GIT repository of a web app, you must authenticate using the **deployment credentials** that you created from the web app's **Quick Start** or **Dashboard** management pages.</span></span> <span data-ttu-id="9467c-374">Si vous ne connaissez pas vos informations d’identification de déploiement, vous pouvez facilement les réinitialiser à l’aide du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-374">If you do not know your deployment credentials you can easily reset them using the management portal.</span></span> <span data-ttu-id="9467c-375">Ouvrez la page **tableau de bord** de l’application Web, puis cliquez sur le lien **réinitialiser vos informations d’identification de déploiement** .</span><span class="sxs-lookup"><span data-stu-id="9467c-375">Open the web app **Dashboard** page and click the **Reset your deployment credentials** link.</span></span> <span data-ttu-id="9467c-376">Fournissez un nouveau mot de passe et cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9467c-376">Provide a new password and click **OK**.</span></span> <span data-ttu-id="9467c-377">Les informations d’identification de déploiement sont valides pour une utilisation avec toutes les applications Web associées à votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-377">Deployment credentials are valid for use with all web apps associated with your subscription.</span></span>
10. <span data-ttu-id="9467c-378">Pour vérifier que l’application Web a été correctement envoyée à Azure, revenez au portail de gestion et cliquez sur **sites Web**.</span><span class="sxs-lookup"><span data-stu-id="9467c-378">In order to verify the web app was successfully pushed to Azure, go back to the management portal and click **Websites**.</span></span>
11. <span data-ttu-id="9467c-379">Localisez votre application Web et développez l’entrée pour afficher l’emplacement de site intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-379">Locate your web app and expand the entry to display the staging site slot.</span></span> <span data-ttu-id="9467c-380">Cliquez sur son **nom** pour accéder à la page de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-380">Click its **Name** to go to the management page.</span></span>
12. <span data-ttu-id="9467c-381">Cliquez sur **déploiements** pour afficher l' **historique de déploiement**.</span><span class="sxs-lookup"><span data-stu-id="9467c-381">Click **Deployments** to see the **deployment history**.</span></span> <span data-ttu-id="9467c-382">Vérifiez qu’il existe un **déploiement actif** avec votre *&quot;&quot;de validation initiale* .</span><span class="sxs-lookup"><span data-stu-id="9467c-382">Verify that there is an **Active Deployment** with your *&quot;Initial Commit&quot;*.</span></span>

    ![Déploiement actif](maintainable-azure-websites-managing-change-and-scale/_static/image40.png)

    <span data-ttu-id="9467c-384">*Déploiement actif*</span><span class="sxs-lookup"><span data-stu-id="9467c-384">*Active deployment*</span></span>
13. <span data-ttu-id="9467c-385">Enfin, cliquez sur **Parcourir** dans la barre de commandes pour accéder à l’application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-385">Finally, click **Browse** in the command bar to go to the web app.</span></span>

    ![Parcourir l’application Web](maintainable-azure-websites-managing-change-and-scale/_static/image41.png)

    <span data-ttu-id="9467c-387">*Parcourir l’application Web*</span><span class="sxs-lookup"><span data-stu-id="9467c-387">*Browse web app*</span></span>
14. <span data-ttu-id="9467c-388">Si l’application est déployée avec succès, vous verrez la page de connexion au quiz du passionné.</span><span class="sxs-lookup"><span data-stu-id="9467c-388">If the application is successfully deployed, you will see the Geek Quiz login page.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-389">L’URL d’adresse de l’application déployée contient le nom de votre application Web suivi de *-intermédiaire*.</span><span class="sxs-lookup"><span data-stu-id="9467c-389">The address URL of the deployed application contains the name of your web app followed by *-staging*.</span></span>

    ![Application en cours d’exécution dans l’environnement intermédiaire](maintainable-azure-websites-managing-change-and-scale/_static/image42.png)

    <span data-ttu-id="9467c-391">*Application en cours d’exécution dans l’environnement intermédiaire*</span><span class="sxs-lookup"><span data-stu-id="9467c-391">*Application running in the staging environment*</span></span>
15. <span data-ttu-id="9467c-392">Si vous souhaitez explorer l’application, cliquez sur **inscrire** pour inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="9467c-392">If you wish to explore the application, click **Register** to register a new user.</span></span> <span data-ttu-id="9467c-393">Renseignez les informations du compte en entrant un nom d’utilisateur, une adresse de messagerie et un mot de passe.</span><span class="sxs-lookup"><span data-stu-id="9467c-393">Complete the account details by entering a user name, email address and password.</span></span> <span data-ttu-id="9467c-394">Ensuite, l’application affiche la première question du quiz.</span><span class="sxs-lookup"><span data-stu-id="9467c-394">Next, the application shows the first question of the quiz.</span></span> <span data-ttu-id="9467c-395">Répondez à quelques questions pour vous assurer qu’il fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="9467c-395">Answer a few questions to make sure it is working as expected.</span></span>

    ![Application prête à être utilisée](maintainable-azure-websites-managing-change-and-scale/_static/image43.png)

    <span data-ttu-id="9467c-397">*Application prête à être utilisée*</span><span class="sxs-lookup"><span data-stu-id="9467c-397">*Application ready to be used*</span></span>

<a id="Ex2Task4"></a>
#### <a name="task-4--promoting-the-web-app-to-production"></a><span data-ttu-id="9467c-398">Tâche 4 : promotion de l’application Web en production</span><span class="sxs-lookup"><span data-stu-id="9467c-398">Task 4 – Promoting the Web App to Production</span></span>

<span data-ttu-id="9467c-399">Maintenant que vous avez vérifié que l’application Web fonctionne correctement dans l’environnement intermédiaire, vous êtes prêt à la promouvoir en production.</span><span class="sxs-lookup"><span data-stu-id="9467c-399">Now that you have verified that the web app is working correctly in the staging environment, you are ready to promote it to production.</span></span> <span data-ttu-id="9467c-400">Au cours de cette tâche, vous allez permuter l’emplacement du site intermédiaire avec l’emplacement du site de production.</span><span class="sxs-lookup"><span data-stu-id="9467c-400">In this task, you will swap the staging site slot with the production site slot.</span></span>

1. <span data-ttu-id="9467c-401">Revenez au portail de gestion et sélectionnez l’emplacement de site intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-401">Go back to the management portal and select the staging site slot.</span></span> <span data-ttu-id="9467c-402">Cliquez sur **permuter** dans la barre de commandes.</span><span class="sxs-lookup"><span data-stu-id="9467c-402">Click **Swap** in the command bar.</span></span>

    ![Basculer vers la production](maintainable-azure-websites-managing-change-and-scale/_static/image44.png)

    <span data-ttu-id="9467c-404">*Basculer vers la production*</span><span class="sxs-lookup"><span data-stu-id="9467c-404">*Swap to production*</span></span>
2. <span data-ttu-id="9467c-405">Cliquez sur **Oui** dans la boîte de dialogue de confirmation pour poursuivre l’opération d’échange.</span><span class="sxs-lookup"><span data-stu-id="9467c-405">Click **Yes** in the confirmation dialog box to proceed with the swap operation.</span></span> <span data-ttu-id="9467c-406">Azure échangera immédiatement le contenu du site de production avec le contenu du site intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="9467c-406">Azure will immediately swap the content of the production site with the content of the staging site.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-407">Certains paramètres de la version intermédiaire seront automatiquement copiés dans la version de production (par exemple, les substitutions de chaîne de connexion, les mappages de gestionnaires, etc.), mais les autres paramètres ne changeront pas (par exemple, les points de terminaison DNS, les liaisons SSL, etc.).</span><span class="sxs-lookup"><span data-stu-id="9467c-407">Some settings from the staged version will automatically be copied to the production version (e.g. connection string overrides, handler mappings, etc.) but other settings will not change (e.g. DNS endpoints, SSL bindings, etc.).</span></span>

    ![Confirmation de l’opération d’échange](maintainable-azure-websites-managing-change-and-scale/_static/image45.png)

    <span data-ttu-id="9467c-409">*Confirmation de l’opération d’échange*</span><span class="sxs-lookup"><span data-stu-id="9467c-409">*Confirming swap operation*</span></span>
3. <span data-ttu-id="9467c-410">Une fois l’échange terminé, sélectionnez l’emplacement de production, puis cliquez sur **Parcourir** dans la barre de commandes pour ouvrir le site de production.</span><span class="sxs-lookup"><span data-stu-id="9467c-410">Once the swap is complete, select the production slot and click **Browse** in the command bar to open the production site.</span></span> <span data-ttu-id="9467c-411">Notez l’URL dans la barre d’adresses.</span><span class="sxs-lookup"><span data-stu-id="9467c-411">Notice the URL in the address bar.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-412">Vous devrez peut-être actualiser votre navigateur pour vider le cache.</span><span class="sxs-lookup"><span data-stu-id="9467c-412">You might need to refresh your browser to clear cache.</span></span> <span data-ttu-id="9467c-413">Dans Internet Explorer, vous pouvez faire cela en appuyant sur **Ctrl + R**.</span><span class="sxs-lookup"><span data-stu-id="9467c-413">In Internet Explorer, you can do this by pressing **CTRL+R**.</span></span>

    ![Application Web en cours d’exécution dans l’environnement de production](maintainable-azure-websites-managing-change-and-scale/_static/image46.png)
4. <span data-ttu-id="9467c-415">Dans la console **GitBash** , mettez à jour l’URL distante du référentiel Git local pour cibler l’emplacement de production.</span><span class="sxs-lookup"><span data-stu-id="9467c-415">In the **GitBash** console, update the remote URL for the local Git repository to target the production slot.</span></span> <span data-ttu-id="9467c-416">Pour ce faire, exécutez la commande suivante en remplaçant les espaces réservés par votre nom d’utilisateur de déploiement et par le nom de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-416">To do this, run the following command replacing the placeholders with your deployment username and the name of your web app.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-417">Dans les exercices suivants, vous effectuerez un push des modifications sur le site de production au lieu de le préparer uniquement pour la simplicité du laboratoire.</span><span class="sxs-lookup"><span data-stu-id="9467c-417">In the following exercises, you will push changes to the production site instead of staging just for the simplicity of the lab.</span></span> <span data-ttu-id="9467c-418">Dans un scénario réel, il est recommandé de vérifier les modifications apportées à l’environnement intermédiaire avant la promotion en production.</span><span class="sxs-lookup"><span data-stu-id="9467c-418">In a real-world scenario, it is recommended to verify the changes in the staging environment before promoting to production.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample13.cmd)]

<a id="Exercise3"></a>
### <a name="exercise-3-performing-deployment-rollback-in-production"></a><span data-ttu-id="9467c-419">Exercice 3 : exécution de la restauration du déploiement en production</span><span class="sxs-lookup"><span data-stu-id="9467c-419">Exercise 3: Performing Deployment Rollback in Production</span></span>

<span data-ttu-id="9467c-420">Il existe des scénarios dans lesquels vous ne disposez pas d’un emplacement intermédiaire pour effectuer un échange à chaud entre les environnements intermédiaire et de production, par exemple, si vous travaillez avec le mode **gratuit** ou **partagé** .</span><span class="sxs-lookup"><span data-stu-id="9467c-420">There are scenarios where you do not have a staging slot to perform hot swap between staging and production, for example, if you are working with **Free** or **Shared** mode.</span></span> <span data-ttu-id="9467c-421">Dans ces scénarios, vous devez tester votre application dans un environnement de test, localement ou sur un site distant, avant le déploiement en production.</span><span class="sxs-lookup"><span data-stu-id="9467c-421">In those scenarios, you should test your application in a testing environment –either locally or in a remote site– before deploying to production.</span></span> <span data-ttu-id="9467c-422">Toutefois, il est possible qu’un problème non détecté au cours de la phase de test puisse se produire dans le site de production.</span><span class="sxs-lookup"><span data-stu-id="9467c-422">However, it is possible that an issue not detected during the testing phase may arise in the production site.</span></span> <span data-ttu-id="9467c-423">Dans ce cas, il est important de disposer d’un mécanisme permettant de basculer facilement vers une version antérieure et plus stable de l’application, le plus rapidement possible.</span><span class="sxs-lookup"><span data-stu-id="9467c-423">In this case, it is important to have a mechanism to easily switch to a previous and more stable version of the application as quickly as possible.</span></span>

<span data-ttu-id="9467c-424">Dans **Azure App service**, le déploiement continu à partir du contrôle de code source rend cela possible grâce à l’action de **redéploiement** disponible dans le portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-424">In **Azure App Service**, continuous deployment from source control makes this possible thanks to the **redeploy** action available in the management portal.</span></span> <span data-ttu-id="9467c-425">Azure effectue le suivi des déploiements associés aux validations transmises au référentiel et offre la possibilité de redéployer votre application à tout moment, à l’aide de l’un de vos déploiements précédents.</span><span class="sxs-lookup"><span data-stu-id="9467c-425">Azure keeps track of the deployments associated with the commits pushed to the repository and provides an option to redeploy your application using any of your previous deployments, at any time.</span></span>

<span data-ttu-id="9467c-426">Dans cet exercice, vous allez apporter une modification au code de l’application de **quiz** de l’inadvertance qui injecte intentionnellement un *bogue*.</span><span class="sxs-lookup"><span data-stu-id="9467c-426">In this exercise you will perform a change to the code in the **Geek Quiz** application that intentionally injects a *bug*.</span></span> <span data-ttu-id="9467c-427">Vous allez déployer l’application en production pour voir l’erreur, puis vous tirerez parti de la fonctionnalité de redéploiement pour revenir à l’état précédent.</span><span class="sxs-lookup"><span data-stu-id="9467c-427">You will deploy the application to production to see the error, and then you will take advantage of the redeploy feature to go back to the previous state.</span></span>

<a id="Ex3Task1"></a>
#### <a name="task-1--updating-the-geek-quiz-application"></a><span data-ttu-id="9467c-428">Tâche 1 : mise à jour de l’application du quiz du passionné</span><span class="sxs-lookup"><span data-stu-id="9467c-428">Task 1 – Updating the Geek Quiz Application</span></span>

<span data-ttu-id="9467c-429">Dans cette tâche, vous allez Refactoriser un petit morceau de code de la classe **TriviaController** pour extraire une partie de la logique qui récupère l’option de quiz sélectionnée de la base de données dans une nouvelle méthode.</span><span class="sxs-lookup"><span data-stu-id="9467c-429">In this task, you will refactor a small piece of code of the **TriviaController** class to extract part of the logic that retrieves the selected quiz option from the database into a new method.</span></span>

1. <span data-ttu-id="9467c-430">Basculez vers l’instance de Visual Studio avec la solution **GeekQuiz** de l’exercice précédent.</span><span class="sxs-lookup"><span data-stu-id="9467c-430">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="9467c-431">Dans **Explorateur de solutions**, ouvrez le fichier **TriviaController.cs** dans le dossier **Controllers** .</span><span class="sxs-lookup"><span data-stu-id="9467c-431">In **Solution Explorer**, open the **TriviaController.cs** file inside the **Controllers** folder.</span></span>
3. <span data-ttu-id="9467c-432">Recherchez la méthode **StoreAsync** et sélectionnez le code mis en surbrillance dans la figure suivante.</span><span class="sxs-lookup"><span data-stu-id="9467c-432">Locate the **StoreAsync** method and select the code highlighted in the following figure.</span></span>

    ![Sélection du code](maintainable-azure-websites-managing-change-and-scale/_static/image47.png)

    <span data-ttu-id="9467c-434">*Sélection du code*</span><span class="sxs-lookup"><span data-stu-id="9467c-434">*Selecting the code*</span></span>
4. <span data-ttu-id="9467c-435">Cliquez avec le bouton droit sur le code sélectionné, développez le menu **Refactoriser** , puis sélectionnez **extraire la méthode...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-435">Right-click the selected code, expand the **Refactor** menu and select **Extract Method...**.</span></span>

    ![Extraction du code en tant que nouvelle méthode](maintainable-azure-websites-managing-change-and-scale/_static/image48.png)

    <span data-ttu-id="9467c-437">*Sélection de la méthode Extract*</span><span class="sxs-lookup"><span data-stu-id="9467c-437">*Selecting Extract Method*</span></span>
5. <span data-ttu-id="9467c-438">Dans la boîte de dialogue **extraire la méthode** , nommez la nouvelle méthode *MatchesOption* , puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9467c-438">In the **Extract Method** dialog box, name the new method *MatchesOption* and click **OK**.</span></span>

    ![Spécification du nom de la méthode](maintainable-azure-websites-managing-change-and-scale/_static/image49.png)

    <span data-ttu-id="9467c-440">*Spécification du nom de la méthode extraite*</span><span class="sxs-lookup"><span data-stu-id="9467c-440">*Specifying the name for the extracted method*</span></span>
6. <span data-ttu-id="9467c-441">Le code sélectionné est ensuite extrait dans la méthode **MatchesOption** .</span><span class="sxs-lookup"><span data-stu-id="9467c-441">The selected code is then extracted into the **MatchesOption** method.</span></span> <span data-ttu-id="9467c-442">Le code obtenu est illustré dans l’extrait de code suivant.</span><span class="sxs-lookup"><span data-stu-id="9467c-442">The resulting code is shown in the following snippet.</span></span>

    [!code-csharp[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample14.cs)]
7. <span data-ttu-id="9467c-443">Appuyez sur **CTRL + S** pour enregistrer les modifications.</span><span class="sxs-lookup"><span data-stu-id="9467c-443">Press **CTRL + S** to save the changes.</span></span>

<a id="Ex3Task2"></a>
#### <a name="task-2--redeploying-the-geek-quiz-application"></a><span data-ttu-id="9467c-444">Tâche 2 : redéploiement du quiz de l’application</span><span class="sxs-lookup"><span data-stu-id="9467c-444">Task 2 – Redeploying the Geek Quiz Application</span></span>

<span data-ttu-id="9467c-445">Vous allez maintenant transmettre les modifications que vous avez apportées à la tâche précédente au référentiel, ce qui déclenchera un nouveau déploiement vers l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="9467c-445">You will now push the changes you made in the previous task to the repository, which will trigger a new deployment to the production environment.</span></span> <span data-ttu-id="9467c-446">Ensuite, vous allez dépanner un problème à l’aide des **outils de développement F12** fournis par Internet Explorer, puis effectuer une restauration vers le déploiement précédent à partir du portail de gestion Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-446">Then, you will troubleshot an issue using the **F12 development tools** provided by Internet Explorer, and then perform a rollback to the previous deployment from the Azure management portal.</span></span>

1. <span data-ttu-id="9467c-447">Ouvrez une nouvelle console **git bash** pour déployer l’application mise à jour sur Azure App service.</span><span class="sxs-lookup"><span data-stu-id="9467c-447">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
2. <span data-ttu-id="9467c-448">Exécutez les commandes suivantes pour envoyer les modifications dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-448">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="9467c-449">Mettez à jour l’espace réservé *[votre-application-path]* avec le chemin d’accès à la solution **GeekQuiz** .</span><span class="sxs-lookup"><span data-stu-id="9467c-449">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="9467c-450">Vous serez invité à entrer votre mot de passe de déploiement.</span><span class="sxs-lookup"><span data-stu-id="9467c-450">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample15.cmd)]

    ![Envoi de code refactorisé à Azure](maintainable-azure-websites-managing-change-and-scale/_static/image50.png)

    <span data-ttu-id="9467c-452">*Envoi de code refactorisé à Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-452">*Pushing refactored code to Azure*</span></span>
3. <span data-ttu-id="9467c-453">Ouvrez Internet Explorer et accédez à votre application Web (par exemple, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="9467c-453">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="9467c-454">Connectez-vous à l’aide des informations d’identification créées précédemment.</span><span class="sxs-lookup"><span data-stu-id="9467c-454">Log in using the previously created credentials.</span></span>
4. <span data-ttu-id="9467c-455">Appuyez sur **F12** pour lancer les outils de développement, sélectionnez l’onglet **réseau** , puis cliquez sur le bouton **lecture** pour démarrer l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="9467c-455">Press **F12** to launch the development tools, select the **Network** tab and click the **Play** button to start recording.</span></span>

    <span data-ttu-id="9467c-456">![Démarrage de l’enregistrement réseau](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Démarrage de l’enregistrement réseau")</span><span class="sxs-lookup"><span data-stu-id="9467c-456">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image51.png "Starting network recording")</span></span>

    <span data-ttu-id="9467c-457">*Démarrage de l’enregistrement réseau*</span><span class="sxs-lookup"><span data-stu-id="9467c-457">*Starting network recording*</span></span>
5. <span data-ttu-id="9467c-458">Sélectionnez n’importe quelle option du quiz.</span><span class="sxs-lookup"><span data-stu-id="9467c-458">Select any option of the quiz.</span></span> <span data-ttu-id="9467c-459">Vous verrez que rien ne se passe.</span><span class="sxs-lookup"><span data-stu-id="9467c-459">You will see that nothing happens.</span></span>
6. <span data-ttu-id="9467c-460">Dans la fenêtre **F12** , l’entrée correspondant à la requête HTTP de publication affiche un résultat http **500** .</span><span class="sxs-lookup"><span data-stu-id="9467c-460">In the **F12** window, the entry corresponding to the POST HTTP request shows an HTTP **500** result.</span></span>

    ![Erreur HTTP 500](maintainable-azure-websites-managing-change-and-scale/_static/image52.png)

    <span data-ttu-id="9467c-462">*Erreur HTTP 500*</span><span class="sxs-lookup"><span data-stu-id="9467c-462">*HTTP 500 error*</span></span>
7. <span data-ttu-id="9467c-463">Sélectionnez l’onglet **console** . Une erreur est consignée avec les détails de la cause.</span><span class="sxs-lookup"><span data-stu-id="9467c-463">Select the **Console** tab. An error is logged with the details of the cause.</span></span>

    ![Erreur journalisée](maintainable-azure-websites-managing-change-and-scale/_static/image53.png)

    <span data-ttu-id="9467c-465">*Erreur journalisée*</span><span class="sxs-lookup"><span data-stu-id="9467c-465">*Logged error*</span></span>
8. <span data-ttu-id="9467c-466">Recherchez la partie détails de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="9467c-466">Locate the details part of the error.</span></span> <span data-ttu-id="9467c-467">En clair, cette erreur est provoquée par la refactorisation de code que vous avez validée au cours des étapes précédentes.</span><span class="sxs-lookup"><span data-stu-id="9467c-467">Clearly, this error is caused by the code refactoring you committed in the previous steps.</span></span>

    <span data-ttu-id="9467c-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span><span class="sxs-lookup"><span data-stu-id="9467c-468">`Details: LINQ to Entities does not recognize the method 'Boolean MatchesOption ...`.</span></span>
9. <span data-ttu-id="9467c-469">Ne fermez pas le navigateur.</span><span class="sxs-lookup"><span data-stu-id="9467c-469">Do not close the browser.</span></span>
10. <span data-ttu-id="9467c-470">Dans une nouvelle instance de navigateur, accédez au [portail de gestion Azure](https://manage.windowsazure.com) et connectez-vous à l’aide de la compte Microsoft associée à votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-470">In a new browser instance, navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
11. <span data-ttu-id="9467c-471">Sélectionnez **sites** Web, puis cliquez sur l’application Web que vous avez créée dans l’exercice 2.</span><span class="sxs-lookup"><span data-stu-id="9467c-471">Select **Websites** and click the web app you created in Exercise 2.</span></span>
12. <span data-ttu-id="9467c-472">Accédez à la page **déploiements** .</span><span class="sxs-lookup"><span data-stu-id="9467c-472">Navigate to the **Deployments** page.</span></span> <span data-ttu-id="9467c-473">Notez que toutes les validations effectuées sont répertoriées dans l’historique de déploiement.</span><span class="sxs-lookup"><span data-stu-id="9467c-473">Notice that all the commits performed are listed in the deployment history.</span></span>

    ![Liste des déploiements existants](maintainable-azure-websites-managing-change-and-scale/_static/image54.png)

    <span data-ttu-id="9467c-475">*Liste des déploiements existants*</span><span class="sxs-lookup"><span data-stu-id="9467c-475">*List of existing deployments*</span></span>
13. <span data-ttu-id="9467c-476">Sélectionnez la validation précédente, puis cliquez sur **redéployer** dans la barre de commandes.</span><span class="sxs-lookup"><span data-stu-id="9467c-476">Select the previous commit and click **Redeploy** on the command bar.</span></span>

    ![Redéploiement de la validation précédente](maintainable-azure-websites-managing-change-and-scale/_static/image55.png)

    <span data-ttu-id="9467c-478">*Redéploiement de la validation précédente*</span><span class="sxs-lookup"><span data-stu-id="9467c-478">*Redeploying the previous commit*</span></span>
14. <span data-ttu-id="9467c-479">À l’invite de confirmation, cliquez sur **Yes**.</span><span class="sxs-lookup"><span data-stu-id="9467c-479">When prompted to confirm, click **Yes**.</span></span>

    ![Confirmation du redéploiement](maintainable-azure-websites-managing-change-and-scale/_static/image56.png)
15. <span data-ttu-id="9467c-481">Une fois le déploiement terminé, revenez à l’instance du navigateur avec votre application Web et appuyez sur **CTRL + F5**.</span><span class="sxs-lookup"><span data-stu-id="9467c-481">When the deployment completes, switch back to the browser instance with your web app and press **CTRL + F5**.</span></span>
16. <span data-ttu-id="9467c-482">Cliquez sur l’une des options.</span><span class="sxs-lookup"><span data-stu-id="9467c-482">Click any of the options.</span></span> <span data-ttu-id="9467c-483">L’animation de retournement aura lieu et le résultat (*correct/incorrect*) s’affichera.</span><span class="sxs-lookup"><span data-stu-id="9467c-483">The flip animation will now take place and the result (*correct/incorrect*) will be displayed.</span></span>
17. <span data-ttu-id="9467c-484">Facultatif Basculez vers la console **git bash** et exécutez les commandes suivantes pour revenir à la validation précédente.</span><span class="sxs-lookup"><span data-stu-id="9467c-484">(Optional) Switch to the **Git Bash** console and execute the following commands to revert to the previous commit.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-485">Ces commandes créent une nouvelle validation qui annule toutes les modifications dans le référentiel git qui ont été effectuées dans la validation incorrecte.</span><span class="sxs-lookup"><span data-stu-id="9467c-485">These commands create a new commit that undoes all changes in the Git repository that were made in the bad commit.</span></span> <span data-ttu-id="9467c-486">Azure redéploie ensuite l’application à l’aide de la nouvelle validation.</span><span class="sxs-lookup"><span data-stu-id="9467c-486">Azure will then redeploy the application using the new commit.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample16.cmd)]

<a id="Exercise4"></a>
### <a name="exercise-4-scaling-using-azure-storage"></a><span data-ttu-id="9467c-487">Exercice 4 : mise à l’échelle à l’aide du stockage Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-487">Exercise 4: Scaling Using Azure Storage</span></span>

<span data-ttu-id="9467c-488">Les **objets BLOB** constituent la manière la plus simple de stocker de grandes quantités de texte non structuré ou de données binaires, telles que des vidéos, de l’audio et des images.</span><span class="sxs-lookup"><span data-stu-id="9467c-488">**Blobs** are the simplest way to store large amounts of unstructured text or binary data such as video, audio and images.</span></span> <span data-ttu-id="9467c-489">Le déplacement du contenu statique de votre application vers le stockage permet de mettre à l’échelle votre application en desservant des images ou des documents directement dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="9467c-489">Moving the static content of your application to Storage, helps to scale your application by serving images or documents directly to the browser.</span></span>

<span data-ttu-id="9467c-490">Dans cet exercice, vous allez déplacer le contenu statique de votre application vers un conteneur d’objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="9467c-490">In this exercise, you will move the static content of your application to a Blob container.</span></span> <span data-ttu-id="9467c-491">Ensuite, vous allez configurer votre application pour ajouter une **règle de réécriture d’URL ASP.net** dans le **fichier Web. config** pour rediriger votre contenu vers le conteneur d’objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="9467c-491">Then you will configure your application to add an **ASP.NET URL rewrite rule** in the **Web.config** to redirect your content to the Blob container.</span></span>

<a id="Ex4Task1"></a>
#### <a name="task-1--creating-an-azure-storage-account"></a><span data-ttu-id="9467c-492">Tâche 1 : création d’un compte de stockage Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-492">Task 1 – Creating an Azure Storage Account</span></span>

<span data-ttu-id="9467c-493">Au cours de cette tâche, vous allez apprendre à créer un nouveau compte de stockage à l’aide du portail de gestion.</span><span class="sxs-lookup"><span data-stu-id="9467c-493">In this task you will learn how to create a new storage account using the management portal.</span></span>

1. <span data-ttu-id="9467c-494">Accédez au [portail de gestion Azure](https://manage.windowsazure.com) et connectez-vous à l’aide de la compte Microsoft associée à votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-494">Navigate to the [Azure management portal](https://manage.windowsazure.com) and sign in using the Microsoft account associated with your subscription.</span></span>
2. <span data-ttu-id="9467c-495">Sélectionner **nouveau | Data Services | Stockage | Création rapide** pour commencer à créer un compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9467c-495">Select **New | Data Services | Storage | Quick Create** to start creating a new storage account.</span></span> <span data-ttu-id="9467c-496">Entrez un nom unique pour le compte et sélectionnez une **région** dans la liste.</span><span class="sxs-lookup"><span data-stu-id="9467c-496">Enter a unique name for the account and select a **Region** from the list.</span></span> <span data-ttu-id="9467c-497">Cliquez sur **créer un compte de stockage** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-497">Click **Create Storage Account** to continue.</span></span>

    <span data-ttu-id="9467c-498">![Création d’un compte de stockage](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Création d’un compte de stockage")</span><span class="sxs-lookup"><span data-stu-id="9467c-498">![Creating a new Storage Account](maintainable-azure-websites-managing-change-and-scale/_static/image57.png "Creating a new Storage Account")</span></span>

    <span data-ttu-id="9467c-499">*Création d’un compte de stockage*</span><span class="sxs-lookup"><span data-stu-id="9467c-499">*Creating a new storage account*</span></span>
3. <span data-ttu-id="9467c-500">Dans la section **stockage** , attendez que l’état du nouveau compte de stockage passe à *en ligne* pour passer à l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="9467c-500">In the **Storage** section, wait until the status of the new storage account changes to *Online* in order to continue with the following step.</span></span>

    <span data-ttu-id="9467c-501">![Compte de stockage créé](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Compte de stockage créé")</span><span class="sxs-lookup"><span data-stu-id="9467c-501">![Storage Account created](maintainable-azure-websites-managing-change-and-scale/_static/image58.png "Storage Account created")</span></span>

    <span data-ttu-id="9467c-502">*Compte de stockage créé*</span><span class="sxs-lookup"><span data-stu-id="9467c-502">*Storage Account created*</span></span>
4. <span data-ttu-id="9467c-503">Cliquez sur le nom du compte de stockage, puis sur le lien **tableau de bord** en haut de la page.</span><span class="sxs-lookup"><span data-stu-id="9467c-503">Click on the storage account name and then click the **Dashboard** link at the top of the page.</span></span> <span data-ttu-id="9467c-504">La page **tableau de bord** fournit des informations sur l’état du compte et les points de terminaison de service qui peuvent être utilisés dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="9467c-504">The **Dashboard** page provides you with information about the status of the account and the service endpoints that can be used within your applications.</span></span>

    <span data-ttu-id="9467c-505">![Affichage du tableau de bord du compte de stockage](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Affichage du tableau de bord du compte de stockage")</span><span class="sxs-lookup"><span data-stu-id="9467c-505">![Displaying the Storage Account Dashboard](maintainable-azure-websites-managing-change-and-scale/_static/image59.png "Displaying the Storage Account Dashboard")</span></span>

    <span data-ttu-id="9467c-506">*Affichage du tableau de bord du compte de stockage*</span><span class="sxs-lookup"><span data-stu-id="9467c-506">*Displaying the Storage Account Dashboard*</span></span>
5. <span data-ttu-id="9467c-507">Cliquez sur le bouton **gérer les clés d’accès** dans la barre de navigation.</span><span class="sxs-lookup"><span data-stu-id="9467c-507">Click the **Manage Access Keys** button in the navigation bar.</span></span>

    <span data-ttu-id="9467c-508">![Bouton gérer les clés d’accès](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Bouton gérer les clés d’accès")</span><span class="sxs-lookup"><span data-stu-id="9467c-508">![Manage Access Keys button](maintainable-azure-websites-managing-change-and-scale/_static/image60.png "Manage Access Keys button")</span></span>

    <span data-ttu-id="9467c-509">*Bouton gérer les clés d’accès*</span><span class="sxs-lookup"><span data-stu-id="9467c-509">*Manage Access Keys button*</span></span>
6. <span data-ttu-id="9467c-510">Dans la boîte de dialogue **gérer les clés d’accès** , copiez le nom du compte de **stockage** et la **clé d’accès primaire** , car vous en aurez besoin dans l’exercice suivant.</span><span class="sxs-lookup"><span data-stu-id="9467c-510">In the **Manage Access Keys** dialog box, copy the **Storage Account Name** and **Primary Access Key** as you will need them in the following exercise.</span></span> <span data-ttu-id="9467c-511">Ensuite, fermez la boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="9467c-511">Then, close the dialog box.</span></span>

    <span data-ttu-id="9467c-512">![Boîte de dialogue gérer la clé d’accès](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Boîte de dialogue gérer la clé d’accès")</span><span class="sxs-lookup"><span data-stu-id="9467c-512">![Manage Access Key dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image61.png "Manage Access Key dialog box")</span></span>

    <span data-ttu-id="9467c-513">*Boîte de dialogue gérer la clé d’accès*</span><span class="sxs-lookup"><span data-stu-id="9467c-513">*Manage Access Key dialog box*</span></span>

<a id="Ex4Task2"></a>
#### <a name="task-2--uploading-an-asset-to-azure-blob-storage"></a><span data-ttu-id="9467c-514">Tâche 2 : chargement d’un élément multimédia dans le stockage d’objets BLOB Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-514">Task 2 – Uploading an Asset to Azure Blob Storage</span></span>

<span data-ttu-id="9467c-515">Dans cette tâche, vous allez utiliser la fenêtre Explorateur de serveurs de Visual Studio pour vous connecter à votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9467c-515">In this task, you will use the Server Explorer window from Visual Studio to connect to your storage account.</span></span> <span data-ttu-id="9467c-516">Vous allez ensuite créer un conteneur d’objets BLOB et télécharger un fichier avec le logo du quiz de l’un des passionnés dans le conteneur.</span><span class="sxs-lookup"><span data-stu-id="9467c-516">You will then create a blob container and upload a file with the Geek Quiz logo to the container.</span></span>

1. <span data-ttu-id="9467c-517">Basculez vers l’instance de Visual Studio avec la solution **GeekQuiz** de l’exercice précédent.</span><span class="sxs-lookup"><span data-stu-id="9467c-517">Switch to the Visual Studio instance with the **GeekQuiz** solution from the previous exercise.</span></span>
2. <span data-ttu-id="9467c-518">Dans la barre de menus, sélectionnez **affichage** , puis cliquez sur **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="9467c-518">From the menu bar, select **View** and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="9467c-519">Dans **Explorateur de serveurs**, cliquez avec le bouton droit sur le nœud **Azure** , puis sélectionnez **se connecter à Azure.** ... Connectez-vous à l’aide de la compte Microsoft associée à votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9467c-519">In **Server Explorer**, right-click the **Azure** node and select **Connect to Azure...**. Sign in using the Microsoft account associated with your subscription.</span></span>

    ![Connexion à Windows Azure](maintainable-azure-websites-managing-change-and-scale/_static/image62.png)

    <span data-ttu-id="9467c-521">*Connexion à Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-521">*Connect to Azure*</span></span>
4. <span data-ttu-id="9467c-522">Développez le nœud **Azure** , cliquez avec le bouton droit sur **stockage** , puis sélectionnez **attacher un stockage externe...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-522">Expand the **Azure** node, right-click **Storage** and select **Attach External Storage...**.</span></span>
5. <span data-ttu-id="9467c-523">Dans la boîte de dialogue **Ajouter un nouveau compte de stockage** , entrez le **nom du compte** et la **clé de compte** que vous avez obtenus lors de la tâche précédente, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9467c-523">In the **Add New Storage Account** dialog box, enter the **Account name** and **Account key** you obtained in the previous task and click **OK**.</span></span>

    ![Boîte de dialogue Ajouter un nouveau compte de stockage](maintainable-azure-websites-managing-change-and-scale/_static/image63.png)

    <span data-ttu-id="9467c-525">*Boîte de dialogue Ajouter un nouveau compte de stockage*</span><span class="sxs-lookup"><span data-stu-id="9467c-525">*Add New Storage Account dialog box*</span></span>
6. <span data-ttu-id="9467c-526">Votre compte de stockage doit apparaître sous le nœud **stockage** .</span><span class="sxs-lookup"><span data-stu-id="9467c-526">Your storage account should appear under the **Storage** node.</span></span> <span data-ttu-id="9467c-527">Développez votre compte de stockage, cliquez avec le bouton droit sur **objets BLOB** , puis sélectionnez **créer un conteneur d’objets BLOB...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-527">Expand your storage account, right-click **Blobs** and select **Create Blob Container...**.</span></span>

    <span data-ttu-id="9467c-528">![Créer un conteneur d’objets BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Créer un conteneur d'objets blob")</span><span class="sxs-lookup"><span data-stu-id="9467c-528">![Create Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image64.png "Create Blob Container")</span></span>

    <span data-ttu-id="9467c-529">*Créer un conteneur d’objets BLOB*</span><span class="sxs-lookup"><span data-stu-id="9467c-529">*Create Blob Container*</span></span>
7. <span data-ttu-id="9467c-530">Dans la boîte de dialogue **créer un conteneur d’objets BLOB** , entrez un nom pour le conteneur d’objets BLOB, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9467c-530">In the **Create Blob Container** dialog box, enter a name for the blob container and click **OK**.</span></span>

    <span data-ttu-id="9467c-531">![Boîte de dialogue créer un conteneur d’objets BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Boîte de dialogue créer un conteneur d’objets BLOB")</span><span class="sxs-lookup"><span data-stu-id="9467c-531">![Create Blob Container dialog box](maintainable-azure-websites-managing-change-and-scale/_static/image65.png "Create Blob Container dialog box")</span></span>

    <span data-ttu-id="9467c-532">*Boîte de dialogue créer un conteneur d’objets BLOB*</span><span class="sxs-lookup"><span data-stu-id="9467c-532">*Create Blob Container dialog box*</span></span>
8. <span data-ttu-id="9467c-533">Le nouveau conteneur d’objets BLOB doit être ajouté au nœud **blobs** .</span><span class="sxs-lookup"><span data-stu-id="9467c-533">The new blob container should be added to the **Blobs** node.</span></span> <span data-ttu-id="9467c-534">Modifiez les autorisations d’accès dans le conteneur pour rendre le conteneur public.</span><span class="sxs-lookup"><span data-stu-id="9467c-534">Change the access permissions in the container to make the container public.</span></span> <span data-ttu-id="9467c-535">Pour ce faire, cliquez avec le bouton droit sur le conteneur **images** et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="9467c-535">To do this, right-click the **images** container and select **Properties**.</span></span>

    <span data-ttu-id="9467c-536">![Propriétés du conteneur d’images](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "Propriétés du conteneur d’images")</span><span class="sxs-lookup"><span data-stu-id="9467c-536">![images container properties](maintainable-azure-websites-managing-change-and-scale/_static/image66.png "images container properties")</span></span>

    <span data-ttu-id="9467c-537">*Propriétés du conteneur d’images*</span><span class="sxs-lookup"><span data-stu-id="9467c-537">*Images container properties*</span></span>
9. <span data-ttu-id="9467c-538">Dans la fenêtre **Propriétés** , définissez l' **accès public en lecture** au **conteneur**.</span><span class="sxs-lookup"><span data-stu-id="9467c-538">In the **Properties** window, set the **Public Read Access** to **Container**.</span></span>

    <span data-ttu-id="9467c-539">![Modification de la propriété d’accès en lecture publique](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Modification de la propriété d’accès en lecture publique")</span><span class="sxs-lookup"><span data-stu-id="9467c-539">![Changing public read access property](maintainable-azure-websites-managing-change-and-scale/_static/image67.png "Changing public read access property")</span></span>

    <span data-ttu-id="9467c-540">*Modification de la propriété d’accès en lecture publique*</span><span class="sxs-lookup"><span data-stu-id="9467c-540">*Changing public read access property*</span></span>
10. <span data-ttu-id="9467c-541">Lorsque vous êtes invité à confirmer que vous souhaitez modifier la propriété d’accès public, cliquez sur **Oui**.</span><span class="sxs-lookup"><span data-stu-id="9467c-541">When prompted if you are sure you want to change the public access property, click **Yes**.</span></span>

    <span data-ttu-id="9467c-542">![AVERTISSEMENT Microsoft Visual Studio](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "AVERTISSEMENT Microsoft Visual Studio")</span><span class="sxs-lookup"><span data-stu-id="9467c-542">![Microsoft Visual Studio warning](maintainable-azure-websites-managing-change-and-scale/_static/image68.png "Microsoft Visual Studio warning")</span></span>

    <span data-ttu-id="9467c-543">*AVERTISSEMENT Microsoft Visual Studio*</span><span class="sxs-lookup"><span data-stu-id="9467c-543">*Microsoft Visual Studio warning*</span></span>
11. <span data-ttu-id="9467c-544">Dans **Explorateur de serveurs**, cliquez avec le bouton droit sur le conteneur d’objets BLOB **images** , puis sélectionnez **afficher le conteneur d’objets BLOB**.</span><span class="sxs-lookup"><span data-stu-id="9467c-544">In **Server Explorer**, right-click in the **images** blob container and select **View Blob Container**.</span></span>

    <span data-ttu-id="9467c-545">![Afficher le conteneur d’objets BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "Afficher le conteneur d’objets BLOB")</span><span class="sxs-lookup"><span data-stu-id="9467c-545">![View Blob Container](maintainable-azure-websites-managing-change-and-scale/_static/image69.png "View Blob Container")</span></span>

    <span data-ttu-id="9467c-546">*Afficher le conteneur d’objets BLOB*</span><span class="sxs-lookup"><span data-stu-id="9467c-546">*View Blob Container*</span></span>
12. <span data-ttu-id="9467c-547">Le conteneur images doit s’ouvrir dans une nouvelle fenêtre et une légende sans entrée doit être affichée.</span><span class="sxs-lookup"><span data-stu-id="9467c-547">The images container should open in a new window and a legend with no entries should be shown.</span></span> <span data-ttu-id="9467c-548">Cliquez sur l’icône **Télécharger** pour charger un fichier dans le conteneur d’objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="9467c-548">Click the **upload** icon to upload a file to the blob container.</span></span>

    <span data-ttu-id="9467c-549">![Conteneur d’images sans entrées](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Conteneur d’images sans entrées")</span><span class="sxs-lookup"><span data-stu-id="9467c-549">![Images container with no entries](maintainable-azure-websites-managing-change-and-scale/_static/image70.png "Images container with no entries")</span></span>

    <span data-ttu-id="9467c-550">*Conteneur d’images sans entrées*</span><span class="sxs-lookup"><span data-stu-id="9467c-550">*Images container with no entries*</span></span>
13. <span data-ttu-id="9467c-551">Dans la boîte de dialogue **Télécharger l’objet BLOB** , accédez au dossier **composants** du Lab.</span><span class="sxs-lookup"><span data-stu-id="9467c-551">In the **Upload Blob** dialog box, navigate to the **Assets** folder of the lab.</span></span> <span data-ttu-id="9467c-552">Sélectionnez le fichier **logo-Big. png** , puis cliquez sur **ouvrir**.</span><span class="sxs-lookup"><span data-stu-id="9467c-552">Select the **logo-big.png** file and click **Open**.</span></span>
14. <span data-ttu-id="9467c-553">Attendez que le fichier soit téléchargé.</span><span class="sxs-lookup"><span data-stu-id="9467c-553">Wait until the file is uploaded.</span></span> <span data-ttu-id="9467c-554">Une fois le téléchargement terminé, le fichier doit être listé dans le conteneur images.</span><span class="sxs-lookup"><span data-stu-id="9467c-554">When the upload completes, the file should be listed in the images container.</span></span> <span data-ttu-id="9467c-555">Cliquez avec le bouton droit sur l’entrée de fichier et sélectionnez **copier l’URL**.</span><span class="sxs-lookup"><span data-stu-id="9467c-555">Right-click the file entry and select **Copy URL**.</span></span>

    <span data-ttu-id="9467c-556">![Copier l’URL de l’objet BLOB](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Copier l’URL du fichier BLOB")</span><span class="sxs-lookup"><span data-stu-id="9467c-556">![Copy blob URL](maintainable-azure-websites-managing-change-and-scale/_static/image71.png "Copy blob file URL")</span></span>

    <span data-ttu-id="9467c-557">*Copier l’URL de l’objet BLOB*</span><span class="sxs-lookup"><span data-stu-id="9467c-557">*Copy blob URL*</span></span>
15. <span data-ttu-id="9467c-558">Ouvrez Internet Explorer et collez l’URL.</span><span class="sxs-lookup"><span data-stu-id="9467c-558">Open Internet Explorer and paste the URL.</span></span> <span data-ttu-id="9467c-559">L’image suivante doit s’afficher dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="9467c-559">The following image should be shown in the browser.</span></span>

    <span data-ttu-id="9467c-560">![image logo-Big. png à partir du stockage d’objets BLOB Windows](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "image logo-Big. png à partir du stockage")</span><span class="sxs-lookup"><span data-stu-id="9467c-560">![logo-big.png image from Windows Blob Storage](maintainable-azure-websites-managing-change-and-scale/_static/image72.png "logo-big.png image from storage")</span></span>

    <span data-ttu-id="9467c-561">*image logo-Big. png à partir du stockage d’objets BLOB Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-561">*logo-big.png image from Azure Blob Storage*</span></span>

<a id="Ex4Task3"></a>
#### <a name="task-3--updating-the-solution-to-consume-static-content-from-azure-blob-storage"></a><span data-ttu-id="9467c-562">Tâche 3 : mise à jour de la solution pour consommer du contenu statique à partir du stockage d’objets BLOB Azure</span><span class="sxs-lookup"><span data-stu-id="9467c-562">Task 3 – Updating the Solution to Consume Static Content from Azure Blob Storage</span></span>

<span data-ttu-id="9467c-563">Dans cette tâche, vous allez configurer la solution **GeekQuiz** pour utiliser l’image chargée dans le stockage d’objets BLOB Azure (au lieu de l’image située dans l’application Web) en ajoutant une règle de réécriture d’URL ASP.net dans le fichier **Web. config** .</span><span class="sxs-lookup"><span data-stu-id="9467c-563">In this task, you will configure the **GeekQuiz** solution to consume the image uploaded to Azure Blob Storage (instead of the image located in the web app) by adding an ASP.NET URL rewrite rule in the **web.config** file.</span></span>

1. <span data-ttu-id="9467c-564">Dans Visual Studio, ouvrez le fichier **Web. config** à l’intérieur du projet **GeekQuiz** et recherchez l’élément **&lt;System. webServer&gt;** .</span><span class="sxs-lookup"><span data-stu-id="9467c-564">In Visual Studio, open the **Web.config** file inside the **GeekQuiz** project and locate the **&lt;system.webServer&gt;** element.</span></span>
2. <span data-ttu-id="9467c-565">Ajoutez le code suivant pour ajouter une règle de réécriture d’URL, en mettant à jour l’espace réservé avec le nom de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9467c-565">Add the following code to add an URL rewrite rule, updating the placeholder with your storage account name.</span></span>

    <span data-ttu-id="9467c-566">(Extrait de code- *WebSitesInProduction-EX4-UrlRewriteRule*)</span><span class="sxs-lookup"><span data-stu-id="9467c-566">(Code Snippet - *WebSitesInProduction - Ex4 - UrlRewriteRule*)</span></span>

    [!code-xml[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample17.xml)]

    > [!NOTE]
    > <span data-ttu-id="9467c-567">La réécriture d’URL est le processus qui consiste à intercepter une requête Web entrante et à rediriger la demande vers une autre ressource.</span><span class="sxs-lookup"><span data-stu-id="9467c-567">URL rewriting is the process of intercepting an incoming Web request and redirecting the request to a different resource.</span></span> <span data-ttu-id="9467c-568">Les règles de réécriture d’URL indiquent au moteur de réécriture qu’une demande doit être redirigée et où doivent-elles être redirigées.</span><span class="sxs-lookup"><span data-stu-id="9467c-568">The URL rewriting rules tells the rewriting engine when a request needs to be redirected, and where should they be redirected.</span></span> <span data-ttu-id="9467c-569">Une règle de réécriture est composée de deux chaînes : le modèle à rechercher dans l’URL demandée (généralement, à l’aide d’expressions régulières) et la chaîne à laquelle remplacer le modèle, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="9467c-569">A rewriting rule is composed of two strings: the pattern to look for in the requested URL (usually, using regular expressions), and the string to replace the pattern with, if found.</span></span> <span data-ttu-id="9467c-570">Pour plus d’informations, consultez [réécriture d’URL dans ASP.net](https://msdn.microsoft.com/library/ms972974.aspx).</span><span class="sxs-lookup"><span data-stu-id="9467c-570">For more information, see [URL Rewriting in ASP.NET](https://msdn.microsoft.com/library/ms972974.aspx).</span></span>
3. <span data-ttu-id="9467c-571">Appuyez sur **CTRL + S** pour enregistrer les modifications.</span><span class="sxs-lookup"><span data-stu-id="9467c-571">Press **CTRL + S** to save the changes.</span></span>
4. <span data-ttu-id="9467c-572">Ouvrez une nouvelle console **git bash** pour déployer l’application mise à jour sur Azure App service.</span><span class="sxs-lookup"><span data-stu-id="9467c-572">Open a new **Git Bash** console to deploy the updated application to Azure App Service.</span></span>
5. <span data-ttu-id="9467c-573">Exécutez les commandes suivantes pour envoyer les modifications dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-573">Execute the following commands to push the changes to Azure.</span></span> <span data-ttu-id="9467c-574">Mettez à jour l’espace réservé *[votre-application-path]* avec le chemin d’accès à la solution **GeekQuiz** .</span><span class="sxs-lookup"><span data-stu-id="9467c-574">Update the *[YOUR-APPLICATION-PATH]* placeholder with the path to the **GeekQuiz** solution.</span></span> <span data-ttu-id="9467c-575">Vous serez invité à entrer votre mot de passe de déploiement.</span><span class="sxs-lookup"><span data-stu-id="9467c-575">You will be prompted for your deployment password.</span></span>

    [!code-console[Main](maintainable-azure-websites-managing-change-and-scale/samples/sample18.cmd)]

    ![Déploiement de la mise à jour vers Azure](maintainable-azure-websites-managing-change-and-scale/_static/image73.png)

    <span data-ttu-id="9467c-577">*Déploiement de la mise à jour vers Azure*</span><span class="sxs-lookup"><span data-stu-id="9467c-577">*Deploying update to Azure*</span></span>

<a id="Ex4Task4"></a>
#### <a name="task-4--verification"></a><span data-ttu-id="9467c-578">Tâche 4 : vérification</span><span class="sxs-lookup"><span data-stu-id="9467c-578">Task 4 – Verification</span></span>

<span data-ttu-id="9467c-579">Au cours de cette tâche, vous allez utiliser **Internet Explorer** pour parcourir l’application du **quiz** de l’inversion et vérifier que la règle de réécriture d’URL pour les images fonctionne et que vous êtes redirigé vers l’image hébergée sur le **stockage d’objets BLOB Azure**.</span><span class="sxs-lookup"><span data-stu-id="9467c-579">In this task you will use **Internet Explorer** to browse the **Geek Quiz** application and check that the URL rewrite rule for images works and you are redirected to the image hosted on **Azure Blob Storage**.</span></span>

1. <span data-ttu-id="9467c-580">Ouvrez Internet Explorer et accédez à votre application Web (par exemple, `http://<your-web-site>.azurewebsites.net`).</span><span class="sxs-lookup"><span data-stu-id="9467c-580">Open Internet Explorer and navigate to your web app (e.g. `http://<your-web-site>.azurewebsites.net`).</span></span> <span data-ttu-id="9467c-581">Connectez-vous à l’aide des informations d’identification créées précédemment.</span><span class="sxs-lookup"><span data-stu-id="9467c-581">Log in using the previously created credentials.</span></span>

    <span data-ttu-id="9467c-582">![Présentation de l’application Web du quiz de l’inversion avec l’image](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Présentation de l’application Web du quiz de l’inversion avec l’image")</span><span class="sxs-lookup"><span data-stu-id="9467c-582">![Showing the Geek Quiz web app with the image](maintainable-azure-websites-managing-change-and-scale/_static/image74.png "Showing the Geek Quiz web app with the image")</span></span>

    <span data-ttu-id="9467c-583">*Présentation de l’application Web du quiz de l’inversion avec l’image*</span><span class="sxs-lookup"><span data-stu-id="9467c-583">*Showing the Geek Quiz web app with the image*</span></span>
2. <span data-ttu-id="9467c-584">Appuyez sur **F12** pour lancer les outils de développement, sélectionnez l’onglet **réseau** et démarrez l’enregistrement.</span><span class="sxs-lookup"><span data-stu-id="9467c-584">Press **F12** to launch the development tools, select the **Network** tab and start recording.</span></span>

    <span data-ttu-id="9467c-585">![Démarrage de l’enregistrement réseau](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Démarrage de l’enregistrement réseau")</span><span class="sxs-lookup"><span data-stu-id="9467c-585">![Starting network recording](maintainable-azure-websites-managing-change-and-scale/_static/image75.png "Starting network recording")</span></span>

    <span data-ttu-id="9467c-586">*Démarrage de l’enregistrement réseau*</span><span class="sxs-lookup"><span data-stu-id="9467c-586">*Starting network recording*</span></span>
3. <span data-ttu-id="9467c-587">Appuyez sur **CTRL + F5** pour actualiser la page Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-587">Press **CTRL + F5** to refresh the web page.</span></span>
4. <span data-ttu-id="9467c-588">Une fois la page chargée, vous devriez voir une requête HTTP pour l’URL **/img/logo-Big.png** avec un résultat http **301** (redirection) et une autre demande pour `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL avec un résultat http **200** .</span><span class="sxs-lookup"><span data-stu-id="9467c-588">Once the page has finished loading, you should see an HTTP request for the **/img/logo-big.png** URL with an HTTP **301** result (redirect) and another request for `http://[YOUR-STORAGE-ACCOUNT].blob.core.windows.net/images/logo-big.png` URL with a HTTP **200** result.</span></span>

    <span data-ttu-id="9467c-589">![Vérification de la redirection de l’URL](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Présentation de la redirection dans les outils de développement")</span><span class="sxs-lookup"><span data-stu-id="9467c-589">![Verifying the URL redirect](maintainable-azure-websites-managing-change-and-scale/_static/image76.png "Showing the redirect in Dev Tools")</span></span>

    <span data-ttu-id="9467c-590">*Vérification de la redirection de l’URL*</span><span class="sxs-lookup"><span data-stu-id="9467c-590">*Verifying the URL redirect*</span></span>

<a id="Exercise5"></a>
### <a name="exercise-5-using-autoscale-for-web-apps"></a><span data-ttu-id="9467c-591">Exercice 5 : utilisation de la mise à l’échelle automatique pour Web Apps</span><span class="sxs-lookup"><span data-stu-id="9467c-591">Exercise 5: Using Autoscale for Web Apps</span></span>

> [!NOTE]
> <span data-ttu-id="9467c-592">Cet exercice est facultatif, car il nécessite la prise en charge de la charge Web &amp; le test des performances qui est uniquement disponible pour **Visual Studio 2013 Édition intégrale**.</span><span class="sxs-lookup"><span data-stu-id="9467c-592">This exercise is optional, since it requires support for Web Load &amp; Performance Testing which is only available for **Visual Studio 2013 Ultimate Edition**.</span></span> <span data-ttu-id="9467c-593">Pour plus d’informations sur les fonctionnalités de Visual Studio 2013 spécifiques, comparez les versions [ici](https://www.microsoft.com/visualstudio/eng/products/compare).</span><span class="sxs-lookup"><span data-stu-id="9467c-593">For more information on specific Visual Studio 2013 features, compare versions [here](https://www.microsoft.com/visualstudio/eng/products/compare).</span></span>

<span data-ttu-id="9467c-594">**Azure App Service Web Apps** fournit la fonctionnalité de mise à l’échelle automatique pour les applications Web qui s’exécutent en **mode standard**.</span><span class="sxs-lookup"><span data-stu-id="9467c-594">**Azure App Service Web Apps** provides the Autoscale feature for web apps running in **Standard Mode**.</span></span> <span data-ttu-id="9467c-595">La mise à l’échelle automatique permet à Azure de mettre automatiquement à l’échelle le nombre d’instances de votre application Web en fonction de la charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-595">Autoscale lets Azure automatically scale the instance count of your web app depending on the load.</span></span> <span data-ttu-id="9467c-596">Lorsque la mise à l’échelle automatique est activée, Azure vérifie l’UC de votre application Web toutes les cinq minutes et ajoute les instances nécessaires à ce moment-là.</span><span class="sxs-lookup"><span data-stu-id="9467c-596">When Autoscale is enabled, Azure checks the CPU of your web app once every five minutes and adds instances as needed at that point in time.</span></span> <span data-ttu-id="9467c-597">Si l’utilisation du processeur est faible, Azure supprime les instances une fois toutes les deux heures pour s’assurer que les performances de votre application Web ne sont pas dégradées.</span><span class="sxs-lookup"><span data-stu-id="9467c-597">If the CPU usage is low, Azure will remove instances once every two hours to ensure that the performance of your web app is not degraded.</span></span>

<span data-ttu-id="9467c-598">Dans cet exercice, vous allez suivre les étapes nécessaires à la configuration de la fonctionnalité de mise à l' **échelle** automatique pour l’application Web de **quiz** de l’inversion.</span><span class="sxs-lookup"><span data-stu-id="9467c-598">In this exercise you will go through the steps required to configure the **Autoscale** feature for the **Geek Quiz** web app.</span></span> <span data-ttu-id="9467c-599">Vous allez vérifier cette fonctionnalité en exécutant un test de charge Visual Studio pour générer une charge d’UC suffisante sur l’application pour déclencher la mise à niveau d’une instance.</span><span class="sxs-lookup"><span data-stu-id="9467c-599">You will verify this feature by running a Visual Studio load test to generate enough CPU load on the application to trigger an instance upgrade.</span></span>

<a id="Ex5Task1"></a>
#### <a name="task-1--configuring-autoscale-based-on-the-cpu-metric"></a><span data-ttu-id="9467c-600">Tâche 1 : configuration de la mise à l’échelle automatique en fonction de la métrique de l’UC</span><span class="sxs-lookup"><span data-stu-id="9467c-600">Task 1 – Configuring Autoscale Based on the CPU Metric</span></span>

<span data-ttu-id="9467c-601">Dans cette tâche, vous allez utiliser le portail de gestion Azure pour activer la fonctionnalité de mise à l’échelle automatique pour l’application Web que vous avez créée dans l’exercice 2.</span><span class="sxs-lookup"><span data-stu-id="9467c-601">In this task you will use the Azure management portal to enable the Autoscale feature for the web app you created in Exercise 2.</span></span>

1. <span data-ttu-id="9467c-602">Dans le [portail de gestion Azure](https://manage.windowsazure.com/), sélectionnez **sites** Web, puis cliquez sur l’application Web que vous avez créée dans l’exercice 2.</span><span class="sxs-lookup"><span data-stu-id="9467c-602">In the [Azure management portal](https://manage.windowsazure.com/), select **Websites** and click the web app you created in Exercise 2.</span></span>
2. <span data-ttu-id="9467c-603">Accédez à la page mettre à l' **échelle** .</span><span class="sxs-lookup"><span data-stu-id="9467c-603">Navigate to the **Scale** page.</span></span> <span data-ttu-id="9467c-604">Sous la section **capacité** , sélectionnez **UC** pour la configuration d' **échelle par métrique** .</span><span class="sxs-lookup"><span data-stu-id="9467c-604">Under the **capacity** section, select **CPU** for the **Scale by Metric** configuration.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-605">Lors de la mise à l’échelle par UC, Azure ajuste dynamiquement le nombre d’instances que l’application utilise en cas de modification de l’utilisation de l’UC.</span><span class="sxs-lookup"><span data-stu-id="9467c-605">When scaling by CPU, Azure dynamically adjusts the number of instances that the app uses if the CPU usage changes.</span></span>

    <span data-ttu-id="9467c-606">![Sélection de la mise à l’échelle par UC](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Sélection de la métrique de l’UC pour la mise à l’échelle automatique")</span><span class="sxs-lookup"><span data-stu-id="9467c-606">![Selecting to scale by CPU](maintainable-azure-websites-managing-change-and-scale/_static/image77.png "Selecting the CPU metric for auto scaling")</span></span>

    <span data-ttu-id="9467c-607">*Sélection de la mise à l’échelle par UC*</span><span class="sxs-lookup"><span data-stu-id="9467c-607">*Selecting to scale by CPU*</span></span>
3. <span data-ttu-id="9467c-608">Remplacez la configuration de l' **UC cible** par **20**-**40** pour cent.</span><span class="sxs-lookup"><span data-stu-id="9467c-608">Change the **Target CPU** configuration to **20**-**40** percent.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-609">Cette plage représente l’utilisation moyenne de l’UC pour votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-609">This range represents the average CPU usage for your web app.</span></span> <span data-ttu-id="9467c-610">Azure ajoutera ou supprimera des instances pour conserver votre application Web dans cette plage.</span><span class="sxs-lookup"><span data-stu-id="9467c-610">Azure will add or remove instances to keep your web app in this range.</span></span> <span data-ttu-id="9467c-611">Le nombre minimal et maximal d’instances utilisées pour la mise à l’échelle est spécifié dans la configuration du **nombre** d’instances.</span><span class="sxs-lookup"><span data-stu-id="9467c-611">The minimum and maximum number of instances used for scaling is specified in the **Instance Count** configuration.</span></span> <span data-ttu-id="9467c-612">Azure ne passera jamais au-delà de cette limite.</span><span class="sxs-lookup"><span data-stu-id="9467c-612">Azure will never go above or beyond that limit.</span></span>
    >
    > <span data-ttu-id="9467c-613">Les valeurs par défaut de l' **UC cible** sont modifiées uniquement pour les besoins de cet atelier.</span><span class="sxs-lookup"><span data-stu-id="9467c-613">The default **Target CPU** values are modified just for the purposes of this lab.</span></span> <span data-ttu-id="9467c-614">En configurant la plage de l’UC avec des petites valeurs, vous augmentez les chances de déclencher la mise à l’échelle automatique lorsqu’une charge modérée est placée sur l’application.</span><span class="sxs-lookup"><span data-stu-id="9467c-614">By configuring the CPU range with small values, you are increasing the chances to trigger Autoscale when a moderate load is placed on the application.</span></span>

    <span data-ttu-id="9467c-615">![Modification de l’UC cible pour qu’elle soit comprise entre 20 et 40 pour cent](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Modification de l’UC cible pour qu’elle soit comprise entre 20 et 40 pour cent")</span><span class="sxs-lookup"><span data-stu-id="9467c-615">![Changing the target CPU to be between 20 and 40 percent](maintainable-azure-websites-managing-change-and-scale/_static/image78.png "Changing the target CPU to be between 20 and 40 percent")</span></span>

    <span data-ttu-id="9467c-616">*Modification de l’UC cible pour qu’elle soit comprise entre 20 et 40 pour cent*</span><span class="sxs-lookup"><span data-stu-id="9467c-616">*Changing the Target CPU to be between 20 and 40 percent*</span></span>
4. <span data-ttu-id="9467c-617">Cliquez sur **Enregistrer** dans la barre de commandes pour enregistrer les modifications.</span><span class="sxs-lookup"><span data-stu-id="9467c-617">Click **Save** in the command bar to save the changes.</span></span>

<a id="Ex5Task2"></a>
#### <a name="task-2--load-testing-with-visual-studio"></a><span data-ttu-id="9467c-618">Tâche 2 : test de charge avec Visual Studio</span><span class="sxs-lookup"><span data-stu-id="9467c-618">Task 2 – Load Testing with Visual Studio</span></span>

<span data-ttu-id="9467c-619">Maintenant que la mise à l' **échelle** automatique a été configurée, vous allez créer un **projet de test de performances Web et de charge** dans Visual Studio pour générer une charge de l’UC sur votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-619">Now that **Autoscale** has been configured, you will create a **Web Performance and Load Test Project** in Visual Studio to generate some CPU load on your web app.</span></span>

1. <span data-ttu-id="9467c-620">Ouvrez **Visual Studio Ultimate 2013** et sélectionnez **fichier | Nouveau | Projet...** pour démarrer une nouvelle solution.</span><span class="sxs-lookup"><span data-stu-id="9467c-620">Open **Visual Studio Ultimate 2013** and select **File | New | Project...** to start a new solution.</span></span>

    <span data-ttu-id="9467c-621">![Création d’un nouveau projet](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Création d’un projet")</span><span class="sxs-lookup"><span data-stu-id="9467c-621">![Creating a new project](maintainable-azure-websites-managing-change-and-scale/_static/image79.png "Creating a new project")</span></span>

    <span data-ttu-id="9467c-622">*Création d’un nouveau projet*</span><span class="sxs-lookup"><span data-stu-id="9467c-622">*Creating a new project*</span></span>
2. <span data-ttu-id="9467c-623">Dans la boîte de dialogue **nouveau projet** , sélectionnez **projet de test de performances Web et de charge** sous le **visuel | C# Onglet test** . Assurez-vous que **.NET Framework 4,5** est sélectionné, nommez le projet *WebAndLoadTestProject*, choisissez un **emplacement** , puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9467c-623">In the **New Project** dialog box, select **Web Performance and Load Test Project** under the **Visual C# | Test** tab. Make sure **.NET Framework 4.5** is selected, name the project *WebAndLoadTestProject*, choose a **Location** and click **OK**.</span></span>

    <span data-ttu-id="9467c-624">![Création d’un projet de test Web et de charge](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Création d’un projet de test Web et de charge")</span><span class="sxs-lookup"><span data-stu-id="9467c-624">![Creating a new Web and Load Test project](maintainable-azure-websites-managing-change-and-scale/_static/image80.png "Creating a new Web and Load Test project")</span></span>

    <span data-ttu-id="9467c-625">*Création d’un projet de test Web et de charge*</span><span class="sxs-lookup"><span data-stu-id="9467c-625">*Creating a new Web and Load Test project*</span></span>
3. <span data-ttu-id="9467c-626">Dans **WebTest1. WebTest** , cliquez avec le bouton droit sur le nœud **WebTest1** , puis cliquez sur **Ajouter une demande**.</span><span class="sxs-lookup"><span data-stu-id="9467c-626">In the **WebTest1.webtest** Right-click the **WebTest1** node and click **Add Request**.</span></span>

    <span data-ttu-id="9467c-627">![Ajout d’une requête à WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Ajout d’une requête à WebTest1")</span><span class="sxs-lookup"><span data-stu-id="9467c-627">![Adding a request to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image81.png "Adding a request to WebTest1")</span></span>

    <span data-ttu-id="9467c-628">*Ajout d’une requête à WebTest1*</span><span class="sxs-lookup"><span data-stu-id="9467c-628">*Adding a request to WebTest1*</span></span>
4. <span data-ttu-id="9467c-629">Dans la fenêtre **Propriétés** du nouveau nœud requête, mettez à jour la propriété **URL** de sorte qu’elle pointe vers l’URL de votre application Web (par exemple, *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)* ).</span><span class="sxs-lookup"><span data-stu-id="9467c-629">In the **Properties** window of the new request node, update the **Url** property to point to the URL of your web app (e.g. *[http://geek-quiz.azurewebsites.net/](http://geek-quiz.azurewebsites.net/)*).</span></span>

    <span data-ttu-id="9467c-630">![Modification de la propriété URL](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Modification de la propriété URL")</span><span class="sxs-lookup"><span data-stu-id="9467c-630">![Changing the Url property](maintainable-azure-websites-managing-change-and-scale/_static/image82.png "Changing the Url property")</span></span>

    <span data-ttu-id="9467c-631">*Modification de la propriété URL*</span><span class="sxs-lookup"><span data-stu-id="9467c-631">*Changing the Url property*</span></span>
5. <span data-ttu-id="9467c-632">Dans la fenêtre **WebTest1. WebTest** , cliquez avec le bouton droit sur **WebTest1** , puis cliquez sur **Ajouter une boucle...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-632">In the **WebTest1.webtest** window, right-click **WebTest1** and click **Add Loop...**.</span></span>

    <span data-ttu-id="9467c-633">![Ajout d’une boucle à WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Ajout d’une boucle à WebTest1")</span><span class="sxs-lookup"><span data-stu-id="9467c-633">![Adding a loop to WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image83.png "Adding a loop to WebTest1")</span></span>

    <span data-ttu-id="9467c-634">*Ajout d’une boucle à WebTest1*</span><span class="sxs-lookup"><span data-stu-id="9467c-634">*Adding a loop to WebTest1*</span></span>
6. <span data-ttu-id="9467c-635">Dans la boîte de dialogue **Ajouter une règle conditionnelle et des éléments à la boucle** , sélectionnez la règle **de boucle for** et modifiez les propriétés suivantes.</span><span class="sxs-lookup"><span data-stu-id="9467c-635">In the **Add Conditional Rule and Items to Loop** dialog box, select the **For Loop** rule and modify the following properties.</span></span>

   1. <span data-ttu-id="9467c-636">**Valeur de fin :** 1000</span><span class="sxs-lookup"><span data-stu-id="9467c-636">**Terminating value:** 1000</span></span>
   2. <span data-ttu-id="9467c-637">**Nom du paramètre de contexte :** Répétiteur</span><span class="sxs-lookup"><span data-stu-id="9467c-637">**Context Parameter Name:** Iterator</span></span>
   3. <span data-ttu-id="9467c-638">**Valeur d’incrément :** 1</span><span class="sxs-lookup"><span data-stu-id="9467c-638">**Increment Value:** 1</span></span>

      <span data-ttu-id="9467c-639">![Sélection de la règle de boucle for et mise à jour des propriétés](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Sélection de la règle de boucle for et mise à jour des propriétés")</span><span class="sxs-lookup"><span data-stu-id="9467c-639">![Selecting the For Loop rule and updating the properties](maintainable-azure-websites-managing-change-and-scale/_static/image84.png "Selecting the For Loop rule and updating the properties")</span></span>

      <span data-ttu-id="9467c-640">*Sélection de la règle de boucle for et mise à jour des propriétés*</span><span class="sxs-lookup"><span data-stu-id="9467c-640">*Selecting the For Loop rule and updating the properties*</span></span>
7. <span data-ttu-id="9467c-641">Dans la section **éléments dans la boucle** , sélectionnez la requête que vous avez créée précédemment pour être le premier et le dernier élément de la boucle.</span><span class="sxs-lookup"><span data-stu-id="9467c-641">Under the **Items in loop** section, select the request you created previously to be the first and last item for the loop.</span></span> <span data-ttu-id="9467c-642">Cliquez sur **OK** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-642">Click **OK** to continue.</span></span>

    <span data-ttu-id="9467c-643">![Sélection des premier et dernier éléments de la boucle](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Sélection des premier et dernier éléments de la boucle")</span><span class="sxs-lookup"><span data-stu-id="9467c-643">![Selecting the first and last items for the loop](maintainable-azure-websites-managing-change-and-scale/_static/image85.png "Selecting the first and last items for the loop")</span></span>

    <span data-ttu-id="9467c-644">*Sélection des premier et dernier éléments de la boucle*</span><span class="sxs-lookup"><span data-stu-id="9467c-644">*Selecting the first and last items for the loop*</span></span>
8. <span data-ttu-id="9467c-645">Dans **Explorateur de solutions**, cliquez avec le bouton droit sur le projet **WebAndLoadTestProject** , développez le menu **Ajouter** et sélectionnez **test de charge...** .</span><span class="sxs-lookup"><span data-stu-id="9467c-645">In **Solution Explorer**, right-click the **WebAndLoadTestProject** project, expand the **Add** menu and select **Load Test...**.</span></span>

    <span data-ttu-id="9467c-646">![Ajout d’un test de charge au projet WebAndLoadTestProject](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Ajout d’un test de charge au projet WebAndLoadTestProject")</span><span class="sxs-lookup"><span data-stu-id="9467c-646">![Adding a Load Test to the WebAndLoadTestProject project](maintainable-azure-websites-managing-change-and-scale/_static/image86.png "Adding a Load Test to the WebAndLoadTestProject project")</span></span>

    <span data-ttu-id="9467c-647">*Ajout d’un test de charge au projet WebAndLoadTestProject*</span><span class="sxs-lookup"><span data-stu-id="9467c-647">*Adding a Load Test to the WebAndLoadTestProject project*</span></span>
9. <span data-ttu-id="9467c-648">Dans la boîte de dialogue **nouveau Assistant test de charge** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-648">In the **New Load Test Wizard** dialog box, click **Next**.</span></span>

    <span data-ttu-id="9467c-649">![Nouvelle Assistant Test de charge](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "Nouvelle Assistant Test de charge")</span><span class="sxs-lookup"><span data-stu-id="9467c-649">![New Load Test Wizard](maintainable-azure-websites-managing-change-and-scale/_static/image87.png "New Load Test Wizard")</span></span>

    <span data-ttu-id="9467c-650">*Nouvelle Assistant Test de charge*</span><span class="sxs-lookup"><span data-stu-id="9467c-650">*New Load Test Wizard*</span></span>
10. <span data-ttu-id="9467c-651">Dans la page **scénario** , sélectionnez **ne pas utiliser les temps de réflexion** , puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-651">In the **Scenario** page, select **Do not use think times** and click **Next**.</span></span>

    <span data-ttu-id="9467c-652">![Sélectionner de ne pas utiliser les temps de réflexion](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Sélectionner de ne pas utiliser les temps de réflexion")</span><span class="sxs-lookup"><span data-stu-id="9467c-652">![Selecting not to use think times](maintainable-azure-websites-managing-change-and-scale/_static/image88.png "Selecting not to use think times")</span></span>

    <span data-ttu-id="9467c-653">*Sélectionner de ne pas utiliser les temps de réflexion*</span><span class="sxs-lookup"><span data-stu-id="9467c-653">*Selecting not to use think times*</span></span>
11. <span data-ttu-id="9467c-654">Dans la page **modèle de charge** , assurez-vous que l’option de **charge constante** est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="9467c-654">In the **Load Pattern** page, make sure that the **Constant Load** option is selected.</span></span> <span data-ttu-id="9467c-655">Modifiez le paramètre du **nombre d’utilisateurs** sur **250** utilisateurs, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-655">Change the **User Count** setting to **250** users and click **Next**.</span></span>

    <span data-ttu-id="9467c-656">![Modification du nombre d’utilisateurs en 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Modification du nombre d’utilisateurs en 250")</span><span class="sxs-lookup"><span data-stu-id="9467c-656">![Changing the user count to 250](maintainable-azure-websites-managing-change-and-scale/_static/image89.png "Changing the user count to 250")</span></span>

    <span data-ttu-id="9467c-657">*Modification du nombre d’utilisateurs en 250*</span><span class="sxs-lookup"><span data-stu-id="9467c-657">*Changing the user count to 250*</span></span>
12. <span data-ttu-id="9467c-658">Dans la page **modèle de combinaison de tests** , sélectionnez **basé sur l’ordre séquentiel des tests** , puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-658">In the **Test Mix Model** page, select **Based on sequential test order** and click **Next**.</span></span>

    <span data-ttu-id="9467c-659">![Sélection du modèle de combinaison de tests](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Sélection du modèle de combinaison de tests")</span><span class="sxs-lookup"><span data-stu-id="9467c-659">![Selecting the test mix model](maintainable-azure-websites-managing-change-and-scale/_static/image90.png "Selecting the test mix model")</span></span>

    <span data-ttu-id="9467c-660">*Sélection du modèle de combinaison de tests*</span><span class="sxs-lookup"><span data-stu-id="9467c-660">*Selecting the test mix model*</span></span>
13. <span data-ttu-id="9467c-661">Dans la page **modèle de combinaison de tests** , cliquez sur **Ajouter** pour ajouter un test à la combinaison.</span><span class="sxs-lookup"><span data-stu-id="9467c-661">In the **Test Mix Model** page, click **Add...** to add a test to the mix.</span></span>

    <span data-ttu-id="9467c-662">![Ajout d’un test à la combinaison de tests](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Ajout d’un test à la combinaison de tests")</span><span class="sxs-lookup"><span data-stu-id="9467c-662">![Adding a test to the test mix](maintainable-azure-websites-managing-change-and-scale/_static/image91.png "Adding a test to the test mix")</span></span>

    <span data-ttu-id="9467c-663">*Ajout d’un test à la combinaison de tests*</span><span class="sxs-lookup"><span data-stu-id="9467c-663">*Adding a test to the test mix*</span></span>
14. <span data-ttu-id="9467c-664">Dans la boîte de dialogue **Ajouter des tests** , double-cliquez sur **WebTest1** pour ajouter le test à la liste des **tests sélectionnés** .</span><span class="sxs-lookup"><span data-stu-id="9467c-664">In the **Add Tests** dialog box, double-click **WebTest1** to add the test to the **Selected tests** list.</span></span> <span data-ttu-id="9467c-665">Cliquez sur **OK** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="9467c-665">Click **OK** to continue.</span></span>

    <span data-ttu-id="9467c-666">![Ajout du test WebTest1](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Ajout du test WebTest1")</span><span class="sxs-lookup"><span data-stu-id="9467c-666">![Adding the WebTest1 test](maintainable-azure-websites-managing-change-and-scale/_static/image92.png "Adding the WebTest1 test")</span></span>

    <span data-ttu-id="9467c-667">*Ajout du test WebTest1*</span><span class="sxs-lookup"><span data-stu-id="9467c-667">*Adding the WebTest1 test*</span></span>
15. <span data-ttu-id="9467c-668">De retour dans la page **combinaison de tests** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-668">Back in the **Test Mix** page, click **Next**.</span></span>

    <span data-ttu-id="9467c-669">![Fin de la page de combinaison de tests](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Fin de la page de combinaison de tests")</span><span class="sxs-lookup"><span data-stu-id="9467c-669">![Completing the Test Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image93.png "Completing the Test Mix page")</span></span>

    <span data-ttu-id="9467c-670">*Fin de la page de combinaison de tests*</span><span class="sxs-lookup"><span data-stu-id="9467c-670">*Completing the Test Mix page*</span></span>
16. <span data-ttu-id="9467c-671">Dans la page **combinaison de réseaux** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-671">In the **Network Mix** page, click **Next**.</span></span>

    <span data-ttu-id="9467c-672">![Cliquant sur suivant dans la page de combinaison de réseaux](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Cliquant sur suivant dans la page de combinaison de réseaux")</span><span class="sxs-lookup"><span data-stu-id="9467c-672">![Clicking next in the Network Mix page](maintainable-azure-websites-managing-change-and-scale/_static/image94.png "Clicking next in the Network Mix page")</span></span>

    <span data-ttu-id="9467c-673">*Cliquant sur suivant dans la page de combinaison de réseaux*</span><span class="sxs-lookup"><span data-stu-id="9467c-673">*Clicking next in the Network Mix page*</span></span>
17. <span data-ttu-id="9467c-674">Dans la page **combinaison de navigateurs** , sélectionnez **Internet Explorer 10,0** comme type de navigateur, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-674">In the **Browser Mix** page, select **Internet Explorer 10.0** as the browser type and click **Next**.</span></span>

    <span data-ttu-id="9467c-675">![Sélection du type de navigateur](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Sélection du type de navigateur")</span><span class="sxs-lookup"><span data-stu-id="9467c-675">![Selecting the browser type](maintainable-azure-websites-managing-change-and-scale/_static/image95.png "Selecting the browser type")</span></span>

    <span data-ttu-id="9467c-676">*Sélection du type de navigateur*</span><span class="sxs-lookup"><span data-stu-id="9467c-676">*Selecting the browser type*</span></span>
18. <span data-ttu-id="9467c-677">Dans la page **ensembles de compteurs** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9467c-677">In the **Counter Sets** page, click **Next**.</span></span>

    <span data-ttu-id="9467c-678">![Cliquant sur suivant dans la page ensembles de compteurs](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Cliquant sur suivant dans la page ensembles de compteurs")</span><span class="sxs-lookup"><span data-stu-id="9467c-678">![Clicking Next in the Counter Sets page](maintainable-azure-websites-managing-change-and-scale/_static/image96.png "Clicking Next in the Counter Sets page")</span></span>

    <span data-ttu-id="9467c-679">*Cliquant sur suivant dans la page ensembles de compteurs*</span><span class="sxs-lookup"><span data-stu-id="9467c-679">*Clicking Next in the Counter Sets page*</span></span>
19. <span data-ttu-id="9467c-680">Dans la page **paramètres d’exécution** , définissez la durée du test de **charge** sur **5 minutes** , puis cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="9467c-680">In the **Run Settings** page, set the **Load test duration** to **5 minutes** and click **Finish**.</span></span>

    <span data-ttu-id="9467c-681">![Définition de la durée du test de charge sur 5 minutes](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Définition de la durée du test de charge sur 5 minutes")</span><span class="sxs-lookup"><span data-stu-id="9467c-681">![Setting the load test duration to 5 minutes](maintainable-azure-websites-managing-change-and-scale/_static/image97.png "Setting the load test duration to 5 minutes")</span></span>

    <span data-ttu-id="9467c-682">*Définition de la durée du test de charge sur 5 minutes*</span><span class="sxs-lookup"><span data-stu-id="9467c-682">*Setting the load test duration to 5 minutes*</span></span>
20. <span data-ttu-id="9467c-683">Dans **Explorateur de solutions**, double-cliquez sur le fichier **local. Settings** pour explorer les paramètres de test.</span><span class="sxs-lookup"><span data-stu-id="9467c-683">In **Solution Explorer**, double-click the **Local.settings** file to explore the test settings.</span></span> <span data-ttu-id="9467c-684">Par défaut, Visual Studio utilise votre ordinateur local pour exécuter les tests.</span><span class="sxs-lookup"><span data-stu-id="9467c-684">By default, Visual Studio uses your local computer to run the tests.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-685">Vous pouvez également configurer votre projet de test pour exécuter les tests de charge dans le Cloud à l’aide de **Azure test plans**.</span><span class="sxs-lookup"><span data-stu-id="9467c-685">Alternatively, you can configure your test project to run the load tests in the cloud using **Azure Test Plans**.</span></span> <span data-ttu-id="9467c-686">Azure Test Plans fournit un service de test de charge basé sur le Cloud qui simule une charge plus réaliste, évitant les contraintes de l’environnement local, telles que la capacité du processeur, la mémoire disponible et la bande passante réseau.</span><span class="sxs-lookup"><span data-stu-id="9467c-686">Azure Test Plans provides a cloud-based load testing service that simulates a more realistic load, avoiding local environment constraints like CPU capacity, available memory, and network bandwidth.</span></span> <span data-ttu-id="9467c-687">Pour plus d’informations sur l’utilisation de Azure Test Plans pour exécuter des tests de charge, consultez [scénarios de test de charge](/azure/devops/test/load-test/overview?view=vsts).</span><span class="sxs-lookup"><span data-stu-id="9467c-687">For more information about using Azure Test Plans to run load tests, see [Load testing scenarios](/azure/devops/test/load-test/overview?view=vsts).</span></span>

    ![Paramètres de test](maintainable-azure-websites-managing-change-and-scale/_static/image98.png)

<a id="Ex5Task3"></a>
#### <a name="task-3--autoscale-verification"></a><span data-ttu-id="9467c-689">Tâche 3 : vérification de la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="9467c-689">Task 3 – Autoscale Verification</span></span>

<span data-ttu-id="9467c-690">Vous allez maintenant exécuter le test de charge que vous avez créé lors de la tâche précédente et voir comment votre application Web se comporte sous charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-690">You will now execute the load test you created in the previous task and see how your web app behaves under load.</span></span>

1. <span data-ttu-id="9467c-691">Dans **Explorateur de solutions**, double-cliquez sur **LoadTest1. LoadTest** pour ouvrir le test de charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-691">In **Solution Explorer**, double-click **LoadTest1.loadtest** to open the load test.</span></span>

    <span data-ttu-id="9467c-692">![Ouverture de LoadTest1. LoadTest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Ouverture de LoadTest1. LoadTest")</span><span class="sxs-lookup"><span data-stu-id="9467c-692">![Opening LoadTest1.loadtest](maintainable-azure-websites-managing-change-and-scale/_static/image99.png "Opening LoadTest1.loadtest")</span></span>

    <span data-ttu-id="9467c-693">*Ouverture de LoadTest1. LoadTest*</span><span class="sxs-lookup"><span data-stu-id="9467c-693">*Opening LoadTest1.loadtest*</span></span>
2. <span data-ttu-id="9467c-694">Dans la fenêtre **LoadTest1. LoadTest** , cliquez sur le premier bouton de la boîte à outils pour exécuter le test de charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-694">In the **LoadTest1.loadtest** window, click the first button in the toolbox to run the load test.</span></span>

    <span data-ttu-id="9467c-695">![Exécution du test de charge](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Exécution du test de charge")</span><span class="sxs-lookup"><span data-stu-id="9467c-695">![Running the load test](maintainable-azure-websites-managing-change-and-scale/_static/image100.png "Running the load test")</span></span>

    <span data-ttu-id="9467c-696">*Exécution du test de charge*</span><span class="sxs-lookup"><span data-stu-id="9467c-696">*Running the load test*</span></span>
3. <span data-ttu-id="9467c-697">Attendez la fin du test de charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-697">Wait until the load test completes.</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-698">Le test de charge simule plusieurs utilisateurs qui envoient simultanément des demandes à l’application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-698">The load test simulates multiple users that send requests to the web app simultaneously.</span></span> <span data-ttu-id="9467c-699">Lorsque le test est en cours d’exécution, vous pouvez surveiller les compteurs disponibles pour détecter les erreurs, les avertissements ou d’autres informations relatives à votre série de tests de charge.</span><span class="sxs-lookup"><span data-stu-id="9467c-699">When the test is running, you can monitor the available counters to detect any errors, warnings or other information related to your load test run.</span></span>

    <span data-ttu-id="9467c-700">![Exécution du test de charge](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "En attente jusqu’à la fin du test de charge")</span><span class="sxs-lookup"><span data-stu-id="9467c-700">![Load test running](maintainable-azure-websites-managing-change-and-scale/_static/image101.png "Waiting until the load test completes")</span></span>

    <span data-ttu-id="9467c-701">*Exécution du test de charge*</span><span class="sxs-lookup"><span data-stu-id="9467c-701">*Load test running*</span></span>
4. <span data-ttu-id="9467c-702">Une fois le test terminé, revenez au portail de gestion et accédez à la page mettre à l' **échelle** de votre application Web.</span><span class="sxs-lookup"><span data-stu-id="9467c-702">Once the test completes, go back to the management portal and navigate to the **Scale** page of your web app.</span></span> <span data-ttu-id="9467c-703">Dans la section **capacité** , vous devriez voir dans le graphique qu’une nouvelle instance a été déployée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="9467c-703">Under the **capacity** section, you should see in the graph that a new instance was automatically deployed.</span></span>

    ![Nouvelle instance déployée automatiquement](maintainable-azure-websites-managing-change-and-scale/_static/image102.png)

    <span data-ttu-id="9467c-705">*Nouvelle instance déployée automatiquement*</span><span class="sxs-lookup"><span data-stu-id="9467c-705">*New instance automatically deployed*</span></span>

    > [!NOTE]
    > <span data-ttu-id="9467c-706">Plusieurs minutes peuvent être nécessaires pour que les modifications apparaissent dans le graphique (appuyez sur **CTRL + F5** régulièrement pour actualiser la page).</span><span class="sxs-lookup"><span data-stu-id="9467c-706">It may take several minutes for the changes to appear in the graph (press **CTRL + F5** periodically to refresh the page).</span></span> <span data-ttu-id="9467c-707">Si vous ne voyez aucune modification, vous pouvez essayer ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="9467c-707">If you do not see any changes, you can try the following:</span></span>
    >
    > - <span data-ttu-id="9467c-708">Augmentez la durée du test de charge (par exemple, jusqu’à **10 minutes**)</span><span class="sxs-lookup"><span data-stu-id="9467c-708">Increase the duration of the load test (e.g. to **10 minutes**)</span></span>
    > - <span data-ttu-id="9467c-709">Réduire les valeurs maximale et minimale de la plage de l' **UC cible** dans la configuration de la mise à l’échelle automatique de votre application Web</span><span class="sxs-lookup"><span data-stu-id="9467c-709">Reduce the maximum and minimum values of the **Target CPU** range in the Autoscale configuration of your web app</span></span>
    > - <span data-ttu-id="9467c-710">Exécutez le test de charge dans le Cloud avec **Azure test plans**.</span><span class="sxs-lookup"><span data-stu-id="9467c-710">Run the load test in the cloud with **Azure Test Plans**.</span></span> <span data-ttu-id="9467c-711">Plus d’informations [ici](/azure/devops/test/load-test/index?view=vsts)</span><span class="sxs-lookup"><span data-stu-id="9467c-711">More information [here](/azure/devops/test/load-test/index?view=vsts)</span></span>

---

<a id="Summary"></a>
## <a name="summary"></a><span data-ttu-id="9467c-712">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="9467c-712">Summary</span></span>

<span data-ttu-id="9467c-713">Dans ce laboratoire pratique, vous avez appris à configurer et déployer votre application sur des applications Web de production dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9467c-713">In this hands-on lab, you learned how to set up and deploy your application to production web apps in Azure.</span></span> <span data-ttu-id="9467c-714">Vous avez démarré en détectant et en mettant à jour vos bases de données à l’aide de **migrations Entity Framework code First**, puis en déployant de nouvelles versions de votre site à l’aide de **git** et en effectuant des restaurations vers la dernière version stable de votre site.</span><span class="sxs-lookup"><span data-stu-id="9467c-714">You started by detecting and updating your databases using **Entity Framework Code First Migrations**, then continued by deploying new versions of your site using **Git** and performing rollbacks to the latest stable version of your site.</span></span> <span data-ttu-id="9467c-715">En outre, vous avez appris à mettre à l’échelle votre application à l’aide du stockage pour déplacer votre contenu statique vers un conteneur d’objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="9467c-715">Additionally, you learned how to scale your app using Storage to move your static content to a Blob container.</span></span>
