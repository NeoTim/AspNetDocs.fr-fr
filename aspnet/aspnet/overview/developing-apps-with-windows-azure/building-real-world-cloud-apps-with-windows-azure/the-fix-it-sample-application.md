---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: 'Annexe: The Fix It Sample Application (Building Real-World Cloud Apps with Azure) Microsoft Docs'
author: MikeWasson
description: Le Building Real World Cloud Apps avec Azure e-book est basé sur une présentation développée par Scott Guthrie. Il explique 13 modèles et pratiques qui peuvent-il...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: 896196bdb6a6b0d12a6c798ead510e37dd38a9fc
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675991"
---
# <a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="b548d-104">Annexe: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span><span class="sxs-lookup"><span data-stu-id="b548d-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="b548d-105">par [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), Tom [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b548d-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="b548d-106">Télécharger The Fix It Project</span><span class="sxs-lookup"><span data-stu-id="b548d-106">Download The Fix It Project</span></span>](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="b548d-107">Le **Building Real World Cloud Apps avec Azure** e-book est basé sur une présentation développée par Scott Guthrie.</span><span class="sxs-lookup"><span data-stu-id="b548d-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="b548d-108">Il explique 13 modèles et pratiques qui peuvent vous aider à réussir à développer des applications Web pour le cloud.</span><span class="sxs-lookup"><span data-stu-id="b548d-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="b548d-109">Pour plus d’informations sur le livre électronique, voir [le premier chapitre](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="b548d-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="b548d-110">Cette annexe aux applications Cloud Building Real World avec e-book Azure contient les sections suivantes qui fournissent des informations supplémentaires sur l’application d’échantillon Fix It que vous pouvez télécharger :</span><span class="sxs-lookup"><span data-stu-id="b548d-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="b548d-111">Problèmes connus</span><span class="sxs-lookup"><span data-stu-id="b548d-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="b548d-112">Bonnes pratiques</span><span class="sxs-lookup"><span data-stu-id="b548d-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="b548d-113">Comment exécuter l’application à partir de Visual Studio sur votre ordinateur local</span><span class="sxs-lookup"><span data-stu-id="b548d-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="b548d-114">Comment déployer l’application de base sur Azure App Service Web Apps en utilisant les scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="b548d-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="b548d-115">Dépannage des scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="b548d-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="b548d-116">Comment déployer l’application avec le traitement de file d’attente à Azure App Service Web Apps et un service Cloud Azure</span><span class="sxs-lookup"><span data-stu-id="b548d-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="b548d-117">Problèmes connus</span><span class="sxs-lookup"><span data-stu-id="b548d-117">Known issues</span></span>

<span data-ttu-id="b548d-118">L’application Fix It a été développée à l’origine afin d’illustrer aussi simplement que possible certains des modèles présentés dans ce livre électronique.</span><span class="sxs-lookup"><span data-stu-id="b548d-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="b548d-119">Cependant, puisque l’e-book est sur la construction d’applications du monde réel, nous avons soumis le code Fix It à un processus d’examen et de test similaire à ce que nous feriez pour les logiciels publiés.</span><span class="sxs-lookup"><span data-stu-id="b548d-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="b548d-120">Nous avons trouvé un certain nombre de problèmes, et comme avec toute application du monde réel, certains d’entre eux que nous avons fixé et certains d’entre eux nous avons reporté à une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="b548d-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="b548d-121">La liste suivante comprend les questions qui devraient être abordées dans une demande de production, mais pour une raison ou une autre, nous avons décidé de ne pas aborder dans la version initiale de la demande d’échantillon Fix It.</span><span class="sxs-lookup"><span data-stu-id="b548d-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="b548d-122">Sécurité</span><span class="sxs-lookup"><span data-stu-id="b548d-122">Security</span></span>

- <span data-ttu-id="b548d-123">Assurez-vous que vous ne pouvez pas attribuer une tâche à un propriétaire inexistant.</span><span class="sxs-lookup"><span data-stu-id="b548d-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="b548d-124">Assurez-vous que vous ne pouvez afficher et modifier que les tâches que vous avez créées ou qui vous sont assignées.</span><span class="sxs-lookup"><span data-stu-id="b548d-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="b548d-125">Utilisez HTTPS pour les pages de connexion et les cookies d’authentification.</span><span class="sxs-lookup"><span data-stu-id="b548d-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="b548d-126">Spécifier un délai pour les cookies d’authentification.</span><span class="sxs-lookup"><span data-stu-id="b548d-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="b548d-127">Validation des entrées</span><span class="sxs-lookup"><span data-stu-id="b548d-127">Input validation</span></span>

<span data-ttu-id="b548d-128">En général, une application de production ferait plus de validation d’entrée que l’application Fix It.</span><span class="sxs-lookup"><span data-stu-id="b548d-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="b548d-129">Par exemple, la taille de fichier d’image / image autorisée pour le téléchargement doit être limitée.</span><span class="sxs-lookup"><span data-stu-id="b548d-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="b548d-130">Fonctionnalité de l’administrateur</span><span class="sxs-lookup"><span data-stu-id="b548d-130">Administrator functionality</span></span>

<span data-ttu-id="b548d-131">Un administrateur devrait être en mesure de modifier la propriété sur les tâches existantes.</span><span class="sxs-lookup"><span data-stu-id="b548d-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="b548d-132">Par exemple, le créateur d’une tâche peut quitter l’entreprise, ne laissant à personne le pouvoir de maintenir la tâche à moins que l’accès administratif ne soit activé.</span><span class="sxs-lookup"><span data-stu-id="b548d-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="b548d-133">Traitement des messages de file d’attente</span><span class="sxs-lookup"><span data-stu-id="b548d-133">Queue message processing</span></span>

<span data-ttu-id="b548d-134">Le traitement des messages de file d’attente dans l’application Fix It a été conçu pour être simple afin d’illustrer le modèle de travail centré sur la file d’attente avec une quantité minimale de code.</span><span class="sxs-lookup"><span data-stu-id="b548d-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="b548d-135">Ce code simple ne serait pas suffisant pour une application de production réelle.</span><span class="sxs-lookup"><span data-stu-id="b548d-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="b548d-136">Le code ne garantit pas que chaque message de file d’attente sera traité tout au plus une fois.</span><span class="sxs-lookup"><span data-stu-id="b548d-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="b548d-137">Lorsque vous obtenez un message de la file d’attente, il ya une période de délai, au cours de laquelle le message est invisible pour les autres auditeurs de file d’attente.</span><span class="sxs-lookup"><span data-stu-id="b548d-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="b548d-138">Si le délai d’expiration expire avant que le message ne soit supprimé, le message redevient visible.</span><span class="sxs-lookup"><span data-stu-id="b548d-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="b548d-139">Par conséquent, si une instance de rôle de travailleur passe beaucoup de temps à traiter un message, il est théoriquement possible que le même message soit traité deux fois, ce qui entraîne une tâche en double dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="b548d-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="b548d-140">Pour plus d’informations sur ce problème, voir [Utiliser Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="b548d-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="b548d-141">La logique de sondage de file d’attente pourrait être plus rentable, en passant par la récupération de messages par lots.</span><span class="sxs-lookup"><span data-stu-id="b548d-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="b548d-142">Chaque fois que vous appelez [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), il ya un coût de transaction.</span><span class="sxs-lookup"><span data-stu-id="b548d-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="b548d-143">Au lieu de cela, vous pouvez appeler [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (notez le pluriel 's'), qui reçoit plusieurs messages en une seule transaction.</span><span class="sxs-lookup"><span data-stu-id="b548d-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="b548d-144">Les coûts de transaction pour les files d’attente de stockage Azure sont très faibles, de sorte que l’impact sur les coûts n’est pas substantiel dans la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="b548d-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="b548d-145">La boucle serrée dans le code de traitement des messages de file d’attente provoque l’affinité CPU, qui n’utilise pas les VM multi-core efficacement.</span><span class="sxs-lookup"><span data-stu-id="b548d-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="b548d-146">Une meilleure conception utiliserait le parallélisme de tâche pour exécuter plusieurs tâches async en parallèle.</span><span class="sxs-lookup"><span data-stu-id="b548d-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="b548d-147">Le traitement des messages de file d’attente n’a qu’une manipulation rudimentaire des exceptions.</span><span class="sxs-lookup"><span data-stu-id="b548d-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="b548d-148">Par exemple, le code ne traite pas les [messages empoisonnés](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="b548d-149">(Lorsque le traitement des messages provoque une exception, vous devez enregistrer l’erreur et supprimer le message, ou le rôle de travailleur va essayer de le traiter à nouveau, et la boucle se poursuivra indéfiniment.)</span><span class="sxs-lookup"><span data-stu-id="b548d-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="b548d-150">Les requêtes SQL ne sont pas illimitées</span><span class="sxs-lookup"><span data-stu-id="b548d-150">SQL queries are unbounded</span></span>

<span data-ttu-id="b548d-151">Le code Fix It actuel ne limite pas le nombre de lignes que les requêtes pour les pages Index peuvent revenir.</span><span class="sxs-lookup"><span data-stu-id="b548d-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="b548d-152">Si un grand nombre de tâches est saisie dans la base de données, la taille des listes reçues pourrait causer des problèmes de performances.</span><span class="sxs-lookup"><span data-stu-id="b548d-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="b548d-153">La solution est de mettre en œuvre le paaging.</span><span class="sxs-lookup"><span data-stu-id="b548d-153">The solution is to implement paging.</span></span> <span data-ttu-id="b548d-154">Par exemple, voir [Le tri, le filtrage et le paging avec le cadre d’entité dans une application ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="b548d-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="b548d-155">Afficher les modèles recommandés</span><span class="sxs-lookup"><span data-stu-id="b548d-155">View models recommended</span></span>

<span data-ttu-id="b548d-156">L’application Fix It utilise la classe d’entités FixItTask pour transmettre des informations entre le contrôleur et la vue.</span><span class="sxs-lookup"><span data-stu-id="b548d-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="b548d-157">Une meilleure pratique consiste à utiliser des modèles de vue.</span><span class="sxs-lookup"><span data-stu-id="b548d-157">A best practice is to use view models.</span></span> <span data-ttu-id="b548d-158">Le modèle de domaine (par exemple, la classe d’entité FixItTask) est conçu autour de ce qui est nécessaire pour la persistance des données, tandis qu’un modèle de vue peut être conçu pour la présentation des données.</span><span class="sxs-lookup"><span data-stu-id="b548d-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="b548d-159">Pour plus d’informations, voir [12 ASP.NET meilleures pratiques de MVC](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-159">For more information, see [12 ASP.NET MVC Best Practices](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="b548d-160">Blob image sécurisée recommandé</span><span class="sxs-lookup"><span data-stu-id="b548d-160">Secure image blob recommended</span></span>

<span data-ttu-id="b548d-161">L’application Fix It stocke des images téléchargées en public, ce qui signifie que toute personne qui trouve l’URL peut accéder aux images.</span><span class="sxs-lookup"><span data-stu-id="b548d-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="b548d-162">Les images pourraient être sécurisées au lieu d’être publiques.</span><span class="sxs-lookup"><span data-stu-id="b548d-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="b548d-163">Pas de scripts d’automatisation PowerShell pour les files d’attente</span><span class="sxs-lookup"><span data-stu-id="b548d-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="b548d-164">Les scripts d’automatisation d’échantillon powerShell ont été écrits uniquement pour la version de base de Fix It qui s’exécute entièrement dans Azure App Service Web Apps.</span><span class="sxs-lookup"><span data-stu-id="b548d-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="b548d-165">Nous n’avons pas fourni de scripts pour la configuration et le déploiement sur l’application Web ainsi que l’environnement Cloud Service requis pour le traitement des files d’attente.</span><span class="sxs-lookup"><span data-stu-id="b548d-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="b548d-166">Manipulation spéciale pour les codes HTML dans l’entrée de l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="b548d-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="b548d-167">ASP.NET empêche automatiquement de nombreuses façons dont les utilisateurs malveillants peuvent tenter des attaques de script cross-site en entrant le script dans les boîtes de texte d’entrée de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b548d-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="b548d-168">Et l’aide MVC `DisplayFor` utilisé pour afficher les titres de tâches et les notes automatiquement HTML-encodes valeurs qu’il envoie au navigateur.</span><span class="sxs-lookup"><span data-stu-id="b548d-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="b548d-169">Mais dans une application de production, vous voudrez peut-être prendre des mesures supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b548d-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="b548d-170">Pour plus d’informations, voir [Validation de la demande dans ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="b548d-171">Meilleures pratiques</span><span class="sxs-lookup"><span data-stu-id="b548d-171">Best practices</span></span>

<span data-ttu-id="b548d-172">Voici quelques problèmes qui ont été résolus après avoir été découverts dans l’examen du code et les tests de la version originale de l’application Fix It.</span><span class="sxs-lookup"><span data-stu-id="b548d-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="b548d-173">Certains ont été causés par le codeur d’origine n’étant pas au courant d’une pratique exemplaire particulière, d’autres simplement parce que le code a été écrit rapidement et n’était pas destiné à un logiciel publié.</span><span class="sxs-lookup"><span data-stu-id="b548d-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="b548d-174">Nous énumérons les problèmes ici au cas où il ya quelque chose que nous avons appris de cet examen et de tests qui pourraient être utiles à d’autres qui sont également le développement d’applications Web.</span><span class="sxs-lookup"><span data-stu-id="b548d-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="b548d-175">Disposer le référentiel de base de données</span><span class="sxs-lookup"><span data-stu-id="b548d-175">Dispose the database repository</span></span>

<span data-ttu-id="b548d-176">La `FixItTaskRepository` classe doit disposer `DbContext` de l’instance cadre d’entité.</span><span class="sxs-lookup"><span data-stu-id="b548d-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="b548d-177">Nous l’avons `IDisposable` fait `FixItTaskRepository` en mettant en œuvre dans la classe:</span><span class="sxs-lookup"><span data-stu-id="b548d-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="b548d-178">Notez qu’AutoFac `FixItTaskRepository` se débarrasse automatiquement de l’instance, de sorte que nous n’avons pas besoin de l’éliminer explicitement.</span><span class="sxs-lookup"><span data-stu-id="b548d-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="b548d-179">Une autre option `DbContext` est de `FixItTaskRepository`supprimer la variable `DbContext` du membre de , et `using` à la place de créer une variable locale dans chaque méthode de dépôt, à l’intérieur d’une instruction.</span><span class="sxs-lookup"><span data-stu-id="b548d-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="b548d-180">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="b548d-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="b548d-181">Enregistrez les singletons en tant que tels avec DI</span><span class="sxs-lookup"><span data-stu-id="b548d-181">Register singletons as such with DI</span></span>

<span data-ttu-id="b548d-182">Étant donné qu’un `PhotoService` `Logger` seul cas de la classe et de la classe est nécessaire, ces classes doivent être [enregistrées comme des cas uniques pour l’injection de dépendance](https://code.google.com/p/autofac/wiki/InstanceScope) dans *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="b548d-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="b548d-183">Sécurité : Ne montrez pas les détails des erreurs aux utilisateurs</span><span class="sxs-lookup"><span data-stu-id="b548d-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="b548d-184">L’application d’origine Fix It n’avait pas de page d’erreur générique et il suffit de laisser toutes les exceptions bouillonner jusqu’à l’interface utilisateur, de sorte que certaines exceptions telles que les erreurs de connexion de base de données pourrait entraîner une trace de pile complète étant affiché sur le navigateur.</span><span class="sxs-lookup"><span data-stu-id="b548d-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="b548d-185">Les informations détaillées sur les erreurs peuvent parfois faciliter les attaques d’utilisateurs malveillants.</span><span class="sxs-lookup"><span data-stu-id="b548d-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="b548d-186">La solution consiste à enregistrer les détails d’exception et à afficher une page d’erreur à l’utilisateur qui n’inclut pas de détails d’erreur.</span><span class="sxs-lookup"><span data-stu-id="b548d-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="b548d-187">L’application Fix It se connectait déjà, et afin `<customErrors mode=On>` d’afficher une page d’erreur, nous avons ajouté dans le fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="b548d-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="b548d-188">Par défaut, cela provoque *l’affichage des erreurs de Views.Shared.Error.cshtml.*</span><span class="sxs-lookup"><span data-stu-id="b548d-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="b548d-189">Vous pouvez personnaliser *Error.cshtml* ou créer votre propre `defaultRedirect` vue de page d’erreur et ajouter un attribut.</span><span class="sxs-lookup"><span data-stu-id="b548d-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="b548d-190">Vous pouvez également spécifier différentes pages d’erreur pour des erreurs spécifiques.</span><span class="sxs-lookup"><span data-stu-id="b548d-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="b548d-191">Sécurité : ne permet-on qu’une tâche d’être éditée par son créateur</span><span class="sxs-lookup"><span data-stu-id="b548d-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="b548d-192">La page Dashboard Index n’affiche que les tâches créées par l’utilisateur connecté, mais un utilisateur malveillant peut créer une URL avec un IDENTIFIANT à la tâche d’un autre utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b548d-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="b548d-193">Nous avons ajouté du code dans *DashboardController.cs* pour retourner un 404 dans ce cas:</span><span class="sxs-lookup"><span data-stu-id="b548d-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="b548d-194">N’avalez pas les exceptions</span><span class="sxs-lookup"><span data-stu-id="b548d-194">Don't swallow exceptions</span></span>

<span data-ttu-id="b548d-195">L’application Fix It originale vient de revenir nulle après avoir inscrit une exception résultant d’une requête SQL:</span><span class="sxs-lookup"><span data-stu-id="b548d-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="b548d-196">Cela ferait en sorte qu’il se tournerait vers l’utilisateur comme si la requête a réussi, mais n’a tout simplement pas retourné les lignes.</span><span class="sxs-lookup"><span data-stu-id="b548d-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="b548d-197">La solution consiste à re-jeter l’exception après la capture et l’enregistrement:</span><span class="sxs-lookup"><span data-stu-id="b548d-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="b548d-198">Attraper toutes les exceptions dans les rôles de travailleurs</span><span class="sxs-lookup"><span data-stu-id="b548d-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="b548d-199">Toute exception non gérée dans un rôle de travailleur fera recycler la VM, de sorte que vous voulez envelopper tout ce que vous faites dans un bloc try-catch et gérer toutes les exceptions.</span><span class="sxs-lookup"><span data-stu-id="b548d-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="b548d-200">Spécifier la longueur des propriétés de chaîne dans les classes d’entités</span><span class="sxs-lookup"><span data-stu-id="b548d-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="b548d-201">Afin d’afficher du code simple, la version originale de l’application Fix It n’a pas précisé les longueurs pour les champs de l’entité FixItTask, et par conséquent ils ont été définis comme varchar(max) dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="b548d-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="b548d-202">Par conséquent, l’interface utilisateur accepterait presque n’importe quelle quantité d’intrants.</span><span class="sxs-lookup"><span data-stu-id="b548d-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="b548d-203">Spécifiant les longueurs fixe des limites qui s’appliquent à la fois à l’entrée de l’utilisateur dans la page Web et la taille de la colonne dans la base de données :</span><span class="sxs-lookup"><span data-stu-id="b548d-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="b548d-204">Marquez les membres privés comme readonly quand ils ne sont pas censés changer</span><span class="sxs-lookup"><span data-stu-id="b548d-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="b548d-205">Par exemple, `DashboardController` dans la `FixItTaskRepository` classe, une instance de est créé et ne devrait pas changer, donc nous l’avons défini comme [lisible](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="b548d-206">Utilisez la liste. N’importe quel () au lieu de la liste. Comte() &gt; 0</span><span class="sxs-lookup"><span data-stu-id="b548d-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="b548d-207">Si vous vous souciez tout ce qui vous intéresse est de savoir si un ou plusieurs éléments dans une liste `Count` correspondent aux critères spécifiés, utilisez la méthode [Any,](https://msdn.microsoft.com/library/bb534972.aspx) car elle revient dès qu’un élément correspondant aux critères est trouvé, alors que la méthode doit toujours itérer à travers chaque élément.</span><span class="sxs-lookup"><span data-stu-id="b548d-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="b548d-208">Le fichier Dashboard *Index.cshtml* avait à l’origine ce code :</span><span class="sxs-lookup"><span data-stu-id="b548d-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="b548d-209">Nous l’avons changé pour ceci :</span><span class="sxs-lookup"><span data-stu-id="b548d-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="b548d-210">Générer des URL dans les vues MVC à l’aide d’aides MVC</span><span class="sxs-lookup"><span data-stu-id="b548d-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="b548d-211">Pour le bouton **Créer un Fix It** sur la page d’accueil, l’application Fix It a codé un élément d’ancrage :</span><span class="sxs-lookup"><span data-stu-id="b548d-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="b548d-212">Pour les liens View/Action comme celui-ci, il est préférable d’utiliser l’assistant HTML [Url.Action,](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) par exemple :</span><span class="sxs-lookup"><span data-stu-id="b548d-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="b548d-213">Utilisez Task.Delay au lieu de Thread.Sleep dans le rôle de travailleur</span><span class="sxs-lookup"><span data-stu-id="b548d-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="b548d-214">Le modèle de `Thread.Sleep` nouveau projet met dans le code d’échantillon pour un rôle de travailleur, mais causant le fil de dormir peut provoquer le pool de thread pour engendrer des fils inutiles supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="b548d-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="b548d-215">Vous pouvez éviter cela en utilisant [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) à la place.</span><span class="sxs-lookup"><span data-stu-id="b548d-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="b548d-216">Éviter le vide async</span><span class="sxs-lookup"><span data-stu-id="b548d-216">Avoid async void</span></span>

<span data-ttu-id="b548d-217">Si une méthode async n’a pas besoin `Task` de `void`retourner une valeur, retournez un type plutôt que .</span><span class="sxs-lookup"><span data-stu-id="b548d-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="b548d-218">Cet exemple vient `FixItQueueManager` de la classe :</span><span class="sxs-lookup"><span data-stu-id="b548d-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="b548d-219">Vous ne `async void` devez utiliser que pour les gestionnaires d’événements de haut niveau.</span><span class="sxs-lookup"><span data-stu-id="b548d-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="b548d-220">Si vous définissez `async void`une méthode comme, l’appelant ne peut pas **attendre** la méthode ou attraper les exceptions que la méthode jette.</span><span class="sxs-lookup"><span data-stu-id="b548d-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="b548d-221">Pour plus d’informations, voir [Meilleures pratiques dans la programmation asynchrone](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="b548d-222">Utilisez un jeton d’annulation pour rompre avec la boucle de rôle des travailleurs</span><span class="sxs-lookup"><span data-stu-id="b548d-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="b548d-223">Typiquement, la méthode **Run** sur un rôle de travailleur contient une boucle infinie.</span><span class="sxs-lookup"><span data-stu-id="b548d-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="b548d-224">Lorsque le rôle de travailleur s’arrête, la méthode [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) est appelée.</span><span class="sxs-lookup"><span data-stu-id="b548d-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="b548d-225">Vous devriez utiliser cette méthode pour annuler le travail qui se fait à l’intérieur de la méthode **Run** et sortir gracieusement.</span><span class="sxs-lookup"><span data-stu-id="b548d-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="b548d-226">Dans le cas contraire, le processus pourrait être terminé au milieu d’une opération.</span><span class="sxs-lookup"><span data-stu-id="b548d-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="b548d-227">Optez pour la procédure automatique de reniflement miME</span><span class="sxs-lookup"><span data-stu-id="b548d-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="b548d-228">Dans certains cas, Internet Explorer signale un type MIME différent du type spécifié par le serveur web.</span><span class="sxs-lookup"><span data-stu-id="b548d-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="b548d-229">Par exemple, si Internet Explorer trouve du contenu HTML dans un fichier livré avec l’en-tête de réponse HTTP Content-Type: texte/plaine, Internet Explorer détermine que le contenu doit être rendu sous forme de HTML.</span><span class="sxs-lookup"><span data-stu-id="b548d-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="b548d-230">Malheureusement, ce « reniflement MIME » peut également entraîner des problèmes de sécurité pour les serveurs hébergeant du contenu non fiable.</span><span class="sxs-lookup"><span data-stu-id="b548d-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="b548d-231">Pour lutter contre ce problème, Internet Explorer 8 a apporté un certain nombre de modifications au code de détermination de type MIME et permet aux développeurs [d’applications de se retirer du MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="b548d-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="b548d-232">Le code suivant a été ajouté au fichier *Web.config.*</span><span class="sxs-lookup"><span data-stu-id="b548d-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="b548d-233">Permettre le regroupement et la minification</span><span class="sxs-lookup"><span data-stu-id="b548d-233">Enable bundling and minification</span></span>

<span data-ttu-id="b548d-234">Lorsque Visual Studio crée un nouveau projet web, le regroupement et la minification des fichiers JavaScript ne sont pas activés par défaut.</span><span class="sxs-lookup"><span data-stu-id="b548d-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="b548d-235">Nous avons ajouté une ligne de code dans BundleConfig.cs :</span><span class="sxs-lookup"><span data-stu-id="b548d-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="b548d-236">Définir un délai d’expiration pour les cookies d’authentification</span><span class="sxs-lookup"><span data-stu-id="b548d-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="b548d-237">Par défaut, les cookies d’authentification expirent dans deux semaines.</span><span class="sxs-lookup"><span data-stu-id="b548d-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="b548d-238">Un temps plus court est plus sûr.</span><span class="sxs-lookup"><span data-stu-id="b548d-238">A shorter time is more secure.</span></span> <span data-ttu-id="b548d-239">Vous pouvez modifier ce paramètre en *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="b548d-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="b548d-240">Comment exécuter l’application à partir de Visual Studio sur votre ordinateur local</span><span class="sxs-lookup"><span data-stu-id="b548d-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="b548d-241">Il existe deux façons d’exécuter l’application Fix It :</span><span class="sxs-lookup"><span data-stu-id="b548d-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="b548d-242">Exécutez l’application de base qui écrit de nouvelles tâches directement à la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="b548d-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="b548d-243">Exécutez l’application à l’aide d’une file d’attente plus un service backend pour créer des tâches.</span><span class="sxs-lookup"><span data-stu-id="b548d-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="b548d-244">Le modèle de file d’attente est décrit dans le chapitre [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b548d-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="b548d-245">Exécuter l’application de base</span><span class="sxs-lookup"><span data-stu-id="b548d-245">Run the base application</span></span>

1. <span data-ttu-id="b548d-246">Installer [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="b548d-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="b548d-247">Installez [l’Azure SDK pour .NET pour Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="b548d-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="b548d-248">Téléchargez le fichier .zip de la [GALERIE de code MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="b548d-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="b548d-249">Dans File Explorer, cliquez à droite sur le fichier .zip et cliquez sur Propriétés, puis dans la fenêtre Propriétés cliquez sur Débloquez.</span><span class="sxs-lookup"><span data-stu-id="b548d-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="b548d-250">Décompressez le dossier.</span><span class="sxs-lookup"><span data-stu-id="b548d-250">Unzip the file.</span></span>
6. <span data-ttu-id="b548d-251">Double-cliquez sur le fichier .sln pour lancer Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b548d-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="b548d-252">Du menu **Tools,** cliquez sur **NuGet Package Manager**, puis **Package Manager Console**.</span><span class="sxs-lookup"><span data-stu-id="b548d-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="b548d-253">Dans la console Package Manager (PMC), cliquez sur Restaurer.</span><span class="sxs-lookup"><span data-stu-id="b548d-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="b548d-254">Quittez Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b548d-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="b548d-255">Démarrer [l’émulateur de stockage Azure](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="b548d-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="b548d-256">Redémarrez Visual Studio, en ouvrant le fichier de solution que vous avez fermé dans l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="b548d-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="b548d-257">Assurez-vous que le projet FixIt est défini comme le projet de démarrage, puis appuyez sur CTRL-F5 pour exécuter le projet.</span><span class="sxs-lookup"><span data-stu-id="b548d-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="b548d-258">Exécuter l’application avec le traitement de file d’attente</span><span class="sxs-lookup"><span data-stu-id="b548d-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="b548d-259">Suivez les instructions pour [exécuter l’application de base,](#runbase)puis fermer le navigateur et fermer Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b548d-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="b548d-260">Démarrer Visual Studio avec des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="b548d-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="b548d-261">(Vous utiliserez l’émulateur de calcul Azure, et cela nécessite des privilèges d’administrateur.)</span><span class="sxs-lookup"><span data-stu-id="b548d-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="b548d-262">Dans le fichier *Web.config* de l’application dans le projet `appSettings/UseQueues` *MyFixIt* (le projet web), changez la valeur de "vrai":</span><span class="sxs-lookup"><span data-stu-id="b548d-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="b548d-263">Si [l’émulateur de stockage Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) n’est pas encore en cours d’exécution, recommencez.</span><span class="sxs-lookup"><span data-stu-id="b548d-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="b548d-264">Exécutez simultanément le projet Web FixIt et le projet MyFixItCloudService.</span><span class="sxs-lookup"><span data-stu-id="b548d-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="b548d-265">Utilisation de Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="b548d-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="b548d-266">Appuyez sur **F5** pour mener à bien le projet FixIt.</span><span class="sxs-lookup"><span data-stu-id="b548d-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="b548d-267">Dans **Solution Explorer**, cliquez à droite sur le projet MyFixItCloudService, puis cliquez sur **Debug** > Start New**Instance**.</span><span class="sxs-lookup"><span data-stu-id="b548d-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="b548d-268">Utilisation de Visual Studio 2013 Express pour le Web :</span><span class="sxs-lookup"><span data-stu-id="b548d-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="b548d-269">Dans Solution Explorer, cliquez à droite sur la solution FixIt et sélectionnez **les propriétés**.</span><span class="sxs-lookup"><span data-stu-id="b548d-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="b548d-270">Sélectionnez **plusieurs projets de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="b548d-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="b548d-271">Dans la liste **d’abandon d’action** sous MyFixIt et MyFixItCloudService, sélectionnez **Démarrer**.</span><span class="sxs-lookup"><span data-stu-id="b548d-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="b548d-272">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="b548d-272">Click **OK**.</span></span>
   7. <span data-ttu-id="b548d-273">Appuyez sur **F5** pour exécuter les deux projets.</span><span class="sxs-lookup"><span data-stu-id="b548d-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="b548d-274">Lorsque vous exécutez le projet MyFixItCloudService, Visual Studio démarre l’émulateur de calcul Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="b548d-275">Selon votre configuration de pare-feu, vous devrez peut-être autoriser l’émulateur à travers le pare-feu.</span><span class="sxs-lookup"><span data-stu-id="b548d-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="b548d-276">Comment déployer l’application de base sur Azure App Service Web Apps en utilisant les scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="b548d-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="b548d-277">Pour illustrer le modèle [Automate Everything,](automate-everything.md) l’application Fix It est fournie avec des scripts qui configurent un environnement azuréen et déploient le projet dans le nouvel environnement.</span><span class="sxs-lookup"><span data-stu-id="b548d-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="b548d-278">Les instructions suivantes expliquent comment utiliser les scripts.</span><span class="sxs-lookup"><span data-stu-id="b548d-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="b548d-279">Si vous voulez courir dans Azure sans utiliser de files d’attente, et que vous avez apporté les modifications pour courir localement avec des files d’attente, assurez-vous de définir la valeur UseQueues appSetting de nouveau à faux avant de procéder avec les instructions suivantes.</span><span class="sxs-lookup"><span data-stu-id="b548d-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="b548d-280">Ces instructions supposent que vous avez déjà téléchargé et exécuté la solution Fix It localement, et que vous avez un compte Azure ou avez un abonnement Azure que vous êtes autorisé à gérer.</span><span class="sxs-lookup"><span data-stu-id="b548d-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="b548d-281">Installez la console **Azure PowerShell.**</span><span class="sxs-lookup"><span data-stu-id="b548d-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="b548d-282">Pour obtenir des instructions, consultez la rubrique [Installation et configuration d'Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="b548d-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="b548d-283">Cette console personnalisée est configurée pour travailler avec votre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="b548d-284">Le module Azure est installé dans le répertoire *des fichiers de programme* et est automatiquement importé sur chaque utilisation de la console Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b548d-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="b548d-285">Si vous préférez travailler dans un programme hôte différent, tel que Windows PowerShell ISE, [assurez-vous d’utiliser](https://go.microsoft.com/fwlink/?LinkID=141553) le cmdlet Import-Module pour importer le module Azure ou utiliser une commande dans le module Azure pour déclencher l’importation automatique du module.</span><span class="sxs-lookup"><span data-stu-id="b548d-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="b548d-286">Démarrez Azure PowerShell avec **l’option Run en tant qu’administrateur.**</span><span class="sxs-lookup"><span data-stu-id="b548d-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="b548d-287">Exécuter le [cmdlet Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) pour définir la politique `RemoteSigned`d’exécution Azure PowerShell à .</span><span class="sxs-lookup"><span data-stu-id="b548d-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="b548d-288">Entrez **Y** (pour oui) pour compléter le changement de politique.</span><span class="sxs-lookup"><span data-stu-id="b548d-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="b548d-289">Ce paramètre vous permet d’exécuter des scripts locaux qui ne sont pas signés numériquement.</span><span class="sxs-lookup"><span data-stu-id="b548d-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="b548d-290">(Vous pouvez également définir `Unrestricted`la politique d’exécution à , ce qui éliminerait la nécessité de l’étape de déblocage plus tard, mais ce n’est pas recommandé pour des raisons de sécurité.)</span><span class="sxs-lookup"><span data-stu-id="b548d-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="b548d-291">Exécutez `Add-AzureAccount` le cmdlet pour configurer PowerShell avec des informations d’identification pour votre compte.</span><span class="sxs-lookup"><span data-stu-id="b548d-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="b548d-292">Ces informations d’identification expirent après une période `Add-AzureAccount` de temps et vous devez ré-exécuter le cmdlet.</span><span class="sxs-lookup"><span data-stu-id="b548d-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="b548d-293">Au fur et à mesure que ce livre électronique est en cours d’écriture, le délai avant l’expiration des titres de compétences est de 12 heures.</span><span class="sxs-lookup"><span data-stu-id="b548d-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="b548d-294">Si vous avez plusieurs abonnements, utilisez le cmdlet Select-AzureSubscription pour spécifier l’abonnement dans lequel vous souhaitez créer l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="b548d-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="b548d-295">Importer un certificat de gestion pour le `Get-AzurePublishSettingsFile` `Import-AzurePublishSettingsFile` même abonnement Azure en utilisant les cmdlets et les cmdlets.</span><span class="sxs-lookup"><span data-stu-id="b548d-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="b548d-296">Le premier de ces cmdlets télécharge un fichier de certificat, et dans le second vous spécifiez l’emplacement de ce fichier afin de l’importer.</span><span class="sxs-lookup"><span data-stu-id="b548d-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="b548d-297">Conservez le fichier téléchargé dans un endroit sûr ou supprimez-le lorsque vous en avez fini avec celui-ci, car il contient un certificat qui peut être utilisé pour gérer vos services Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="b548d-298">Le certificat est utilisé pour un appel REST API qui détecte l’adresse IP de la machine de développement afin de définir une règle de pare-feu sur le serveur SQL Database.</span><span class="sxs-lookup"><span data-stu-id="b548d-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="b548d-299">Exécutez le [cmdlet Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) `chdir`(alias `sl`sont `cd`, , et ) pour naviguer vers le répertoire qui contient les scripts.</span><span class="sxs-lookup"><span data-stu-id="b548d-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="b548d-300">(Ils sont situés dans le dossier *Automation* dans le dossier de solution Fix It.) Mettez le chemin entre guillemets si l’un des noms d’annuaire contient des espaces.</span><span class="sxs-lookup"><span data-stu-id="b548d-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="b548d-301">Par exemple, pour `c:\Sample Apps\FixIt\Automation` naviguer vers l’annuaire, vous pouvez entrer la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="b548d-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="b548d-302">Pour permettre à Windows PowerShell d’exécuter ces scripts, utilisez le cmdlet [Unblock-File.](https://go.microsoft.com/fwlink/p/?linkid=294021)</span><span class="sxs-lookup"><span data-stu-id="b548d-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="b548d-303">(Les scripts sont bloqués parce qu’ils ont été téléchargés à partir d’Internet.)</span><span class="sxs-lookup"><span data-stu-id="b548d-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="b548d-304">Sécurité - `Unblock-File` Avant de s’exécuter sur n’importe quel script ou fichier exécutable, ouvrez le fichier dans Notepad, examinez les commandes et vérifiez qu’elles ne contiennent aucun code malveillant.</span><span class="sxs-lookup"><span data-stu-id="b548d-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="b548d-305">Par exemple, la commande `Unblock-File` suivante exécute le cmdlet sur tous les scripts dans le répertoire actuel.</span><span class="sxs-lookup"><span data-stu-id="b548d-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="b548d-306">Pour créer l’application web pour l’application de base (pas de traitement des files d’attente) Fix It app, exécutez le script de création de l’environnement.</span><span class="sxs-lookup"><span data-stu-id="b548d-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="b548d-307">Le `Name` paramètre requis spécifie le nom de la base de données et est également utilisé pour le compte de stockage que le script crée.</span><span class="sxs-lookup"><span data-stu-id="b548d-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="b548d-308">Le nom doit être globalement unique dans le domaine azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="b548d-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="b548d-309">Si vous spécifiez un nom qui n’est pas unique, comme Fixit `New-AzureWebsite` ou Test (ou même comme dans l’exemple, fixitdemo), le cmdlet échoue avec une erreur interne qui signale un conflit.</span><span class="sxs-lookup"><span data-stu-id="b548d-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="b548d-310">Le script convertit le nom en tous les cas inférieurs pour se conformer aux exigences de nom pour les applications Web, les comptes de stockage et les bases de données.</span><span class="sxs-lookup"><span data-stu-id="b548d-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="b548d-311">Le `SqlDatabasePassword` paramètre requis spécifie le mot de passe du compte d’administration qui sera créé pour SQL Database.</span><span class="sxs-lookup"><span data-stu-id="b548d-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="b548d-312">N’incluez pas de caractères&amp; &lt; &gt; XML spéciaux dans le mot de passe (;).</span><span class="sxs-lookup"><span data-stu-id="b548d-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="b548d-313">Il s’agit d’une limitation de la façon dont les scripts ont été écrits, pas une limitation d’Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="b548d-314">Par exemple, si vous souhaitez créer une application web nommée "fixitdemo" et utiliser un mot de passe d’administrateur SQL Server de "Passw0rd1", vous pouvez entrer la commande suivante:</span><span class="sxs-lookup"><span data-stu-id="b548d-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="b548d-315">Le nom doit être unique dans le domaine azurewebsites.net, et le mot de passe doit répondre aux exigences de base de données SQL pour la complexité des mots de passe.</span><span class="sxs-lookup"><span data-stu-id="b548d-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="b548d-316">(L’exemple Passw0rd1 répond aux exigences.)</span><span class="sxs-lookup"><span data-stu-id="b548d-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="b548d-317">Notez que la commande commence par ". \".</span><span class="sxs-lookup"><span data-stu-id="b548d-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="b548d-318">Pour aider à empêcher l’exécution malveillante de scripts, Windows PowerShell exige que vous fournissiez le chemin entièrement qualifié au fichier de script lorsque vous exécutez un script.</span><span class="sxs-lookup"><span data-stu-id="b548d-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="b548d-319">Vous pouvez utiliser un point pour indiquer\"l’annuaire actuel (". ) ou fournir le chemin entièrement qualifié, tels que :</span><span class="sxs-lookup"><span data-stu-id="b548d-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="b548d-320">Pour plus d’informations sur `Get-Help` le script, utilisez le cmdlet.</span><span class="sxs-lookup"><span data-stu-id="b548d-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="b548d-321">Vous pouvez `Detailed`utiliser `Full` `Parameters`le `Examples` , , et les paramètres de la cmdlet Get-Help pour filtrer l’aide qui est retourné.</span><span class="sxs-lookup"><span data-stu-id="b548d-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="b548d-322">Si le script échoue ou génère des erreurs, telles que "New-AzureWebsite: Call Set-AzureSubscription et Select-AzureSubscription first," vous n’avez peut-être pas terminé la configuration d’Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b548d-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="b548d-323">Une fois le script terminé, vous pouvez utiliser le portail de gestion Azure pour voir les ressources qui ont été créées, comme le montre le chapitre [Automate Everything.](automate-everything.md)</span><span class="sxs-lookup"><span data-stu-id="b548d-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="b548d-324">Pour déployer le projet FixIt dans le nouvel environnement Azure, utilisez le script *AzureWebsite.ps1.*</span><span class="sxs-lookup"><span data-stu-id="b548d-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="b548d-325">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="b548d-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="b548d-326">Lorsque le déploiement est terminé, le navigateur s’ouvre avec Fix It en cours d’exécution en Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="b548d-327">Dépannage des scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="b548d-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="b548d-328">Les erreurs les plus courantes rencontrées lors de l’exécution de ces scripts sont liées aux autorisations.</span><span class="sxs-lookup"><span data-stu-id="b548d-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="b548d-329">Assurez-vous `Add-AzureAccount` `Import-AzurePublishSettingsFile` que et ont réussi et que vous les avez utilisés pour le même abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="b548d-330">Même `Add-AzureAccount` si vous avez réussi, vous pourriez avoir à le courir à nouveau.</span><span class="sxs-lookup"><span data-stu-id="b548d-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="b548d-331">Les autorisations `Add-AzureAccount` ajoutées expirent dans 12 heures.</span><span class="sxs-lookup"><span data-stu-id="b548d-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="b548d-332">La référence d’objet n’a pas pour valeur une instance d’un objet.</span><span class="sxs-lookup"><span data-stu-id="b548d-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="b548d-333">Si le script renvoie des erreurs, telles que « référence d’objet non définie à une instance d’un objet », ce `Add-AzureAccount` qui signifie que Windows PowerShell ne peut pas trouver un objet à traiter (il s’agit d’une exception de référence nulle), exécutez le cmdlet et réessayez le script.</span><span class="sxs-lookup"><span data-stu-id="b548d-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="b548d-334">InternalError: Le serveur a rencontré une erreur interne.</span><span class="sxs-lookup"><span data-stu-id="b548d-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="b548d-335">Le `New-AzureWebsite` cmdlet renvoie une erreur interne lorsque le nom n’est pas unique dans le domaine azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="b548d-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="b548d-336">Pour résoudre l’erreur, utilisez une valeur différente pour le nom, qui est dans le paramètre Nom de *New-AzureWebsiteEnv.ps1*.</span><span class="sxs-lookup"><span data-stu-id="b548d-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="b548d-337">Redémarrage du script</span><span class="sxs-lookup"><span data-stu-id="b548d-337">Restarting the script</span></span>

<span data-ttu-id="b548d-338">Si vous avez besoin de redémarrer le script *New-AzureWebsiteEnv.ps1* parce qu’il a échoué avant d’imprimer le message "Script is complete", vous pouvez supprimer les ressources que le script créé avant qu’il ne cesse.</span><span class="sxs-lookup"><span data-stu-id="b548d-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="b548d-339">Par exemple, si le script a déjà créé l’application web ContosoFixItDemo et que vous exécutez le script à nouveau du même nom, le script échouera parce que le nom est utilisé.</span><span class="sxs-lookup"><span data-stu-id="b548d-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="b548d-340">Pour déterminer les ressources créées par le script avant son arrêt, utilisez les cmdlets suivants :</span><span class="sxs-lookup"><span data-stu-id="b548d-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="b548d-341">`Get-AzureSqlDatabase`: Pour exécuter ce cmdlet, pipe `Get-AzureSqlDatabase`le nom du serveur de base de données à:`Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="b548d-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="b548d-342">Pour supprimer ces ressources, utilisez les commandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="b548d-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="b548d-343">Notez que si vous supprimez le serveur de base de données, vous supprimez automatiquement les bases de données associées au serveur.</span><span class="sxs-lookup"><span data-stu-id="b548d-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="b548d-344">Comment déployer l’application avec le traitement de file d’attente à Azure App Service Web Apps et un service Cloud Azure</span><span class="sxs-lookup"><span data-stu-id="b548d-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="b548d-345">Pour activer les files d’attente, modifiez le fichier MyFixIt-Web.config.</span><span class="sxs-lookup"><span data-stu-id="b548d-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="b548d-346">En `appSettings`vertu de `UseQueues` , changer la valeur de "vrai":</span><span class="sxs-lookup"><span data-stu-id="b548d-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="b548d-347">Ensuite, déployez l’application MVC sur une application web dans Azure App Service, comme décrit [précédemment](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="b548d-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="b548d-348">Ensuite, créez un nouveau service cloud Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="b548d-349">Les scripts inclus dans l’application Fix It ne créent pas ou ne déploient pas le service cloud, vous devez donc utiliser le portail Azure pour cela.</span><span class="sxs-lookup"><span data-stu-id="b548d-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="b548d-350">Dans le portail, cliquez sur **New** -- **Compute** - **Cloud Service** -- Quick**Create,** puis entrez une URL et un emplacement de centre de données.</span><span class="sxs-lookup"><span data-stu-id="b548d-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="b548d-351">Utilisez le même centre de données où vous avez déployé l’application web.</span><span class="sxs-lookup"><span data-stu-id="b548d-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="b548d-352">Avant de pouvoir déployer le service cloud, vous devez mettre à jour certains fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="b548d-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="b548d-353">Dans MyFixIt.WorkerRole-app.config, `connectionStrings`sous , remplacer `appdb` la valeur de la chaîne de connexion avec la chaîne de connexion réelle pour la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="b548d-353">In MyFixIt.WorkerRole\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="b548d-354">Vous pouvez obtenir la chaîne de connexion à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="b548d-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="b548d-355">Dans le portail, cliquez sur **SQL Databases** - **appdb** - **Voir les chaînes de connexion SQL Database pour ADO .Net, ODBC, PHP, et JDBC**.</span><span class="sxs-lookup"><span data-stu-id="b548d-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="b548d-356">Copiez la chaîne de connexion ADO.NET et collez la valeur dans le fichier app.config.</span><span class="sxs-lookup"><span data-stu-id="b548d-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="b548d-357">Remplacez «\_\_votre mot de passe ici » par le mot de passe de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="b548d-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="b548d-358">(En supposant que vous utumiez les scripts pour `SqlDatabasePassword` déployer l’application MVC, vous avez spécifié le mot de passe de base de données dans le paramètre de script.)</span><span class="sxs-lookup"><span data-stu-id="b548d-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="b548d-359">Le résultat devrait ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="b548d-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="b548d-360">Dans le même fichier MyFixIt.WorkerRole-app.config, sous `appSettings`, remplacez les valeurs des deux placesholders pour le compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-360">In the same MyFixIt.WorkerRole\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="b548d-361">Vous pouvez obtenir la clé d’accès à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="b548d-361">You can get the access key from the portal.</span></span> <span data-ttu-id="b548d-362">Voir [comment gérer les comptes de stockage](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="b548d-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="b548d-363">Dans MyFixItCloudService-ServiceConfiguration.Cloud.cscfg, remplacez les mêmes valeurs de deux places pour le compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="b548d-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="b548d-364">Maintenant, vous êtes prêt à déployer le service cloud.</span><span class="sxs-lookup"><span data-stu-id="b548d-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="b548d-365">Dans Solution Explore, cliquez à droite sur le projet MyFixItCloudService et **sélectionnez Publier**.</span><span class="sxs-lookup"><span data-stu-id="b548d-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="b548d-366">Pour plus d’informations, voir "[Déployer l’application à Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", qui est dans la partie 2 de [ce tutoriel](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="b548d-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="b548d-367">Précédent</span><span class="sxs-lookup"><span data-stu-id="b548d-367">Previous</span></span>](more-patterns-and-guidance.md)
