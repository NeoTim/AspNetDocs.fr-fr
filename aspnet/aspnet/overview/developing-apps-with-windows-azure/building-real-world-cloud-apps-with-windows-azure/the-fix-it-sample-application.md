---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: 'Annexe : Le correctif il exemple d’Application (création d’applications de Cloud réalistes avec Azure) | Microsoft Docs'
author: MikeWasson
description: Building Real World Cloud Apps with Azure e-book est basé sur une présentation développée par Scott Guthrie. Il explique 13 modèles et pratiques qui peuvent il...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: de3c8ea29f2c271136f58d8165bb92f4ab28ce83
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/01/2019
ms.locfileid: "57034216"
---
<a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="7ea8e-104">Annexe : Le correctif il exemple d’Application (création d’applications de Cloud réalistes avec Azure)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>
====================
<span data-ttu-id="7ea8e-105">par [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="7ea8e-106">Téléchargez le correctif il de projet</span><span class="sxs-lookup"><span data-stu-id="7ea8e-106">Download The Fix It Project</span></span>](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="7ea8e-107">Le **Building Real World Cloud Apps with Azure** e-book est basé sur une présentation développée par Scott Guthrie.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="7ea8e-108">Il explique 13 modèles et pratiques qui peuvent vous aider à réussir le développement d’applications web pour le cloud.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="7ea8e-109">Pour plus d’informations sur l’e-book, consultez [le premier chapitre](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="7ea8e-110">Cette annexe à Building Real World Cloud Apps with Azure e-book contient les sections suivantes qui fournissent des informations supplémentaires sur le Fix It exemple d’application que vous pouvez télécharger :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="7ea8e-111">Problèmes connus</span><span class="sxs-lookup"><span data-stu-id="7ea8e-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="7ea8e-112">Bonnes pratiques</span><span class="sxs-lookup"><span data-stu-id="7ea8e-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="7ea8e-113">Comment exécuter l’application à partir de Visual Studio sur votre ordinateur local</span><span class="sxs-lookup"><span data-stu-id="7ea8e-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="7ea8e-114">Comment déployer l’application de base dans Azure App Service Web Apps en utilisant les scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7ea8e-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="7ea8e-115">Résolution des problèmes de scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7ea8e-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="7ea8e-116">Comment déployer l’application avec la file d’attente de traitement pour Azure App Service Web Apps et un Service Cloud Azure</span><span class="sxs-lookup"><span data-stu-id="7ea8e-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="7ea8e-117">Problèmes connus</span><span class="sxs-lookup"><span data-stu-id="7ea8e-117">Known issues</span></span>

<span data-ttu-id="7ea8e-118">L’application Fix It a été développée afin d’illustrer la façon la plus simple possible, certains des modèles présentés dans ce livre électronique.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="7ea8e-119">Toutefois, étant donné que l’e-book concerne la création d’applications du monde réel, nous soumis le code Fix It à un examen et le processus de test similaire à ce que nous ferions des logiciels existants.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="7ea8e-120">Nous avons constaté un nombre de problèmes et comme avec n’importe quelle application réalistes, certaines d'entre elles nous avons résolu et certaines d'entre elles nous différée vers une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="7ea8e-121">La liste suivante répertorie les problèmes qui doivent être traités dans une application de production, mais pour une raison ou une autre que nous avons décidés de ne pas l’adresse dans la version initiale de l’application exemple Fix It.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="7ea8e-122">Sécurité</span><span class="sxs-lookup"><span data-stu-id="7ea8e-122">Security</span></span>

- <span data-ttu-id="7ea8e-123">Assurez-vous que vous ne pouvez pas affecter une tâche à un propriétaire d’inexistantes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="7ea8e-124">Vérifiez que vous pouvez uniquement afficher et modifier les tâches que vous avez créé, ou vous sont assignés.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="7ea8e-125">Utiliser HTTPS pour les pages de connexion et les cookies d’authentification.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="7ea8e-126">Spécifiez une limite de temps pour les cookies d’authentification.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="7ea8e-127">Validation des entrées</span><span class="sxs-lookup"><span data-stu-id="7ea8e-127">Input validation</span></span>

<span data-ttu-id="7ea8e-128">En règle générale, une application de production feriez plus d’entrées de validation que l’application Fix It.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="7ea8e-129">Par exemple, la taille d’image / image de taille de fichier autorisée pour le téléchargement doit être limitée.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="7ea8e-130">Fonctionnalité de l’administrateur</span><span class="sxs-lookup"><span data-stu-id="7ea8e-130">Administrator functionality</span></span>

<span data-ttu-id="7ea8e-131">Un administrateur doit être en mesure de modifier la propriété sur les tâches existantes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="7ea8e-132">Par exemple, le créateur d’une tâche peut laisser l’entreprise, en laissant aucune autre avec l’autorité nécessaire pour mettre à jour de la tâche, sauf si l’accès d’administration est activé.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="7ea8e-133">Traitement des messages de file d’attente</span><span class="sxs-lookup"><span data-stu-id="7ea8e-133">Queue message processing</span></span>

<span data-ttu-id="7ea8e-134">Message de file d’attente de traitement dans l’application Fix It a été conçu pour être simple afin d’illustrer le modèle de travail centré à la file d’attente avec une quantité minimale de code.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="7ea8e-135">Ce code simple ne serait pas suffisant pour une application de production réel.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="7ea8e-136">Le code ne garantit pas que chaque message de file d’attente est traité au maximum une fois.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="7ea8e-137">Lorsque vous recevez un message de la file d’attente, il existe une période de délai d’attente, au cours de laquelle le message est invisible dans d’autres écouteurs de file d’attente.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="7ea8e-138">Si le délai d’attente expire avant que le message est supprimé, le message est à nouveau visible.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="7ea8e-139">Par conséquent, si une instance de rôle de travail passe à un certain temps de traitement d’un message, il est théoriquement possible pour le même message soient traitées à deux reprises, ce qui entraîne une tâche en double dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="7ea8e-140">Pour plus d’informations sur ce problème, consultez [à l’aide de files d’attente stockage Azure](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="7ea8e-141">La logique d’interrogation de file d’attente peut être plus rentable, par extraction d’un message de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="7ea8e-142">Chaque fois que vous appelez [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), il existe un coût de transaction.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="7ea8e-143">Au lieu de cela, vous pouvez appeler [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (Notez le pluriel »), qui obtient plusieurs messages dans une transaction unique.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="7ea8e-144">Les coûts de transaction pour les files d’attente de stockage Azure sont très faibles, l’impact sur les coûts est donc pas important dans la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="7ea8e-145">La boucle serrée dans le code de traitement des messages de file d’attente provoque l’affinité du processeur, ce qui n’utilise pas efficacement les machines virtuelles multicœurs.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="7ea8e-146">Une meilleure conception utiliseriez le parallélisme des tâches pour exécuter plusieurs tâches async en parallèle.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="7ea8e-147">Traitement du message de file d’attente a la gestion des exceptions uniquement rudimentaire.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="7ea8e-148">Par exemple, le code ne gère pas [messages incohérents](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="7ea8e-149">(Lorsque le traitement des messages provoque une exception, vous devez enregistrer l’erreur et de supprimer le message, ou le rôle de travail tente de traiter de nouveau, et la boucle continue indéfiniment).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="7ea8e-150">Requêtes SQL sont unbounded</span><span class="sxs-lookup"><span data-stu-id="7ea8e-150">SQL queries are unbounded</span></span>

<span data-ttu-id="7ea8e-151">Code actuel Fix It n’impose aucune limite sur les requêtes pour les pages d’Index peuvent retourner le nombre de lignes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="7ea8e-152">Si un grand nombre de tâches est entré dans la base de données, la taille des listes qui en résulte reçu peut entraîner des problèmes de performances.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="7ea8e-153">La solution consiste à implémenter la pagination.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-153">The solution is to implement paging.</span></span> <span data-ttu-id="7ea8e-154">Pour obtenir un exemple, consultez [tri, filtrage et la pagination avec Entity Framework dans une Application ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="7ea8e-155">Modèles de vue recommandés</span><span class="sxs-lookup"><span data-stu-id="7ea8e-155">View models recommended</span></span>

<span data-ttu-id="7ea8e-156">L’application Fix It utilise la classe d’entité FixItTask pour passer des informations entre le contrôleur et la vue.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="7ea8e-157">Une bonne pratique consiste à utiliser des modèles de vue.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-157">A best practice is to use view models.</span></span> <span data-ttu-id="7ea8e-158">Le modèle de domaine (par exemple, la classe d’entité FixItTask) est conçu autour de ce qui est nécessaire pour la persistance des données, un modèle de vue peut être conçu pour être présentation des données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="7ea8e-159">Pour plus d’informations, consultez [12 ASP.NET MVC meilleures pratiques](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-159">For more information, see [12 ASP.NET MVC Best Practices](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="7ea8e-160">Objet blob d’image sécurisée recommandée</span><span class="sxs-lookup"><span data-stu-id="7ea8e-160">Secure image blob recommended</span></span>

<span data-ttu-id="7ea8e-161">Les magasins d’applications Fix It téléchargé des images comme étant public, ce qui signifie que toute personne trouvant l’URL peut accéder aux images.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="7ea8e-162">Les images pouvaient être sécurisées au lieu de public.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="7ea8e-163">Aucun script d’automatisation PowerShell des files d’attente</span><span class="sxs-lookup"><span data-stu-id="7ea8e-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="7ea8e-164">Exemples de scripts PowerShell automation ont été écrites uniquement pour la version de base de Fix It qui s’exécute entièrement dans Azure App Service Web Apps.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="7ea8e-165">Nous n’avons pas fourni de scripts pour la configuration et de déploiement pour l’application web avec un environnement de Cloud Service requis pour le traitement de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="7ea8e-166">Traitement spécial pour les codes HTML dans l’entrée d’utilisateur</span><span class="sxs-lookup"><span data-stu-id="7ea8e-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="7ea8e-167">ASP.NET empêche automatiquement de nombreuses façons dans lequel les utilisateurs malveillants peuvent tenter des attaques de script entre sites en entrant un script dans les zones de texte d’entrée utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="7ea8e-168">Et le MVC `DisplayFor` helper utilisé pour afficher la tâche titres et notes automatiquement les valeurs au format HTML qu’elle envoie au navigateur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="7ea8e-169">Mais dans une application de production, vous souhaiterez prendre des mesures supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="7ea8e-170">Pour plus d’informations, consultez [Validation des demandes dans ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="7ea8e-171">meilleures pratiques recommandées.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-171">Best practices</span></span>

<span data-ttu-id="7ea8e-172">Voici certains problèmes qui ont été résolus après avoir été découverts dans la révision du code et le test de la version d’origine de l’application Fix It.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="7ea8e-173">Certains ont été provoqués par le codeur d’origine n’est pas conscient de meilleure pratique particulier, certaines simplement parce que le code a été écrit rapidement et qu’il n’était pas destiné à sa version.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="7ea8e-174">Nous allons les problèmes de liste ici au cas où quelque chose que nous avons appris à partir de cette révision et de test qui peut-être vous être utile à d’autres personnes qui développent également des applications web.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="7ea8e-175">Supprimer le référentiel de base de données</span><span class="sxs-lookup"><span data-stu-id="7ea8e-175">Dispose the database repository</span></span>

<span data-ttu-id="7ea8e-176">Le `FixItTaskRepository` classe doit supprimer Entity Framework `DbContext` instance.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="7ea8e-177">Nous l’avons fait cela en implémentant `IDisposable` dans la `FixItTaskRepository` classe :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="7ea8e-178">Notez que AutoFac supprime automatiquement le `FixItTaskRepository` de l’instance, nous n’avez pas besoin de supprimer de manière explicite.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="7ea8e-179">Une autre option consiste à supprimer la `DbContext` variable de membre à partir de `FixItTaskRepository`et au lieu de cela créer une variable locale `DbContext` variable au sein de chaque méthode de référentiel, à l’intérieur d’un `using` instruction.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="7ea8e-180">Exemple :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="7ea8e-181">Enregistrer en tant que tel des singletons avec l’injection de dépendances</span><span class="sxs-lookup"><span data-stu-id="7ea8e-181">Register singletons as such with DI</span></span>

<span data-ttu-id="7ea8e-182">Depuis qu’une seule instance de la `PhotoService` classe et `Logger` classe est nécessaire, ces classes doivent être [inscrit en tant qu’instances uniques pour l’injection de dépendances](https://code.google.com/p/autofac/wiki/InstanceScope) dans *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="7ea8e-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="7ea8e-183">Sécurité : Ne pas afficher les détails de l’erreur aux utilisateurs</span><span class="sxs-lookup"><span data-stu-id="7ea8e-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="7ea8e-184">L’application Fix It d’origine n’a pas une page d’erreur générique et simplement laisser tous les bulles exceptions jusqu'à l’interface utilisateur, afin de l’exception des erreurs de connexion de base de données peut entraîner une trace de pile complète qui est affichée dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="7ea8e-185">Informations d’erreur détaillé peuvent faciliter parfois les attaques par des utilisateurs malveillants.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="7ea8e-186">La solution consiste à consigner les détails d’exception et afficher une page d’erreur à l’utilisateur qui n’inclut les détails de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="7ea8e-187">L’application Fix It a été déjà journalisation, et pour afficher une page d’erreur, nous avons ajouté `<customErrors mode=On>` dans le fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="7ea8e-188">Par défaut, cela entraîne *Views\Shared\Error.cshtml* à afficher pour les erreurs.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="7ea8e-189">Vous pouvez personnaliser *Error.cshtml* ou créez votre propre vue de page d’erreur et ajoutez un `defaultRedirect` attribut.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="7ea8e-190">Vous pouvez également spécifier des pages d’erreurs différents pour des erreurs spécifiques.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="7ea8e-191">Sécurité : autoriser uniquement une tâche à être modifié par son créateur</span><span class="sxs-lookup"><span data-stu-id="7ea8e-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="7ea8e-192">La page d’Index de tableau de bord affiche uniquement les tâches créées par l’utilisateur connecté, mais un utilisateur malveillant pourrait créer une URL avec un ID pour les tâches d’un autre utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="7ea8e-193">Nous avons ajouté le code dans *DashboardController.cs* pour retourner une erreur 404 dans ce cas :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="7ea8e-194">Ne pas absorber des exceptions</span><span class="sxs-lookup"><span data-stu-id="7ea8e-194">Don't swallow exceptions</span></span>

<span data-ttu-id="7ea8e-195">L’application Fix It d’origine vient de rentrer null après l’ouverture d’une exception qui provient d’une requête SQL :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="7ea8e-196">Cela rendrait présenté à l’utilisateur comme si la requête a réussi, mais simplement n’a pas retourné toutes les lignes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="7ea8e-197">Solution consiste à lever à nouveau l’exception après la mise en cache et la journalisation :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="7ea8e-198">Intercepter toutes les exceptions dans les rôles de travail</span><span class="sxs-lookup"><span data-stu-id="7ea8e-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="7ea8e-199">Les exceptions non gérées dans un rôle de travail entraîne la machine virtuelle doit être recyclé, donc vous encapsulez tout dans un bloc try-catch et de gérer toutes les exceptions.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="7ea8e-200">Spécifier une longueur pour les propriétés de chaîne dans les classes d’entité</span><span class="sxs-lookup"><span data-stu-id="7ea8e-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="7ea8e-201">Pour afficher le code simple, la version d’origine de l’application Fix It n’a pas spécifié les longueurs des champs de l’entité FixItTask, et par conséquent, ils ont été définis en tant que varchar (max) dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="7ea8e-202">Par conséquent, l’interface utilisateur acceptaient presque n’importe quel volume de l’entrée.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="7ea8e-203">En spécifiant les longueurs définit les limites qui s’appliquent à l’utilisateur d’entrée dans la page web et la taille de colonne dans la base de données :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="7ea8e-204">Marquer les membres privés en lecture seule alors qu’elles ne sont pas attendues pour modifier</span><span class="sxs-lookup"><span data-stu-id="7ea8e-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="7ea8e-205">Par exemple, dans le `DashboardController` classe une instance de `FixItTaskRepository` est créé et n’est pas censé modifier, donc nous avons défini en tant que [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="7ea8e-206">Utilisez la liste. Any() au lieu de la liste. Count() &gt; 0</span><span class="sxs-lookup"><span data-stu-id="7ea8e-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="7ea8e-207">Si vous vous souciez est si un ou plusieurs éléments dans une liste répondent aux critères spécifiés, utilisez le [n’importe quel](https://msdn.microsoft.com/library/bb534972.aspx) (méthode), car elle retourne dès qu’un élément correspondent aux critères est trouvé, alors que le `Count` méthode a toujours effectuer une itération à chaque élément.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="7ea8e-208">Le tableau de bord *Index.cshtml* fichier contenait à l’origine de ce code :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="7ea8e-209">Nous l’avons modifié à ceci :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="7ea8e-210">Générer des URL dans les vues MVC à l’aide de programmes d’assistance MVC</span><span class="sxs-lookup"><span data-stu-id="7ea8e-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="7ea8e-211">Pour le **créer un Fix It** bouton sur la page d’accueil, l’application Fix It dure codé en un élément d’ancrage :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="7ea8e-212">Pour obtenir des liens de la vue/Action comme ceci, il est préférable d’utiliser le [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) programme d’assistance HTML, par exemple :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="7ea8e-213">Utilisez Task.Delay au lieu de Thread.Sleep dans le rôle de travail</span><span class="sxs-lookup"><span data-stu-id="7ea8e-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="7ea8e-214">Le modèle nouveau projet place `Thread.Sleep` dans l’exemple de code pour un rôle de travail, mais à l’origine de la mise en veille du thread peut provoquer le pool de threads générer dynamiquement des threads supplémentaires inutiles.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="7ea8e-215">Vous pouvez éviter ce problème à l’aide de [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) à la place.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="7ea8e-216">Évitez async void</span><span class="sxs-lookup"><span data-stu-id="7ea8e-216">Avoid async void</span></span>

<span data-ttu-id="7ea8e-217">Si une méthode async n’a pas besoin de retourner une valeur, retourner un `Task` type plutôt que `void`.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="7ea8e-218">Cet exemple est issu le `FixItQueueManager` classe :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="7ea8e-219">Vous devez utiliser `async void` uniquement pour les gestionnaires d’événements de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="7ea8e-220">Si vous définissez une méthode en tant que `async void`, l’appelant ne peut pas **await** la méthode ou d’intercepter des exceptions lève de la méthode.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="7ea8e-221">Pour plus d’informations, consultez [meilleures pratiques de programmation asynchrone](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="7ea8e-222">Utiliser un jeton d’annulation pour arrêter l’exécution à partir de la boucle de rôle de travail</span><span class="sxs-lookup"><span data-stu-id="7ea8e-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="7ea8e-223">En règle générale, le **exécuter** méthode sur un rôle de travail contient une boucle infinie.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="7ea8e-224">Lorsque le rôle de travail s’arrête, le [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="7ea8e-225">Vous devez utiliser cette méthode pour annuler le travail est effectué à l’intérieur de la **exécuter** (méthode) et sortie normalement.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="7ea8e-226">Sinon, le processus peut être arrêté au milieu d’une opération.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="7ea8e-227">Refuser la procédure de détection MIME automatique</span><span class="sxs-lookup"><span data-stu-id="7ea8e-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="7ea8e-228">Dans certains cas, Internet Explorer signale un type MIME différent du type spécifié par le serveur web.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="7ea8e-229">Par exemple, si Internet Explorer trouve HTML contenu dans un fichier remis avec l’en-tête de réponse HTTP Content-Type : text/plain, Internet Explorer détermine que le contenu doit être rendu au format HTML.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="7ea8e-230">Malheureusement, cette « détection MIME » peut également entraîner des problèmes de sécurité pour les serveurs hébergeant le contenu non approuvé.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="7ea8e-231">Pour combattre ce problème, Internet Explorer 8 a apporté plusieurs modifications au code de détermination du type MIME et permet aux développeurs d’applications [refuser la détection MIME](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="7ea8e-232">Le code suivant a été ajouté à la *Web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="7ea8e-233">Activer le regroupement et minimisation</span><span class="sxs-lookup"><span data-stu-id="7ea8e-233">Enable bundling and minification</span></span>

<span data-ttu-id="7ea8e-234">Lorsque Visual Studio crée un nouveau projet web, regroupement et minimisation des fichiers JavaScript n’est pas activée par défaut.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="7ea8e-235">Nous avons ajouté une ligne de code dans BundleConfig.cs :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="7ea8e-236">Définir un délai d’expiration pour les cookies d’authentification</span><span class="sxs-lookup"><span data-stu-id="7ea8e-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="7ea8e-237">Par défaut, les cookies d’authentification expirent dans deux semaines.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="7ea8e-238">Une durée plus courte est plus sécurisée.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-238">A shorter time is more secure.</span></span> <span data-ttu-id="7ea8e-239">Vous pouvez modifier ce paramètre dans *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="7ea8e-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="7ea8e-240">Comment exécuter l’application à partir de Visual Studio sur votre ordinateur local</span><span class="sxs-lookup"><span data-stu-id="7ea8e-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="7ea8e-241">Il existe deux façons d’exécuter l’application Fix It :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="7ea8e-242">Exécutez l’application de base qui écrit des nouvelles tâches directement dans la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="7ea8e-243">Exécutez l’application à l’aide d’une file d’attente ainsi qu’un service principal pour créer des tâches.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="7ea8e-244">Le modèle de file d’attente est décrit dans le chapitre [centré sur la file d’attente de travail modèle](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="7ea8e-245">Exécutez l’application de base</span><span class="sxs-lookup"><span data-stu-id="7ea8e-245">Run the base application</span></span>

1. <span data-ttu-id="7ea8e-246">Installer [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="7ea8e-247">Installer le [Azure SDK pour .NET pour Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="7ea8e-248">Téléchargez le fichier .zip à partir de la [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="7ea8e-249">Dans l’Explorateur de fichiers, cliquez sur le fichier .zip, puis cliquez sur Propriétés, dans la fenêtre Propriétés, cliquez sur Débloquer.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="7ea8e-250">Décompressez le fichier.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-250">Unzip the file.</span></span>
6. <span data-ttu-id="7ea8e-251">Double-cliquez sur le fichier .sln pour lancer Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="7ea8e-252">À partir de la **outils** menu, cliquez sur **Gestionnaire de Package NuGet**, puis **Console du Gestionnaire de Package**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="7ea8e-253">Dans le Package Manager de la console, cliquez sur Restaurer.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="7ea8e-254">Quittez Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="7ea8e-255">Démarrer le [émulateur de stockage Azure](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="7ea8e-256">Redémarrez Visual Studio, en ouvrant le fichier de solution que vous avez fermé à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="7ea8e-257">Assurez-vous que le projet FixIt est défini comme projet de démarrage, puis appuyez sur CTRL + F5 pour exécuter le projet.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="7ea8e-258">Exécuter l’application avec le traitement de la file d’attente</span><span class="sxs-lookup"><span data-stu-id="7ea8e-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="7ea8e-259">Suivez les instructions pour [exécuter l’application de base](#runbase), puis fermez le navigateur et fermez Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="7ea8e-260">Démarrez Visual Studio avec des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="7ea8e-261">(Vous allez utiliser l’émulateur de calcul Azure, et qui nécessite des privilèges d’administrateur).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="7ea8e-262">Dans l’application *Web.config* de fichiers dans le *MyFixIt* project (projet web), remplacez la valeur de `appSettings/UseQueues` sur « true » :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="7ea8e-263">Si le [émulateur de stockage Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) n’est pas en cours d’exécution, démarrez-le à nouveau.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="7ea8e-264">Exécutez le projet web FixIt et le projet MyFixItCloudService simultanément.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="7ea8e-265">À l’aide de Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="7ea8e-266">Appuyez sur **F5** pour exécuter le projet FixIt.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="7ea8e-267">Dans **l’Explorateur de solutions**, cliquez sur le projet MyFixItCloudService, puis cliquez sur **déboguer** > **démarrer une nouvelle Instance**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="7ea8e-268">À l’aide de Visual Studio 2013 Express pour le Web :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="7ea8e-269">Dans l’Explorateur de solutions, cliquez sur la solution de réparation et sélectionnez **propriétés**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="7ea8e-270">Sélectionnez **plusieurs projets de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="7ea8e-271">Dans le **Action** liste déroulante sous MyFixIt et MyFixItCloudService, sélectionnez **Démarrer**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="7ea8e-272">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-272">Click **OK**.</span></span>
   7. <span data-ttu-id="7ea8e-273">Appuyez sur **F5** pour exécuter les deux projets.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="7ea8e-274">Lorsque vous exécutez le projet MyFixItCloudService, Visual Studio démarre l’émulateur de calcul Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="7ea8e-275">Selon votre configuration de pare-feu, vous devrez peut-être autoriser l’émulateur à travers le pare-feu.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="7ea8e-276">Comment déployer l’application de base dans Azure App Service Web Apps en utilisant les scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7ea8e-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="7ea8e-277">Pour illustrer la [automatiser tout](automate-everything.md) modèle, l’application Fix It est fourni avec des scripts pour configurer un environnement dans Azure et déploiement le projet vers le nouvel environnement.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="7ea8e-278">Les instructions suivantes expliquent comment utiliser les scripts.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="7ea8e-279">Si vous souhaitez exécuter dans Azure sans utiliser les files d’attente et les modifications pour exécuter localement des files d’attente, assurez-vous que vous définissez la valeur d’appSetting UseQueues revenir sur false avant de poursuivre les instructions suivantes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="7ea8e-280">Ces instructions supposent que vous avez déjà téléchargé et exécutez la solution Fix It localement, et que vous disposez d’un Azure compte ou abonnement un abonnement Azure que vous êtes autorisé à gérer.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="7ea8e-281">Installer le **Azure PowerShell** console.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="7ea8e-282">Pour obtenir des instructions, consultez [comment installer et configurer Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="7ea8e-283">Cette console personnalisée est configurée pour fonctionner avec votre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="7ea8e-284">Le module Azure est installé dans le *Program Files* directory et est importé automatiquement à chaque utilisation de la console Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="7ea8e-285">Si vous préférez travailler dans un programme hôte différent, telles que Windows PowerShell ISE, veillez à utiliser le [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) applet de commande pour importer le module Azure ou utiliser une commande dans le module Azure pour déclencher l’importation automatique du module.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="7ea8e-286">Démarrez Azure PowerShell avec le **exécuter en tant qu’administrateur** option.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="7ea8e-287">Exécutez le [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) applet de commande pour définir la stratégie d’exécution de Azure PowerShell sur `RemoteSigned`.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="7ea8e-288">Entrez **Y** (pour Oui) pour terminer la modification de la stratégie.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="7ea8e-289">Ce paramètre vous permet d’exécuter des scripts locaux qui ne sont pas signés numériquement.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="7ea8e-290">(Vous pouvez également définir la stratégie d’exécution `Unrestricted`, ce qui élimine la nécessité pour l’étape de débloquer ultérieurement, mais cela n’est pas recommandé pour des raisons de sécurité.)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="7ea8e-291">Exécutez le `Add-AzureAccount` applet de commande pour configurer PowerShell avec les informations d’identification pour votre compte.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="7ea8e-292">Ces informations d’identification expirent après une période de temps et vous devez exécuter à nouveau le `Add-AzureAccount` applet de commande.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="7ea8e-293">Comme cet e-book est en cours d’écriture, la limite de temps avant l’expirent des informations d’identification est de 12 heures.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="7ea8e-294">Si vous avez plusieurs abonnements, utilisez l’applet de commande Select-AzureSubscription pour spécifier l’abonnement que vous souhaitez créer dans l’environnement de test.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="7ea8e-295">Importer un certificat de gestion pour le même abonnement Azure à l’aide de la `Get-AzurePublishSettingsFile` et `Import-AzurePublishSettingsFile` applets de commande.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="7ea8e-296">La première de ces applets de commande télécharge un fichier de certificat, et dans l’autre, vous spécifiez l’emplacement de ce fichier pour pouvoir pour l’importer.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="7ea8e-297">Conserver le fichier téléchargé dans un emplacement sécurisé ou supprimez-le lorsque vous avez terminé avec lui, car il contient un certificat qui peut être utilisé pour gérer vos services Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="7ea8e-298">Le certificat est utilisé pour un appel d’API REST qui détecte l’adresse IP de l’ordinateur de développement afin de définir une règle de pare-feu sur le serveur de base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="7ea8e-299">Exécutez le [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) applet de commande (alias sont `cd`, `chdir`, et `sl`) pour accéder au répertoire qui contient les scripts.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="7ea8e-300">(Ils se trouvent dans le *Automation* dans le dossier de solution Fix It.) Placez le chemin d’accès entre guillemets si l’un des noms de répertoire contient des espaces.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="7ea8e-301">Par exemple, pour accéder à la `c:\Sample Apps\FixIt\Automation` directory, vous pouvez entrer la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="7ea8e-302">Pour autoriser Windows PowerShell exécuter ces scripts, utilisez la [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) applet de commande.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="7ea8e-303">(Les scripts sont bloqués, car elles ont été téléchargées à partir d’Internet.)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="7ea8e-304">Sécurité - avant d’exécuter `Unblock-File` sur n’importe quel script ou un fichier exécutable, ouvrez le fichier dans le bloc-notes, examinez les commandes et vérifiez qu’ils ne contiennent pas de tout code malveillant.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="7ea8e-305">Par exemple, la commande suivante exécute la `Unblock-File` applet de commande sur tous les scripts dans le répertoire actif.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="7ea8e-306">Pour créer l’application web pour la base (aucune file d’attente de traitement) Corrigez-la application, exécutez le script de création d’environnement.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="7ea8e-307">Requis `Name` paramètre spécifie le nom de la base de données et est également utilisé pour le compte de stockage qui crée le script.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="7ea8e-308">Le nom doit être globalement unique au sein du domaine azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="7ea8e-309">Si vous spécifiez un nom qui n’est pas unique, tels que le correctif ou de Test (ou même comme dans l’exemple, fixitdemo), le `New-AzureWebsite` applet de commande échoue avec une erreur interne qui signale un conflit.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="7ea8e-310">Le script convertit le nom en minuscules pour respecter les exigences de nom pour les applications web, les comptes de stockage et les bases de données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="7ea8e-311">Requis `SqlDatabasePassword` paramètre spécifie le mot de passe du compte administrateur qui sera créé pour la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="7ea8e-312">N’incluez pas les caractères XML spéciaux dans le mot de passe (&amp; &lt; &gt; ;).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="7ea8e-313">Il s’agit d’une limitation de la manière dont les scripts ont été écrits, pas une limitation d’Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="7ea8e-314">Par exemple, si vous souhaitez créer une application web nommée « fixitdemo » et utiliser un mot de passe administrateur SQL Server de « Passw0rd1 », vous pouvez entrer la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="7ea8e-315">Le nom doit être unique dans le domaine azurewebsites.net, et le mot de passe doit répondre aux exigences de base de données SQL pour la complexité de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="7ea8e-316">(L’exemple Passw0rd1 ne respecte pas les exigences.)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="7ea8e-317">Notez que la commande commence par ». \".</span><span class="sxs-lookup"><span data-stu-id="7ea8e-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="7ea8e-318">Pour éviter les malveillant d’exécution de scripts, Windows PowerShell nécessite que vous fournissez le chemin d’accès complet au fichier de script lorsque vous exécutez un script.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="7ea8e-319">Vous pouvez utiliser un point pour indiquer le répertoire actif («.\") ou fournir le chemin d’accès qualifié complet, tel que :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="7ea8e-320">Pour plus d’informations sur le script, utilisez le `Get-Help` applet de commande.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="7ea8e-321">Vous pouvez utiliser la `Detailed`, `Full`, `Parameters`, et `Examples` paramètres de l’applet de commande Get-Help pour filtrer l’aide qui est retourné.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="7ea8e-322">Si le script échoue ou génère des erreurs, telles que « New-AzureWebsite : Appelez tout d’abord, Set-AzureSubscription et Select-AzureSubscription » vous n’avez ne peut-être pas terminé la configuration d’Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="7ea8e-323">Une fois le script terminé, vous pouvez utiliser le portail de gestion Azure pour voir les ressources qui ont été créés, comme indiqué dans le [automatiser tout](automate-everything.md) chapitre.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="7ea8e-324">Pour déployer le projet FixIt vers le nouvel environnement Azure, utilisez le *AzureWebsite.ps1* script.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="7ea8e-325">Exemple :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="7ea8e-326">Lorsque le déploiement est terminé, le navigateur s’ouvre avec Fix It en cours d’exécution dans Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="7ea8e-327">Résolution des problèmes de scripts Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7ea8e-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="7ea8e-328">Les erreurs courantes rencontrées lors de l’exécution de ces scripts sont liés aux autorisations.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="7ea8e-329">Assurez-vous que l’option `Add-AzureAccount` et `Import-AzurePublishSettingsFile` ont réussi et que vous les avez utilisées pour le même abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="7ea8e-330">Même si `Add-AzureAccount` a été réussie vous devrez peut-être exécuter de nouveau.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="7ea8e-331">Les autorisations ajoutées par `Add-AzureAccount` expirer dans les 12 heures.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="7ea8e-332">La référence d'objet n'a pas la valeur d'une instance d'un objet.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="7ea8e-333">Si le script renvoie des erreurs, telles que « Référence d’objet non définie sur une instance d’un objet, « ce qui signifie que Windows PowerShell ne peut pas trouver un objet au processus (il s’agit d’une exception de référence null), exécutez le `Add-AzureAccount` applet de commande, puis réessayez le script.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="7ea8e-334">Erreur interne : Le serveur a rencontré une erreur interne.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="7ea8e-335">Le `New-AzureWebsite` applet de commande renvoie une erreur interne lorsque le nom n’est pas unique dans le domaine azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="7ea8e-336">Pour résoudre l’erreur, utilisez une valeur différente pour le nom, ce qui se trouve dans le paramètre Name de *New-AzureWebsiteEnv.ps1*.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="7ea8e-337">Redémarrer le script</span><span class="sxs-lookup"><span data-stu-id="7ea8e-337">Restarting the script</span></span>

<span data-ttu-id="7ea8e-338">Si vous devez redémarrer le *New-AzureWebsiteEnv.ps1* script car il a échoué avant le message « Le Script est terminé » imprimé, vous pouvez souhaiter supprimer les ressources qui le script créé avant qu’elle s’est arrêtée.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="7ea8e-339">Par exemple, si le script a déjà créé l’application web ContosoFixItDemo et que vous réexécutez le script avec le même nom, le script échoue car le nom est en cours d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="7ea8e-340">Pour déterminer quelles ressources le script créé avant arrêté, utilisez les applets de commande suivantes :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="7ea8e-341">`Get-AzureSqlDatabase`: Pour exécuter cette applet de commande, dirigez le nom du serveur de base de données pour `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="7ea8e-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="7ea8e-342">Pour supprimer ces ressources, utilisez les commandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="7ea8e-343">Notez que si vous supprimez le serveur de base de données, vous supprimer automatiquement les bases de données associées au serveur.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="7ea8e-344">Comment déployer l’application avec la file d’attente de traitement pour Azure App Service Web Apps et un Service Cloud Azure</span><span class="sxs-lookup"><span data-stu-id="7ea8e-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="7ea8e-345">Pour activer les files d’attente, apportez la modification suivante dans le fichier MyFixIt\Web.config.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="7ea8e-346">Sous `appSettings`, modifiez la valeur de `UseQueues` sur « true » :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="7ea8e-347">Puis déployer l’application MVC pour une application web dans Azure App Service, comme décrit [antérieures](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="7ea8e-348">Ensuite, créez un nouveau service cloud Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="7ea8e-349">Les scripts inclus dans l’application Fix It ne créer et déployer le service cloud, vous devez utiliser le portail Azure pour cela.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="7ea8e-350">Dans le portail, cliquez sur **New** -- **calcul** – **Service Cloud** -- **création rapide**, puis entrez une URL et un emplacement de centre de données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="7ea8e-351">Utilisez le même centre de données où vous avez déployé l’application web.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="7ea8e-352">Avant de pouvoir déployer le service cloud, vous devez mettre à jour certains des fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="7ea8e-353">Dans MyFixIt.WorkerRoler\app.config, sous `connectionStrings`, remplacez la valeur de la `appdb` chaîne de connexion avec la chaîne de connexion pour la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-353">In MyFixIt.WorkerRoler\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="7ea8e-354">Vous pouvez obtenir la chaîne de connexion à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="7ea8e-355">Dans le portail, cliquez sur **bases de données SQL** - **appdb** - **les chaînes de connexion de base de données de vue SQL pour ADO .net, ODBC, PHP et JDBC**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="7ea8e-356">Copiez la chaîne de connexion ADO.NET et collez la valeur dans le fichier app.config.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="7ea8e-357">Remplacez « {votre\_mot de passe\_ici} » avec votre mot de passe de base de données.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="7ea8e-358">(En supposant que vous avez utilisé les scripts pour déployer l’application MVC, vous avez spécifié le mot de passe de base de données dans le `SqlDatabasePassword` paramètre de script.)</span><span class="sxs-lookup"><span data-stu-id="7ea8e-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="7ea8e-359">Le résultat doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="7ea8e-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="7ea8e-360">Dans le même fichier MyFixIt.WorkerRoler\app.config, sous `appSettings`, remplacez les deux valeurs d’espace réservé pour le compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-360">In the same MyFixIt.WorkerRoler\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="7ea8e-361">Vous pouvez obtenir la clé d’accès à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-361">You can get the access key from the portal.</span></span> <span data-ttu-id="7ea8e-362">Consultez [comment gérer les comptes de stockage](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="7ea8e-363">Dans MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, remplacez les deux valeurs d’espaces réservés même pour le compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="7ea8e-364">Vous êtes maintenant prêt à déployer le service cloud.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="7ea8e-365">Dans l’Explorateur de solutions, cliquez sur le projet MyFixItCloudService et sélectionnez **publier**.</span><span class="sxs-lookup"><span data-stu-id="7ea8e-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="7ea8e-366">Pour plus d’informations, consultez «[déployer l’Application sur Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)», qui se trouve dans la partie 2 de [ce didacticiel](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="7ea8e-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="7ea8e-367">Précédent</span><span class="sxs-lookup"><span data-stu-id="7ea8e-367">Previous</span></span>](more-patterns-and-guidance.md)
